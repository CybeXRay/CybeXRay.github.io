<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>mr robot ctf</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>mr robot ctf</h1><br/>r<strong>Machine IP: 				10.10.108.225 			10.10.7.69</strong><br /><br />We begin with nmap scan<br /><br /><a href=""><img src="images/170-1.png" alt="images/170-1.png" /></a><br /><br />We find port 80 &amp; 443 Open &amp; port 22 shown as closed (Might be partially open - Not needed for the write up)<br /><br />We browse the website manually, it has various cool pages. But nothing intresting to give us access.<br />We then do an enumeration of directories with gobuster.<br /><br /><em><strong>gobuster dir -u http://10.10.108.225 -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt</strong></em><br /><br /><strong>Output:</strong><br /><a href=""><img src="images/170-2.png" alt="images/170-2.png" /></a><br /><br /><strong>We find 2 intresting files with (Status: 200).</strong><br />/robots -------→ Instruction for webpage crawlers <br />/wp-login ------→ Wordpress Login<br /><br /><br /><a href=""><img src="images/170-3.png" alt="images/170-3.png" /></a><br /><br />Accessing <strong>http://10.10.7.69/robots</strong> we get the above. <br /><br />We get the <strong>first key</strong> and a dictionary file named <strong>fscocity.dic</strong><br /><br /><br /><strong>http://10.10.7.69/key-1-of-3.txt</strong><br /><a href=""><img src="images/170-4.png" alt="images/170-4.png" /></a><br /><br /><br /><strong>http://10.10.7.69/fsocity.dic</strong><br /><a href=""><img src="images/170-5.png" alt="images/170-5.png" /></a><br /><br /><br />Next we open the other intresting page. <strong>wp-login</strong><br />We will use <strong>hydra</strong> and <strong>dictionary file</strong> recieved to find out both <strong>username</strong> and <strong>password</strong>.<br /><br />We capture the post request with burpsuite and collect the three important parameters.<br /><br />1. Post Requester<br />2. Post Request<br />3. Error Message<br /><br /><strong>We get 1 and 2 below</strong><br /><a href=""><img src="images/170-6.png" alt="images/170-6.png" /></a><br /><strong>We get 3 below</strong><br /><a href=""><img src="images/170-7.png" alt="images/170-7.png" /></a><br /><br /><strong>Hydra Code for finding out Username:</strong><br /><br /><em><strong>hydra -L /home/cybex/lab/thm/MrRobotCTF/fsocity.dic -p test -s 80 10.10.7.69 http-post-form &quot;/wp-login.php:log=^USER^&amp;pwd=^PASS^&amp;wp-submit=Log+In&amp;redirect_to=http%3A%2F%2F10.10.7.69%2Fwp-admin%2F&amp;testcookie=1:Invalid username&quot; -vv -t 64</strong></em><br /><br /><a href=""><img src="images/170-8.png" alt="images/170-8.png" /></a><br /><br />We found that <strong>Elliot</strong> is a valid username. This can be confirmed by using the above credentials in wordpress login. We will get a different error message.<br /><br /><a href=""><img src="images/170-9.png" alt="images/170-9.png" /></a><br /><br /><br /><br />keeping the 1 and 2 parameters same. We change the 3 parameter to the above error and following is the hydra code for password brute-force with Elliot as user.<br /><br /><strong>Hydra Code for finding out Password:</strong><br /><br /><em><strong>hydra -l Elliot -P /home/cybex/lab/thm/MrRobotCTF/fsocity.dic -s 80 10.10.7.69 http-post-form &quot;/wp-login.php:log=^USER^&amp;pwd=^PASS^&amp;wp-submit=Log+In&amp;redirect_to=http%3A%2F%2F10.10.7.69%2Fwp-admin%2F&amp;testcookie=1:The password you entered for the username&quot; -vv -t 64</strong></em><br /><br /><a href=""><img src="images/170-10.png" alt="images/170-10.png" /></a><br /><br /><br /><strong>Thus, we get the wordpress credentials:<br />Username: Elliot<br />Password: ER28-0652</strong><br /><br />Next we login to <strong>wp-login</strong> page and gain foot hold by editing a non-default theme and live preview it, (So that it will load all the php files and in doing so our reverse shell php will also get executed.)<br /><br /><strong>Note:</strong>  1) Choose a non-default theme so that we can live preview it.<br />			2) Choose any php to replace with reverse shell code. (However, 404.php is more common for this purpose as its present in almost all themes and can be easily used.<br /><br /><strong>See the following process:</strong><br /><br /><a href=""><img src="images/170-11.png" alt="images/170-11.png" /></a><br /><br />Once we are at the dashboard.<br /><br />Go to <strong>Appearance ---→ Themes</strong><br /><br /><a href=""><img src="images/170-12.png" alt="images/170-12.png" /></a><br /><br />We notice that there are 3 themes.<br />We should ideally choose any non default theme. <strong>eg. Twenty Fourteen or Twenty Thirteen</strong><br /><br /><strong>Say We select Twenty Fourteen.</strong> Just keep the name in mind<br />and <strong>Go to Appearance ----→ Editor</strong><br /><br /><a href=""><img src="images/170-13.png" alt="images/170-13.png" /></a><br /><br />In the editor select theme, in the upper right corner highlighted above.<br />Select previously discussed <strong>Twenty Fourteen</strong><br /><br /><a href=""><img src="images/170-14.png" alt="images/170-14.png" /></a><br /><br />Then click on <strong>404 Template</strong>. It will open the <strong>404.php</strong><br /><strong>Remove</strong> the enitire contents and <strong>replace</strong> with a <strong>php-reverse-shell</strong><br />Then hit <strong>Update File</strong> at the bottom of the page to save it.<br /><br /><br />Now, open a netcat listner in our terminal.<br />To run the reverse shell payload.<br /><br />Go back to <strong>Appearance ---→ Themes</strong><br />Then hover the mouse on <strong>Twenty Fourteen</strong> and click on <strong>Live Preview</strong><br /><strong>Note:</strong> if Live Preview doesn&#39;t work. Go to <em><strong>http://10.10.7.69/wp-admin/404.php?theme=twentyfourteen</strong></em><br /><br /><br /><a href=""><img src="images/170-15.png" alt="images/170-15.png" /></a><br /><br />By doing this we will get a shell in our netcat listener.<br /><br /><a href=""><img src="images/170-16.png" alt="images/170-16.png" /></a><br /><br />We got our initial foothold as user <strong>‘daemon’</strong><br /><br /><br /><strong>Changing to a system user</strong><br /><br /><a href=""><img src="images/170-17.png" alt="images/170-17.png" /></a><br /><br />We have a MD5 Password for the user robot it seems. We copy it to a local hash file.<br />We crack it using john<br /><br /><em><strong>john --format=Raw-MD5 --wordlist=/usr/share/wordlists/rockyou.txt john_hash_robot</strong></em><br /><br /><a href=""><img src="images/170-18.png" alt="images/170-18.png" /></a><br /><br />Thus we find the password to be <strong>abcdefghijklmnopqrstuvwxyz</strong><br /><br />We stablize the terminal with <strong>python</strong>.<br />We use <strong>su</strong> to switch to user <strong>robot</strong> using the above passord.<br /><br /><br /><br /><br /><br /><strong>Privilege Escalation</strong><br /><br /><a href=""><img src="images/170-19.png" alt="images/170-19.png" /></a><br /><br /><br />Once inside the user robot.<br />We read the 2nd flag file and then search for ways to do privilege escalation.<br />We find the setuid binaries. We find that nmap is allowed to run with SUID bit set.<br />We look at GTFObins to find a way to elevate this.<br /><br /><strong>/usr/local/bin/nmap --interactive<br />!sh</strong><br /><a href=""><img src="images/170-20.png" alt="images/170-20.png" /></a><br />Now, we can get the root flag from /root directory.<br /><br /><br />Thanks!!</div>
</body>
</html>
