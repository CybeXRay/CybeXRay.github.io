<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>AS-REP Roasting</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>AS-REP Roasting</h1><br/><strong>THM: Attacking Kerberos - Task 5</strong><br /><br /><strong>AS-REP Roasting with Rubeus</strong><br /><br />Very similar to <strong>Kerberoasting</strong>, AS-REP Roasting dumps the krbasrep5 hashes of user accounts that have <strong>Kerberos</strong> <strong>pre-authentication disabled</strong>. Unlike Kerberoasting these users do not have to be service accounts the only requirement to be able to AS-REP roast a user is the user must have pre-authentication disabled.<br /><br />We&#39;ll continue using Rubeus same as we have with kerberoasting and harvesting since Rubeus has a very simple and easy to understand command to AS-REP roast and attack users with Kerberos pre-authentication disabled. After dumping the hash from Rubeus we&#39;ll use hashcat in order to crack the krbasrep5 hash.<br /><br />There are other tools out as well for AS-REP Roasting such as kekeo and Impacket&#39;s <strong>GetNPUsers.py</strong>. Rubeus is easier to use because it automatically finds AS-REP Roastable users whereas with <strong>GetNPUsers</strong> you have to enumerate the users beforehand and know which users may be AS-REP Roastable.<br /><br /><strong>AS-REP Roasting Overview</strong> <br /><br />During pre-authentication, the users hash will be used to encrypt a timestamp that the domain controller will attempt to decrypt to validate that the right hash is being used and is not replaying a previous request. After validating the timestamp the KDC will then issue a TGT for the user. If pre-authentication is disabled you can request any authentication data for any user and the KDC will return an encrypted TGT that can be cracked offline because the KDC skips the step of validating that the user is really who they say that they are.<br /><br /><br /><strong>Dumping KRBASREP5 Hashes with Rubeus</strong><br /><br />1.) cd Downloads - navigate to the directory Rubeus is in<br />2.) <strong>Rubeus.exe asreproast</strong> - This will run the AS-REP roast command looking for vulnerable users and then dump found vulnerable user hashes.<br /><br />Or to have a hashcat format output:<br /><strong>Rubeus.exe asreproast /format:hashcat /outfile:C:Temphashes.txt</strong><br /><br /><a href=""><img src="images/146-1.png" alt="images/146-1.png" /></a><br /><br /><br /><strong>Crack those Hashes w/ hashcat</strong>  <br /><br />1.) Transfer the hash from the target machine over to your attacker machine and put the hash into a txt file<br />2.) Insert <strong>23$</strong> after $krb5asrep$ so that the first line will be $krb5asrep$23$User.....<br />Use the same wordlist that you downloaded in task 4<br />3.) <strong>hashcat -m 18200 hash.txt Pass.txt </strong>- crack those hashes! Rubeus AS-REP Roasting uses hashcat mode 18200 <br /><br /><br /><strong>AS-REP Roasting Mitigations</strong><br /><br />    ★ Have a strong password policy. With a strong password, the hashes will take longer to crack making this attack less effective<br />    ★ Don&#39;t turn off Kerberos Pre-Authentication unless it&#39;s necessary there&#39;s almost no other way to completely mitigate this attack other than keeping Pre-Authentication on.<br />   </div>
</body>
</html>
