<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>powershell enumeration</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>powershell enumeration</h1><br/><strong><h2>THM Room: Hacking with Powershell<br />Task - 4 : Enumeration</h2></strong><br /><br />The first step when you have gained initial access to any machine would be to enumerate. We&#39;ll be enumerating the following:<br />• users<br />• basic networking information<br />• file permissions<br />• registry permissions<br />• scheduled and running tasks<br />• insecure files<br /><br /><br /><strong><h3>Find All Users &amp; Groups</h3></strong><br /><br /><strong>Get-LocalUser</strong><br /><strong>Get-LocalGroup</strong><br /><br /><a href=""><img src="images/165-1.png" alt="images/165-1.png" /></a><br /><br /><br /><strong><h3>Find a user using SID</h3></strong><br /><br /><strong>Get-LocalUser -SID “Enter-SID-Here”</strong><br /><a href=""><img src="images/165-2.png" alt="images/165-2.png" /></a><br /><br /><strong><h3>Find How many users have password required set</h3></strong><br /><br />First get the members of <strong>Get-LocalUser</strong> to know what is offers, then we can use <strong>Where-Object</strong> to choose our required member.<br /><br /><strong>Get-LocalUser | Get-Member</strong><br /><a href=""><img src="images/165-3.png" alt="images/165-3.png" /></a><br /><br />We will use the <strong>PasswordRequired</strong> property in our filter.<br /><br /><strong>Get-Localuser | Where-Object -Property PasswordRequired -Match False</strong><br /><a href=""><img src="images/165-4.png" alt="images/165-4.png" /></a><br /><br /><strong><h3>How many Local Groups Exists</h3></strong><br /><br /><strong>Get-LocalGroup | Measure</strong><br /><a href=""><img src="images/165-5.png" alt="images/165-5.png" /></a><br /><br /><strong><h3>What is the IP address</h3></strong><br /><br /><strong>Get-NetIPAddress</strong><br />It lists all the IP address<br /><br />To get only Ethernet ones use the following filter<br /><strong>Get-NetIPAddress | Where-Object -Property InterfaceAlias -eq Ethernet</strong><br /><a href=""><img src="images/165-6.png" alt="images/165-6.png" /></a><br /><br /><strong><h3>How many ports are listening?</h3></strong><br /><br />We can see all TCP connections with<br /><strong>Get-NetTCPConnection</strong><br /><br />To get only listening connections use the following filter<br /><strong>Get-NetTCPConnection | Where-Object -Property State -eq Listen</strong><br />Or<br /><strong>Get-NetTCPConnection -State Listen</strong><br /><a href=""><img src="images/165-7.png" alt="images/165-7.png" /></a><br /><br /><strong><h3>How many patches have been applied?</h3></strong><br /><br /><br /><strong>Get-Hotfix<br />Get-Hotfix | Measure</strong><br /><br /><a href=""><img src="images/165-8.png" alt="images/165-8.png" /></a><br /><br /><br /><strong><h3>When was the patch with ID: KB4023834 installed?</h3></strong><br /><br /><strong>Get-HotFix | Where-Object -Property HotFixID -eq KB4023834</strong><br />Or<br /><strong>Get-Hotfix -ID KB4023834</strong><br /><br /><a href=""><img src="images/165-9.png" alt="images/165-9.png" /></a><br /><br /><br /><strong><h3>Find content of a backup file</h3></strong><br /><br />First search the file. Once found read its contents.<br /><br /><strong>Get-ChildItem -Path C:\ -Include *.bak* -File -Recurse -ErrorAction SilentlyContinue<br />Get-Content &quot;C:\Program Files (x86)\Internet Explorer\passwords.bak.txt&quot;</strong><br /><br /><a href=""><img src="images/165-10.png" alt="images/165-10.png" /></a><br /><br /><br /><strong><h3>Search for all files containing API_KEY</h3></strong><br /><br /><strong>Get-ChildItem C:\* -Recurse | Select-String -pattern API_KEY</strong><br /><br />This will open all the files in the terminal and output will be clouded.<br /><br /><strong>Get-ChildItem C:\* -Recurse | Select-String -Pattern API_KEY -List | Select Path<br />Get-ChildItem C:\* -Recurse | Select-String “API_KEY” -List | Select Path</strong><br /><strong>Get-ChildItem -Path C:\* -Recurse | Select-String “API_KEY” -List | Select Path</strong><br /><br />We can use <strong>Path</strong> for <strong>Get-ChildItem</strong> or <strong>give directly.</strong><br />We can use the search string with <strong>-Pattern</strong> or <strong>directly search</strong> with <strong>quotes</strong><br />If we don&#39;t give <strong>Select Path</strong> it will open all files.<br /><strong>-List</strong> is used so that each file is recorded only once even if it contains multiple API_KEY patterns<br /><br /><a href=""><img src="images/165-11.png" alt="images/165-11.png" /></a><br /><br />Then Read the suspicious file.<br /><br /><strong>Get-Content &lt;FIlePath&gt;</strong><br /><a href=""><img src="images/165-12.png" alt="images/165-12.png" /></a><br /><br /><br /><strong><h3>Get all the Processes</h3></strong><br /><br /><strong>Get-Process</strong>		:		To List all the processes<br /><a href=""><img src="images/165-13.png" alt="images/165-13.png" /></a><br /><br /><br /><strong><h3>Get all Scheduled Tasks</h3></strong><br /><br /><strong>Get-ScheduledTask</strong>		:		To List all the Scheduled Tasks<br /><a href=""><img src="images/165-14.png" alt="images/165-14.png" /></a><br /><br />Or<br /><br /><strong>Get-ScheduledTask -TaskName new-sched-task</strong><br /><a href=""><img src="images/165-15.png" alt="images/165-15.png" /></a><br /><br /><br /><strong><h3>Who is the owner of C:\</h3></strong><br /><br /><strong>Get-Acl C:\</strong><br /><br /><a href=""><img src="images/165-16.png" alt="images/165-16.png" /></a><br /><br /><br /></div>
</body>
</html>
