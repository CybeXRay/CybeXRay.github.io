<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Persisting Active Directory</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Persisting Active Directory</h1><br/><p><strong><h1>Persisting Active Directory</h1></strong></p><p></p><p></p><p><img src="images/356-1.png" alt="images/356-1.png" /></p><p></p><p>    </p><p> <strong><span style="text-decoration:underline;">Using Networks in Tryhackme:</span></strong></p><p></p><p>First, Download a different vpn file. Named: <strong>exploitingad.ovpn</strong> from Tryhackme</p><p></p><p>Then,</p><p> You will have to configure DNS on the host on which you are running the VPN connection. In order to configure our DNS, we must edit the<strong> /etc/systemd/resolved.conf</strong> file. Uncomment the DNS line and add the I<strong>P of THMDC</strong>: (As Shown in Network Diagram Above)</p><p> </p><p><img src="images/356-2.png" alt="images/356-2.png" /></p><p></p><p>Finally, Restart the service:</p><p></p><p><strong>systemctl restart systemd-resolved</strong></p><p></p><p>Or</p><p></p><p>Add the DNS in <strong>GUI Network Manager</strong>/<strong>nmtui</strong> tool (1st is the THM DNS then use default in the 2nd place).</p><p></p><p>and restart the Network Manager service:</p><p></p><p><strong>systemctl restart NetworkManager</strong></p><p></p><p><strong><span style="text-decoration:underline;">Testing DNS Status</span></strong></p><p></p><p><strong>nslookup thmdc.za.tryhackme.loc</strong></p><p></p><p><img src="images/356-3.png" alt="images/356-3.png" /></p><p></p><p></p><p><strong><span style="text-decoration:underline;">Requesting Your Credentials</span></strong></p><p></p><p></p><p>To simulate an AD breach, you will be provided with your first set of AD credentials. Once your networking setup has been completed, on your Attack Box, navigate to <strong>http://distributor.za.tryhackme.loc/creds</strong> to request your credential pair. Click the &quot;Get Credentials&quot; button to receive your credential pair that can be used for initial access.</p><p></p><p>This credential pair will provide you RDP and SSH access to THMWRK1.za.tryhackme.loc. THMWRK1 can be seen as a jump host into this environment, simulating a foothold that you have achieved. Jump hosts are often targeted by the red team since they provide access to a new network segment. You can use Remmina or any other similar Remote Desktop client to connect to this host for RDP. Remember to specify the domain of za.tryhackme.loc when connecting.</p><p></p><p>For SSH access, you can use the following SSH command:</p><p></p><p><strong>ssh za\\&lt;AD Username&gt;@thmwrk1.za.tryhackme.loc</strong></p><p>or</p><p><strong>ssh za.tryhackme.loc\\&lt;AD Username&gt;@thmwrk1.za.tryhackme.loc</strong></p><p></p><p><img src="images/356-4.png" alt="images/356-4.png" /></p><p></p><p></p><p><strong><h3>AD Persistence</h3></strong></p><p></p><p>During our attack against AD, we need to make sure that we deploy persistence. This will ensure that the blue team can&#39;t kick us out by simply rotating some credentials. As mentioned before, the process of compromising AD is cyclic. We would deploy persistence as we compromise the AD estate and not just at the very end. This ensures that if one of our positions gets burnt by the blue team, we have several fallbacks. In this persistence phase, we will use several techniques that can ensure our gained access cannot simply be revoked. These persistence techniques are dependent on the specific permissions and privileges we have acquired thus far.</p><p></p><p></p><p><img src="images/356-5.png" alt="images/356-5.png" /></p><p></p><p><strong><h3>Learning Objectives</h3></strong></p><p></p><p>In this network, we will cover several methods that can be used to persist in AD. This is by no means a complete list, as available methods are usually highly situational and dependent on the AD structure and environment. However, we will cover the following techniques for persisting AD:</p><p></p><p>    ▸ AD Credentials and DCSync-ing</p><p>    ▸ Silver and Golden Tickets</p><p>    ▸ AD Certificates</p><p>    ▸ AD Security Identifiers (SIDs)</p><p>    ▸ Access Control Lists</p><p>    ▸ Group Policy Objects (GPOs)</p></div>
</body>
</html>
