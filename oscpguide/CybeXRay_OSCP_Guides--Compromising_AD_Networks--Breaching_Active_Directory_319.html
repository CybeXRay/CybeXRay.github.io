<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Breaching Active Directory</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Breaching Active Directory</h1><br/><p><strong><h1>Breaching Active Directory</h1></strong></p><p></p><p>Before we can exploit AD misconfigurations for privilege escalation, lateral movement, and goal execution, you need initial access first. You need to acquire an initial set of valid AD credentials. Due to the number of AD services and features, the attack surface for gaining an initial set of AD credentials is usually significant. In this room, we will discuss several avenues, but this is by no means an exhaustive list.</p><p></p><p>When looking for that first set of credentials, we don&#39;t focus on the permissions associated with the account; thus, even a low-privileged account would be sufficient. We are just looking for a way to authenticate to AD, allowing us to do further enumeration on AD itself.</p><p></p><p></p><p><img src="images/319-1.png" alt="images/319-1.png" /></p><p></p><p><strong><span style="text-decoration:underline;">Few of the Initial Access Techniques:</span></strong><span style="text-decoration:underline;"></span></p><p><span style="text-decoration:underline;"></span></p><p>In this network, we will cover several methods that can be used to breach AD. This is by no means a complete list as new methods and  techniques are discovered every day. However, we will cover the following techniques to recover AD credentials in this network:</p><p></p><p>• NTLM Authenticated Services</p><p>• LDAP Bind Credentials</p><p>• Authentication Relays</p><p>• Microsoft Deployment Toolkit</p><p>• Configuration Files</p><p></p><p>We can use these techniques on a security assessment either by targeting systems of an organisation that are internet-facing or by implanting a rogue device on the organisation&#39;s network.</p><p></p><p><strong><span style="text-decoration:underline;">Using Networks in Tryhackme:</span></strong></p><p></p><p></p><p>First, Download a different vpn file. Named: <strong>breachingad.ovpn</strong> from Tryhackme</p><p></p><p>Then,</p><p> You will have to configure DNS on the host on which you are running the VPN connection. In order to configure our DNS, we must edit the<strong> /etc/systemd/resolved.conf</strong> file. Uncomment the DNS line and add the I<strong>P of THMDC</strong>: (As Shown in Network Diagram Above)</p><p> </p><p><img src="images/319-2.png" alt="images/319-2.png" /></p><p></p><p>Finally, Restart the service:</p><p></p><p><strong>systemctl restart systemd-resolved</strong></p><p></p><p>Or</p><p></p><p>Add the DNS in <strong>GUI Network Manager</strong>/<strong>nmtui</strong> tool (1st is the THM DNS then use default in the 2nd place).</p><p></p><p>and restart the Network Manager service:</p><p></p><p><strong>systemctl restart NetworkManager</strong></p><p></p><p></p><p><strong><span style="text-decoration:underline;">Testing DNS Status</span></strong></p><p></p><p><strong>nslookup thmdc.za.tryhackme.com</strong></p><p></p><p>We should get the IP back</p><p><img src="images/319-3.png" alt="images/319-3.png" /></p><p></p><p><strong><h2>Initial Access Methodology</h2></strong></p><p></p><p><strong><h3>A) OSINT &amp; Phishing</h3></strong></p><p><strong><h3>B) NTLM Authenticated Services</h3></strong></p><p><strong><h3>C) LDAP Bind Credentials</h3></strong></p><p><strong><h3>D) Authentication Relays</h3></strong></p><p><strong><h3>E) Microsoft Deployment Tooolkit</h3></strong></p><p><strong><h3>F) Configuration Files</h3></strong></p><p></p><p></p><p><strong><h3>Conclusion:</h3></strong></p><p></p><p>A significant amount of attack avenues can be followed to breach AD. We covered some of those commonly seen being used during a red team exercise in this network. Due to the sheer size of the attack surface, new avenues to recover that first set of AD credentials are constantly being discovered. Building a proper enumeration methodology and continuously updating it will be required to find that initial pair of credentials.</p><p></p><p><strong><span style="text-decoration:underline;">Mitigations</span></strong></p><p></p><p>In terms of mitigations, there are some steps that organisations can take:</p><p></p><p>    <strong>• User awareness and training</strong> - The weakest link in the cybersecurity chain is almost always users. Training users and making them aware that they should be careful about disclosing sensitive information such as credentials and not trust suspicious emails reduces this attack surface.</p><p>    <strong>• Limit the exposure of AD services and applications online</strong> - Not all applications must be accessible from the internet, especially those that support NTLM and LDAP authentication. Instead, these applications should be placed in an intranet that can be accessed through a VPN. The VPN can then support multi-factor authentication for added security.</p><p>    <strong>• Enforce Network Access Control (NAC)</strong> - NAC can prevent attackers from connecting rogue devices on the network. However, it will require quite a bit of effort since legitimate devices will have to be allowlisted.</p><p>    <strong>• Enforce SMB Signing</strong> - By enforcing SMB signing, SMB relay attacks are not possible.</p><p>    <strong>• Follow the principle of least privileges</strong> - In most cases, an attacker will be able to recover a set of AD credentials. By following the principle of least privilege, especially for credentials used for services, the risk associated with these credentials being compromised can be significantly reduced.</p><p></p><p>Now that we have breached AD, the next step is to perform enumeration of AD to gain a better understanding of the domain structure and identify potential misconfigurations that can be exploited. This will be covered in the next room. Remember to clear the DNS configuration!</p><p></p></div>
</body>
</html>
