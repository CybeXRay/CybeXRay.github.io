<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>powershell scripting</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>powershell scripting</h1><br/><p><strong><h2>THM Room: Hacking with Powershell</h2></strong></p><p><strong><h2>Task - 5 &amp; 6: Powershell Scripting</h2></strong></p><p></p><p>Now that we have run powershell commands, let&#39;s actually try write and run a script to do more complex and powerful actions. </p><p></p><p>For this task, we&#39;ll be using PowerShell ISE(which is the Powershell Text Editor). To show an example of this script, let&#39;s use a particular scenario. Given a list of port numbers, we want to use this list to see if the local port is listening. Open the listening-ports.ps1 script on the Desktop using Powershell ISE. Powershell scripts usually have the .ps1 file extension. </p><p></p><p><strong>$system_ports = Get-NetTCPConnection -State Listen</strong></p><p><strong></strong></p><p><strong>$text_port = Get-Content -Path C:\Users\Administrator\Desktop\ports.txt</strong></p><p><strong></strong></p><p><strong>foreach($port in $text_port){</strong></p><p><strong></strong></p><p><strong>    if($port -in $system_ports.LocalPort){</strong></p><p><strong>        echo $port</strong></p><p><strong>     }</strong></p><p><strong></strong></p><p><strong>}</strong></p><p></p><p>On the first line, we want to get a list of all the ports on the system that are listening. We do this using the Get-NetTCPConnection cmdlet. We are then saving the output of this cmdlet into a variable. The convention to create variables is used as:</p><p></p><p><strong>$variable_name = value</strong></p><p></p><p>On the next line, we want to read a list of ports from the file. We do this using the Get-Content cmdlet. Again, we store this output in the variables. The simplest next step is iterate through all the ports in the file to see if the ports are listening. To iterate through the ports in the file, we use the following</p><p></p><p><strong>foreach($new_var in $existing_var){}</strong></p><p></p><p>This particular code block is used to loop through a set of object. Once we have each individual port, we want to check if this port occurs in the listening local ports. Instead of doing another for loop, we just use an if statement with the -in operator to check if the port exists the LocalPort property of any object. A full list of if statement comparison operators can be found in the following link. To run script, just call the script path using Powershell or click the green button on Powershell ISE:</p><p></p><p>Comparision Operators: <strong>https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_comparison_operators?view=powershell-7.2&amp;viewFallbackFrom=powershell-6</strong></p><p></p><p></p><p><strong><span style="text-decoration:underline;">Script to find a string in files</span></strong></p><p><strong>$PATH = &quot;C:\Users\Administrator\Desktop\emails\*&quot;</strong></p><p><strong>$PATTERN = &quot;https://&quot;</strong></p><p><strong>$COMMAND = Get-ChildItem -Path $PATH -Recurse | Select-String -Pattern $PATTERN</strong></p><p><strong>echo $COMMAND</strong></p><p></p><p><strong><span style="text-decoration:underline;">Simple Port Scanner</span></strong><strong></strong></p><p><strong>for ($i = 130; $i -le 140; $i++){</strong></p><p><strong>    Test-NetConnection localhost -Port $i</strong></p><p><strong>}</strong></p></div>
</body>
</html>
