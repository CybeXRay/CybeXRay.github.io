<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>REMnux</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>REMnux</h1><br/><p><strong><h1>REMnux: A Linux Toolkit for Malware Analysis</h1></strong></p><p></p><p>REMnuxÂ® is a Linux toolkit for reverse-engineering and analyzing malicious software. REMnux provides a curated collection of free tools created by the community. Analysts can use it to investigate malware without having to find, install, and configure the tools. </p><p></p><p></p><p><strong><h2>peepdf</h2></strong></p><p></p><p>Used to analyze malicious pdf documents to check for javascript &amp; other contents.</p><p></p><p><span style="text-decoration:underline;">Command</span>: <strong>peepdf &lt;filename&gt;</strong></p><p></p><p><img src="images/303-1.png" alt="images/303-1.png" /></p><p></p><p>As we can see above, there is 1 object with javascript code.</p><p>To extract the javascript code without actually running the pdf, we need to use the <strong>extract</strong> module of <strong>peepdf</strong></p><p></p><p><strong><span style="text-decoration:underline;">Extracting Javascript Code</span></strong></p><p>The script to extract the code is put into a text file. (This file will be used by peepdf)</p><p></p><p><strong>echo &#39;extract js &gt; javascript-notsuspicious.pdf&#39; &gt; extracted_javascript.txt</strong></p><p></p><p><img src="images/303-2.png" alt="images/303-2.png" /></p><p></p><p>Then run,</p><p><strong>peepdf -s extracted_javascript.txt notsuspicious.pdf</strong></p><p></p><p>As per our script, this will extract the javascript code into <strong>javascript-notsuspicious.pdf</strong></p><p>Lets view it using <strong>cat</strong>.</p><p></p><p><img src="images/303-3.png" alt="images/303-3.png" /></p><p></p><p></p><p>Note: Along with javascript, executibles can also be embedded in a PDF.</p><p></p><p></p><p><strong><h2>Analysing Malicious Microsoft Office Macros</h2></strong><h2>                         </h2></p><p></p><p>Malware infection via malicious macros (or scripts within Microsoft Office products such as Word and Excel) are some of the most successful attacks to date.</p><p></p><p>For example, current APT campaigns such as Emotet, QuickBot infect users by sending seemingly legitimate documents attached to emails i.e. an invoice for business. However, once opened, execute malicious code without the user knowing. This malicious code is often used in what&#39;s known as a &quot;<strong>dropper attack</strong>&quot;, where additional malicious programs are downloaded onto the host.</p><p></p><p><strong>Example Malicious VB Code</strong></p><p><img src="images/303-4.png" alt="images/303-4.png" /></p><p></p><p><strong><h2>vmonkey</h2></strong></p><p></p><p>First, we will analyse a suspicious Microsoft Office Word document together. We can simply use REMnux&#39;s <strong>vmonkey</strong> which is a parser engine that is capable of analysing visual basic macros without executing (opening the document).</p><p></p><p><span style="text-decoration:underline;">Usage</span>: <strong>vmonkey &lt;filename&gt;</strong></p><p></p><p><img src="images/303-5.png" alt="images/303-5.png" /></p><p></p><p></p><p><img src="images/303-6.png" alt="images/303-6.png" /></p><p></p><p></p><p><strong><h2>File Entropy</h2></strong></p><p></p><p>REMnux provides a nice range of command-line tools that allow for bulk or semi-automated classification and static analysis. File entropy is very indicative of the suspiciousness of a file and is a prominent characteristic that these tools look for within a Portable Executable (PE).</p><p></p><p>At it&#39;s very simplest, file entropy is a rating that scores how random the data within a PE file is. With a scale of 0 to 8. 0 meaning the less &quot;randomness&quot; of the data in the file, where a scoring towards 8 indicates this data is more &quot;random&quot;.</p><p></p><p>For example, files that are encrypted will have a very high entropy score. Where files that have large chunks of the same data such as &quot;1&#39;s&quot; will have a low entropy score.</p><p></p><p><strong>How its Relevant ?</strong></p><p></p><p>Malware authors use techniques such as encryption or packing to obfuscate their code and to attempt to bypass anti-virus. Because of this, these files will have high entropy. If an analyst had 1,000 files, they could rank the files by their entropy scoring, of course, the files with the higher entropy should be analysed first.</p><p></p><p></p><p><strong><span style="text-decoration:underline;">Packing and Unpacking</span></strong></p><p></p><p>We&#39;ll start with a bit of theory on how packing works and why it&#39;s used. Packer&#39;s use an executable as a source and output&#39;s it to another executable. This executable will have had some modifications made depending on the packer. For example, the new executable could be compressed and/or obfuscated by using mathematics.</p><p></p><p>Legitimate software developers use packing to reduce the size of their applications and to ultimately protect their work from being stolen. It is, however, a double-edged sword, malware authors reap the benefits of packing to make the reverse engineering and detection of the code hard to impossible.</p><p></p><p><strong>Theory</strong></p><p>Executables have what&#39;s called an entry point. When launched, this entry point is simply the location of the first pieces of code to be executed within the file - as illustrated below:</p><p></p><p><img src="images/303-7.png" alt="images/303-7.png" /></p><p></p><p>When an executable is packed, it must unpack itself before any code can execute. Because of this, packers change the entry point from the original location to what&#39;s called the &quot;Unpacking Stub&quot;.</p><p></p><p><img src="images/303-8.png" alt="images/303-8.png" /></p><p></p><p>The &quot;Unpacking Stub&quot; will begin to unpack the executable into its original state. Once the program is fully unpacked, the entry point will now relocate back to its normal place to begin executing code:</p><p></p><p><img src="images/303-9.png" alt="images/303-9.png" /></p><p></p><p>It is only at this point can an analyst begin to understand what the executable is doing as it is now in it&#39;s true, original form.</p><p></p><p><strong>Determining Packed Files</strong></p><p>Packed files have a few characteristics that may indicate whether or not they are packed:</p><p></p><p>    -Remember about file entropy? Packed files will have a high entropy!</p><p>    -There are very few &quot;Imports&quot;, packed files may only have &quot;GetProcAddress&quot; and &quot;LoadLibrary&quot;.</p><p>    -The executable may have sections named after certain packers such as UPX.</p><p>    </p><p>Also we can check with tools like PEID.</p></div>
</body>
</html>
