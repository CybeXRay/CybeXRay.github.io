<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Kerberos Backdoor</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Kerberos Backdoor</h1><br/><p><strong>THM: Attacking Kerberos - Task 8</strong></p><p><strong>Kerberos Backdoor with Mimikatz</strong></p><p></p><p>Along with maintaining access using golden and silver tickets mimikatz has one other trick up its sleeves when it comes to attacking Kerberos. Unlike the golden and silver ticket attacks a <strong>Kerberos backdoor</strong> is much more subtle because it acts similar to a <strong>rootkit by implanting</strong> itself into the <strong>memory of the domain forest</strong> allowing itself access to any of the machines with a <strong>master password</strong>. </p><p></p><p>The Kerberos backdoor works by implanting a skeleton key that abuses the way that the AS-REQ validates encrypted timestamps. A skeleton key only works using Kerberos RC4 encryption. </p><p></p><p>The <strong>default</strong> hash for a <strong>mimikatz skeleton key</strong> is <strong>60BA4FCADC466C7A033C178194C03DF6</strong> which makes the password -&quot;<strong>mimikatz</strong>&quot;</p><p></p><p>This will only be an overview section and will not require you to do anything on the machine however I encourage you to continue yourself and add other machines and test using skeleton keys with mimikatz.</p><p></p><p><strong>Skeleton Key Overview</strong></p><p></p><p>The skeleton key works by abusing the AS-REQ encrypted timestamps as I said above, the timestamp is encrypted with the users NT hash. The domain controller then tries to decrypt this timestamp with the users NT hash, once a skeleton key is implanted the domain controller tries to decrypt the timestamp using both the user NT hash and the skeleton key NT hash allowing you access to the domain forest.</p><p></p><p></p><p><strong>Preparing Mimikatz</strong></p><p></p><p>1.) <strong>cd Downloads &amp;&amp; mimikatz.exe</strong> - Navigate to the directory mimikatz is in and run mimikatz</p><p></p><p>2.) <strong>privilege::debug</strong> - This should be a standard for running mimikatz as mimikatz needs local administrator access</p><p></p><p></p><p>I<strong>nstalling the Skeleton Key w/ mimikatz</strong></p><p></p><p>1.) <strong>misc::skeleton</strong> - Yes! that&#39;s it but don&#39;t underestimate this small command it is very powerful</p><p></p><p></p><p><strong>Accessing the forest</strong></p><p></p><p>The default credentials will be: &quot;<strong>mimikatz</strong>&quot;</p><p></p><p><strong>example:</strong> net use c:\\DOMAIN-CONTROLLER\admin$ /user:Administrator mimikatz - The share will now be accessible without the need for the Administrators password</p><p></p><p><strong>example:</strong> dir \\Desktop-1\c$ /user:Machine1 mimikatz - access the directory of Desktop-1 without ever knowing what users have access to Desktop-1</p><p></p><p>The skeleton key will not persist by itself because it runs in the memory, it can be scripted or persisted using other tools and techniques however that is out of scope for this room.</p></div>
</body>
</html>
