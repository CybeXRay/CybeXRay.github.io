<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>powershell enumeration</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>powershell enumeration</h1><br/><p><strong><h2>THM Room: Hacking with Powershell</h2></strong></p><p><strong><h2>Task - 4 : Enumeration</h2></strong></p><p></p><p>The first step when you have gained initial access to any machine would be to enumerate. We&#39;ll be enumerating the following:</p><p>• users</p><p>• basic networking information</p><p>• file permissions</p><p>• registry permissions</p><p>• scheduled and running tasks</p><p>• insecure files</p><p></p><p></p><p><strong><h3>Find All Users &amp; Groups</h3></strong></p><p></p><p><strong>Get-LocalUser</strong></p><p><strong>Get-LocalGroup</strong></p><p></p><p><img src="images/165-1.png" alt="images/165-1.png" /></p><p></p><p></p><p><strong><h3>Find a user using SID</h3></strong></p><p></p><p><strong>Get-LocalUser -SID “Enter-SID-Here”</strong></p><p><img src="images/165-2.png" alt="images/165-2.png" /></p><p></p><p><strong><h3>Find How many users have password required set</h3></strong></p><p></p><p>First get the members of <strong>Get-LocalUser</strong> to know what is offers, then we can use <strong>Where-Object</strong> to choose our required member.</p><p></p><p><strong>Get-LocalUser | Get-Member</strong></p><p><img src="images/165-3.png" alt="images/165-3.png" /></p><p></p><p>We will use the <strong>PasswordRequired</strong> property in our filter.</p><p></p><p><strong>Get-Localuser | Where-Object -Property PasswordRequired -Match False</strong></p><p><img src="images/165-4.png" alt="images/165-4.png" /></p><p></p><p><strong><h3>How many Local Groups Exists</h3></strong></p><p></p><p><strong>Get-LocalGroup | Measure</strong></p><p><img src="images/165-5.png" alt="images/165-5.png" /></p><p></p><p><strong><h3>What is the IP address</h3></strong></p><p></p><p><strong>Get-NetIPAddress</strong></p><p>It lists all the IP address</p><p></p><p>To get only Ethernet ones use the following filter</p><p><strong>Get-NetIPAddress | Where-Object -Property InterfaceAlias -eq Ethernet</strong></p><p><img src="images/165-6.png" alt="images/165-6.png" /></p><p></p><p><strong><h3>How many ports are listening?</h3></strong></p><p></p><p>We can see all TCP connections with</p><p><strong>Get-NetTCPConnection</strong></p><p></p><p>To get only listening connections use the following filter</p><p><strong>Get-NetTCPConnection | Where-Object -Property State -eq Listen</strong></p><p>Or</p><p><strong>Get-NetTCPConnection -State Listen</strong></p><p><img src="images/165-7.png" alt="images/165-7.png" /></p><p></p><p><strong><h3>How many patches have been applied?</h3></strong></p><p></p><p></p><p><strong>Get-Hotfix</strong></p><p><strong>Get-Hotfix | Measure</strong></p><p></p><p><img src="images/165-8.png" alt="images/165-8.png" /></p><p></p><p></p><p><strong><h3>When was the patch with ID: KB4023834 installed?</h3></strong></p><p></p><p><strong>Get-HotFix | Where-Object -Property HotFixID -eq KB4023834</strong></p><p>Or</p><p><strong>Get-Hotfix -ID KB4023834</strong></p><p></p><p><img src="images/165-9.png" alt="images/165-9.png" /></p><p></p><p></p><p><strong><h3>Find content of a backup file</h3></strong></p><p></p><p>First search the file. Once found read its contents.</p><p></p><p><strong>Get-ChildItem -Path C:\ -Include *.bak* -File -Recurse -ErrorAction SilentlyContinue</strong></p><p><strong>Get-Content &quot;C:\Program Files (x86)\Internet Explorer\passwords.bak.txt&quot;</strong></p><p></p><p><img src="images/165-10.png" alt="images/165-10.png" /></p><p></p><p></p><p><strong><h3>Search for all files containing API_KEY</h3></strong></p><p></p><p><strong>Get-ChildItem C:\* -Recurse | Select-String -pattern API_KEY</strong></p><p></p><p>This will open all the files in the terminal and output will be clouded.</p><p></p><p><strong>Get-ChildItem C:\* -Recurse | Select-String -Pattern API_KEY -List | Select Path</strong></p><p><strong>Get-ChildItem C:\* -Recurse | Select-String “API_KEY” -List | Select Path</strong></p><p><strong>Get-ChildItem -Path C:\* -Recurse | Select-String “API_KEY” -List | Select Path</strong></p><p></p><p>We can use <strong>Path</strong> for <strong>Get-ChildItem</strong> or <strong>give directly.</strong></p><p>We can use the search string with <strong>-Pattern</strong> or <strong>directly search</strong> with <strong>quotes</strong></p><p>If we don&#39;t give <strong>Select Path</strong> it will open all files.</p><p><strong>-List</strong> is used so that each file is recorded only once even if it contains multiple API_KEY patterns</p><p></p><p><img src="images/165-11.png" alt="images/165-11.png" /></p><p></p><p>Then Read the suspicious file.</p><p></p><p><strong>Get-Content &lt;FIlePath&gt;</strong></p><p><img src="images/165-12.png" alt="images/165-12.png" /></p><p></p><p></p><p><strong><h3>Get all the Processes</h3></strong></p><p></p><p><strong>Get-Process</strong>		:		To List all the processes</p><p><img src="images/165-13.png" alt="images/165-13.png" /></p><p></p><p></p><p><strong><h3>Get all Scheduled Tasks</h3></strong></p><p></p><p><strong>Get-ScheduledTask</strong>		:		To List all the Scheduled Tasks</p><p><img src="images/165-14.png" alt="images/165-14.png" /></p><p></p><p>Or</p><p></p><p><strong>Get-ScheduledTask -TaskName new-sched-task</strong></p><p><img src="images/165-15.png" alt="images/165-15.png" /></p><p></p><p></p><p><strong><h3>Who is the owner of C:\</h3></strong></p><p></p><p><strong>Get-Acl C:\</strong></p><p></p><p><img src="images/165-16.png" alt="images/165-16.png" /></p><p></p><p></p></div>
</body>
</html>
