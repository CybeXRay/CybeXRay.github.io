<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>evil-winrm</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>evil-winrm</h1><br/><p>Used for Windows Remote Management Exploitation.</p><p></p><p><a href="https://github.com/Hackplayers/evil-winrm">https://github.com/Hackplayers/evil-winrm</a></p><p></p><p>gem install evil-winrm</p><p></p><p><img src="images/67-1.png" alt="images/67-1.png" /></p><p></p><p><strong>For Prevelege Escalation :</strong></p><p></p><p>To list all processes</p><p></p><p>Get-Process</p><p></p><p>To get details of a particular process. Say eg.Firefox Browser</p><p></p><p>Get-Process -name firefox</p><p></p><p><img src="images/67-2.png" alt="images/67-2.png" /></p><p></p><p>We will use the &quot;procdump&quot; utility of microsoft to dump the process data from memory and look for passwords. </p><p></p><p><a href="https://docs.microsoft.com/en-us/sysinternals/downloads/procdump">https://docs.microsoft.com/en-us/sysinternals/downloads/procdump</a></p><p></p><p>Note: The “procdump” has to be uploaded to the target server</p><p></p><p></p><p><img src="images/67-3.png" alt="images/67-3.png" /></p><p></p><p>We need to use the -ma flag to dump the entire memory of the process.</p><p>The process ID we found should be used here.</p><p></p><p><img src="images/67-4.png" alt="images/67-4.png" /></p><p></p><p>Note: -accepteula is ONLY required the first time the program is run.</p><p></p><p></p><p>We can start an SMB server locally to transfer this file.</p><p></p><p>smbserver.py -smb2support -username guest -password guest share /root/htb</p><p></p><p>The server will use the credentials ​guest / guest ​for authentication.</p><p></p><p>Then in target windows machine use the following to mount the samba share &amp; copy the dump into it.</p><p></p><p><img src="images/67-5.png" alt="images/67-5.png" /></p><p></p><p><strong>By Seeing the Test Login in BurpSuite:</strong></p><p>The page used login_password as the parameter to submit passwords. We can search the dump</p><p>for strings like “login_password” to find any requests.</p><p></p><p></p><p>Now we parse the file locally </p><p><img src="images/67-6.png" alt="images/67-6.png" /></p><p><img src="images/67-7.png" alt="images/67-7.png" /></p><p></p><p></p><p>Then we use psexec to login as administrator.</p><p></p><p><img src="images/67-8.png" alt="images/67-8.png" /></p><p></p><p></p><p>We can also use evil-winrm for admin logins as follows: (Required in cases where no smb service running. “psexec.py uses smb”)</p><p></p><p><img src="images/67-9.png" alt="images/67-9.png" /></p><p></p><p></p><p></p><p><strong>To use evil-winrm to use password hash</strong></p><p>Use the -H option</p><p></p><p><strong>evil-winrm -i 10.10.11.113 -u administrator -H 0e0363213e37b94221497260b0bcb4fc</strong></p><p></p><p><img src="images/67-10.png" alt="images/67-10.png" /></p></div>
</body>
</html>
