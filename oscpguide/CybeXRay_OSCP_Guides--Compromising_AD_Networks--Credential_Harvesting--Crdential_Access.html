<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Crdential Access</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Crdential Access</h1><br/><strong><h1>Credential Access</h1></strong><br /><br />Credential access is where adversaries may find credentials in compromised systems and gain access to user credentials. It helps adversaries to reuse them or impersonate the identity of a user. This is an important step for lateral movement and accessing other resources such as other applications or systems. Obtaining legitimate user credentials is preferred rather than exploiting systems using CVEs.<br /><br />Credentials are stored insecurely in various locations in systems:<br /><br />    • Clear-text files<br />    • Database files<br />    • Memory<br />    • Password managers<br />    • Enterprise Vaults<br />    • Active Directory<br />    • Network Sniffing<br /><br />Let&#39;s discuss them a bit more!<br /><br /><br /><strong><h3>1. Clear-text Files</h3></strong><br /><br />Attackers may search a compromised machine for credentials in local or remote file systems. Clear-text files could include sensitive information created by a user, containing passwords, private keys, etc. The MITRE ATT&amp;CK framework defines it as <strong>Unsecured Credentials: Credentials In Files</strong><br /><br />The following are some of the types of clear-text files that an attacker may be interested in:<br /><br />    • Commands history<br />    • Configuration files (Web App, FTP files, etc.)<br />    • Other Files related to Windows Applications (Internet Browsers, Email Clients, etc.)<br />    • Backup files<br />    • Shared files and folders<br />    • Registry<br />    • Source code <br />    <br />As an example of a history command, a PowerShell saves executed <strong>PowerShell</strong> commands in a <strong>history</strong> file in a user profile in the following path: <br /><br /><strong>C:\Users\USER\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt</strong><br /><br />It might be worth checking what users are working on or finding sensitive information. Another example would be finding interesting information. For example, the following command is to look for the <strong>&quot;password&quot;</strong> keyword in the <strong>Window registry</strong>.<br /><br />c:\Users\user&gt; <strong>reg query HKLM /f password /t REG_SZ /s</strong><br />OR<br />C:\Users\user&gt; <strong>reg query HKCU /f password /t REG_SZ /s</strong><br /><br />        <br /><strong><h3>2. Database Files</h3></strong><br /><br />Applications utilize database files to read or write settings, configurations, or credentials. Database files are usually stored locally in Windows operating systems. These files are an excellent target to check and hunt for credentials. For more information, we suggest checking <strong>THM room: Breaching AD</strong>. It contains a showcase example of extracting credentials from the local McAfee Endpoint database file.<br /><br /><br /><strong><h3>3. Password Managers</h3></strong><br /><br />A password manager is an application to store and manage users&#39; login information for local and Internet websites and services. Since it deals with users&#39; data, it must be stored securely to prevent unauthorized access. <br /><br />Examples of Password Manager applications:<br /><br />    • Built-in password managers (Windows)<br />    • Third-party: KeePass, 1Password, LastPass<br /><br />However, misconfiguration and security flaws are found in these applications that let adversaries access stored data. Various tools could be used during the enumeration stage to get sensitive data in password manager applications used by Internet browsers and desktop applications. <br /><br />This room will discuss how to access the Windows Credentials manager and extract passwords.<br /><br /><br /><strong><h3>4. Memory Dump</h3></strong><br /><br />The Operating system&#39;s memory is a rich source of sensitive information that belongs to the Windows OS, users, and other applications. Data gets loaded into memory at run time or during the execution. Thus, accessing memory is limited to administrator users who fully control the system.<br /><br />The following are examples of memory stored sensitive data, including:<br /><br />    • Clear-text credentials<br />    • Cached passwords<br />    • AD Tickets<br /><br />In this room, we will discuss how to get access to memory and extract clear-text passwords and authentication tickets.<br /><br /><br /><strong><h3>Active Directory</h3></strong><br /><br />Active Directory stores a lot of information related to users, groups, computers, etc. Thus, enumerating the Active Directory environment is one of the focuses of red team assessments. Active Directory has a solid design, but misconfiguration made by admins makes it vulnerable to various attacks shown in this room.<br /><br />The following are some of the Active Directory misconfigurations that may leak users&#39; credentials.<br /><br />    <strong>• Users&#39; description: </strong>Administrators set a password in the description for new employees and leave it there, which makes the account vulnerable to unauthorized access. <br />    <strong>• Group Policy SYSVOL:</strong> Leaked encryption keys let attackers access administrator accounts. Check Task 8 for more information about the vulnerable version of SYSVOL.<br />    <strong>• NTDS:</strong> Contains AD users&#39; credentials, making it a target for attackers.<br />    <strong>• AD Attacks:</strong> Misconfiguration makes AD vulnerable to various attacks, which we will discuss in Task 9.<br />    <br />    <br /><strong><h3>Network Sniffing</h3></strong><br /><br />Gaining initial access to a target network enables attackers to perform various network attacks against local computers, including the AD environment. The Man-In-the-Middle attack against network protocols lets the attacker create a rogue or spoof trusted resources within the network to steal authentication information such as NTLM hashes.<br /><br /><br /><br /><strong><h3>Room Task</h3></strong><br /><br /><strong>reg query HKLM /f flag /t REG_SZ /s</strong><br /><br /><img src="images/368-1.png" alt="images/368-1.png" /><br /><br /><br />Run <strong>mmc</strong> in cmd<br /><strong>File</strong> --→ <strong>Add/Remove Snap in</strong> --→ <strong>Add Active Directory Users &amp; Computers</strong><br />Then look for user descriptions in Domain Controllers.<br /><br /><img src="images/368-2.png" alt="images/368-2.png" /><br /><br />Or<br /><br /><strong>Get-ADUser -Filter * -Properties * | select Name,SamAccountName,Description</strong><br /><br /><img src="images/368-3.png" alt="images/368-3.png" /></div>
</body>
</html>
