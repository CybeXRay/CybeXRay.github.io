<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>wireshark</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>wireshark</h1><br/><p><strong><h1>Wireshark</h1></strong></p><p></p><p></p><p>Wireshark, a tool used for creating and analyzing PCAPs (network packet capture files), is commonly used as one of the best packet analysis tools.</p><p></p><p></p><p><strong><h3>External (Capture Filter)</h3></strong></p><p></p><p><em><strong>https://wiki.wireshark.org/CaptureFilters</strong></em></p><p></p><p></p><p></p><p><strong><h3>Collection Methods Overview</h3></strong></p><p></p><p>Some things to think about before going headfirst into attempting to collect and monitor live packet captures.</p><p></p><p>    Begin by starting with a sample capture to ensure that everything is correctly set up and you are successfully capturing traffic.</p><p>    Ensure that you have enough compute power to handle the number of packets based on the size of the network, this will obviously vary network by network.</p><p>    Ensure enough disk space to store all of the packet captures.</p><p></p><p>Once you meet all these criteria and have a collection method picked out you can begin to actively monitor and collect packets on a network.</p><p></p><p></p><p><strong><h4>Network Taps</h4></strong></p><p></p><p>Network taps are a physical implant in which you physically tap between a cable, these techniques are commonly used by Threat Hunting/DFIR teams and red teams in an engagement to sniff and capture packets.</p><p></p><p>There are two primary means of tapping a wire. The first is by using hardware to tap the wire and intercept the traffic as it comes across, an example of this would be a vampire tap as pictured below.</p><p></p><p><img src="images/254-1.png" alt="images/254-1.png" /></p><p></p><p>Another option for planting a network tap would be an inline network tap, which you would plant between or &#39;inline&#39; two network devices. The tap will replicate packets as they pass the tap. An example of this tap would be the very common Throwing Star LAN Tap</p><p></p><p></p><p></p><p><strong><h4>MAC Floods </h4></strong></p><p></p><p>MAC Floods are a tactic commonly used by red teams as a way of actively sniffing packets. MAC Flooding is intended to stress the switch and fill the CAM table. Once the CAM table is filled the switch will no longer accept new MAC addresses and so in order to keep the network alive, the switch will send out packets to all ports of the switch.</p><p></p><p><img src="images/254-2.png" alt="images/254-2.png" /></p><p></p><p>Note: This technique should be used with extreme caution and with explicit prior consent.</p><p></p><p></p><p><strong><h4>ARP Poisoning</h4></strong></p><p></p><p>ARP Poisoning is another technique used by red teams to actively sniff packets. By ARP Poisoning you can redirect the traffic from the host(s) to the machine you&#39;re monitoring from. This technique will not stress network equipment like MAC Flooding however should still be used with caution and only if other techniques like network taps are unavailable.</p><p></p><p></p><p><strong><h3>Filtering Captures (Display Filter)</h3></strong></p><p></p><p>Packet Filtering is a very important part of packet analysis  especially when you have a very large number of packet sometimes even  100,000 plus. In task 3 capture filters were briefly covered however  there is a second type of filter that is often thought of as more  powerful and easier to use. This second method is known as display  filters, you can apply display filters in two ways: through the analyze  tab and at the filter bar at the top of the packet capture.</p><p></p><p>Display Filter Documentation:<strong> https://www.wireshark.org/docs/wsug_html_chunked/ChWorkBuildDisplayFilterSection.html</strong></p><p></p><p><strong><h4>Filtering Operators</h4></strong></p><p>Wireshark&#39;s  filter syntax can be simple to understand making it easy to get a hold  of quickly. To get the most out of these filters you need to have a  basic understanding of boolean and logic operators.</p><p>Wireshark only has a few that you will need to be familiar with:</p><p></p><p>• and - operator: and / &amp;&amp;</p><p>• or - operator: or / ||</p><p>• equals - operator: eq / ==</p><p>• not equal - operator: ne / !=</p><p>• greater than - operator: gt /  &gt;</p><p>• less than - operator: lt / &lt;</p><p></p><p>Wireshark  also has a few other operators that go beyond the power of normal  logical operators. These operators are the contains, matches, and  bitwise_and operators. These operators can be very useful when you have a  large capture and need to pinpoint a single packet. They are out of  scope for this room however I recommend doing your own research, the Wireshark Filtering Documentation can be a great starting point.</p><p></p><p></p><p><strong><h4>Basic Filtering</h4></strong></p><p>Filtering  gives us a very large scope of what we can do with the packets, because  of this there can be a lot of different filtering syntax options. We  will only be covering the very basics in this room such as filtering by  IP, protocol, etc.</p><p></p><p>There  is a general syntax to the filter commands however they can be a little  silly at times. The basic syntax of Wireshark filters is some kind of  service or protocol like ip or tcp, followed by a dot then whatever is  being filtered for example an address, MAC, SRC, protocol, etc.</p><p>Filtering  by IP: The first filter we will look at is ip.addr, this filter will  allow you to comb through the traffic and only see packets with a  specific IP address contained in those packets, whether it be from the  source or destination. </p><p></p><p><strong>Syntax: ip.addr == &lt;IP Address&gt;</strong></p><p></p><p><img src="images/254-3.png" alt="images/254-3.png" /></p><p></p><p></p><p></p><p>This  filter can be handy in practical applications, say when you are threat  hunting, and have identified a potentially suspicious host with other  tools, you can use Wireshark to further analyze the packets coming from  that device.</p><p>Filtering by SRC and DST: The second filter will look  at is two in one as well as a filter operator: ip.src and ip.dst. These  filters allow us to filter the traffic by the source and destination  from which the traffic is coming from.</p><p></p><p><strong>Syntax: ip.src == &lt;SRC IP Address&gt; and ip.dst == &lt;DST IP Address&gt; </strong></p><p></p><p><img src="images/254-4.png" alt="images/254-4.png" /></p><p></p><p></p><p></p><p>Similar  to the first filter we can see that Wireshark is combing through the  packets and filtering based on the source and destination we set.</p><p>Filtering by TCP  Protocols: The last filter that we will be covering is the protocol  filter, this allows you to set a port or protocol to filter by and can  be handy when trying to keep track of an unusual protocol or port being  used.</p><p>It is worthwhile to mention that Wireshark can filter by both port numbers as well as protocol names.</p><p></p><p><strong>Syntax: tcp.port eq &lt;Port #&gt; or &lt;Protocol Name&gt;</strong></p><p></p><p><img src="images/254-5.png" alt="images/254-5.png" /></p><p></p><p></p><p></p><p>Filtering by UDP Protocols: You can also filter by UDP ports by changing the prefix from tcp to udp</p><p><strong>Syntax: udp.port eq &lt;Port #&gt; or &lt;Protocol Name&gt;</strong><small></small></p><p><small></small></p><p></p><p><strong>Example For ARP Packet Filtering</strong></p><p></p><p><strong>Filter:</strong></p><p>arp									--	Shows all ARP Packets</p><p>arp.opcode==1				--	Shows only ARP Requests</p><p>arp.opcode==2				--	Shows only ARP Reply</p><p></p><p><strong>Note:</strong></p><p>TCP  can give useful insight into a network when analyzing however it can  also be hard to analyze due to the number of packets it sends. This is  where you may need to use other tools like <strong>RSA NetWitness</strong> and  <strong>NetworkMiner</strong> to filter out and further analyze the captures.</p><p></p><p></p><p><strong><h3>Packet Disection</h3></strong></p><p></p><p>This section covers how  Wireshark uses OSI layers to break down packets and how to use these  layers for analysis. It is expected that you already have background  knowledge of what the OSI model is and how it works.</p><p></p><p>OSI Model</p><p><img src="images/254-6.png" alt="images/254-6.png" /></p><p></p><p></p><p></p><p><strong><h4>Packet Details</h4></strong></p><p>You  can double click on a packet in capture to open its details. Packets  consist of 5 to 7 layers based on the OSI model. We will go over all of  them in an HTTP packet from a sample capture.</p><p></p><p><img src="images/254-7.png" alt="images/254-7.png" /></p><p></p><p></p><p></p><p>Looking  above we can see 7 distinct layers to the packet: frame/packet, source  [MAC], source [IP], protocol, protocol errors, application protocol, and  application data. Below we will go over the layers in more detail.</p><p></p><p>◇ Frame (Layer 1) -- This will show you what frame / packet you are looking at as well as details specific to the Physical layer of the OSI model.</p><p></p><p><img src="images/254-8.png" alt="images/254-8.png" /></p><p></p><p>◇ Source [MAC] (Layer 2) -- This will show you the source and destination MAC Addresses; from the Data Link layer of the OSI model.</p><p></p><p><img src="images/254-9.png" alt="images/254-9.png" /></p><p></p><p>◇ Source [IP] (Layer 3) -- This will show you the source and destination IPv4 Addresses; from the Network layer of the OSI model.</p><p></p><p><img src="images/254-10.png" alt="images/254-10.png" /></p><p></p><p>◇ Protocol (Layer 4) -- This will show you details of the protocol used (UDP/TCP) along with source and destination ports; from the Transport layer of the OSI model.</p><p></p><p><img src="images/254-11.png" alt="images/254-11.png" /></p><p></p><p>◇ Protocol Errors -- This is a continuation of the 4th layer showing specific segments from TCP that needed to be reassembled.</p><p></p><p><img src="images/254-12.png" alt="images/254-12.png" /></p><p></p><p>◇ Application Protocol (Layer 5) -- This will show details specific to the protocol being used such HTTP, FTP, SMB, etc. From the Application layer of the OSI model.</p><p></p><p><img src="images/254-13.png" alt="images/254-13.png" /></p><p></p><p>◇ Application Data -- This is an extension of layer 5 that can show the application-specific data.</p><p></p><p><img src="images/254-14.png" alt="images/254-14.png" /></p><p></p><p></p><p><strong><h3>Wireshark Features (HTTP Traffic)</h3></strong></p><p></p><p>Used for HTTP</p><p></p><p><strong>Note:</strong></p><p>A very useful feature in Wireshark to organize the <strong>protocols</strong> present in a capture the Protocol Hierarchy. Navigate to <strong>Statistics &gt; Protocol Hierarchy</strong>.</p><p></p><p><strong>Note:</strong></p><p>The next feature in Wireshark we will look at is the <strong>Export HTTP  Object</strong>. This feature will allow us to organize all requested URIs in  the capture. To use Export HTTP Object navigate to <strong>file &gt; Export  Objects &gt; HTTP.</strong></p><p></p><p><strong>Note:</strong></p><p>The last feature we will cover in this section of this room is <strong>Endpoints</strong>. This feature allows the user to organize all endpoints and IPs found within a specific capture. Just like the other features, this can be useful to identify where a discrepancy is originating from. To use the Endpoints feature navigate to <strong>Statistics &gt; Endpoints</strong>.</p><p></p><p></p><p><strong><h3>Wireshark HTTPS Traffic</h3></strong></p><p></p><p>HTTPS Traffic Overview</p><p></p><p>Before sending encrypted information the client and server need to agree upon various steps in order to make a secure tunnel.</p><p></p><p>    Client and server agree on a protocol version</p><p>    Client and server select a cryptographic algorithm</p><p>    The client and server can authenticate to each other; this step is optional</p><p>    Creates a secure tunnel with a public key</p><p></p><p></p><p><strong>Note:</strong></p><p>You can use an RSA key in Wireshark in order  to view the data unencrypted. In order to load an RSA key navigate to  Edit &gt; Preferences &gt; Protocols &gt; TLS &gt;  [+] . If you are  using an older version of Wireshark then this will be SSL instead of  TLS. You will need to fill in the various sections on the menu with the  following preferences:</p><p><strong></strong></p><p><strong></strong><strong>IP Address: 127.0.0.1</strong><strong></strong></p><p><strong></strong><strong>Port: start_tls</strong><strong></strong></p><p><strong></strong><strong>Protocol: http</strong><strong></strong></p><p><strong></strong><strong>Keyfile: RSA key location</strong></p><p></p><p></p><p><img src="images/254-15.png" alt="images/254-15.png" /></p><p></p><p></p><p>Now  that we have an RSA key imported into Wireshark, if we go back to the packet capture we can see that the data stream is now unencrypted (HTTP).</p></div>
</body>
</html>
