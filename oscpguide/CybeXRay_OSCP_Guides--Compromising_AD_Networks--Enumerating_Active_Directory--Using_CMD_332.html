<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Using CMD</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Using CMD</h1><br/><p><strong><h1>Enumeration Through Command Prompt</h1></strong></p><p></p><p>There are times when you just need to perform a quick and dirty AD lookup, and Command Prompt has your back. Good ol&#39; reliable CMD is handy when you perhaps don&#39;t have RDP access to a system, defenders are monitoring for PowerShell use, and you need to perform your AD Enumeration through a Remote Access Trojan (RAT). It can even be helpful to embed a couple of simple AD enumeration commands in your phishing payload to help you gain the vital information that can help you stage the final attack.</p><p></p><p>CMD has a built-in command that we can use to enumerate information about AD, namely <strong>net</strong>. The <strong>net</strong> command is a handy tool to enumerate information about the local system and AD. We will look at a couple of interesting things we can enumerate from this position, but this is not an exhaustive list.</p><p><strong></strong></p><p><strong>Note: </strong>For this task you will have to use <strong>THMJMP1</strong> and won&#39;t be able to use your <strong>own Windows VM</strong>. This will be explained in the drawbacks.</p><p></p><p><strong><h3>Users</h3></strong></p><p></p><p>We can use the n<strong>et</strong> command to list all users in the AD domain by using the <strong>user</strong> sub-option:</p><p></p><p><img src="images/332-1.png" alt="images/332-1.png" /></p><p></p><p><strong>Note:</strong> </p><p>net user 					:	Shows users of the current system </p><p>net user /domain	:	Shows users for the entire domain</p><p></p><p>In Our Case:</p><p><img src="images/332-2.png" alt="images/332-2.png" /></p><p></p><p></p><p>This will return all AD users for us and can be helpful in determining the size of the domain to stage further attacks. We can also use this sub-option to enumerate more detailed information about a single user account:</p><p></p><p>Example: <strong>net user zoe.marshall /domain</strong></p><p></p><p><img src="images/332-3.png" alt="images/332-3.png" /></p><p></p><p><strong>Note:</strong> If the user is only part of a small number of AD groups, this command will be able to show us group memberships. However, usually, after more than <strong>ten</strong> group memberships, the command will fail to list them all.</p><p></p><p>In Our Case:</p><p><img src="images/332-4.png" alt="images/332-4.png" /></p><p></p><p><strong><h3>Groups</h3></strong></p><p></p><p>We can use the <strong>net</strong> command to enumerate the groups of the domain by using the <strong>group</strong> sub-option<strong>:</strong></p><p></p><p><strong>net group /domain</strong></p><p></p><p><img src="images/332-5.png" alt="images/332-5.png" /></p><p></p><p>In Our Case:</p><p><img src="images/332-6.png" alt="images/332-6.png" /></p><p></p><p>This information can help us find specific groups to target for goal execution. We could also enumerate more details such as membership to a group by specifying the group in the same command:</p><p></p><p><strong>net group &quot;Tier 1 Admins&quot; /domain</strong></p><p></p><p><img src="images/332-7.png" alt="images/332-7.png" /></p><p></p><p>In Our Case:</p><p><img src="images/332-8.png" alt="images/332-8.png" /></p><p></p><p><strong><h3>Password Policy</h3></strong></p><p></p><p>We can use the <strong>net</strong> command to enumerate the password policy of the domain by using the <strong>accounts</strong> sub-option:</p><p></p><p><strong>net accounts /domain</strong></p><p></p><p><img src="images/332-9.png" alt="images/332-9.png" /></p><p></p><p>This will provide us with helpful information such as:</p><p></p><p>    ★ Length of password history kept. Meaning how many unique passwords must the user provide before they can reuse an old password.</p><p>    ★ The lockout threshold for incorrect password attempts and for how long the account will be locked.</p><p>    ★ The minimum length of the password.</p><p>    ★ The maximum age that passwords are allowed to reach indicating if passwords have to be rotated at a regular interval.</p><p></p><p>This information can benefit us if we want to stage additional password spraying attacks against the other user accounts that we have now enumerated. It can help us better guess what single passwords we should use in the attack and how many attacks can we run before we risk locking accounts. However, it should be noted that if we perform a blind password spraying attack, we may lock out accounts anyway since we did not check to determine how many attempts that specific account had left before being locked.</p><p></p><p>You can find the full range of options associated with the net command here.</p><p>(<a href="https://docs.microsoft.com/en-us/troubleshoot/windows-server/networking/net-commands-on-operating-systems">https://docs.microsoft.com/en-us/troubleshoot/windows-server/networking/net-commands-on-operating-systems</a>)</p><p></p><p>In Our Case:</p><p><img src="images/332-10.png" alt="images/332-10.png" /></p><p></p><p><strong>Benefits</strong></p><p></p><p>    ★ No additional or external tooling is required, and these simple commands are often not monitored for by the Blue team.</p><p>    ★ We do not need a GUI to do this enumeration.</p><p>    ★ VBScript and other macro languages that are often used for phishing payloads support these commands natively so they can be used to enumerate initial information regarding the AD domain before more specific payloads are crafted.</p><p></p><p><strong>Drawbacks</strong></p><p></p><p>    ★ The <strong>net</strong> commands must be executed from a domain-joined machine. If the machine is not domain-joined, it will default to the WORKGROUP domain.</p><p>    ★ The <strong>net</strong> commands may not show all information. For example, if a user is a member of more than ten groups, not all of these groups will be shown in the output.</p></div>
</body>
</html>
