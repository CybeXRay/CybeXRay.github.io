<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>WSH</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>WSH</h1><br/><p><strong><h1>Windows Scripting Host (WSH)</h1></strong></p><p></p><p>Windows Scripting Host (WSH)</p><p></p><p>Windows scripting host is a built-in Windows administration tool that runs batch files to automate and manage tasks within the operating system.</p><p></p><p>It is a Windows native engine, <strong>cscript.exe</strong> (for command-line scripts) and <strong>wscript.exe</strong> (for UI scripts), which are responsible for executing various Microsoft Visual Basic Scripts (VBScript), including <strong>vbs</strong> and <strong>vbe</strong>. For more information about VBScript, please visit here. It is important to note that the VBScript engine on a Windows operating system runs and executes applications with the same level of access and permission as a regular user; therefore, it is useful for the red teamers.</p><p></p><p>Link: <strong>https://en.wikipedia.org/wiki/VBScript</strong> </p><p></p><p>Now let&#39;s write a simple VBScript code to create a windows message box that shows the <strong>Welcome to THM </strong>message. Make sure to save the following code into a file, for example, <strong>hello.vbs</strong>.</p><p></p><p>$$$$$$$$$$$$$$$$$$</p><p></p><p>Dim message </p><p>message = &quot;Welcome to THM&quot;</p><p>MsgBox message</p><p></p><p>$$$$$$$$$$$$$$$$$$</p><p></p><p>In the first line, we declared the <strong>message</strong> <strong>variable</strong> using <strong>Dim</strong>. Then we store a <strong>string</strong> value of<strong> Welcome to THM</strong> in the <strong>message</strong> <strong>variable</strong>. In the next line, we use the <strong>MsgBox</strong> <strong>function</strong> to show the content of the variable. For more information about the MsgBox function, please visit here. Then, we use <strong>wscript</strong> to run and execute the content of hello.vbs. As a result, A Windows message will pop up with the Welcome to THM message.</p><p></p><p>Link: <strong>https://docs.microsoft.com/en-us/previous-versions/windows/internet-explorer/ie-developer/scripting-articles/sfw6660x(v=vs.84)?redirectedfrom=MSDN</strong> </p><p></p><p><img src="images/392-1.png" alt="images/392-1.png" /></p><p></p><p>Now let&#39;s use the VBScript to run executable files. The following vbs code is to invoke the Windows calculator, proof that we can execute .exe files using the Windows native engine (WSH).</p><p></p><p>$$$$$$$$$$$$$$$$$$</p><p></p><p>Set shell = WScript.CreateObject(&quot;Wscript.Shell&quot;)</p><p>shell.Run(&quot;C:\Windows\System32\calc.exe &quot; &amp; WScript.ScriptFullName),0,True</p><p></p><p>$$$$$$$$$$$$$$$$$$</p><p></p><p>We create an object of the <strong>WScript</strong> library using <strong>CreateObject</strong> to call the execution payload. Then, we utilize the <strong>Run</strong> method to execute the payload. For this task, we will run the Windows calculator calc.exe. </p><p></p><p>To execute the exe file, we can run it using the wscript as follows, </p><p></p><p><strong>wscript payload.vbs</strong></p><p></p><p><img src="images/392-2.png" alt="images/392-2.png" /></p><p></p><p>We can also run it via <strong>cscript</strong> as follows,</p><p></p><p><strong>cscript payload.vbs</strong></p><p></p><p><strong><h3>Important</h3></strong></p><p></p><p>Another trick. If the <strong>VBS</strong> <strong>files</strong> are <strong>blacklisted</strong>, then we can rename the file to <strong>.txt</strong> file and run it using <strong>wscript</strong> as follows,</p><p></p><p><strong>wscript /e:VBscript payload.txt</strong></p><p><strong>cscript /e:VBscript payload.txt</strong></p><p></p><p></p><p><strong>To Create a CMD:</strong></p><p></p><p>$$$$$$$$$$$$$$$$$$$$$$</p><p></p><p>Set objShell = CreateObject(&quot;Wscript.Shell&quot;)</p><p>objShell.Run &quot;cmd.exe&quot;</p><p></p><p>$$$$$$$$$$$$$$$$$$$$$$</p></div>
</body>
</html>
