<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Mail Server</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Mail Server</h1><br/><strong>SMTP : Used to send mail from MUA to MSA/MTA</strong><br /><br /><strong>Simple Mail Transfer Protocol:</strong><br /><strong>Default Port: 25</strong><br /><br /><br />If we connect using telnet.<br /><br />telnet &lt;IP_Addr&gt; 25<br /><br /><br /><strong>Commands:</strong><br /><br /><br />HELO hostname<br />MAIL FROM: sender&#39;s address<br />RCPT TO: reciever&#39;s address<br />DATA <br />Type your mail and end with &lt;Enter&gt;.&lt;Enter&gt;<br />QUIT<br />To quit telnet<br /><br /><br /><strong>POP3/IMAP : Used to recieve mail post authentication from MTA/MDA to MUA</strong><br /><br /><strong>Post Office Protocol Version 3:<br />Default Port: 110</strong><br /><br />If we connect using telnet.<br /><br />telnet &lt;IP_Addr&gt; 110<br /><br /><strong>Commands:</strong><br /><br />USER username<br />PASS password<br />STAT<br />Shows the mails and size in format (nn mm) nn: no of mails mm: total size of inbox in octet(bytes)<br />LIST<br />Lists all the mails<br />RETR 1<br />Retrieves 1st item in the list. (2,3.... Retrieves subsequent items in the list)<br /><br /><strong>Internet Message Access protocol:<br />Default Port: 143</strong><br /><br />If we connect using telnet.<br /><br />telnet &lt;IP_Addr&gt; 143<br /><br /><strong>Commands:</strong><br /><br />c1 LOGIN frank D2xc9CgD<br />c2 LIST &quot;&quot; &quot;*&quot;<br />c3 EXAMINE INBOX<br />c4 LOGOUT<br /><br /><br /><strong><h2>THM: SMTP Theory</h2></strong><br /><br /><strong>Enumerating Server Details </strong><br />Poorly configured or vulnerable mail servers can often provide an  initial foothold into a network, but prior to launching an attack, we  want to fingerprint the server to make our targeting as precise as  possible. We&#39;re going to use the &quot;<strong>smtp_version</strong>&quot; module in  <strong>MetaSploit</strong> to do this. As its name implies, it will scan a range of IP  addresses and determine the version of any mail servers it encounters.<br /><br /><strong>auxiliary/scanner/smtp/smtp_version</strong><br /><img src="images/81-1.png" alt="images/81-1.png" /><br /><br /><br /><strong>Enumerating Users from SMTP</strong><br /><br />The SMTP service has two internal commands  that allow the enumeration of users: <strong>VRFY</strong> (confirming the names of  valid users) and <strong>EXPN</strong> (which reveals the actual address of user’s  aliases and lists of e-mail (mailing lists). Using these SMTP commands, we can reveal a list of valid users<br /><br />We  can do this manually, over a <strong>telnet</strong> connection- however <strong>Metasploit</strong>  comes to the rescue again, providing a handy <strong>module</strong> appropriately called  &quot;<strong>smtp_enum</strong>&quot; that will do the legwork for us! Using the module is a simple matter of feeding it a host or range of  hosts to scan and a wordlist containing usernames to enumerate.<br /><br /><br /><strong>Requirements</strong><br /><br />As  we&#39;re going to be using Metasploit for this, it&#39;s important that you  have <strong>Metasploit</strong> installed. It is by default on both Kali Linux  and Parrot OS; however, it&#39;s always worth doing a quick update to make  sure that you&#39;re on the latest version before launching any attacks. You  can do this with a simple &quot;sudo apt update&quot;, and accompanying upgrade-  if any are required. <br /><br /><strong>auxiliary/scanner/smtp/smtp_enum</strong><br /><img src="images/81-2.png" alt="images/81-2.png" /><br /><br /><strong>Note:</strong> We can use the default wordlist or we can use a small one as suggested by the room using <strong>seclists</strong>.<br />Next, we run it.<br /><img src="images/81-3.png" alt="images/81-3.png" /><br /><br /><br /><strong>Alternatives</strong><br /><br />It&#39;s worth noting that this enumeration technique will work for the majority of SMTP configurations; however there are other, non-metasploit tools such as <strong>smtp-user-enum</strong> that work even better for enumerating OS-level user accounts on Solaris via the SMTP service. Enumeration is performed by inspecting the  responses to VRFY, EXPN, and RCPT TO commands.<br /><br />This technique could be adapted in future to  work against other vulnerable SMTP daemons, but this hasn’t been done as  of the time of writing. It&#39;s an alternative that&#39;s worth keeping in  mind if you&#39;re trying to distance yourself from using Metasploit e.g. in preparation for OSCP.<br /></div>
</body>
</html>
