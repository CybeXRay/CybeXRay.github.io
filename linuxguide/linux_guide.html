<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
	"http://www.w3.org/TR/1998/REC-html40-19980424/loose.dtd">
<html>
<head><meta http-equiv="content-type" content="text/html, charset=UTF-8, width=device-width, initial-scale=1"><meta name="generator" content="ABBYY FineReader PDF 15">
<style type="text/css">
 table.main {}
 tr.row {}
 td.cell {}
 div.block {}
 div.paragraph {}
 .font0 { font:5pt Arial, sans-serif; }
 .font1 { font:6pt Arial, sans-serif; }
 .font2 { font:7pt Arial, sans-serif; }
 .font3 { font:8pt Arial, sans-serif; }
 .font4 { font:10pt Arial, sans-serif; }
 .font5 { font:11pt Arial, sans-serif; }
 .font6 { font:12pt Arial, sans-serif; }
 .font7 { font:14pt Arial, sans-serif; }
 .font8 { font:16pt Arial, sans-serif; }
 .font9 { font:17pt Arial, sans-serif; }
 .font10 { font:20pt Arial, sans-serif; }
 .font11 { font:25pt Arial, sans-serif; }
 .font12 { font:49pt Arial, sans-serif; }
 .font13 { font:9pt Calibri, sans-serif; }
 .font14 { font:18pt Calibri, sans-serif; }
 .font15 { font:8pt Consolas, monospace; }
 .font16 { font:9pt Consolas, monospace; }
 .font17 { font:7pt Courier New, monospace; }
 .font18 { font:8pt Courier New, monospace; }
 .font19 { font:9pt Courier New, monospace; }
 .font20 { font:7pt SimSun, serif; }
 .font21 { font:11pt Tahoma, sans-serif; }
 .font22 { font:12pt Tahoma, sans-serif; }
 .font23 { font:8pt Times New Roman, serif; }
 .font24 { font:10pt Times New Roman, serif; }
 .font25 { font:12pt Times New Roman, serif; }
 .font26 { font:15pt Times New Roman, serif; }
 .font27 { font:32pt Times New Roman, serif; }
 .font28 { font:123pt Verdana, sans-serif; }

 #myBtn {
 	  display: none;
 	  position: fixed;
 	  bottom: 20px;
 	  right: 30px;
 	  z-index: 99;
 	  font-size: 18px;
 	  border: none;
 	  outline: none;
 	  background-color: red;
 	  color: white;
 	  cursor: pointer;
 	  padding: 15px;
 	  border-radius: 4px;
 }

 #myBtn:hover {
 		background-color: #555;
 }

</style>
</head>
<body>

<button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>

<script>
	//Get the button
	var mybutton = document.getElementById("myBtn");

	// When the user scrolls down 20px from the top of the document, show the button
	window.onscroll = function() {scrollFunction()};

	function scrollFunction() {
	  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
	    mybutton.style.display = "block";
	  } else {
	    mybutton.style.display = "none";
	  }
	}

	// When the user clicks on the button, scroll to the top of the document
	function topFunction() {
	  document.body.scrollTop = 0;
	  document.documentElement.scrollTop = 0;
	}
</script>

<strong><h2><a class="nav-link" href="../index.html">Home</a></strong></br></h2>
<img src="linux_guide_files/The Complete Linux Guide-1.jpg" alt="" style="width:458pt;height:687pt;">
<p><span class="font28" style="font-weight:bold;">LINUX</span></p>
<p><span class="font14">Compiled by - Ansuman Ray</span></p>
<p><span class="font14">Author - Paul Cobbaut</span></p>
<p><span class="font11" style="font-weight:bold;">Linux Fundamentals</span></p>
<p><span class="font9" style="font-weight:bold;">Paul Cobbaut</span></p>
<p><span class="font7" style="font-weight:bold;">Linux Fundamentals</span></p>
<p><span class="font24">Paul Cobbaut</span></p>
<p><span class="font24">Publication date 2015-05-24 CEST</span></p>
<p><span class="font4" style="font-weight:bold;">Abstract</span></p>
<p><span class="font25">This book is meant to be used in an instructor-led training. For self-study, the intent is to read this book next to a working Linux computer so you can immediately do every subject, practicing each command.</span></p>
<p><span class="font25">This book is aimed at novice Linux system administrators (and might be interesting and useful for home users that want to know a bit more about their Linux system). However, this book is not meant as an introduction to Linux desktop applications like text editors, browsers, mail clients, multimedia or office applications.</span></p>
<p><span class="font25">More information and free .pdf available at </span><a href="http://linux-training.be"><span class="font25" style="font-weight:bold;">http://linux-training.be</span></a><span class="font25" style="font-weight:bold;"> </span><span class="font25">.</span></p>
<p><span class="font25">Feel free to contact the author:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">• Paul Cobbaut: </span><a href="mailto:paul.cobbaut@gmail.com"><span class="font25">paul.cobbaut@gmail.com</span></a><span class="font25">, </span><a href="http://www.linkedin.com/in/cobbaut"><span class="font25">http://www.linkedin.com/in/cobbaut</span></a></p></li></ul>
<p><span class="font25">Contributors to the Linux Training project are:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">• Serge van Ginderachter: </span><a href="mailto:serge@ginsys.eu"><span class="font25">serge@ginsys.eu</span></a><span class="font25">, build scripts and infrastructure setup</span></p></li>
<li>
<p><span class="font25">• Ywein Van den Brande: </span><a href="mailto:ywein@crealaw.eu"><span class="font25">ywein@crealaw.eu</span></a><span class="font25">, license and legal sections</span></p></li>
<li>
<p><span class="font25">• Hendrik De Vloed: </span><a href="mailto:hendrik.devloed@ugent.be"><span class="font25">hendrik.devloed@ugent.be</span></a><span class="font25">, buildheader.pl script</span></p></li></ul>
<p><span class="font25">We'd also like to thank our reviewers:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">• Wouter Verhelst: </span><a href="mailto:wo@uter.be"><span class="font25">wo@uter.be</span></a><span class="font25">, </span><a href="http://grep.be"><span class="font25">http://grep.be</span></a></p></li>
<li>
<p><span class="font25">• Geert Goossens: </span><a href="mailto:mail.goossens.geert@gmail.com"><span class="font25">mail.goossens.geert@gmail.com</span></a><span class="font25">, </span><a href="http://www.linkedin.com/in/"><span class="font25">http://www.linkedin.com/in/</span></a><span class="font25"> geertgoossens</span></p></li>
<li>
<p><span class="font25">• Elie De Brauwer: </span><a href="mailto:elie@de-brauwer.be"><span class="font25">elie@de-brauwer.be</span></a><span class="font25">, </span><a href="http://www.de-brauwer.be"><span class="font25">http://www.de-brauwer.be</span></a></p></li>
<li>
<p><span class="font25">• Christophe Vandeplas: </span><a href="mailto:christophe@vandeplas.com"><span class="font25">christophe@vandeplas.com</span></a><span class="font25">, </span><a href="http://christophe.vandeplas.com"><span class="font25">http://christophe.vandeplas.com</span></a></p></li>
<li>
<p><span class="font25">• Bert Desmet: </span><a href="mailto:bert@devnox.be"><span class="font25">bert@devnox.be</span></a><span class="font25">, </span><a href="http://blog.bdesmet.be"><span class="font25">http://blog.bdesmet.be</span></a></p></li>
<li>
<p><span class="font25">• Rich Yonts: </span><a href="mailto:richyonts@gmail.com"><span class="font25">richyonts@gmail.com</span></a><span class="font25">,</span></p></li></ul>
<p><span class="font25">Copyright 2007-2015 Netsec BVBA, Paul Cobbaut</span></p>
<p><span class="font25">Permission is granted to copy, distribute and/or modify this document under the terms of the </span><span class="font25" style="font-weight:bold;">GNU Free Documentation License</span><span class="font25">, Version 1.3 or any later version published by the Free Software Foundation; with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts. A copy of the license is included in the section entitled 'GNU Free Documentation License'.</span></p><a name="caption1"></a>
<h3><a name="bookmark0"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2"><span class="font24">I. introduction to Linux </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3"><span class="font24" style="font-weight:bold;">1. Linux history </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4"><span class="font24">1.1. 1969 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5"><span class="font24">1.2. 1980s </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6"><span class="font24">1.3. 1990s </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7"><span class="font24">1.4. 2015 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8"><span class="font24" style="font-weight:bold;">2. distributions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9"><span class="font24">2.1. Red Hat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10"><span class="font24">2.2. Ubuntu </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark11"><span class="font24">2.3. Debian </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark12"><span class="font24">2.4. Other </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark13"><span class="font24">2.5. Which to choose ? </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark14"><span class="font24" style="font-weight:bold;">3. licensing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark15"><span class="font24">3.1. about software licenses </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark16"><span class="font24">3.2. public domain software and freeware </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark17"><span class="font24">3.3. Free Software or Open Source Software </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark18"><span class="font24">3.4. GNU General Public License </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark19"><span class="font24">3.5. using GPLv3 software </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark20"><span class="font24">3.6. BSD license </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark21"><span class="font24">3.7. other licenses </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark22"><span class="font24">3.8. combination of software licenses </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark23"><span class="font24">II. installing Linux </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark24"><span class="font24" style="font-weight:bold;">4. installing Debian 8 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark25"><span class="font24">4.1. Debian </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark26"><span class="font24">4.2. Downloading </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark27"><span class="font24">4.3. virtualbox networking </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark28"><span class="font24">4.4. setting the hostname </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark29"><span class="font24">4.5. adding a static ip address </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark30"><span class="font24">4.6. Debian package management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark31"><span class="font24" style="font-weight:bold;">5. installing CentOS 7 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark32"><span class="font24">5.1. download a CentOS 7 image </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark33"><span class="font24">5.2. Virtualbox </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark34"><span class="font24">5.3. CentOS 7 installing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark35"><span class="font24">5.4. CentOS 7 first logon </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark36"><span class="font24">5.5. Virtualbox network interface </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark37"><span class="font24">5.6. configuring the network </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark38"><span class="font24">5.7. adding one static ip address </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark39"><span class="font24">5.8. package management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark40"><span class="font24">5.9. logon from Linux and MacOSX </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark41"><span class="font24">5.10. logon from MS Windows </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark42"><span class="font24" style="font-weight:bold;">6. getting Linux at home </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark43"><span class="font24">6.1. download a Linux CD image </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark44"><span class="font24">6.2. download Virtualbox </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark45"><span class="font24">6.3. create a virtual machine </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark46"><span class="font24">6.4. attach the CD image </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark47"><span class="font24">6.5. install Linux </span></a></p></li></ul>
<p><a href="#bookmark48"><span class="font24">III. first steps on the command line </span></a></p>
<ul style="list-style:none;"><li>
<p><a href="#bookmark49"><span class="font24" style="font-weight:bold;">7. man pages </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark50"><span class="font24">7.1. man $command </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark51"><span class="font24">7.2. man $configfile </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark52"><span class="font24">7.3. man $daemon </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark53"><span class="font24">7.4. man -k (apropos) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark54"><span class="font24">7.5. whatis </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark55"><span class="font24">7.6. whereis </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark56"><span class="font24">7.7. man sections </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark57"><span class="font24">7.8. man $section $file </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark58"><span class="font24">7.9. man man </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark59"><span class="font24">7.10. mandb </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark60"><span class="font24" style="font-weight:bold;">8. working with directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark61"><span class="font24">8.1. pwd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark62"><span class="font24">8.2. cd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark63"><span class="font24">8.3. absolute and relative paths </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark64"><span class="font24">8.4. path completion </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark65"><span class="font24">8.5. ls </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark66"><span class="font24">8.6. mkdir </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark67"><span class="font24">8.7. rmdir </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark68"><span class="font24">8.8. practice: working with directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark69"><span class="font24">8.9. solution: working with directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark70"><span class="font24" style="font-weight:bold;">9. working with files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark71"><span class="font24">9.1. all files are case sensitive </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark72"><span class="font24">9.2. everything is a file </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark73"><span class="font24">9.3. file </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark74"><span class="font24">9.4. touch </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark75"><span class="font24">9.5. rm </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark76"><span class="font24">9.6. cp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark77"><span class="font24">9.7. mv </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark78"><span class="font24">9.8. rename </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark79"><span class="font24">9.9. practice: working with files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark80"><span class="font24">9.10. solution: working with files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark81"><span class="font24" style="font-weight:bold;">10. working with file contents </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark82"><span class="font24">10.1. head </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark83"><span class="font24">10.2. tail </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark84"><span class="font24">10.3. cat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark85"><span class="font24">10.4. tac </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark86"><span class="font24">10.5. more and less </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark87"><span class="font24">10.6. strings </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark88"><span class="font24">10.7. practice: file contents </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark89"><span class="font24">10.8. solution: file contents </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark90"><span class="font24" style="font-weight:bold;">11. the Linux file tree </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark91"><span class="font24">11.1. filesystem hierarchy standard </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark92"><span class="font24">11.2. man hier </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark93"><span class="font24">11.3. the root directory / </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark94"><span class="font24">11.4. binary directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark95"><span class="font24">11.5. configuration directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark96"><span class="font24">11.6. data directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark97"><span class="font24">11.7. in memory directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark98"><span class="font24">11.8. /usr Unix System Resources </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark99"><span class="font24">11.9. /var variable data </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark100"><span class="font24">11.10. practice: file system tree </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark101"><span class="font24">11.11. solution: file system tree </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark102"><span class="font24">IV. shell expansion </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark103"><span class="font24" style="font-weight:bold;">12. commands and arguments </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark104"><span class="font24">12.1. arguments </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark105"><span class="font24">12.2. white space removal </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark106"><span class="font24">12.3. single quotes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark107"><span class="font24">12.4. double quotes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark108"><span class="font24">12.5. echo and quotes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark109"><span class="font24">12.6. commands </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark110"><span class="font24">12.7. aliases </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark111"><span class="font24">12.8. displaying shell expansion </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark112"><span class="font24">12.9. practice: commands and arguments </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark113"><span class="font24">12.10. solution: commands and arguments </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark114"><span class="font24" style="font-weight:bold;">13. control operators </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark115"><span class="font24">13.1. ; semicolon </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark116"><span class="font24">13.2. &amp;&nbsp;ampersand </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark117"><span class="font24">13.3. $? dollar question mark </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark118"><span class="font24">13.4. &amp;&amp;&nbsp;double ampersand </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark119"><span class="font24">13.5. || double vertical bar </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark120"><span class="font24">13.6. combining &amp;&amp;&nbsp;and || </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark121"><span class="font24">13.7. # pound sign </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark122"><span class="font24">13.8. \ escaping special characters </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark123"><span class="font24">13.9. practice: control operators </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark124"><span class="font24">13.10. solution: control operators </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark125"><span class="font24" style="font-weight:bold;">14. shell variables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark126"><span class="font24">14.1. $ dollar sign </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark127"><span class="font24">14.2. case sensitive </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark128"><span class="font24">14.3. creating variables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark129"><span class="font24">14.4. quotes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark130"><span class="font24">14.5. set </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark131"><span class="font24">14.6. unset </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark132"><span class="font24">14.7. $PS1 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark133"><span class="font24">14.8. $PATH </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark134"><span class="font24">14.9. env </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark135"><span class="font24">14.10. export </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark136"><span class="font24">14.11. delineate variables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark137"><span class="font24">14.12. unbound variables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark138"><span class="font24">14.13. practice: shell variables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark139"><span class="font24">14.14. solution: shell variables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark140"><span class="font24" style="font-weight:bold;">15. shell embedding and options </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark141"><span class="font24">15.1. shell embedding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark142"><span class="font24">15.2. shell options </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark143"><span class="font24">15.3. practice: shell embedding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark144"><span class="font24">15.4. solution: shell embedding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark145"><span class="font24" style="font-weight:bold;">16. shell history </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark146"><span class="font24">16.1. repeating the last command </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark147"><span class="font24">16.2. repeating other commands </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark148"><span class="font24">16.3. history </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark149"><span class="font24">16.4. !n </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark150"><span class="font24">16.5. Ctrl-r </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark151"><span class="font24">16.6. $HISTSIZE </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark152"><span class="font24">16.7. $HISTFILE </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark153"><span class="font24">16.8. $HISTFILESIZE </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark154"><span class="font24">16.9. prevent recording a command </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark155"><span class="font24">16.10. (optional)regular expressions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark156"><span class="font24">16.11. (optional) Korn shell history </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark157"><span class="font24">16.12. practice: shell history </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark158"><span class="font24">16.13. solution: shell history </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark159"><span class="font24" style="font-weight:bold;">17. file globbing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark160"><span class="font24">17.1. * asterisk </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark161"><span class="font24">17.2. ? question mark </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark162"><span class="font24">17.3. [] square brackets </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark163"><span class="font24">17.4. a-z and 0-9 ranges </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark164"><span class="font24">17.5. $LANG and square brackets </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark165"><span class="font24">17.6. preventing file globbing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark166"><span class="font24">17.7. practice: shell globbing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark167"><span class="font24">17.8. solution: shell globbing </span></a></p></li></ul>
<p><a href="#bookmark168"><span class="font24">V. pipes and commands </span></a></p>
<ul style="list-style:none;"><li>
<p><a href="#bookmark169"><span class="font24" style="font-weight:bold;">18. I/O redirection </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark170"><span class="font24">18.1. stdin, stdout, and stderr </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark171"><span class="font24">18.2. output redirection </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark172"><span class="font24">18.3. error redirection </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark173"><span class="font24">18.4. output redirection and pipes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark174"><span class="font24">18.5. joining stdout and stderr </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark175"><span class="font24">18.6. input redirection </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark176"><span class="font24">18.7. confusing redirection </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark177"><span class="font24">18.8. quick file clear </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark178"><span class="font24">18.9. practice: input/output redirection </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark179"><span class="font24">18.10. solution: input/output redirection </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark180"><span class="font24" style="font-weight:bold;">19. filters </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark181"><span class="font24">19.1. cat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark182"><span class="font24">19.2. tee </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark183"><span class="font24">19.3. grep </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark184"><span class="font24">19.4. cut </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark185"><span class="font24">19.5. tr </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark186"><span class="font24">19.6. wc </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark187"><span class="font24">19.7. sort </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark188"><span class="font24">19.8. uniq </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark189"><span class="font24">19.9. comm </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark190"><span class="font24">19.10. od </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark191"><span class="font24">19.11. sed </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark192"><span class="font24">19.12. pipe examples </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark193"><span class="font24">19.13. practice: filters </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark194"><span class="font24">19.14. solution: filters </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark195"><span class="font24" style="font-weight:bold;">20. basic Unix tools </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark196"><span class="font24">20.1. find </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark197"><span class="font24">20.2. locate </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark198"><span class="font24">20.3. date </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark199"><span class="font24">20.4. cal </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark200"><span class="font24">20.5. sleep </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark201"><span class="font24">20.6. time </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark202"><span class="font24">20.7. gzip - gunzip </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark203"><span class="font24">20.8. zcat - zmore </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark204"><span class="font24">20.9. bzip2 - bunzip2 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark205"><span class="font24">20.10. bzcat - bzmore </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark206"><span class="font24">20.11. practice: basic Unix tools </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark207"><span class="font24">20.12. solution: basic Unix tools </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark208"><span class="font24" style="font-weight:bold;">21. regular expressions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark209"><span class="font24">21.1. regex versions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark210"><span class="font24">21.2. grep </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark211"><span class="font24">21.3. rename </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark212"><span class="font24">21.4. sed </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark213"><span class="font24">21.5. bash history </span></a></p></li></ul>
<p><a href="#bookmark214"><span class="font24">VI. vi </span></a></p>
<ul style="list-style:none;"><li>
<p><a href="#bookmark215"><span class="font24" style="font-weight:bold;">22. Introduction to vi </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark216"><span class="font24">22.1. command mode and insert mode </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark217"><span class="font24">22.2. start typing (a A i I o O) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark218"><span class="font24">22.3. replace and delete a character (r x X) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark219"><span class="font24">22.4. undo and repeat (u .) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark220"><span class="font24">22.5. cut, copy and paste a line (dd yy p P) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark221"><span class="font24">22.6. cut, copy and paste lines (3dd 2yy) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark222"><span class="font24">22.7. start and end of a line (0 or <sup>A</sup> and $)</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark223"><span class="font24">22.8. join two lines (J) and more </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark224"><span class="font24">22.9. words (w b) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark225"><span class="font24">22.10. save (or not) and exit (:w :q :q! ) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark226"><span class="font24">22.11. Searching (/ ?) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark227"><span class="font24">22.12. replace all ( :1,$ s/foo/bar/g ) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark228"><span class="font24">22.13. reading files (:r :r !cmd) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark229"><span class="font24">22.14. text buffers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark230"><span class="font24">22.15. multiple files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark231"><span class="font24">22.16. abbreviations </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark232"><span class="font24">22.17. key mappings </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark233"><span class="font24">22.18. setting options </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark234"><span class="font24">22.19. practice: vi(m) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark235"><span class="font24">22.20. solution: vi(m) </span></a></p></li></ul>
<p><a href="#bookmark236"><span class="font24">VII. scripting </span></a></p>
<ul style="list-style:none;"><li>
<p><a href="#bookmark237"><span class="font24" style="font-weight:bold;">23. scripting introduction </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark238"><span class="font24">23.1. prerequisites </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark239"><span class="font24">23.2. hello world </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark240"><span class="font24">23.3. she-bang </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark241"><span class="font24">23.4. comment </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark242"><span class="font24">23.5. variables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark243"><span class="font24">23.6. sourcing a script </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark244"><span class="font24">23.7. troubleshooting a script </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark245"><span class="font24">23.8. prevent setuid root spoofing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark246"><span class="font24">23.9. practice: introduction to scripting </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark247"><span class="font24">23.10. solution: introduction to scripting </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark248"><span class="font24" style="font-weight:bold;">24. scripting loops </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark249"><span class="font24">24.1. test [ ] </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark250"><span class="font24">24.2. if then else </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark251"><span class="font24">24.3. if then elif </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark252"><span class="font24">24.4. for loop </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark253"><span class="font24">24.5. while loop </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark254"><span class="font24">24.6. until loop </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark255"><span class="font24">24.7. practice: scripting tests and loops </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark256"><span class="font24">24.8. solution: scripting tests and loops </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark257"><span class="font24" style="font-weight:bold;">25. scripting parameters </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark258"><span class="font24">25.1. script parameters </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark259"><span class="font24">25.2. shift through parameters </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark260"><span class="font24">25.3. runtime input </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark261"><span class="font24">25.4. sourcing a config file </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark262"><span class="font24">25.5. get script options with getopts </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark263"><span class="font24">25.6. get shell options with shopt </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark264"><span class="font24">25.7. practice: parameters and options </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark265"><span class="font24">25.8. solution: parameters and options </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark266"><span class="font24" style="font-weight:bold;">26. more scripting </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark267"><span class="font24">26.1. eval </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark268"><span class="font24">26.2. (( )) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark269"><span class="font24">26.3. let </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark270"><span class="font24">26.4. case </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark271"><span class="font24">26.5. shell functions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark272"><span class="font24">26.6. practice : more scripting </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark273"><span class="font24">26.7. solution : more scripting </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark274"><span class="font24">VIII. local user management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark275"><span class="font24" style="font-weight:bold;">27. introduction to users </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark276"><span class="font24">27.1. whoami </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark277"><span class="font24">27.2. who </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark278"><span class="font24">27.3. who am i </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark279"><span class="font24">27.4. w </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark280"><span class="font24">27.5. id </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark281"><span class="font24">27.6. su to another user </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark282"><span class="font24">27.7. su to root </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark283"><span class="font24">27.8. su as root </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark284"><span class="font24">27.9. su - $username </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark285"><span class="font24">27.10. su - </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark286"><span class="font24">27.11. run a program as another user </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark287"><span class="font24">27.12. visudo </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark288"><span class="font24">27.13. sudo su - </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark289"><span class="font24">27.14. sudo logging </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark290"><span class="font24">27.15. practice: introduction to users </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark291"><span class="font24">27.16. solution: introduction to users </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark292"><span class="font24" style="font-weight:bold;">28. user management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark293"><span class="font24">28.1. user management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark294"><span class="font24">28.2. /etc/passwd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark295"><span class="font24">28.3. root </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark296"><span class="font24">28.4. useradd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark297"><span class="font24">28.5. /etc/default/useradd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark298"><span class="font24">28.6. userdel </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark299"><span class="font24">28.7. usermod </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark300"><span class="font24">28.8. creating home directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark301"><span class="font24">28.9. /etc/skel/ </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark302"><span class="font24">28.10. deleting home directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark303"><span class="font24">28.11. login shell </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark304"><span class="font24">28.12. chsh </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark305"><span class="font24">28.13. practice: user management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark306"><span class="font24">28.14. solution: user management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark307"><span class="font24" style="font-weight:bold;">29. user passwords </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark308"><span class="font24">29.1. passwd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark309"><span class="font24">29.2. shadow file </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark310"><span class="font24">29.3. encryption with passwd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark311"><span class="font24">29.4. encryption with openssl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark312"><span class="font24">29.5. encryption with crypt </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark313"><span class="font24">29.6. /etc/login.defs </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark314"><span class="font24">29.7. chage </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark315"><span class="font24">29.8. disabling a password </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark316"><span class="font24">29.9. editing local files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark317"><span class="font24">29.10. practice: user passwords </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark318"><span class="font24">29.11. solution: user passwords </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark319"><span class="font24" style="font-weight:bold;">30. user profiles </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark320"><span class="font24">30.1. system profile </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark321"><span class="font24">30.2. ~/.bash_profile </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark322"><span class="font24">30.3. ~/.bash_login </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark323"><span class="font24">30.4. ~/.profile </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark324"><span class="font24">30.5. ~/.bashrc </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark325"><span class="font24">30.6. ~/.bash_logout </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark326"><span class="font24">30.7. Debian overview </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark327"><span class="font24">30.8. RHEL5 overview </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark328"><span class="font24">30.9. practice: user profiles </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark329"><span class="font24">30.10. solution: user profiles </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark330"><span class="font24" style="font-weight:bold;">31. groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark331"><span class="font24">31.1. groupadd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark332"><span class="font24">31.2. group file </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark333"><span class="font24">31.3. groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark334"><span class="font24">31.4. usermod </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark335"><span class="font24">31.5. groupmod </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark336"><span class="font24">31.6. groupdel </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark337"><span class="font24">31.7. gpasswd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark338"><span class="font24">31.8. newgrp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark339"><span class="font24">31.9. vigr </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark340"><span class="font24">31.10. practice: groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark341"><span class="font24">31.11. solution: groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark342"><span class="font24">IX. file security </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark343"><span class="font24" style="font-weight:bold;">32. standard file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark344"><span class="font24">32.1. file ownership </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark345"><span class="font24">32.2. list of special files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark346"><span class="font24">32.3. permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark347"><span class="font24">32.4. practice: standard file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark348"><span class="font24">32.5. solution: standard file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark349"><span class="font24" style="font-weight:bold;">33. advanced file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark350"><span class="font24">33.1. sticky bit on directory </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark351"><span class="font24">33.2. setgid bit on directory </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark352"><span class="font24">33.3. setgid and setuid on regular files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark353"><span class="font24">33.4. setuid on sudo </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark354"><span class="font24">33.5. practice: sticky, setuid and setgid bits </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark355"><span class="font24">33.6. solution: sticky, setuid and setgid bits </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark356"><span class="font24" style="font-weight:bold;">34. access control lists </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark357"><span class="font24">34.1. acl in /etc/fstab </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark358"><span class="font24">34.2. getfacl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark359"><span class="font24">34.3. setfacl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark360"><span class="font24">34.4. remove an acl entry </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark361"><span class="font24">34.5. remove the complete acl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark362"><span class="font24">34.6. the acl mask </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark363"><span class="font24">34.7. eiciel </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark364"><span class="font24" style="font-weight:bold;">35. file links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark365"><span class="font24">35.1. inodes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark366"><span class="font24">35.2. about directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark367"><span class="font24">35.3. hard links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark368"><span class="font24">35.4. symbolic links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark369"><span class="font24">35.5. removing links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark370"><span class="font24">35.6. practice : links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark371"><span class="font24">35.7. solution : links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark372"><span class="font24">X. Appendices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark373"><span class="font24" style="font-weight:bold;">A. keyboard settings </span></a></p></li></ul>
<p><a href="#bookmark374"><span class="font24">A.1. about keyboard layout </span></a></p>
<p><a href="#bookmark375"><span class="font24">A.2. X Keyboard Layout </span></a></p>
<p><a href="#bookmark376"><span class="font24">A.3. shell keyboard layout </span></a></p>
<ul style="list-style:none;"><li>
<p><a href="#bookmark377"><span class="font24" style="font-weight:bold;">B. hardware </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark378"><span class="font24">B.1. buses </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark379"><span class="font24">B.2. interrupts </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark380"><span class="font24">B.3. io ports </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark381"><span class="font24">B.4. dma </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark382"><span class="font24" style="font-weight:bold;">C. License </span></a></p></li></ul>
<p><a href="#bookmark383"><span class="font24">Index </span></a></p>
<h3><a name="bookmark384"></a><span class="font9" style="font-weight:bold;"><a name="bookmark385"></a>List of Tables</span></h3>
<p><a href="#bookmark386"><span class="font24">2.1. choosing a Linux distro </span></a></p>
<p><a href="#bookmark387"><span class="font24">4.1. Debian releases </span></a></p>
<ul style="list-style:none;"><li>
<p><a href="#bookmark388"><span class="font24">22.1. getting to command mode </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark389"><span class="font24">22.2. switch to insert mode </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark390"><span class="font24">22.3. replace and delete </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark391"><span class="font24">22.4. undo and repeat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark392"><span class="font24">22.5. cut, copy and paste a line </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark393"><span class="font24">22.6. cut, copy and paste lines </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark394"><span class="font24">22.7. start and end of line </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark395"><span class="font24">22.8. join two lines </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark396"><span class="font24">22.9. words </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark397"><span class="font24">22.10. save and exit vi </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark398"><span class="font24">22.11. searching </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark399"><span class="font24">22.12. replace </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark400"><span class="font24">22.13. read files and input </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark401"><span class="font24">22.14. text buffers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark402"><span class="font24">22.15. multiple files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark403"><span class="font24">22.16. abbreviations </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark404"><span class="font24">30.1. Debian User Environment </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark405"><span class="font24">30.2. Red Hat User Environment </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark406"><span class="font24">32.1. Unix special files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark407"><span class="font24">32.2. standard Unix file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark408"><span class="font24">32.3. Unix file permissions position </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark409"><span class="font24">32.4. Octal permissions </span></a></p></li></ul>
<p><a name="bookmark410"></a><span class="font11" style="font-weight:bold;">Part I. introduction to Linux</span></p>
<h3><a name="bookmark411"></a><span class="font9" style="font-weight:bold;"><a name="bookmark412"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark413"><span class="font24" style="font-weight:bold;">1. Linux history </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark414"><span class="font24">1.1. 1969 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark415"><span class="font24">1.2. 1980s </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark416"><span class="font24">1.3. 1990s </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark417"><span class="font24">1.4. 2015 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark418"><span class="font24" style="font-weight:bold;">2. distributions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark419"><span class="font24">2.1. Red Hat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark420"><span class="font24">2.2. Ubuntu </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark421"><span class="font24">2.3. Debian </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark422"><span class="font24">2.4. Other </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark423"><span class="font24">2.5. Which to choose ? </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark424"><span class="font24" style="font-weight:bold;">3. licensing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark425"><span class="font24">3.1. about software licenses </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark426"><span class="font24">3.2. public domain software and freeware </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark427"><span class="font24">3.3. Free Software or Open Source Software </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark428"><span class="font24">3.4. GNU General Public License </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark429"><span class="font24">3.5. using GPLv3 software </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark430"><span class="font24">3.6. BSD license </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark431"><span class="font24">3.7. other licenses </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark432"><span class="font24">3.8. combination of software licenses </span></a></p></li></ul>
<ul style="list-style:none;"><li><a name="caption2"></a>
<h1><a name="bookmark433"></a><span class="font11" style="font-weight:bold;"><a name="bookmark434"></a><a name="bookmark435"></a>Chapter 1. Linux history</span></h1></li></ul>
<p><span class="font25">This chapter briefly tells the history of Unix and where Linux fits in.</span></p>
<p><span class="font25">If you are eager to start working with Linux without this blah, blah, blah over history, distributions, and licensing then jump straight to </span><span class="font25" style="font-weight:bold;">Part II - Chapter 8. Working with Directories </span><span class="font25">page 73.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark436"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4"></a><a name="bookmark437"></a>1.1. 1969</span></h2></li></ul>
<p><a name="bookmark438"></a><span class="font25"><a name="bookmark439"></a><a name="bookmark440"></a><a name="bookmark441"></a>All modern operating systems have their roots in 1969 when </span><span class="font25" style="font-weight:bold;">Dennis Ritchie </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">Ken Thompson </span><span class="font25">developed the C language and the </span><span class="font25" style="font-weight:bold;">Unix </span><span class="font25">operating system at AT&amp;T Bell Labs. They shared their source code (yes, there was open source back in the Seventies) with the rest of the world, including the hippies in Berkeley California. By 1975, when AT&amp;T started selling Unix commercially, about half of the source code was written by others. The hippies were not happy that a commercial company sold software that they had written; the resulting (legal) battle ended in there being two versions of </span><span class="font25" style="font-weight:bold;">Unix</span><span class="font25">: the official AT&amp;T Unix, and the free </span><span class="font25" style="font-weight:bold;">BSD </span><span class="font25">Unix.</span></p>
<p><span class="font25">Development of BSD descendants like FreeBSD, OpenBSD, NetBSD, DragonFly BSD and PC-BSD is still active today.</span></p>
<p><a href="https://en.wikipedia.org/wiki/Dennis_Ritchie"><span class="font19">https://en.wikipedia.org/wiki/Dennis_Ritchie</span></a><span class="font19"> </span><a href="https://en.wikipedia.org/wiki/Ken_Thompson"><span class="font19">https://en.wikipedia.org/wiki/Ken_Thompson</span></a><span class="font19"> </span><a href="https://en.wikipedia.org/wiki/BSD"><span class="font19">https://en.wikipedia.org/wiki/BSD</span></a></p>
<p><a href="https://en.wikipedia.org/wiki/Comparison_of_BSD_operating_systems"><span class="font19">https://en.wikipedia.org/wiki/Comparison_of_BSD_operating_systems</span></a></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark442"></a><span class="font10" style="font-weight:bold;"><a name="bookmark5"></a><a name="bookmark443"></a>1.2. 1980s</span></h2></li></ul>
<p><a name="bookmark444"></a><span class="font25"><a name="bookmark445"></a><a name="bookmark446"></a><a name="bookmark447"></a><a name="bookmark448"></a><a name="bookmark449"></a><a name="bookmark450"></a>In the Eighties many<a name="bookmark451"></a> com<a name="bookmark452"></a>panies started developing their own Unix: IBM created AIX, Sun SunOS (later Solaris), HP HP-UX and about a dozen other companies did the same. The result was a mess of Unix dialects and a dozen different ways to do the same thing. And here is the first real root of </span><span class="font25" style="font-weight:bold;">Linux</span><span class="font25">, when </span><span class="font25" style="font-weight:bold;">Richard Stallman </span><span class="font25">aimed to end this era of Unix separation and everybody re-inventing the wheel by starting the </span><span class="font25" style="font-weight:bold;">GNU </span><span class="font25">project (GNU is Not Unix). His goal was to make an operating system that was freely available to everyone, and where everyone could work together (like in the Seventies). Many of the command line tools that you use today on </span><span class="font25" style="font-weight:bold;">Linux </span><span class="font25">are GNU tools.</span></p>
<p><a href="https://en.wikipedia.org/wiki/Richard_Stallman"><span class="font19">https://en.wikipedia.org/wiki/Richard_Stallman</span></a><span class="font19"> </span><a href="https://en.wikipedia.org/wiki/IBM_AIX"><span class="font19">https://en.wikipedia.org/wiki/IBM_AIX</span></a><span class="font19"> </span><a href="https://en.wikipedia.org/wiki/HP-UX"><span class="font19">https://en.wikipedia.org/wiki/HP-UX</span></a></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark453"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6"></a><a name="bookmark454"></a>1.3. 1990s</span></h2></li></ul>
<p><a name="bookmark455"></a><span class="font25">The Nineties started with </span><span class="font25" style="font-weight:bold;">Linus Torvalds</span><span class="font25">, a Swedish speaking Finnish student, buying a 386 computer and writing a brand new POSIX compliant kernel. He put the source code online, thinking it would never support anything but 386 hardware. Many people embraced the combination of this kernel with the GNU tools, and the rest, as they say, is history.</span></p>
<p><a href="http://en.wikipedia.org/wiki/Linus_Torvalds"><span class="font19">http://en.wikipedia.org/wiki/Linus_Torvalds</span></a><span class="font19"> </span><a href="https://en.wikipedia.org/wiki/History_of_Linux"><span class="font19">https://en.wikipedia.org/wiki/History_of_Linux</span></a><span class="font19"> </span><a href="https://en.wikipedia.org/wiki/Linux"><span class="font19">https://en.wikipedia.org/wiki/Linux</span></a><span class="font19"> </span><a href="https://lwn.net"><span class="font19">https://lwn.net</span></a></p>
<p><a href="http://www.levenez.com/unix/"><span class="font19">http://www.levenez.com/unix/</span></a><span class="font19"> (a huge Unix history poster)</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark456"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7"></a><a name="bookmark457"></a>1.4. 2015</span></h2></li></ul>
<p><span class="font25">Today more than 97 percent of the world's supercomputers (including the complete top 10), more than 80 percent of all smartphones, many millions of desktop computers, around 70 percent of all web servers, a large chunk of tablet computers, and several appliances (dvd-players, washing machines, dsl modems, routers, self-driving cars, space station laptops...) run </span><span class="font25" style="font-weight:bold;">Linux</span><span class="font25">. Linux is by far the most commonly used operating system in the world.</span></p>
<p><span class="font25">Linux kernel version 4.0 was released in April 2015. Its source code grew by several hundred thousand lines (compared to version 3.19 from February 2015) thanks to contributions of thousands of developers paid by hundreds of commercial companies including Red Hat, Intel, Samsung, Broadcom, Texas Instruments, IBM, Novell, Qualcomm, Nokia, Oracle, Google, AMD and even Microsoft (and many more).</span></p>
<p><a href="http://kernelnewbies.org/DevelopmentStatistics"><span class="font19">http://kernelnewbies.org/DevelopmentStatistics</span></a></p>
<p><a href="http://kernel.org"><span class="font19">http://kernel.org</span></a></p>
<p><a href="http://www.top500.org"><span class="font19">http://www.top500.org</span></a></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark458"></a><span class="font11" style="font-weight:bold;"><a name="bookmark459"></a><a name="bookmark460"></a>Chapter 2. distributions</span></h1></li></ul>
<p><span class="font25">This chapter gives a short overview of current Linux distributions.</span></p>
<p><a name="bookmark461"></a><span class="font25"><a name="bookmark462"></a>A Linux </span><span class="font25" style="font-weight:bold;">distribution </span><span class="font25">is a collection of (usually open source) software on top of a Linux kernel. A distribution (or short, distro) can bundle server software, system management tools, documentation and many desktop applications in a </span><span class="font25" style="font-weight:bold;">central secure software repository</span><span class="font25">. A distro aims to provide a common look and feel, secure and easy software management and often a specific operational purpose.</span></p>
<p><span class="font25">Let's take a look at some popular distributions.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark463"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9"></a><a name="bookmark464"></a>2.1. Red Hat</span></h2></li></ul>
<p><a name="bookmark465"></a><span class="font25"><a name="bookmark466"></a>Red Hat is a billion dollar commercial Linux company that puts a lot of effort in developing Linux. They have hundreds of Linux specialists and are known for their excellent support. They give their products (Red Hat Enterprise Linux and Fedora) away for free. While </span><span class="font25" style="font-weight:bold;">Red Hat Enterprise Linux </span><span class="font25">(RHEL) is well tested before release and supported for up to seven years after release, </span><span class="font25" style="font-weight:bold;">Fedora </span><span class="font25">is a distro with faster updates but without support.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark467"></a><span class="font10" style="font-weight:bold;"><a name="bookmark10"></a><a name="bookmark468"></a>2.2. Ubuntu</span></h2></li></ul>
<p><a name="bookmark469"></a><span class="font25">Canonical started sending out free compact discs with </span><span class="font25" style="font-weight:bold;">Ubuntu </span><span class="font25">Linux in 2004 and quickly became popular for home users (many switching from Microsoft Windows). Canonical wants Ubuntu to be an easy to use graphical Linux desktop without need to ever see a command line. Of course they also want to make a profit by selling support for Ubuntu.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark470"></a><span class="font10" style="font-weight:bold;"><a name="bookmark11"></a><a name="bookmark471"></a>2.3. Debian</span></h2></li></ul>
<p><a name="bookmark472"></a><span class="font25">There is no company behind </span><span class="font25" style="font-weight:bold;">Debian</span><span class="font25">. Instead there are thousands of well organised developers that elect a </span><span class="font25" style="font-weight:bold;">Debian Project Leader </span><span class="font25">every two years. Debian is seen as one of the most stable Linux distributions. It is also the basis of every release of Ubuntu. Debian comes in three versions: stable, testing and unstable. Every Debian release is named after a character in the movie Toy Story.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark473"></a><span class="font10" style="font-weight:bold;"><a name="bookmark12"></a><a name="bookmark474"></a>2.4. Other</span></h2></li></ul>
<p><a name="bookmark475"></a><span class="font25"><a name="bookmark476"></a><a name="bookmark477"></a><a name="bookmark478"></a><a name="bookmark479"></a>Distributions like CentOS, Oracle Enterprise Linux and Scientific Linux are based on Red Hat Enterprise Linux and share many<a name="bookmark480"></a> of the same principles, directories and system administration techniques. </span><span class="font25" style="font-weight:bold;">Linux Mint</span><span class="font25">, Edubuntu and many other *buntu named distributions are based on Ubuntu and thus share a lot with Debian. There are hundreds of other Linux distributions.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark481"></a><span class="font10" style="font-weight:bold;"><a name="bookmark13"></a><a name="bookmark482"></a>2.5. Which to choose ?</span></h2></li></ul>
<h4><a name="bookmark483"></a><span class="font25"><a name="bookmark484"></a><a name="bookmark485"></a>Below are some very personal opinions on some of the most popular Linux Distributions. Keep in mind that any of the below Linux distributions can be a stable server and a nice graphical desktop client.</span></h4>
<p><span class="font25" style="font-weight:bold;">Table 2.1. choosing a Linux distro</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">distribution name</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">reason(s) for using</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">Red Hat Enterprise (RHEL)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">You are a manager and you want a good support contract.</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">CentOS</span></p></td><td style="vertical-align:top;">
<p><span class="font24">You want Red Hat without the support contract from Red Hat.</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">Fedora</span></p></td><td style="vertical-align:top;">
<p><span class="font24">You want Red Hat on your laptop/desktop.</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">Linux Mint</span></p></td><td style="vertical-align:top;">
<p><span class="font24">You want a personal graphical desktop to play movies, music and games.</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">Debian</span></p></td><td style="vertical-align:top;">
<p><span class="font24">My personal favorite for servers, laptops, and any other device.</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">Ubuntu</span></p></td><td style="vertical-align:top;">
<p><span class="font24">Very popular, based on Debian, not my favorite.</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">Kali</span></p></td><td style="vertical-align:top;">
<p><span class="font24">You want a pointy-clicky hacking interface.</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">others</span></p></td><td style="vertical-align:top;">
<p><span class="font24">Advanced users may prefer Arch, Gentoo, OpenSUSE, Scientific, ...</span></p></td></tr>
</table>
<h4><a name="bookmark486"></a><span class="font25"><a name="bookmark487"></a>When you are new to Linux in 2015, go for the latest Mint or Fedora. If you only want to practice the Linux command line then install one Debian server and/or one CentOS server (without graphical interface).</span></h4>
<h4><a name="bookmark488"></a><span class="font25"><a name="bookmark489"></a>Here are some links to help you choose:</span></h4>
<p><span class="font19">distrowatch.com</span></p>
<p><span class="font19">redhat.com</span></p>
<p><span class="font19">centos.org</span></p>
<p><span class="font19">debian.org</span></p>
<p><a href="http://www.linuxmint.com"><span class="font19">www.linuxmint.com</span></a></p>
<p><span class="font19">ubuntu.com</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark490"></a><span class="font11" style="font-weight:bold;"><a name="bookmark491"></a><a name="bookmark492"></a>Chapter 3. licensing</span></h1></li></ul>
<p><span class="font25">This chapter briefly explains the different licenses used for distributing operating systems software.</span></p>
<p><span class="font25">Many thanks go to </span><span class="font25" style="font-weight:bold;">Ywein Van den Brande </span><span class="font25">for writing most of this chapter.</span></p>
<p><span class="font25">Ywein is an attorney at law, co-author of </span><span class="font25" style="font-weight:bold;">The International FOSS Law Book </span><span class="font25">and author of </span><span class="font25" style="font-weight:bold;">Praktijkboek Informaticarecht </span><span class="font25">(in Dutch).</span></p><img src="linux_guide_files/The Complete Linux Guide-2.jpg" alt="" style="width:229pt;height:147pt;">
<p><span class="font19">http: //i fosslawbook.org </span><a href="http://www.crealaw.eu"><span class="font19">http://www.crealaw.eu</span></a></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark493"></a><span class="font10" style="font-weight:bold;"><a name="bookmark15"></a><a name="bookmark494"></a>3.1. about software licenses</span></h2></li></ul>
<p><a name="bookmark495"></a><span class="font25"><a name="bookmark496"></a><a name="bookmark497"></a><a name="bookmark498"></a><a name="bookmark499"></a>There are two predominant software paradigms: </span><span class="font25" style="font-weight:bold;">Free and Open Source Software </span><span class="font25">(FOSS) and </span><span class="font25" style="font-weight:bold;">proprietary software</span><span class="font25">. The criteria for differentiation between these two approaches is based on control over the software. With </span><span class="font25" style="font-weight:bold;">proprietary software</span><span class="font25">, control tends to lie more with the vendor, while with </span><span class="font25" style="font-weight:bold;">Free and Open Source Software </span><span class="font25">it tends to be more weighted towards the end user. But even though the paradigms differ, they use the same </span><span class="font25" style="font-weight:bold;">copyright laws </span><span class="font25">to reach and enforce their goals. From a legal perspective, </span><span class="font25" style="font-weight:bold;">Free and Open Source Software </span><span class="font25">can be considered as software to which users generally receive more rights via their license agreement than they would have with a </span><span class="font25" style="font-weight:bold;">proprietary software license</span><span class="font25">, yet the underlying license mechanisms are the same.</span></p>
<p><a name="bookmark500"></a><span class="font25">Legal theory states that the author of FOSS, contrary to the author of </span><span class="font25" style="font-weight:bold;">public domain </span><span class="font25">software, has in no way whatsoever given up his rights on his work. FOSS supports on the rights of the author (the </span><span class="font25" style="font-weight:bold;">copyright</span><span class="font25">) to impose FOSS license conditions. The FOSS license conditions need to be respected by the user in the same way as proprietary license conditions. Always check your license carefully before you use third party software.</span></p>
<p><span class="font25">Examples of proprietary software are </span><span class="font25" style="font-weight:bold;">AIX </span><span class="font25">from IBM, </span><span class="font25" style="font-weight:bold;">HP-UX </span><span class="font25">from HP and </span><span class="font25" style="font-weight:bold;">Oracle Database 11g</span><span class="font25">. You are not authorised to install or use this software without paying a licensing fee. You are not authorised to distribute copies and you are not authorised to modify the closed source code.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark501"></a><span class="font10" style="font-weight:bold;"><a name="bookmark16"></a><a name="bookmark502"></a>3.2. public domain software and freeware</span></h2></li></ul>
<p><a name="bookmark503"></a><span class="font25">Software that is original in the sense that it is an intellectual creation of the author benefits </span><span class="font25" style="font-weight:bold;">copyright </span><span class="font25">protection. Non-original software does not come into consideration for </span><span class="font25" style="font-weight:bold;">copyright </span><span class="font25">protection and can, in principle, be used freely.</span></p>
<p><span class="font25">Public domain software is considered as software to which the author has given up all rights and on which nobody is able to enforce any rights. This software can be used, reproduced or executed freely, without permission or the payment of a fee. Public domain software can in certain cases even be presented by third parties as own work, and by modifying the original work, third parties can take certain versions of the public domain software out of the public domain again.</span></p>
<p><a name="bookmark504"></a><span class="font25" style="font-weight:bold;">Freeware </span><span class="font25">is not public domain software or FOSS. It is proprietary software that you can use without paying a license cost. However, the often strict license terms need to be respected.</span></p>
<p><span class="font25">Examples of freeware are </span><span class="font25" style="font-weight:bold;">Adobe Reader</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">Skype </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">Command and Conquer: Tiberian Sun </span><span class="font25">(this game was sold as proprietary in 1999 and is since 2011 available as freeware).</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark505"></a><span class="font10" style="font-weight:bold;"><a name="bookmark17"></a><a name="bookmark506"></a>3.3. Free Software or Open Source Software</span></h2></li></ul>
<p><a name="bookmark507"></a><span class="font25"><a name="bookmark508"></a><a name="bookmark509"></a><a name="bookmark510"></a>Both the </span><span class="font25" style="font-weight:bold;">Free Software </span><span class="font25">(translates to </span><span class="font25" style="font-weight:bold;">vrije software </span><span class="font25">in Dutch and to </span><span class="font25" style="font-weight:bold;">Logiciel Libre </span><span class="font25">in French) and the </span><span class="font25" style="font-weight:bold;">Open Source Software </span><span class="font25">movement largely pursue similar goals and endorse similar software licenses. But historically, there has been some perception of differentiation due to different emphases. Where the </span><span class="font25" style="font-weight:bold;">Free Software </span><span class="font25">movement focuses on the rights (the four freedoms) which Free Software provides to its users, the </span><span class="font25" style="font-weight:bold;">Open Source Software </span><span class="font25">movement points to its Open Source Definition and the advantages of peer-to-peer software development.</span></p>
<p><span class="font25">Recently, the term free and open source software or FOSS has arisen as a neutral alternative. A lesser-used variant is free/libre/open source software (FLOSS), which uses </span><span class="font25" style="font-weight:bold;">libre </span><span class="font25">to clarify the meaning of free as in </span><span class="font25" style="font-weight:bold;">freedom </span><span class="font25">rather than as in </span><span class="font25" style="font-weight:bold;">at no charge</span><span class="font25">.</span></p>
<p><span class="font25">Examples of </span><span class="font25" style="font-weight:bold;">free software </span><span class="font25">are </span><span class="font25" style="font-weight:bold;">gcc</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">MySQL </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">gimp</span><span class="font25">.</span></p>
<p><a name="bookmark511"></a><span class="font25">Detailed information about the </span><span class="font25" style="font-weight:bold;">four freedoms </span><span class="font25">can be found here:</span></p>
<p><a href="http://www.gnu.org/philosophy/free-sw.html"><span class="font19">http://www.gnu.org/philosophy/free-sw.html</span></a></p>
<p><a name="bookmark512"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">open source definition </span><span class="font25">can be found at:</span></p>
<p><a href="http://www.opensource.org/docs/osd"><span class="font19">http://www.opensource.org/docs/osd</span></a></p>
<p><span class="font25">The above definition is based on the </span><span class="font25" style="font-weight:bold;">Debian Free Software Guidelines </span><span class="font25">available here:</span></p>
<p><a href="http://www.debian.org/social_contract%23guidelines"><span class="font19">http://www.debian.org/social_contract#guidelines</span></a></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark513"></a><span class="font10" style="font-weight:bold;"><a name="bookmark18"></a><a name="bookmark514"></a>3.4. GNU General Public License</span></h2></li></ul>
<p><a name="bookmark515"></a><span class="font25"><a name="bookmark516"></a>More and more software is being released under the </span><span class="font25" style="font-weight:bold;">GNU GPL </span><span class="font25">(in 2006 Java was released under the GPL). This license (v2 and v3) is the main license endorsed by the Free Software Foundation. It’s main characteristic is the </span><span class="font25" style="font-weight:bold;">copyleft </span><span class="font25">principle. This means that everyone in the chain of consecutive users, in return for the right of use that is assigned, needs to distribute the improvements he makes to the software and his derivative works under the same conditions to other users, if he chooses to distribute such improvements or derivative works. In other words, software which incorporates GNU GPL software, needs to be distributed in turn as GNU GPL software (or compatible, see below). It is not possible to incorporate copyright protected parts of GNU GPL software in a proprietary licensed work. The GPL has been upheld in court.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark517"></a><span class="font10" style="font-weight:bold;"><a name="bookmark19"></a><a name="bookmark518"></a>3.5. using GPLv3 software</span></h2></li></ul>
<p><a name="bookmark519"></a><span class="font25">You can use </span><span class="font25" style="font-weight:bold;">GPLv3 software </span><span class="font25">almost without any conditions. If you solely run the software you even don’t have to accept the terms of the GPLv3. However, any other use - such as modifying or distributing the software - implies acceptance.</span></p>
<p><span class="font25">In case you use the software internally (including over a network), you may modify the software without being obliged to distribute your modification. You may hire third parties to work on the software exclusively for you and under your direction and control. But if you modify the software and use it otherwise than merely internally, this will be considered as distribution. You must distribute your modifications under GPLv3 (the copyleft principle). Several more obligations apply if you distribute GPLv3 software. Check the GPLv3 license carefully.</span></p>
<p><span class="font25">You create output with GPLv3 software: The GPLv3 does not automatically apply to the output.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark520"></a><span class="font10" style="font-weight:bold;"><a name="bookmark20"></a><a name="bookmark521"></a>3.6. BSD license</span></h2></li></ul>
<p><span class="font25">There are several versions of the original Berkeley Distribution License. The most common one is the 3-clause license (&quot;New BSD License&quot; or &quot;Modified BSD License&quot;).</span></p>
<p><span class="font25">This is a permissive free software license. The license places minimal restrictions on how the software can be redistributed. This is in contrast to copyleft licenses such as the GPLv. 3 discussed above, which have a copyleft mechanism.</span></p>
<p><span class="font25">This difference is of less importance when you merely use the software, but kicks in when you start redistributing verbatim copies of the software or your own modified versions.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark522"></a><span class="font10" style="font-weight:bold;"><a name="bookmark21"></a><a name="bookmark523"></a>3.7. other licenses</span></h2></li></ul>
<p><span class="font25">FOSS or not, there are many kind of licenses on software. You should read and understand them before using any software.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark524"></a><span class="font10" style="font-weight:bold;"><a name="bookmark22"></a><a name="bookmark525"></a>3.8. combination of software licenses</span></h2></li></ul>
<p><span class="font25">When you use several sources or wishes to redistribute your software under a different license, you need to verify whether all licenses are compatible. Some FOSS licenses (such as BSD) are compatible with proprietary licenses, but most are not. If you detect a license incompatibility, you must contact the author to negotiate different license conditions or refrain from using the incompatible software.</span></p>
<p><a name="bookmark526"></a><span class="font11" style="font-weight:bold;">Part II. installing Linux</span></p>
<h3><a name="bookmark527"></a><span class="font9" style="font-weight:bold;"><a name="bookmark528"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark529"><span class="font24" style="font-weight:bold;">4. installing Debian 8 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark530"><span class="font24">4.1. Debian </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark531"><span class="font24">4.2. Downloading </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark532"><span class="font24">4.3. virtualbox networking </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark533"><span class="font24">4.4. setting the hostname </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark534"><span class="font24">4.5. adding a static ip address </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark535"><span class="font24">4.6. Debian package management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark536"><span class="font24" style="font-weight:bold;">5. installing CentOS 7 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark537"><span class="font24">5.1. download a CentOS 7 image </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark538"><span class="font24">5.2. Virtualbox </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark539"><span class="font24">5.3. CentOS 7 installing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark540"><span class="font24">5.4. CentOS 7 first logon </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark541"><span class="font24">5.5. Virtualbox network interface </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark542"><span class="font24">5.6. configuring the network </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark543"><span class="font24">5.7. adding one static ip address </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark544"><span class="font24">5.8. package management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark545"><span class="font24">5.9. logon from Linux and MacOSX </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark546"><span class="font24">5.10. logon from MS Windows </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark547"><span class="font24" style="font-weight:bold;">6. getting Linux at home </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark548"><span class="font24">6.1. download a Linux CD image </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark549"><span class="font24">6.2. download Virtualbox </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark550"><span class="font24">6.3. create a virtual machine </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark551"><span class="font24">6.4. attach the CD image </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark552"><span class="font24">6.5. install Linux </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark553"></a><span class="font11" style="font-weight:bold;"><a name="bookmark24"></a><a name="bookmark554"></a>Chapter 4. installing Debian 8</span></h1></li></ul>
<p><span class="font25">This module is a step by step demonstration of an actual installation of </span><span class="font25" style="font-weight:bold;">Debian 8 </span><span class="font25">(also known as </span><span class="font25" style="font-weight:bold;">Jessie</span><span class="font25">).</span></p>
<p><span class="font25">We start by downloading an image from the internet and install </span><span class="font25" style="font-weight:bold;">Debian 8 </span><span class="font25">as a virtual machine in </span><span class="font25" style="font-weight:bold;">Virtualbox</span><span class="font25">. We will also do some basic configuration of this new machine like setting an </span><span class="font25" style="font-weight:bold;">ip address </span><span class="font25">and fixing a </span><span class="font25" style="font-weight:bold;">hostname</span><span class="font25">.</span></p>
<p><span class="font25">This procedure should be very similar for other versions of </span><span class="font25" style="font-weight:bold;">Debian</span><span class="font25">, and also for distributions like </span><span class="font25" style="font-weight:bold;">Linux Mint</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">xubuntu/ubuntu/kubuntu </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">Mepis</span><span class="font25">. This procedure can also be helpful if you are using another virtualization solution.</span></p>
<p><span class="font25">Go to the next chapter if you want to install </span><span class="font25" style="font-weight:bold;">CentOS, Fedora, Red Hat Enterprise Linux, ....</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark555"></a><span class="font10" style="font-weight:bold;"><a name="bookmark25"></a><a name="bookmark556"></a>4.1. Debian</span></h2></li></ul>
<p><span class="font25">Debian is one of the oldest Linux distributions. I use Debian myself on almost every computer that I own (including </span><span class="font25" style="font-weight:bold;">raspbian </span><span class="font25">on the </span><span class="font25" style="font-weight:bold;">Raspberry Pi</span><span class="font25">).</span></p>
<p><a name="bookmark557"></a><span class="font25">Debian comes in </span><span class="font25" style="font-weight:bold;">releases </span><span class="font25">named after characters in the movie </span><span class="font25" style="font-weight:bold;">Toy Story</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">Jessie </span><span class="font25">release contains about 36000 packages.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 4.1. Debian releases</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font24" style="font-weight:bold;">name</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24" style="font-weight:bold;">number</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24" style="font-weight:bold;">year</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">Woody</span></p></td><td style="vertical-align:top;">
<p><span class="font24">3.0</span></p></td><td style="vertical-align:top;">
<p><span class="font24">2002</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">Sarge</span></p></td><td style="vertical-align:top;">
<p><span class="font24">3.1</span></p></td><td style="vertical-align:top;">
<p><span class="font24">2005</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">Etch</span></p></td><td style="vertical-align:top;">
<p><span class="font24">4.0</span></p></td><td style="vertical-align:top;">
<p><span class="font24">2007</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">Lenny</span></p></td><td style="vertical-align:top;">
<p><span class="font24">5.0</span></p></td><td style="vertical-align:top;">
<p><span class="font24">2009</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">Squeeze</span></p></td><td style="vertical-align:top;">
<p><span class="font24">6.0</span></p></td><td style="vertical-align:top;">
<p><span class="font24">2011</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">Wheezy</span></p></td><td style="vertical-align:top;">
<p><span class="font24">7</span></p></td><td style="vertical-align:top;">
<p><span class="font24">2013</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">Jessie</span></p></td><td style="vertical-align:top;">
<p><span class="font24">8</span></p></td><td style="vertical-align:top;">
<p><span class="font24">2015</span></p></td></tr>
</table>
<p><span class="font25">There is never a fixed date for the next </span><span class="font25" style="font-weight:bold;">Debian </span><span class="font25">release. The next version is released when it is ready.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark558"></a><span class="font10" style="font-weight:bold;"><a name="bookmark26"></a><a name="bookmark559"></a>4.2. Downloading</span></h2></li></ul>
<p><span class="font25">All these screenshots were made in November 2014, which means </span><span class="font25" style="font-weight:bold;">Debian 8 </span><span class="font25">was still in 'testing' (but in 'freeze', so there will be no major changes when it is released).</span></p>
<p><span class="font25">Download Debian here:</span></p><img src="linux_guide_files/The Complete Linux Guide-3.jpg" alt="" style="width:410pt;height:268pt;">
<p><span class="font25">After a couple of clicks on that website, I ended up downloading </span><span class="font25" style="font-weight:bold;">Debian 8 </span><span class="font25">(testing) here. It should be only one click once </span><span class="font25" style="font-weight:bold;">Debian 8 </span><span class="font25">is released (somewhere in 2015).</span></p><img src="linux_guide_files/The Complete Linux Guide-4.jpg" alt="" style="width:382pt;height:250pt;">
<p><span class="font25">You have many other options to download and install </span><span class="font25" style="font-weight:bold;">Debian</span><span class="font25">. We will discuss them much later.</span></p>
<p><span class="font25">This small screenshot shows the downloading of a </span><span class="font25" style="font-weight:bold;">netinst </span><span class="font25">.iso file. Most of the software will be downloaded during the installation. This also means that you will have the most recent version of all packages when the install is finished.</span></p><img src="linux_guide_files/The Complete Linux Guide-5.jpg" alt="" style="width:361pt;height:63pt;">
<p><span class="font25">I already have Debian 8 installed on my laptop (hence the </span><span class="font25" style="font-weight:bold;">paul@debian8 </span><span class="font25">prompt). Anyway, this is the downloaded file just before starting the installation.</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">ls -hl debian-testing-amd64-netinst.iso</span></p>
<p><span class="font19">-rw-r--r-- 1 paul paul 231M Nov 10 17:59 debian-testing-amd64-netinst.iso</span></p>
<p><span class="font25">Create a new virtualbox machine (I already have five, you might have zero for now). Click the </span><span class="font25" style="font-weight:bold;">New </span><span class="font25">button to start a wizard that will help you create a virtual machine.</span></p><img src="linux_guide_files/The Complete Linux Guide-6.jpg" alt="" style="width:371pt;height:252pt;">
<p><span class="font25">The machine needs a name, this screenshot shows that I named it </span><span class="font25" style="font-weight:bold;">server42</span><span class="font25">.</span></p><img src="linux_guide_files/The Complete Linux Guide-7.jpg" alt="" style="width:300pt;height:240pt;">
<div>
<p><span class="font25">Most of the defaults in Virtualbox are ok.</span></p>
</div><br clear="all">
<div>
<p><span class="font25">512MB of RAM is enough to practice all the topics in this book.</span></p>
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-8.jpg" alt="" style="width:300pt;height:240pt;">
</div><br clear="all">
<div>
<p><span class="font25">We do not care about the virtual disk format.</span></p>
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-9.jpg" alt="" style="width:344pt;height:268pt;">
</div><br clear="all">
<p><span class="font25">Choosing </span><span class="font25" style="font-weight:bold;">dynamically allocated </span><span class="font25">will save you some disk space (for a small performance hit).</span></p><img src="linux_guide_files/The Complete Linux Guide-10.jpg" alt="" style="width:344pt;height:268pt;">
<p><span class="font25">8GB should be plenty for learning about Linux servers.</span></p><img src="linux_guide_files/The Complete Linux Guide-11.jpg" alt="" style="width:275pt;height:214pt;">
<p><span class="font25">This finishes the wizard. You virtual machine is almost ready to begin the installation.</span></p>
<p><span class="font25">First, make sure that you attach the downloaded .iso image to the virtual CD drive. (by opening </span><span class="font25" style="font-weight:bold;">Settings</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">Storage </span><span class="font25">followed by a mouse click on the round CD icon)</span></p><img src="linux_guide_files/The Complete Linux Guide-12.jpg" alt="" style="width:319pt;height:194pt;">
<p><span class="font25">Personally I also disable sound and usb, because I never use these features. I also remove the floppy disk and use a PS/2 mouse pointer. This is probably not very important, but I like the idea that it saves some resources.</span></p>
<p><span class="font25">Now boot the virtual machine and begin the actual installation. After a couple of seconds you should see a screen similar to this. Choose </span><span class="font25" style="font-weight:bold;">Install </span><span class="font25">to begin the installation of Debian.</span></p><img src="linux_guide_files/The Complete Linux Guide-13.jpg" alt="" style="width:330pt;height:281pt;">
<div>
<p><span class="font25">First select the language you want to use.</span></p>
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-14.jpg" alt="" style="width:361pt;height:300pt;">
</div><br clear="all">
<div>
<p><span class="font25">Choose your country. This information will be used to suggest a download mirror.</span></p>
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-15.jpg" alt="" style="width:361pt;height:300pt;">
</div><br clear="all">
<p><span class="font25">Choose the correct keyboard. On servers this is of no importance since most servers are remotely managed via </span><span class="font25" style="font-weight:bold;">ssh</span><span class="font25">.</span></p><img src="linux_guide_files/The Complete Linux Guide-16.jpg" alt="" style="width:361pt;height:300pt;">
<p><span class="font25">Enter a </span><span class="font25" style="font-weight:bold;">hostname </span><span class="font25">(with </span><span class="font25" style="font-weight:bold;">fqdn </span><span class="font25">to set a </span><span class="font25" style="font-weight:bold;">dnsdomainname</span><span class="font25">).</span></p><img src="linux_guide_files/The Complete Linux Guide-17.jpg" alt="" style="width:361pt;height:300pt;">
<p><span class="font25">Give the </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">user a password. Remember this password (or use </span><span class="font25" style="font-weight:bold;">hunter2</span><span class="font25">).</span></p><img src="linux_guide_files/The Complete Linux Guide-18.jpg" alt="" style="width:361pt;height:300pt;">
<p><span class="font25">It is adviced to also create a normal user account. I don't give my full name, Debian 8 accepts an identical username and full name </span><span class="font25" style="font-weight:bold;">paul</span><span class="font25">.</span></p><img src="linux_guide_files/The Complete Linux Guide-19.jpg" alt="" style="width:361pt;height:300pt;">
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">use entire disk </span><span class="font25">refers to the </span><span class="font25" style="font-weight:bold;">virtual disk </span><span class="font25">that you created before in </span><span class="font25" style="font-weight:bold;">Virtualbox</span><span class="font25">..</span></p><img src="linux_guide_files/The Complete Linux Guide-20.jpg" alt="" style="width:361pt;height:300pt;">
<p><span class="font25">Again the default is probably what you want. Only change partitioning if you really know what you are doing.</span></p><img src="linux_guide_files/The Complete Linux Guide-21.jpg" alt="" style="width:361pt;height:300pt;">
<p><span class="font25">Accept the partition layout (again only change if you really know what you are doing).</span></p><img src="linux_guide_files/The Complete Linux Guide-22.jpg" alt="" style="width:361pt;height:300pt;">
<p><span class="font25">This is the point of no return, the magical moment where pressing </span><span class="font25" style="font-weight:bold;">yes </span><span class="font25">will forever erase data on the (virtual) computer.</span></p><img src="linux_guide_files/The Complete Linux Guide-23.jpg" alt="" style="width:361pt;height:300pt;">
<p><span class="font25">Software is downloaded from a mirror repository, preferably choose one that is close by (as in the same country).</span></p><img src="linux_guide_files/The Complete Linux Guide-24.jpg" alt="" style="width:361pt;height:300pt;">
<p><span class="font25">This setup was done in Belgium.</span></p><img src="linux_guide_files/The Complete Linux Guide-25.jpg" alt="" style="width:361pt;height:300pt;">
<p><span class="font25">Leave the proxy field empty (unless you are sure that you are behind a proxy server).</span></p><img src="linux_guide_files/The Complete Linux Guide-26.jpg" alt="" style="width:361pt;height:300pt;">
<p><span class="font25">Choose whether you want to send anonymous statistics to the Debian project (it gathers data about installed packages). You can view the statistics here </span><a href="http://popcon.debian.org/"><span class="font25" style="font-weight:bold;">http://popcon.debian.org/</span></a><span class="font25">.</span></p><img src="linux_guide_files/The Complete Linux Guide-27.jpg" alt="" style="width:361pt;height:300pt;">
<div>
<p><span class="font25">Choose what software to install, we do not need any graphical stuff for this training.</span></p>
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-28.jpg" alt="" style="width:361pt;height:300pt;">
</div><br clear="all">
<div>
<p><span class="font25">The latest versions are being downloaded.</span></p>
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-29.jpg" alt="" style="width:361pt;height:300pt;">
</div><br clear="all">
<div>
<p><span class="font25">Say yes to install the bootloader on the virtual machine.</span></p>
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-30.jpg" alt="" style="width:361pt;height:300pt;">
</div><br clear="all">
<div>
<p><span class="font25">Booting for the first time shows the grub screen</span></p>
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-31.jpg" alt="" style="width:385pt;height:328pt;">
</div><br clear="all">
<p><span class="font25">A couple seconds later you should see a lot of text scrolling of the screen (</span><span class="font25" style="font-weight:bold;">dmesg</span><span class="font25">). After which you are presented with this </span><span class="font25" style="font-weight:bold;">getty </span><span class="font25">and are allowed your first logon.</span></p>
<p><span class="font2" style="font-weight:bold;">server42 [Running] - Oracle VM VirtualBox</span></p>
<p><span class="font1">Machine View Devices Help</span></p>
<p><span class="font3">Debian GNU/Linux jessie/sid senven42 ttyl</span></p>
<p><span class="font3">server42 login: _</span></p>
<p><span class="font4">IS &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="font1">S □ | </span><span class="font23" style="font-style:italic;">y</span><span class="font1"> lol Left WinKey</span></p>
<p><span class="font25">You should now be able to log on to your virtual machine with the </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">account. Do you remember the password ? Was it </span><span class="font25" style="font-weight:bold;">hunter2 </span><span class="font25">?</span></p><img src="linux_guide_files/The Complete Linux Guide-32.jpg" alt="" style="width:347pt;height:224pt;">
<p><span class="font25">The screenshots in this book will look like this from now on. You can just type those commands in the terminal (after you logged on).</span></p>
<p><span class="font19">root@server42:~# </span><span class="font19" style="font-weight:bold;">who am i</span></p>
<p><span class="font19">root ttyl &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2014-11-10 18:21</span></p>
<p><span class="font19">root@server42:~# </span><span class="font19" style="font-weight:bold;">hostname</span></p>
<p><span class="font19">server42</span></p>
<p><span class="font19">root@server42:~# </span><span class="font19" style="font-weight:bold;">date </span><span class="font19">Mon Nov 10 18:21:56 CET 2014</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark560"></a><span class="font10" style="font-weight:bold;"><a name="bookmark27"></a><a name="bookmark561"></a>4.3. virtualbox networking</span></h2></li></ul>
<h4><a name="bookmark562"></a><span class="font25"><a name="bookmark563"></a>You can also log on from remote (or from your Windows/Mac/Linux host computer) using </span><span class="font25" style="font-weight:bold;">ssh </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">putty</span><span class="font25">. Change the </span><span class="font25" style="font-weight:bold;">network </span><span class="font25">settings in the virtual machine to </span><span class="font25" style="font-weight:bold;">bridge</span><span class="font25">. This will enable your virtual machine to receive an ip address from your local dhcp server.</span></h4>
<h4><a name="bookmark564"></a><span class="font25"><a name="bookmark565"></a>The default virtualbox networking is to attach virtual network cards to </span><span class="font25" style="font-weight:bold;">nat</span><span class="font25">. This screenshiot shows the ip address </span><span class="font25" style="font-weight:bold;">10.0.2.15 </span><span class="font25">when on </span><span class="font25" style="font-weight:bold;">nat</span><span class="font25">:</span></h4>
<p><span class="font19">root@server42:~# </span><span class="font19" style="font-weight:bold;">ifconfig</span></p>
<p><span class="font19">eth0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Link encap:Ethernet HWaddr 08:00:27:f5:74:cf</span></p>
<p><span class="font19">inet addr:10.0.2.15 &nbsp;Bcast:10.0.2.255 Mask:255.255.255.0</span></p>
<p><span class="font19">inet6 addr: fe80::a00:27ff:fef5:74cf/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:11 errors:0 dropped:0 overruns:0 frame:0 TX packets:19 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000</span></p>
<p><span class="font19">RX bytes:2352 (2.2 KiB) TX bytes:1988 (1.9 KiB)</span></p>
<p><span class="font19">lo &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Link encap:Local Loopback</span></p>
<p><span class="font19">inet addr:127.0.0.1 Mask:255.0.0.0</span></p>
<p><span class="font19">inet6 addr: ::1/128 Scope:Host</span></p>
<p><span class="font19">UP LOOPBACK RUNNING MTU:65536 Metric:1</span></p>
<p><span class="font19">RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span></p>
<p><span class="font19">TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0</span></p>
<p><span class="font19">RX bytes:0 (0.0 B) TX bytes:0 (0.0 B)</span></p><img src="linux_guide_files/The Complete Linux Guide-33.jpg" alt="" style="width:319pt;height:194pt;">
<h4><a name="bookmark566"></a><span class="font25"><a name="bookmark567"></a>By shutting down the network interface and enabling it again, we force Debian to renew an ip address from the bridged network.</span></h4>
<p><span class="font19">root@server42:~# </span><span class="font19" style="font-weight:bold;"># do not run ifdown while connected over ssh! </span><span class="font19">root@server42:~# </span><span class="font19" style="font-weight:bold;">ifdown eth0 </span><span class="font19">Killed old client process Internet Systems Consortium DHCP Client 4.3.1 Copyright 2004-2014 Internet Systems Consortium.</span></p>
<p><span class="font19">All rights reserved.</span></p>
<p><span class="font19">For info, please visit </span><a href="https://www.isc.org/software/dhcp/"><span class="font19">https://www.isc.org/software/dhcp/</span></a></p>
<p><span class="font19">Listening on LPF/eth0/08:00:27:f5:74:cf</span></p>
<p><span class="font19">Sending on LPF/eth0/08:00:27:f5:74:cf</span></p>
<p><span class="font19">Sending on Socket/fallback</span></p>
<p><span class="font19">DHCPRELEASE on eth0 to 10.0.2.2 port 67</span></p>
<p><span class="font19">root@server42:~# </span><span class="font19" style="font-weight:bold;"># now enable bridge in virtualbox settings </span><span class="font19">root@server42:~# </span><span class="font19" style="font-weight:bold;">ifup eth0</span></p>
<p><span class="font19">Internet Systems Consortium DHCP Client 4.3.1</span></p>
<p><span class="font19">Copyright 2004-2014 Internet Systems Consortium.</span></p>
<p><span class="font19">All rights reserved.</span></p>
<p><span class="font19">For info, please visit </span><a href="https://www.isc.org/software/dhcp/"><span class="font19">https://www.isc.org/software/dhcp/</span></a></p>
<p><span class="font19">Listening on LPF/eth0/08:00:27:f5:74:cf</span></p>
<p><span class="font19">Sending on LPF/eth0/08:00:27:f5:74:cf</span></p>
<p><span class="font19">Sending on Socket/fallback</span></p>
<p><span class="font19">DHCPDISCOVER on eth0 to 255.255.255.255 port 67 interval 8</span></p>
<p><span class="font19">DHCPDISCOVER on eth0 to 255.255.255.255 port 67 interval 8</span></p>
<p><span class="font19">DHCPREQUEST on eth0 to 255.255.255.255 port 67</span></p>
<p><span class="font19">DHCPOFFER from 192.168.1.42</span></p>
<p><span class="font19">DHCPACK from 192.168.1.42</span></p>
<p><span class="font19">bound to 192.168.1.111 -- renewal in 2938 seconds.</span></p>
<p><span class="font19">root@server42:~# </span><span class="font19" style="font-weight:bold;">ifconfig eth0</span></p>
<p><span class="font19">eth0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Link encap:Ethernet HWaddr 08:00:27:f5:74:cf</span></p>
<p><span class="font19">inet addr:192.168.1.111 Bcast:192.168.1.255 Mask:255.255.255.0 inet6 addr: fe80::a00:27ff:fef5:74cf/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:15 errors:0 dropped:0 overruns:0 frame:0 TX packets:31 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000</span></p>
<p><span class="font19">RX bytes:3156 (3.0 KiB) TX bytes:3722 (3.6 KiB) root@server42:~#</span></p>
<h4><a name="bookmark568"></a><span class="font25"><a name="bookmark569"></a>Here is an example of </span><span class="font25" style="font-weight:bold;">ssh </span><span class="font25">to this freshly installed computer. Note that </span><span class="font25" style="font-weight:bold;">Debian 8 </span><span class="font25">has disabled remote root access, so i need to use the normal user account.</span></h4>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">ssh </span><a href="mailto:paul@192.168.1.111"><span class="font19" style="font-weight:bold;">paul@192.168.1.111</span></a></p>
<p><span class="font19">paul@192.168.1.111's password:</span></p>
<p><span class="font19">The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright.</span></p>
<p><span class="font19">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law.</span></p>
<p><span class="font19">paul@server42:~$</span></p>
<p><span class="font19">paul@server42:~$ </span><span class="font19" style="font-weight:bold;">su -</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">root@server42:~#</span></p>
<h4><a name="bookmark570"></a><span class="font25"><a name="bookmark571"></a>TODO: putty screenshot here...</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark572"></a><span class="font10" style="font-weight:bold;"><a name="bookmark28"></a><a name="bookmark573"></a>4.4. setting the hostname</span></h2></li></ul>
<h4><a name="bookmark574"></a><span class="font25"><a name="bookmark575"></a>The hostname of the server is asked during installation, so there is no need to configure this manually.</span></h4>
<p><span class="font19">root@server42:~# </span><span class="font19" style="font-weight:bold;">hostname </span><span class="font19">server42</span></p>
<p><span class="font19">root@server42:~# </span><span class="font19" style="font-weight:bold;">cat /etc/hostname </span><span class="font19">server42</span></p>
<p><span class="font19">root@server42:~# </span><span class="font19" style="font-weight:bold;">dnsdomainname</span></p>
<p><span class="font19">paul.local</span></p>
<p><span class="font19">root@server42:~# </span><span class="font19" style="font-weight:bold;">grep server42 /etc/hosts</span></p>
<p><span class="font19">127.0.1.1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server42.paul.local server42</span></p>
<p><span class="font19">root@server42:~#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark576"></a><span class="font10" style="font-weight:bold;"><a name="bookmark29"></a><a name="bookmark577"></a>4.5. adding a static ip address</span></h2></li></ul>
<h4><a name="bookmark578"></a><span class="font25"><a name="bookmark579"></a>This example shows how to add a static ip address to your server.</span></h4>
<h4><a name="bookmark580"></a><span class="font25"><a name="bookmark581"></a>You can use </span><span class="font25" style="font-weight:bold;">ifconfig </span><span class="font25">to set a static address that is active until the next </span><span class="font25" style="font-weight:bold;">reboot </span><span class="font25">(or until the next </span><span class="font25" style="font-weight:bold;">ifdown</span><span class="font25">). </span><span class="font24">a</span></h4>
<p><span class="font19">root@server42:~# </span><span class="font19" style="font-weight:bold;">ifconfig eth0:0 10.104.33.39</span></p>
<h4><a name="bookmark582"></a><span class="font25"><a name="bookmark583"></a>Adding a couple of lines to the </span><span class="font25" style="font-weight:bold;">/etc/network/interfaces </span><span class="font25">file to enable an extra ip address forever.</span></h4>
<p><span class="font19">root@server42:~# </span><span class="font19" style="font-weight:bold;">vi /etc/network/interfaces</span></p>
<p><span class="font19">root@server42:~# </span><span class="font19" style="font-weight:bold;">tail -4 /etc/network/interfaces </span><span class="font19">auto eth0:0 iface eth0:0 inet static address 10.104.33.39 netmask 255.255.0.0</span></p>
<p><span class="font19">root@server42:~# </span><span class="font19" style="font-weight:bold;">ifconfig</span></p>
<p><span class="font19">eth0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Link encap:Ethernet HWaddr 08:00:27:f5:74:cf</span></p>
<p><span class="font19">inet addr:192.168.1.111 Bcast:192.168.1.255 Mask:255.255.255.0 inet6 addr: fe80::a00:27ff:fef5:74cf/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:528 errors:0 dropped:0 overruns:0 frame:0 TX packets:333 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000</span></p>
<p><span class="font19">RX bytes:45429 (44.3 KiB) TX bytes:48763 (47.6 KiB)</span></p>
<p><span class="font19">eth0:0 Link encap:Ethernet HWaddr 08:00:27:f5:74:cf inet addr:10.104.33.39 Bcast:10.255.255.255 Mask:255.0.0.0 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1</span></p>
<p><span class="font19">lo &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Link encap:Local Loopback</span></p>
<p><span class="font19">inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B)</span></p>
<p><span class="font19">root@server42:~#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark584"></a><span class="font10" style="font-weight:bold;"><a name="bookmark30"></a><a name="bookmark585"></a>4.6. Debian package management</span></h2></li></ul>
<h4><a name="bookmark586"></a><span class="font25"><a name="bookmark587"></a>To get all information about the newest packages form the online repository:</span></h4>
<p><span class="font19">root@server42:~# </span><span class="font19" style="font-weight:bold;">aptitude update</span></p>
<p><span class="font19">Get: 1 </span><a href="http://ftp.be.debian.org"><span class="font19">http://ftp.be.debian.org</span></a><span class="font19"> jessie InRelease [191 kB]</span></p>
<p><span class="font19">Get: 2 </span><a href="http://security.debian.org"><span class="font19">http://security.debian.org</span></a><span class="font19"> jessie/updates InRelease [84.1 kB]</span></p>
<p><span class="font19">Get: 3 </span><a href="http://ftp.be.debian.org"><span class="font19">http://ftp.be.debian.org</span></a><span class="font19"> jessie-updates InRelease [117 kB]</span></p>
<p><span class="font19">Get: 4 </span><a href="http://ftp.be.debian.org"><span class="font19">http://ftp.be.debian.org</span></a><span class="font19"> jessie-backports InRelease [118 kB]</span></p>
<p><span class="font19">Get: 5 </span><a href="http://security.debian.org"><span class="font19">http://security.debian.org</span></a><span class="font19"> jessie/updates/main Sources [14 B]</span></p>
<p><span class="font19">Get: 6 </span><a href="http://ftp.be.debian.org"><span class="font19">http://ftp.be.debian.org</span></a><span class="font19"> jessie/main Sources/DiffIndex [7,876 B] ... (output truncated)</span></p>
<h4><a name="bookmark588"></a><span class="font25"><a name="bookmark589"></a>To download and apply all updates for all installed packages:</span></h4>
<p><span class="font19">root@server42:~# </span><span class="font19" style="font-weight:bold;">aptitude upgrade</span></p>
<p><span class="font19">Resolving dependencies...</span></p>
<p><span class="font19">The following NEW packages will be installed:</span></p>
<p><span class="font19">firmware-linux-free{a} irqbalance{a} libnuma1{a} linux-image-3.16.0-4-amd64{a}</span></p>
<p><span class="font19">The following packages will be upgraded:</span></p>
<p><span class="font19">busybox file libc-bin libc6 libexpat1 libmagic1 libpaper-utils libpaper1 libsqlite3-0 linux-image-amd64 locales multiarch-support</span></p>
<p><span class="font19">12 packages upgraded, 4 newly installed, 0 to remove and 0 not upgraded.</span></p>
<p><span class="font19">Need to get 44.9 MB of archives. After unpacking 161 MB will be used.</span></p>
<p><span class="font19">Do you want to continue? [Y/n/?] ... (output truncated)</span></p>
<h4><a name="bookmark590"></a><span class="font25"><a name="bookmark591"></a>To install new software (</span><span class="font25" style="font-weight:bold;">vim </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">tmux </span><span class="font25">in this example):</span></h4>
<p><span class="font19">root@server42:~# </span><span class="font19" style="font-weight:bold;">aptitude install vim tmux</span></p>
<p><span class="font19">The following NEW packages will be installed: tmux vim vim-runtime{a}</span></p>
<p><span class="font19">0 packages upgraded, 3 newly installed, 0 to remove and 0 not upgraded.</span></p>
<p><span class="font19">Need to get 6,243 kB of archives. After unpacking 29.0 MB will be used.</span></p>
<p><span class="font19">Do you want to continue? [Y/n/?]</span></p>
<p><span class="font19">Get: 1 </span><a href="http://ftp.be.debian.org/debian/"><span class="font19">http://ftp.be.debian.org/debian/</span></a><span class="font19"> jessie/main tmux amd64 1.9-6 [245 kB]</span></p>
<p><span class="font19">Get: 2 </span><a href="http://ftp.be.debian.org/debian/"><span class="font19">http://ftp.be.debian.org/debian/</span></a><span class="font19"> jessie/main vim-runtime all 2:7.4.488-1 [5,046 kB]</span></p>
<p><span class="font19">Get: 3 </span><a href="http://ftp.be.debian.org/debian/"><span class="font19">http://ftp.be.debian.org/debian/</span></a><span class="font19"> jessie/main vim amd64 2:7.4.488-1 [952 kB]</span></p>
<h4><a name="bookmark592"></a><span class="font25"><a name="bookmark593"></a>Refer to the </span><span class="font25" style="font-weight:bold;">package management </span><span class="font25">chapter in LinuxAdm.pdf for more information.</span></h4>
<ul style="list-style:none;"><li>
<h1><a name="bookmark594"></a><span class="font11" style="font-weight:bold;"><a name="bookmark31"></a><a name="bookmark595"></a>Chapter 5. installing CentOS 7</span></h1></li></ul>
<p><span class="font25">This module is a step by step demonstration of an actual installation of </span><span class="font25" style="font-weight:bold;">CentOS 7</span><span class="font25">.</span></p>
<p><span class="font25">We start by downloading an image from the internet and install </span><span class="font25" style="font-weight:bold;">CentOS 7 </span><span class="font25">as a virtual machine in </span><span class="font25" style="font-weight:bold;">Virtualbox</span><span class="font25">. We will also do some basic configuration of this new machine like setting an </span><span class="font25" style="font-weight:bold;">ip address </span><span class="font25">and fixing a </span><span class="font25" style="font-weight:bold;">hostname</span><span class="font25">.</span></p>
<p><span class="font25">This procedure should be very similar for other versions of </span><span class="font25" style="font-weight:bold;">CentOS</span><span class="font25">, and also for distributions like </span><span class="font25" style="font-weight:bold;">RHEL </span><span class="font25">(Red Hat Enterprise Linux) or </span><span class="font25" style="font-weight:bold;">Fedora</span><span class="font25">. This procedure can also be helpful if you are using another virtualization solution.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark596"></a><span class="font10" style="font-weight:bold;"><a name="bookmark32"></a><a name="bookmark597"></a>5.1. download a CentOS 7 image</span></h2></li></ul>
<p><span class="font25">This demonstration uses a laptop computer with </span><span class="font25" style="font-weight:bold;">Virtualbox </span><span class="font25">to install </span><span class="font25" style="font-weight:bold;">CentOS 7 </span><span class="font25">as a virtual machine. The first task is to download an </span><span class="font25" style="font-weight:bold;">.iso </span><span class="font25">image of </span><span class="font25" style="font-weight:bold;">CentOS 7</span><span class="font25">.</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">CentOS 7 </span><span class="font25">website looks like this today (November 2014). They change the look regularly, so it may look different when you visit it.</span></p><img src="linux_guide_files/The Complete Linux Guide-34.jpg" alt="" style="width:411pt;height:285pt;">
<p><span class="font25">You can download a full DVD, which allows for an off line installation of a graphical </span><span class="font25" style="font-weight:bold;">CentOS 7 </span><span class="font25">desktop. You can select this because it should be easy and complete, and should get you started with a working </span><span class="font25" style="font-weight:bold;">CentOS 7 </span><span class="font25">virtual machine.</span></p>
<p><span class="font25">But I clicked instead on 'alternative downloads', selected </span><span class="font25" style="font-weight:bold;">CentOS 7 </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">x86_64 </span><span class="font25">and ended up on a </span><span class="font25" style="font-weight:bold;">mirror list</span><span class="font25">. Each mirror is a server that contains copies of </span><span class="font25" style="font-weight:bold;">CentOS 7 </span><span class="font25">media. I selected a Belgian mirror because I currently am in Belgium.</span></p><img src="linux_guide_files/The Complete Linux Guide-35.jpg" alt="" style="width:411pt;height:285pt;">
<p><span class="font25">There is again the option for full DVD's and more. This demonstration will use the </span><span class="font25" style="font-weight:bold;">minimal </span><span class="font25">.iso file, because it is much smaller in size. The download takes a couple of minutes.</span></p><img src="linux_guide_files/The Complete Linux Guide-36.jpg" alt="" style="width:340pt;height:63pt;">
<p><span class="font25">Verify the size of the file after download to make sure it is complete. Probably a right click on the file and selecting 'properties' (if you use Windows or Mac OSX).</span></p>
<p><span class="font25">I use Linux on the laptop already:</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">ls -lh CentOS-7.0-1406-x86_64-Minimal.iso</span></p>
<p><span class="font19">-rw-r--r-- 1 paul paul 566M Nov 1 14:45 CentOS-7.0-1406-x86_64-Minimal.iso</span></p>
<p><span class="font25">Do not worry if you do no understand the above command. Just try to make sure that the size of this file is the same as the size that is mentioned on the </span><span class="font25" style="font-weight:bold;">CentOS 7 </span><span class="font25">website.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark598"></a><span class="font10" style="font-weight:bold;"><a name="bookmark33"></a><a name="bookmark599"></a>5.2. Virtualbox</span></h2></li></ul>
<p><span class="font25">This screenshot shows up when I start Virtualbox. I already have four virtual machines, you might have none.</span></p><img src="linux_guide_files/The Complete Linux Guide-37.jpg" alt="" style="width:428pt;height:291pt;">
<p><span class="font25">Below are the steps for creating a new virtual machine. Start by clicking </span><span class="font25" style="font-weight:bold;">New </span><span class="font25">and give your machine a name (I chose </span><span class="font25" style="font-weight:bold;">server33</span><span class="font25">). Click </span><span class="font25" style="font-weight:bold;">Next</span><span class="font25">.</span></p><img src="linux_guide_files/The Complete Linux Guide-38.jpg" alt="" style="width:300pt;height:240pt;">
<div>
<p><span class="font25">A Linux computer without graphical interface will run fine on </span><span class="font25" style="font-weight:bold;">half a gigabyte </span><span class="font25">of RAM.</span></p>
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-39.jpg" alt="" style="width:300pt;height:240pt;">
</div><br clear="all">
<div>
<p><span class="font25">A Linux virtual machine will need a </span><span class="font25" style="font-weight:bold;">virtual hard drive</span><span class="font25">.</span></p>
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-40.jpg" alt="" style="width:300pt;height:240pt;">
</div><br clear="all">
<p><span class="font25">Any format will do for our purpose, so I left the default </span><span class="font25" style="font-weight:bold;">vdi</span><span class="font25">.</span></p><img src="linux_guide_files/The Complete Linux Guide-41.jpg" alt="" style="width:344pt;height:268pt;">
<p><span class="font25">The default </span><span class="font25" style="font-weight:bold;">dynamically allocated </span><span class="font25">type will save disk space (until we fill the virtual disk up to 100 percent). It makes the virtual machine a bit slower than </span><span class="font25" style="font-weight:bold;">fixed size</span><span class="font25">, but the </span><span class="font25" style="font-weight:bold;">fixed size </span><span class="font25">speed improvement is not worth it for our purpose.</span></p><img src="linux_guide_files/The Complete Linux Guide-42.jpg" alt="" style="width:344pt;height:268pt;">
<p><span class="font25">The name of the virtual disk file on the host computer will be </span><span class="font25" style="font-weight:bold;">server33.vdi </span><span class="font25">in my case (I left it default and it uses the vm name). Also 16 GB should be enough to practice Linux. The file will stay much smaller than 16GB, unless you copy a lot of files to the virtual machine.</span></p><img src="linux_guide_files/The Complete Linux Guide-43.jpg" alt="" style="width:344pt;height:268pt;">
<p><span class="font25">You should now be back to the start screen of </span><span class="font25" style="font-weight:bold;">Virtualbox</span><span class="font25">. If all went well, then you should see the machine you just created in the list.</span></p><img src="linux_guide_files/The Complete Linux Guide-44.jpg" alt="" style="width:428pt;height:291pt;">
<p><span class="font25">After finishing the setup, we go into the </span><span class="font25" style="font-weight:bold;">Settings </span><span class="font25">of our virtual machine and attach the </span><span class="font25" style="font-weight:bold;">.iso </span><span class="font25">file we downloaded before. Below is the default screenshot.</span></p><img src="linux_guide_files/The Complete Linux Guide-45.jpg" alt="" style="width:399pt;height:243pt;">
<p><span class="font25">This is a screenshot with the </span><span class="font25" style="font-weight:bold;">.iso </span><span class="font25">file properly attached.</span></p><img src="linux_guide_files/The Complete Linux Guide-46.jpg" alt="" style="width:399pt;height:243pt;">
<ul style="list-style:none;"><li>
<h2><a name="bookmark600"></a><span class="font10" style="font-weight:bold;"><a name="bookmark34"></a><a name="bookmark601"></a>5.3. CentOS 7 installing</span></h2></li></ul>
<p><span class="font25">The screenshots below will show every step from starting the virtual machine for the first time (with the .iso file attached) until the first logon.</span></p>
<p><span class="font25">You should see this when booting, otherwise verify the attachment of the .iso file form the previous steps. Select </span><span class="font25" style="font-weight:bold;">Test this media and install CentOS 7</span><span class="font25">.</span></p><img src="linux_guide_files/The Complete Linux Guide-47.jpg" alt="" style="width:308pt;height:262pt;">
<p><span class="font25">Carefully select the language in which you want your </span><span class="font25" style="font-weight:bold;">CentOS</span><span class="font25">. I always install operating systems in English, even though my native language is not English.</span></p>
<p><span class="font25">Also select the right keyboard, mine is a US qwerty, but yours may be different.</span></p><img src="linux_guide_files/The Complete Linux Guide-48.jpg" alt="" style="width:352pt;height:286pt;">
<p><span class="font25">You should arrive at a summary page (with one or more warnings).</span></p><img src="linux_guide_files/The Complete Linux Guide-49.jpg" alt="" style="width:352pt;height:286pt;">
<p><span class="font25">Start by configuring the network. During this demonstration I had a DHCP server running at 192.168.1.42, yours is probably different. Ask someone (a network administator ?) for help if this step fails.</span></p><img src="linux_guide_files/The Complete Linux Guide-50.jpg" alt="" style="width:352pt;height:286pt;">
<p><span class="font25">Select your time zone, and activate </span><span class="font25" style="font-weight:bold;">ntp</span><span class="font25">.</span></p><img src="linux_guide_files/The Complete Linux Guide-51.jpg" alt="" style="width:352pt;height:286pt;">
<p><span class="font25">Choose a mirror that is close to you. If you can't find a local mirror, then you can copy the one from this screenshot (it is a general </span><span class="font25" style="font-weight:bold;">CentOS </span><span class="font25">mirror).</span></p><img src="linux_guide_files/The Complete Linux Guide-52.jpg" alt="" style="width:352pt;height:286pt;">
<p><span class="font25">It can take a couple of seconds before the mirror is verified.</span></p><img src="linux_guide_files/The Complete Linux Guide-53.jpg" alt="" style="width:352pt;height:286pt;">
<p><span class="font25">I did not select any software here (because I want to show it all in this training).</span></p><img src="linux_guide_files/The Complete Linux Guide-54.jpg" alt="" style="width:352pt;height:286pt;">
<p><span class="font25">After configuring network, location, software and all, you should be back on this page. Make sure there are no warnings anymore (and that you made the correct choice everywhere).</span></p><img src="linux_guide_files/The Complete Linux Guide-55.jpg" alt="" style="width:352pt;height:286pt;">
<p><span class="font25">You can enter a </span><span class="font25" style="font-weight:bold;">root password </span><span class="font25">and create a </span><span class="font25" style="font-weight:bold;">user account </span><span class="font25">while the installation is downloading from the internet. This is the longest step, it can take several minutes (or up to an hour if you have a slow internet connection).</span></p><img src="linux_guide_files/The Complete Linux Guide-56.jpg" alt="" style="width:352pt;height:286pt;">
<p><span class="font25">If you see this, then the installation was successful.</span></p>
<p><span class="font25">Time to reboot the computer and start </span><span class="font25" style="font-weight:bold;">CentOS 7 </span><span class="font25">for the first time.</span></p><img src="linux_guide_files/The Complete Linux Guide-57.jpg" alt="" style="width:352pt;height:286pt;">
<p><span class="font25">This screen will appear briefly when the virtual machines starts. You don't have to do anything.</span></p><img src="linux_guide_files/The Complete Linux Guide-58.jpg" alt="" style="width:347pt;height:224pt;">
<p><span class="font25">After a couple of seconds, you should see a logon screen. This is called a </span><span class="font25" style="font-weight:bold;">tty </span><span class="font25">or a </span><span class="font25" style="font-weight:bold;">getty</span><span class="font25">. Here you can type </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">as username. The </span><span class="font25" style="font-weight:bold;">login process </span><span class="font25">will then ask your password (nothing will appear on screen when you type your password).</span></p><img src="linux_guide_files/The Complete Linux Guide-59.jpg" alt="" style="width:347pt;height:224pt;">
<h4><a name="bookmark602"></a><span class="font25"><a name="bookmark603"></a>And this is what it looks like after logon. You are logged on to your own Linux machine, very good.</span></h4>
<p><span class="font2" style="font-weight:bold;">server33 [Running] - Oracle VM VirtualBox</span></p>
<p><span class="font1">Machine View Devices Help</span></p>
<p><span class="font17" style="font-weight:bold;">CentOS Linux 7 (Core)</span></p>
<p><span class="font17" style="font-weight:bold;">Kernel 3.10.0-1Z3.e17.x86_64 on an x86_64</span></p>
<p><span class="font17" style="font-weight:bold;">localhost login: root</span></p>
<p><span class="font17" style="font-weight:bold;">Password:</span></p>
<p><span class="font17" style="font-weight:bold;">ErootO1oca 1host ~ltt</span></p>
<p><span class="font4">IS &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="font1">S □ | </span><span class="font23" style="font-style:italic;">y</span><span class="font1"> lol Left WinKey</span></p>
<h4><a name="bookmark604"></a><span class="font25"><a name="bookmark605"></a>All subsequent screenshots will be text only, no images anymore.</span></h4>
<h4><a name="bookmark606"></a><span class="font25"><a name="bookmark607"></a>For example this screenshot shows three commands being typed on my new CentOS 7 install.</span></h4>
<p><span class="font19">[root@localhost ~]# </span><span class="font19" style="font-weight:bold;">who am i</span></p>
<p><span class="font19">root pts/0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2014-11-01 22:14</span></p>
<p><span class="font19">[root@localhost ~]# </span><span class="font19" style="font-weight:bold;">hostname </span><span class="font19">localhost.localdomain [root@localhost ~]# </span><span class="font19" style="font-weight:bold;">date</span></p>
<p><span class="font19">Sat Nov 1 22:14:37 CET 2014</span></p>
<h4><a name="bookmark608"></a><span class="font25"><a name="bookmark609"></a>When using </span><span class="font25" style="font-weight:bold;">ssh </span><span class="font25">the same commands will give this screenshot:</span></h4>
<p><span class="font19">[root@localhost ~]# </span><span class="font19" style="font-weight:bold;">who am i</span></p>
<p><span class="font19">root pts/0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2014-11-01 21:00 (192.168.1.35)</span></p>
<p><span class="font19">[root@localhost ~]# </span><span class="font19" style="font-weight:bold;">hostname</span></p>
<p><span class="font19">localhost.localdomain [root@localhost ~]# </span><span class="font19" style="font-weight:bold;">date</span></p>
<p><span class="font19">Sat Nov 1 22:10:04 CET 2014</span></p>
<p><span class="font19">[root@localhost ~]#</span></p>
<h4><a name="bookmark610"></a><span class="font25"><a name="bookmark611"></a>If the last part is a bit too fast, take a look at the next topic </span><span class="font25" style="font-weight:bold;">CentOS 7 first logon</span><span class="font25">.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark612"></a><span class="font10" style="font-weight:bold;"><a name="bookmark35"></a><a name="bookmark613"></a>5.4. CentOS 7 first logon</span></h2></li></ul>
<p><span class="font25">All you have to log on, after finishing the installation, is this screen in Virtualbox.</span></p><img src="linux_guide_files/The Complete Linux Guide-60.jpg" alt="" style="width:347pt;height:224pt;">
<p><span class="font25">This is workable to learn Linux, and you will be able to practice a lot. But there are more ways to access your virtual machine, the next chapters discuss some of these and will also introduce some basic system configuration.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark533"></a><span class="font9" style="font-weight:bold;"><a name="bookmark614"></a>5.4.1. setting the hostname</span></h3></li></ul>
<p><span class="font25">Setting the hostname is a simple as changing the </span><span class="font25" style="font-weight:bold;">/etc/hostname </span><span class="font25">file. As you can see here, it is set to </span><span class="font25" style="font-weight:bold;">localhost.localdomain </span><span class="font25">by default.</span></p>
<p><span class="font19">[root@localhost ~]# </span><span class="font19" style="font-weight:bold;">cat /etc/hostname</span></p>
<p><span class="font19">localhost.localdomain</span></p>
<p><span class="font25">You could do </span><span class="font25" style="font-weight:bold;">echo server33.netsec.local &gt;&nbsp;/etc/hostname </span><span class="font25">followed by a </span><span class="font25" style="font-weight:bold;">reboot</span><span class="font25">. But there is also the new </span><span class="font25" style="font-weight:bold;">CentOS 7 </span><span class="font25">way of setting a new hostname.</span></p>
<p><span class="font19">[root@localhost ~]# </span><span class="font19" style="font-weight:bold;">nmtui</span></p>
<p><span class="font25">The above command will give you a menu to choose from with a </span><span class="font25" style="font-weight:bold;">set system hostname </span><span class="font25">option. Using this </span><span class="font25" style="font-weight:bold;">nmtui </span><span class="font25">option will edit the </span><span class="font25" style="font-weight:bold;">/etc/hostname </span><span class="font25">file for you.</span></p>
<p><span class="font19">[root@localhost ~]# </span><span class="font19" style="font-weight:bold;">cat /etc/hostname</span></p>
<p><span class="font19">server33.netsec.local</span></p>
<p><span class="font19">[root@localhost ~]# </span><span class="font19" style="font-weight:bold;">hostname</span></p>
<p><span class="font19">server33.netsec.local</span></p>
<p><span class="font19">[root@localhost ~]# </span><span class="font19" style="font-weight:bold;">dnsdomainname </span><span class="font19">netsec.local</span></p>
<p><span class="font25">For some reason the documentation on the </span><span class="font25" style="font-weight:bold;">centos.org </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">docs.redhat.com </span><span class="font25">websites tell you to also execute this command:</span></p>
<p><span class="font19">[root@localhost ~]# </span><span class="font19" style="font-weight:bold;">systemctl restart systemd-hostnamed</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark615"></a><span class="font10" style="font-weight:bold;"><a name="bookmark36"></a><a name="bookmark616"></a>5.5. Virtualbox network interface</span></h2></li></ul>
<h4><a name="bookmark617"></a><span class="font25"><a name="bookmark618"></a>By default </span><span class="font25" style="font-weight:bold;">Virtualbox </span><span class="font25">will connect your virtual machine over a </span><span class="font25" style="font-weight:bold;">nat </span><span class="font25">interface. This will show up as a 10.0.2.15 (or similar).</span></h4>
<p><span class="font19">[root@server33 ~]# </span><span class="font19" style="font-weight:bold;">ip a</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN</span></p></li></ul>
<p><span class="font19">link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span></p>
<p><span class="font19">inet 127.0.0.1/8 scope host lo</span></p>
<p><span class="font19">valid_lft forever preferred_lft forever</span></p>
<p><span class="font19">inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast s\ tate UP qlen 1000</span></p>
<p><span class="font19">link/ether 08:00:27:1c:f5:ab brd ff:ff:ff:ff:ff:ff</span></p>
<p><span class="font19">inet 10.0.2.15/24 brd 10.0.2.255 scope global dynamic enp0s3</span></p>
<p><span class="font19">valid_lft 86399sec preferred_lft 86399sec</span></p>
<p><span class="font19">inet6 fe80::a00:27ff:fe1c:f5ab/64 scope link valid_lft forever preferred_lft forever</span></p>
<h4><a name="bookmark619"></a><span class="font25"><a name="bookmark620"></a>You can change this to </span><span class="font25" style="font-weight:bold;">bridge </span><span class="font25">(over your wi-fi or over the ethernet cable) and thus make it appear as if your virtual machine is directly on your local network (receiving an ip address from your real dhcp server).</span></h4><img src="linux_guide_files/The Complete Linux Guide-61.jpg" alt="" style="width:399pt;height:243pt;">
<h4><a name="bookmark621"></a><span class="font25"><a name="bookmark622"></a>You can make this change while the vm is running, provided that you execute this command:</span></h4>
<p><span class="font19">[root@server33 ~]# </span><span class="font19" style="font-weight:bold;">systemctl restart network</span></p>
<p><span class="font19">[root@server33 ~]# </span><span class="font19" style="font-weight:bold;">ip a s dev enp0s3</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast s\ tate UP qlen 1000</span></p></li></ul>
<p><span class="font19">link/ether 08:00:27:1c:f5:ab brd ff:ff:ff:ff:ff:ff</span></p>
<p><span class="font19">inet 192.168.1.110/24 brd 192.168.1.255 scope global dynamic enp0s3</span></p>
<p><span class="font19">valid_lft 7199sec preferred_lft 7199sec</span></p>
<p><span class="font19">inet6 fe80::a00:27ff:fe1c:f5ab/64 scope link</span></p>
<p><span class="font19">valid_lft forever preferred_lft forever</span></p>
<p><span class="font19">[root@server33 ~] #</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark623"></a><span class="font10" style="font-weight:bold;"><a name="bookmark37"></a><a name="bookmark624"></a>5.6. configuring the network</span></h2></li></ul>
<h4><a name="bookmark625"></a><span class="font25"><a name="bookmark626"></a>The new way of changing network configuration is through the </span><span class="font25" style="font-weight:bold;">nmtui </span><span class="font25">tool. If you want to manually play with the files in </span><span class="font25" style="font-weight:bold;">/etc/sysconfig/network-scripts </span><span class="font25">then you will first need to verify (and disable) </span><span class="font25" style="font-weight:bold;">NetworkManager </span><span class="font25">on that interface.</span></h4>
<h4><a name="bookmark627"></a><span class="font25"><a name="bookmark628"></a>Verify whether an interface is controlled by </span><span class="font25" style="font-weight:bold;">NetworkManager </span><span class="font25">using the </span><span class="font25" style="font-weight:bold;">nmcli </span><span class="font25">command (connected means managed bu NM).</span></h4>
<p><span class="font19">[root@server33 ~]# </span><span class="font19" style="font-weight:bold;">nmcli dev status</span></p>
<p><span class="font19">DEVICE TYPE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONNECTION</span></p>
<p><span class="font19">enp0s3 ethernet connected enp0s3 lo loopback unmanaged --</span></p>
<h4><a name="bookmark629"></a><span class="font25"><a name="bookmark630"></a>Disable </span><span class="font25" style="font-weight:bold;">NetworkManager </span><span class="font25">on an interface (enp0s3 in this case):</span></h4>
<p><span class="font19">echo 'NM_CONTROLLED=no' &gt;&gt;&nbsp;/etc/sysconfig/network-scripts/ifcfg-enp0s3</span></p>
<h4><a name="bookmark631"></a><span class="font25"><a name="bookmark632"></a>You can restart the network without a reboot like this:</span></h4>
<p><span class="font19">[root@server33 ~]# </span><span class="font19" style="font-weight:bold;">systemctl restart network</span></p>
<h4><a name="bookmark633"></a><span class="font25"><a name="bookmark634"></a>Also, forget </span><span class="font25" style="font-weight:bold;">ifconfig </span><span class="font25">and instead use </span><span class="font25" style="font-weight:bold;">ip a</span><span class="font25">.</span></h4>
<p><span class="font19">[root@server33 ~]# </span><span class="font19" style="font-weight:bold;">ip a s dev enp0s3 | grep inet</span></p>
<p><span class="font19">inet 192.168.1.110/24 brd 192.168.1.255 scope global dynamic enp0s3</span></p>
<p><span class="font19">inet6 fe80::a00:27ff:fe1c:f5ab/64 scope link</span></p>
<p><span class="font19">[root@server33 ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark635"></a><span class="font10" style="font-weight:bold;"><a name="bookmark38"></a><a name="bookmark636"></a>5.7. adding one static ip address</span></h2></li></ul>
<h4><a name="bookmark637"></a><span class="font25"><a name="bookmark638"></a>This example shows how to add one static ip address to your computer.</span></h4>
<p><span class="font19">[root@server33 ~]# </span><span class="font19" style="font-weight:bold;">nmtui edit enp0s3</span></p>
<h4><a name="bookmark639"></a><span class="font25"><a name="bookmark640"></a>In this interface leave the IPv4 configuration to automatic, and add an ip address just below.</span></h4>
<p><span class="font19">IPv4 CONFIGURATION &lt;Automatic&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Hide&gt;</span></p>
<p><span class="font19">Addresses </span><span class="font19" style="font-weight:bold;">10.104.33.32/16__________ </span><span class="font19">&lt;Remove&gt;</span></p>
<h4><a name="bookmark641"></a><span class="font25"><a name="bookmark642"></a>Execute this command after exiting </span><span class="font25" style="font-weight:bold;">nmtui</span><span class="font25">.</span></h4>
<p><span class="font19">[root@server33 ~]# </span><span class="font19" style="font-weight:bold;">systemctl restart network</span></p>
<h4><a name="bookmark643"></a><span class="font25"><a name="bookmark644"></a>And verify with </span><span class="font25" style="font-weight:bold;">ip </span><span class="font25">(not with </span><span class="font25" style="font-weight:bold;">ifconfig</span><span class="font25">):</span></h4>
<p><span class="font19">[root@server33 ~]# </span><span class="font19" style="font-weight:bold;">ip a s dev enp0s3 | grep inet</span></p>
<p><span class="font19">inet 192.168.1.110/24 brd 192.168.1.255 scope global dynamic enp0s3</span></p>
<p><span class="font19">inet 10.104.33.32/16 brd 10.104.255.255 scope global enp0s3</span></p>
<p><span class="font19">inet6 fe80::a00:27ff:fe1c:f5ab/64 scope link</span></p>
<p><span class="font19">[root@server33 ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark645"></a><span class="font10" style="font-weight:bold;"><a name="bookmark39"></a><a name="bookmark646"></a>5.8. package management</span></h2></li></ul>
<h4><a name="bookmark647"></a><span class="font25"><a name="bookmark648"></a>Even with a network install, </span><span class="font25" style="font-weight:bold;">CentOS 7 </span><span class="font25">did not install the latest version of some packages. Luckily there is only one command to run (as root). This can take a while.</span></h4>
<p><span class="font19">[root@server33 ~]# </span><span class="font19" style="font-weight:bold;">yum update </span><span class="font19">Loaded plugins: fastestmirror Loading mirror speeds from cached hostfile * base: centos.weepeetelecom.be * extras: centos.weepeetelecom.be * updates: centos.weepeetelecom.be</span></p>
<p><span class="font19">Resolving Dependencies</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">--&gt; Running transaction check</span></p></li></ul>
<p><span class="font19">---&gt; Package NetworkManager.x86_64 1:0.9.9.1-13.git20140326.4dba720.el7 \ will be updated ... (output truncated)</span></p>
<h4><a name="bookmark649"></a><span class="font25"><a name="bookmark650"></a>You can also use </span><span class="font25" style="font-weight:bold;">yum </span><span class="font25">to install one or more packages. Do not forget to run </span><span class="font25" style="font-weight:bold;">yum update </span><span class="font25">from time to time.</span></h4>
<p><span class="font19">[root@server33 ~]# </span><span class="font19" style="font-weight:bold;">yum update -y &amp;&amp;&nbsp;yum install vim -y</span></p>
<p><span class="font19">Loaded plugins: fastestmirror</span></p>
<p><span class="font19">Loading mirror speeds from cached hostfile * base: centos.weepeetelecom.be ... (output truncated)</span></p>
<h4><a name="bookmark651"></a><span class="font25"><a name="bookmark652"></a>Refer to the package management chapter for more information on installing and removing packages.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark653"></a><span class="font10" style="font-weight:bold;"><a name="bookmark40"></a><a name="bookmark654"></a>5.9. logon from Linux and MacOSX</span></h2></li></ul>
<p><span class="font25">You can now open a terminal on Linux or MacOSX and use </span><span class="font25" style="font-weight:bold;">ssh </span><span class="font25">to log on to your virtual machine.</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">ssh </span><a href="mailto:root@192.168.1.110"><span class="font19" style="font-weight:bold;">root@192.168.1.110</span></a><span class="font19" style="font-weight:bold;"> </span><span class="font19">root@192.168.1.110's password:</span></p>
<p><span class="font19">Last login: Sun Nov 2 11:53:57 2014 [root@server33 ~]# </span><span class="font19" style="font-weight:bold;">hostname </span><span class="font19">server33.netsec.local [root@server33 ~] #</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark655"></a><span class="font10" style="font-weight:bold;"><a name="bookmark41"></a><a name="bookmark656"></a>5.10. logon from MS Windows</span></h2></li></ul>
<p><span class="font25">There is no </span><span class="font25" style="font-weight:bold;">ssh </span><span class="font25">installed on MS Windows, but you can download </span><span class="font25" style="font-weight:bold;">putty.exe </span><span class="font25">from </span><span class="font25" style="font-weight:bold;">http :// </span><a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html"><span class="font25" style="font-weight:bold;">www.chiark.greenend.org.uk/~sgtatham/putty/download.html</span></a><span class="font25" style="font-weight:bold;"> </span><span class="font25">(just Google it).</span></p>
<p><span class="font25">Use </span><span class="font25" style="font-weight:bold;">putty.exe </span><span class="font25">as shown in this screenshot (I saved the ip address by giving it a name 'server33' and presing the 'save' button).</span></p><img src="linux_guide_files/The Complete Linux Guide-62.jpg" alt="" style="width:365pt;height:354pt;">
<h4><a name="bookmark657"></a><span class="font25"><a name="bookmark658"></a>The first time you will get a message about keys, accept this (this is explained in the ssh chapter).</span></h4>
<div><img src="linux_guide_files/The Complete Linux Guide-63.jpg" alt="" style="width:398pt;height:249pt;">
</div><br clear="all">
<h4><a name="bookmark659"></a><span class="font25"><a name="bookmark660"></a>Enter your userid (or root) and the correct password (nothing will appear on the screen when typing a password).</span></h4>
<p><span class="font3" style="font-weight:bold;">if<sup>1</sup> root@server33:-</span></p>
<p><span class="font18">login as: root</span></p>
<p><span class="font18">root@192.168.1.110<sup>1</sup>s password:</span></p>
<p><span class="font18">Last login: Sun Nov 2 12:07:49 2014 from 192.168.1.35</span></p>
<p><span class="font18">[roo10 server3 3 -]#</span></p>
<p><span class="font18">[roo10 server3 3 -]# hostname</span></p>
<p><span class="font18">s e rve r 3 3 . ne t s e c . 1 o c a 1</span></p>
<p><span class="font18">[roo10 server3 3 -]# |</span></p>
<div><img src="linux_guide_files/The Complete Linux Guide-64.jpg" alt="" style="width:46pt;height:104pt;">
</div><br clear="all">
<ul style="list-style:none;"><li>
<h1><a name="bookmark661"></a><span class="font11" style="font-weight:bold;"><a name="bookmark42"></a><a name="bookmark662"></a>Chapter 6. getting Linux at home</span></h1></li></ul>
<p><span class="font25" style="font-weight:bold;">This chapter shows a Ubuntu install in Virtualbox. Consider it legacy and use CentOS7 or Debian8 instead (each have their own chapter now).</span></p>
<p><span class="font25">This book assumes you have access to a working Linux computer. Most companies have one or more Linux servers, if you have already logged on to it, then you 're all set (skip this chapter and go to the next).</span></p>
<p><span class="font25">Another option is to insert a Ubuntu Linux CD in a computer with (or without) Microsoft Windows and follow the installation. Ubuntu will resize (or create) partitions and setup a menu at boot time to choose Windows or Linux.</span></p>
<p><span class="font25">If you do not have access to a Linux computer at the moment, and if you are unable or unsure about installing Linux on your computer, then this chapter proposes a third option: installing Linux in a virtual machine.</span></p>
<p><span class="font25">Installation in a virtual machine (provided by </span><span class="font25" style="font-weight:bold;">Virtualbox</span><span class="font25">) is easy and safe. Even when you make mistakes and crash everything on the virtual Linux machine, then nothing on the real computer is touched.</span></p>
<p><span class="font25">This chapter gives easy steps and screenshots to get a working Ubuntu server in a Virtualbox virtual machine. The steps are very similar to installing Fedora or CentOS or even Debian, and if you like you can also use VMWare instead of Virtualbox.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark663"></a><span class="font10" style="font-weight:bold;"><a name="bookmark43"></a><a name="bookmark664"></a>6.1. download a Linux CD image</span></h2></li></ul>
<p><span class="font25">Start by downloading a Linux CD image (an .ISO file) from the distribution of your choice from the Internet. Take care selecting the correct cpu architecture of your computer; choose </span><span class="font25" style="font-weight:bold;">i386 </span><span class="font25">if unsure. Choosing the wrong cpu type (like x86_64 when you have an old Pentium) will almost immediately fail to boot the CD.</span></p>
<div><img src="linux_guide_files/The Complete Linux Guide-65.jpg" alt="" style="width:397pt;height:217pt;">
</div><br clear="all">
<ul style="list-style:none;"><li>
<h2><a name="bookmark665"></a><span class="font10" style="font-weight:bold;"><a name="bookmark44"></a><a name="bookmark666"></a>6.2. download Virtualbox</span></h2></li></ul>
<p><span class="font25">Step two (when the .ISO file has finished downloading) is to download Virtualbox. If you are currently running Microsoft Windows, then download and install Virtualbox for Windows!</span></p>
<div><img src="linux_guide_files/The Complete Linux Guide-66.jpg" alt="" style="width:397pt;height:88pt;">
<p><span class="font3">About</span></p>
</div><br clear="all">
<p><span class="font12" style="font-weight:bold;">VirtualBox</span></p>
<p><span class="font8" style="font-weight:bold;">Download VirtualBox</span></p>
<p><span class="font3" style="font-weight:bold;">Here, you will find links to VirtualBox binaries and its source code.</span></p>
<div>
<p><span class="font3" style="font-weight:bold;">Screenshots</span></p>
</div><br clear="all">
<div>
<p><span class="font6" style="font-weight:bold;">VirtualBox binaries</span></p>
</div><br clear="all">
<div>
<p><span class="font3" style="font-weight:bold;">Downloads</span></p>
<p><span class="font3" style="font-weight:bold;">Documentation</span></p>
<p><span class="font3" style="font-weight:bold;">End-user docs</span></p>
<p><span class="font3" style="font-weight:bold;">Technical docs</span></p>
<p><span class="font3" style="font-weight:bold;">Contribute</span></p>
</div><br clear="all">
<p><span class="font3" style="font-weight:bold;">By downloading, you agree to the terms and conditions of the respectivi</span></p>
<p><span class="font3" style="font-weight:bold;">• VirtualBox platform packages. The binaries are released under</span></p>
<p><span class="font3" style="font-weight:bold;">o VirtualBox 4.1.8 for Windows hosts *x86/amd64</span></p>
<p><span class="font3" style="font-weight:bold;">o VirtualBox 4.1.8 for OS X hosts B&gt;x86/amd64</span></p>
<p><span class="font3" style="font-weight:bold;">o VirtualBox 4.1.8 for Linux hosts</span></p>
<p><span class="font3" style="font-weight:bold;">o VirtualBox 4.1.8 for Solaris hosts E&gt;x86/amd64</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark667"></a><span class="font10" style="font-weight:bold;"><a name="bookmark45"></a><a name="bookmark668"></a>6.3. create a virtual machine</span></h2></li></ul>
<h4><a name="bookmark669"></a><span class="font25"><a name="bookmark670"></a>Now start Virtualbox. Contrary to the screenshot below, your left pane should be empty.</span></h4><img src="linux_guide_files/The Complete Linux Guide-67.jpg" alt="" style="width:397pt;height:278pt;">
<h4><a name="bookmark671"></a><span class="font25"><a name="bookmark672"></a>Click </span><span class="font25" style="font-weight:bold;">New </span><span class="font25">to create a new virtual machine. We will walk together through the wizard. The screenshots below are taken on Mac OSX; they will be slightly different if you are running Microsoft Windows.</span></h4>
<p><span class="font2" style="font-weight:bold;">Create New Virtual Machine</span></p>
<p><span class="font3" style="font-weight:bold;">Welcome to the New Virtual Machine Wizard!</span></p>
<p><span class="font2" style="font-weight:bold;">This wizard will guide you through the steps that are necessary to create a new virtual machine for VirtualBox.</span></p>
<p><span class="font2" style="font-weight:bold;">Use the Continue button to go to the next page of the wizard and the Co Back button to return to the previous page. You can also press Esc if you want to cancel the execution of this wizard.</span></p>
<p><span class="font2" style="font-weight:bold;">Co Back </span><span class="font2" style="font-weight:bold;font-style:italic;text-decoration:underline;">Q</span><span class="font2" style="font-weight:bold;text-decoration:underline;"> Continue</span></p>
<p><span class="font25">Name your virtual machine (and maybe select 32-bit or 64-bit).</span></p><img src="linux_guide_files/The Complete Linux Guide-68.jpg" alt="" style="width:397pt;height:224pt;">
<p><span class="font25">Give the virtual machine some memory (512MB if you have 2GB or more, otherwise select 256MB).</span></p><img src="linux_guide_files/The Complete Linux Guide-69.jpg" alt="" style="width:397pt;height:224pt;">
<h4><a name="bookmark673"></a><span class="font25"><a name="bookmark674"></a>Select to create a new disk (remember, this will be a virtual disk).</span></h4>
<p><span class="font2" style="font-weight:bold;">Create New Virtual Machine</span></p>
<p><span class="font3" style="font-weight:bold;">Virtual Hard Disk</span></p>
<p><span class="font2" style="font-weight:bold;">IF you wish you can now add a start-up disk to the new machine. You can either create a new virtual disk or select one from the list or from another location using the folder icon.</span></p>
<p><span class="font2" style="font-weight:bold;">If you need a more complex virtual disk setup you can skip this step and make the changes to the machine settings once the machine is created.</span></p>
<p><span class="font2" style="font-weight:bold;">The recommended size of the start-up disk is 8,00 GB.</span></p>
<p><span class="font2" style="font-weight:bold;">V Start-up Disk</span></p>
<p><span class="font2" style="font-weight:bold;">(5 Create new hard disk</span></p>
<p><span class="font2" style="font-weight:bold;">Q Use existing hard disk</span></p>
<p><span class="font2" style="font-weight:bold;">O CentOS6.vdi (Normal, 16,00 CB) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;F 0</span></p>
<p><span class="font2" style="font-weight:bold;">f Go Back ( Continue '</span></p>
<h4><a name="bookmark675"></a><span class="font25"><a name="bookmark676"></a>If you get the question below, choose vdi.</span></h4>
<p><span class="font3" style="font-weight:bold;">Create New Virtual Disk</span></p>
<p><span class="font4" style="font-weight:bold;">Welcome to the virtual disk creation wizard</span></p>
<p><span class="font3" style="font-weight:bold;">This wizard will help you to create a new virtual disk for your virtual machine.</span></p>
<p><span class="font3" style="font-weight:bold;">Use the Continue button to go to the next page of the wizard and the Go Back button to return to the previous page. You can also press Esc if you want to cancel the execution of this wizard.</span></p>
<p><span class="font3" style="font-weight:bold;">Please choose the type of file that you would like to use for the new virtual disk. If you do not need to use it with other virtualization software you can leave this setting unchanged.</span></p>
<p><span class="font2" style="font-weight:bold;">File type</span></p>
<p><span class="font3" style="font-weight:bold;">® VDI (VirtualBox Disk Image)</span></p>
<p><span class="font3" style="font-weight:bold;">Q VMDK (Virtual Machine Disk)</span></p>
<p><span class="font3" style="font-weight:bold;">O VHD (Virtual Hard Disk)</span></p>
<p><span class="font3" style="font-weight:bold;">O HDD (Parallels Hard Disk)</span></p>
<p><span class="font13">Co Back ( Continue )</span></p>
<p><span class="font25">Choose </span><span class="font25" style="font-weight:bold;">dynamically allocated </span><span class="font25">(fixed size is only useful in production or on really old, slow hardware).</span></p><img src="linux_guide_files/The Complete Linux Guide-70.jpg" alt="" style="width:397pt;height:269pt;">
<p><span class="font25">Choose between 10GB and 16GB as the disk size.</span></p><img src="linux_guide_files/The Complete Linux Guide-71.jpg" alt="" style="width:397pt;height:269pt;">
<h4><a name="bookmark677"></a><span class="font25"><a name="bookmark678"></a>Click </span><span class="font25" style="font-weight:bold;">create </span><span class="font25">to create the virtual disk.</span></h4><img src="linux_guide_files/The Complete Linux Guide-72.jpg" alt="" style="width:397pt;height:269pt;">
<h4><a name="bookmark679"></a><span class="font25"><a name="bookmark680"></a>Click </span><span class="font25" style="font-weight:bold;">create </span><span class="font25">to create the virtual machine.</span></h4>
<p><span class="font2" style="font-weight:bold;">Create New Virtual Machine</span></p>
<p><span class="font3" style="font-weight:bold;">Summary</span></p>
<p><span class="font2" style="font-weight:bold;">You are going to create a new virtual machine with the following parameters:</span></p>
<p><span class="font2" style="font-weight:bold;">Name: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mijnvirtuelemachine</span></p>
<p><span class="font2" style="font-weight:bold;">OS Type: &nbsp;&nbsp;&nbsp;&nbsp;Ubuntu (64 bit)</span></p>
<p><span class="font2" style="font-weight:bold;">Base Memory: 512 MB</span></p>
<p><span class="font2" style="font-weight:bold;">Start-up Disk: mijnvirtuelemachine.vdi (Normal, 10,00 CB)</span></p>
<p><span class="font2" style="font-weight:bold;">If the above is correct press the Create button. Once you press it, a new virtual machine will be created.</span></p>
<p><span class="font2" style="font-weight:bold;">Note that you can alter these and all other setting of the created virtual machine at any time using the Settings dialog accessible through the menu of the main window.</span></p>
<p><span class="font2" style="font-weight:bold;font-style:italic;text-decoration:underline;">C</span><span class="font2" style="font-weight:bold;text-decoration:underline;"> Co Back</span><span class="font2" style="font-weight:bold;"> ; </span><span class="font2" style="font-weight:bold;text-decoration:underline;">f Create</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark681"></a><span class="font10" style="font-weight:bold;"><a name="bookmark46"></a><a name="bookmark682"></a>6.4. attach the CD image</span></h2>
<div>
<p><span class="font25">Before we start the virtual computer, let us take a look at some settings (click </span><span class="font25" style="font-weight:bold;">Settings</span><span class="font25">).</span></p><img src="linux_guide_files/The Complete Linux Guide-73.jpg" alt="" style="width:400pt;height:294pt;">
</div><br clear="all"></li></ul>
<p><span class="font25">Do not worry if your screen looks different, just find the button named </span><span class="font25" style="font-weight:bold;">storage</span><span class="font25">.</span></p>
<div><img src="linux_guide_files/The Complete Linux Guide-74.jpg" alt="" style="width:341pt;height:68pt;">
<p><span class="font3" style="font-weight:bold;">Name: mijnvirtuelemachine</span></p>
<p><span class="font3" style="font-weight:bold;">Operating System: Linux</span></p>
<p><span class="font3" style="font-weight:bold;">Version: Ubuntu (64 bit)</span></p>
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-75.jpg" alt="" style="width:23pt;height:23pt;">
</div><br clear="all">
<p><span class="font3" style="font-weight:bold;">Cancel ’ OK</span></p>
<h4><a name="bookmark683"></a><span class="font25"><a name="bookmark684"></a>Remember the .ISO file you downloaded? Connect this .ISO file to this virtual machine by clicking on the CD icon next to </span><span class="font25" style="font-weight:bold;">Empty</span><span class="font25">.</span></h4>
<div style="border-bottom:solid;"><img src="linux_guide_files/The Complete Linux Guide-76.jpg" alt="" style="width:289pt;height:46pt;">
<p><span class="font3" style="font-weight:bold;">Attributes</span></p>
</div><br clear="all">
<div style="border-right:solid;">
<p><span class="font3" style="font-weight:bold;">Storage Tree</span></p><img src="linux_guide_files/The Complete Linux Guide-77.jpg" alt="" style="width:138pt;height:169pt;">
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-78.jpg" alt="" style="width:17pt;height:17pt;">
</div><br clear="all">
<p><span class="font3" style="font-weight:bold;">CD/DVD Drive: ( IDE Secondary”^ Q □ Live CD/DVD</span></p>
<p><span class="font3" style="font-weight:bold;">Information</span></p>
<p><span class="font3" style="font-weight:bold;">Type: —</span></p>
<p><span class="font3" style="font-weight:bold;">Size: —</span></p>
<p><span class="font3" style="font-weight:bold;">Location: —</span></p>
<p><span class="font3" style="font-weight:bold;">Attached To: —</span></p>
<p><span class="font3" style="font-weight:bold;">Cancel OK</span></p>
<h4><a name="bookmark685"></a><span class="font25"><a name="bookmark686"></a>Now click on the other CD icon and attach your ISO file to this virtual CD drive.</span></h4>
<div><img src="linux_guide_files/The Complete Linux Guide-79.jpg" alt="" style="width:389pt;height:203pt;">
<p><span class="font1">Location:</span></p>
<p><span class="font1">Attached To:</span></p>
<p><span class="font2" style="font-weight:bold;">Ttroller</span></p>
<p><span class="font2" style="font-weight:bold;">ontroller</span></p>
<p><span class="font1" style="font-weight:bold;text-decoration:underline;">Cancel</span><span class="font1" style="font-weight:bold;"> ( OK</span></p>
<p><span class="font1">Port 0:</span></p>
<p><span class="font2" style="font-weight:bold;">mijnvirtuele (Normal, IC</span></p>
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-80.jpg" alt="" style="width:113pt;height:149pt;">
</div><br clear="all">
<h4><a name="bookmark687"></a><span class="font25"><a name="bookmark688"></a>Verify that your download is accepted. If Virtualbox complains at this point, then you probably did not finish the download of the CD (try downloading it again).</span></h4>
<p><span class="font3" style="font-weight:bold;">mijnvirtuelemachine - Storage</span></p>
<div>
<p><span class="font2" style="font-weight:bold;">General System Display</span></p>
</div><br clear="all">
<div>
<p><span class="font2" style="font-weight:bold;">Storage</span></p>
</div><br clear="all">
<div>
<p><span class="font2" style="font-weight:bold;">Audio Network Ports Shared Folders</span></p>
</div><br clear="all">
<div>
<p><span class="font3" style="font-weight:bold;">Storage Tree</span></p>
</div><br clear="all">
<div>
<p><span class="font3" style="font-weight:bold;">Attributes</span></p>
</div><br clear="all">
<div>
<p><span class="font3" style="font-weight:bold;">IDE Controller</span></p>
<p><span class="font3" style="font-weight:bold;">Q ubuntu-11.04-server-am...</span></p>
<p><span class="font3" style="font-weight:bold;">£ SATA Controller</span></p>
<p><span class="font3" style="font-weight:bold;">§ mijnvirtuelemachine.vdi</span></p>
</div><br clear="all">
<div>
<p><span class="font3" style="font-weight:bold;">CD/DVD Drive: IDE Secondary C <sup>1</sup> Q □ Live CD/DVD</span></p>
</div><br clear="all">
<div>
<p><span class="font3" style="font-weight:bold;">Information</span></p>
</div><br clear="all">
<div>
<p><span class="font3" style="font-weight:bold;">Type:</span></p>
</div><br clear="all">
<div>
<p><span class="font3" style="font-weight:bold;">Size:</span></p>
</div><br clear="all">
<div>
<p><span class="font3" style="font-weight:bold;">Image</span></p>
<p><span class="font3" style="font-weight:bold;">673,61 MB</span></p>
</div><br clear="all">
<div>
<p><span class="font3" style="font-weight:bold;">Location:</span></p>
</div><br clear="all">
<div>
<p><span class="font3" style="font-weight:bold;">/Users/paul/ISO/ubu...</span></p>
</div><br clear="all">
<p><span class="font3" style="font-weight:bold;">Attached To:</span></p>
<h4><a name="bookmark689"></a><span class="font25"><a name="bookmark690"></a>It could be useful to set the network adapter to bridge instead of NAT. Bridged usually will connect your virtual computer to the Internet.</span></h4>
<div><img src="linux_guide_files/The Complete Linux Guide-81.jpg" alt="" style="width:341pt;height:282pt;">
</div><br clear="all">
<ul style="list-style:none;"><li>
<h2><a name="bookmark691"></a><span class="font10" style="font-weight:bold;"><a name="bookmark47"></a><a name="bookmark692"></a>6.5. install Linux</span></h2></li></ul>
<p><span class="font25">The virtual machine is now ready to start. When given a choice at boot, select </span><span class="font25" style="font-weight:bold;">install </span><span class="font25">and follow the instructions on the screen. When the installation is finished, you can log on to the machine and start practising Linux!</span></p>
<p><a name="bookmark693"></a><span class="font11" style="font-weight:bold;">Part III. first steps on the command line</span></p>
<h3><a name="bookmark694"></a><span class="font9" style="font-weight:bold;"><a name="bookmark695"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark696"><span class="font24" style="font-weight:bold;">7. man pages </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark697"><span class="font24">7.1. man $command </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark698"><span class="font24">7.2. man $configfile </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark699"><span class="font24">7.3. man $daemon </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark700"><span class="font24">7.4. man -k (apropos) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark701"><span class="font24">7.5. whatis </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark702"><span class="font24">7.6. whereis </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark703"><span class="font24">7.7. man sections </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark704"><span class="font24">7.8. man $section $file </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark705"><span class="font24">7.9. man man </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark706"><span class="font24">7.10. mandb </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark707"><span class="font24" style="font-weight:bold;">8. working with directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark708"><span class="font24">8.1. pwd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark709"><span class="font24">8.2. cd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark710"><span class="font24">8.3. absolute and relative paths </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark711"><span class="font24">8.4. path completion </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark712"><span class="font24">8.5. ls </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark713"><span class="font24">8.6. mkdir </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark714"><span class="font24">8.7. rmdir </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark715"><span class="font24">8.8. practice: working with directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark716"><span class="font24">8.9. solution: working with directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark717"><span class="font24" style="font-weight:bold;">9. working with files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark718"><span class="font24">9.1. all files are case sensitive </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark719"><span class="font24">9.2. everything is a file </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark720"><span class="font24">9.3. file </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark721"><span class="font24">9.4. touch </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark722"><span class="font24">9.5. rm </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark723"><span class="font24">9.6. cp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark724"><span class="font24">9.7. mv </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark725"><span class="font24">9.8. rename </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark726"><span class="font24">9.9. practice: working with files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark727"><span class="font24">9.10. solution: working with files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark728"><span class="font24" style="font-weight:bold;">10. working with file contents </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark729"><span class="font24">10.1. head </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark730"><span class="font24">10.2. tail </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark731"><span class="font24">10.3. cat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark732"><span class="font24">10.4. tac </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark733"><span class="font24">10.5. more and less </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark734"><span class="font24">10.6. strings </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark735"><span class="font24">10.7. practice: file contents </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark736"><span class="font24">10.8. solution: file contents </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark737"><span class="font24" style="font-weight:bold;">11. the Linux file tree </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark738"><span class="font24">11.1. filesystem hierarchy standard </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark739"><span class="font24">11.2. man hier </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark740"><span class="font24">11.3. the root directory / </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark741"><span class="font24">11.4. binary directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark742"><span class="font24">11.5. configuration directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark743"><span class="font24">11.6. data directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark744"><span class="font24">11.7. in memory directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark745"><span class="font24">11.8. /usr Unix System Resources </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark746"><span class="font24">11.9. /var variable data </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark747"><span class="font24">11.10. practice: file system tree </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark748"><span class="font24">11.11. solution: file system tree </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark749"></a><span class="font11" style="font-weight:bold;"><a name="bookmark750"></a><a name="bookmark751"></a>Chapter 7. man pages</span></h1></li></ul>
<p><span class="font25">This chapter will explain the use of </span><span class="font25" style="font-weight:bold;">man </span><span class="font25">pages (also called </span><span class="font25" style="font-weight:bold;">manual pages</span><span class="font25">) on your Unix or Linux computer.</span></p>
<p><span class="font25">You will learn the </span><span class="font25" style="font-weight:bold;">man </span><span class="font25">command together with related commands like </span><span class="font25" style="font-weight:bold;">whereis</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">whatis </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">mandb</span><span class="font25">.</span></p>
<p><span class="font25">Most Unix files and commands have pretty good man pages to explain their use. Man pages also come in handy when you are using multiple flavours of Unix or several Linux distributions since options and parameters sometimes vary.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark752"></a><span class="font10" style="font-weight:bold;"><a name="bookmark50"></a><a name="bookmark753"></a>7.1. man $command</span></h2></li></ul>
<h4><a name="bookmark754"></a><span class="font25"><a name="bookmark755"></a><a name="bookmark756"></a>Type </span><span class="font25" style="font-weight:bold;">man </span><span class="font25">followed by a command (for which you want help) and start reading. Press </span><span class="font25" style="font-weight:bold;">q </span><span class="font25">to quit the manpage. Some man pages contain examples (near the end).</span></h4>
<p><span class="font19">paul@laika:~$ man whois</span></p>
<p><span class="font19">Reformatting whois(1), please wait...</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark757"></a><span class="font10" style="font-weight:bold;"><a name="bookmark51"></a><a name="bookmark758"></a>7.2. man $configfile</span></h2></li></ul>
<h4><a name="bookmark759"></a><span class="font25"><a name="bookmark760"></a>Most </span><span class="font25" style="font-weight:bold;">configuration files </span><span class="font25">have their own manual.</span></h4>
<p><span class="font19">paul@laika:~$ man syslog.conf</span></p>
<p><span class="font19">Reformatting syslog.conf(5), please wait...</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark761"></a><span class="font10" style="font-weight:bold;"><a name="bookmark52"></a><a name="bookmark762"></a>7.3. man $daemon</span></h2></li></ul>
<h4><a name="bookmark763"></a><span class="font25"><a name="bookmark764"></a><a name="bookmark765"></a>This is also true for most </span><span class="font25" style="font-weight:bold;">daemons </span><span class="font25">(background programs) on your system..</span></h4>
<p><span class="font19">paul@laika:~$ man syslogd</span></p>
<p><span class="font19">Reformatting syslogd(8), please wait...</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark766"></a><span class="font10" style="font-weight:bold;"><a name="bookmark53"></a><a name="bookmark767"></a>7.4. man -k (apropos)</span></h2></li></ul>
<h4><a name="bookmark768"></a><span class="font25" style="font-weight:bold;"><a name="bookmark769"></a><a name="bookmark770"></a><a name="bookmark771"></a>man -k </span><span class="font25">(or </span><span class="font25" style="font-weight:bold;">apropos</span><span class="font25">) shows a list of man pages containing a string.</span></h4>
<p><span class="font19">paul@laika:~$ man -k syslog</span></p>
<p><span class="font19">lm-syslog-setup (8) &nbsp;- configure laptop mode to switch syslog.conf ...</span></p>
<p><span class="font19">logger (1) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- a shell command interface to the syslog(3) ...</span></p>
<p><span class="font19">syslog-facility (8) &nbsp;- Setup and remove LOCALx facility for sysklogd</span></p>
<p><span class="font19">syslog.conf (5) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- syslogd(8) configuration file</span></p>
<p><span class="font19">syslogd (8) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- Linux system logging utilities.</span></p>
<p><span class="font19">syslogd-listfiles (8) - list system logfiles</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark772"></a><span class="font10" style="font-weight:bold;"><a name="bookmark54"></a><a name="bookmark773"></a>7.5. whatis</span></h2></li></ul>
<h4><a name="bookmark774"></a><span class="font25"><a name="bookmark775"></a><a name="bookmark776"></a>To see just the description of a manual page, use </span><span class="font25" style="font-weight:bold;">whatis </span><span class="font25">followed by a string.</span></h4>
<p><span class="font19">paul@u810:~$ whatis route</span></p>
<p><span class="font19">route (8) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- show / manipulate the IP routing table</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark777"></a><span class="font10" style="font-weight:bold;"><a name="bookmark55"></a><a name="bookmark778"></a>7.6. whereis</span></h2></li></ul>
<h4><a name="bookmark779"></a><span class="font25"><a name="bookmark780"></a><a name="bookmark781"></a>The location of a manpage can be revealed with </span><span class="font25" style="font-weight:bold;">whereis</span><span class="font25">.</span></h4>
<p><span class="font19">paul@laika:~$ whereis -m whois</span></p>
<p><span class="font19">whois: /usr/share/man/man1/whois.1.gz</span></p>
<h4><a name="bookmark782"></a><span class="font25"><a name="bookmark783"></a><a name="bookmark784"></a>This file is directly readable by </span><span class="font25" style="font-weight:bold;">man</span><span class="font25">.</span></h4>
<p><span class="font19">paul@laika:~$ man /usr/share/man/man1/whois.1.gz</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark785"></a><span class="font10" style="font-weight:bold;"><a name="bookmark56"></a><a name="bookmark786"></a>7.7. man sections</span></h2></li></ul>
<p><a name="bookmark787"></a><span class="font25">By now you will have noticed the numbers between the round brackets. </span><span class="font25" style="font-weight:bold;">man man </span><span class="font25">will explain to you that these are section numbers. Executable programs and shell commands reside in section one.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">1 Executable programs or shell commands</span></p></li>
<li>
<p><span class="font19">2 System calls (functions provided by the kernel)</span></p></li>
<li>
<p><span class="font19">3 Library calls (functions within program libraries)</span></p></li>
<li>
<p><span class="font19">4 Special files (usually found in /dev)</span></p></li>
<li>
<p><span class="font19">5 File formats and conventions eg /etc/passwd</span></p></li>
<li>
<p><span class="font19">6 Games</span></p></li>
<li>
<p><span class="font19">7 Miscellaneous (including macro packages and conventions), e.g. man(7)</span></p></li>
<li>
<p><span class="font19">8 System administration commands (usually only for root)</span></p></li>
<li>
<p><span class="font19">9 Kernel routines [Non standard]</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark788"></a><span class="font10" style="font-weight:bold;"><a name="bookmark57"></a><a name="bookmark789"></a>7.8. man $section $file</span></h2></li></ul>
<p><a name="bookmark790"></a><span class="font25"><a name="bookmark791"></a>Therefor, when referring to the man page of the passwd command, you will see it written as </span><span class="font25" style="font-weight:bold;">passwd(1)</span><span class="font25">; when referring to the </span><span class="font25" style="font-weight:bold;">passwd file</span><span class="font25">, you will see it written as </span><span class="font25" style="font-weight:bold;">passwd(5)</span><span class="font25">. The screenshot explains how to open the man page in the correct section.</span></p>
<p><span class="font19">[paul@RHEL52 ~]$ man passwd &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# opens the first manual found</span></p>
<p><span class="font19">[paul@RHEL52 ~]$ man 5 passwd &nbsp;&nbsp;&nbsp;# opens a page from section 5</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark792"></a><span class="font10" style="font-weight:bold;"><a name="bookmark58"></a><a name="bookmark793"></a>7.9. man man</span></h2></li></ul>
<p><span class="font25">If you want to know more about </span><span class="font25" style="font-weight:bold;">man</span><span class="font25">, then Read The Fantastic Manual (RTFM).</span></p>
<p><span class="font25" style="font-style:italic;">Unfortunately, manual pages do not have the answer to everything...</span></p>
<p><span class="font19">paul@laika:~$ man woman</span></p>
<p><span class="font19">No manual entry for woman</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark794"></a><span class="font10" style="font-weight:bold;"><a name="bookmark59"></a><a name="bookmark795"></a>7.10. mandb</span></h2></li></ul>
<p><span class="font25">Should<a name="bookmark796"></a> you be convinced that a man page exists, but you can't access it, then try running </span><span class="font25" style="font-weight:bold;">mandb </span><span class="font25">on Debian/Mint.</span></p>
<p><span class="font19">root@laika:~# mandb</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">0 man subdirectories contained newer manual pages.</span></p></li>
<li>
<p><span class="font19">0 manual pages were added.</span></p></li>
<li>
<p><span class="font19">0 stray cats were added.</span></p></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font19">0 old database entries were purged.</span></p></li></ul>
<p><a name="bookmark797"></a><span class="font25">Or run </span><span class="font25" style="font-weight:bold;">makewhatis </span><span class="font25">on CentOS/Redhat.</span></p>
<p><span class="font19">[root@centos65 ~]# apropos scsi scsi: nothing appropriate</span></p>
<p><span class="font19">[root@centos65 ~]# makewhatis</span></p>
<p><span class="font19">[root@centos65 ~]# apropos scsi</span></p>
<p><span class="font19">hpsa &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(4) &nbsp;- HP Smart Array SCSI driver</span></p>
<p><span class="font19">lsscsi &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(8) &nbsp;- list SCSI devices (or hosts) and their attributes</span></p>
<p><span class="font19">sd &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(4) &nbsp;- Driver for SCSI Disk Drives</span></p>
<p><span class="font19">st &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(4) &nbsp;- SCSI tape device</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark798"></a><span class="font11" style="font-weight:bold;"><a name="bookmark60"></a><a name="bookmark799"></a>Chapter 8. working with directories</span></h1></li></ul>
<p><span class="font25">This module is a brief overview of the most common commands to work with directories: </span><span class="font25" style="font-weight:bold;">pwd</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">cd</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">ls</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">mkdir </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">rmdir</span><span class="font25">. These commands are available on any Linux (or Unix) system.</span></p>
<p><span class="font25">This module also discusses </span><span class="font25" style="font-weight:bold;">absolute </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">relative paths </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">path completion </span><span class="font25">in the </span><span class="font25" style="font-weight:bold;">bash </span><span class="font25">shell.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark800"></a><span class="font10" style="font-weight:bold;"><a name="bookmark61"></a><a name="bookmark801"></a>8.1. pwd</span></h2></li></ul>
<p><a name="bookmark802"></a><span class="font25"><a name="bookmark803"></a>The </span><span class="font25" style="font-weight:bold;">you are here </span><span class="font25">sign can be displayed with the </span><span class="font25" style="font-weight:bold;">pwd </span><span class="font25">command (Print Working Directory). Go ahead, try it: Open a command line interface (also called a terminal, console or xterm) and type </span><span class="font25" style="font-weight:bold;">pwd</span><span class="font25">. The tool displays your </span><span class="font25" style="font-weight:bold;">current directory</span><span class="font25">.</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">pwd</span></p>
<p><span class="font19">/home/paul</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark804"></a><span class="font10" style="font-weight:bold;"><a name="bookmark62"></a><a name="bookmark805"></a>8.2. cd</span></h2></li></ul>
<p><a name="bookmark806"></a><span class="font25">You can change your current directory with the </span><span class="font25" style="font-weight:bold;">cd </span><span class="font25">command (Change Directory).</span></p>
<p><span class="font19">paul@debian8$ paul@debian8$ /etc</span></p>
<p><span class="font19">paul@debian8$ paul@debian8$ /bin</span></p>
<p><span class="font19">paul@debian8$ paul@debian8$ /home/paul</span></p>
<p><span class="font19" style="font-weight:bold;">cd /etc</span></p>
<p><span class="font19" style="font-weight:bold;">pwd</span></p>
<p><span class="font19" style="font-weight:bold;">cd /bin</span></p>
<p><span class="font19" style="font-weight:bold;">pwd</span></p>
<p><span class="font19" style="font-weight:bold;">cd /home/paul/ pwd</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark807"></a><span class="font9" style="font-weight:bold;"><a name="bookmark808"></a>8.2.1. cd ~</span></h3></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">cd </span><span class="font25">is also a shortcut to get back into your home director<a name="bookmark809"></a>y. Just typing </span><span class="font25" style="font-weight:bold;">cd </span><span class="font25">without a target directory, will put you in your home directory. Typing </span><span class="font25" style="font-weight:bold;">cd ~ </span><span class="font25">has the same effect.</span></p>
<p><span class="font19">paul@debian8$ </span><span class="font19" style="font-weight:bold;">cd /etc </span><span class="font19">paul@debian8$ </span><span class="font19" style="font-weight:bold;">pwd </span><span class="font19">/etc paul@debian8$ </span><span class="font19" style="font-weight:bold;">cd </span><span class="font19">paul@debian8$ </span><span class="font19" style="font-weight:bold;">pwd </span><span class="font19">/home/paul paul@debian8$ </span><span class="font19" style="font-weight:bold;">cd ~ </span><span class="font19">paul@debian8$ </span><span class="font19" style="font-weight:bold;">pwd </span><span class="font19">/home/paul</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark810"></a><span class="font9" style="font-weight:bold;"><a name="bookmark811"></a>8.2.2. cd ..</span></h3></li></ul>
<p><a name="bookmark812"></a><span class="font25"><a name="bookmark813"></a>To go to the </span><span class="font25" style="font-weight:bold;">parent directory </span><span class="font25">(the one just above your current directory in the directory tree), type </span><span class="font25" style="font-weight:bold;">cd .. </span><span class="font25">.</span></p>
<p><span class="font19">paul@debian8$ </span><span class="font19" style="font-weight:bold;">pwd </span><span class="font19">/usr/share/games paul@debian8$ </span><span class="font19" style="font-weight:bold;">cd .. </span><span class="font19">paul@debian8$ </span><span class="font19" style="font-weight:bold;">pwd </span><span class="font19">/usr/share</span></p>
<p><a name="bookmark814"></a><span class="font25" style="font-style:italic;">To stay in the current directory, type </span><span class="font25" style="font-weight:bold;font-style:italic;">cd . </span><span class="font25" style="font-style:italic;">;-)</span><span class="font25"> We will see useful use of the </span><span class="font25" style="font-weight:bold;">. </span><span class="font25">character representing the current directory later.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark815"></a><span class="font9" style="font-weight:bold;"><a name="bookmark816"></a>8.2.3. cd -</span></h3></li></ul>
<p><a name="bookmark817"></a><span class="font25">Another useful shortcut with </span><span class="font25" style="font-weight:bold;">cd </span><span class="font25">is to just type </span><span class="font25" style="font-weight:bold;">cd - </span><span class="font25">to go to the previous directory.</span></p>
<p><span class="font19">paul@debian8$ </span><span class="font19" style="font-weight:bold;">pwd </span><span class="font19">/home/paul</span></p>
<p><span class="font19">paul@debian8$ </span><span class="font19" style="font-weight:bold;">cd /etc </span><span class="font19">paul@debian8$ </span><span class="font19" style="font-weight:bold;">pwd </span><span class="font19">/etc</span></p>
<p><span class="font19">paul@debian8$ </span><span class="font19" style="font-weight:bold;">cd -</span><span class="font19">/home/paul</span></p>
<p><span class="font19">paul@debian8$ </span><span class="font19" style="font-weight:bold;">cd -</span><span class="font19">/etc</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark818"></a><span class="font10" style="font-weight:bold;"><a name="bookmark63"></a><a name="bookmark819"></a>8.3. absolute and relative paths</span></h2></li></ul>
<p><a name="bookmark820"></a><span class="font25"><a name="bookmark821"></a>You should be aware of </span><span class="font25" style="font-weight:bold;">absolute and relative paths </span><span class="font25">in the file tree. When you type a path starting with a </span><span class="font25" style="font-weight:bold;">slash (/)</span><span class="font25">, then the </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">of the file tree is assumed. If you don't start your path with a slash, then the current directory is the assumed starting point.</span></p>
<p><span class="font25">The screenshot below first shows the current directory </span><span class="font25" style="font-weight:bold;">/home/paul</span><span class="font25">. From within this directory, you have to type </span><span class="font25" style="font-weight:bold;">cd /home </span><span class="font25">instead of </span><span class="font25" style="font-weight:bold;">cd home </span><span class="font25">to go to the </span><span class="font25" style="font-weight:bold;">/home </span><span class="font25">directory.</span></p>
<p><span class="font19">paul@debian8$ </span><span class="font19" style="font-weight:bold;">pwd</span></p>
<p><span class="font19">/home/paul</span></p>
<p><span class="font19">paul@debian8$ </span><span class="font19" style="font-weight:bold;">cd home</span></p>
<p><span class="font19">bash: cd: home: No such file or directory</span></p>
<p><span class="font19">paul@debian8$ </span><span class="font19" style="font-weight:bold;">cd /home</span></p>
<p><span class="font19">paul@debian8$ </span><span class="font19" style="font-weight:bold;">pwd</span></p>
<p><span class="font19">/home</span></p>
<p><span class="font25">When inside </span><span class="font25" style="font-weight:bold;">/home</span><span class="font25">, you have to type </span><span class="font25" style="font-weight:bold;">cd paul </span><span class="font25">instead of </span><span class="font25" style="font-weight:bold;">cd /paul </span><span class="font25">to enter the subdirectory </span><span class="font25" style="font-weight:bold;">paul </span><span class="font25">of the current directory </span><span class="font25" style="font-weight:bold;">/home</span><span class="font25">.</span></p>
<p><span class="font19">paul@debian8$ </span><span class="font19" style="font-weight:bold;">pwd</span></p>
<p><span class="font19">/home</span></p>
<p><span class="font19">paul@debian8$ </span><span class="font19" style="font-weight:bold;">cd /paul</span></p>
<p><span class="font19">bash: cd: /paul: No such file or directory</span></p>
<p><span class="font19">paul@debian8$ </span><span class="font19" style="font-weight:bold;">cd paul</span></p>
<p><span class="font19">paul@debian8$ </span><span class="font19" style="font-weight:bold;">pwd</span></p>
<p><span class="font19">/home/paul</span></p>
<p><span class="font25">In case your current directory is the </span><span class="font25" style="font-weight:bold;">root directory /</span><span class="font25">, then both </span><span class="font25" style="font-weight:bold;">cd /home </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">cd home </span><span class="font25">will get you in the </span><span class="font25" style="font-weight:bold;">/home </span><span class="font25">directory.</span></p>
<p><span class="font19">paul@debian8$ /</span></p>
<div>
<p><span class="font19" style="font-weight:bold;">pwd</span></p>
<p><span class="font19" style="font-weight:bold;">cd home pwd</span></p>
<p><span class="font19" style="font-weight:bold;">cd /</span></p>
<p><span class="font19" style="font-weight:bold;">cd /home pwd</span></p>
</div><br clear="all">
<p><span class="font19">paul@debian8$ paul@debian8$ /home</span></p>
<p><span class="font19">paul@debian8$ paul@debian8$ paul@debian8$ /home</span></p>
<p><a name="bookmark822"></a><span class="font25"><a name="bookmark823"></a>This was the last screenshot with </span><span class="font25" style="font-weight:bold;">pwd </span><span class="font25">statements. From now on, the current directory will often be displayed in the prompt. Later in this book we will explain how the shell variable </span><span class="font25" style="font-weight:bold;">$PS1 </span><span class="font25">can be configured to show this.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark824"></a><span class="font10" style="font-weight:bold;"><a name="bookmark64"></a><a name="bookmark825"></a>8.4. path completion</span></h2></li></ul>
<p><a name="bookmark826"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">tab key </span><span class="font25">can help you in typing a path without errors. Typing </span><span class="font25" style="font-weight:bold;">cd /et </span><span class="font25">followed by the </span><span class="font25" style="font-weight:bold;">tab key </span><span class="font25">will expand the command line to </span><span class="font25" style="font-weight:bold;">cd /etc/</span><span class="font25">. When ty<a name="bookmark827"></a>ping </span><span class="font25" style="font-weight:bold;">cd /Et </span><span class="font25">followed by the </span><span class="font25" style="font-weight:bold;">tab key</span><span class="font25">, nothing will happen because you typed the wrong </span><span class="font25" style="font-weight:bold;">path </span><span class="font25">(upper case E).</span></p>
<p><span class="font25">You will need fewer key strokes when using the </span><span class="font25" style="font-weight:bold;">tab key</span><span class="font25">, and you will be sure your typed </span><span class="font25" style="font-weight:bold;">path </span><span class="font25">is correct!</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark828"></a><span class="font10" style="font-weight:bold;"><a name="bookmark65"></a><a name="bookmark829"></a>8.5. ls</span></h2></li></ul>
<p><a name="bookmark830"></a><span class="font25">You can list the contents of a directory with </span><span class="font25" style="font-weight:bold;">ls</span><span class="font25">.</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">ls </span><span class="font19">allfiles.txt dmesg.txt services stuff summer.txt</span></p>
<p><span class="font19">paul@debian8:~$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark831"></a><span class="font9" style="font-weight:bold;"><a name="bookmark832"></a>8.5.1. ls -a</span></h3></li></ul>
<p><a name="bookmark833"></a><span class="font25">A frequently used option with ls is </span><span class="font25" style="font-weight:bold;">-a </span><span class="font25">to show all files. Showing all files means including the </span><span class="font25" style="font-weight:bold;">hidden files</span><span class="font25">. When a file name on a Linux file system starts with a dot, it is considered a </span><span class="font25" style="font-weight:bold;">hidden file </span><span class="font25">and it doesn't show up in regular file listings.</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">ls</span></p>
<p><span class="font19">allfiles.txt dmesg.txt services stuff summer.txt</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">ls -a</span></p>
<p><span class="font19">. &nbsp;&nbsp;allfiles.txt &nbsp;&nbsp;.bash_profile &nbsp;dmesg.txt &nbsp;&nbsp;.lesshst &nbsp;stuff</span></p>
<p><span class="font19">.. &nbsp;.bash_history &nbsp;.bashrc &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;services &nbsp;&nbsp;&nbsp;.ssh &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;summer.txt</span></p>
<p><span class="font19">paul@debian8:~$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark834"></a><span class="font9" style="font-weight:bold;"><a name="bookmark835"></a>8.5.2. ls -l</span></h3></li></ul>
<p><span class="font25">Many times you will be using options with </span><span class="font25" style="font-weight:bold;">ls </span><span class="font25">to display the contents of the directory in different formats or to display different<a name="bookmark836"></a> parts of the directory. Typing just </span><span class="font25" style="font-weight:bold;">ls </span><span class="font25">gives you a list of files in the directory. Typing </span><span class="font25" style="font-weight:bold;">ls -l </span><span class="font25">(that is a letter L, not the number 1) gives you a long listing.</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">ls -l </span><span class="font19">total 17296</span></p>
<p><span class="font19">-rw-r--r-- 1 paul paul 17584442 Sep 17 00:03 allfiles.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-r--r-- 1 paul paul &nbsp;&nbsp;&nbsp;96650 Sep 17 00:03 dmesg.txt</span></p></li>
<li>
<p><span class="font19">- rw-r--r-- 1 paul paul &nbsp;&nbsp;&nbsp;19558 Sep 17 00:04 services</span></p></li></ul>
<p><span class="font19">drwxr-xr-x 2 paul paul &nbsp;&nbsp;&nbsp;&nbsp;4096 Sep 17 00:04 stuff</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-r--r-- 1 paul paul &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 Sep 17 00:04 summer.txt</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark837"></a><span class="font9" style="font-weight:bold;"><a name="bookmark838"></a>8.5.3. ls -lh</span></h3></li></ul>
<h4><a name="bookmark839"></a><span class="font25"><a name="bookmark840"></a>Another frequently used ls option is </span><span class="font25" style="font-weight:bold;">-h</span><span class="font25">. It shows the numbers (file sizes) in a more human readable format. Also shown below is some variation in the way you can give the options to </span><span class="font25" style="font-weight:bold;">ls</span><span class="font25">. We will explain the details of the output later in this book.</span></h4>
<p><span class="font25" style="font-style:italic;">Note that we use the letter L as an option in this screenshot, not the number 1.</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">ls -l -h </span><span class="font19">total 17M</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-r--r-- 1 paul paul &nbsp;17M Sep 17 00:03 allfiles.txt</span></p></li>
<li>
<p><span class="font19">- rw-r--r-- 1 paul paul &nbsp;95K Sep 17 00:03 dmesg.txt</span></p></li>
<li>
<p><span class="font19">- rw-r--r-- 1 paul paul &nbsp;20K Sep 17 00:04 services</span></p></li></ul>
<p><span class="font19">drwxr-xr-x 2 paul paul 4.0K Sep 17 00:04 stuff</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-r--r-- 1 paul paul &nbsp;&nbsp;&nbsp;0 Sep 17 00:04 summer.txt</span></p></li></ul>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">ls -lh </span><span class="font19">total 17M</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-r--r-- 1 paul paul &nbsp;17M Sep 17 00:03 allfiles.txt</span></p></li>
<li>
<p><span class="font19">- rw-r--r-- 1 paul paul &nbsp;95K Sep 17 00:03 dmesg.txt</span></p></li>
<li>
<p><span class="font19">- rw-r--r-- 1 paul paul &nbsp;20K Sep 17 00:04 services</span></p></li></ul>
<p><span class="font19">drwxr-xr-x 2 paul paul 4.0K Sep 17 00:04 stuff</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-r--r-- 1 paul paul &nbsp;&nbsp;&nbsp;0 Sep 17 00:04 summer.txt</span></p></li></ul>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">ls -hl </span><span class="font19">total 17M</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-r--r-- 1 paul paul &nbsp;17M Sep 17 00:03 allfiles.txt</span></p></li>
<li>
<p><span class="font19">- rw-r--r-- 1 paul paul &nbsp;95K Sep 17 00:03 dmesg.txt</span></p></li>
<li>
<p><span class="font19">- rw-r--r-- 1 paul paul &nbsp;20K Sep 17 00:04 services</span></p></li></ul>
<p><span class="font19">drwxr-xr-x 2 paul paul 4.0K Sep 17 00:04 stuff</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-r--r-- 1 paul paul &nbsp;&nbsp;&nbsp;0 Sep 17 00:04 summer.txt</span></p></li></ul>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">ls -h -l </span><span class="font19">total 17M</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-r--r-- 1 paul paul &nbsp;17M Sep 17 00:03 allfiles.txt</span></p></li>
<li>
<p><span class="font19">- rw-r--r-- 1 paul paul &nbsp;95K Sep 17 00:03 dmesg.txt</span></p></li>
<li>
<p><span class="font19">- rw-r--r-- 1 paul paul &nbsp;20K Sep 17 00:04 services</span></p></li></ul>
<p><span class="font19">drwxr-xr-x 2 paul paul 4.0K Sep 17 00:04 stuff</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-r--r-- 1 paul paul &nbsp;&nbsp;&nbsp;0 Sep 17 00:04 summer.txt</span></p></li></ul>
<p><span class="font19">paul@debian8:~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark841"></a><span class="font10" style="font-weight:bold;"><a name="bookmark66"></a><a name="bookmark842"></a>8.6. mkdir</span></h2></li></ul>
<h4><a name="bookmark843"></a><span class="font25"><a name="bookmark844"></a><a name="bookmark845"></a>Walking around the Unix file tree is fun, but it is even more fun to create your own directories with </span><span class="font25" style="font-weight:bold;">mkdir</span><span class="font25">. You have to give at least one parameter to </span><span class="font25" style="font-weight:bold;">mkdir</span><span class="font25">, the name of the new directory to be created. Think before you type a leading </span><span class="font25" style="font-weight:bold;">/ </span><span class="font25">.</span></h4>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">mkdir mydir</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">cd mydir</span></p>
<p><span class="font19">paul@debian8:~/mydir$ </span><span class="font19" style="font-weight:bold;">ls -al </span><span class="font19">total 8</span></p>
<p><span class="font19">drwxr-xr-x 2 paul paul 4096 Sep 17 00:07 .</span></p>
<p><span class="font19">drwxr-xr-x 48 paul paul 4096 Sep 17 00:07 ..</span></p>
<p><span class="font19">paul@debian8:~/mydir$ </span><span class="font19" style="font-weight:bold;">mkdir stuff</span></p>
<p><span class="font19">paul@debian8:~/mydir$ </span><span class="font19" style="font-weight:bold;">mkdir otherstuff</span></p>
<p><span class="font19">paul@debian8:~/mydir$ </span><span class="font19" style="font-weight:bold;">ls -l </span><span class="font19">total 8</span></p>
<p><span class="font19">drwxr-xr-x 2 paul paul 4096 Sep 17 00:08 otherstuff</span></p>
<p><span class="font19">drwxr-xr-x 2 paul paul 4096 Sep 17 00:08 stuff</span></p>
<p><span class="font19">paul@debian8:~/mydir$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark846"></a><span class="font9" style="font-weight:bold;"><a name="bookmark847"></a>8.6.1. mkdir -p</span></h3></li></ul>
<h4><a name="bookmark848"></a><span class="font25"><a name="bookmark849"></a>The following command will fail, because the </span><span class="font25" style="font-weight:bold;">parent directory </span><span class="font25">of </span><span class="font25" style="font-weight:bold;">threedirsdeep </span><span class="font25">does not exist.</span></h4>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">mkdir mydir2/mysubdir2/threedirsdeep</span></p>
<p><span class="font19">mkdir: cannot create directory ‘mydir2/mysubdir2/threedirsdeep’: No such fi\ le or directory</span></p>
<h4><a name="bookmark850"></a><span class="font25"><a name="bookmark851"></a><a name="bookmark852"></a>When given the option </span><span class="font25" style="font-weight:bold;">-p</span><span class="font25">, then </span><span class="font25" style="font-weight:bold;">mkdir </span><span class="font25">will create </span><span class="font25" style="font-weight:bold;">parent directories </span><span class="font25">as needed.</span></h4>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">mkdir -p mydir2/mysubdir2/threedirsdeep</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">cd mydir2</span></p>
<p><span class="font19">paul@debian8:~/mydir2$ </span><span class="font19" style="font-weight:bold;">ls -l</span></p>
<p><span class="font19">total 4</span></p>
<p><span class="font19">drwxr-xr-x 3 paul paul 4096 Sep 17 00:11 mysubdir2</span></p>
<p><span class="font19">paul@debian8:~/mydir2$ </span><span class="font19" style="font-weight:bold;">cd mysubdir2</span></p>
<p><span class="font19">paul@debian8:~/mydir2/mysubdir2$ </span><span class="font19" style="font-weight:bold;">ls -l </span><span class="font19">total 4</span></p>
<p><span class="font19">drwxr-xr-x 2 paul paul 4096 Sep 17 00:11 threedirsdeep</span></p>
<p><span class="font19">paul@debian8:~/mydir2/mysubdir2$ </span><span class="font19" style="font-weight:bold;">cd threedirsdeep/ </span><span class="font19">paul@debian8:~/mydir2/mysubdir2/threedirsdeep$ </span><span class="font19" style="font-weight:bold;">pwd </span><span class="font19">/home/paul/mydir2/mysubdir2/threedirsdeep</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark853"></a><span class="font10" style="font-weight:bold;"><a name="bookmark67"></a><a name="bookmark854"></a>8.7. rmdir</span></h2></li></ul>
<h4><a name="bookmark855"></a><span class="font25"><a name="bookmark856"></a><a name="bookmark857"></a>When a directory is empty, you can use </span><span class="font25" style="font-weight:bold;">rmdir </span><span class="font25">to remove the directory.</span></h4>
<p><span class="font19">paul@debian8:~/mydir$ </span><span class="font19" style="font-weight:bold;">ls -l </span><span class="font19">total 8</span></p>
<p><span class="font19">drwxr-xr-x 2 paul paul 4096 Sep 17 00:08 otherstuff drwxr-xr-x 2 paul paul 4096 Sep 17 00:08 stuff paul@debian8:~/mydir$ </span><span class="font19" style="font-weight:bold;">rmdir otherstuff </span><span class="font19">paul@debian8:~/mydir$ </span><span class="font19" style="font-weight:bold;">cd ..</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">rmdir mydir</span></p>
<p><span class="font19">rmdir: failed to remove ‘mydir’: Directory not empty paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">rmdir mydir/stuff </span><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">rmdir mydir </span><span class="font19">paul@debian8:~$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark858"></a><span class="font9" style="font-weight:bold;"><a name="bookmark859"></a>8.7.1. rmdir -p</span></h3></li></ul>
<h4><a name="bookmark860"></a><span class="font25"><a name="bookmark861"></a><a name="bookmark862"></a>And similar to the </span><span class="font25" style="font-weight:bold;">mkdir -p </span><span class="font25">option, you can also use </span><span class="font25" style="font-weight:bold;">rmdir </span><span class="font25">to recursively remove directories.</span></h4>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">mkdir -p test42/subdir</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">rmdir -p test42/subdir</span></p>
<p><span class="font19">paul@debian8:~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark863"></a><span class="font10" style="font-weight:bold;"><a name="bookmark68"></a><a name="bookmark864"></a>8.8. practice: working with directories</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Display your current directory.</span></p></li>
<li>
<p><span class="font25">2. Change to the /etc directory.</span></p></li>
<li>
<p><span class="font25">3. Now change to your home directory using only three key presses.</span></p></li>
<li>
<p><span class="font25">4. Change to the /boot/grub directory using only eleven key presses.</span></p></li>
<li>
<p><span class="font25">5. Go to the parent directory of the current directory.</span></p></li>
<li>
<p><span class="font25">6. Go to the root directory.</span></p></li>
<li>
<p><span class="font25">7. List the contents of the root directory.</span></p></li>
<li>
<p><span class="font25">8. List a long listing of the root directory.</span></p></li>
<li>
<p><span class="font25">9. Stay where you are, and list the contents of /etc.</span></p></li>
<li>
<p><span class="font25">10. Stay where you are, and list the contents of /bin and /sbin.</span></p></li>
<li>
<p><span class="font25">11. Stay where you are, and list the contents of ~.</span></p></li>
<li>
<p><span class="font25">12. List all the files (including hidden files) in your home directory.</span></p></li>
<li>
<p><span class="font25">13. List the files in /boot in a human readable format.</span></p></li>
<li>
<p><span class="font25">14. Create a directory testdir in your home directory.</span></p></li>
<li>
<p><span class="font25">15. Change to the /etc directory, stay here and create a directory newdir in your home directory.</span></p></li>
<li>
<p><span class="font25">16. Create in one command the directories ~/dir1/dir2/dir3 (dir3 is a subdirectory from dir2, and dir2 is a subdirectory from dir1 ).</span></p></li>
<li>
<p><span class="font25">17. Remove the directory testdir.</span></p></li>
<li>
<p><span class="font25">18. If time permits (or if you are waiting for other students to finish this practice), use and understand </span><span class="font25" style="font-weight:bold;">pushd </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">popd</span><span class="font25">. Use the man page of </span><span class="font25" style="font-weight:bold;">bash </span><span class="font25">to find information about these commands.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark865"></a><span class="font10" style="font-weight:bold;"><a name="bookmark69"></a><a name="bookmark866"></a>8.9. solution: working with directories</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Display your current directory.</span></p></li></ul>
<p><span class="font19">pwd</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Change to the /etc directory.</span></p></li></ul>
<p><span class="font19">cd /etc</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Now change to your home directory using only three key presses. </span><span class="font19">cd (and the enter key)</span></p></li>
<li>
<p><span class="font25">4. Change to the /boot/grub directory using only eleven key presses. </span><span class="font19">cd /boot/grub (use the tab key)</span></p></li>
<li>
<p><span class="font25">5. Go to the parent directory of the current directory.</span></p></li></ul>
<p><span class="font19">cd .. (with space between cd and ..)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Go to the root directory.</span></p></li></ul>
<p><span class="font19">cd /</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. List the contents of the root directory.</span></p></li></ul>
<p><span class="font19">ls</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. List a long listing of the root directory.</span></p></li></ul>
<p><span class="font19">ls -l</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">9. Stay where you are, and list the contents of /etc.</span></p></li></ul>
<p><span class="font19">ls /etc</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">10. Stay where you are, and list the contents of /bin and /sbin.</span></p></li></ul>
<p><span class="font19">ls /bin /sbin</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">11. Stay where you are, and list the contents of ~.</span></p></li></ul>
<p><span class="font19">ls ~</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">12. List all the files (including hidden files) in your home directory.</span></p></li></ul>
<p><span class="font19">ls -al ~</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">13. List the files in /boot in a human readable format.</span></p></li></ul>
<p><span class="font19">ls -lh /boot</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">14. Create a directory testdir in your home directory.</span></p></li></ul>
<p><span class="font19">mkdir ~/testdir</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">15. Change to the /etc directory, stay here and create a directory newdir in your home directory.</span></p></li></ul>
<p><span class="font19">cd /etc ; mkdir ~/newdir</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">16. Create in one command the directories ~/dir1/dir2/dir3 (dir3 is a subdirectory from dir2, and dir2 is a subdirectory from dir1 ).</span></p></li></ul>
<p><span class="font19">mkdir -p ~/dir1/dir2/dir3</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">17. Remove the directory testdir.</span></p></li></ul>
<p><span class="font19">rmdir testdir</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">18. If time permits (or if you are waiting for other students to finish this practice), use and understand </span><span class="font25" style="font-weight:bold;">pushd </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">popd</span><span class="font25">. Use the man page of </span><span class="font25" style="font-weight:bold;">bash </span><span class="font25">to find information about these commands.</span></p></li></ul>
<p><span class="font19">man bash &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# opens the manual</span></p>
<p><span class="font19">/pushd &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# searches for pushd</span></p>
<p><span class="font19">n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# next (do this two/three times)</span></p>
<p><a name="bookmark867"></a><span class="font25"><a name="bookmark868"></a>The Bash shell has two built-in commands called </span><span class="font25" style="font-weight:bold;">pushd </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">popd</span><span class="font25">. Both commands work with a common stack of previous directories. Pushd adds a directory to the stack and changes to a new current directory, popd removes a directory from the stack and sets the current directory.</span></p>
<p><span class="font19">paul@debian7:/etc$ </span><span class="font19" style="font-weight:bold;">cd /bin</span></p>
<p><span class="font19">paul@debian7:/bin$ </span><span class="font19" style="font-weight:bold;">pushd /lib</span></p>
<p><span class="font19">/lib /bin</span></p>
<p><span class="font19">paul@debian7:/lib$ </span><span class="font19" style="font-weight:bold;">pushd /proc</span></p>
<p><span class="font19">/proc /lib /bin</span></p>
<p><span class="font19">paul@debian7:/proc$ </span><span class="font19" style="font-weight:bold;">popd</span></p>
<p><span class="font19">/lib /bin</span></p>
<p><span class="font19">paul@debian7:/lib$ </span><span class="font19" style="font-weight:bold;">popd</span></p>
<p><span class="font19">/bin</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark869"></a><span class="font11" style="font-weight:bold;"><a name="bookmark70"></a><a name="bookmark870"></a>Chapter 9. working with files</span></h1></li></ul>
<p><span class="font25">In this chapter we learn how to recognise, create, remove, copy and move files using commands like </span><span class="font25" style="font-weight:bold;">file, touch, rm, cp, mv </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">rename</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark871"></a><span class="font10" style="font-weight:bold;"><a name="bookmark71"></a><a name="bookmark872"></a>9.1. all files are case sensitive</span></h2></li></ul>
<p><a name="bookmark873"></a><span class="font25">Files on Linux (or any Unix) are </span><span class="font25" style="font-weight:bold;">case sensitive</span><span class="font25">. This means that </span><span class="font25" style="font-weight:bold;">FILE1 </span><span class="font25">is different from </span><span class="font25" style="font-weight:bold;">file1</span><span class="font25">, and </span><span class="font25" style="font-weight:bold;">/etc/hosts </span><span class="font25">is different from </span><span class="font25" style="font-weight:bold;">/etc/Hosts </span><span class="font25">(the latter one does not exist on a typical Linux computer).</span></p>
<p><span class="font25">This screenshot shows the difference between two files, one with upper case </span><span class="font25" style="font-weight:bold;">W</span><span class="font25">, the other with lower case </span><span class="font25" style="font-weight:bold;">w</span><span class="font25">.</span></p>
<p><span class="font19">paul@laika:~/Linux$ </span><span class="font19" style="font-weight:bold;">ls </span><span class="font19">winter.txt Winter.txt paul@laika:~/Linux$ </span><span class="font19" style="font-weight:bold;">cat winter.txt </span><span class="font19">It is cold.</span></p>
<p><span class="font19">paul@laika:~/Linux$ </span><span class="font19" style="font-weight:bold;">cat Winter.txt </span><span class="font19">It is very cold!</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark874"></a><span class="font10" style="font-weight:bold;"><a name="bookmark72"></a><a name="bookmark875"></a>9.2. everything is a file</span></h2></li></ul>
<p><span class="font25">A </span><span class="font25" style="font-weight:bold;">directory </span><span class="font25">is a special kind of </span><span class="font25" style="font-weight:bold;">file</span><span class="font25">, but it is still a (case sensitive!) </span><span class="font25" style="font-weight:bold;">file</span><span class="font25">. Each terminal window (for example </span><span class="font25" style="font-weight:bold;">/dev/pts/4</span><span class="font25">), any hard disk or partition (for example </span><span class="font25" style="font-weight:bold;">/dev/sdb1</span><span class="font25">) and any process are all represented somewhere in the </span><span class="font25" style="font-weight:bold;">file system </span><span class="font25">as a </span><span class="font25" style="font-weight:bold;">file</span><span class="font25">. It will become clear throughout this course that everything on Linux is a </span><span class="font25" style="font-weight:bold;">file</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark876"></a><span class="font10" style="font-weight:bold;"><a name="bookmark73"></a><a name="bookmark877"></a>9.3. file</span></h2></li></ul>
<p><a name="bookmark878"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">file </span><span class="font25">utility determines the file type. Linux does not use extensions to determine the file type. The command line does not care whether a file ends in .txt or .pdf. As a system administrator, you should use the </span><span class="font25" style="font-weight:bold;">file </span><span class="font25">command to determine the file type. Here are some examples on a typical Linux system.</span></p>
<p><span class="font19">paul@laika:~$ </span><span class="font19" style="font-weight:bold;">file pic33.png</span></p>
<p><span class="font19">pic33.png: PNG image data, 3840 x 1200, 8-bit/color RGBA, non-interlaced paul@laika:~$ </span><span class="font19" style="font-weight:bold;">file /etc/passwd </span><span class="font19">/etc/passwd: ASCII text</span></p>
<p><span class="font19">paul@laika:~$ </span><span class="font19" style="font-weight:bold;">file HelloWorld.c</span></p>
<p><span class="font19">HelloWorld.c: ASCII C program text</span></p>
<p><a name="bookmark879"></a><span class="font25">The file command uses a magic file that contains patterns to recognise file types. The magic file is located in </span><span class="font25" style="font-weight:bold;">/usr/share/file/magic</span><span class="font25">. Type </span><span class="font25" style="font-weight:bold;">man 5 magic </span><span class="font25">for more information.</span></p>
<p><a name="bookmark880"></a><span class="font25"><a name="bookmark881"></a>It is interesting to point out </span><span class="font25" style="font-weight:bold;">file -s </span><span class="font25">for special files like those in </span><span class="font25" style="font-weight:bold;">/dev </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/proc</span><span class="font25">.</span></p>
<p><span class="font19">root@debian6~# </span><span class="font19" style="font-weight:bold;">file /dev/sda </span><span class="font19">/dev/sda: block special</span></p>
<p><span class="font19">root@debian6~# </span><span class="font19" style="font-weight:bold;">file -s /dev/sda</span></p>
<p><span class="font19">/dev/sda: x86 boot sector; partition 1: ID=0x83, active, starthead...</span></p>
<p><span class="font19">root@debian6~# </span><span class="font19" style="font-weight:bold;">file /proc/cpuinfo </span><span class="font19">/proc/cpuinfo: empty</span></p>
<p><span class="font19">root@debian6~# </span><span class="font19" style="font-weight:bold;">file -s /proc/cpuinfo </span><span class="font19">/proc/cpuinfo: ASCII C++ program text</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark882"></a><span class="font10" style="font-weight:bold;"><a name="bookmark74"></a><a name="bookmark883"></a>9.4. touch</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark884"></a><span class="font9" style="font-weight:bold;"><a name="bookmark885"></a>9.4.1. create an empty file</span></h3></li></ul></li></ul>
<h4><a name="bookmark886"></a><span class="font25"><a name="bookmark887"></a><a name="bookmark888"></a>One easy way to create an empty file is with </span><span class="font25" style="font-weight:bold;">touch</span><span class="font25">. (We will see many other ways for creating files later in this book.)</span></h4>
<h4><a name="bookmark889"></a><span class="font25"><a name="bookmark890"></a>This screenshot starts with an empty directory, creates two files with </span><span class="font25" style="font-weight:bold;">touch </span><span class="font25">and the lists those files.</span></h4>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">ls -l </span><span class="font19">total 0</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">touch file42</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">touch file33</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">ls -l </span><span class="font19">total 0</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-r--r-- 1 paul paul 0 Oct 15 08:57 file33</span></p></li>
<li>
<p><span class="font19">-rw-r--r-- 1 paul paul 0 Oct 15 08:56 file42 paul@debian7:~$</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark891"></a><span class="font9" style="font-weight:bold;"><a name="bookmark892"></a>9.4.2. touch -t</span></h3></li></ul>
<h4><a name="bookmark893"></a><span class="font25"><a name="bookmark894"></a>The </span><span class="font25" style="font-weight:bold;">touch </span><span class="font25">command can set some properties while creating empty files. Can you determine what is set by looking at the next screenshot? If not, check the manual for </span><span class="font25" style="font-weight:bold;">touch</span><span class="font25">.</span></h4>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">touch -t 200505050000 SinkoDeMayo</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">touch -t 130207111630 BigBattle.txt</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">ls -l </span><span class="font19">total 0</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">-rw-r--r--</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Jul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">11</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1302</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">BigBattle.txt</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-rw-r--r--</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Oct</span></p></td><td style="vertical-align:top;">
<p><span class="font19">15</span></p></td><td style="vertical-align:top;">
<p><span class="font19">08:57</span></p></td><td style="vertical-align:top;">
<p><span class="font19">file33</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-rw-r--r--</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Oct</span></p></td><td style="vertical-align:top;">
<p><span class="font19">15</span></p></td><td style="vertical-align:top;">
<p><span class="font19">08:56</span></p></td><td style="vertical-align:top;">
<p><span class="font19">file42</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-rw-r--r--</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">May</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2005</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SinkoDeMayo</span></p></td></tr>
</table>
<p><span class="font19">paul@debian7:~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark895"></a><span class="font10" style="font-weight:bold;"><a name="bookmark75"></a><a name="bookmark896"></a>9.5. rm</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark897"></a><span class="font9" style="font-weight:bold;"><a name="bookmark898"></a>9.5.1. remove forever</span></h3></li></ul></li></ul>
<p><a name="bookmark899"></a><span class="font25">When you no longer need a file, use </span><span class="font25" style="font-weight:bold;">rm </span><span class="font25">to remove it. Unlike some graphical user interfaces, the command line in general does not have a </span><span class="font25" style="font-weight:bold;">waste bin </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">trash can </span><span class="font25">to recover files. When you use </span><span class="font25" style="font-weight:bold;">rm </span><span class="font25">to remove a file, the file is gone. Therefore, be careful when removing files!</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">ls</span></p>
<p><span class="font19">BigBattle.txt file33 file42 SinkoDeMayo</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">rm BigBattle.txt</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">ls</span></p>
<p><span class="font19">file33 file42 SinkoDeMayo</span></p>
<p><span class="font19">paul@debian7:~$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark900"></a><span class="font9" style="font-weight:bold;"><a name="bookmark901"></a>9.5.2. rm -i</span></h3></li></ul>
<p><span class="font25">To prevent yourself from accidentally removing a file, you can type </span><span class="font25" style="font-weight:bold;">rm -i</span><span class="font25">.</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">ls</span></p>
<p><span class="font19">file33 file42 SinkoDeMayo</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">rm -i file33</span></p>
<p><span class="font19">rm: remove regular empty file 'file33'? yes</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">rm -i SinkoDeMayo</span></p>
<p><span class="font19">rm: remove regular empty file 'SinkoDeMayo'? n paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">ls</span></p>
<p><span class="font19">file42 SinkoDeMayo</span></p>
<p><span class="font19">paul@debian7:~$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark902"></a><span class="font9" style="font-weight:bold;"><a name="bookmark903"></a>9.5.3. rm -rf</span></h3></li></ul>
<p><a name="bookmark904"></a><span class="font25">By default, </span><span class="font25" style="font-weight:bold;">rm -r </span><span class="font25">will not remove non-empty directories. However </span><span class="font25" style="font-weight:bold;">rm </span><span class="font25">accepts several options that will allow you to remove any directory. The </span><span class="font25" style="font-weight:bold;">rm -rf </span><span class="font25">statement is famous because it will erase anything (providing that you have the permissions to do so). When you are logged on as root, be very careful with </span><span class="font25" style="font-weight:bold;">rm -rf </span><span class="font25">(the </span><span class="font25" style="font-weight:bold;">f </span><span class="font25">means </span><span class="font25" style="font-weight:bold;">force </span><span class="font25">and the </span><span class="font25" style="font-weight:bold;">r </span><span class="font25">means </span><span class="font25" style="font-weight:bold;">recursive</span><span class="font25">) since being root implies that permissions don't apply to you. You can literally erase your entire file system by accident.</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">mkdir test</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">rm test</span></p>
<p><span class="font19">rm: cannot remove 'test': Is a directory</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">rm -rf test</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">ls test</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">ls: cannot access test: No such file or directory</span></p></li></ul>
<p><span class="font19">paul@debian7:~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark905"></a><span class="font10" style="font-weight:bold;"><a name="bookmark76"></a><a name="bookmark906"></a>9.6. cp</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark907"></a><span class="font9" style="font-weight:bold;"><a name="bookmark908"></a>9.6.1. copy one file</span></h3></li></ul></li></ul>
<h4><a name="bookmark909"></a><span class="font25"><a name="bookmark910"></a><a name="bookmark911"></a>To copy a file, use </span><span class="font25" style="font-weight:bold;">cp </span><span class="font25">with a source and a target argument.</span></h4>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">ls </span><span class="font19">file42 SinkoDeMayo paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">cp file42 file42.copy </span><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">ls </span><span class="font19">file42 file42.copy SinkoDeMayo</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark912"></a><span class="font9" style="font-weight:bold;"><a name="bookmark913"></a>9.6.2. copy to another directory</span></h3></li></ul>
<h4><a name="bookmark914"></a><span class="font25"><a name="bookmark915"></a>If the target is a directory, then the source files are copied to that target directory.</span></h4>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">mkdir dir42</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">cp SinkoDeMayo dir42</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">ls dir42/ </span><span class="font19">SinkoDeMayo</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark916"></a><span class="font9" style="font-weight:bold;"><a name="bookmark917"></a>9.6.3. cp -r</span></h3></li></ul>
<h4><a name="bookmark918"></a><span class="font25"><a name="bookmark919"></a><a name="bookmark920"></a>To copy complete directories, use </span><span class="font25" style="font-weight:bold;">cp -r </span><span class="font25">(the </span><span class="font25" style="font-weight:bold;">-r </span><span class="font25">option forces </span><span class="font25" style="font-weight:bold;">recursive </span><span class="font25">copying of all files in all subdirectories).</span></h4>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">ls </span><span class="font19">dir42 file42 file42.copy SinkoDeMayo paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">cp -r dir42/ dir33 </span><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">ls </span><span class="font19">dir33 dir42 file42 file42.copy SinkoDeMayo paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">ls dir33/ </span><span class="font19">SinkoDeMayo</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark921"></a><span class="font9" style="font-weight:bold;"><a name="bookmark922"></a>9.6.4. copy multiple files to directory</span></h3></li></ul>
<h4><a name="bookmark923"></a><span class="font25"><a name="bookmark924"></a>You can also use cp to copy multiple files into a directory. In this case, the last argument (a.k.a. the target) must be a directory.</span></h4>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">cp file42 file42.copy SinkoDeMayo dir42/ </span><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">ls dir42/ </span><span class="font19">file42 file42.copy SinkoDeMayo</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark925"></a><span class="font9" style="font-weight:bold;"><a name="bookmark926"></a>9.6.5. cp -i</span></h3></li></ul>
<h4><a name="bookmark927"></a><span class="font25"><a name="bookmark928"></a>To prevent </span><span class="font25" style="font-weight:bold;">cp </span><span class="font25">from overwriting existing files, use the </span><span class="font25" style="font-weight:bold;">-i </span><span class="font25">(for interactive) option.</span></h4>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">cp SinkoDeMayo file42 </span><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">cp SinkoDeMayo file42 </span><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">cp -i SinkoDeMayo file42 </span><span class="font19">cp: overwrite 'file42'? </span><span class="font19" style="font-weight:bold;">n </span><span class="font19">paul@debian7:~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark929"></a><span class="font10" style="font-weight:bold;"><a name="bookmark77"></a><a name="bookmark930"></a>9.7. mv</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark931"></a><span class="font9" style="font-weight:bold;"><a name="bookmark932"></a>9.7.1. rename files with mv</span></h3></li></ul></li></ul>
<h4><a name="bookmark933"></a><span class="font25"><a name="bookmark934"></a><a name="bookmark935"></a>Use </span><span class="font25" style="font-weight:bold;">mv </span><span class="font25">to rename a file or to move the file to another directory.</span></h4>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">ls</span></p>
<p><span class="font19">dir33 dir42 file42 file42.copy SinkoDeMayo</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">mv file42 file33</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">ls</span></p>
<p><span class="font19">dir33 dir42 file33 file42.copy SinkoDeMayo paul@debian7:~$</span></p>
<h4><a name="bookmark936"></a><span class="font25"><a name="bookmark937"></a>When you need to rename only one file then </span><span class="font25" style="font-weight:bold;">mv </span><span class="font25">is the preferred command to use.</span></h4>
<ul style="list-style:none;"><li>
<h3><a name="bookmark938"></a><span class="font9" style="font-weight:bold;"><a name="bookmark939"></a>9.7.2. rename directories with mv</span></h3></li></ul>
<h4><a name="bookmark940"></a><span class="font25"><a name="bookmark941"></a>The same </span><span class="font25" style="font-weight:bold;">mv </span><span class="font25">command can be used to rename directories.</span></h4>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">ls -l </span><span class="font19">total 8</span></p>
<p><span class="font19">drwxr-xr-x 2 paul paul 4096 Oct 15 09:36 dir33</span></p>
<p><span class="font19">drwxr-xr-x 2 paul paul 4096 Oct 15 09:36 dir42</span></p>
<p><span class="font19">-rw-r--r-- 1 paul paul &nbsp;&nbsp;&nbsp;0 Oct 15 09:38 file33</span></p>
<p><span class="font19">-rw-r--r-- 1 paul paul &nbsp;&nbsp;&nbsp;0 Oct 15 09:16 file42.copy</span></p>
<p><span class="font19">-rw-r--r-- 1 paul paul &nbsp;&nbsp;&nbsp;0 May &nbsp;5 &nbsp;2005 SinkoDeMayo</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">mv dir33 backup </span><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">ls -l </span><span class="font19">total 8</span></p>
<p><span class="font19">drwxr-xr-x 2 paul paul 4096 Oct 15 09:36 backup</span></p>
<p><span class="font19">drwxr-xr-x 2 paul paul 4096 Oct 15 09:36 dir42</span></p>
<p><span class="font19">-rw-r--r-- 1 paul paul &nbsp;&nbsp;&nbsp;0 Oct 15 09:38 file33</span></p>
<p><span class="font19">-rw-r--r-- 1 paul paul &nbsp;&nbsp;&nbsp;0 Oct 15 09:16 file42.copy</span></p>
<p><span class="font19">-rw-r--r-- 1 paul paul &nbsp;&nbsp;&nbsp;0 May &nbsp;5 &nbsp;2005 SinkoDeMayo</span></p>
<p><span class="font19">paul@debian7:~$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark942"></a><span class="font9" style="font-weight:bold;"><a name="bookmark943"></a>9.7.3. mv -i</span></h3></li></ul>
<h4><a name="bookmark944"></a><span class="font25"><a name="bookmark945"></a>The </span><span class="font25" style="font-weight:bold;">mv </span><span class="font25">also has a </span><span class="font25" style="font-weight:bold;">-i </span><span class="font25">switch similar to </span><span class="font25" style="font-weight:bold;">cp </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">rm</span><span class="font25">.</span><br><br><span class="font25"><a name="bookmark946"></a>this screenshot shows that </span><span class="font25" style="font-weight:bold;">mv -i </span><span class="font25">will ask permission to overwrite an existing file.</span></h4>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">mv -i file33 SinkoDeMayo </span><span class="font19">mv: overwrite 'SinkoDeMayo'? </span><span class="font19" style="font-weight:bold;">no </span><span class="font19">paul@debian7:~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark947"></a><span class="font10" style="font-weight:bold;"><a name="bookmark78"></a><a name="bookmark948"></a>9.8. rename</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark949"></a><span class="font9" style="font-weight:bold;"><a name="bookmark950"></a>9.8.1. about rename</span></h3></li></ul></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">rename </span><span class="font25">command is one of the rare occasions where the Linux Fundamentals book has to make a distinction between Linux distributions. Almost every command in the </span><span class="font25" style="font-weight:bold;">Fundamentals </span><span class="font25">part of this book works on almost every Linux computer. But </span><span class="font25" style="font-weight:bold;">rename </span><span class="font25">is different.</span></p>
<p><span class="font25">Try to use </span><span class="font25" style="font-weight:bold;">mv </span><span class="font25">whenever you need to rename only a couple of files.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark951"></a><span class="font9" style="font-weight:bold;"><a name="bookmark952"></a>9.8.2. rename on Debian/Ubuntu</span></h3></li></ul>
<p><a name="bookmark953"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">rename </span><span class="font25">command on Debian uses regular expressions (regular expression or shor regex are explained in a later chapter) to rename many files at once.</span></p>
<p><span class="font25">Below a </span><span class="font25" style="font-weight:bold;">rename </span><span class="font25">example that switches all occurrences of txt to png for all file names ending in .txt.</span></p>
<p><span class="font19">paul@debian7:~/test42$ </span><span class="font19" style="font-weight:bold;">ls</span></p>
<p><span class="font19">abc.txt file33.txt file42.txt</span></p>
<p><span class="font19">paul@debian7:~/test42$ </span><span class="font19" style="font-weight:bold;">rename 's/\.txt/\.png/' *.txt</span></p>
<p><span class="font19">paul@debian7:~/test42$ </span><span class="font19" style="font-weight:bold;">ls</span></p>
<p><span class="font19">abc.png file33.png file42.png</span></p>
<p><span class="font25">This second example switches all (first) occurrences of </span><span class="font25" style="font-weight:bold;">file </span><span class="font25">into </span><span class="font25" style="font-weight:bold;">document </span><span class="font25">for all file names ending in .png.</span></p>
<p><span class="font19">paul@debian7:~/test42$ </span><span class="font19" style="font-weight:bold;">ls</span></p>
<p><span class="font19">abc.png file33.png file42.png</span></p>
<p><span class="font19">paul@debian7:~/test42$ </span><span class="font19" style="font-weight:bold;">rename 's/file/document/' *.png</span></p>
<p><span class="font19">paul@debian7:~/test42$ </span><span class="font19" style="font-weight:bold;">ls</span></p>
<p><span class="font19">abc.png document33.png document42.png</span></p>
<p><span class="font19">paul@debian7:~/test42$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark954"></a><span class="font9" style="font-weight:bold;"><a name="bookmark955"></a>9.8.3. rename on CentOS/RHEL/Fedora</span></h3></li></ul>
<p><span class="font25">On Red Hat Enterprise Linux, the syntax of </span><span class="font25" style="font-weight:bold;">rename </span><span class="font25">is a bit different. The first example below renames all *.conf files replacing any occurrence of .conf with .backup.</span></p>
<p><span class="font19">[paul@centos7 ~]$ </span><span class="font19" style="font-weight:bold;">touch one.conf two.conf three.conf</span></p>
<p><span class="font19">[paul@centos7 ~]$ </span><span class="font19" style="font-weight:bold;">rename .conf .backup *.conf</span></p>
<p><span class="font19">[paul@centos7 ~]$ </span><span class="font19" style="font-weight:bold;">ls</span></p>
<p><span class="font19">one.backup three.backup two.backup [paul@centos7 ~]$</span></p>
<p><span class="font25">The second example renames all (*) files replacing one with ONE.</span></p>
<p><span class="font19">[paul@centos7 ~]$ </span><span class="font19" style="font-weight:bold;">ls</span></p>
<p><span class="font19">one.backup three.backup two.backup</span></p>
<p><span class="font19">[paul@centos7 ~]$ </span><span class="font19" style="font-weight:bold;">rename one ONE *</span></p>
<p><span class="font19">[paul@centos7 ~]$ </span><span class="font19" style="font-weight:bold;">ls</span></p>
<p><span class="font19">ONE.backup three.backup two.backup</span></p>
<p><span class="font19">[paul@centos7 ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark956"></a><span class="font10" style="font-weight:bold;"><a name="bookmark79"></a><a name="bookmark957"></a>9.9. practice: working with files</span></h2></li>
<li>
<p><span class="font25">1. List the files in the /bin directory</span></p></li>
<li>
<p><span class="font25">2. Display the type of file of /bin/cat, /etc/passwd and /usr/bin/passwd.</span></p></li></ul>
<p><span class="font25">3a. Download wolf.jpg and LinuxFun.pdf from </span><a href="http://linux-training.be"><span class="font25">http://linux-training.be</span></a><span class="font25"> (wget http:// linux-training.be/files/studentfiles/wolf.jpg and wget </span><a href="http://linux-training.be/files/books/"><span class="font25">http://linux-training.be/files/books/</span></a><span class="font25"> LinuxFun.pdf)</span></p>
<p><span class="font19">wget </span><a href="http://linux-training.be/files/studentfiles/wolf.jpg"><span class="font19">http://linux-training.be/files/studentfiles/wolf.jpg</span></a></p>
<p><span class="font19">wget </span><a href="http://linux-training.be/files/studentfiles/wolf.png"><span class="font19">http://linux-training.be/files/studentfiles/wolf.png</span></a></p>
<p><span class="font19">wget </span><a href="http://linux-training.be/files/books/LinuxFun.pdf"><span class="font19">http://linux-training.be/files/books/LinuxFun.pdf</span></a></p>
<p><span class="font25">3b. Display the type of file of wolf.jpg and LinuxFun.pdf</span></p>
<p><span class="font25">3c. Rename wolf.jpg to wolf.pdf (use mv).</span></p>
<p><span class="font25">3d. Display the type of file of wolf.pdf and LinuxFun.pdf.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Create a directory ~/touched and enter it.</span></p></li>
<li>
<p><span class="font25">5. Create the files today.txt and yesterday.txt in touched.</span></p></li>
<li>
<p><span class="font25">6. Change the date on yesterday.txt to match yesterday's date.</span></p></li>
<li>
<p><span class="font25">7. Copy yesterday.txt to copy.yesterday.txt</span></p></li>
<li>
<p><span class="font25">8. Rename copy.yesterday.txt to kim</span></p></li>
<li>
<p><span class="font25">9. Create a directory called ~/testbackup and copy all files from ~/touched into it.</span></p></li>
<li>
<p><span class="font25">10. Use one command to remove the directory ~/testbackup and all files into it.</span></p></li>
<li>
<p><span class="font25">11. Create a directory ~/etcbackup and copy all *.conf files from /etc into it. Did you include all subdirectories of /etc ?</span></p></li>
<li>
<p><span class="font25">12. Use rename to rename all *.conf files to *.backup . (if you have more than one distro available, try it on all!)</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark958"></a><span class="font10" style="font-weight:bold;"><a name="bookmark80"></a><a name="bookmark959"></a>9.10. solution: working with files</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. List the files in the /bin directory</span></p></li></ul>
<p><span class="font19">ls /bin</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Display the type of file of /bin/cat, /etc/passwd and /usr/bin/passwd.</span></p></li></ul>
<p><span class="font19">file /bin/cat /etc/passwd /usr/bin/passwd</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3a. Download wolf.jpg and LinuxFun.pdf from </span><a href="http://linux-training.be"><span class="font25">http://linux-training.be</span></a><span class="font25"> (wget http:// linux-training.be/files/studentfiles/wolf.jpg and wget </span><a href="http://linux-training.be/files/books/"><span class="font25">http://linux-training.be/files/books/</span></a><span class="font25"> LinuxFun.pdf)</span></p></li></ul>
<p><span class="font19">wget </span><a href="http://linux-training.be/files/studentfiles/wolf.jpg"><span class="font19">http://linux-training.be/files/studentfiles/wolf.jpg</span></a></p>
<p><span class="font19">wget </span><a href="http://linux-training.be/files/studentfiles/wolf.png"><span class="font19">http://linux-training.be/files/studentfiles/wolf.png</span></a></p>
<p><span class="font19">wget </span><a href="http://linux-training.be/files/books/LinuxFun.pdf"><span class="font19">http://linux-training.be/files/books/LinuxFun.pdf</span></a></p>
<p><span class="font25">3b. Display the type of file of wolf.jpg and LinuxFun.pdf</span></p>
<p><span class="font19">file wolf.jpg LinuxFun.pdf</span></p>
<p><span class="font25">3c. Rename wolf.jpg to wolf.pdf (use mv).</span></p>
<p><span class="font19">mv wolf.jpg wolf.pdf</span></p>
<p><span class="font25">3d. Display the type of file of wolf.pdf and LinuxFun.pdf.</span></p>
<p><span class="font19">file wolf.pdf LinuxFun.pdf</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Create a directory ~/touched and enter it.</span></p></li></ul>
<p><span class="font19">mkdir ~/touched ; cd ~/touched</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Create the files today.txt and yesterday.txt in touched.</span></p></li></ul>
<p><span class="font19">touch today.txt yesterday.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Change the date on yesterday.txt to match yesterday's date.</span></p></li></ul>
<p><span class="font19">touch -t 200810251405 yesterday.txt (substitute 20081025 with yesterday)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. Copy yesterday.txt to copy.yesterday.txt</span></p></li></ul>
<p><span class="font19">cp yesterday.txt copy.yesterday.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. Rename copy.yesterday.txt to kim</span></p></li></ul>
<p><span class="font19">mv copy.yesterday.txt kim</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">9. Create a directory called ~/testbackup and copy all files from ~/touched into it.</span></p></li></ul>
<p><span class="font19">mkdir ~/testbackup ; cp -r ~/touched ~/testbackup/</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">10. Use one command to remove the directory ~/testbackup and all files into it.</span></p></li></ul>
<p><span class="font19">rm -rf ~/testbackup</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">11. Create a directory ~/etcbackup and copy all *.conf files from /etc into it. Did you include all subdirectories of /etc ?</span></p></li></ul>
<p><span class="font19">cp -r /etc/*.conf ~/etcbackup</span></p>
<p><span class="font19">Only *.conf files that are directly in /etc/ are copied.</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark960"></a><span class="font25"><a name="bookmark961"></a>12. Use rename to rename all *.conf files to *.backup . (if you have more than one distro available, try it on all!)</span></h4></li></ul>
<p><span class="font19">On RHEL: touch l.conf 2.conf ; rename conf backup *.conf</span></p>
<p><span class="font19">On Debian: touch 1.conf 2.conf ; rename 's/conf/backup/' *.conf</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark962"></a><span class="font11" style="font-weight:bold;"><a name="bookmark81"></a><a name="bookmark963"></a>Chapter 10. working with file contents</span></h1></li></ul>
<p><span class="font25">In this chapter we will look at the contents of </span><span class="font25" style="font-weight:bold;">text files </span><span class="font25">with </span><span class="font25" style="font-weight:bold;">head, tail, cat, tac, more, less </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">strings</span><span class="font25">.</span></p>
<p><span class="font25">We will also get a glimpse of the possibilities of tools like </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">on the command line.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark964"></a><span class="font10" style="font-weight:bold;"><a name="bookmark82"></a><a name="bookmark965"></a>10.1. head</span></h2></li></ul>
<h4><a name="bookmark966"></a><span class="font25"><a name="bookmark967"></a><a name="bookmark968"></a>You can use </span><span class="font25" style="font-weight:bold;">head </span><span class="font25">to display the first ten lines of a file.</span></h4>
<p><span class="font19">paul@debian7~$ </span><span class="font19" style="font-weight:bold;">head /etc/passwd </span><span class="font19">root:x:0:0:root:/root:/bin/bash</span></p>
<p><span class="font19">daemon:x:1:1:daemon:/usr/sbin:/bin/sh</span></p>
<p><span class="font19">bin:x:2:2:bin:/bin:/bin/sh sys:x:3:3:sys:/dev:/bin/sh sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/bin/sh man:x:6:12:man:/var/cache/man:/bin/sh lp:x:7:7:lp:/var/spool/lpd:/bin/sh mail:x:8:8:mail:/var/mail:/bin/sh</span></p>
<p><span class="font19">news:x:9:9:news:/var/spool/news:/bin/sh root@debian7~#</span></p>
<h4><a name="bookmark969"></a><span class="font25"><a name="bookmark970"></a>The </span><span class="font25" style="font-weight:bold;">head </span><span class="font25">command can also display the first </span><span class="font25" style="font-weight:bold;">n </span><span class="font25">lines of a file.</span></h4>
<p><span class="font19">paul@debian7~$ </span><span class="font19" style="font-weight:bold;">head -4 /etc/passwd</span></p>
<p><span class="font19">root:x:0:0:root:/root:/bin/bash</span></p>
<p><span class="font19">daemon:x:1:1:daemon:/usr/sbin:/bin/sh</span></p>
<p><span class="font19">bin:x:2:2:bin:/bin:/bin/sh</span></p>
<p><span class="font19">sys:x:3:3:sys:/dev:/bin/sh</span></p>
<p><span class="font19">paul@debian7~$</span></p>
<h4><a name="bookmark971"></a><span class="font25"><a name="bookmark972"></a>And </span><span class="font25" style="font-weight:bold;">head </span><span class="font25">can also display the first </span><span class="font25" style="font-weight:bold;">n bytes</span><span class="font25">.</span></h4>
<p><span class="font19">paul@debian7~$ </span><span class="font19" style="font-weight:bold;">head -c14 /etc/passwd</span></p>
<p><span class="font19">root:x:0:0:roopaul@debian7~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark973"></a><span class="font10" style="font-weight:bold;"><a name="bookmark83"></a><a name="bookmark974"></a>10.2. tail</span></h2></li></ul>
<h4><a name="bookmark975"></a><span class="font25"><a name="bookmark976"></a><a name="bookmark977"></a>Similar to </span><span class="font25" style="font-weight:bold;">head</span><span class="font25">, the </span><span class="font25" style="font-weight:bold;">tail </span><span class="font25">command will display the last ten lines of a file.</span></h4>
<p><span class="font19">paul@debian7~$ </span><span class="font19" style="font-weight:bold;">tail /etc/services</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">vboxd</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">20012/udp</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">binkp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">24554/tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">#</span></p></td><td style="vertical-align:top;">
<p><span class="font19">binkp fidonet protocol</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">asp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">27374/tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">#</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Address Search Protocol</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">asp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">27374/udp</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">csync2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">30865/tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">#</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cluster synchronization tool</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">dircproxy</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">57000/tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">#</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Detachable IRC Proxy</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">tfido</span></p></td><td style="vertical-align:top;">
<p><span class="font19">60177/tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">#</span></p></td><td style="vertical-align:top;">
<p><span class="font19">fidonet EMSI over telnet</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">fido</span></p></td><td style="vertical-align:top;">
<p><span class="font19">60179/tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">#</span></p></td><td style="vertical-align:top;">
<p><span class="font19">fidonet EMSI over TCP</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<p><span class="font19"># Local services paul@debian7~$</span></p></li></ul>
<h4><a name="bookmark978"></a><span class="font25"><a name="bookmark979"></a>You can give </span><span class="font25" style="font-weight:bold;">tail </span><span class="font25">the number of lines you want to see.</span></h4>
<p><span class="font19">paul@debian7~$ </span><span class="font19" style="font-weight:bold;">tail -3 /etc/services</span></p>
<p><span class="font19">fido &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;60179/tcp &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# fidonet EMSI over TCP</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Local services</span></p></li></ul>
<p><span class="font19">paul@debian7~$</span></p>
<h4><a name="bookmark980"></a><span class="font25"><a name="bookmark981"></a>The </span><span class="font25" style="font-weight:bold;">tail </span><span class="font25">command has other useful options, some of which we will use during this course.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark982"></a><span class="font10" style="font-weight:bold;"><a name="bookmark84"></a><a name="bookmark983"></a>10.3. cat</span></h2></li></ul>
<p><a name="bookmark984"></a><span class="font25"><a name="bookmark985"></a><a name="bookmark986"></a>The </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">command is one of the most universal tools, yet all it does is copy </span><span class="font25" style="font-weight:bold;">standard input </span><span class="font25">to </span><span class="font25" style="font-weight:bold;">standard output</span><span class="font25">. In combination with the shell this can be very powerful and diverse. Some examples will give a glimpse into the possibilities. The first example is simple, you can use cat to display a file on the screen. If the file is longer than the screen, it will scroll to the end.</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">cat /etc/resolv.conf </span><span class="font19">domain linux-training.be search linux-training.be nameserver 192.168.1.42</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark987"></a><span class="font9" style="font-weight:bold;"><a name="bookmark988"></a>10.3.1. concatenate</span></h3></li></ul>
<p><span class="font25" style="font-weight:bold;">cat </span><span class="font25">is short for </span><span class="font25" style="font-weight:bold;">concatenate</span><span class="font25">. One of the basic uses of </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">is to concatenate files into a bigger (or complete) file.</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">echo one &gt;part1 </span><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">echo two &gt;part2 </span><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">echo three &gt;part3 </span><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">cat parti </span><span class="font19">one paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">cat part2 </span><span class="font19">two paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">cat part3 </span><span class="font19">three</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">cat parti part2 part3 </span><span class="font19">one two three</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">cat parti part2 part3 &gt;all </span><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">cat all </span><span class="font19">one two three</span></p>
<p><span class="font19">paul@debian8:~$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark989"></a><span class="font9" style="font-weight:bold;"><a name="bookmark990"></a>10.3.2. create files</span></h3></li></ul>
<p><span class="font25">You can use </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">to create flat text files. Type the </span><span class="font25" style="font-weight:bold;">cat &gt;&nbsp;winter.txt </span><span class="font25">command as shown in the screenshot below. Then type one or more lines, finishing each line with the enter key. After the last line, type and hold the Control (Ctrl) key and press d.</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">cat &gt;&nbsp;winter.txt </span><span class="font19">It is very cold today!</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">cat winter.txt </span><span class="font19">It is very cold today!</span></p>
<p><span class="font19">paul@debian8:~$</span></p>
<p><a name="bookmark991"></a><span class="font25"><a name="bookmark992"></a>The </span><span class="font25" style="font-weight:bold;">Ctrl d </span><span class="font25">key combination will send an </span><span class="font25" style="font-weight:bold;">EOF </span><span class="font25">(End of File) to the running process ending the </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">command.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark993"></a><span class="font9" style="font-weight:bold;"><a name="bookmark994"></a>10.3.3. custom end marker</span></h3></li></ul>
<h4><a name="bookmark995"></a><span class="font25"><a name="bookmark996"></a><a name="bookmark997"></a>You can choose an end marker for </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">with </span><span class="font25" style="font-weight:bold;">&lt;&lt;&nbsp;</span><span class="font25">as is shown in this screenshot. This construction is called a </span><span class="font25" style="font-weight:bold;">here directive </span><span class="font25">and will end the </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">command.</span></h4>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">cat &gt;&nbsp;hot.txt &lt;&lt;stop </span><span class="font19">&gt;&nbsp;It is hot today! &gt;&nbsp;Yes it is summer. &gt;&nbsp;stop paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">cat hot.txt </span><span class="font19">It is hot today! Yes it is summer.</span></p>
<p><span class="font19">paul@debian8:~$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark998"></a><span class="font9" style="font-weight:bold;"><a name="bookmark999"></a>10.3.4. copy files</span></h3></li></ul>
<h4><a name="bookmark1000"></a><span class="font25"><a name="bookmark1001"></a>In the third example you will see that cat can be used to copy files. We will explain in detail what happens here in the bash shell chapter.</span></h4>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">cat winter.txt </span><span class="font19">It is very cold today!</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">cat winter.txt &gt;&nbsp;cold.txt</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">cat cold.txt </span><span class="font19">It is very cold today! paul@debian8:~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1002"></a><span class="font10" style="font-weight:bold;"><a name="bookmark85"></a><a name="bookmark1003"></a>10.4. tac</span></h2></li></ul>
<h4><a name="bookmark1004"></a><span class="font25"><a name="bookmark1005"></a><a name="bookmark1006"></a>Just one example will show you the purpose of </span><span class="font25" style="font-weight:bold;">tac </span><span class="font25">(cat backwards).</span></h4>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">cat count </span><span class="font19">one two three four</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">tac count </span><span class="font19">four three two one</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1007"></a><span class="font10" style="font-weight:bold;"><a name="bookmark86"></a><a name="bookmark1008"></a>10.5. more and less</span></h2></li></ul>
<p><a name="bookmark1009"></a><span class="font25"><a name="bookmark1010"></a>The </span><span class="font25" style="font-weight:bold;">more </span><span class="font25">command is useful for displaying files that take up more than one screen. More will allow you to see the contents of the file page by page. Use the space bar to see the next page, or </span><span class="font25" style="font-weight:bold;">q </span><span class="font25">to quit. Some people prefer the </span><span class="font25" style="font-weight:bold;">less </span><span class="font25">command to </span><span class="font25" style="font-weight:bold;">more</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1011"></a><span class="font10" style="font-weight:bold;"><a name="bookmark87"></a><a name="bookmark1012"></a>10.6. strings</span></h2></li></ul>
<p><a name="bookmark1013"></a><span class="font25">With the </span><span class="font25" style="font-weight:bold;">strings </span><span class="font25">command you can display readable ascii strings found in (binary) files. This example locates the </span><span class="font25" style="font-weight:bold;">ls </span><span class="font25">binary then displays readable strings in the binary file (output is truncated).</span></p>
<p><span class="font19">paul@laika:~$ which ls</span></p>
<p><span class="font19">/bin/ls</span></p>
<p><span class="font19">paul@laika:~$ strings /bin/ls</span></p>
<p><span class="font19">/lib/ld-linux.so.2</span></p>
<p><span class="font19">librt.so.1</span></p>
<p><span class="font19">__gmon_start__</span></p>
<p><span class="font19">_Jv_RegisterClasses</span></p>
<p><span class="font19">clock_gettime</span></p>
<p><span class="font19">libacl.so.1</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1014"></a><span class="font10" style="font-weight:bold;"><a name="bookmark88"></a><a name="bookmark1015"></a>10.7. practice: file contents</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Display the first 12 lines of </span><span class="font25" style="font-weight:bold;">/etc/services</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">2. Display the last line of </span><span class="font25" style="font-weight:bold;">/etc/passwd</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">3. Use cat to create a file named </span><span class="font25" style="font-weight:bold;">count.txt </span><span class="font25">that looks like this:</span></p></li></ul>
<p><span class="font19">One Two Three Four Five</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Use </span><span class="font25" style="font-weight:bold;">cp </span><span class="font25">to make a backup of this file to </span><span class="font25" style="font-weight:bold;">cnt.txt</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">5. Use </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">to make a backup of this file to </span><span class="font25" style="font-weight:bold;">catcnt.txt</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">6. Display </span><span class="font25" style="font-weight:bold;">catcnt.txt</span><span class="font25">, but with all lines in reverse order (the last line first).</span></p></li>
<li>
<p><span class="font25">7. Use more to display </span><span class="font25" style="font-weight:bold;">/etc/services</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">8. Display the readable character strings from the </span><span class="font25" style="font-weight:bold;">/usr/bin/passwd </span><span class="font25">command.</span></p></li>
<li>
<p><span class="font25">9. Use </span><span class="font25" style="font-weight:bold;">ls </span><span class="font25">to find the biggest file in </span><span class="font25" style="font-weight:bold;">/etc</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">10. Open two terminal windows (or tabs) and make sure you are in the same directory in both. Type </span><span class="font25" style="font-weight:bold;">echo this is the first line &gt;&nbsp;tailing.txt </span><span class="font25">in the first terminal, then issue </span><span class="font25" style="font-weight:bold;">tail -f tailing.txt </span><span class="font25">in the second terminal. Now go back to the first terminal and type </span><span class="font25" style="font-weight:bold;">echo This is another line &gt;&gt;&nbsp;tailing.txt </span><span class="font25">(note the double &gt;&gt;), verify that the </span><span class="font25" style="font-weight:bold;">tail -f </span><span class="font25">in the second terminal shows both lines. Stop the </span><span class="font25" style="font-weight:bold;">tail -f </span><span class="font25">with </span><span class="font25" style="font-weight:bold;">Ctrl-C</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">11. Use </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">to create a file named </span><span class="font25" style="font-weight:bold;">tailing.txt </span><span class="font25">that contains the contents of </span><span class="font25" style="font-weight:bold;">tailing.txt </span><span class="font25">followed by the contents of </span><span class="font25" style="font-weight:bold;">/etc/passwd</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">12. Use </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">to create a file named </span><span class="font25" style="font-weight:bold;">tailing.txt </span><span class="font25">that contains the contents of </span><span class="font25" style="font-weight:bold;">tailing.txt </span><span class="font25">preceded by the contents of </span><span class="font25" style="font-weight:bold;">/etc/passwd</span><span class="font25">.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1016"></a><span class="font10" style="font-weight:bold;"><a name="bookmark89"></a><a name="bookmark1017"></a>10.8. solution: file contents</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Display the first 12 lines of </span><span class="font25" style="font-weight:bold;">/etc/services</span><span class="font25">.</span></p></li></ul>
<p><span class="font19">head -12 /etc/services</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Display the last line of </span><span class="font25" style="font-weight:bold;">/etc/passwd</span><span class="font25">.</span></p></li></ul>
<p><span class="font19">tail -1 /etc/passwd</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Use cat to create a file named </span><span class="font25" style="font-weight:bold;">count.txt </span><span class="font25">that looks like this:</span></p></li></ul>
<p><span class="font19">cat &gt;&nbsp;count.txt</span></p>
<p><span class="font19">One</span></p>
<p><span class="font19">Two</span></p>
<p><span class="font19">Three</span></p>
<p><span class="font19">Four</span></p>
<p><span class="font19">Five (followed by Ctrl-d)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Use </span><span class="font25" style="font-weight:bold;">cp </span><span class="font25">to make a backup of this file to </span><span class="font25" style="font-weight:bold;">cnt.txt</span><span class="font25">.</span></p></li></ul>
<p><span class="font19">cp count.txt cnt.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Use </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">to make a backup of this file to </span><span class="font25" style="font-weight:bold;">catcnt.txt</span><span class="font25">.</span></p></li></ul>
<p><span class="font19">cat count.txt &gt;&nbsp;catcnt.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Display </span><span class="font25" style="font-weight:bold;">catcnt.txt</span><span class="font25">, but with all lines in reverse order (the last line first).</span></p></li></ul>
<p><span class="font19">tac catcnt.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. Use more to display </span><span class="font25" style="font-weight:bold;">/etc/services</span><span class="font25">.</span></p></li></ul>
<p><span class="font19">more /etc/services</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. Display the readable character strings from the </span><span class="font25" style="font-weight:bold;">/usr/bin/passwd </span><span class="font25">command.</span></p></li></ul>
<p><span class="font19">strings /usr/bin/passwd</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">9. Use </span><span class="font25" style="font-weight:bold;">ls </span><span class="font25">to find the biggest file in </span><span class="font25" style="font-weight:bold;">/etc</span><span class="font25">.</span></p></li></ul>
<p><span class="font19">ls -lrS /etc</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">10. Open two terminal windows (or tabs) and make sure you are in the same directory in both. Type </span><span class="font25" style="font-weight:bold;">echo this is the first line &gt;&nbsp;tailing.txt </span><span class="font25">in the first terminal, then issue </span><span class="font25" style="font-weight:bold;">tail -f tailing.txt </span><span class="font25">in the second terminal. Now go back to the first terminal and type </span><span class="font25" style="font-weight:bold;">echo This is another line &gt;&gt;&nbsp;tailing.txt </span><span class="font25">(note the double &gt;&gt;), verify that the </span><span class="font25" style="font-weight:bold;">tail -f </span><span class="font25">in the second terminal shows both lines. Stop the </span><span class="font25" style="font-weight:bold;">tail -f </span><span class="font25">with </span><span class="font25" style="font-weight:bold;">Ctrl-C</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">11. Use </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">to create a file named </span><span class="font25" style="font-weight:bold;">tailing.txt </span><span class="font25">that contains the contents of </span><span class="font25" style="font-weight:bold;">tailing.txt </span><span class="font25">followed by the contents of </span><span class="font25" style="font-weight:bold;">/etc/passwd</span><span class="font25">.</span></p></li></ul>
<p><span class="font19">cat /etc/passwd &gt;&gt;&nbsp;tailing.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">12. Use </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">to create a file named </span><span class="font25" style="font-weight:bold;">tailing.txt </span><span class="font25">that contains the contents of </span><span class="font25" style="font-weight:bold;">tailing.txt </span><span class="font25">preceded by the contents of </span><span class="font25" style="font-weight:bold;">/etc/passwd</span><span class="font25">.</span></p></li></ul>
<p><span class="font19">mv tailing.txt tmp.txt ; cat /etc/passwd tmp.txt &gt;&nbsp;tailing.txt</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark1018"></a><span class="font11" style="font-weight:bold;"><a name="bookmark90"></a><a name="bookmark1019"></a>Chapter 11. the Linux file tree</span></h1></li></ul>
<p><span class="font25">This chapter takes a look at the most common directories in the </span><span class="font25" style="font-weight:bold;">Linux file tree</span><span class="font25">. It also shows that on Unix everything is a file.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1020"></a><span class="font10" style="font-weight:bold;"><a name="bookmark91"></a><a name="bookmark1021"></a>11.1. filesystem hierarchy standard</span></h2></li></ul>
<p><a name="bookmark1022"></a><span class="font25"><a name="bookmark1023"></a><a name="bookmark1024"></a>Many Linux distributions partially follow the </span><span class="font25" style="font-weight:bold;">Filesystem Hierarchy Standard</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">FHS </span><span class="font25">may help make more Unix/Linux file system trees conform better in the future. The </span><span class="font25" style="font-weight:bold;">FHS </span><span class="font25">is available online at </span><a href="http://www.pathname.com/fhs/"><span class="font25" style="font-weight:bold;">http://www.pathname.com/fhs/</span></a><span class="font25" style="font-weight:bold;"> </span><span class="font25">where we read: &quot;The filesystem hierarchy standard has been designed to be used by Unix distribution developers, package developers, and system implementers. However, it is primarily intended to be a reference and is not a tutorial on how to manage a Unix filesystem or directory hierarchy.&quot;</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1025"></a><span class="font10" style="font-weight:bold;"><a name="bookmark92"></a><a name="bookmark1026"></a>11.2. man hier</span></h2></li></ul>
<p><a name="bookmark1027"></a><span class="font25"><a name="bookmark1028"></a>There are some differences in the filesystems between </span><span class="font25" style="font-weight:bold;">Linux distributions</span><span class="font25">. For help about your machine, enter </span><span class="font25" style="font-weight:bold;">man hier </span><span class="font25">to find information about the file system hierarchy. This manual will explain the directory structure on your computer.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1029"></a><span class="font10" style="font-weight:bold;"><a name="bookmark93"></a><a name="bookmark1030"></a>11.3. the root directory /</span></h2></li></ul>
<p><a name="bookmark1031"></a><span class="font25"><a name="bookmark1032"></a>All Linux systems have a directory structure that starts at the </span><span class="font25" style="font-weight:bold;">root directory</span><span class="font25">. The root directory is represented by a </span><span class="font25" style="font-weight:bold;">forward slash</span><span class="font25">, like this: </span><span class="font25" style="font-weight:bold;">/</span><span class="font25">. Everything that exists on your Linux system can be found below this root directory. Let's take a brief look at the contents of the root directory.</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ ls /</span></p>
<p><span class="font19">bin &nbsp;&nbsp;dev &nbsp;home media &nbsp;mnt &nbsp;proc &nbsp;sbin &nbsp;&nbsp;&nbsp;&nbsp;srv &nbsp;tftpboot &nbsp;usr</span></p>
<p><span class="font19">boot &nbsp;etc &nbsp;lib misc &nbsp;&nbsp;opt &nbsp;root &nbsp;selinux &nbsp;sys &nbsp;tmp &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1033"></a><span class="font10" style="font-weight:bold;"><a name="bookmark94"></a><a name="bookmark1034"></a>11.4. binary directories</span></h2></li></ul>
<p><a name="bookmark1035"></a><span class="font25" style="font-weight:bold;">Binaries </span><span class="font25">are files that contain compiled source code (or machine code). Binaries can be </span><span class="font25" style="font-weight:bold;">executed </span><span class="font25">on the computer. Sometimes binaries are called </span><span class="font25" style="font-weight:bold;">executables</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1036"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1037"></a>11.4.1. /bin</span></h3></li></ul>
<p><a name="bookmark1038"></a><span class="font25"><a name="bookmark1039"></a><a name="bookmark1040"></a><a name="bookmark1041"></a>The </span><span class="font25" style="font-weight:bold;">/bin </span><span class="font25">directory contains </span><span class="font25" style="font-weight:bold;">binaries </span><span class="font25">for use by all users. According to the FHS the </span><span class="font25" style="font-weight:bold;">/bin </span><span class="font25">directory should contain </span><span class="font25" style="font-weight:bold;">/bin/cat </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/bin/date </span><span class="font25">(among others).</span></p>
<p><span class="font25">In the screenshot below you see common Unix/Linux commands like cat, cp, cpio, date, dd, echo, grep, and so on. Many of these will be covered in this book.</span></p>
<p><span class="font19">paul@laika:~$ ls /bin</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">archdetect</span></p></td><td style="vertical-align:top;">
<p><span class="font19">egrep</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mt</span></p></td><td style="vertical-align:top;">
<p><span class="font19">setupcon</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">autopartition</span></p></td><td style="vertical-align:top;">
<p><span class="font19">false</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mt-gnu</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sh</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">bash</span></p></td><td style="vertical-align:top;">
<p><span class="font19">fgconsole</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mv</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sh.distrib</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">bunzip2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">fgrep</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nano</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sleep</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">bzcat</span></p></td><td style="vertical-align:top;">
<p><span class="font19">fuser</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nc</span></p></td><td style="vertical-align:top;">
<p><span class="font19">stralign</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">bzcmp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">fusermount</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">nc.traditional</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">stty</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">bzdiff</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">get_mountoptions</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">netcat</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">su</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">bzegrep</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">grep</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">netstat</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sync</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">bzexe</span></p></td><td style="vertical-align:top;">
<p><span class="font19">gunzip</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ntfs-3g</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sysfs</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">bzfgrep</span></p></td><td style="vertical-align:top;">
<p><span class="font19">gzexe</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ntfs-3g.probe</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tailf</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">bzgrep</span></p></td><td style="vertical-align:top;">
<p><span class="font19">gzip</span></p></td><td style="vertical-align:top;">
<p><span class="font19">parted_devices</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tar</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">bzip2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">hostname</span></p></td><td style="vertical-align:top;">
<p><span class="font19">parted_server</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tempfile</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">bzip2recover</span></p></td><td style="vertical-align:top;">
<p><span class="font19">hw-detect</span></p></td><td style="vertical-align:top;">
<p><span class="font19">partman</span></p></td><td style="vertical-align:top;">
<p><span class="font19">touch</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">bzless</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ip</span></p></td><td style="vertical-align:top;">
<p><span class="font19">partman-commit</span></p></td><td style="vertical-align:top;">
<p><span class="font19">true</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">bzmore</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">kbd_mode</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">perform_recipe</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ulockmgr</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">cat</span></p></td><td style="vertical-align:top;">
<p><span class="font19">kill</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pidof</span></p></td><td style="vertical-align:top;">
<p><span class="font19">umount</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark741"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1042"></a>11.4.2. other /bin directories</span></h3></li></ul>
<p><span class="font25">You can find a </span><span class="font25" style="font-weight:bold;">/bin subdirectory </span><span class="font25">in many other directories. A user named </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">could put her own programs in </span><span class="font25" style="font-weight:bold;">/home/serena/bin</span><span class="font25">.</span></p>
<p><span class="font25">Some applications, often when installed directly from source will put themselves in </span><span class="font25" style="font-weight:bold;">/opt</span><span class="font25">. A </span><span class="font25" style="font-weight:bold;">samba server </span><span class="font25">installation can use </span><span class="font25" style="font-weight:bold;">/opt/samba/bin </span><span class="font25">to store its binaries.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1043"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1044"></a>11.4.3. /sbin</span></h3></li></ul>
<p><a name="bookmark1045"></a><span class="font25" style="font-weight:bold;"><a name="bookmark1046"></a>/sbin </span><span class="font25">contains binaries to configure the operating system. Many of the </span><span class="font25" style="font-weight:bold;">system binaries </span><span class="font25">require </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">privilege to perform certain tasks.</span></p>
<p><span class="font25">Below a screenshot containing </span><span class="font25" style="font-weight:bold;">system binaries </span><span class="font25">to change the ip address, partition a disk and create an ext4 file system.</span></p>
<p><span class="font19">paul@ubu1010:~$ ls -l /sbin/ifconfig /sbin/fdisk /sbin/mkfs.ext4</span></p>
<p><span class="font19">-rwxr-xr-x 1 root root 97172 2011-02-02 09:56 /sbin/fdisk</span></p>
<p><span class="font19">-rwxr-xr-x 1 root root 65708 2010-07-02 09:27 /sbin/ifconfig</span></p>
<p><span class="font19">-rwxr-xr-x 5 root root 55140 2010-08-18 18:01 /sbin/mkfs.ext4</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1047"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1048"></a>11.4.4. /lib</span></h3></li></ul>
<p><a name="bookmark1049"></a><span class="font25">Binaries found in </span><span class="font25" style="font-weight:bold;">/bin </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/sbin </span><span class="font25">often use </span><span class="font25" style="font-weight:bold;">shared libraries </span><span class="font25">located in </span><span class="font25" style="font-weight:bold;">/lib</span><span class="font25">. Below is a screenshot of the partial contents of </span><span class="font25" style="font-weight:bold;">/lib</span><span class="font25">.</span></p>
<p><span class="font19">paul@laika:~$ ls /lib/libc*</span></p>
<p><span class="font19">/lib/libc-2.5.so &nbsp;&nbsp;&nbsp;&nbsp;/lib/libcfont.so.0.0.0 &nbsp;/lib/libcom_err.so.2.1</span></p>
<p><span class="font19">/lib/libcap.so.1 &nbsp;&nbsp;&nbsp;&nbsp;/lib/libcidn-2.5.so &nbsp;&nbsp;&nbsp;&nbsp;/lib/libconsole.so.0</span></p>
<p><span class="font19">/lib/libcap.so.1.10 &nbsp;/lib/libcidn.so.1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/lib/libconsole.so.0.0.0</span></p>
<p><span class="font19">/lib/libcfont.so.0 &nbsp;&nbsp;/lib/libcom_err.so.2 &nbsp;&nbsp;&nbsp;/lib/libcrypt-2.5.so</span></p>
<p><span class="font7" style="font-weight:bold;">/lib/modules</span></p>
<p><a name="bookmark1050"></a><span class="font25"><a name="bookmark1051"></a>Typically, the </span><span class="font25" style="font-weight:bold;">Linux kernel </span><span class="font25">loads kernel modules from </span><span class="font25" style="font-weight:bold;">/lib/modules/$kernel-version/</span><span class="font25">. This directory is discussed in detail in the Linux kernel chapter.</span></p>
<p><span class="font7" style="font-weight:bold;">/lib32 and /lib64</span></p>
<p><a name="bookmark1052"></a><span class="font25"><a name="bookmark1053"></a><a name="bookmark1054"></a>We currently are in a transition between </span><span class="font25" style="font-weight:bold;">32-bit </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">64-bit </span><span class="font25">systems. Therefore, you may encounter directories named </span><span class="font25" style="font-weight:bold;">/lib32 </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/lib64 </span><span class="font25">which clarify the register size used during compilation time of the libraries. A 64-bit computer may have some 32-bit binaries and libraries for compatibility with legacy applications. This screenshot uses the </span><span class="font25" style="font-weight:bold;">file </span><span class="font25">utility to demonstrate the difference.</span></p>
<p><span class="font19">paul@laika:~$ file /lib32/libc-2.5.so /lib32/libc-2.5.so: ELF 32-bit LSB shared object, Intel 80386, \ version 1 (SYSV), for GNU/Linux 2.6.0, stripped</span></p>
<p><span class="font19">paul@laika:~$ file /lib64/libcap.so.1.10</span></p>
<p><span class="font19">/lib64/libcap.so.1.10: ELF 64-bit LSB shared object, AMD x86-64, \ version 1 (SYSV), stripped</span></p>
<p><a name="bookmark1055"></a><span class="font25"><a name="bookmark1056"></a>The ELF </span><span class="font25" style="font-weight:bold;">(Executable and Linkable Format) </span><span class="font25">is used in almost every Unix-like operating system since </span><span class="font25" style="font-weight:bold;">System V</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1057"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1058"></a>11.4.5. /opt</span></h3></li></ul>
<p><span class="font25">The purpose of </span><span class="font25" style="font-weight:bold;">/opt </span><span class="font25">is to store </span><span class="font25" style="font-weight:bold;">optional </span><span class="font25">software. In man<a name="bookmark1059"></a>y cases this is software from outside the distribution repository. You may find an empty </span><span class="font25" style="font-weight:bold;">/opt </span><span class="font25">directory on many systems.</span></p>
<p><span class="font25">A large package can install all its files in </span><span class="font25" style="font-weight:bold;">/bin</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">/lib</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">/etc </span><span class="font25">subdirectories within </span><span class="font25" style="font-weight:bold;">/opt/ $packagename/</span><span class="font25">. If for example the package is called wp, then it installs in </span><span class="font25" style="font-weight:bold;">/opt/wp</span><span class="font25">, putting binaries in </span><span class="font25" style="font-weight:bold;">/opt/wp/bin </span><span class="font25">and manpages in </span><span class="font25" style="font-weight:bold;">/opt/wp/man</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1060"></a><span class="font10" style="font-weight:bold;"><a name="bookmark95"></a><a name="bookmark1061"></a>11.5. configuration directories</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark1062"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1063"></a>11.5.1. /boot</span></h3></li></ul></li></ul>
<p><a name="bookmark1064"></a><span class="font25"><a name="bookmark1065"></a><a name="bookmark1066"></a>The </span><span class="font25" style="font-weight:bold;">/boot </span><span class="font25">directory contains all files needed to boot the computer. These files don't change very often. On Linux systems<a name="bookmark1067"></a> you typically find the </span><span class="font25" style="font-weight:bold;">/boot/grub </span><span class="font25">directory here. </span><span class="font25" style="font-weight:bold;">/boot/grub </span><span class="font25">contains </span><span class="font25" style="font-weight:bold;">/boot/grub/grub.cfg </span><span class="font25">(older systems may still have </span><span class="font25" style="font-weight:bold;">/boot/grub/grub.conf</span><span class="font25">) which defines the boot menu that is displayed before the kernel starts.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1068"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1069"></a>11.5.2. /etc</span></h3></li></ul>
<p><a name="bookmark1070"></a><span class="font25">All of the machine-specific </span><span class="font25" style="font-weight:bold;">configuration files </span><span class="font25">should be located in </span><span class="font25" style="font-weight:bold;">/etc</span><span class="font25">. Historically </span><span class="font25" style="font-weight:bold;">/etc </span><span class="font25">stood for </span><span class="font25" style="font-weight:bold;">etcetera</span><span class="font25">, today people often use the </span><span class="font25" style="font-weight:bold;">Editable Text Configuration </span><span class="font25">backronym.</span></p>
<p><span class="font25">Many times the name of a configuration files is the same as the application, daemon, or protocol with </span><span class="font25" style="font-weight:bold;">.conf </span><span class="font25">added as the extension.</span></p>
<div>
<p><span class="font19">paul@laika:~$ ls /etc/*.conf</span></p>
<p><span class="font19">/etc/adduser.conf &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/etc/ld.so.conf</span></p>
<p><span class="font19">/etc/brltty.conf &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/etc/l</span><a href="ftp://ftp.conf"><span class="font19">ftp.conf</span></a></p>
<p><span class="font19">/etc/ccertificates.conf /etc/libao.conf</span></p>
</div><br clear="all">
<div>
<p><span class="font19">/etc/cvs-cron.conf /etc/ddclient.conf /etc/debconf.conf /etc/deluser.conf /etc/fdmount.conf /etc/hdparm.conf /etc/host.conf /etc/inetd.conf /etc/kernel-img.conf paul@laika:~$</span></p>
</div><br clear="all">
<div>
<p><span class="font19">/etc/logrotate.conf /etc/ltrace.conf /etc/mke2fs.conf /etc/netscsid.conf /etc/nsswitch.conf /etc/pam.conf /etc/pnm2ppa.conf /etc/povray.conf</span></p>
<p><span class="font19">/etc/resolv.conf</span></p>
</div><br clear="all">
<div>
<p><span class="font19">/etc/scrollkeeper.conf /etc/sysctl.conf /etc/syslog.conf</span></p>
<p><span class="font19">/etc/ucf.conf</span></p>
<p><span class="font19">/etc/uniconf.conf /etc/updatedb.conf /etc/usplash.conf /etc/uswsusp.conf /etc/vnc.conf /etc/wodim.conf</span></p>
<p><span class="font19">/etc/wvdial.conf</span></p>
</div><br clear="all">
<p><span class="font25">There is much more to be found in </span><span class="font25" style="font-weight:bold;">/etc</span><span class="font25">.</span></p>
<p><span class="font7" style="font-weight:bold;">/etc/init.d/</span></p>
<p><a name="bookmark1071"></a><span class="font25">A lot of Unix/Linux distributions have an </span><span class="font25" style="font-weight:bold;">/etc/init.d </span><span class="font25">directory that contains scripts to start and stop </span><span class="font25" style="font-weight:bold;">daemons</span><span class="font25">. This directory could disappear as Linux migrates to systems that replace the old </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">way of starting all </span><span class="font25" style="font-weight:bold;">daemons</span><span class="font25">.</span></p>
<p><span class="font7" style="font-weight:bold;">/etc/X11/</span></p>
<p><a name="bookmark1072"></a><span class="font25"><a name="bookmark1073"></a><a name="bookmark1074"></a>The graphical display (aka </span><span class="font25" style="font-weight:bold;">X Window System </span><span class="font25">or just </span><span class="font25" style="font-weight:bold;">X</span><span class="font25">) is driven by software from the X.org foundation. The configuration file for your graphical display is </span><span class="font25" style="font-weight:bold;">/etc/X11/xorg.conf</span><span class="font25">.</span></p>
<p><span class="font7" style="font-weight:bold;">/etc/skel/</span></p>
<p><a name="bookmark1075"></a><span class="font25"><a name="bookmark1076"></a>The </span><span class="font25" style="font-weight:bold;">skeleton </span><span class="font25">directory </span><span class="font25" style="font-weight:bold;">/etc/skel </span><span class="font25">is copied to the home directory of a newly created user. It usually contains hidden files like a </span><span class="font25" style="font-weight:bold;">.bashrc </span><span class="font25">script.</span></p>
<p><span class="font7" style="font-weight:bold;">/etc/sysconfig/</span></p>
<p><a name="bookmark1077"></a><span class="font25">This directory, which is not mentioned in the FHS, contains a lot of </span><span class="font25" style="font-weight:bold;">Red Hat Enterprise Linux </span><span class="font25">configuration files. We will discuss some of them in greater detail. The screenshot below is the </span><span class="font25" style="font-weight:bold;">/etc/sysconfig </span><span class="font25">directory from RHELv4u4 with everything installed.</span></p>
<p><span class="font19">paul@RHELv4u4:~$ ls /etc/sysconfig/</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">apmd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">firstboot</span></p></td><td style="vertical-align:top;">
<p><span class="font19">irda</span></p></td><td style="vertical-align:top;">
<p><span class="font19">network</span></p></td><td style="vertical-align:top;">
<p><span class="font19">saslauthd</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">apm-scripts</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">grub</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">irqbalance</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">networking</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">selinux</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">authconfig</span></p></td><td style="vertical-align:top;">
<p><span class="font19">hidd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">keyboard</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ntpd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">spamassassin</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">autofs</span></p></td><td style="vertical-align:top;">
<p><span class="font19">httpd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">kudzu</span></p></td><td style="vertical-align:top;">
<p><span class="font19">openib.conf</span></p></td><td style="vertical-align:top;">
<p><span class="font19">squid</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">bluetooth</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">hwconf</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">lm_sensors</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pand</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">syslog</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">clock</span></p></td><td style="vertical-align:top;">
<p><span class="font19">i18n</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mouse</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pcmcia</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sys-config-sec</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">console</span></p></td><td style="vertical-align:top;">
<p><span class="font19">init</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mouse.B</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pgsql</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sys-config-users</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">crond</span></p></td><td style="vertical-align:top;">
<p><span class="font19">installinfo</span></p></td><td style="vertical-align:top;">
<p><span class="font19">named</span></p></td><td style="vertical-align:top;">
<p><span class="font19">prelink</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sys-logviewer</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">desktop</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ipmi</span></p></td><td style="vertical-align:top;">
<p><span class="font19">netdump</span></p></td><td style="vertical-align:top;">
<p><span class="font19">rawdevices</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tux</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">diskdump</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">iptables</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">netdump_id_dsa</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">rhn</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">vncservers</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">dund</span></p></td><td style="vertical-align:top;">
<p><span class="font19">iptables-cfg</span></p></td><td style="vertical-align:top;">
<p><span class="font19">netdump_id_dsa.p</span></p></td><td style="vertical-align:top;">
<p><span class="font19">samba</span></p></td><td style="vertical-align:top;">
<p><span class="font19">xinetd</span></p></td></tr>
</table>
<p><span class="font19">paul@RHELv4u4:~$</span></p>
<p><a name="bookmark1078"></a><span class="font25"><a name="bookmark1079"></a>The file </span><span class="font25" style="font-weight:bold;">/etc/sysconfig/firstboot </span><span class="font25">tells the Red Hat Setup Agent not to run at boot time. If you want to run the Red Hat Setup Agent at the next reboot, then simply remove this file, and run </span><span class="font25" style="font-weight:bold;">chkconfig --level 5 firstboot on</span><span class="font25">. The Red Hat Setup Agent allows you to install the latest updates, create a user account, join the Red Hat Network and more. It will then create the /etc/sysconfig/firstboot file again.</span></p>
<p><span class="font19">paul@RHELv4u4:~$ cat /etc/sysconfig/firstboot RUN FIRSTBOOT=NO</span></p>
<p><a name="bookmark1080"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">/etc/sysconfig/harddisks </span><span class="font25">file contains some parameters to tune the hard disks. The file explains itself.</span></p>
<p><a name="bookmark1081"></a><span class="font25"><a name="bookmark1082"></a>You can see hardware detected by </span><span class="font25" style="font-weight:bold;">kudzu </span><span class="font25">in </span><span class="font25" style="font-weight:bold;">/etc/sysconfig/hwconf</span><span class="font25">. Kudzu is software from Red Hat for automatic discovery and configuration of hardware.</span></p>
<p><a name="bookmark1083"></a><span class="font25"><a name="bookmark1084"></a><a name="bookmark1085"></a><a name="bookmark1086"></a>The keyboard type and keymap table are set in the </span><span class="font25" style="font-weight:bold;">/etc/sysconfig/keyboard </span><span class="font25">file. For more console ke<a name="bookmark1087"></a>yboard information, check the manual pages of </span><span class="font25" style="font-weight:bold;">keymaps(5)</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">dumpkeys(1)</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">loadkeys(1) </span><span class="font25">and the directory </span><span class="font25" style="font-weight:bold;">/lib/kbd/keymaps/</span><span class="font25">.</span></p>
<p><span class="font19">root@RHELv4u4:/etc/sysconfig# cat keyboard</span></p>
<p><span class="font19">KEYBOARDTYPE=&quot;pc&quot;</span></p>
<p><span class="font19">KEYTABLE=&quot;us&quot;</span></p>
<p><span class="font25">We will discuss networking files in this directory in the networking chapter.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1088"></a><span class="font10" style="font-weight:bold;"><a name="bookmark96"></a><a name="bookmark1089"></a>11.6. data directories</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark1090"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1091"></a>11.6.1. /home</span></h3></li></ul></li></ul>
<p><a name="bookmark1092"></a><span class="font25">Users can store personal or project data under </span><span class="font25" style="font-weight:bold;">/home</span><span class="font25">. It is common (but not mandatory by the fhs) practice to name the users home directory after the user name in the format </span><span class="font25" style="font-weight:bold;">/home/ $USERNAME</span><span class="font25">. For example:</span></p>
<p><span class="font19">paul@ubu606:~$ ls /home</span></p>
<p><span class="font19">geert annik sandra paul tom</span></p>
<p><span class="font25">Besides giving every user (or every project or group) a location to store personal files, the home directory of a user also serves as a location to store the user profile. A typical Unix user profile contains many hidden files (files whose file name starts with a dot). The hidden files of the Unix user profiles contain settings specific for that user.</span></p>
<p><span class="font19">paul@ubu606:~$ ls -d /home/paul/.*</span></p>
<p><span class="font19">/home/paul/. &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/home/paul/.bash_profile /home/paul/.ssh</span></p>
<p><span class="font19">/home/paul/.. &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/home/paul/.bashrc &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/home/paul/.viminfo</span></p>
<p><span class="font19">/home/paul/.bash_history /home/paul/.lesshst</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1093"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1094"></a>11.6.2. /root</span></h3></li></ul>
<p><a name="bookmark1095"></a><span class="font25">On many systems </span><span class="font25" style="font-weight:bold;">/root </span><span class="font25">is the default location for personal data and profile of the </span><span class="font25" style="font-weight:bold;">root user</span><span class="font25">. If it does not exist by default, then some administrators create it.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1096"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1097"></a>11.6.3. /srv</span></h3></li></ul>
<p><a name="bookmark1098"></a><span class="font25">You may use </span><span class="font25" style="font-weight:bold;">/srv </span><span class="font25">for data that is </span><span class="font25" style="font-weight:bold;">served by your system</span><span class="font25">. The FHS allows locating cvs, rsync, ftp and www data in this location. The FHS also approves administrative naming in / srv, like /srv/project55/ftp and /srv/sales/www.</span></p>
<p><a name="bookmark1099"></a><span class="font25">On Sun Solaris (or Oracle Solaris) </span><span class="font25" style="font-weight:bold;">/export </span><span class="font25">is used for this purpose.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1100"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1101"></a>11.6.4. /media</span></h3></li></ul>
<p><a name="bookmark1102"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">/media </span><span class="font25">directory serves as a mount point for </span><span class="font25" style="font-weight:bold;">removable media devices </span><span class="font25">such as CD-ROM's, digital cameras, and various usb-attached devices. Since </span><span class="font25" style="font-weight:bold;">/media </span><span class="font25">is rather new in the Unix world, you could very well encounter systems running without this directory. Solaris 9 does not have it, Solaris 10 does. Most Linux distributions today mount all removable media in </span><span class="font25" style="font-weight:bold;">/media</span><span class="font25">.</span></p>
<p><span class="font19">paul@debian5:~$ ls /media/ cdrom cdromO usbdisk</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1103"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1104"></a>11.6.5. /mnt</span></h3></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">/mnt </span><span class="font25">directory should be empty and should only be used for temporary mount points (according to the FHS).</span></p>
<p><span class="font25">Unix and Linux administrators used to create many directories here, like /mnt/something/. You likely will encounter many systems with more than one directory created and/or mounted inside </span><span class="font25" style="font-weight:bold;">/mnt </span><span class="font25">to be used for various local and remote filesystems.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1105"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1106"></a>11.6.6. /tmp</span></h3></li></ul>
<p><a name="bookmark1107"></a><span class="font25">Applications and users should use </span><span class="font25" style="font-weight:bold;">/tmp </span><span class="font25">to store temporary data when needed. Data stored in </span><span class="font25" style="font-weight:bold;">/tmp </span><span class="font25">may use either disk space or RAM. Both of which are managed by the operating system. Never use </span><span class="font25" style="font-weight:bold;">/tmp </span><span class="font25">to store data that is important or which you wish to archive.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1108"></a><span class="font10" style="font-weight:bold;"><a name="bookmark97"></a><a name="bookmark1109"></a>11.7. in memory directories</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark1110"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1111"></a>11.7.1. /dev</span></h3></li></ul></li></ul>
<p><a name="bookmark1112"></a><span class="font25">Device files in </span><span class="font25" style="font-weight:bold;">/dev </span><span class="font25">appear to be ordinary files, but are not actually located on the hard disk. The </span><span class="font25" style="font-weight:bold;">/dev </span><span class="font25">directory is populated with files as the kernel is recognising hardware.</span></p>
<p><span class="font7" style="font-weight:bold;">common physical devices</span></p>
<p><span class="font25">Common hardware such as hard disk devices are represented by device files in </span><span class="font25" style="font-weight:bold;">/dev</span><span class="font25">. Below a screenshot of SATA device files on a laptop and then IDE attached drives on a desktop. (The detailed meaning of these devices will be discussed later.)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">#</span></p></li>
<li>
<p><span class="font19"># SATA or SCSI or USB #</span></p></li></ul>
<p><span class="font19">paul@laika:~$ ls /dev/sd* /dev/sda /dev/sdal /dev/sda2 /dev/sda3 /dev/sdb /dev/sdbl /dev/sdb2</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">#</span></p></li>
<li>
<p><span class="font19"># IDE or ATAPI #</span></p></li></ul>
<p><span class="font19">paul@barry:~$ ls /dev/hd*</span></p>
<p><span class="font19">/dev/hda /dev/hda1 /dev/hda2 /dev/hdb /dev/hdb1 /dev/hdb2 /dev/hdc</span></p>
<p><span class="font25">Besides representing physical hardware, some device files are special. These special devices can be very useful.</span></p>
<p><span class="font7" style="font-weight:bold;">/dev/tty and /dev/pts</span></p>
<p><a name="bookmark1113"></a><span class="font25"><a name="bookmark1114"></a>For example, </span><span class="font25" style="font-weight:bold;">/dev/tty1 </span><span class="font25">represents a terminal or console attached to the system. (Don't break your head on the exact terminology of 'terminal' or 'console', what we mean here is a command line interface.) When typing commands in a terminal that is part of a graphical interface like Gnome or KDE, then your terminal will be represented as </span><span class="font25" style="font-weight:bold;">/dev/pts/1 </span><span class="font25">(1 can be another number).</span></p>
<p><span class="font7" style="font-weight:bold;">/dev/null</span></p>
<p><a name="bookmark1115"></a><span class="font25">On Linux you will find other special devices such as </span><span class="font25" style="font-weight:bold;">/dev/null </span><span class="font25">which can be considered a black hole; it has unlimited storage, but nothing can be retrieved from it. Technically speaking, anything written to /dev/null will be discarded. /dev/null can be useful to discard unwanted output from commands. </span><span class="font25" style="font-style:italic;">/dev/null is not a good location to store your backups ;-)</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1116"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1117"></a>11.7.2. /proc conversation with the kernel</span></h3></li></ul>
<p><a name="bookmark1118"></a><span class="font25" style="font-weight:bold;">/proc </span><span class="font25">is another special directory, appearing to be ordinary files, but not taking up disk space. It is actually a view of the kernel, or better, what the kernel manages, and is a means to interact with it directly. </span><span class="font25" style="font-weight:bold;">/proc </span><span class="font25">is a proc filesystem.</span></p>
<p><span class="font19">paul@RHELv4u4:~$ mount -t proc</span></p>
<p><span class="font19">none on /proc type proc (rw)</span></p>
<h4><a name="bookmark1119"></a><span class="font25"><a name="bookmark1120"></a>When listing the /proc directory you will see many numbers (on any Unix) and some interesting files (on Linux)</span></h4>
<p><span class="font19">mul@laika:~$ ls /proc</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2339</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4724</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5418</span></p></td><td style="vertical-align:top;">
<p><span class="font19">6587</span></p></td><td style="vertical-align:top;">
<p><span class="font19">7201</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cmdline</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mounts</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">10175</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2523</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4729</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5421</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6596</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7204</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">cpuinfo</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">mtrr</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">10211</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2783</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4741</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5658</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6599</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7206</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">crypto</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">net</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">10239</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2975</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4873</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5661</span></p></td><td style="vertical-align:top;">
<p><span class="font19">6638</span></p></td><td style="vertical-align:top;">
<p><span class="font19">7214</span></p></td><td style="vertical-align:top;">
<p><span class="font19">devices</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pagetypeinfo</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">141</span></p></td><td style="vertical-align:top;">
<p><span class="font19">29775</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4874</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5665</span></p></td><td style="vertical-align:top;">
<p><span class="font19">6652</span></p></td><td style="vertical-align:top;">
<p><span class="font19">7216</span></p></td><td style="vertical-align:top;">
<p><span class="font19">diskstats</span></p></td><td style="vertical-align:top;">
<p><span class="font19">partitions</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">15045</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">29792</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4878</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5927</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6719</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7218</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">dma</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sched_debug</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">1519</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2997</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4879</span></p></td><td style="vertical-align:top;">
<p><span class="font19">6</span></p></td><td style="vertical-align:top;">
<p><span class="font19">6736</span></p></td><td style="vertical-align:top;">
<p><span class="font19">7223</span></p></td><td style="vertical-align:top;">
<p><span class="font19">driver</span></p></td><td style="vertical-align:top;">
<p><span class="font19">scsi</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1548</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4881</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6032</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6737</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7224</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">execdomains</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">self</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1551</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">30228</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4882</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6033</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6755</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7227</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">fb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">slabinfo</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1554</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3069</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6145</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6762</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7260</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">filesystems</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">stat</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1557</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">31422</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5073</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6298</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6774</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7267</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">fs</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">swaps</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1606</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3149</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5147</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6414</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6816</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7275</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ide</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sys</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">180</span></p></td><td style="vertical-align:top;">
<p><span class="font19">31507</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5203</span></p></td><td style="vertical-align:top;">
<p><span class="font19">6418</span></p></td><td style="vertical-align:top;">
<p><span class="font19">6991</span></p></td><td style="vertical-align:top;">
<p><span class="font19">7282</span></p></td><td style="vertical-align:top;">
<p><span class="font19">interrupts</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sysrq-trigger</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">181</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3189</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5206</span></p></td><td style="vertical-align:top;">
<p><span class="font19">6419</span></p></td><td style="vertical-align:top;">
<p><span class="font19">6993</span></p></td><td style="vertical-align:top;">
<p><span class="font19">7298</span></p></td><td style="vertical-align:top;">
<p><span class="font19">iomem</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sysvipc</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">182</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3193</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5228</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6420</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6996</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7319</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ioports</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">timer_list</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">18898</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3246</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5272</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6421</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7157</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7330</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">irq</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">timer_stats</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">19799</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3248</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5291</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6422</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7163</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7345</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">kallsyms</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tty</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">19803</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3253</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5294</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6423</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7164</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7513</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">kcore</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">uptime</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">19804</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3372</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5356</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6424</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7171</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7525</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">key-users</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">version</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1987</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5370</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6425</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7175</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7529</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">kmsg</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">version_signature</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1989</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">42</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5379</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6426</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7188</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">9964</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">loadavg</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">vmcore</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">45</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5380</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6430</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7189</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">acpi</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">locks</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">vmnet</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">20845</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4542</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5412</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6450</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7191</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">asound</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">meminfo</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">vmstat</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">221</span></p></td><td style="vertical-align:top;">
<p><span class="font19">46</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5414</span></p></td><td style="vertical-align:top;">
<p><span class="font19">6551</span></p></td><td style="vertical-align:top;">
<p><span class="font19">7192</span></p></td><td style="vertical-align:top;">
<p><span class="font19">buddyinfo</span></p></td><td style="vertical-align:top;">
<p><span class="font19">misc</span></p></td><td style="vertical-align:top;">
<p><span class="font19">zoneinfo</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">2338</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4704</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5416</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6568</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7199</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">bus</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">modules</span></p></td><td style="vertical-align:top;"></td></tr>
</table>
<h4><a name="bookmark1121"></a><span class="font25"><a name="bookmark1122"></a>Let's investigate the file properties inside </span><span class="font25" style="font-weight:bold;">/proc</span><span class="font25">. Looking at the date and time will display the current date and time showing the files are constantly updated (a view on the kernel).</span></h4>
<p><span class="font19">paul@RHELv4u4:~$ date</span></p>
<p><span class="font19">Mon Jan 29 18:06:32 EST 2007</span></p>
<p><span class="font19">paul@RHELv4u4:~$ ls -al /proc/cpuinfo</span></p>
<p><span class="font19">-r--r--r-- &nbsp;1 root root 0 Jan 29 18:06 /proc/cpuinfo</span></p>
<p><span class="font19">paul@RHELv4u4:~$</span></p>
<p><span class="font19">paul@RHELv4u4:~$ ...time passes...</span></p>
<p><span class="font19">paul@RHELv4u4:~$</span></p>
<p><span class="font19">paul@RHELv4u4:~$ date</span></p>
<p><span class="font19">Mon Jan 29 18:10:00 EST 2007</span></p>
<p><span class="font19">paul@RHELv4u4:~$ ls -al /proc/cpuinfo</span></p>
<p><span class="font19">-r--r--r-- &nbsp;1 root root 0 Jan 29 18:10 /proc/cpuinfo</span></p>
<h4><a name="bookmark1123"></a><span class="font25"><a name="bookmark1124"></a><a name="bookmark1125"></a>Most files in /proc are 0 bytes, yet they contain data--sometimes a lot of data. You can see this by executing cat on files like </span><span class="font25" style="font-weight:bold;">/proc/cpuinfo</span><span class="font25">, which contains information about the CPU.</span></h4>
<p><span class="font19">paul@RHELv4u4:~$ file /proc/cpuinfo /proc/cpuinfo: empty paul@RHELv4u4:~$ cat /proc/cpuinfo processor &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: 0</span></p>
<p><span class="font19">vendor_id &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: AuthenticAMD</span></p>
<p><span class="font19">cpu family &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: 15</span></p>
<p><span class="font19">model &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: 43</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">model name</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">AMD Athlon(tm) 64 X2 Dual Core Processor 4600+</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">stepping</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">cpu MHz</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2398.628</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">cache size</span></p></td><td style="vertical-align:top;">
<p><span class="font19">512 KB</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">fdiv_bug</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">no</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">hlt_bug</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">no</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">f00f_bug</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">no</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">coma_bug</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">no</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">fpu</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">yes</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">fpu_exception</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">yes</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">cpuid level</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">wp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">yes</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">flags</span></p></td><td style="vertical-align:top;">
<p><span class="font19">fpu vme de pse tsc msr pae mce cx8 apic mtrr pge...</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">bogomips</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4803.54</span></p></td></tr>
</table>
<p><span class="font25" style="font-style:italic;">Just for fun, here is /proc/cpuinfo on a Sun Sunblade 1000...</span></p>
<p><span class="font19">paul@pasha:~$ cat /proc/cpuinfo cpu : TI UltraSparc III (Cheetah) fpu : UltraSparc III integrated FPU promlib : Version 3 Revision 2 prom : 4.2.2 type : sun4u ncpus probed : 2 ncpus active : 2 Cpu0Bogo : 498.68 Cpu0ClkTck : 000000002cb41780 Cpu1Bogo : 498.68 Cpu1ClkTck : 000000002cb41780 MMU Type : Cheetah State: CPU0: online CPU1: online</span></p>
<h4><a name="bookmark1126"></a><span class="font25"><a name="bookmark1127"></a><a name="bookmark1128"></a>Most of the files in /proc are read only, some require root privileges, some files are writable, and many files in </span><span class="font25" style="font-weight:bold;">/proc/sys </span><span class="font25">are writable. Let's discuss some of the files in /proc.</span></h4>
<p><span class="font7" style="font-weight:bold;">/proc/interrupts</span></p>
<h4><a name="bookmark1129"></a><span class="font25"><a name="bookmark1130"></a><a name="bookmark1131"></a>On the x86 architecture, </span><span class="font25" style="font-weight:bold;">/proc/interrupts </span><span class="font25">displays the interrupts.</span></h4>
<p><span class="font19">paul@RHELv4u4:~$ cat /proc/interrupts</span></p>
<table border="1">
<tr><td colspan="4" style="vertical-align:bottom;">
<p><span class="font19">CPU0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">13876877</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IO-APIC-edge</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">timer</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">1:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">15</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IO-APIC-edge</span></p></td><td style="vertical-align:top;">
<p><span class="font19">i8042</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">8:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IO-APIC-edge</span></p></td><td style="vertical-align:top;">
<p><span class="font19">rtc</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">9:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IO-APIC-level</span></p></td><td style="vertical-align:top;">
<p><span class="font19">acpi</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">12:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">67</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IO-APIC-edge</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">i8042</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">14:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">128</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IO-APIC-edge</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ide0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">15:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">124320</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IO-APIC-edge</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ide1</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">169:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">111993</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IO-APIC-level</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ioc0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">177:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2428</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IO-APIC-level</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">eth0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">NMI:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">LOC:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">13878037</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">ERR:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">MIS:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
</table>
<h4><a name="bookmark1132"></a><span class="font25"><a name="bookmark1133"></a>On a machine with two CPU's, the file looks like this.</span></h4>
<table border="1">
<tr><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">paul@laika:~$ cat</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">/proc/interrupts</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">CPU0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">CPU1</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">0:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">860013</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IO-APIC-edge</span></p></td><td style="vertical-align:top;">
<p><span class="font19">timer</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">1:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4533</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IO-APIC-edge</span></p></td><td style="vertical-align:top;">
<p><span class="font19">i8042</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">7:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IO-APIC-edge</span></p></td><td style="vertical-align:top;">
<p><span class="font19">parport0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">8:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">6588227</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IO-APIC-edge</span></p></td><td style="vertical-align:top;">
<p><span class="font19">rtc</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">10:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2314</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IO-APIC-fasteoi</span></p></td><td style="vertical-align:top;">
<p><span class="font19">acpi</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">12:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">133</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IO-APIC-edge</span></p></td><td style="vertical-align:top;">
<p><span class="font19">i8042</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">14:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IO-APIC-edge</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">libata</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">15:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">72269</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IO-APIC-edge</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">libata</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">18:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IO-APIC-fasteoi</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">yenta</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">19:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">115036</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IO-APIC-fasteoi</span></p></td><td style="vertical-align:top;">
<p><span class="font19">eth0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">20:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">126871</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IO-APIC-fasteoi</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">libata, ohci1394</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">21:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">30204</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IO-APIC-fasteoi</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ehci_hcd:usb1, uhci_hcd:usb2</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">22:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1334</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IO-APIC-fasteoi</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">saa7133[0], saa7133[0]</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">24:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">234739</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IO-APIC-fasteoi</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nvidia</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">NMI:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">72</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">42</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">LOC:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">860000</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">859994</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">ERR:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
</table>
<p><span class="font7" style="font-weight:bold;">/proc/kcore</span></p>
<h4><a name="bookmark1134"></a><span class="font25"><a name="bookmark1135"></a><a name="bookmark1136"></a>The physical memory is represented in </span><span class="font25" style="font-weight:bold;">/proc/kcore</span><span class="font25">. Do not try to cat this file, instead use a debugger. The size of /proc/kcore is the same as your physical memory, plus four bytes.</span></h4>
<p><span class="font19">paul@laika:~$ ls -Ih /proc/kcore</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">—r-------- 1 root root 2.0G 2007-01-30 08:57 /proc/kcore</span></p></li></ul>
<p><span class="font19">paul@laika:~$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1137"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1138"></a>11.7.3. /sys Linux 2.6 hot plugging</span></h3></li></ul>
<p><a name="bookmark1139"></a><span class="font25"><a name="bookmark1140"></a><a name="bookmark1141"></a><a name="bookmark1142"></a><a name="bookmark1143"></a><a name="bookmark1144"></a>The </span><span class="font25" style="font-weight:bold;">/sys </span><span class="font25">directory was created for the Linux 2.6 kernel. Since 2.6, Linux uses </span><span class="font25" style="font-weight:bold;">sysfs </span><span class="font25">to support </span><span class="font25" style="font-weight:bold;">usb </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">IEEE 1394 </span><span class="font25">(</span><span class="font25" style="font-weight:bold;">FireWire</span><span class="font25">) hot plug devices. See the manual pages of udev(8) (the successor of </span><span class="font25" style="font-weight:bold;">devfs</span><span class="font25">) and hotplug(8) for more info (or visit </span><a href="http://linux-hotplug.sourceforge.net/"><span class="font25">http://linux-hotplug.sourceforge.net/</span></a><span class="font25"> ).</span></p>
<p><span class="font25">Basically the </span><span class="font25" style="font-weight:bold;">/sys </span><span class="font25">directory contains kernel information about hardware.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1145"></a><span class="font10" style="font-weight:bold;"><a name="bookmark98"></a><a name="bookmark1146"></a>11.8. /usr Unix System Resources</span></h2></li></ul>
<p><a name="bookmark1147"></a><span class="font25">Although </span><span class="font25" style="font-weight:bold;">/usr </span><span class="font25">is pronounced like user, remember that it stands for </span><span class="font25" style="font-weight:bold;">Unix System Resources</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">/usr </span><span class="font25">hierarchy should contain </span><span class="font25" style="font-weight:bold;">shareable, read only </span><span class="font25">data. Some people choose to mount </span><span class="font25" style="font-weight:bold;">/usr </span><span class="font25">as read only. This can be done from its own partition or from a read only NFS share (NFS is discussed later).</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1148"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1149"></a>11.8.1. /usr/bin</span></h3></li></ul>
<p><a name="bookmark1150"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">/usr/bin </span><span class="font25">directory contains a lot of commands.</span></p>
<p><span class="font19">paul@deb508:~$ ls /usr/bin | wc -l</span></p>
<p><span class="font19">1395</span></p>
<p><span class="font25">(On Solaris the </span><span class="font25" style="font-weight:bold;">/bin </span><span class="font25">directory is a symbolic link to </span><span class="font25" style="font-weight:bold;">/usr/bin</span><span class="font25">.)</span></p>
<h3><a name="bookmark1151"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1152"></a>11.8.2. /usr/include</span></h3>
<p><a name="bookmark1153"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">/usr/include </span><span class="font25">directory contains general use include files for C.</span></p>
<table border="1">
<tr><td rowspan="2" style="vertical-align:bottom;">
<p><span class="font19">paul@ubu1010: aalib.h</span></p></td><td colspan="3" style="vertical-align:bottom;">
<p><span class="font19">~$ ls /usr/include/</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">expat_config.h</span></p></td><td style="vertical-align:top;">
<p><span class="font19">math.h</span></p></td><td style="vertical-align:top;">
<p><span class="font19">search.h</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">af_vfs.h</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">expat_external.h</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">mcheck.h</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">semaphore.h</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">aio.h</span></p></td><td style="vertical-align:top;">
<p><span class="font19">expat.h</span></p></td><td style="vertical-align:top;">
<p><span class="font19">memory.h</span></p></td><td style="vertical-align:top;">
<p><span class="font19">setjmp.h</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">AL</span></p></td><td style="vertical-align:top;">
<p><span class="font19">fcntl.h</span></p></td><td style="vertical-align:top;">
<p><span class="font19">menu.h</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sgtty.h</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">aliases.h</span></p></td><td style="vertical-align:top;">
<p><span class="font19">features.h</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mntent.h</span></p></td><td style="vertical-align:top;">
<p><span class="font19">shadow.h</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1154"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1155"></a>11.8.3. /usr/lib</span></h3></li></ul>
<p><a name="bookmark1156"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">/usr/lib </span><span class="font25">directory contains libraries that are not directly executed by users or scripts.</span></p>
<p><span class="font19">paul@deb508:~$ ls /usr/lib | head -7 4Suite ao apt arj aspell avahi bonobo</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1157"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1158"></a>11.8.4. /usr/local</span></h3></li></ul>
<p><a name="bookmark1159"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">/usr/local </span><span class="font25">directory can be used by an administrator to install software locally.</span></p>
<p><span class="font19">paul@deb508:~$ ls /usr/local/</span></p>
<p><span class="font19">bin etc games include lib man sbin share src paul@deb508:~$ du -sh /usr/local/ 128K /usr/local/</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1160"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1161"></a>11.8.5. /usr/share</span></h3></li></ul>
<p><a name="bookmark1162"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">/usr/share </span><span class="font25">directory contains architecture independent data. As you can see, this is a fairly large directory.</span></p>
<p><span class="font19">paul@deb508:~$ ls /usr/share/ | wc -l</span></p>
<p><span class="font19">263</span></p>
<p><span class="font19">paul@deb508:~$ du -sh /usr/share/</span></p>
<p><span class="font19">1.3G /usr/share/</span></p>
<h4><a name="bookmark1163"></a><span class="font25"><a name="bookmark1164"></a><a name="bookmark1165"></a>This directory typically contains </span><span class="font25" style="font-weight:bold;">/usr/share/man </span><span class="font25">for manual pages.</span></h4>
<p><span class="font19">paul@deb508:~$ ls /usr/share/man</span></p>
<p><span class="font19">cs fr hu it.UTF-8 man2 man6 pl.ISO8859-2 sv</span></p>
<p><span class="font19">de fr.ISO8859-1 id ja man3 man7 pl.UTF-8 tr</span></p>
<p><span class="font19">es fr.UTF-8 it ko man4 man8 pt_BR zh_CN</span></p>
<p><span class="font19">fi gl it.ISO8859-1 man1 man5 pl ru zh_TW</span></p>
<h4><a name="bookmark1166"></a><span class="font25"><a name="bookmark1167"></a><a name="bookmark1168"></a>And it contains </span><span class="font25" style="font-weight:bold;">/usr/share/games </span><span class="font25">for all static game data (so no high-scores or play logs).</span></h4>
<p><span class="font19">paul@ubu1010:~$ ls /usr/share/games/ openttd wesnoth</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1169"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1170"></a>11.8.6 . /usr/src</span></h3></li></ul>
<h4><a name="bookmark1171"></a><span class="font25"><a name="bookmark1172"></a><a name="bookmark1173"></a>The </span><span class="font25" style="font-weight:bold;">/usr/src </span><span class="font25">directory is the recommended location for kernel source files.</span></h4>
<p><span class="font19">paul@deb508:~$ ls -l /usr/src/</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">total 12</span></p>
<p><span class="font19">drwxr-xr-x 4 root root 4096</span></p>
<p><span class="font19">drwxr-xr-x 18 root root 4096</span></p>
<p><span class="font19">drwxr-xr-x 3 root root 4096</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2011-02-01 14:43 linux-headers-2.6.26-2-686</span></p>
<p><span class="font19">2011-02-01 14:43 linux-headers-2.6.26-2-common</span></p>
<p><span class="font19">2009-10-28 16:01 linux-kbuild-2.6.26</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1174"></a><span class="font10" style="font-weight:bold;"><a name="bookmark99"></a><a name="bookmark1175"></a>11.9. /var variable data</span></h2></li></ul>
<h4><a name="bookmark1176"></a><span class="font25"><a name="bookmark1177"></a><a name="bookmark1178"></a>Files that are unpredictable in size, such as log, cache and spool files, should be located in </span><span class="font25" style="font-weight:bold;">/var</span><span class="font25">.</span></h4>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1179"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1180"></a>11.9.1. /var/log</span></h3></li></ul>
<h4><a name="bookmark1181"></a><span class="font25"><a name="bookmark1182"></a><a name="bookmark1183"></a>The </span><span class="font25" style="font-weight:bold;">/var/log </span><span class="font25">directory serves as a central point to contain all log files.</span></h4>
<p><span class="font19">[paul@RHEL4b ~]$ ls /var/log</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">acpid</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cron.2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">maillog.2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">quagga &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;secure.4</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">amanda</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cron.3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">maillog.3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">radius &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spooler</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">anaconda.log</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">cron.4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">maillog.4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">rpmpkgs &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spooler.1</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">anaconda.syslog</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">cups</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">mailman</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">rpmpkgs.1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spooler.2</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">anaconda.xlog</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">dmesg</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">messages</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">rpmpkgs.2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spooler.3</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">audit</span></p></td><td style="vertical-align:top;">
<p><span class="font19">exim</span></p></td><td style="vertical-align:top;">
<p><span class="font19">messages.1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">rpmpkgs.3 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spooler.4</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">boot.log</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">gdm</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">messages.2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">rpmpkgs.4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;squid</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">boot.log.1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">httpd</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">messages.3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sa &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uucp</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">boot.log.2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">iiim</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">messages.4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">samba &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vbox</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">boot.log.3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">iptraf</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">mysqld.log</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">scrollkeeper.log vmware-tools-guestd</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">boot.log.4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">lastlog</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">news</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">secure &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wtmp</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">canna</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mail</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pgsql</span></p></td><td style="vertical-align:top;">
<p><span class="font19">secure.1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wtmp.1</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">cron</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">maillog</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ppp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">secure.2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Xorg.0.log</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">cron.1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">maillog.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1 prelink.log</span></p></td><td style="vertical-align:top;">
<p><span class="font19">secure.3 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Xorg.0.log.old</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1184"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1185"></a>11.9.2. /var/log/messages</span></h3></li></ul>
<h4><a name="bookmark1186"></a><span class="font25"><a name="bookmark1187"></a><a name="bookmark1188"></a><a name="bookmark1189"></a>A typical first file to check when troubleshooting on Red Hat (and derivatives) is the </span><span class="font25" style="font-weight:bold;">/var/ log/messages </span><span class="font25">file. By default this file will contain information on what just happened to the system. The file is called </span><span class="font25" style="font-weight:bold;">/var/log/syslog </span><span class="font25">on Debian and Ubuntu.</span></h4>
<p><span class="font19">[root@RHEL4b ~]# tail /var/log/messages</span></p>
<p><span class="font19">Jul 30 05:13:56 anacron: anacron startup succeeded</span></p>
<p><span class="font19">Jul 30 05:13:56 atd: atd startup succeeded</span></p>
<p><span class="font19">Jul 30 05:13:57 messagebus: messagebus startup succeeded</span></p>
<p><span class="font19">Jul 30 05:13:57 cups-config-daemon: cups-config-daemon startup succeeded</span></p>
<p><span class="font19">Jul 30 05:13:58 haldaemon: haldaemon startup succeeded</span></p>
<p><span class="font19">Jul 30 05:14:00 fstab-sync[3560]: removed all generated mount points</span></p>
<p><span class="font19">Jul 30 05:14:01 fstab-sync[3628]: added mount point /media/cdrom for...</span></p>
<p><span class="font19">Jul 30 05:14:01 fstab-sync[3646]: added mount point /media/floppy for...</span></p>
<p><span class="font19">Jul 30 05:16:46 sshd(pam_unix)[3662]: session opened for user paul by...</span></p>
<p><span class="font19">Jul 30 06:06:37 su(pam_unix)[3904]: session opened for user root by paul</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1190"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1191"></a>11.9.3. /var/cache</span></h3></li></ul>
<h4><a name="bookmark1192"></a><span class="font25"><a name="bookmark1193"></a><a name="bookmark1194"></a>The </span><span class="font25" style="font-weight:bold;">/var/cache </span><span class="font25">directory can contain </span><span class="font25" style="font-weight:bold;">cache data </span><span class="font25">for several applications.</span></h4>
<p><span class="font19">paul@ubu1010:~$ ls /var/cache/</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">apt</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">dictionaries-common</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">gdm</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">man</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">software-center</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">binfmts</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">flashplugin-installer</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">hald</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pm-utils</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">cups</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">fontconfig</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">jockey</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pppconfig</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">debconf</span></p></td><td style="vertical-align:top;">
<p><span class="font19">fonts</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ldconfig</span></p></td><td style="vertical-align:top;">
<p><span class="font19">samba</span></p></td><td style="vertical-align:top;"></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1195"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1196"></a>11.9.4. /var/spool</span></h3></li></ul>
<h4><a name="bookmark1197"></a><span class="font25"><a name="bookmark1198"></a><a name="bookmark1199"></a>The </span><span class="font25" style="font-weight:bold;">/var/spool </span><span class="font25">directory typically contains spool directories for </span><span class="font25" style="font-weight:bold;">mail </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">cron</span><span class="font25">, but also serves as a parent directory for other spool files (for example print spool files).</span></h4>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1200"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1201"></a>11.9.5. /var/lib</span></h3></li></ul>
<p><a name="bookmark1202"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">/var/lib </span><span class="font25">directory contains application state information.</span></p>
<p><a name="bookmark1203"></a><span class="font25"><a name="bookmark1204"></a>Red Hat Enterprise Linux for example keeps files pertaining to </span><span class="font25" style="font-weight:bold;">rpm </span><span class="font25">in </span><span class="font25" style="font-weight:bold;">/var/lib/rpm/</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1205"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1206"></a>11.9.6. /var/...</span></h3></li></ul>
<p><a name="bookmark1207"></a><span class="font25" style="font-weight:bold;"><a name="bookmark1208"></a><a name="bookmark1209"></a><a name="bookmark1210"></a>/var </span><span class="font25">also contains Process ID files in </span><span class="font25" style="font-weight:bold;">/var/run </span><span class="font25">(soon to be replaced with </span><span class="font25" style="font-weight:bold;">/run</span><span class="font25">) and temporary files that survive a reboot in </span><span class="font25" style="font-weight:bold;">/var/tmp </span><span class="font25">and information about file locks in </span><span class="font25" style="font-weight:bold;">/var/lock</span><span class="font25">. There will be more examples of </span><span class="font25" style="font-weight:bold;">/var </span><span class="font25">usage further in this book.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1211"></a><span class="font10" style="font-weight:bold;"><a name="bookmark100"></a><a name="bookmark1212"></a>11.10. practice: file system tree</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Does the file </span><span class="font25" style="font-weight:bold;">/bin/cat </span><span class="font25">exist ? What about </span><span class="font25" style="font-weight:bold;">/bin/dd </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/bin/echo</span><span class="font25">. What is the type of these files ?</span></p></li>
<li>
<p><span class="font25">2. What is the size of the Linux kernel file(s) (vmlinu*) in </span><span class="font25" style="font-weight:bold;">/boot </span><span class="font25">?</span></p></li>
<li>
<p><span class="font25">3. Create a directory ~/test. Then issue the following commands:</span></p></li></ul>
<p><span class="font19">cd ~/test</span></p>
<p><span class="font19">dd if=/dev/zero of=zeroes.txt count=1 bs=100</span></p>
<p><span class="font19">od zeroes.txt</span></p>
<p><span class="font25" style="font-weight:bold;">dd </span><span class="font25">will copy one times (count=1) a block of size 100 bytes (bs=100) from the file </span><span class="font25" style="font-weight:bold;">/dev/zero </span><span class="font25">to ~/test/zeroes.txt. Can you describe the functionality of </span><span class="font25" style="font-weight:bold;">/dev/zero </span><span class="font25">?</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Now issue the following command:</span></p></li></ul>
<p><span class="font19">dd if=/dev/random of=random.txt count=1 bs=100 ; od random.txt</span></p>
<p><span class="font25" style="font-weight:bold;">dd </span><span class="font25">will copy one times (count=1) a block of size 100 bytes (bs=100) from the file </span><span class="font25" style="font-weight:bold;">/dev/ random </span><span class="font25">to ~/test/random.txt. Can you describe the functionality of </span><span class="font25" style="font-weight:bold;">/dev/random </span><span class="font25">?</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Issue the following two commands, and look at the first character of each output line.</span></p></li></ul>
<p><span class="font19">ls -l /dev/sd* /dev/hd*</span></p>
<p><span class="font19">ls -l /dev/tty* /dev/input/mou*</span></p>
<p><span class="font25">The first ls will show block(b) devices, the second ls shows character(c) devices. Can you tell the difference between block and character devices ?</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Use cat to display </span><span class="font25" style="font-weight:bold;">/etc/hosts </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/etc/resolv.conf</span><span class="font25">. What is your idea about the purpose of these files ?</span></p></li>
<li>
<p><span class="font25">7. Are there any files in </span><span class="font25" style="font-weight:bold;">/etc/skel/ </span><span class="font25">? Check also for hidden files.</span></p></li>
<li>
<p><span class="font25">8. Display </span><span class="font25" style="font-weight:bold;">/proc/cpuinfo</span><span class="font25">. On what architecture is your Linux running ?</span></p></li>
<li>
<p><span class="font25">9. Display </span><span class="font25" style="font-weight:bold;">/proc/interrupts</span><span class="font25">. What is the size of this file ? Where is this file stored ?</span></p></li>
<li>
<p><span class="font25">10. Can you enter the </span><span class="font25" style="font-weight:bold;">/root </span><span class="font25">directory ? Are there (hidden) files ?</span></p></li>
<li>
<p><span class="font25">11. Are ifconfig, fdisk, parted, shutdown and grub-install present in </span><span class="font25" style="font-weight:bold;">/sbin </span><span class="font25">? Why are these binaries in </span><span class="font25" style="font-weight:bold;">/sbin </span><span class="font25">and not in </span><span class="font25" style="font-weight:bold;">/bin </span><span class="font25">?</span></p></li>
<li>
<p><span class="font25">12. Is </span><span class="font25" style="font-weight:bold;">/var/log </span><span class="font25">a file or a directory ? What about </span><span class="font25" style="font-weight:bold;">/var/spool </span><span class="font25">?</span></p></li>
<li>
<p><span class="font25">13. Open two command prompts (Ctrl-Shift-T in gnome-terminal) or terminals (Ctrl-Alt-F1, Ctrl-Alt-F2, ...) and issue the </span><span class="font25" style="font-weight:bold;">who am i </span><span class="font25">in both. Then try to echo a word from one terminal to the other.</span></p></li>
<li>
<p><a name="bookmark1213"></a><span class="font25">14. Read the man page of </span><span class="font25" style="font-weight:bold;">random </span><span class="font25">and explain the difference between </span><span class="font25" style="font-weight:bold;">/dev/random </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/ dev/urandom</span><span class="font25">.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1214"></a><span class="font10" style="font-weight:bold;"><a name="bookmark101"></a><a name="bookmark1215"></a>11.11. solution: file system tree</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Does the file </span><span class="font25" style="font-weight:bold;">/bin/cat </span><span class="font25">exist ? What about </span><span class="font25" style="font-weight:bold;">/bin/dd </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/bin/echo</span><span class="font25">. What is the type of these files ?</span></p></li></ul>
<p><span class="font19">ls /bin/cat ; file /bin/cat</span></p>
<p><span class="font19">ls /bin/dd ; file /bin/dd</span></p>
<p><span class="font19">ls /bin/echo ; file /bin/echo</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. What is the size of the Linux kernel file(s) (vmlinu*) in </span><span class="font25" style="font-weight:bold;">/boot </span><span class="font25">?</span></p></li></ul>
<p><span class="font19">ls -lh /boot/vm*</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Create a directory ~/test. Then issue the following commands:</span></p></li></ul>
<p><span class="font19">cd ~/test</span></p>
<p><span class="font19">dd if=/dev/zero of=zeroes.txt count=1 bs=100</span></p>
<p><span class="font19">od zeroes.txt</span></p>
<p><span class="font25" style="font-weight:bold;">dd </span><span class="font25">will copy one times (count=1) a block of size 100 bytes (bs=100) from the file </span><span class="font25" style="font-weight:bold;">/dev/zero </span><span class="font25">to ~/test/zeroes.txt. Can you describe the functionality of </span><span class="font25" style="font-weight:bold;">/dev/zero </span><span class="font25">?</span></p>
<p><a name="bookmark1216"></a><span class="font25" style="font-weight:bold;">/dev/zero </span><span class="font25">is a Linux special device. It can be considered a source of zeroes. You cannot send something to </span><span class="font25" style="font-weight:bold;">/dev/zero</span><span class="font25">, but you can read zeroes from it.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Now issue the following command:</span></p></li></ul>
<p><span class="font19">dd if=/dev/random of=random.txt count=1 bs=100 ; od random.txt</span></p>
<p><span class="font25" style="font-weight:bold;">dd </span><span class="font25">will copy one times (count=1) a block of size 100 bytes (bs=100) from the file </span><span class="font25" style="font-weight:bold;">/dev/ random </span><span class="font25">to ~/test/random.txt. Can you describe the functionality of </span><span class="font25" style="font-weight:bold;">/dev/random </span><span class="font25">?</span></p>
<p><a name="bookmark1217"></a><span class="font25" style="font-weight:bold;"><a name="bookmark1218"></a>/dev/random </span><span class="font25">acts as a </span><span class="font25" style="font-weight:bold;">random number generator </span><span class="font25">on your Linux machine.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Issue the following two commands, and look at the first character of each output line.</span></p></li></ul>
<p><span class="font19">ls -l /dev/sd* /dev/hd*</span></p>
<p><span class="font19">ls -l /dev/tty* /dev/input/mou*</span></p>
<p><span class="font25">The first ls will show block(b) devices, the second ls shows character(c) devices. Can you tell the difference between block and character devices ?</span></p>
<p><span class="font25">Block devices are always written to (or read from) in blocks. For hard disks, blocks of 512 bytes are common. Character devices act as a stream of characters (or bytes). Mouse and keyboard are typical character devices.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Use cat to display </span><span class="font25" style="font-weight:bold;">/etc/hosts </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/etc/resolv.conf</span><span class="font25">. What is your idea about the purpose of these files ?</span></p></li></ul>
<p><a name="bookmark1219"></a><span class="font19" style="font-weight:bold;">/etc/hosts </span><span class="font19">contains hostnames with their ip address</span></p>
<p><a name="bookmark1220"></a><span class="font19" style="font-weight:bold;">/etc/resolv.conf </span><span class="font19">should contain the ip address of a DNS name server.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. Are there any files in </span><span class="font25" style="font-weight:bold;">/etc/skel/ </span><span class="font25">? Check also for hidden files.</span></p></li></ul>
<p><span class="font19">Issue &quot;ls -al /etc/skel/&quot;. Yes, there should be hidden files there.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. Display </span><span class="font25" style="font-weight:bold;">/proc/cpuinfo</span><span class="font25">. On what architecture is your Linux running ?</span></p></li></ul>
<p><span class="font19">The file should contain at least one line with Intel or other cpu.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">9. Display </span><span class="font25" style="font-weight:bold;">/proc/interrupts</span><span class="font25">. What is the size of this file ? Where is this file stored ?</span></p></li></ul>
<p><span class="font25">The size is zero, yet the file contains data. It is not stored anywhere because /proc is a virtual file system that allows you to talk with the kernel. (If you answered &quot;stored in RAMmemory, that is also correct...).</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">10. Can you enter the </span><span class="font25" style="font-weight:bold;">/root </span><span class="font25">directory ? Are there (hidden) files ?</span></p></li></ul>
<p><span class="font19">Try &quot;cd /root&quot;. The </span><span class="font19" style="font-weight:bold;">/root </span><span class="font19">directory is not accessible for normal users on most modern Linux sy</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">11. Are ifconfig, fdisk, parted, shutdown and grub-install present in </span><span class="font25" style="font-weight:bold;">/sbin </span><span class="font25">? Why are these binaries in </span><span class="font25" style="font-weight:bold;">/sbin </span><span class="font25">and not in /bin ?</span></p></li></ul>
<p><span class="font19">Because those files are only meant for system administrators.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">12. Is </span><span class="font25" style="font-weight:bold;">/var/log </span><span class="font25">a file or a directory ? What about </span><span class="font25" style="font-weight:bold;">/var/spool </span><span class="font25">?</span></p></li></ul>
<p><span class="font19">Both are directories.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">13. Open two command prompts (Ctrl-Shift-T in gnome-terminal) or terminals (Ctrl-Alt-F1, Ctrl-Alt-F2, ...) and issue the </span><span class="font25" style="font-weight:bold;">who am i </span><span class="font25">in both. Then try to echo a word from one terminal to the other.</span></p></li></ul>
<p><span class="font19">tty-terminal: echo Hello &gt;&nbsp;/dev/tty1</span></p>
<p><span class="font19">pts-terminal: echo Hello &gt;&nbsp;/dev/pts/1</span></p>
<ul style="list-style:none;"><li>
<p><a name="bookmark1221"></a><span class="font25">14. Read the man page of </span><span class="font25" style="font-weight:bold;">random </span><span class="font25">and explain the difference between </span><span class="font25" style="font-weight:bold;">/dev/random </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/ dev/urandom</span><span class="font25">.</span></p></li></ul>
<p><span class="font19">man 4 random</span></p>
<p><a name="bookmark1222"></a><span class="font11" style="font-weight:bold;">Part IV. shell expansion</span></p>
<h3><a name="bookmark1223"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1224"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1225"><span class="font24" style="font-weight:bold;">12. commands and arguments </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1226"><span class="font24">12.1. arguments </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1227"><span class="font24">12.2. white space removal </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1228"><span class="font24">12.3. single quotes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1229"><span class="font24">12.4. double quotes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1230"><span class="font24">12.5. echo and quotes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1231"><span class="font24">12.6. commands </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1232"><span class="font24">12.7. aliases </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1233"><span class="font24">12.8. displaying shell expansion </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1234"><span class="font24">12.9. practice: commands and arguments </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1235"><span class="font24">12.10. solution: commands and arguments </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1236"><span class="font24" style="font-weight:bold;">13. control operators </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1237"><span class="font24">13.1. ; semicolon </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1238"><span class="font24">13.2. &amp;&nbsp;ampersand </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1239"><span class="font24">13.3. $? dollar question mark </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1240"><span class="font24">13.4. &amp;&amp;&nbsp;double ampersand </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1241"><span class="font24">13.5. || double vertical bar </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1242"><span class="font24">13.6. combining &amp;&amp;&nbsp;and || </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1243"><span class="font24">13.7. # pound sign </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1244"><span class="font24">13.8. \ escaping special characters </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1245"><span class="font24">13.9. practice: control operators </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1246"><span class="font24">13.10. solution: control operators </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1247"><span class="font24" style="font-weight:bold;">14. shell variables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1248"><span class="font24">14.1. $ dollar sign </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1249"><span class="font24">14.2. case sensitive </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1250"><span class="font24">14.3. creating variables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1251"><span class="font24">14.4. quotes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1252"><span class="font24">14.5. set </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1253"><span class="font24">14.6. unset </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1254"><span class="font24">14.7. $PS1 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1255"><span class="font24">14.8. $PATH </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1256"><span class="font24">14.9. env </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1257"><span class="font24">14.10. export </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1258"><span class="font24">14.11. delineate variables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1259"><span class="font24">14.12. unbound variables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1260"><span class="font24">14.13. practice: shell variables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1261"><span class="font24">14.14. solution: shell variables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1262"><span class="font24" style="font-weight:bold;">15. shell embedding and options </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1263"><span class="font24">15.1. shell embedding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1264"><span class="font24">15.2. shell options </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1265"><span class="font24">15.3. practice: shell embedding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1266"><span class="font24">15.4. solution: shell embedding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1267"><span class="font24" style="font-weight:bold;">16. shell history </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1268"><span class="font24">16.1. repeating the last command </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1269"><span class="font24">16.2. repeating other commands </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1270"><span class="font24">16.3. history </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1271"><span class="font24">16.4. !n </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1272"><span class="font24">16.5. Ctrl-r </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1273"><span class="font24">16.6. $HISTSIZE </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1274"><span class="font24">16.7. $HISTFILE </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1275"><span class="font24">16.8. $HISTFILESIZE </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1276"><span class="font24">16.9. prevent recording a command </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1277"><span class="font24">16.10. (optional)regular expressions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1278"><span class="font24">16.11. (optional) Korn shell history </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1279"><span class="font24">16.12. practice: shell history </span></a></p></li></ul>
<p><span class="font24">shell expansion</span></p>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1280"><span class="font24">16.13. solution: shell history </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1281"><span class="font24" style="font-weight:bold;">17. file globbing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1282"><span class="font24">17.1. * asterisk </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1283"><span class="font24">17.2. ? question mark </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1284"><span class="font24">17.3. [] square brackets </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1285"><span class="font24">17.4. a-z and 0-9 ranges </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1286"><span class="font24">17.5. $LANG and square brackets </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1287"><span class="font24">17.6. preventing file globbing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1288"><span class="font24">17.7. practice: shell globbing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1289"><span class="font24">17.8. solution: shell globbing </span></a></p></li></ul>
<h1><a name="bookmark1290"></a><span class="font11" style="font-weight:bold;"><a name="bookmark103"></a><a name="bookmark1291"></a>Chapter 12. commands and arguments</span></h1>
<p><span class="font25">This chapter introduces you to </span><span class="font25" style="font-weight:bold;">shell expansion </span><span class="font25">by taking a close look at </span><span class="font25" style="font-weight:bold;">commands </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">arguments</span><span class="font25">. Knowing </span><span class="font25" style="font-weight:bold;">shell expansion </span><span class="font25">is important because many </span><span class="font25" style="font-weight:bold;">commands </span><span class="font25">on your Linux system are processed and most likely changed by the </span><span class="font25" style="font-weight:bold;">shell </span><span class="font25">before they are executed.</span></p>
<p><a name="bookmark1292"></a><span class="font25"><a name="bookmark1293"></a><a name="bookmark1294"></a><a name="bookmark1295"></a><a name="bookmark1296"></a>The command line interface or </span><span class="font25" style="font-weight:bold;">shell </span><span class="font25">used on most Linux systems is called </span><span class="font25" style="font-weight:bold;">bash</span><span class="font25">, which stands for </span><span class="font25" style="font-weight:bold;">Bourne again shell</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">bash </span><span class="font25">shell incorporates features from </span><span class="font25" style="font-weight:bold;">sh </span><span class="font25">(the original Bourne shell), </span><span class="font25" style="font-weight:bold;">csh </span><span class="font25">(the C shell), and </span><span class="font25" style="font-weight:bold;">ksh </span><span class="font25">(the Korn shell).</span></p>
<p><a name="bookmark1297"></a><span class="font25">This chapter frequently uses the </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">command to demonstrate shell features. The </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">command is very simple: it echoes the input that it receives.</span></p>
<p><span class="font19">paul@laika:~$ echo Burtonville</span></p>
<p><span class="font19">Burtonville</span></p>
<p><span class="font19">paul@laika:~$ echo Smurfs are blue</span></p>
<p><span class="font19">Smurfs are blue</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1298"></a><span class="font10" style="font-weight:bold;"><a name="bookmark104"></a><a name="bookmark1299"></a>12.1. arguments</span></h2></li></ul>
<p><a name="bookmark1300"></a><span class="font25">One of the primary features of a shell is to perform a </span><span class="font25" style="font-weight:bold;">command line scan</span><span class="font25">. When you enter a command at the shell's command prompt and press the enter key, then the shell will start scanning that line, cutting it up in </span><span class="font25" style="font-weight:bold;">arguments</span><span class="font25">. While scanning the line, the shell may make many changes to the </span><span class="font25" style="font-weight:bold;">arguments </span><span class="font25">you typed.</span></p>
<p><a name="bookmark1301"></a><span class="font25">This process is called </span><span class="font25" style="font-weight:bold;">shell expansion</span><span class="font25">. When the shell has finished scanning and modifying that line, then it will be executed.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1302"></a><span class="font10" style="font-weight:bold;"><a name="bookmark105"></a><a name="bookmark1303"></a>12.2. white space removal</span></h2></li></ul>
<p><a name="bookmark1304"></a><span class="font25"><a name="bookmark1305"></a>Parts that are separated by one or more consecutive </span><span class="font25" style="font-weight:bold;">white spaces </span><span class="font25">(or tabs) are considered separate </span><span class="font25" style="font-weight:bold;">arguments</span><span class="font25">, any white space is removed. The first </span><span class="font25" style="font-weight:bold;">argument </span><span class="font25">is the command to be executed, the other </span><span class="font25" style="font-weight:bold;">arguments </span><span class="font25">are given to the command. The shell effectively cuts your command into one or more arguments.</span></p>
<p><a name="bookmark1306"></a><span class="font25">This explains why the following four different command lines are the same after </span><span class="font25" style="font-weight:bold;">shell expansion</span><span class="font25">.</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo Hello World</span></p>
<p><span class="font19">Hello World [paul@RHELv4u3 ~]$ echo Hello World</span></p>
<p><span class="font19">Hello World [paul@RHELv4u3 ~]$ echo Hello World</span></p>
<p><span class="font19">Hello World [paul@RHELv4u3 ~]$ echo Hello World</span></p>
<p><span class="font19">Hello World</span></p>
<p><a name="bookmark1307"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">command will display each argument it receives from the shell. The </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">command will also add a new white space between the arguments it received.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1308"></a><span class="font10" style="font-weight:bold;"><a name="bookmark106"></a><a name="bookmark1309"></a>12.3. single quotes</span></h2></li></ul>
<p><span class="font25">You can prevent the removal of white spaces by quoting the spaces. The contents of the quoted string are considered as one argument. In the screenshot below the </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">receives only one </span><span class="font25" style="font-weight:bold;">argument</span><span class="font25">.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo 'A line with single quotes'</span></p>
<p><span class="font19">A line with &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;single quotes</span></p>
<p><span class="font19">[paul@RHEL4b ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1310"></a><span class="font10" style="font-weight:bold;"><a name="bookmark107"></a><a name="bookmark1311"></a>12.4. double quotes</span></h2></li></ul>
<p><a name="bookmark1312"></a><span class="font25">You can also prevent the removal of white spaces by double quoting the spaces. Same as above, </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">only receives one </span><span class="font25" style="font-weight:bold;">argument</span><span class="font25">.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo &quot;A line with double quotes&quot;</span></p>
<p><span class="font19">A line with double quotes</span></p>
<p><span class="font19">[paul@RHEL4b ~]$</span></p>
<p><span class="font25">Later in this book, when discussing </span><span class="font25" style="font-weight:bold;">variables </span><span class="font25">we will see important differences between single and double quotes.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1313"></a><span class="font10" style="font-weight:bold;"><a name="bookmark108"></a><a name="bookmark1314"></a>12.5. echo and quotes</span></h2></li></ul>
<p><a name="bookmark1315"></a><span class="font25">Quoted lines can include special escaped characters recognised by the </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">command (when using </span><span class="font25" style="font-weight:bold;">echo -e</span><span class="font25">). The screenshot below shows how to use </span><span class="font25" style="font-weight:bold;">\n </span><span class="font25">for a newline and </span><span class="font25" style="font-weight:bold;">\t </span><span class="font25">for a tab (usually eight white spaces).</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo -e &quot;A line with \na newline&quot;</span></p>
<p><span class="font19">A line with a newline [paul@RHEL4b ~]$ echo -e 'A line with \na newline'</span></p>
<p><span class="font19">A line with a newline [paul@RHEL4b ~]$ echo -e &quot;A line with \ta tab&quot;</span></p>
<p><span class="font19">A line with &nbsp;&nbsp;&nbsp;&nbsp;a tab</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo -e 'A line with \ta tab'</span></p>
<p><span class="font19">A line with &nbsp;&nbsp;&nbsp;&nbsp;a tab</span></p>
<p><span class="font19">[paul@RHEL4b ~]$</span></p>
<p><span class="font25">The echo command can generate more than white spaces, tabs and newlines. Look in the man page for a list of options.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1316"></a><span class="font10" style="font-weight:bold;"><a name="bookmark109"></a><a name="bookmark1317"></a>12.6. commands</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark1318"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1319"></a>12.6.1. external or builtin commands ?</span></h3></li></ul></li></ul>
<p><a name="bookmark1320"></a><span class="font25"><a name="bookmark1321"></a>Not all commands are external to the shell, some are </span><span class="font25" style="font-weight:bold;">builtin</span><span class="font25">. </span><span class="font25" style="font-weight:bold;">External commands </span><span class="font25">are programs that have their own binary and reside somewhere in the file system. Many external commands are located in </span><span class="font25" style="font-weight:bold;">/bin </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">/sbin</span><span class="font25">. </span><span class="font25" style="font-weight:bold;">Builtin commands </span><span class="font25">are an integral part of the shell program itself.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1322"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1323"></a>12.6.2. type</span></h3></li></ul>
<p><a name="bookmark1324"></a><span class="font25">To find out whether a command given to the shell will be executed as an </span><span class="font25" style="font-weight:bold;">external command </span><span class="font25">or as a </span><span class="font25" style="font-weight:bold;">builtin command</span><span class="font25">, use the </span><span class="font25" style="font-weight:bold;">type </span><span class="font25">command.</span></p>
<p><span class="font19">paul@laika:~$ type cd cd is a shell builtin paul@laika:~$ type cat cat is /bin/cat</span></p>
<p><span class="font25">As you can see, the </span><span class="font25" style="font-weight:bold;">cd </span><span class="font25">command is </span><span class="font25" style="font-weight:bold;">builtin </span><span class="font25">and the </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">command is </span><span class="font25" style="font-weight:bold;">external</span><span class="font25">.</span></p>
<p><span class="font25">You can also use this command to show you whether the command is </span><span class="font25" style="font-weight:bold;">aliased </span><span class="font25">or not. </span><span class="font19">paul@laika:~$ type ls ls is aliased to 'ls --color=auto'</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1325"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1326"></a>12.6.3. running external commands</span></h3></li></ul>
<p><span class="font25">Some commands have both builtin and external versions. When one of these commands is executed, the builtin version takes priority. To run the external version, you must enter the full path to the command.</span></p>
<p><span class="font19">paul@laika:~$ type -a echo echo is a shell builtin echo is /bin/echo</span></p>
<p><span class="font19">paul@laika:~$ /bin/echo Running the external echo command...</span></p>
<p><span class="font19">Running the external echo command...</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1327"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1328"></a>12.6.4. which</span></h3></li></ul>
<p><a name="bookmark1329"></a><span class="font25"><a name="bookmark1330"></a>The </span><span class="font25" style="font-weight:bold;">which </span><span class="font25">command will search for binaries in the </span><span class="font25" style="font-weight:bold;">$PATH </span><span class="font25">environment variable (variables will be explained later). In the screenshot below, it is determined that </span><span class="font25" style="font-weight:bold;">cd </span><span class="font25">is </span><span class="font25" style="font-weight:bold;">builtin</span><span class="font25">, and </span><span class="font25" style="font-weight:bold;">ls, cp, rm, mv, mkdir, pwd, </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">which </span><span class="font25">are external commands.</span></p>
<p><span class="font19">[root@RHEL4b ~]# which cp ls cd mkdir pwd</span></p>
<p><span class="font19">/bin/cp</span></p>
<p><span class="font19">/bin/ls</span></p>
<p><span class="font19">/usr/bin/which: no cd in (/usr/kerberos/sbin:/usr/kerberos/bin:...</span></p>
<p><span class="font19">/bin/mkdir</span></p>
<p><span class="font19">/bin/pwd</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1331"></a><span class="font10" style="font-weight:bold;"><a name="bookmark110"></a><a name="bookmark1332"></a>12.7. aliases</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark1333"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1334"></a>12.7.1. create an alias</span></h3></li></ul></li></ul>
<p><a name="bookmark1335"></a><span class="font25">The shell allows you to create </span><span class="font25" style="font-weight:bold;">aliases</span><span class="font25">. Aliases are often used to create an easier to remember name for an existing command or to easily supply parameters.</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ cat count.txt one two three</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ alias dog=tac [paul@RHELv4u3 ~]$ dog count.txt three two one</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1336"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1337"></a>12.7.2. abbreviate commands</span></h3></li></ul>
<p><a name="bookmark1338"></a><span class="font25">An </span><span class="font25" style="font-weight:bold;">alias </span><span class="font25">can also be useful to abbreviate an existing command.</span></p>
<p><span class="font19">paul@laika:~$ alias ll='ls -Ih --color=auto' paul@laika:~$ alias c='clear' paul@laika:~$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1339"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1340"></a>12.7.3. default options</span></h3></li></ul>
<p><a name="bookmark1341"></a><span class="font25">Aliases can be used to supply commands with default options. The example below shows how to set the </span><span class="font25" style="font-weight:bold;">-i </span><span class="font25">option default when typing </span><span class="font25" style="font-weight:bold;">rm</span><span class="font25">.</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ rm -i winter.txt rm: remove regular file 'winter.txt'? no [paul@RHELv4u3 ~]$ rm winter.txt</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ ls winter.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">ls: winter.txt: No such file or directory</span></p></li></ul>
<p><span class="font19">[paul@RHELv4u3 ~]$ touch winter.txt</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ alias rm='rm -i'</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ rm winter.txt rm: remove regular empty file 'winter.txt'? no [paul@RHELv4u3 ~]$</span></p>
<p><span class="font25">Some distributions enable default aliases to protect users from accidentally erasing files ('rm</span></p>
<p><span class="font25">-i', 'mv -i', 'cp -i')</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1342"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1343"></a>12.7.4. viewing aliases</span></h3></li></ul>
<p><span class="font25">You can provide one or more aliases as arguments to the </span><span class="font25" style="font-weight:bold;">alias </span><span class="font25">command to get their definitions. Providing no arguments gives a complete list of current aliases.</span></p>
<p><span class="font19">paul@laika:~$ alias c ll</span></p>
<p><span class="font19">alias c='clear'</span></p>
<p><span class="font19">alias ll='ls -lh --color=auto'</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1232"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1344"></a>12.7.5. unalias</span></h3></li></ul>
<h4><a name="bookmark1345"></a><span class="font25"><a name="bookmark1346"></a><a name="bookmark1347"></a>You can undo an alias with the </span><span class="font25" style="font-weight:bold;">unalias </span><span class="font25">command.</span></h4>
<p><span class="font19">[paul@RHEL4b ~]$ which rm /bin/rm</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ alias rm='rm -i'</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ which rm alias rm='rm -i'</span></p>
<p><span class="font19">/bin/rm</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ unalias rm</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ which rm</span></p>
<p><span class="font19">/bin/rm</span></p>
<p><span class="font19">[paul@RHEL4b ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1348"></a><span class="font10" style="font-weight:bold;"><a name="bookmark111"></a><a name="bookmark1349"></a>12.8. displaying shell expansion</span></h2></li></ul>
<h4><a name="bookmark1350"></a><span class="font25"><a name="bookmark1351"></a><a name="bookmark1352"></a><a name="bookmark1353"></a>You can display shell expansion with </span><span class="font25" style="font-weight:bold;">set -x</span><span class="font25">, and stop displaying it with </span><span class="font25" style="font-weight:bold;">set +x</span><span class="font25">. You might want to use this further on in this course, or when in doubt about exactly what the shell is doing with your command.</span></h4>
<p><span class="font19">[paul@RHELv4u3 ~]$ set -x</span></p>
<p><span class="font19">++ echo -ne '\033]0;paul@RHELv4u3:~\007' [paul@RHELv4u3 ~]$ echo $USER + echo paul paul</span></p>
<p><span class="font19">++ echo -ne '\033]0;paul@RHELv4u3:~\007' [paul@RHELv4u3 ~]$ echo \$USER</span></p>
<p><span class="font19">+ echo '$USER'</span></p>
<p><span class="font19">$USER</span></p>
<p><span class="font19">++ echo -ne '\033]0;paul@RHELv4u3:~\007' [paul@RHELv4u3 ~]$ set +x</span></p>
<p><span class="font19">+ set +x</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo $USER paul</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1354"></a><span class="font10" style="font-weight:bold;"><a name="bookmark112"></a><a name="bookmark1355"></a>12.9. practice: commands and arguments</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. How many </span><span class="font25" style="font-weight:bold;">arguments </span><span class="font25">are in this line (not counting the command itself).</span></p></li></ul>
<p><span class="font19">touch '/etc/cron/cron.allow' 'file 42.txt' &quot;file 33.txt&quot;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Is </span><span class="font25" style="font-weight:bold;">tac </span><span class="font25">a shell builtin command ?</span></p></li>
<li>
<p><span class="font25">3. Is there an existing alias for </span><span class="font25" style="font-weight:bold;">rm </span><span class="font25">?</span></p></li>
<li>
<p><span class="font25">4. Read the man page of </span><span class="font25" style="font-weight:bold;">rm</span><span class="font25">, make sure you understand the </span><span class="font25" style="font-weight:bold;">-i </span><span class="font25">option of rm. Create and remove a file to test the </span><span class="font25" style="font-weight:bold;">-i </span><span class="font25">option.</span></p></li>
<li>
<p><span class="font25">5. Execute: </span><span class="font25" style="font-weight:bold;">alias rm='rm -i' </span><span class="font25">. Test your alias with a test file. Does this work as expected ?</span></p></li>
<li>
<p><span class="font25">6. List all current aliases.</span></p></li></ul>
<p><span class="font25">7a. Create an alias called 'city' that echoes your hometown.</span></p>
<p><span class="font25">7b. Use your alias to test that it works.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. Execute </span><span class="font25" style="font-weight:bold;">set -x </span><span class="font25">to display shell expansion for every command.</span></p></li>
<li>
<p><span class="font25">9. Test the functionality of </span><span class="font25" style="font-weight:bold;">set -x </span><span class="font25">by executing your </span><span class="font25" style="font-weight:bold;">city </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">rm </span><span class="font25">aliases.</span></p></li>
<li>
<p><span class="font25">10 Execute </span><span class="font25" style="font-weight:bold;">set +x </span><span class="font25">to stop displaying shell expansion.</span></p></li>
<li>
<p><span class="font25">11. Remove your city alias.</span></p></li>
<li>
<p><span class="font25">12. What is the location of the </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">and the </span><span class="font25" style="font-weight:bold;">passwd </span><span class="font25">commands ?</span></p></li>
<li>
<p><span class="font25">13. Explain the difference between the following commands:</span></p></li></ul>
<p><span class="font19">echo</span></p>
<p><span class="font19">/bin/echo</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">14. Explain the difference between the following commands:</span></p></li></ul>
<p><span class="font19">echo Hello</span></p>
<p><span class="font19">echo -n Hello</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">15. Display </span><span class="font25" style="font-weight:bold;">A B C </span><span class="font25">with two spaces between B and C.</span></p></li></ul>
<p><span class="font25">(optional)16. Complete the following command (do not use spaces) to display exactly the following output: </span><span class="font19">4 + 4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=8</span></p>
<p><span class="font19">10+14 &nbsp;&nbsp;=24</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">17. Use </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">to display the following exactly:</span></p></li></ul>
<p><span class="font19">??\\</span></p>
<p><span class="font25">Find two solutions with single quotes, two with double quotes and one without quotes (and say thank you to Rene and Darioush from Google for this extra).</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">18. Use one </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">command to display three words on three lines.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1356"></a><span class="font10" style="font-weight:bold;"><a name="bookmark113"></a><a name="bookmark1357"></a>12.10. solution: commands and arguments</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. How many </span><span class="font25" style="font-weight:bold;">arguments </span><span class="font25">are in this line (not counting the command itself).</span></p></li></ul>
<p><span class="font19">touch '/etc/cron/cron.allow' 'file 42.txt' &quot;file 33.txt&quot;</span></p>
<p><span class="font19">answer: three</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Is </span><span class="font25" style="font-weight:bold;">tac </span><span class="font25">a shell builtin command ?</span></p></li></ul>
<p><span class="font19">type tac</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Is there an existing alias for </span><span class="font25" style="font-weight:bold;">rm </span><span class="font25">?</span></p></li></ul>
<p><span class="font19">alias rm</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Read the man page of </span><span class="font25" style="font-weight:bold;">rm</span><span class="font25">, make sure you understand the </span><span class="font25" style="font-weight:bold;">-i </span><span class="font25">option of rm. Create and remove a file to test the </span><span class="font25" style="font-weight:bold;">-i </span><span class="font25">option.</span></p></li></ul>
<p><span class="font19">man rm</span></p>
<p><span class="font19">touch testfile</span></p>
<p><span class="font19">rm -i testfile</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Execute: </span><span class="font25" style="font-weight:bold;">alias rm='rm -i' </span><span class="font25">. Test your alias with a test file. Does this work as expected ? </span><span class="font19">touch testfile</span></p></li></ul>
<p><span class="font19">rm testfile (should ask for confirmation)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. List all current aliases.</span></p></li></ul>
<p><span class="font19">alias</span></p>
<p><span class="font25">7a. Create an alias called 'city' that echoes your hometown.</span></p>
<p><span class="font19">alias city='echo Antwerp'</span></p>
<p><span class="font25">7b. Use your alias to test that it works.</span></p>
<p><span class="font19">city (it should display Antwerp)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. Execute </span><span class="font25" style="font-weight:bold;">set -x </span><span class="font25">to display shell expansion for every command. </span><span class="font19">set -x</span></p></li>
<li>
<p><span class="font25">9. Test the functionality of </span><span class="font25" style="font-weight:bold;">set -x </span><span class="font25">by executing your </span><span class="font25" style="font-weight:bold;">city </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">rm </span><span class="font25">aliases.</span></p></li></ul>
<p><span class="font19">shell should display the resolved aliases and then execute the command: paul@deb503:~$ set -x paul@deb503:~$ city + echo antwerp antwerp</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">10 Execute </span><span class="font25" style="font-weight:bold;">set +x </span><span class="font25">to stop displaying shell expansion.</span></p></li></ul>
<p><span class="font19">set +x</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">11. Remove your city alias.</span></p></li></ul>
<p><span class="font19">unalias city</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">12. What is the location of the </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">and the </span><span class="font25" style="font-weight:bold;">passwd </span><span class="font25">commands ?</span></p></li></ul>
<p><span class="font19">which cat (probably /bin/cat)</span></p>
<p><span class="font19">which passwd (probably /usr/bin/passwd)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">13. Explain the difference between the following commands:</span></p></li></ul>
<p><span class="font19">echo</span></p>
<p><span class="font19">/bin/echo</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">command will be interpreted by the shell as the </span><span class="font25" style="font-weight:bold;">built-in echo </span><span class="font25">command. The </span><span class="font25" style="font-weight:bold;">/bin/ echo </span><span class="font25">command will make the shell execute the </span><span class="font25" style="font-weight:bold;">echo binary </span><span class="font25">located in the </span><span class="font25" style="font-weight:bold;">/bin </span><span class="font25">directory.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">14. Explain the difference between the following commands:</span></p></li></ul>
<p><span class="font19">echo Hello</span></p>
<p><span class="font19">echo -n Hello</span></p>
<p><span class="font25">The -n option of the </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">command will prevent echo from echoing a trailing newline. </span><span class="font25" style="font-weight:bold;">echo Hello </span><span class="font25">will echo six characters in total, </span><span class="font25" style="font-weight:bold;">echo -n hello </span><span class="font25">only echoes five characters.</span></p>
<p><span class="font25">(The -n option might not work in the Korn shell.)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">15. Display </span><span class="font25" style="font-weight:bold;">A B C </span><span class="font25">with two spaces between B and C.</span></p></li></ul>
<p><span class="font19">echo &quot;A B C&quot;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">16. Complete the following command (do not use spaces) to display exactly the following output: </span><span class="font19">4 + 4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=8</span></p></li></ul>
<p><span class="font19">10+14 &nbsp;&nbsp;=24</span></p>
<p><span class="font25">The solution is to use tabs with \t.</span></p>
<p><span class="font19">echo -e &quot;4+4\t=8&quot; ; echo -e &quot;10+14\t=24&quot;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">17. Use </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">to display the following exactly:</span></p></li></ul>
<p><span class="font19">??\\</span></p>
<p><span class="font19">echo '??\\'</span></p>
<p><span class="font19">echo -e '??\\\\' echo &quot;??\\\\&quot; echo -e &quot;??\\\\\\&quot; echo ??\\\\</span></p>
<p><span class="font25">Find two solutions with single quotes, two with double quotes and one without quotes (and say thank you to Rene and Darioush from Google for this extra).</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">18. Use one </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">command to display three words on three lines.</span></p></li></ul>
<p><span class="font19">echo -e &quot;one \ntwo \nthree&quot;</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark1358"></a><span class="font11" style="font-weight:bold;"><a name="bookmark114"></a><a name="bookmark1359"></a>Chapter 13. control operators</span></h1></li></ul>
<p><span class="font25">In this chapter we put more than one command on the command line using </span><span class="font25" style="font-weight:bold;">control operators</span><span class="font25">. We also briefly discuss related parameters ($?) and similar special characters(&amp;).</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1360"></a><span class="font10" style="font-weight:bold;"><a name="bookmark115"></a><a name="bookmark1361"></a>13.1. ; semicolon</span></h2></li></ul>
<p><a name="bookmark1362"></a><span class="font25">You can put two or more commands on the same line separated by a semicolon </span><span class="font25" style="font-weight:bold;">; </span><span class="font25">. The shell will scan the line until it reaches the semicolon. All the arguments before this semicolon will be considered a separate command from all the arguments after the semicolon. Both series will be executed sequentially with the shell waiting for each command to finish before starting the next one.</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo Hello</span></p>
<p><span class="font19">Hello</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo World</span></p>
<p><span class="font19">World</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo Hello ; echo World</span></p>
<p><span class="font19">Hello</span></p>
<p><span class="font19">World</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1363"></a><span class="font10" style="font-weight:bold;"><a name="bookmark116"></a><a name="bookmark1364"></a>13.2. &amp;&nbsp;ampersand</span></h2></li></ul>
<p><a name="bookmark1365"></a><span class="font25">When a line ends with an ampersand </span><span class="font25" style="font-weight:bold;">&amp;</span><span class="font25">, the shell will not wait for the command to finish. You will get your shell prompt back, and the command is executed in background. You will get a message when this command has finished executing in background.</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ sleep 20 &amp;&nbsp;[1] 7925 [paul@RHELv4u3 ~]$ ...wait 20 seconds... [paul@RHELv4u3 ~]$</span></p>
<p><span class="font19">[1]+ Done &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep 20</span></p>
<p><span class="font25">The technical explanation of what happens in this case is explained in the chapter about </span><span class="font25" style="font-weight:bold;">processes</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1366"></a><span class="font10" style="font-weight:bold;"><a name="bookmark117"></a><a name="bookmark1367"></a>13.3. $? dollar question mark</span></h2></li></ul>
<p><a name="bookmark1368"></a><span class="font25">The exit code of the previous command is stored in the shell variable </span><span class="font25" style="font-weight:bold;">$?</span><span class="font25">. Actually </span><span class="font25" style="font-weight:bold;">$? </span><span class="font25">is a shell parameter and not a variable, since you cannot assign a value to </span><span class="font25" style="font-weight:bold;">$?</span><span class="font25">.</span></p>
<p><span class="font19">paul@debian5:~/test$ touch file1 paul@debian5:~/test$ echo $? 0</span></p>
<p><span class="font19">paul@debian5:~/test$ rm file1</span></p>
<p><span class="font19">paul@debian5:~/test$ echo $? 0</span></p>
<p><span class="font19">paul@debian5:~/test$ rm filel</span></p>
<p><span class="font19">rm: cannot remove 'filel': No such file or directory paul@debian5:~/test$ echo $?</span></p>
<p><span class="font19">1</span></p>
<p><span class="font19">paul@debian5:~/test$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1369"></a><span class="font10" style="font-weight:bold;"><a name="bookmark118"></a><a name="bookmark1370"></a>13.4. &amp;&amp;&nbsp;double ampersand</span></h2></li></ul>
<h4><a name="bookmark1371"></a><span class="font25"><a name="bookmark1372"></a><a name="bookmark1373"></a>The shell will interpret </span><span class="font25" style="font-weight:bold;">&amp;&amp;&nbsp;</span><span class="font25">as a </span><span class="font25" style="font-weight:bold;">logical AND</span><span class="font25">. When using </span><span class="font25" style="font-weight:bold;">&amp;&amp;&nbsp;</span><span class="font25">the second command is executed only if the first one succeeds (returns a zero exit status).</span></h4>
<p><span class="font19">paul@barry:~$ echo first &amp;&amp;&nbsp;echo second first second</span></p>
<p><span class="font19">paul@barry:~$ zecho first &amp;&amp;&nbsp;echo second</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-bash: zecho: command not found</span></p></li></ul>
<h4><a name="bookmark1374"></a><span class="font25"><a name="bookmark1375"></a><a name="bookmark1376"></a>Another example of the same </span><span class="font25" style="font-weight:bold;">logical AND </span><span class="font25">principle. This example starts with a working </span><span class="font25" style="font-weight:bold;">cd </span><span class="font25">followed by </span><span class="font25" style="font-weight:bold;">ls</span><span class="font25">, then a non-working </span><span class="font25" style="font-weight:bold;">cd </span><span class="font25">which is </span><span class="font25" style="font-weight:bold;">not </span><span class="font25">followed by </span><span class="font25" style="font-weight:bold;">ls</span><span class="font25">.</span></h4>
<p><span class="font19">[paul@RHELv4u3 ~]$ cd gen &amp;&amp;&nbsp;ls</span></p>
<p><span class="font19">filel &nbsp;file3 &nbsp;File55 &nbsp;fileab &nbsp;FileAB &nbsp;&nbsp;fileabc</span></p>
<p><span class="font19">file2 &nbsp;File4 &nbsp;FileA &nbsp;&nbsp;Fileab &nbsp;fileab2</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ cd gen &amp;&amp;&nbsp;ls</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-bash: cd: gen: No such file or directory</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1377"></a><span class="font10" style="font-weight:bold;"><a name="bookmark119"></a><a name="bookmark1378"></a>13.5. || double vertical bar</span></h2></li></ul>
<h4><a name="bookmark1379"></a><span class="font25"><a name="bookmark1380"></a><a name="bookmark1381"></a>The </span><span class="font25" style="font-weight:bold;">|| </span><span class="font25">represents a </span><span class="font25" style="font-weight:bold;">logical OR</span><span class="font25">. The second command is executed only when the first command fails (returns a non-zero exit status).</span></h4>
<p><span class="font19">paul@barry:~$ echo first || echo second ; echo third first third</span></p>
<p><span class="font19">paul@barry:~$ zecho first || echo second ; echo third</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-bash: zecho: command not found second</span></p></li></ul>
<p><span class="font19">third</span></p>
<p><span class="font19">paul@barry:~$</span></p>
<h4><a name="bookmark1382"></a><span class="font25"><a name="bookmark1383"></a><a name="bookmark1384"></a>Another example of the same </span><span class="font25" style="font-weight:bold;">logical OR </span><span class="font25">principle.</span></h4>
<p><span class="font19">[paul@RHELv4u3 ~]$ cd gen || ls</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ cd gen || ls</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-bash: cd: gen: No such file or directory</span></p></li></ul>
<p><span class="font19">filel &nbsp;file3 &nbsp;File55 &nbsp;fileab &nbsp;FileAB &nbsp;&nbsp;fileabc</span></p>
<p><span class="font19">file2 &nbsp;File4 &nbsp;FileA &nbsp;&nbsp;Fileab &nbsp;fileab2</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1385"></a><span class="font10" style="font-weight:bold;"><a name="bookmark120"></a><a name="bookmark1386"></a>13.6. combining &amp;&amp;&nbsp;and ||</span></h2></li></ul>
<h4><a name="bookmark1387"></a><span class="font25"><a name="bookmark1388"></a>You can use this logical AND and logical OR to write an </span><span class="font25" style="font-weight:bold;">if-then-else </span><span class="font25">structure on the command line. This example uses </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">to display whether the </span><span class="font25" style="font-weight:bold;">rm </span><span class="font25">command was successful.</span></h4>
<p><span class="font19">paul@laika:~/test$ rm filel &amp;&amp;&nbsp;echo It worked! || echo It failed! It worked!</span></p>
<p><span class="font19">paul@laika:~/test$ rm filel &amp;&amp;&nbsp;echo It worked! || echo It failed!</span></p>
<p><span class="font19">rm: cannot remove 'filel': No such file or directory It failed!</span></p>
<p><span class="font19">paul@laika:~/test$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1389"></a><span class="font10" style="font-weight:bold;"><a name="bookmark121"></a><a name="bookmark1390"></a>13.7. # pound sign</span></h2></li></ul>
<p><a name="bookmark1391"></a><span class="font25"><a name="bookmark1392"></a>Everything written after a </span><span class="font25" style="font-weight:bold;">pound sign </span><span class="font25">(#) is ignored by the shell. This is useful to write a </span><span class="font25" style="font-weight:bold;">shell comment</span><span class="font25">, but has no influence on the command execution or shell expansion.</span></p>
<p><span class="font19">paul@debian4:~$ mkdir test &nbsp;&nbsp;&nbsp;# we create a directory</span></p>
<p><span class="font19">paul@debian4:~$ cd test &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#### we enter the directory</span></p>
<p><span class="font19">paul@debian4:~/test$ ls &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# is it empty ?</span></p>
<p><span class="font19">paul@debian4:~/test$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1393"></a><span class="font10" style="font-weight:bold;"><a name="bookmark122"></a><a name="bookmark1394"></a>13.8. \ escaping special characters</span></h2></li></ul>
<p><a name="bookmark1395"></a><span class="font25"><a name="bookmark1396"></a>The backslash </span><span class="font25" style="font-weight:bold;">\ </span><span class="font25">character enables the use of control characters, but without the shell interpreting it, this is called </span><span class="font25" style="font-weight:bold;">escaping </span><span class="font25">characters.</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo hello \; world hello ; world</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo hello\ \ \ world</span></p>
<p><span class="font19">hello world</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo escaping \\\ \#\ \&amp;\ \&quot;\ \' escaping \ # &amp;&nbsp;&quot;&nbsp;'</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo escaping \\\?\*\&quot;\' escaping \?*&quot;'</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1397"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1398"></a>13.8.1. end of line backslash</span></h3></li></ul>
<p><span class="font25">Lines ending in a backslash are continued on the next line. The shell does not interpret the newline character and will wait on shell expansion and execution of the command line until a newline without backslash is encountered.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo This command line \</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">&gt; is split in three \ &gt;&nbsp;parts</span></p></li></ul>
<p><span class="font19">This command line is split in three parts</span></p>
<p><span class="font19">[paul@RHEL4b ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1399"></a><span class="font10" style="font-weight:bold;"><a name="bookmark123"></a><a name="bookmark1400"></a>13.9. practice: control operators</span></h2></li></ul>
<p><span class="font25">0. Each question can be answered by one command line!</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">1. When you type </span><span class="font25" style="font-weight:bold;">passwd</span><span class="font25">, which file is executed ?</span></p></li>
<li>
<p><span class="font25">2. What kind of file is that ?</span></p></li>
<li>
<p><span class="font25">3. Execute the </span><span class="font25" style="font-weight:bold;">pwd </span><span class="font25">command twice. (remember 0.)</span></p></li>
<li>
<p><span class="font25">4. Execute </span><span class="font25" style="font-weight:bold;">ls </span><span class="font25">after </span><span class="font25" style="font-weight:bold;">cd /etc</span><span class="font25">, but only if </span><span class="font25" style="font-weight:bold;">cd /etc </span><span class="font25">did not error.</span></p></li>
<li>
<p><span class="font25">5. Execute </span><span class="font25" style="font-weight:bold;">cd /etc </span><span class="font25">after </span><span class="font25" style="font-weight:bold;">cd etc</span><span class="font25">, but only if </span><span class="font25" style="font-weight:bold;">cd etc </span><span class="font25">fails.</span></p></li>
<li>
<p><span class="font25">6. Echo </span><span class="font25" style="font-weight:bold;">it worked </span><span class="font25">when </span><span class="font25" style="font-weight:bold;">touch test42 </span><span class="font25">works, and echo </span><span class="font25" style="font-weight:bold;">it failed </span><span class="font25">when the </span><span class="font25" style="font-weight:bold;">touch </span><span class="font25">failed. All on one command line as a normal user (not root). Test this line in your home directory and in </span><span class="font25" style="font-weight:bold;">/bin/ </span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">7. Execute </span><span class="font25" style="font-weight:bold;">sleep 6</span><span class="font25">, what is this command doing ?</span></p></li>
<li>
<p><span class="font25">8. Execute </span><span class="font25" style="font-weight:bold;">sleep 200 </span><span class="font25">in background (do not wait for it to finish).</span></p></li>
<li>
<p><span class="font25">9. Write a command line that executes </span><span class="font25" style="font-weight:bold;">rm file55</span><span class="font25">. Your command line should print 'success' if file55 is removed, and print 'failed' if there was a problem.</span></p></li></ul>
<p><span class="font25">(optional)10. Use echo to display &quot;Hello World with strange' characters \ * [ } ~ \ \ .&quot; (including all quotes)</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1401"></a><span class="font10" style="font-weight:bold;"><a name="bookmark124"></a><a name="bookmark1402"></a>13.10. solution: control operators</span></h2></li></ul>
<p><span class="font25">0. Each question can be answered by one command line!</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">1. When you type </span><span class="font25" style="font-weight:bold;">passwd</span><span class="font25">, which file is executed ?</span></p></li></ul>
<p><span class="font19">which passwd</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. What kind of file is that ?</span></p></li></ul>
<p><span class="font19">file /usr/bin/passwd</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Execute the </span><span class="font25" style="font-weight:bold;">pwd </span><span class="font25">command twice. (remember 0.)</span></p></li></ul>
<p><span class="font19">pwd ; pwd</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Execute </span><span class="font25" style="font-weight:bold;">ls </span><span class="font25">after </span><span class="font25" style="font-weight:bold;">cd /etc</span><span class="font25">, but only if </span><span class="font25" style="font-weight:bold;">cd /etc </span><span class="font25">did not error.</span></p></li></ul>
<p><span class="font19">cd /etc &amp;&amp;&nbsp;ls</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Execute </span><span class="font25" style="font-weight:bold;">cd /etc </span><span class="font25">after </span><span class="font25" style="font-weight:bold;">cd etc</span><span class="font25">, but only if </span><span class="font25" style="font-weight:bold;">cd etc </span><span class="font25">fails.</span></p></li></ul>
<p><span class="font19">cd etc || cd /etc</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Echo </span><span class="font25" style="font-weight:bold;">it worked </span><span class="font25">when </span><span class="font25" style="font-weight:bold;">touch test42 </span><span class="font25">works, and echo </span><span class="font25" style="font-weight:bold;">it failed </span><span class="font25">when the </span><span class="font25" style="font-weight:bold;">touch </span><span class="font25">failed. All on one command line as a normal user (not root). Test this line in your home directory and in </span><span class="font25" style="font-weight:bold;">/bin/ </span><span class="font25">.</span></p></li></ul>
<p><span class="font19">paul@deb503:~$ cd ; touch test42 &amp;&amp;&nbsp;echo it worked || echo it failed</span></p>
<p><span class="font19">it worked</span></p>
<p><span class="font19">paul@deb503:~$ cd /bin; touch test42 &amp;&amp;&nbsp;echo it worked || echo it failed</span></p>
<p><span class="font19">touch: cannot touch 'test42': Permission denied it failed</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. Execute </span><span class="font25" style="font-weight:bold;">sleep 6</span><span class="font25">, what is this command doing ?</span></p></li></ul>
<p><span class="font19">pausing for six seconds</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. Execute </span><span class="font25" style="font-weight:bold;">sleep 200 </span><span class="font25">in background (do not wait for it to finish).</span></p></li></ul>
<p><span class="font19">sleep 200 &amp;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">9. Write a command line that executes </span><span class="font25" style="font-weight:bold;">rm file55</span><span class="font25">. Your command line should print 'success' if file55 is removed, and print 'failed' if there was a problem.</span></p></li></ul>
<p><span class="font19">rm file55 &amp;&amp;&nbsp;echo success || echo failed</span></p>
<p><span class="font25">(optional)10. Use echo to display &quot;Hello World with strange' characters \ * [ } ~ \ \ .&quot; (including all quotes)</span></p>
<p><span class="font19">echo \&quot;Hello World with strange\' characters \\ \* \[ \} \~ \\\\ \. \&quot;</span></p>
<p><span class="font19">or</span></p>
<p><span class="font19">echo \&quot;&quot;Hello World with strange' characters \ * [ } ~ \\ . &quot;\&quot;</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark1403"></a><span class="font11" style="font-weight:bold;"><a name="bookmark125"></a><a name="bookmark1404"></a>Chapter 14. shell variables</span></h1></li></ul>
<p><span class="font25">In this chapter we learn to manage environment </span><span class="font25" style="font-weight:bold;">variables </span><span class="font25">in the shell. These </span><span class="font25" style="font-weight:bold;">variables </span><span class="font25">are often needed by applications.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1405"></a><span class="font10" style="font-weight:bold;"><a name="bookmark126"></a><a name="bookmark1406"></a>14.1. $ dollar sign</span></h2></li></ul>
<p><a name="bookmark1407"></a><span class="font25"><a name="bookmark1408"></a>Another important character interpreted by the shell is the dollar sign </span><span class="font25" style="font-weight:bold;">$</span><span class="font25">. The shell will look for an </span><span class="font25" style="font-weight:bold;">environment variable </span><span class="font25">named like the string following the </span><span class="font25" style="font-weight:bold;">dollar sign </span><span class="font25">and replace it with the value of the variable (or with nothing if the variable does not exist).</span></p>
<p><span class="font25">These are some examples using $HOSTNAME, $USER, $UID, $SHELL, and $HOME.</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo This is the $SHELL shell</span></p>
<p><span class="font19">This is the /bin/bash shell</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo This is $SHELL on computer $HOSTNAME</span></p>
<p><span class="font19">This is /bin/bash on computer RHELv4u3.localdomain</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo The userid of $USER is $UID</span></p>
<p><span class="font19">The userid of paul is 500</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo My homedir is $HOME</span></p>
<p><span class="font19">My homedir is /home/paul</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1409"></a><span class="font10" style="font-weight:bold;"><a name="bookmark127"></a><a name="bookmark1410"></a>14.2. case sensitive</span></h2></li></ul>
<p><span class="font25">This example shows that shell variables are case sensitive!</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo Hello $USER</span></p>
<p><span class="font19">Hello paul</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo Hello $user</span></p>
<p><span class="font19">Hello</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1411"></a><span class="font10" style="font-weight:bold;"><a name="bookmark128"></a><a name="bookmark1412"></a>14.3. creating variables</span></h2></li></ul>
<p><span class="font25">This example creates the variable </span><span class="font25" style="font-weight:bold;">$MyVar </span><span class="font25">and sets its value. It then uses </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">to verify the value.</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ MyVar=555</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ echo $MyVar</span></p>
<p><span class="font19">555</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1413"></a><span class="font10" style="font-weight:bold;"><a name="bookmark129"></a><a name="bookmark1414"></a>14.4. quotes</span></h2></li></ul>
<p><span class="font25">Notice that double quotes still allow the parsing of variables, whereas single quotes prevent this.</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ MyVar=555</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo $MyVar</span></p>
<p><span class="font19">555</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo &quot;$MyVar&quot;</span></p>
<p><span class="font19">555</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo '$MyVar'</span></p>
<p><span class="font19">$MyVar</span></p>
<p><span class="font25">The bash shell will replace variables with their value in double quoted lines, but not in single quoted lines.</span></p>
<p><span class="font19">paul@laika:~$ city=Burtonville paul@laika:~$ echo &quot;We are in $city today.&quot; We are in Burtonville today.</span></p>
<p><span class="font19">paul@laika:~$ echo 'We are in $city today.' We are in $city today.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1415"></a><span class="font10" style="font-weight:bold;"><a name="bookmark130"></a><a name="bookmark1416"></a>14.5. set</span></h2></li></ul>
<p><a name="bookmark1417"></a><span class="font25">You can use the </span><span class="font25" style="font-weight:bold;">set </span><span class="font25">command to display a list of environment variables. On Ubuntu and Debian systems, the </span><span class="font25" style="font-weight:bold;">set </span><span class="font25">command will also list shell functions after the shell variables. Use </span><span class="font25" style="font-weight:bold;">set | more </span><span class="font25">to see the variables then.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1418"></a><span class="font10" style="font-weight:bold;"><a name="bookmark131"></a><a name="bookmark1419"></a>14.6. unset</span></h2></li></ul>
<p><a name="bookmark1420"></a><span class="font25">Use the </span><span class="font25" style="font-weight:bold;">unset </span><span class="font25">command to remove a variable from your shell environment.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ MyVar=8472 [paul@RHEL4b ~]$ echo $MyVar 8472</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ unset MyVar</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo $MyVar</span></p>
<p><span class="font19">[paul@RHEL4b ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1421"></a><span class="font10" style="font-weight:bold;"><a name="bookmark132"></a><a name="bookmark1422"></a>14.7. $PS1</span></h2></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">$PS1 </span><span class="font25">variable determines your shell prompt. You can use backslash escaped special characters like </span><span class="font25" style="font-weight:bold;">\u </span><span class="font25">for the username or </span><span class="font25" style="font-weight:bold;">\w </span><span class="font25">for the working directory. The </span><span class="font25" style="font-weight:bold;">bash </span><span class="font25">manual has a complete reference.</span></p>
<p><span class="font25">In this example we change the value of </span><span class="font25" style="font-weight:bold;">$PS1 </span><span class="font25">a couple of times.</span></p>
<p><span class="font19">paul@deb503:~$ PS1=prompt</span></p>
<p><span class="font19">prompt</span></p>
<p><span class="font19">promptPS1='prompt '</span></p>
<p><span class="font19">prompt</span></p>
<p><span class="font19">prompt PS1='&gt; '</span></p>
<p><span class="font19">&gt;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">&gt; PS1='\u@\h$ '</span></p></li></ul>
<p><span class="font19">paul@deb503$</span></p>
<p><span class="font19">paul@deb503$ PS1='\u@\h:\W$'</span></p>
<p><span class="font19">paul@deb503:~$</span></p>
<p><span class="font25">To avoid unrecoverable mistakes, you can set normal user prompts to green and the root prompt to red. Add the following to your </span><span class="font25" style="font-weight:bold;">.bashrc </span><span class="font25">for a green user prompt:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># color prompt by paul</span></p></li></ul>
<p><span class="font19">RED='\[\033[01;31m\]'</span></p>
<p><span class="font19">WHITE='\[\033[01;00m\]'</span></p>
<p><span class="font19">GREEN='\[\033[01;32m\]'</span></p>
<p><span class="font19">BLUE='\[\033[01;34m\]'</span></p>
<p><span class="font19">export PS1=&quot;${debian_chroot:+($debian_chroot)}$GREEN\u$WHITE@$BLUE\h$WHITE\w\$ &quot;</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1423"></a><span class="font10" style="font-weight:bold;"><a name="bookmark133"></a><a name="bookmark1424"></a>14.8. $PATH</span></h2></li></ul>
<p><a name="bookmark1425"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">$PATH </span><span class="font25">variable is determines where the shell is looking for commands to execute (unless the command is builtin or aliased). This variable contains a list of directories, separated by colons.</span></p>
<p><span class="font19">[[paul@RHEL4b ~]$ echo $PATH /usr/kerberos/bin:/usr/local/bin:/bin:/usr/bin:</span></p>
<p><span class="font25">The shell will not look in the current directory for commands to execute! (Looking for executables in the current directory provided an easy way to hack PC-DOS computers). If you want the shell to look in the current directory, then add a . at the end of your $PATH.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ PATH=$PATH:.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo $PATH</span></p>
<p><span class="font19">/usr/kerberos/bin:/usr/local/bin:/bin:/usr/bin:. [paul@RHEL4b ~]$</span></p>
<p><a name="bookmark1426"></a><span class="font25">Your path might be different when using su instead of </span><span class="font25" style="font-weight:bold;">su - </span><span class="font25">because the latter will take on the environment of the target user. The root user typically has </span><span class="font25" style="font-weight:bold;">/sbin </span><span class="font25">directories added to the $PATH variable. </span><span class="font19">[paul@RHEL3 ~]$ su</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">[root@RHEL3 paul]# echo $PATH</span></p>
<p><span class="font19">/usr/local/bin:/bin:/usr/bin:/usr/X11R6/bin</span></p>
<p><span class="font19">[root@RHEL3 paul]# exit</span></p>
<p><span class="font19">[paul@RHEL3 ~]$ su -</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">[root@RHEL3 ~]# echo $PATH</span></p>
<p><span class="font19">/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin: [root@RHEL3 ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1427"></a><span class="font10" style="font-weight:bold;"><a name="bookmark134"></a><a name="bookmark1428"></a>14.9. env</span></h2></li></ul>
<p><a name="bookmark1429"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">env </span><span class="font25">command without options will display a list of </span><span class="font25" style="font-weight:bold;">exported variables</span><span class="font25">. The difference with </span><span class="font25" style="font-weight:bold;">set </span><span class="font25">with options is that </span><span class="font25" style="font-weight:bold;">set </span><span class="font25">lists all variables, including those not exported to child shells.</span></p>
<p><a name="bookmark1430"></a><span class="font25">But </span><span class="font25" style="font-weight:bold;">env </span><span class="font25">can also be used to start a clean shell (a shell without any inherited environment). The </span><span class="font25" style="font-weight:bold;">env -i </span><span class="font25">command clears the environment for the subshell.</span></p>
<p><span class="font25">Notice in this screenshot that </span><span class="font25" style="font-weight:bold;">bash </span><span class="font25">will set the </span><span class="font25" style="font-weight:bold;">$SHELL </span><span class="font25">variable on startup.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ bash -c 'echo $SHELL $HOME $USER'</span></p>
<p><span class="font19">/bin/bash /home/paul paul</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ env -i bash -c 'echo $SHELL $HOME $USER'</span></p>
<p><span class="font19">/bin/bash</span></p>
<p><span class="font19">[paul@RHEL4b ~]$</span></p>
<p><span class="font25">You can use the </span><span class="font25" style="font-weight:bold;">env </span><span class="font25">command to set the </span><span class="font25" style="font-weight:bold;">$LANG</span><span class="font25">, or any other, variable for just one instance of </span><span class="font25" style="font-weight:bold;">bash </span><span class="font25">with one command. The example below uses this to show the influence of the </span><span class="font25" style="font-weight:bold;">$LANG </span><span class="font25">variable on file globbing (see the chapter on file globbing).</span></p>
<p><span class="font19">[paul@RHEL4b test]$ env LANG=C bash -c 'ls File[a-z]' Filea Fileb</span></p>
<p><span class="font19">[paul@RHEL4b test]$ env LANG=en_US.UTF-8 bash -c 'ls File[a-z] Filea FileA Fileb FileB [paul@RHEL4b test]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1431"></a><span class="font10" style="font-weight:bold;"><a name="bookmark135"></a><a name="bookmark1432"></a>14.10. export</span></h2></li></ul>
<p><a name="bookmark1433"></a><span class="font25">You can export shell variables to other shells with the </span><span class="font25" style="font-weight:bold;">export </span><span class="font25">command. This will export the variable to child shells.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ var3=three</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ var4=four</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ export var4</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo $var3 $var4 three four</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ bash</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo $var3 $var4 four</span></p>
<p><span class="font25">But it will not export to the parent shell (previous screenshot continued).</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ export var5=five [paul@RHEL4b ~]$ echo $var3 $var4 $var5 four five</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ exit</span></p>
<p><span class="font19">exit</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo $var3 $var4 $var5 three four</span></p>
<p><span class="font19">[paul@RHEL4b ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1434"></a><span class="font10" style="font-weight:bold;"><a name="bookmark136"></a><a name="bookmark1435"></a>14.11. delineate variables</span></h2></li></ul>
<p><span class="font25">Until now, we have seen that bash interprets a variable starting from a dollar sign, continuing until the first occurrence of a non-alphanumeric character that is not an underscore. In some situations, this can be a problem. This issue can be resolved with curly braces like in this example.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ prefix=Super</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo Hello $prefixman and $prefixgirl</span></p>
<p><span class="font19">Hello and</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo Hello ${prefix}man and ${prefix}girl</span></p>
<p><span class="font19">Hello Superman and Supergirl</span></p>
<p><span class="font19">[paul@RHEL4b ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1436"></a><span class="font10" style="font-weight:bold;"><a name="bookmark137"></a><a name="bookmark1437"></a>14.12. unbound variables</span></h2></li></ul>
<p><span class="font25">The example below tries to display the value of the </span><span class="font25" style="font-weight:bold;">$MyVar </span><span class="font25">variable, but it fails because the variable does not exist. By default the shell will display nothing when a variable is unbound (does not exist).</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ echo $MyVar</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$</span></p>
<p><a name="bookmark1438"></a><span class="font25">There is, however, the </span><span class="font25" style="font-weight:bold;">nounset </span><span class="font25">shell option that you can use to generate an error when a variable does not exist.</span></p>
<p><span class="font19">paul@laika:~$ set -u</span></p>
<p><span class="font19">paul@laika:~$ echo $Myvar</span></p>
<p><span class="font19">bash: Myvar: unbound variable</span></p>
<p><span class="font19">paul@laika:~$ set +u</span></p>
<p><span class="font19">paul@laika:~$ echo $Myvar</span></p>
<p><span class="font19">paul@laika:~$</span></p>
<p><span class="font25">In the bash shell </span><span class="font25" style="font-weight:bold;">set -u </span><span class="font25">is identical to </span><span class="font25" style="font-weight:bold;">set -o nounset </span><span class="font25">and likewise </span><span class="font25" style="font-weight:bold;">set +u </span><span class="font25">is identical to </span><span class="font25" style="font-weight:bold;">set +o nounset</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1439"></a><span class="font10" style="font-weight:bold;"><a name="bookmark138"></a><a name="bookmark1440"></a>14.13. practice: shell variables</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Use echo to display Hello followed by your username. (use a bash variable!)</span></p></li>
<li>
<p><span class="font25">2. Create a variable </span><span class="font25" style="font-weight:bold;">answer </span><span class="font25">with a value of </span><span class="font25" style="font-weight:bold;">42</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">3. Copy the value of $LANG to $MyLANG.</span></p></li>
<li>
<p><span class="font25">4. List all current shell variables.</span></p></li>
<li>
<p><span class="font25">5. List all exported shell variables.</span></p></li>
<li>
<p><span class="font25">6. Do the </span><span class="font25" style="font-weight:bold;">env </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">set </span><span class="font25">commands display your variable ?</span></p></li>
<li>
<p><span class="font25">6. Destroy your </span><span class="font25" style="font-weight:bold;">answer </span><span class="font25">variable.</span></p></li>
<li>
<p><span class="font25">7. Create two variables, and </span><span class="font25" style="font-weight:bold;">export </span><span class="font25">one of them.</span></p></li>
<li>
<p><span class="font25">8. Display the exported variable in an interactive child shell.</span></p></li>
<li>
<p><span class="font25">9. Create a variable, give it the value 'Dumb', create another variable with value 'do'. Use </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">and the two variables to echo Dumbledore.</span></p></li>
<li>
<p><span class="font25">10. Find the list of backslash escaped characters in the manual of bash. Add the time to your </span><span class="font25" style="font-weight:bold;">PS1 </span><span class="font25">prompt.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1441"></a><span class="font10" style="font-weight:bold;"><a name="bookmark139"></a><a name="bookmark1442"></a>14.14. solution: shell variables</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Use echo to display Hello followed by your username. (use a bash variable!)</span></p></li></ul>
<p><span class="font19">echo Hello $USER</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Create a variable </span><span class="font25" style="font-weight:bold;">answer </span><span class="font25">with a value of </span><span class="font25" style="font-weight:bold;">42</span><span class="font25">.</span></p></li></ul>
<p><span class="font19">answer=42</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Copy the value of $LANG to $MyLANG.</span></p></li></ul>
<p><span class="font19">MyLANG=$LANG</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. List all current shell variables.</span></p></li></ul>
<p><span class="font19">set</span></p>
<p><span class="font19">set|more on Ubuntu/Debian</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. List all exported shell variables.</span></p></li></ul>
<p><span class="font19">env</span></p>
<p><span class="font19">export declare -x</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Do the </span><span class="font25" style="font-weight:bold;">env </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">set </span><span class="font25">commands display your variable ?</span></p></li></ul>
<p><span class="font19">env | more set | more</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Destroy your </span><span class="font25" style="font-weight:bold;">answer </span><span class="font25">variable.</span></p></li></ul>
<p><span class="font19">unset answer</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. Create two variables, and </span><span class="font25" style="font-weight:bold;">export </span><span class="font25">one of them.</span></p></li></ul>
<p><span class="font19">var1=1; export var2=2</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. Display the exported variable in an interactive child shell.</span></p></li></ul>
<p><span class="font19">bash</span></p>
<p><span class="font19">echo $var2</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">9. Create a variable, give it the value 'Dumb', create another variable with value 'do'. Use </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">and the two variables to echo Dumbledore.</span></p></li></ul>
<p><span class="font19">varx=Dumb; vary=do</span></p>
<p><span class="font19">echo ${varx}le${vary}re</span></p>
<p><span class="font19">solution by Yves from Dexia : echo $varx'le'$vary're'</span></p>
<p><span class="font19">solution by Erwin from Telenet : echo &quot;$varx&quot;le&quot;$vary&quot;re</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">10. Find the list of backslash escaped characters in the manual of bash. Add the time to your</span></p></li></ul>
<p><span class="font25" style="font-weight:bold;">PS1 </span><span class="font25">prompt.</span></p>
<p><span class="font19">PS1='\t \u@\h \W$ '</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark1443"></a><span class="font11" style="font-weight:bold;"><a name="bookmark140"></a><a name="bookmark1444"></a>Chapter 15. shell embedding and options</span></h1></li></ul>
<p><span class="font25">This chapter takes a brief look at </span><span class="font25" style="font-weight:bold;">child shells</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">embedded shells </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">shell options</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1445"></a><span class="font10" style="font-weight:bold;"><a name="bookmark141"></a><a name="bookmark1446"></a>15.1. shell embedding</span></h2></li></ul>
<p><a name="bookmark1447"></a><span class="font25">Shells can be </span><span class="font25" style="font-weight:bold;">embedded </span><span class="font25">on the command line, or in other words, the command line scan can spawn new processes containing a fork of the current shell. You can use variables to prove that new shells are created. In the screenshot below, the variable $var1 only exists in the (temporary) sub shell.</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$</span></p>
<div>
<p><span class="font19">echo $var1</span></p>
<p><span class="font19">echo $(var1=5;echo $var1)</span></p>
<p><span class="font19">echo $var1</span></p>
</div><br clear="all">
<p><span class="font19">[paul@RHELv4u3 gen]$</span></p>
<p><span class="font19">5</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$</span></p>
<p><a name="bookmark1448"></a><span class="font25">You can embed a shell in an </span><span class="font25" style="font-weight:bold;">embedded shell</span><span class="font25">, this is called </span><span class="font25" style="font-weight:bold;">nested embedding </span><span class="font25">of shells.</span></p>
<p><span class="font25">This screenshot shows an embedded shell inside an embedded shell.</span></p>
<p><span class="font19">paul@deb503:~$ A=shell paul@deb503:~$ echo $C$B$A $(B=sub;echo $C$B$A; echo $(C=sub;echo $C$B$A)) shell subshell subsubshell</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1449"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1450"></a>15.1.1. backticks</span></h3></li></ul>
<p><span class="font25">Single embedding can be useful to avoid changing your current directory. The screenshot below uses </span><span class="font25" style="font-weight:bold;">backticks </span><span class="font25">instead of dollar-bracket to embed.</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo 'cd /etc; ls -d * | grep pass'</span></p>
<p><span class="font19">passwd passwd- passwd.OLD [paul@RHELv4u3 ~]$</span></p>
<p><a name="bookmark1451"></a><span class="font25">You can only use the </span><span class="font25" style="font-weight:bold;">$() </span><span class="font25">notation to nest embedded shells, </span><span class="font25" style="font-weight:bold;">backticks </span><span class="font25">cannot do this.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1452"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1453"></a>15.1.2. backticks or single quotes</span></h3></li></ul>
<p><a name="bookmark1454"></a><span class="font25"><a name="bookmark1455"></a><a name="bookmark1456"></a>Placing the embedding between </span><span class="font25" style="font-weight:bold;">backticks </span><span class="font25">uses one character less than the dollar and parenthesis combo. Be careful however, backticks are often confused with single quotes. The technical difference between </span><span class="font25" style="font-weight:bold;">' </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">' </span><span class="font25">is significant!</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ echo 'var1=5;echo $var1' 5</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ echo 'var1=5;echo $var1'</span></p>
<p><span class="font19">var1=5;echo $var1</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1457"></a><span class="font10" style="font-weight:bold;"><a name="bookmark142"></a><a name="bookmark1458"></a>15.2. shell options</span></h2></li></ul>
<p><a name="bookmark1459"></a><span class="font25"><a name="bookmark1460"></a>Both </span><span class="font25" style="font-weight:bold;">set </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">unset </span><span class="font25">are builtin shell commands. They can be used to set options of the bash shell itself. The next example will clarify this. By default, the shell will treat unset variables as a variable having no value. By setting the -u option, the shell will treat any reference to unset variables as an error. See the man page of bash for more information.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo $var123</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ set -u [paul@RHEL4b ~]$ echo $var123 -bash: var123: unbound variable [paul@RHEL4b ~]$ set +u [paul@RHEL4b ~]$ echo $var123</span></p>
<p><span class="font19">[paul@RHEL4b ~]$</span></p>
<p><a name="bookmark1461"></a><span class="font25">To list all the set options for your shell, use </span><span class="font25" style="font-weight:bold;">echo $-</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">noclobber </span><span class="font25">(or </span><span class="font25" style="font-weight:bold;">-C</span><span class="font25">) option will be explained later in this book (in the I/O redirection chapter).</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo $-</span></p>
<p><span class="font19">himBH</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ set -C ; set -u</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo $-</span></p>
<p><span class="font19">himuBCH</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ set +C ; set +u</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo $-</span></p>
<p><span class="font19">himBH</span></p>
<p><span class="font19">[paul@RHEL4b ~]$</span></p>
<p><span class="font25">When typing </span><span class="font25" style="font-weight:bold;">set </span><span class="font25">without options, you get a list of all variables without function when the shell is on </span><span class="font25" style="font-weight:bold;">posix </span><span class="font25">mode. You can set bash in posix mode typing </span><span class="font25" style="font-weight:bold;">set -o posix</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1462"></a><span class="font10" style="font-weight:bold;"><a name="bookmark143"></a><a name="bookmark1463"></a>15.3. practice: shell embedding</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Find the list of shell options in the man page of </span><span class="font25" style="font-weight:bold;">bash</span><span class="font25">. What is the difference between </span><span class="font25" style="font-weight:bold;">set -u </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">set -o nounset</span><span class="font25">?</span></p></li>
<li>
<p><span class="font25">2. Activate </span><span class="font25" style="font-weight:bold;">nounset </span><span class="font25">in your shell. Test that it shows an error message when using nonexisting variables.</span></p></li>
<li>
<p><span class="font25">3. Deactivate nounset.</span></p></li>
<li>
<p><span class="font25">4. Execute </span><span class="font25" style="font-weight:bold;">cd /var </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">ls </span><span class="font25">in an embedded shell.</span></p></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">command is only needed to show the result of the </span><span class="font25" style="font-weight:bold;">ls </span><span class="font25">command. Omitting will result in the shell trying to execute the first file as a command.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Create the variable embvar in an embedded shell and echo it. Does the variable exist in your current shell now ?</span></p></li>
<li>
<p><span class="font25">6. Explain what &quot;set -x&quot; does. Can this be useful ?</span></p></li></ul>
<p><span class="font25">(optional)7. Given the following screenshot, add exactly four characters to that command line so that the total output is FirstMiddleLast.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo First; echo Middle; echo Last</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. Display a </span><span class="font25" style="font-weight:bold;">long listing </span><span class="font25">(ls -l) of the </span><span class="font25" style="font-weight:bold;">passwd </span><span class="font25">command using the </span><span class="font25" style="font-weight:bold;">which </span><span class="font25">command inside an embedded shell.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1464"></a><span class="font10" style="font-weight:bold;"><a name="bookmark144"></a><a name="bookmark1465"></a>15.4. solution: shell embedding</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Find the list of shell options in the man page of </span><span class="font25" style="font-weight:bold;">bash</span><span class="font25">. What is the difference between </span><span class="font25" style="font-weight:bold;">set -u </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">set -o nounset</span><span class="font25">?</span></p></li></ul>
<p><span class="font25">read the manual of bash (man bash), search for nounset -- both mean the same thing.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Activate </span><span class="font25" style="font-weight:bold;">nounset </span><span class="font25">in your shell. Test that it shows an error message when using nonexisting variables. </span><span class="font19">set -u OR set -o nounset</span></p></li></ul>
<p><span class="font25">Both these lines have the same effect.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Deactivate nounset.</span></p></li></ul>
<p><span class="font19">set +u OR set +o nounset</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Execute </span><span class="font25" style="font-weight:bold;">cd /var </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">ls </span><span class="font25">in an embedded shell.</span></p></li></ul>
<p><span class="font19">echo $(cd /var ; ls)</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">command is only needed to show the result of the </span><span class="font25" style="font-weight:bold;">ls </span><span class="font25">command. Omitting will result in the shell trying to execute the first file as a command.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Create the variable embvar in an embedded shell and echo it. Does the variable exist in your current shell now ?</span></p></li></ul>
<p><span class="font19">echo $(embvar=emb;echo $embvar) ; echo $embvar #the last echo fails</span></p>
<p><span class="font19">$embvar does not exist in your current shell</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Explain what &quot;set -x&quot; does. Can this be useful ?</span></p></li></ul>
<p><span class="font19">It displays shell expansion for troubleshooting your command.</span></p>
<p><span class="font25">(optional)7. Given the following screenshot, add exactly four characters to that command line so that the total output is FirstMiddleLast.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo First; echo Middle; echo Last</span></p>
<p><span class="font19">echo -n First; echo -n Middle; echo Last</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. Display a </span><span class="font25" style="font-weight:bold;">long listing </span><span class="font25">(ls -l) of the </span><span class="font25" style="font-weight:bold;">passwd </span><span class="font25">command using the </span><span class="font25" style="font-weight:bold;">which </span><span class="font25">command inside an embedded shell.</span></p></li></ul>
<p><span class="font19">ls -l $(which passwd)</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark1466"></a><span class="font11" style="font-weight:bold;"><a name="bookmark145"></a><a name="bookmark1467"></a>Chapter 16. shell history</span></h1></li></ul>
<p><span class="font25">The shell makes it easy for us to repeat commands, this chapter explains how.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1468"></a><span class="font10" style="font-weight:bold;"><a name="bookmark146"></a><a name="bookmark1469"></a>16.1. repeating the last command</span></h2></li></ul>
<p><a name="bookmark1470"></a><span class="font25">To repeat the last command in bash, type </span><span class="font25" style="font-weight:bold;">!!</span><span class="font25">. This is pronounced as </span><span class="font25" style="font-weight:bold;">bang bang</span><span class="font25">.</span></p>
<p><span class="font19">paul@debian5:~/test42$ </span><span class="font19" style="font-weight:bold;">echo this will be repeated &gt;&nbsp;file42.txt</span></p>
<p><span class="font19">paul@debian5:~/test42$ </span><span class="font19" style="font-weight:bold;">!!</span></p>
<p><span class="font19">echo this will be repeated &gt;&nbsp;file42.txt</span></p>
<p><span class="font19">paul@debian5:~/test42$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1471"></a><span class="font10" style="font-weight:bold;"><a name="bookmark147"></a><a name="bookmark1472"></a>16.2. repeating other commands</span></h2></li></ul>
<p><span class="font25">You can repeat other commands using one </span><span class="font25" style="font-weight:bold;">bang </span><span class="font25">followed by one or more characters. The shell will repeat the last command that started with those characters.</span></p>
<p><span class="font19">paul@debian5:~/test42$ </span><span class="font19" style="font-weight:bold;">touch file42</span></p>
<p><span class="font19">paul@debian5:~/test42$ </span><span class="font19" style="font-weight:bold;">cat file42</span></p>
<p><span class="font19">paul@debian5:~/test42$ </span><span class="font19" style="font-weight:bold;">!to</span></p>
<p><span class="font19">touch file42</span></p>
<p><span class="font19">paul@debian5:~/test42$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1473"></a><span class="font10" style="font-weight:bold;"><a name="bookmark148"></a><a name="bookmark1474"></a>16.3. history</span></h2></li></ul>
<p><a name="bookmark1475"></a><span class="font25">To see older commands, use </span><span class="font25" style="font-weight:bold;">history </span><span class="font25">to display the shell command history (or use </span><span class="font25" style="font-weight:bold;">history n </span><span class="font25">to see the last n commands).</span></p>
<p><span class="font19">paul@debian5:~/test$ </span><span class="font19" style="font-weight:bold;">history 10</span></p>
<p><span class="font19">38 mkdir test</span></p>
<p><span class="font19">39 cd test</span></p>
<p><span class="font19">40 touch file1</span></p>
<p><span class="font19">41 echo hello &gt;&nbsp;file2</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">42 echo It is very cold today &gt;&nbsp;winter.txt</span></p></li>
<li>
<p><span class="font19">43 ls</span></p></li>
<li>
<p><span class="font19">44 ls -l</span></p></li>
<li>
<p><span class="font19">45 cp winter.txt summer.txt</span></p></li>
<li>
<p><span class="font19">46 ls -l</span></p></li>
<li>
<p><span class="font19">47 history 10</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1476"></a><span class="font10" style="font-weight:bold;"><a name="bookmark149"></a><a name="bookmark1477"></a>16.4. !n</span></h2></li></ul>
<p><a name="bookmark1478"></a><span class="font25">When typing </span><span class="font25" style="font-weight:bold;">! </span><span class="font25">followed by the number preceding the command you want repeated, then the shell will echo the command and execute it.</span></p>
<p><span class="font19">paul@debian5:~/test$ </span><span class="font19" style="font-weight:bold;">!43 </span><span class="font19">ls file1 file2 summer.txt winter.txt</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1479"></a><span class="font10" style="font-weight:bold;"><a name="bookmark150"></a><a name="bookmark1480"></a>16.5. Ctrl-r</span></h2></li></ul>
<p><a name="bookmark1481"></a><span class="font25">Another option is to use </span><span class="font25" style="font-weight:bold;">ctrl-r </span><span class="font25">to search in the history. In the screenshot below i only typed </span><span class="font25" style="font-weight:bold;">ctrl-r </span><span class="font25">followed by four characters </span><span class="font25" style="font-weight:bold;">apti </span><span class="font25">and it finds the last command containing these four consecutive characters.</span></p>
<p><span class="font19">paul@debian5:~$</span></p>
<p><span class="font19">(reverse-i-search)'apti': sudo aptitude install screen</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1482"></a><span class="font10" style="font-weight:bold;"><a name="bookmark151"></a><a name="bookmark1483"></a>16.6. $HISTSIZE</span></h2></li></ul>
<p><a name="bookmark1484"></a><span class="font25">The $HISTSIZE variable determines the number of commands that will be remembered in your current environment. Most distributions default this variable to 500 or 1000.</span></p>
<p><span class="font19">paul@debian5:~$ </span><span class="font19" style="font-weight:bold;">echo $HISTSIZE </span><span class="font19">500</span></p>
<p><span class="font25">You can change it to any value you like.</span></p>
<p><span class="font19">paul@debian5:~$ </span><span class="font19" style="font-weight:bold;">HISTSIZE=15000</span></p>
<p><span class="font19">paul@debian5:~$ </span><span class="font19" style="font-weight:bold;">echo $HISTSIZE</span></p>
<p><span class="font19">15000</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1485"></a><span class="font10" style="font-weight:bold;"><a name="bookmark152"></a><a name="bookmark1486"></a>16.7. $HISTFILE</span></h2></li></ul>
<p><a name="bookmark1487"></a><span class="font25"><a name="bookmark1488"></a>The $HISTFILE variable points to the file that contains your history. The </span><span class="font25" style="font-weight:bold;">bash </span><span class="font25">shell defaults this value to </span><span class="font25" style="font-weight:bold;">~/.bash_history</span><span class="font25">.</span></p>
<p><span class="font19">paul@debian5:~$ </span><span class="font19" style="font-weight:bold;">echo $HISTFILE</span></p>
<p><span class="font19">/home/paul/.bash_history</span></p>
<p><a name="bookmark1489"></a><span class="font25">A session history is saved to this file when you </span><span class="font25" style="font-weight:bold;">exit </span><span class="font25">the session!</span></p>
<p><a name="bookmark1490"></a><span class="font25" style="font-style:italic;">Closing a gnome-terminal with the mouse, or typing </span><span class="font25" style="font-weight:bold;font-style:italic;">reboot </span><span class="font25" style="font-style:italic;">as root will NOT save your terminal's history.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1491"></a><span class="font10" style="font-weight:bold;"><a name="bookmark153"></a><a name="bookmark1492"></a>16.8. $HISTFILESIZE</span></h2></li></ul>
<p><a name="bookmark1493"></a><span class="font25">The number of commands kept in your history file can be set using $HISTFILESIZE.</span></p>
<p><span class="font19">paul@debian5:~$ </span><span class="font19" style="font-weight:bold;">echo $HISTFILESIZE</span></p>
<p><span class="font19">15000</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1494"></a><span class="font10" style="font-weight:bold;"><a name="bookmark154"></a><a name="bookmark1495"></a>16.9. prevent recording a command</span></h2></li></ul>
<p><span class="font25">You can prevent a command from being recorded in </span><span class="font25" style="font-weight:bold;">history </span><span class="font25">using a space prefix.</span></p>
<p><span class="font19">paul@debian8:~/github$ </span><span class="font19" style="font-weight:bold;">echo abc </span><span class="font19">abc</span></p>
<p><span class="font19">paul@debian8:~/github$ </span><span class="font19" style="font-weight:bold;">echo def </span><span class="font19">def</span></p>
<p><span class="font19">paul@debian8:~/github$ </span><span class="font19" style="font-weight:bold;">echo ghi</span></p>
<p><span class="font19">ghi</span></p>
<p><span class="font19">paul@debian8:~/github$ </span><span class="font19" style="font-weight:bold;">history 3</span></p>
<p><span class="font19">9501 echo abc</span></p>
<p><span class="font19">9502 echo ghi</span></p>
<p><span class="font19">9503 history 3</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1496"></a><span class="font10" style="font-weight:bold;"><a name="bookmark155"></a><a name="bookmark1497"></a>16.10. (optional)regular expressions</span></h2></li></ul>
<p><a name="bookmark1498"></a><span class="font25">It is possible to use </span><span class="font25" style="font-weight:bold;">regular expressions </span><span class="font25">when using the </span><span class="font25" style="font-weight:bold;">bang </span><span class="font25">to repeat commands. The screenshot below switches 1 into 2.</span></p>
<p><span class="font19">paul@debian5:~/test$ </span><span class="font19" style="font-weight:bold;">cat filel</span></p>
<p><span class="font19">paul@debian5:~/test$ </span><span class="font19" style="font-weight:bold;">!c:s/1/2</span></p>
<p><span class="font19">cat file2</span></p>
<p><span class="font19">hello</span></p>
<p><span class="font19">paul@debian5:~/test$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1499"></a><span class="font10" style="font-weight:bold;"><a name="bookmark156"></a><a name="bookmark1500"></a>16.11. (optional) Korn shell history</span></h2></li></ul>
<p><a name="bookmark1501"></a><span class="font25"><a name="bookmark1502"></a>Repeating a command in the </span><span class="font25" style="font-weight:bold;">Korn shell </span><span class="font25">is very similar. The Korn shell also has the </span><span class="font25" style="font-weight:bold;">history </span><span class="font25">command, but uses the letter </span><span class="font25" style="font-weight:bold;">r </span><span class="font25">to recall lines from history.</span></p>
<p><span class="font25">This screenshot shows the history command. Note the different meaning of the parameter.</span></p>
<p><span class="font19">$ </span><span class="font19" style="font-weight:bold;">history 17</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">17 clear</span></p></li>
<li>
<p><span class="font19">18 echo hoi</span></p></li>
<li>
<p><span class="font19">19 history 12</span></p></li>
<li>
<p><span class="font19">20 echo world</span></p></li>
<li>
<p><span class="font19">21 history 17</span></p></li></ul>
<p><span class="font25">Repeating with </span><span class="font25" style="font-weight:bold;">r </span><span class="font25">can be combined with the line numbers given by the history command, or with the first few letters of the command.</span></p>
<p><span class="font19">$ </span><span class="font19" style="font-weight:bold;">r e </span><span class="font19">echo world world</span></p>
<p><span class="font19">$ </span><span class="font19" style="font-weight:bold;">cd /etc</span></p>
<p><span class="font19">$ </span><span class="font19" style="font-weight:bold;">r </span><span class="font19">cd /etc $</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1503"></a><span class="font10" style="font-weight:bold;"><a name="bookmark157"></a><a name="bookmark1504"></a>16.12. practice: shell history</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Issue the command </span><span class="font25" style="font-weight:bold;">echo The answer to the meaning of life, the universe and everything is 42</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">2. Repeat the previous command using only two characters (there are two solutions!)</span></p></li>
<li>
<p><span class="font25">3. Display the last 5 commands you typed.</span></p></li>
<li>
<p><span class="font25">4. Issue the long </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">from question 1 again, using the line numbers you received from the command in question 3.</span></p></li>
<li>
<p><span class="font25">5. How many commands can be kept in memory for your current shell session ?</span></p></li>
<li>
<p><span class="font25">6. Where are these commands stored when exiting the shell ?</span></p></li>
<li>
<p><span class="font25">7. How many commands can be written to the </span><span class="font25" style="font-weight:bold;">history file </span><span class="font25">when exiting your current shell session ?</span></p></li>
<li>
<p><span class="font25">8. Make sure your current bash shell remembers the next 5000 commands you type.</span></p></li>
<li>
<p><span class="font25">9. Open more than one console (by press Ctrl-shift-t in gnome-terminal, or by opening an extra putty.exe in MS Windows) with the same user account. When is command history written to the history file ?</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1505"></a><span class="font10" style="font-weight:bold;"><a name="bookmark158"></a><a name="bookmark1506"></a>16.13. solution: shell history</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Issue the command </span><span class="font25" style="font-weight:bold;">echo The answer to the meaning of life, the universe and everything is 42</span><span class="font25">.</span></p></li></ul>
<p><span class="font19">echo The answer to the meaning of life, the universe and everything is 42</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Repeat the previous command using only two characters (there are two solutions!)</span></p></li></ul>
<p><span class="font19">OR</span></p>
<p><span class="font19">!e</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Display the last 5 commands you typed.</span></p></li></ul>
<p><span class="font19">paul@ubu1010:~$ history 5</span></p>
<p><span class="font19">52 ls -l</span></p>
<p><span class="font19">53 ls</span></p>
<p><span class="font19">54 df -h | grep sda</span></p>
<p><span class="font19">55 echo The answer to the meaning of life, the universe and everything is 42</span></p>
<p><span class="font19">56 history 5</span></p>
<p><span class="font25">You will receive different line numbers.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Issue the long </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">from question 1 again, using the line numbers you received from the command in question 3.</span></p></li></ul>
<p><span class="font19">paul@ubu1010:~$ !55</span></p>
<p><span class="font19">echo The answer to the meaning of life, the universe and everything is 42</span></p>
<p><span class="font19">The answer to the meaning of life, the universe and everything is 42</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. How many commands can be kept in memory for your current shell session ?</span></p></li></ul>
<p><span class="font19">echo $HISTSIZE</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Where are these commands stored when exiting the shell ?</span></p></li></ul>
<p><span class="font19">echo $HISTFILE</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. How many commands can be written to the </span><span class="font25" style="font-weight:bold;">history file </span><span class="font25">when exiting your current shell session ?</span></p></li></ul>
<p><span class="font19">echo $HISTFILESIZE</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. Make sure your current bash shell remembers the next 5000 commands you type.</span></p></li></ul>
<p><span class="font19">HISTSIZE=5000</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">9. Open more than one console (by press Ctrl-shift-t in gnome-terminal, or by opening an extra putty.exe in MS Windows) with the same user account. When is command history written to the history file ?</span></p></li></ul>
<p><span class="font19">when you type </span><span class="font19" style="font-weight:bold;">exit</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark1507"></a><span class="font11" style="font-weight:bold;"><a name="bookmark159"></a><a name="bookmark1508"></a>Chapter 17. file globbing</span></h1></li></ul>
<p><a name="bookmark1509"></a><span class="font25">The shell is also responsible for </span><span class="font25" style="font-weight:bold;">file globbing </span><span class="font25">(or dynamic filename generation). This chapter will explain </span><span class="font25" style="font-weight:bold;">file globbing</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1510"></a><span class="font10" style="font-weight:bold;"><a name="bookmark160"></a><a name="bookmark1511"></a>17.1. * asterisk</span></h2></li></ul>
<p><a name="bookmark1512"></a><span class="font25"><a name="bookmark1513"></a>The asterisk </span><span class="font25" style="font-weight:bold;">* </span><span class="font25">is interpreted by the shell as a sign to generate filenames, matching the asterisk to any combination of characters (even none). When no path is given, the shell will use filenames in the current directory. See the man page of </span><span class="font25" style="font-weight:bold;">glob(7) </span><span class="font25">for more information. (This is part of LPI topic 1.103.3.)</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ ls filel file2 file3 File4 File55 FileA fileab Fileab FileAB fileabc</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ ls File*</span></p>
<p><span class="font19">File4 File55 FileA Fileab FileAB</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ ls file*</span></p>
<p><span class="font19">filel file2 file3 fileab fileabc</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ ls *ile55</span></p>
<p><span class="font19">File55</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ ls F*ile55</span></p>
<p><span class="font19">File55</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ ls F*55</span></p>
<p><span class="font19">File55</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1514"></a><span class="font10" style="font-weight:bold;"><a name="bookmark161"></a><a name="bookmark1515"></a>17.2. ? question mark</span></h2></li></ul>
<p><a name="bookmark1516"></a><span class="font25">Similar to the asterisk, the question mark </span><span class="font25" style="font-weight:bold;">? </span><span class="font25">is interpreted by the shell as a sign to generate filenames, matching the question mark with exactly one character.</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ ls</span></p>
<p><span class="font19">filel file2 file3 File4 File55 FileA fileab Fileab FileAB fileabc [paul@RHELv4u3 gen]$ ls File?</span></p>
<p><span class="font19">File4 FileA</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ ls Fil?4</span></p>
<p><span class="font19">File4</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ ls Fil??</span></p>
<p><span class="font19">File4 FileA</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ ls File??</span></p>
<p><span class="font19">File55 Fileab FileAB</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1517"></a><span class="font10" style="font-weight:bold;"><a name="bookmark162"></a><a name="bookmark1518"></a>17.3. [] square brackets</span></h2></li></ul>
<h4><a name="bookmark1519"></a><span class="font25"><a name="bookmark1520"></a><a name="bookmark1521"></a>The square bracket </span><span class="font25" style="font-weight:bold;">[ </span><span class="font25">is interpreted by the shell as a sign to generate filenames, matching any of the characters between </span><span class="font25" style="font-weight:bold;">[ </span><span class="font25">and the first subsequent </span><span class="font25" style="font-weight:bold;">]</span><span class="font25">. The order in this list between the brackets is not important. Each pair of brackets is replaced by exactly one character.</span></h4>
<p><span class="font19">[paul@RHELv4u3 gen]$ ls</span></p>
<p><span class="font19">filel file2 file3 File4 File55 FileA fileab Fileab FileAB fileabc [paul@RHELv4u3 gen]$ ls File[5A]</span></p>
<p><span class="font19">FileA</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ ls File[A5]</span></p>
<p><span class="font19">FileA</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ ls File[A5][5b]</span></p>
<p><span class="font19">File55</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ ls File[a5][5b]</span></p>
<p><span class="font19">File55 Fileab</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ ls File[a5][5b][abcdefghijklm]</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">ls: File[a5][5b][abcdefghijklm]: No such file or directory</span></p></li></ul>
<p><span class="font19">[paul@RHELv4u3 gen]$ ls file[a5][5b][abcdefghijklm] fileabc [paul@RHELv4u3 gen]$</span></p>
<h4><a name="bookmark1522"></a><span class="font25"><a name="bookmark1523"></a><a name="bookmark1524"></a><a name="bookmark1525"></a>You can also exclude characters from a list between square brackets with the exclamation mark </span><span class="font25" style="font-weight:bold;">!</span><span class="font25">. And you are allowed to make combinations of these </span><span class="font25" style="font-weight:bold;">wild cards</span><span class="font25">.</span></h4>
<p><span class="font19">[paul@RHELv4u3 gen]$ ls file1 file2 file3 File4 File55 FileA fileab Fileab FileAB fileabc [paul@RHELv4u3 gen]$ ls file[a5][!Z] fileab</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ ls file[!5]* file1 file2 file3 fileab fileabc [paul@RHELv4u3 gen]$ ls file[!5]? fileab</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1526"></a><span class="font10" style="font-weight:bold;"><a name="bookmark163"></a><a name="bookmark1527"></a>17.4. a-z and 0-9 ranges</span></h2></li></ul>
<h4><a name="bookmark1528"></a><span class="font25"><a name="bookmark1529"></a>The bash shell will also understand ranges of characters between brackets.</span></h4>
<p><span class="font19">[paul@RHELv4u3 gen]$ ls filel &nbsp;file3 &nbsp;File55 &nbsp;fileab &nbsp;FileAB &nbsp;&nbsp;fileabc</span></p>
<p><span class="font19">file2 &nbsp;File4 &nbsp;FileA &nbsp;&nbsp;Fileab &nbsp;fileab2</span></p>
<p><span class="font19">[paul@RHELv4u3 gen]$ ls file[a-z]* fileab fileab2 fileabc [paul@RHELv4u3 gen]$ ls file[0-9] filel file2 file3 [paul@RHELv4u3 gen]$ ls file[a-z][a-z][0-9]* fileab2 [paul@RHELv4u3 gen]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1530"></a><span class="font10" style="font-weight:bold;"><a name="bookmark164"></a><a name="bookmark1531"></a>17.5. $LANG and square brackets</span></h2></li></ul>
<h4><a name="bookmark1532"></a><span class="font25"><a name="bookmark1533"></a><a name="bookmark1534"></a>But, don't forget the influence of the </span><span class="font25" style="font-weight:bold;">LANG </span><span class="font25">variable. Some languages include lower case letters in an upper case range (and vice versa).</span></h4>
<p><span class="font19">paul@RHELv4u4:~/test$ ls [A-Z]ile? filel file2 file3 File4 paul@RHELv4u4:~/test$ ls [a-z]ile? filel file2 file3 File4 paul@RHELv4u4:~/test$ echo $LANG en_US.UTF-8 paul@RHELv4u4:~/test$ LANG=C paul@RHELv4u4:~/test$ echo $LANG C paul@RHELv4u4:~/test$ ls [a-z]ile? file1 file2 file3</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ ls [A-Z]ile? File4</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$</span></p>
<h4><a name="bookmark1535"></a><span class="font25"><a name="bookmark1536"></a>If </span><span class="font25" style="font-weight:bold;">$LC_ALL </span><span class="font25">is set, then this will also need to be reset to prevent file globbing.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1537"></a><span class="font10" style="font-weight:bold;"><a name="bookmark165"></a><a name="bookmark1538"></a>17.6. preventing file globbing</span></h2></li></ul>
<h4><a name="bookmark1539"></a><span class="font25"><a name="bookmark1540"></a><a name="bookmark1541"></a>The screenshot below should be no surprise. The </span><span class="font25" style="font-weight:bold;">echo * </span><span class="font25">will echo a * when in an empty directory. And it will echo the names of all files when the directory is not empty.</span></h4>
<p><span class="font19">paul@ubu1010:~$ mkdir test42</span></p>
<p><span class="font19">paul@ubu1010:~$ cd test42</span></p>
<p><span class="font19">paul@ubu1010:~/test42$ echo * *</span></p>
<p><span class="font19">paul@ubu1010:~/test42$ touch file42 file33</span></p>
<p><span class="font19">paul@ubu1010:~/test42$ echo * file33 file42</span></p>
<h4><a name="bookmark1542"></a><span class="font25"><a name="bookmark1543"></a><a name="bookmark1544"></a>Globbing can be prevented using quotes or by escaping the special characters, as shown in this screenshot.</span></h4>
<p><span class="font19">paul@ubu1010:~/test42$ echo *</span></p>
<p><span class="font19">file33 file42</span></p>
<p><span class="font19">paul@ubu1010:~/test42$ echo \* *</span></p>
<p><span class="font19">paul@ubu1010:~/test42$ echo '*' *</span></p>
<p><span class="font19">paul@ubu1010:~/test42$ echo &quot;*&quot; *</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1545"></a><span class="font10" style="font-weight:bold;"><a name="bookmark166"></a><a name="bookmark1546"></a>17.7. practice: shell globbing</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create a test directory and enter it.</span></p></li>
<li>
<p><span class="font25">2. Create the following files :</span></p></li></ul>
<p><span class="font19">filel</span></p>
<p><span class="font19">filelO</span></p>
<p><span class="font19">filell</span></p>
<p><span class="font19">file2</span></p>
<p><span class="font19">File2</span></p>
<p><span class="font19">File3</span></p>
<p><span class="font19">file33</span></p>
<p><span class="font19">fileAB</span></p>
<p><span class="font19">filea</span></p>
<p><span class="font19">fileA</span></p>
<p><span class="font19">fileAAA</span></p>
<p><span class="font19">file(</span></p>
<p><span class="font19">file 2</span></p>
<p><span class="font25">(the last one has 6 characters including a space)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. List (with ls) all files starting with file</span></p></li>
<li>
<p><span class="font25">4. List (with ls) all files starting with File</span></p></li>
<li>
<p><span class="font25">5. List (with ls) all files starting with file and ending in a number.</span></p></li>
<li>
<p><span class="font25">6. List (with ls) all files starting with file and ending with a letter</span></p></li>
<li>
<p><span class="font25">7. List (with ls) all files starting with File and having a digit as fifth character.</span></p></li>
<li>
<p><span class="font25">8. List (with ls) all files starting with File and having a digit as fifth character and nothing else.</span></p></li>
<li>
<p><span class="font25">9. List (with ls) all files starting with a letter and ending in a number.</span></p></li>
<li>
<p><span class="font25">10. List (with ls) all files that have exactly five characters.</span></p></li>
<li>
<p><span class="font25">11. List (with ls) all files that start with f or F and end with 3 or A.</span></p></li>
<li>
<p><span class="font25">12. List (with ls) all files that start with f have i or R as second character and end in a number.</span></p></li>
<li>
<p><span class="font25">13. List all files that do not start with the letter F.</span></p></li>
<li>
<p><span class="font25">14. Copy the value of $LANG to $MyLANG.</span></p></li>
<li>
<p><span class="font25">15. Show the influence of $LANG in listing A-Z or a-z ranges.</span></p></li>
<li>
<p><span class="font25">16. You receive information that one of your servers was cracked, the cracker probably replaced the </span><span class="font25" style="font-weight:bold;">ls </span><span class="font25">command. You know that the </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">command is safe to use. Can </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">replace </span><span class="font25" style="font-weight:bold;">ls </span><span class="font25">? How can you list the files in the current directory with </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">?</span></p></li>
<li>
<p><span class="font25">17. Is there another command besides cd to change directories ?</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1547"></a><span class="font10" style="font-weight:bold;"><a name="bookmark167"></a><a name="bookmark1548"></a>17.8. solution: shell globbing</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create a test directory and enter it.</span></p></li></ul>
<p><span class="font19">mkdir testdir; cd testdir</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Create the following files :</span></p></li></ul>
<p><span class="font19">filel filelO</span></p>
<p><span class="font19">filell file2 File2 File3 file33 fileAB filea fileA fileAAA file( file 2</span></p>
<p><span class="font25">(the last one has 6 characters including a space)</span></p>
<p><span class="font19">touch filel filelO filell file2 File2 File3</span></p>
<p><span class="font19">touch file33 fileAB filea fileA fileAAA</span></p>
<p><span class="font19">touch &quot;file(&quot;</span></p>
<p><span class="font19">touch &quot;file 2&quot;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. List (with ls) all files starting with file</span></p></li></ul>
<p><span class="font19">ls file*</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. List (with ls) all files starting with File</span></p></li></ul>
<p><span class="font19">ls File*</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. List (with ls) all files starting with file and ending in a number.</span></p></li></ul>
<p><span class="font19">ls file*[0-9]</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. List (with ls) all files starting with file and ending with a letter</span></p></li></ul>
<p><span class="font19">ls file*[a-z]</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. List (with ls) all files starting with File and having a digit as fifth character.</span></p></li></ul>
<p><span class="font19">ls File[0-9]*</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. List (with ls) all files starting with File and having a digit as fifth character and nothing else.</span></p></li></ul>
<p><span class="font19">ls File[0-9]</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">9. List (with ls) all files starting with a letter and ending in a number.</span></p></li></ul>
<p><span class="font19">ls [a-z]*[0-9]</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">10. List (with ls) all files that have exactly five characters.</span></p></li></ul>
<p><span class="font19">ls</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">11. List (with ls) all files that start with f or F and end with 3 or A.</span></p></li></ul>
<p><span class="font19">ls [fF]*[3A]</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">12. List (with ls) all files that start with f have i or R as second character and end in a number.</span></p></li></ul>
<p><span class="font19">ls f[iR]*[0-9]</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">13. List all files that do not start with the letter F.</span></p></li></ul>
<p><span class="font19">ls [!F]*</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">14. Copy the value of $LANG to $MyLANG.</span></p></li></ul>
<p><span class="font19">MyLANG=$LANG</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">15. Show the influence of $LANG in listing A-Z or a-z ranges.</span></p></li></ul>
<p><span class="font19">see example in book</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">16. You receive information that one of your servers was cracked, the cracker probably replaced the </span><span class="font25" style="font-weight:bold;">ls </span><span class="font25">command. You know that the </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">command is safe to use. Can </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">replace </span><span class="font25" style="font-weight:bold;">ls </span><span class="font25">? How can you list the files in the current directory with </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">?</span></p></li></ul>
<p><span class="font19">echo *</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">17. Is there another command besides cd to change directories</span></p></li></ul>
<p><span class="font19">pushd popd</span></p>
<p><a name="bookmark1549"></a><span class="font11" style="font-weight:bold;">Part V. pipes and commands</span></p>
<h3><a name="bookmark1550"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1551"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1552"><span class="font24" style="font-weight:bold;">18. I/O redirection </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1553"><span class="font24">18.1. stdin, stdout, and stderr </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1554"><span class="font24">18.2. output redirection </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1555"><span class="font24">18.3. error redirection </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1556"><span class="font24">18.4. output redirection and pipes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1557"><span class="font24">18.5. joining stdout and stderr </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1558"><span class="font24">18.6. input redirection </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1559"><span class="font24">18.7. confusing redirection </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1560"><span class="font24">18.8. quick file clear </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1561"><span class="font24">18.9. practice: input/output redirection </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1562"><span class="font24">18.10. solution: input/output redirection </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1563"><span class="font24" style="font-weight:bold;">19. filters </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1564"><span class="font24">19.1. cat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1565"><span class="font24">19.2. tee </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1566"><span class="font24">19.3. grep </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1567"><span class="font24">19.4. cut </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1568"><span class="font24">19.5. tr </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1569"><span class="font24">19.6. wc </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1570"><span class="font24">19.7. sort </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1571"><span class="font24">19.8. uniq </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1572"><span class="font24">19.9. comm </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1573"><span class="font24">19.10. od </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1574"><span class="font24">19.11. sed </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1575"><span class="font24">19.12. pipe examples </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1576"><span class="font24">19.13. practice: filters </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1577"><span class="font24">19.14. solution: filters </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1578"><span class="font24" style="font-weight:bold;">20. basic Unix tools </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1579"><span class="font24">20.1. find </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1580"><span class="font24">20.2. locate </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1581"><span class="font24">20.3. date </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1582"><span class="font24">20.4. cal </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1583"><span class="font24">20.5. sleep </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1584"><span class="font24">20.6. time </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1585"><span class="font24">20.7. gzip - gunzip </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1586"><span class="font24">20.8. zcat - zmore </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1587"><span class="font24">20.9. bzip2 - bunzip2 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1588"><span class="font24">20.10. bzcat - bzmore </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1589"><span class="font24">20.11. practice: basic Unix tools </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1590"><span class="font24">20.12. solution: basic Unix tools </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1591"><span class="font24" style="font-weight:bold;">21. regular expressions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1592"><span class="font24">21.1. regex versions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1593"><span class="font24">21.2. grep </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1594"><span class="font24">21.3. rename </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1595"><span class="font24">21.4. sed </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1596"><span class="font24">21.5. bash history </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark1597"></a><span class="font11" style="font-weight:bold;"><a name="bookmark169"></a><a name="bookmark1598"></a>Chapter 18. I/O redirection</span></h1></li></ul>
<p><span class="font25">One of the powers of the Unix command line is the use of </span><span class="font25" style="font-weight:bold;">input/output redirection </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">pipes</span><span class="font25">.</span></p>
<p><span class="font25">This chapter explains </span><span class="font25" style="font-weight:bold;">redirection </span><span class="font25">of input, output and error streams.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1599"></a><span class="font10" style="font-weight:bold;"><a name="bookmark170"></a><a name="bookmark1600"></a>18.1. stdin, stdout, and stderr</span></h2></li></ul>
<p><a name="bookmark1601"></a><span class="font25"><a name="bookmark1602"></a><a name="bookmark1603"></a>The bash shell has three basic streams; it takes input from </span><span class="font25" style="font-weight:bold;">stdin </span><span class="font25">(stream </span><span class="font25" style="font-weight:bold;">0</span><span class="font25">), it sends output to </span><span class="font25" style="font-weight:bold;">stdout </span><span class="font25">(stream </span><span class="font25" style="font-weight:bold;">1</span><span class="font25">) and it sends error messages to </span><span class="font25" style="font-weight:bold;">stderr </span><span class="font25">(stream </span><span class="font25" style="font-weight:bold;">2</span><span class="font25">) .</span></p>
<p><span class="font25">The drawing below has a graphical interpretation of these three streams.</span></p><img src="linux_guide_files/The Complete Linux Guide-82.jpg" alt="" style="width:395pt;height:66pt;">
<p><span class="font25">The keyboard often serves as </span><span class="font25" style="font-weight:bold;">stdin</span><span class="font25">, whereas </span><span class="font25" style="font-weight:bold;">stdout </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">stderr </span><span class="font25">both go to the display. This can be confusing to new Linux users because there is no obvious way to recognize </span><span class="font25" style="font-weight:bold;">stdout </span><span class="font25">from </span><span class="font25" style="font-weight:bold;">stderr</span><span class="font25">. Experienced users know that separating output from errors can be very useful.</span></p><img src="linux_guide_files/The Complete Linux Guide-83.jpg" alt="" style="width:381pt;height:75pt;">
<p><span class="font25">The next sections will explain how to redirect these streams.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1604"></a><span class="font10" style="font-weight:bold;"><a name="bookmark171"></a><a name="bookmark1605"></a>18.2. output redirection</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark1606"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1607"></a>18.2.1. &gt;&nbsp;stdout</span></h3></li></ul></li></ul>
<p><a name="bookmark1608"></a><span class="font25" style="font-weight:bold;">stdout </span><span class="font25">can be redirected with a </span><span class="font25" style="font-weight:bold;">greater than </span><span class="font25">sign. While scanning the line, the shell will see the </span><span class="font25" style="font-weight:bold;">&gt;&nbsp;</span><span class="font25">sign and will clear the file.</span></p><img src="linux_guide_files/The Complete Linux Guide-84.jpg" alt="" style="width:383pt;height:76pt;">
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">&gt;&nbsp;</span><span class="font25">notation is in fact the abbreviation of </span><span class="font25" style="font-weight:bold;">1&gt; </span><span class="font25">(</span><span class="font25" style="font-weight:bold;">stdout </span><span class="font25">being referred to as stream </span><span class="font25" style="font-weight:bold;">1</span><span class="font25">).</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo It is cold today!</span></p>
<p><span class="font19">It is cold today!</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo It is cold today! &gt;&nbsp;winter.txt</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ cat winter.txt</span></p>
<p><span class="font19">It is cold today!</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$</span></p>
<p><span class="font25">Note that the bash shell effectively </span><span class="font25" style="font-weight:bold;">removes </span><span class="font25">the redirection from the command line before argument 0 is executed. This means that in the case of this command:</span></p>
<p><span class="font19">echo hello &gt;&nbsp;greetings.txt</span></p>
<p><span class="font25">the shell only counts two arguments (echo = argument 0, hello = argument 1). The redirection is removed before the argument counting takes place.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1609"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1610"></a>18.2.2. output file is erased</span></h3></li></ul>
<p><span class="font25">While scanning the line, the shell will see the &gt;&nbsp;sign and </span><span class="font25" style="font-weight:bold;">will clear the file</span><span class="font25">! Since this happens before resolving </span><span class="font25" style="font-weight:bold;">argument 0</span><span class="font25">, this means that even when the command fails, the file will have been cleared!</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ cat winter.txt</span></p>
<p><span class="font19">It is cold today!</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ zcho It is cold today! &gt;&nbsp;winter.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-bash: zcho: command not found</span></p></li></ul>
<p><span class="font19">[paul@RHELv4u3 ~]$ cat winter.txt</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1611"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1612"></a>18.2.3. noclobber</span></h3></li></ul>
<h4><a name="bookmark1613"></a><span class="font25"><a name="bookmark1614"></a><a name="bookmark1615"></a>Erasing a file while using &gt;&nbsp;can be prevented by setting the </span><span class="font25" style="font-weight:bold;">noclobber </span><span class="font25">option.</span></h4>
<p><span class="font19">[paul@RHELv4u3 ~]$ cat winter.txt It is cold today!</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ set -o noclobber</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo It is cold today! &gt;&nbsp;winter.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-bash: winter.txt: cannot overwrite existing file [paul@RHELv4u3 ~]$ set +o noclobber [paul@RHELv4u3 ~]$</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1616"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1617"></a>18.2.4. overruling noclobber</span></h3></li></ul>
<h4><a name="bookmark1618"></a><span class="font25"><a name="bookmark1619"></a><a name="bookmark1620"></a>The </span><span class="font25" style="font-weight:bold;">noclobber </span><span class="font25">can be overruled with </span><span class="font25" style="font-weight:bold;">&gt;|</span><span class="font25">.</span></h4>
<p><span class="font19">[paul@RHELv4u3 ~]$ set -o noclobber</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo It is cold today! &gt;&nbsp;winter.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-bash: winter.txt: cannot overwrite existing file</span></p></li></ul>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo It is very cold today! &gt;| winter.txt</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ cat winter.txt It is very cold today!</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1621"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1622"></a>18.2.5. &gt;&gt;&nbsp;append</span></h3></li></ul>
<h4><a name="bookmark1623"></a><span class="font25"><a name="bookmark1624"></a><a name="bookmark1625"></a>Use </span><span class="font25" style="font-weight:bold;">&gt;&gt;&nbsp;</span><span class="font25">to </span><span class="font25" style="font-weight:bold;">append </span><span class="font25">output to a file.</span></h4>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo It is cold today! &gt;&nbsp;winter.txt</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ cat winter.txt It is cold today!</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ echo Where is the summer ? &gt;&gt;&nbsp;winter.txt</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ cat winter.txt It is cold today!</span></p>
<p><span class="font19">Where is the summer ?</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1626"></a><span class="font10" style="font-weight:bold;"><a name="bookmark172"></a><a name="bookmark1627"></a>18.3. error redirection</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark1628"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1629"></a>18.3.1. 2&gt; stderr</span></h3></li></ul></li></ul>
<p><a name="bookmark1630"></a><span class="font25">Redirecting </span><span class="font25" style="font-weight:bold;">stderr </span><span class="font25">is done with </span><span class="font25" style="font-weight:bold;">2&gt;</span><span class="font25">. This can be very useful to prevent error messages from cluttering your screen.</span></p><img src="linux_guide_files/The Complete Linux Guide-85.jpg" alt="" style="width:381pt;height:73pt;">
<p><a name="bookmark1631"></a><span class="font25"><a name="bookmark1632"></a>The screenshot below shows redirection of </span><span class="font25" style="font-weight:bold;">stdout </span><span class="font25">to a file, and </span><span class="font25" style="font-weight:bold;">stderr </span><span class="font25">to </span><span class="font25" style="font-weight:bold;">/dev/null</span><span class="font25">. Writing </span><span class="font25" style="font-weight:bold;">1&gt; </span><span class="font25">is the same as &gt;.</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ find / &gt;&nbsp;allfiles.txt 2&gt; /dev/null</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1633"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1634"></a>18.3.2. 2&gt;&amp;1</span></h3></li></ul>
<p><a name="bookmark1635"></a><span class="font25">To redirect both </span><span class="font25" style="font-weight:bold;">stdout </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">stderr </span><span class="font25">to the same file, use </span><span class="font25" style="font-weight:bold;">2&gt;&amp;1</span><span class="font25">.</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ find / &gt;&nbsp;allfiles_and_errors.txt 2&gt;&amp;1 [paul@RHELv4u3 ~]$</span></p>
<p><span class="font25">Note that the order of redirections is significant. For example, the command</span></p>
<p><span class="font19">ls &gt;&nbsp;dirlist 2&gt;&amp;1</span></p>
<p><span class="font25">directs both standard output (file descriptor 1) and standard error (file descriptor 2) to the file dirlist, while the command</span></p>
<p><span class="font19">ls 2&gt;&amp;1 &gt;&nbsp;dirlist</span></p>
<p><span class="font25">directs only the standard output to file dirlist, because the standard error made a copy of the standard output before the standard output was redirected to dirlist.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1636"></a><span class="font10" style="font-weight:bold;"><a name="bookmark173"></a><a name="bookmark1637"></a>18.4. output redirection and pipes</span></h2></li></ul>
<h4><a name="bookmark1638"></a><span class="font25"><a name="bookmark1639"></a>By default you cannot grep inside </span><span class="font25" style="font-weight:bold;">stderr </span><span class="font25">when using pipes on the command line, because only </span><span class="font25" style="font-weight:bold;">stdout </span><span class="font25">is passed.</span></h4>
<p><span class="font19">paul@debian7:~$ rm file42 file33 file1201 | grep file42</span></p>
<p><span class="font19">rm: cannot remove ‘file42’: No such file or directory</span></p>
<p><span class="font19">rm: cannot remove ‘file33’: No such file or directory rm: cannot remove ‘file1201’: No such file or directory</span></p>
<h4><a name="bookmark1640"></a><span class="font25"><a name="bookmark1641"></a>With </span><span class="font25" style="font-weight:bold;">2&gt;&amp;1 </span><span class="font25">you can force </span><span class="font25" style="font-weight:bold;">stderr </span><span class="font25">to go to </span><span class="font25" style="font-weight:bold;">stdout</span><span class="font25">. This enables the next command in the pipe to act on both streams.</span></h4>
<p><span class="font19">paul@debian7:~$ rm file42 file33 file1201 2&gt;&amp;1 | grep file42 rm: cannot remove ‘file42’: No such file or directory</span></p>
<h4><a name="bookmark1642"></a><span class="font25"><a name="bookmark1643"></a>You cannot use both </span><span class="font25" style="font-weight:bold;">1&gt;&amp;2 </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">2&gt;&amp;1 </span><span class="font25">to switch </span><span class="font25" style="font-weight:bold;">stdout </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">stderr</span><span class="font25">.</span></h4>
<p><span class="font19">paul@debian7:~$ rm file42 file33 file1201 2&gt;&amp;1 1&gt;&amp;2 | grep file42</span></p>
<p><span class="font19">rm: cannot remove ‘file42’: No such file or directory</span></p>
<p><span class="font19">paul@debian7:~$ echo file42 2&gt;&amp;1 1&gt;&amp;2 | sed 's/file42/FILE42/' FILE42</span></p>
<h4><a name="bookmark1644"></a><span class="font25"><a name="bookmark1645"></a>You need a third stream to switch stdout and stderr after a pipe symbol.</span></h4>
<p><span class="font19">paul@debian7:~$ echo file42 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3 | sed 's/file42/FILE42/'</span></p>
<p><span class="font19">file42</span></p>
<p><span class="font19">paul@debian7:~$ rm file42 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3 | sed 's/file42/FILE42/' rm: cannot remove ‘FILE42’: No such file or directory</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1646"></a><span class="font10" style="font-weight:bold;"><a name="bookmark174"></a><a name="bookmark1647"></a>18.5. joining stdout and stderr</span></h2></li></ul>
<h4><a name="bookmark1648"></a><span class="font25"><a name="bookmark1649"></a>The </span><span class="font25" style="font-weight:bold;">&amp;&gt;&nbsp;</span><span class="font25">construction will put both </span><span class="font25" style="font-weight:bold;">stdout </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">stderr </span><span class="font25">in one stream (to a file).</span></h4>
<p><span class="font19">paul@debian7:~$ rm file42 &amp;&gt;&nbsp;out_and_err</span></p>
<p><span class="font19">paul@debian7:~$ cat out_and_err</span></p>
<p><span class="font19">rm: cannot remove ‘file42’: No such file or directory</span></p>
<p><span class="font19">paul@debian7:~$ echo file42 &amp;&gt;&nbsp;out_and_err</span></p>
<p><span class="font19">paul@debian7:~$ cat out_and_err</span></p>
<p><span class="font19">file42</span></p>
<p><span class="font19">paul@debian7:~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1650"></a><span class="font10" style="font-weight:bold;"><a name="bookmark175"></a><a name="bookmark1651"></a>18.6. input redirection</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark1652"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1653"></a>18.6.1. &lt;&nbsp;stdin</span></h3></li></ul></li></ul>
<p><span class="font25">Redirecting </span><span class="font25" style="font-weight:bold;">stdin </span><span class="font25">is done with &lt;&nbsp;(short for 0&lt;).</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ cat &lt;&nbsp;text.txt one</span></p>
<p><span class="font19">two</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ tr 'onetw' 'ONEZZ' &lt;&nbsp;text.txt</span></p>
<p><span class="font19">ONE</span></p>
<p><span class="font19">ZZO</span></p>
<p><span class="font19">[paul@RHEL4b ~]$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1654"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1655"></a>18.6.2. &lt;&lt;&nbsp;here document</span></h3></li></ul>
<p><a name="bookmark1656"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">here document </span><span class="font25">(sometimes called here-is-document<a name="bookmark1657"></a>) is a way to append input until a certain sequence (usually EOF) is encountered. The </span><span class="font25" style="font-weight:bold;">EOF </span><span class="font25">marker can be typed literally or can be called with Ctrl-D.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ cat &lt;&lt;EOF &gt;&nbsp;text.txt &gt;&nbsp;one &gt;&nbsp;two &gt;&nbsp;EOF</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ cat text.txt one two</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ cat &lt;&lt;brol &gt;&nbsp;text.txt &gt;&nbsp;brel &gt;&nbsp;brol</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ cat text.txt brel</span></p>
<p><span class="font19">[paul@RHEL4b ~]$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1658"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1659"></a>18.6.3. &lt;&lt;&lt;&nbsp;here string</span></h3></li></ul>
<p><a name="bookmark1660"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">here string </span><span class="font25">can be used to directly pass strings to a command. The result is the same as using </span><span class="font25" style="font-weight:bold;">echo string | command </span><span class="font25">(but you have one less process running).</span></p>
<p><span class="font19">paul@ubu1110~$ base64 &lt;&lt;&lt;&nbsp;linux-training.be</span></p>
<p><span class="font19">bGludXgtdHJhaW5pbmcuYmUK</span></p>
<p><span class="font19">paul@ubu1110~$ base64 -d &lt;&lt;&lt;&nbsp;bGludXgtdHJhaW5pbmcuYmUK</span></p>
<p><span class="font19">linux-training.be</span></p>
<p><a name="bookmark1661"></a><span class="font25">See rfc 3548 for more information about </span><span class="font25" style="font-weight:bold;">base64</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1662"></a><span class="font10" style="font-weight:bold;"><a name="bookmark176"></a><a name="bookmark1663"></a>18.7. confusing redirection</span></h2></li></ul>
<p><span class="font25">The shell will scan the whole line before applying redirection. The following command line is very readable and is correct.</span></p>
<p><span class="font19">cat winter.txt &gt;&nbsp;snow.txt 2&gt; errors.txt</span></p>
<p><span class="font25">But this one is also correct, but less readable.</span></p>
<p><span class="font19">2&gt; errors.txt cat winter.txt &gt;&nbsp;snow.txt</span></p>
<p><span class="font25">Even this will be understood perfectly by the shell.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">&lt; winter.txt &gt;&nbsp;snow.txt 2&gt; errors.txt cat</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1664"></a><span class="font10" style="font-weight:bold;"><a name="bookmark177"></a><a name="bookmark1665"></a>18.8. quick file clear</span></h2></li></ul>
<p><span class="font25">So what is the quickest way to clear a file ?</span></p>
<p><span class="font19">&gt;foo</span></p>
<p><span class="font25">And what is the quickest way to clear a file when the </span><span class="font25" style="font-weight:bold;">noclobber </span><span class="font25">option is set</span></p>
<p><span class="font19">&gt;|bar</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1666"></a><span class="font10" style="font-weight:bold;"><a name="bookmark178"></a><a name="bookmark1667"></a>18.9. practice: input/output redirection</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Activate the </span><span class="font25" style="font-weight:bold;">noclobber </span><span class="font25">shell option.</span></p></li>
<li>
<p><span class="font25">2. Verify that </span><span class="font25" style="font-weight:bold;">noclobber </span><span class="font25">is active by repeating an </span><span class="font25" style="font-weight:bold;">ls </span><span class="font25">on </span><span class="font25" style="font-weight:bold;">/etc/ </span><span class="font25">with redirected output to a file.</span></p></li>
<li>
<p><span class="font25">3. When listing all shell options, which character represents the </span><span class="font25" style="font-weight:bold;">noclobber </span><span class="font25">option ?</span></p></li>
<li>
<p><span class="font25">4. Deactivate the </span><span class="font25" style="font-weight:bold;">noclobber </span><span class="font25">option.</span></p></li>
<li>
<p><span class="font25">5. Make sure you have two shells open on the same computer. Create an empty </span><span class="font25" style="font-weight:bold;">tailing.txt </span><span class="font25">file. Then type </span><span class="font25" style="font-weight:bold;">tail -f tailing.txt</span><span class="font25">. Use the second shell to </span><span class="font25" style="font-weight:bold;">append </span><span class="font25">a line of text to that file. Verify that the first shell displays this line.</span></p></li>
<li>
<p><span class="font25">6. Create a file that contains the names of five people. Use </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">and output redirection to create the file and use a </span><span class="font25" style="font-weight:bold;">here document </span><span class="font25">to end the input.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1668"></a><span class="font10" style="font-weight:bold;"><a name="bookmark179"></a><a name="bookmark1669"></a>18.10. solution: input/output redirection</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Activate the </span><span class="font25" style="font-weight:bold;">noclobber </span><span class="font25">shell option.</span></p></li></ul>
<p><span class="font19">set -o noclobber</span></p>
<p><span class="font19">set -C</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Verify that </span><span class="font25" style="font-weight:bold;">noclobber </span><span class="font25">is active by repeating an </span><span class="font25" style="font-weight:bold;">ls </span><span class="font25">on </span><span class="font25" style="font-weight:bold;">/etc/ </span><span class="font25">with redirected output to a file. </span><span class="font19">ls /etc &gt;&nbsp;etc.txt ls /etc &gt;&nbsp;etc.txt (should not work)</span></p></li>
<li>
<p><span class="font25">4. When listing all shell options, which character represents the </span><span class="font25" style="font-weight:bold;">noclobber </span><span class="font25">option ? </span><span class="font19">echo $- (noclobber is visible as C)</span></p></li>
<li>
<p><span class="font25">5. Deactivate the </span><span class="font25" style="font-weight:bold;">noclobber </span><span class="font25">option. </span><span class="font19">set +o noclobber</span></p></li>
<li>
<p><span class="font25">6. Make sure you have two shells open on the same computer. Create an empty </span><span class="font25" style="font-weight:bold;">tailing.txt </span><span class="font25">file. Then type </span><span class="font25" style="font-weight:bold;">tail -f tailing.txt</span><span class="font25">. Use the second shell to </span><span class="font25" style="font-weight:bold;">append </span><span class="font25">a line of text to that file. Verify that the first shell displays this line.</span></p></li></ul>
<p><span class="font19">paul@deb503:~$ &gt;&nbsp;tailing.txt</span></p>
<p><span class="font19">paul@deb503:~$ tail -f tailing.txt hello</span></p>
<p><span class="font19">world</span></p>
<p><span class="font19">in the other shell:</span></p>
<p><span class="font19">paul@deb503:~$ echo hello &gt;&gt;&nbsp;tailing.txt</span></p>
<p><span class="font19">paul@deb503:~$ echo world &gt;&gt;&nbsp;tailing.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. Create a file that contains the names of five people. Use </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">and output redirection to create the file and use a </span><span class="font25" style="font-weight:bold;">here document </span><span class="font25">to end the input.</span></p></li></ul>
<p><span class="font19">paul@deb503:~$ cat &gt;&nbsp;tennis.txt &lt;&lt;&nbsp;ace &gt;&nbsp;Justine Henin &gt;&nbsp;Venus Williams &gt;&nbsp;Serena Williams &gt;&nbsp;Martina Hingis &gt;&nbsp;Kim Clijsters &gt;&nbsp;ace paul@deb503:~$ cat tennis.txt Justine Henin Venus Williams Serena Williams Martina Hingis Kim Clijsters paul@deb503:~$</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark1670"></a><span class="font11" style="font-weight:bold;"><a name="bookmark1671"></a><a name="bookmark1672"></a>Chapter 19. filters</span></h1></li></ul>
<p><a name="bookmark1673"></a><span class="font25">Commands that are created to be used with a </span><span class="font25" style="font-weight:bold;">pipe </span><span class="font25">are often called </span><span class="font25" style="font-weight:bold;">filters</span><span class="font25">. These </span><span class="font25" style="font-weight:bold;">filters </span><span class="font25">are very small programs that do one specific thing very efficiently. They can be used as </span><span class="font25" style="font-weight:bold;">building blocks</span><span class="font25">.</span></p>
<p><span class="font25">This chapter will introduce you to the most common </span><span class="font25" style="font-weight:bold;">filters</span><span class="font25">. The combination of simple commands and filters in a long </span><span class="font25" style="font-weight:bold;">pipe </span><span class="font25">allows you to design elegant solutions.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1674"></a><span class="font10" style="font-weight:bold;"><a name="bookmark181"></a><a name="bookmark1675"></a>19.1. cat</span></h2></li></ul>
<h4><a name="bookmark1676"></a><span class="font25"><a name="bookmark1677"></a><a name="bookmark1678"></a>When between two </span><span class="font25" style="font-weight:bold;">pipes</span><span class="font25">, the </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">command does nothing (except putting </span><span class="font25" style="font-weight:bold;">stdin </span><span class="font25">on </span><span class="font25" style="font-weight:bold;">stdout</span><span class="font25">).</span></h4>
<p><span class="font19">[paul@RHEL4b pipes]$ tac count.txt | cat | cat | cat | cat | cat five four three two one</span></p>
<p><span class="font19">[paul@RHEL4b pipes]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1679"></a><span class="font10" style="font-weight:bold;"><a name="bookmark182"></a><a name="bookmark1680"></a>19.2. tee</span></h2></li></ul>
<h4><a name="bookmark1681"></a><span class="font25"><a name="bookmark1682"></a><a name="bookmark1683"></a><a name="bookmark1684"></a><a name="bookmark1685"></a>Writing long </span><span class="font25" style="font-weight:bold;">pipes </span><span class="font25">in Unix is fun, but sometimes you may want intermediate results. This is were </span><span class="font25" style="font-weight:bold;">tee </span><span class="font25">comes in handy. The </span><span class="font25" style="font-weight:bold;">tee </span><span class="font25">filter puts </span><span class="font25" style="font-weight:bold;">stdin </span><span class="font25">on </span><span class="font25" style="font-weight:bold;">stdout </span><span class="font25">and also into a file. So </span><span class="font25" style="font-weight:bold;">tee </span><span class="font25">is almost the same as </span><span class="font25" style="font-weight:bold;">cat</span><span class="font25">, except that it has two identical outputs.</span></h4>
<div>
<p><span class="font19">[paul@RHEL4b one two three four five</span></p>
<p><span class="font19">[paul@RHEL4b five four three two one</span></p>
<p><span class="font19">[paul@RHEL4b</span></p>
</div><br clear="all">
<div>
<p><span class="font19">pipes]$ tac count.txt | tee temp.txt | tac</span></p>
</div><br clear="all">
<div>
<p><span class="font19">pipes]$ cat temp.txt</span></p>
</div><br clear="all">
<div>
<p><span class="font19">pipes]$</span></p>
</div><br clear="all">
<ul style="list-style:none;"><li>
<h2><a name="bookmark1686"></a><span class="font10" style="font-weight:bold;"><a name="bookmark183"></a><a name="bookmark1687"></a>19.3. grep</span></h2></li></ul>
<h4><a name="bookmark1688"></a><span class="font25"><a name="bookmark1689"></a><a name="bookmark1690"></a>The </span><span class="font25" style="font-weight:bold;">grep </span><span class="font25">filter is famous among Unix users. The most common use of </span><span class="font25" style="font-weight:bold;">grep </span><span class="font25">is to filter lines of text containing (or not containing) a certain string.</span></h4>
<p><span class="font19">[paul@RHEL4b pipes]$ cat tennis.txt</span></p>
<p><span class="font19">Amelie Mauresmo, Fra Kim Clijsters, BEL Justine Henin, Bel Serena Williams, usa Venus Williams, USA [paul@RHEL4b pipes]$ cat tennis.txt | grep Williams Serena Williams, usa Venus Williams, USA</span></p>
<h4><a name="bookmark1691"></a><span class="font25"><a name="bookmark1692"></a>You can write this without the cat.</span></h4>
<p><span class="font19">[paul@RHEL4b pipes]$ grep Williams tennis.txt Serena Williams, usa</span></p>
<p><span class="font19">Venus Williams, USA</span></p>
<h4><a name="bookmark1693"></a><span class="font25"><a name="bookmark1694"></a><a name="bookmark1695"></a>One of the most useful options of grep is </span><span class="font25" style="font-weight:bold;">grep -i </span><span class="font25">which filters in a case insensitive way.</span></h4>
<p><span class="font19">[paul@RHEL4b pipes]$ grep Bel tennis.txt</span></p>
<p><span class="font19">Justine Henin, Bel</span></p>
<p><span class="font19">[paul@RHEL4b pipes]$ grep -i Bel tennis.txt</span></p>
<p><span class="font19">Kim Clijsters, BEL Justine Henin, Bel [paul@RHEL4b pipes]$</span></p>
<h4><a name="bookmark1696"></a><span class="font25"><a name="bookmark1697"></a><a name="bookmark1698"></a>Another very useful option is </span><span class="font25" style="font-weight:bold;">grep -v </span><span class="font25">which outputs lines not matching the string.</span></h4>
<p><span class="font19">[paul@RHEL4b pipes]$ grep -v Fra tennis.txt Kim Clijsters, BEL Justine Henin, Bel Serena Williams, usa Venus Williams, USA</span></p>
<p><span class="font19">[paul@RHEL4b pipes]$</span></p>
<h4><a name="bookmark1699"></a><span class="font25"><a name="bookmark1700"></a>And of course, both options can be combined to filter all lines not containing a case insensitive string.</span></h4>
<p><span class="font19">[paul@RHEL4b pipes]$ grep -vi usa tennis.txt Amelie Mauresmo, Fra Kim Clijsters, BEL Justine Henin, Bel [paul@RHEL4b pipes]$</span></p>
<h4><a name="bookmark1701"></a><span class="font25"><a name="bookmark1702"></a>With </span><span class="font25" style="font-weight:bold;">grep -A1 </span><span class="font25">one line </span><span class="font25" style="font-weight:bold;">after </span><span class="font25">the result is also displayed.</span></h4>
<p><span class="font19">paul@debian5:~/pipes$ grep -A1 Henin tennis.txt Justine Henin, Bel Serena Williams, usa</span></p>
<h4><a name="bookmark1703"></a><span class="font25"><a name="bookmark1704"></a>With </span><span class="font25" style="font-weight:bold;">grep -B1 </span><span class="font25">one line </span><span class="font25" style="font-weight:bold;">before </span><span class="font25">the result is also displayed.</span></h4>
<p><span class="font19">paul@debian5:~/pipes$ grep -B1 Henin tennis.txt Kim Clijsters, BEL Justine Henin, Bel</span></p>
<h4><a name="bookmark1705"></a><span class="font25"><a name="bookmark1706"></a>With </span><span class="font25" style="font-weight:bold;">grep -C1 </span><span class="font25">(context) one line </span><span class="font25" style="font-weight:bold;">before </span><span class="font25">and one </span><span class="font25" style="font-weight:bold;">after </span><span class="font25">are also displayed. All three options (A,B, and C) can display any number of lines (using e.g. A2, B4 or C20).</span></h4>
<p><span class="font19">paul@debian5:~/pipes$ grep -C1 Henin tennis.txt Kim Clijsters, BEL Justine Henin, Bel Serena Williams, usa</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1707"></a><span class="font10" style="font-weight:bold;"><a name="bookmark184"></a><a name="bookmark1708"></a>19.4. cut</span></h2></li></ul>
<h4><a name="bookmark1709"></a><span class="font25"><a name="bookmark1710"></a><a name="bookmark1711"></a>The </span><span class="font25" style="font-weight:bold;">cut </span><span class="font25">filter can select columns from files, depending on a delimiter or a count of bytes.</span><br><br><span class="font25"><a name="bookmark1712"></a>The screenshot below uses </span><span class="font25" style="font-weight:bold;">cut </span><span class="font25">to filter for the username and userid in the </span><span class="font25" style="font-weight:bold;">/etc/passwd </span><span class="font25">file.</span><br><span class="font25"><a name="bookmark1713"></a>It uses the colon as a delimiter, and selects fields 1 and 3.</span></h4>
<p><span class="font19">[[paul@RHEL4b pipes]$ cut -d: -f1,3 /etc/passwd | tail -4</span></p>
<p><span class="font19">Figo:510</span></p>
<p><span class="font19">Pfaff:511</span></p>
<p><span class="font19">Harry:516</span></p>
<p><span class="font19">Hermione:517</span></p>
<p><span class="font19">[paul@RHEL4b pipes]$</span></p>
<h4><a name="bookmark1714"></a><span class="font25"><a name="bookmark1715"></a>When using a space as the delimiter for </span><span class="font25" style="font-weight:bold;">cut</span><span class="font25">, you have to quote the space.</span></h4>
<p><span class="font19">[paul@RHEL4b pipes]$ cut -d&quot; &quot;&nbsp;-f1 tennis.txt Amelie Kim Justine Serena Venus</span></p>
<p><span class="font19">[paul@RHEL4b pipes]$</span></p>
<h4><a name="bookmark1716"></a><span class="font25"><a name="bookmark1717"></a>This example uses </span><span class="font25" style="font-weight:bold;">cut </span><span class="font25">to display the second to the seventh character of </span><span class="font25" style="font-weight:bold;">/etc/passwd</span><span class="font25">.</span></h4>
<p><span class="font19">[paul@RHEL4b pipes]$ cut -c2-7 /etc/passwd | tail -4 igo:x: faff:x arry:x ermion</span></p>
<p><span class="font19">[paul@RHEL4b pipes]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1718"></a><span class="font10" style="font-weight:bold;"><a name="bookmark185"></a><a name="bookmark1719"></a>19.5. tr</span></h2></li></ul>
<h4><a name="bookmark1720"></a><span class="font25"><a name="bookmark1721"></a><a name="bookmark1722"></a>You can translate characters with </span><span class="font25" style="font-weight:bold;">tr</span><span class="font25">. The screenshot shows the translation of all occurrences of e to E.</span></h4>
<p><span class="font19">[paul@RHEL4b pipes]$ cat tennis.txt | tr 'e' 'E'</span></p>
<p><span class="font19">AmEliE MaurEsmo, Fra Kim ClijstErs, BEL JustinE HEnin, BEl SErEna Williams, usa VEnus Williams, USA</span></p>
<h4><a name="bookmark1723"></a><span class="font25"><a name="bookmark1724"></a>Here we set all letters to uppercase by defining two ranges.</span></h4>
<p><span class="font19">[paul@RHEL4b pipes]$ cat tennis.txt | tr 'a-z' 'A-Z' AMELIE MAURESMO, FRA KIM CLIJSTERS, BEL JUSTINE HENIN, BEL SERENA WILLIAMS, USA VENUS WILLIAMS, USA</span></p>
<p><span class="font19">[paul@RHEL4b pipes]$</span></p>
<h4><a name="bookmark1725"></a><span class="font25"><a name="bookmark1726"></a>Here we translate all newlines to spaces.</span></h4>
<p><span class="font19">[paul@RHEL4b pipes]$ cat count.txt one two</span></p>
<p><span class="font19">three four five [paul@RHEL4b pipes]$ cat count.txt | tr '\n' ' ' one two three four five [paul@RHEL4b pipes]$</span></p>
<h4><a name="bookmark1727"></a><span class="font25"><a name="bookmark1728"></a>The </span><span class="font25" style="font-weight:bold;">tr -s </span><span class="font25">filter can also be used to squeeze multiple occurrences of a character to one.</span></h4>
<p><span class="font19">[paul@RHEL4b pipes]$ cat spaces.txt one two &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;three</span></p>
<p><span class="font19">four five six</span></p>
<p><span class="font19">[paul@RHEL4b pipes]$ cat spaces.txt | tr -s ' ' one two three four five six</span></p>
<p><span class="font19">[paul@RHEL4b pipes]$</span></p>
<h4><a name="bookmark1729"></a><span class="font25"><a name="bookmark1730"></a><a name="bookmark1731"></a>You can also use </span><span class="font25" style="font-weight:bold;">tr </span><span class="font25">to 'encrypt' texts with </span><span class="font25" style="font-weight:bold;">rot13</span><span class="font25">.</span></h4>
<p><span class="font19">[paul@RHEL4b pipes]$ cat count.txt | tr 'a-z' 'nopqrstuvwxyzabcdefghijklm' bar gjb guerr sbhe svir</span></p>
<p><span class="font19">[paul@RHEL4b pipes]$ cat count.txt | tr 'a-z' 'n-za-m' bar gjb guerr sbhe svir</span></p>
<p><span class="font19">[paul@RHEL4b pipes]$</span></p>
<h4><a name="bookmark1732"></a><span class="font25"><a name="bookmark1733"></a>This last example uses </span><span class="font25" style="font-weight:bold;">tr -d </span><span class="font25">to delete characters.</span></h4>
<p><span class="font19">paul@debian5:~/pipes$ cat tennis.txt | tr -d e</span></p>
<p><span class="font19">Amli Maursmo, Fra Kim Clijstrs, BEL Justin Hnin, Bl Srna Williams, usa Vnus Williams, USA</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1734"></a><span class="font10" style="font-weight:bold;"><a name="bookmark186"></a><a name="bookmark1735"></a>19.6. wc</span></h2></li></ul>
<h4><a name="bookmark1736"></a><span class="font25"><a name="bookmark1737"></a><a name="bookmark1738"></a>Counting words, lines and characters is easy with </span><span class="font25" style="font-weight:bold;">wc</span><span class="font25">.</span></h4>
<p><span class="font19">[paul@RHEL4b pipes]$ wc tennis.txt</span></p>
<p><span class="font19">5 &nbsp;15 100 tennis.txt</span></p>
<p><span class="font19">[paul@RHEL4b pipes]$ wc -l tennis.txt</span></p>
<p><span class="font19">5 tennis.txt</span></p>
<p><span class="font19">[paul@RHEL4b pipes]$ wc -w tennis.txt</span></p>
<p><span class="font19">15 tennis.txt</span></p>
<p><span class="font19">[paul@RHEL4b pipes]$ wc -c tennis.txt</span></p>
<p><span class="font19">100 tennis.txt</span></p>
<p><span class="font19">[paul@RHEL4b pipes]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1739"></a><span class="font10" style="font-weight:bold;"><a name="bookmark187"></a><a name="bookmark1740"></a>19.7. sort</span></h2></li></ul>
<h4><a name="bookmark1741"></a><span class="font25"><a name="bookmark1742"></a><a name="bookmark1743"></a>The </span><span class="font25" style="font-weight:bold;">sort </span><span class="font25">filter will default to an alphabetical sort.</span></h4>
<p><span class="font19">paul@debian5:~/pipes$ cat music.txt Queen Brel Led Zeppelin Abba</span></p>
<p><span class="font19">paul@debian5:~/pipes$ sort music.txt Abba Brel Led Zeppelin Queen</span></p>
<h4><a name="bookmark1744"></a><span class="font25"><a name="bookmark1745"></a>But the </span><span class="font25" style="font-weight:bold;">sort </span><span class="font25">filter has many options to tweak its usage. This example shows sorting different columns (column 1 or column 2).</span></h4>
<p><span class="font19">[paul@RHEL4b pipes]$ sort -k1 country.txt</span></p>
<p><span class="font19">Belgium, Brussels, 10</span></p>
<p><span class="font19">France, Paris, 60</span></p>
<p><span class="font19">Germany, Berlin, 100</span></p>
<p><span class="font19">Iran, Teheran, 70</span></p>
<p><span class="font19">Italy, Rome, 50</span></p>
<p><span class="font19">[paul@RHEL4b pipes]$ sort -k2 country.txt</span></p>
<p><span class="font19">Germany, Berlin, 100</span></p>
<p><span class="font19">Belgium, Brussels, 10</span></p>
<p><span class="font19">France, Paris, 60</span></p>
<p><span class="font19">Italy, Rome, 50 Iran, Teheran, 70</span></p>
<h4><a name="bookmark1746"></a><span class="font25"><a name="bookmark1747"></a>The screenshot below shows the difference between an alphabetical sort and a numerical sort (both on the third column).</span></h4>
<p><span class="font19">[paul@RHEL4b pipes]$ sort -k3 country.txt</span></p>
<p><span class="font19">Belgium, Brussels, 10</span></p>
<p><span class="font19">Germany, Berlin, 100</span></p>
<p><span class="font19">Italy, Rome, 50</span></p>
<p><span class="font19">France, Paris, 60 Iran, Teheran, 70 [paul@RHEL4b pipes]$ sort -n -k3 country.txt Belgium, Brussels, 10 Italy, Rome, 50 France, Paris, 60 Iran, Teheran, 70 Germany, Berlin, 100</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1748"></a><span class="font10" style="font-weight:bold;"><a name="bookmark188"></a><a name="bookmark1749"></a>19.8. uniq</span></h2></li></ul>
<h4><a name="bookmark1750"></a><span class="font25"><a name="bookmark1751"></a><a name="bookmark1752"></a>With </span><span class="font25" style="font-weight:bold;">uniq </span><span class="font25">you can remove duplicates from a </span><span class="font25" style="font-weight:bold;">sorted list</span><span class="font25">.</span></h4>
<p><span class="font19">paul@debian5:~/pipes$ cat music.txt Queen Brel Queen Abba paul@debian5:~/pipes$ sort music.txt Abba Brel Queen Queen paul@debian5:~/pipes$ sort music.txt |uniq Abba Brel Queen</span></p>
<h4><a name="bookmark1753"></a><span class="font25" style="font-weight:bold;"><a name="bookmark1754"></a>uniq </span><span class="font25">can also count occurrences with the </span><span class="font25" style="font-weight:bold;">-c </span><span class="font25">option.</span></h4>
<p><span class="font19">paul@debian5:~/pipes$ sort music.txt |uniq -c 1 Abba 1 Brel 2 Queen</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1755"></a><span class="font10" style="font-weight:bold;"><a name="bookmark189"></a><a name="bookmark1756"></a>19.9. comm</span></h2></li></ul>
<h4><a name="bookmark1757"></a><span class="font25"><a name="bookmark1758"></a><a name="bookmark1759"></a>Comparing streams (or files) can be done with the </span><span class="font25" style="font-weight:bold;">comm</span><span class="font25">. By default </span><span class="font25" style="font-weight:bold;">comm </span><span class="font25">will output three columns. In this example, Abba, Cure and Queen are in both lists, Bowie and Sweet are only in the first file, Turner is only in the second.</span></h4>
<p><span class="font19">paul@debian5:~/pipes$ cat &gt;&nbsp;list1.txt Abba Bowie Cure Queen Sweet paul@debian5:~/pipes$ cat &gt;&nbsp;list2.txt Abba Cure Queen Turner paul@debian5:~/pipes$ comm list1.txt list2.txt Abba Bowie Cure Queen Sweet Turner</span></p>
<h4><a name="bookmark1760"></a><span class="font25"><a name="bookmark1761"></a>The output of </span><span class="font25" style="font-weight:bold;">comm </span><span class="font25">can be easier to read when outputting only a single column. The digits point out which output columns should not be displayed.</span></h4>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">paul@debian5:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">~/pipes$</span></p></td><td style="vertical-align:top;">
<p><span class="font19">comm</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-12</span></p></td><td style="vertical-align:top;">
<p><span class="font19">list1.txt</span></p></td><td style="vertical-align:top;">
<p><span class="font19">list2.txt</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Abba</span></p>
<p><span class="font19">Cure</span></p>
<p><span class="font19">Queen</span></p>
<p><span class="font19">paul@debian5:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~/pipes$</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">comm</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">-13</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">list1.txt</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">list2.txt</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Turner paul@debian5:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~/pipes$</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">comm</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">-23</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">list1.txt</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">list2.txt</span></p></td></tr>
</table>
<p><span class="font19">Bowie</span></p>
<p><span class="font19">Sweet</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1762"></a><span class="font10" style="font-weight:bold;"><a name="bookmark190"></a><a name="bookmark1763"></a>19.10. od</span></h2></li></ul>
<h4><a name="bookmark1764"></a><span class="font25"><a name="bookmark1765"></a><a name="bookmark1766"></a>European humans like to work with ascii characters, but computers store files in bytes. The example below creates a simple file, and then uses </span><span class="font25" style="font-weight:bold;">od </span><span class="font25">to show the contents of the file in hexadecimal bytes</span></h4>
<p><span class="font19">paul@laika:~/test$ cat &gt;&nbsp;text.txt</span></p>
<p><span class="font19">abcdefg 1234567</span></p>
<p><span class="font19">paul@laika:~/test$ od -t x1 text.txt</span></p>
<p><span class="font19">0000000 61 62 63 64 65 66 67 0a 31 32 33 34 35 36 37 0a</span></p>
<p><span class="font19">0000020</span></p>
<h4><a name="bookmark1767"></a><span class="font25"><a name="bookmark1768"></a>The same file can also be displayed in octal bytes.</span></h4>
<p><span class="font19">paul@laika:~/test$ od -b text.txt</span></p>
<p><span class="font19">0000000 141 142 143 144 145 146 147 012 061 062 063 064 065 066 067 012 0000020</span></p>
<h4><a name="bookmark1769"></a><span class="font25"><a name="bookmark1770"></a>And here is the file in ascii (or backslashed) characters.</span></h4>
<p><span class="font19">paul@laika:~/test$ od -c text.txt</span></p>
<p><span class="font19">0000000 a b c d e f g \n 1 &nbsp;&nbsp;2 &nbsp;&nbsp;3 &nbsp;&nbsp;4</span></p>
<div>
<p><span class="font19">5 &nbsp;&nbsp;&nbsp;6 &nbsp;&nbsp;&nbsp;7 \n</span></p>
</div><br clear="all">
<p><span class="font19">0000020</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1771"></a><span class="font10" style="font-weight:bold;"><a name="bookmark191"></a><a name="bookmark1772"></a>19.11. sed</span></h2></li></ul>
<h4><a name="bookmark1773"></a><span class="font25"><a name="bookmark1774"></a><a name="bookmark1775"></a>The </span><span class="font25" style="font-weight:bold;">s</span><span class="font25">tream </span><span class="font25" style="font-weight:bold;">ed</span><span class="font25">itor </span><span class="font25" style="font-weight:bold;">sed </span><span class="font25">can perform editing functions in the stream, using </span><span class="font25" style="font-weight:bold;">regular expressions</span><span class="font25">.</span></h4>
<p><span class="font19">paul@debian5:~/pipes$ echo level5 | sed 's/5/42/'</span></p>
<p><span class="font19">level42</span></p>
<p><span class="font19">paul@debian5:~/pipes$ echo level5 | sed 's/level/jump/' jump5</span></p>
<h4><a name="bookmark1776"></a><span class="font25"><a name="bookmark1777"></a>Add </span><span class="font25" style="font-weight:bold;">g </span><span class="font25">for global replacements (all occurrences of the string per line).</span></h4>
<p><span class="font19">paul@debian5:~/pipes$ echo level5 level7 | sed 's/level/jump/' jump5 level7</span></p>
<p><span class="font19">paul@debian5:~/pipes$ echo level5 level7 | sed 's/level/jump/g' jump5 jump7</span></p>
<h4><a name="bookmark1778"></a><span class="font25"><a name="bookmark1779"></a>With </span><span class="font25" style="font-weight:bold;">d </span><span class="font25">you can remove lines from a stream containing a character.</span></h4>
<p><span class="font19">paul@debian5:~/test42$ cat tennis.txt</span></p>
<p><span class="font19">Venus Williams, USA Martina Hingis, SUI Justine Henin, BE Serena williams, USA Kim Clijsters, BE Yanina Wickmayer, BE paul@debian5:~/test42$ cat tennis.txt | sed '/BE/d' Venus Williams, USA Martina Hingis, SUI Serena williams, USA</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1780"></a><span class="font10" style="font-weight:bold;"><a name="bookmark192"></a><a name="bookmark1781"></a>19.12. pipe examples</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark1782"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1783"></a>19.12.1. who | wc</span></h3></li></ul></li></ul>
<h4><a name="bookmark1784"></a><span class="font25"><a name="bookmark1785"></a><a name="bookmark1786"></a>How many users are logged on to this system</span></h4>
<p><span class="font19">[paul@RHEL4b pipes]$ who</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tty1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Jul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">25</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10:50</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Jul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">25</span></p></td><td style="vertical-align:top;">
<p><span class="font19">09:29 (laika)</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Harry</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Jul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">25</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12:26 (barry)</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Jul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">25</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12:26 (pasha)</span></p></td></tr>
<tr><td colspan="2" style="vertical-align:top;">
<p><span class="font19">[paul@RHEL4b pipes]$</span></p></td><td style="vertical-align:top;">
<p><span class="font19">who</span></p></td><td style="vertical-align:top;">
<p><span class="font19">| wc</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-l</span></p></td></tr>
</table>
<p><span class="font19">4</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1787"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1788"></a>19.12.2. who | cut | sort</span></h3></li></ul>
<h4><a name="bookmark1789"></a><span class="font25"><a name="bookmark1790"></a><a name="bookmark1791"></a>Display a sorted list of logged on users.</span></h4>
<p><span class="font19">[paul@RHEL4b pipes]$ who | cut -d' ' -fl | sort Harry paul paul root</span></p>
<h4><a name="bookmark1792"></a><span class="font25"><a name="bookmark1793"></a><a name="bookmark1794"></a><a name="bookmark1795"></a>Display a sorted list of logged on users, but every user only once .</span></h4>
<p><span class="font19">[paul@RHEL4b pipes]$ who | cut -d' ' -fl | sort | uniq Harry paul root</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1796"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1797"></a>19.12.3. grep | cut</span></h3></li></ul>
<h4><a name="bookmark1798"></a><span class="font25"><a name="bookmark1799"></a><a name="bookmark1800"></a>Display a list of all bash </span><span class="font25" style="font-weight:bold;">user accounts </span><span class="font25">on this computer. Users accounts are explained in detail later.</span></h4>
<p><span class="font19">paul@debian5:~$ grep bash /etc/passwd root:x:0:0:root:/root:/bin/bash</span></p>
<p><span class="font19">paul:x:1000:1000:paul,,,:/home/paul:/bin/bash serena:x:1001:1001::/home/serena:/bin/bash</span></p>
<p><span class="font19">paul@debian5:~$ grep bash /etc/passwd | cut -d: -f1 root</span></p>
<p><span class="font19">paul serena</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1801"></a><span class="font10" style="font-weight:bold;"><a name="bookmark193"></a><a name="bookmark1802"></a>19.13. practice: filters</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Put a sorted list of all bash users in bashusers.txt.</span></p></li>
<li>
<p><span class="font25">2. Put a sorted list of all logged on users in onlineusers.txt.</span></p></li>
<li>
<p><span class="font25">3. Make a list of all filenames in </span><span class="font25" style="font-weight:bold;">/etc </span><span class="font25">that contain the string </span><span class="font25" style="font-weight:bold;">conf </span><span class="font25">in their filename.</span></p></li>
<li>
<p><span class="font25">4. Make a sorted list of all files in </span><span class="font25" style="font-weight:bold;">/etc </span><span class="font25">that contain the case insensitive string </span><span class="font25" style="font-weight:bold;">conf </span><span class="font25">in their filename.</span></p></li>
<li>
<p><span class="font25">5. Look at the output of </span><span class="font25" style="font-weight:bold;">/sbin/ifconfig</span><span class="font25">. Write a line that displays only ip address and the subnet mask.</span></p></li>
<li>
<p><span class="font25">6. Write a line that removes all non-letters from a stream.</span></p></li>
<li>
<p><span class="font25">7. Write a line that receives a text file, and outputs all words on a separate line.</span></p></li>
<li>
<p><span class="font25">8. Write a spell checker on the command line. (There may be a dictionary in </span><span class="font25" style="font-weight:bold;">/usr/share/ dict/ </span><span class="font25">.)</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1803"></a><span class="font10" style="font-weight:bold;"><a name="bookmark194"></a><a name="bookmark1804"></a>19.14. solution: filters</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Put a sorted list of all bash users in bashusers.txt.</span></p></li></ul>
<p><span class="font19">grep bash /etc/passwd | cut -d: -fl | sort &gt;&nbsp;bashusers.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Put a sorted list of all logged on users in onlineusers.txt.</span></p></li></ul>
<p><span class="font19">who | cut -d' ' -fl | sort &gt;&nbsp;onlineusers.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Make a list of all filenames in </span><span class="font25" style="font-weight:bold;">/etc </span><span class="font25">that contain the string </span><span class="font25" style="font-weight:bold;">conf </span><span class="font25">in their filename.</span></p></li></ul>
<p><span class="font19">ls /etc | grep conf</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Make a sorted list of all files in </span><span class="font25" style="font-weight:bold;">/etc </span><span class="font25">that contain the case insensitive string </span><span class="font25" style="font-weight:bold;">conf </span><span class="font25">in their filename.</span></p></li></ul>
<p><span class="font19">ls /etc | grep -i conf | sort</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Look at the output of </span><span class="font25" style="font-weight:bold;">/sbin/ifconfig</span><span class="font25">. Write a line that displays only ip address and the subnet mask.</span></p></li></ul>
<p><span class="font19">/sbin/ifconfig | head -2 | grep 'inet ' | tr -s ' ' | cut -d' ' -f3,5</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Write a line that removes all non-letters from a stream.</span></p></li></ul>
<p><span class="font19">paul@deb503:~$ cat text</span></p>
<p><span class="font19">This is, yes really! , a text with ?&amp;* too many str$ange# characters ;-) paul@deb503:~$ cat text | tr -d ',1$?.*&amp;</span><span class="font18"><sup>A</sup></span><span class="font19">%#@;()-'</span></p>
<p><span class="font19">This is yes really a text with too many strange characters</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. Write a line that receives a text file, and outputs all words on a separate line.</span></p></li></ul>
<p><span class="font19">paul@deb503:~$ cat text2</span></p>
<p><span class="font19">it is very cold today without the sun</span></p>
<p><span class="font19">paul@deb503:~$ cat text2 | tr ' ' '\n' it</span></p>
<p><span class="font19">is</span></p>
<p><span class="font19">very cold today without the</span></p>
<p><span class="font19">sun</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. Write a spell checker on the command line. (There may be a dictionary in </span><span class="font25" style="font-weight:bold;">/usr/share/ dict/ </span><span class="font25">.)</span></p></li></ul>
<p><span class="font19">paul@rhel ~$ echo &quot;The zun is shining today&quot; &gt;&nbsp;text</span></p>
<p><span class="font19">paul@rhel ~$ cat &gt;&nbsp;DICT is shining sun the</span></p>
<p><span class="font19">today</span></p>
<p><span class="font19">paul@rhel ~$ cat text | tr 'A-Z ' 'a-z\n' | sort | uniq | comm -23 - DICT zun</span></p>
<p><span class="font25">You could also add the solution from question number 6 to remove non-letters, and </span><span class="font25" style="font-weight:bold;">tr -s ' ' </span><span class="font25">to remove redundant spaces.</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark1805"></a><span class="font11" style="font-weight:bold;"><a name="bookmark195"></a><a name="bookmark1806"></a>Chapter 20. basic Unix tools</span></h1></li></ul>
<p><span class="font25">This chapter introduces commands to </span><span class="font25" style="font-weight:bold;">find </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">locate </span><span class="font25">files and to </span><span class="font25" style="font-weight:bold;">compress </span><span class="font25">files, together with other common tools that were not discussed before. While the tools discussed here are technically not considered </span><span class="font25" style="font-weight:bold;">filters</span><span class="font25">, they can be used in </span><span class="font25" style="font-weight:bold;">pipes</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1807"></a><span class="font10" style="font-weight:bold;"><a name="bookmark196"></a><a name="bookmark1808"></a>20.1. find</span></h2></li></ul>
<p><a name="bookmark1809"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">find </span><span class="font25">command can be very useful at the start of a pipe to search for files. Here are some examples. You might want to add </span><span class="font25" style="font-weight:bold;">2&gt;/dev/null </span><span class="font25">to the command lines to avoid cluttering your screen with error messages.</span></p>
<p><span class="font25">Find all files in </span><span class="font25" style="font-weight:bold;">/etc </span><span class="font25">and put the list in etcfiles.txt</span></p>
<p><span class="font19">find /etc &gt;&nbsp;etcfiles.txt</span></p>
<p><span class="font25">Find all files of the entire system and put the list in allfiles.txt</span></p>
<p><span class="font19">find / &gt;&nbsp;allfiles.txt</span></p>
<p><span class="font25">Find files that end in .conf in the current directory (and all subdirs).</span></p>
<p><span class="font19">find . -name &quot;*.conf&quot;</span></p>
<p><span class="font25">Find files of type file (not directory, pipe or etc.) that end in .conf.</span></p>
<p><span class="font19">find . -type f -name &quot;*.conf&quot;</span></p>
<p><span class="font25">Find files of type directory that end in .bak .</span></p>
<p><span class="font19">find /data -type d -name &quot;*.bak&quot;</span></p>
<p><span class="font25">Find files that are newer than file42.txt</span></p>
<p><span class="font19">find . -newer file42.txt</span></p>
<p><span class="font25">Find can also execute another command on every file found. This example will look for *.odf files and copy them to /backup/.</span></p>
<p><span class="font19">find /data -name &quot;*.odf&quot; -exec cp {} /backup/ \;</span></p>
<p><span class="font25">Find can also execute, after your confirmation, another command on every file found. This example will remove *.odf files if you approve of it for every file found.</span></p>
<p><span class="font19">find /data -name &quot;*.odf&quot; -ok rm {} \;</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1810"></a><span class="font10" style="font-weight:bold;"><a name="bookmark197"></a><a name="bookmark1811"></a>20.2. locate</span></h2></li></ul>
<p><a name="bookmark1812"></a><span class="font25"><a name="bookmark1813"></a>The </span><span class="font25" style="font-weight:bold;">locate </span><span class="font25">tool is very different from </span><span class="font25" style="font-weight:bold;">find </span><span class="font25">in that it uses an index to locate files. This is a lot faster than traversing all the directories, but it also means that it is always outdated. If the index does not exist yet, then you have to create it (as root on Red Hat Enterprise Linux) with the </span><span class="font25" style="font-weight:bold;">updatedb </span><span class="font25">command.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ locate Samba</span></p>
<p><span class="font19">warning: locate: could not open database: /var/lib/slocate/slocate.db:... warning: You need to run the 'updatedb' command (as root) to create th... Please have a look at /etc/updatedb.conf to enable the daily cron job. [paul@RHEL4b ~]$ updatedb</span></p>
<p><span class="font19">fatal error: updatedb: You are not authorized to create a default sloc...</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ su -</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">[root@RHEL4b ~]# updatedb</span></p>
<p><span class="font19">[root@RHEL4b ~]#</span></p>
<p><span class="font25">Most Linux distributions will schedule the </span><span class="font25" style="font-weight:bold;">updatedb </span><span class="font25">to run once every day.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1814"></a><span class="font10" style="font-weight:bold;"><a name="bookmark198"></a><a name="bookmark1815"></a>20.3. date</span></h2></li></ul>
<p><a name="bookmark1816"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">date </span><span class="font25">command can display the date, time, time zone and more.</span></p>
<p><span class="font19">paul@rhel55 ~$ date</span></p>
<p><span class="font19">Sat Apr 17 12:44:30 CEST 2010</span></p>
<p><span class="font25">A date string can be customised to display the format of your choice. Check the man page for more options.</span></p>
<p><span class="font19">paul@rhel55 ~$ date +'%A %d-%m-%Y' Saturday 17-04-2010</span></p>
<p><span class="font25">Time on any Unix is calculated in number of seconds since 1969 (the first second being the first second of the first of January 1970). Use </span><span class="font25" style="font-weight:bold;">date +%s </span><span class="font25">to display Unix time in seconds.</span></p>
<p><span class="font19">paul@rhel55 ~$ date +%s</span></p>
<p><span class="font19">1271501080</span></p>
<p><span class="font25">When will this seconds counter reach two thousand million ?</span></p>
<p><span class="font19">paul@rhel55 ~$ date -d '1970-01-01 + 2000000000 seconds'</span></p>
<p><span class="font19">Wed May 18 04:33:20 CEST 2033</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1817"></a><span class="font10" style="font-weight:bold;"><a name="bookmark199"></a><a name="bookmark1818"></a>20.4. cal</span></h2></li></ul>
<p><a name="bookmark1819"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">cal </span><span class="font25">command displays the current month, with the current day highlighted.</span></p>
<p><span class="font19">paul@rhel55 ~$ cal April 2010</span></p>
<p><a href="#bookmark1820"><span class="font19">Su Mo Tu We Th Fr Sa 1 &nbsp;&nbsp;2</span></a></p>
<p><a href="#bookmark1821"><span class="font19">4 &nbsp;&nbsp;5 &nbsp;&nbsp;6 &nbsp;&nbsp;7 &nbsp;&nbsp;8 &nbsp;&nbsp;9</span></a></p>
<p><a href="#bookmark1822"><span class="font19">11 12 13 14 15 16</span></a></p>
<p><a href="#bookmark1823"><span class="font19">18 19 20 21 22 23</span></a></p>
<p><a href="#bookmark1824"><span class="font19">25 26 27 28 29</span></a></p>
<p><span class="font25">You can select any month in the past or the future.</span></p>
<p><span class="font19">paul@rhel55 ~$ cal 2 1970 February 1970</span></p>
<p><a href="#bookmark1825"><span class="font19">Su Mo Tu We Th Fr</span></a></p>
<p><a href="#bookmark1826"><span class="font19">1 &nbsp;&nbsp;2 &nbsp;&nbsp;3 &nbsp;&nbsp;4 &nbsp;&nbsp;5 &nbsp;&nbsp;6</span></a></p>
<p><a href="#bookmark1827"><span class="font19">8 &nbsp;9 10 11 12 13</span></a></p>
<p><a href="#bookmark1828"><span class="font19">15 16 17 18 19 20</span></a></p>
<p><a href="#bookmark1829"><span class="font19">22 23 24 25 26 27</span></a></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1830"></a><span class="font10" style="font-weight:bold;"><a name="bookmark200"></a><a name="bookmark1831"></a>20.5. sleep</span></h2></li></ul>
<p><a name="bookmark1832"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">sleep </span><span class="font25">command is sometimes used in scripts to wait a number of seconds. This example shows a five second </span><span class="font25" style="font-weight:bold;">sleep</span><span class="font25">.</span></p>
<p><span class="font19">paul@rhel55 ~$ sleep 5</span></p>
<p><span class="font19">paul@rhel55 ~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1833"></a><span class="font10" style="font-weight:bold;"><a name="bookmark201"></a><a name="bookmark1834"></a>20.6. time</span></h2></li></ul>
<p><a name="bookmark1835"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">time </span><span class="font25">command can display how long it takes to execute a command. The </span><span class="font25" style="font-weight:bold;">date </span><span class="font25">command takes only a little time.</span></p>
<p><span class="font19">paul@rhel55 ~$ time date</span></p>
<p><span class="font19">Sat Apr 17 13:08:27 CEST 2010</span></p>
<p><span class="font19">real 0m0.014s</span></p>
<p><span class="font19">user &nbsp;&nbsp;&nbsp;0m0.008s</span></p>
<p><span class="font19">sys &nbsp;&nbsp;&nbsp;&nbsp;0m0.006s</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">sleep 5 </span><span class="font25">command takes five </span><span class="font25" style="font-weight:bold;">real </span><span class="font25">seconds to execute, but consumes little </span><span class="font25" style="font-weight:bold;">cpu time</span><span class="font25">.</span></p>
<p><span class="font19">paul@rhel55 ~$ time sleep 5</span></p>
<p><span class="font19">real &nbsp;&nbsp;&nbsp;0m5.018s</span></p>
<p><span class="font19">user &nbsp;&nbsp;&nbsp;0m0.005s</span></p>
<p><span class="font19">sys &nbsp;&nbsp;&nbsp;&nbsp;0m0.011s</span></p>
<p><a name="bookmark1836"></a><span class="font25">This </span><span class="font25" style="font-weight:bold;">bzip2 </span><span class="font25">command compresses a file and uses a lot of </span><span class="font25" style="font-weight:bold;">cpu time</span><span class="font25">.</span></p>
<p><span class="font19">paul@rhel55 ~$ time bzip2 text.txt</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">real user sys</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0m2.368s</span></p>
<p><span class="font19">0m0.847s</span></p>
<p><span class="font19">0m0.539s</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1837"></a><span class="font10" style="font-weight:bold;"><a name="bookmark202"></a><a name="bookmark1838"></a>20.7. gzip - gunzip</span></h2></li></ul>
<h4><a name="bookmark1839"></a><span class="font25"><a name="bookmark1840"></a><a name="bookmark1841"></a>Users never have enough disk space, so compression comes in handy. The </span><span class="font25" style="font-weight:bold;">gzip </span><span class="font25">command can make files take up less space.</span></h4>
<p><span class="font19">paul@rhel55 ~$ ls -lh text.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-rw-r-- 1 paul paul 6.4M Apr 17 13:11 text.txt</span></p></li></ul>
<p><span class="font19">paul@rhel55 ~$ gzip text.txt</span></p>
<p><span class="font19">paul@rhel55 ~$ ls -lh text.txt.gz</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-rw-r-- 1 paul paul 760K Apr 17 13:11 text.txt.gz</span></p></li></ul>
<h4><a name="bookmark1842"></a><span class="font25"><a name="bookmark1843"></a><a name="bookmark1844"></a>You can get the original back with </span><span class="font25" style="font-weight:bold;">gunzip</span><span class="font25">.</span></h4>
<p><span class="font19">paul@rhel55 ~$ gunzip text.txt.gz</span></p>
<p><span class="font19">paul@rhel55 ~$ ls -lh text.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-rw-r-- 1 paul paul 6.4M Apr 17 13:11 text.txt</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1845"></a><span class="font10" style="font-weight:bold;"><a name="bookmark203"></a><a name="bookmark1846"></a>20.8. zcat - zmore</span></h2></li></ul>
<h4><a name="bookmark1847"></a><span class="font25"><a name="bookmark1848"></a><a name="bookmark1849"></a><a name="bookmark1850"></a><a name="bookmark1851"></a>Text files that are compressed with </span><span class="font25" style="font-weight:bold;">gzip </span><span class="font25">can be viewed with </span><span class="font25" style="font-weight:bold;">zcat </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">zmore</span><span class="font25">.</span></h4>
<p><span class="font19">paul@rhel55 ~$ head -4 text.txt / /opt</span></p>
<p><span class="font19">/opt/VBoxGuestAdditions-3.1.6</span></p>
<p><span class="font19">/opt/VBoxGuestAdditions-3.1.6/routines.sh</span></p>
<p><span class="font19">paul@rhel55 ~$ gzip text.txt</span></p>
<p><span class="font19">paul@rhel55 ~$ zcat text.txt.gz | head -4 / /opt</span></p>
<p><span class="font19">/opt/VBoxGuestAdditions-3.1.6</span></p>
<p><span class="font19">/opt/VBoxGuestAdditions-3.1.6/routines.sh</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1852"></a><span class="font10" style="font-weight:bold;"><a name="bookmark204"></a><a name="bookmark1853"></a>20.9. bzip2 - bunzip2</span></h2></li></ul>
<h4><a name="bookmark1854"></a><span class="font25"><a name="bookmark1855"></a><a name="bookmark1856"></a>Files can also be compressed with </span><span class="font25" style="font-weight:bold;">bzip2 </span><span class="font25">which takes a little more time than </span><span class="font25" style="font-weight:bold;">gzip</span><span class="font25">, but compresses better.</span></h4>
<p><span class="font19">paul@rhel55 ~$ bzip2 text.txt</span></p>
<p><span class="font19">paul@rhel55 ~$ ls -Ih text.txt.bz2</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-rw-r-- 1 paul paul 569K Apr 17 13:11 text.txt.bz2</span></p></li></ul>
<h4><a name="bookmark1857"></a><span class="font25"><a name="bookmark1858"></a><a name="bookmark1859"></a>Files can be uncompressed again with </span><span class="font25" style="font-weight:bold;">bunzip2</span><span class="font25">.</span></h4>
<p><span class="font19">paul@rhel55 ~$ bunzip2 text.txt.bz2</span></p>
<p><span class="font19">paul@rhel55 ~$ ls -lh text.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-rw-r-- 1 paul paul 6.4M Apr 17 13:11 text.txt</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1860"></a><span class="font10" style="font-weight:bold;"><a name="bookmark205"></a><a name="bookmark1861"></a>20.10. bzcat - bzmore</span></h2></li></ul>
<h4><a name="bookmark1862"></a><span class="font25"><a name="bookmark1863"></a><a name="bookmark1864"></a><a name="bookmark1865"></a><a name="bookmark1866"></a>And in the same way </span><span class="font25" style="font-weight:bold;">bzcat </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">bzmore </span><span class="font25">can display files compressed with </span><span class="font25" style="font-weight:bold;">bzip2</span><span class="font25">.</span></h4>
<p><span class="font19">paul@rhel55 ~$ bzip2 text.txt</span></p>
<p><span class="font19">paul@rhel55 ~$ bzcat text.txt.bz2 | head -4 / /opt</span></p>
<p><span class="font19">/opt/VBoxGuestAdditions-3.1.6</span></p>
<p><span class="font19">/opt/VBoxGuestAdditions-3.1.6/routines.sh</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1867"></a><span class="font10" style="font-weight:bold;"><a name="bookmark206"></a><a name="bookmark1868"></a>20.11. practice: basic Unix tools</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Explain the difference between these two commands. This question is very important. If you don't know the answer, then look back at the </span><span class="font25" style="font-weight:bold;">shell </span><span class="font25">chapter.</span></p></li></ul>
<p><span class="font19">find /data -name &quot;*.txt&quot;</span></p>
<p><span class="font19">find /data -name *.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Explain the difference between these two statements. Will they both work when there are 200 </span><span class="font25" style="font-weight:bold;">.odf </span><span class="font25">files in </span><span class="font25" style="font-weight:bold;">/data </span><span class="font25">? How about when there are 2 million .odf files ?</span></p></li></ul>
<p><span class="font19">find /data -name &quot;*.odf&quot; &gt;&nbsp;data_odf.txt</span></p>
<p><span class="font19">find /data/*.odf &gt;&nbsp;data_odf.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Write a find command that finds all files created after January 30th 2010.</span></p></li>
<li>
<p><span class="font25">4. Write a find command that finds all *.odf files created in September 2009.</span></p></li>
<li>
<p><span class="font25">5. Count the number of *.conf files in /etc and all its subdirs.</span></p></li>
<li>
<p><span class="font25">6. Here are two commands that do the same thing: copy *.odf files to /backup/ . What would be a reason to replace the first command with the second ? Again, this is an important question.</span></p></li></ul>
<p><span class="font19">cp -r /data/*.odf /backup/</span></p>
<p><span class="font19">find /data -name &quot;*.odf&quot; -exec cp {} /backup/ \;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. Create a file called </span><span class="font25" style="font-weight:bold;">loctest.txt</span><span class="font25">. Can you find this file with </span><span class="font25" style="font-weight:bold;">locate </span><span class="font25">? Why not ? How do you make locate find this file ?</span></p></li>
<li>
<p><span class="font25">8. Use find and -exec to rename all .htm files to .html.</span></p></li>
<li>
<p><span class="font25">9. Issue the </span><span class="font25" style="font-weight:bold;">date </span><span class="font25">command. Now display the date in YYYY/MM/DD format.</span></p></li>
<li>
<p><span class="font25">10. Issue the </span><span class="font25" style="font-weight:bold;">cal </span><span class="font25">command. Display a calendar of 1582 and 1752. Notice anything special ?</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1869"></a><span class="font10" style="font-weight:bold;"><a name="bookmark207"></a><a name="bookmark1870"></a>20.12. solution: basic Unix tools</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Explain the difference between these two commands. This question is very important. If you don't know the answer, then look back at the </span><span class="font25" style="font-weight:bold;">shell </span><span class="font25">chapter.</span></p></li></ul>
<p><span class="font19">find /data -name &quot;*.txt&quot;</span></p>
<p><span class="font19">find /data -name *.txt</span></p>
<p><span class="font25">When </span><span class="font25" style="font-weight:bold;">*.txt </span><span class="font25">is quoted then the shell will not touch it. The </span><span class="font25" style="font-weight:bold;">find </span><span class="font25">tool will look in the </span><span class="font25" style="font-weight:bold;">/data </span><span class="font25">for all files ending in </span><span class="font25" style="font-weight:bold;">.txt</span><span class="font25">.</span></p>
<p><span class="font25">When </span><span class="font25" style="font-weight:bold;">*.txt </span><span class="font25">is not quoted then the shell might expand this (when one or more files that ends in </span><span class="font25" style="font-weight:bold;">.txt </span><span class="font25">exist in the current directory). The </span><span class="font25" style="font-weight:bold;">find </span><span class="font25">might show a different result, or can result in a syntax error.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Explain the difference between these two statements. Will they both work when there are 200 </span><span class="font25" style="font-weight:bold;">.odf </span><span class="font25">files in </span><span class="font25" style="font-weight:bold;">/data </span><span class="font25">? How about when there are 2 million .odf files ?</span></p></li></ul>
<p><span class="font19">find /data -name &quot;*.odf&quot; &gt;&nbsp;data_odf.txt</span></p>
<p><span class="font19">find /data/*.odf &gt;&nbsp;data_odf.txt</span></p>
<p><span class="font25">The first </span><span class="font25" style="font-weight:bold;">find </span><span class="font25">will output all </span><span class="font25" style="font-weight:bold;">.odf </span><span class="font25">filenames in </span><span class="font25" style="font-weight:bold;">/data </span><span class="font25">and all subdirectories. The shell will redirect this to a file.</span></p>
<p><span class="font25">The second find will output all files named </span><span class="font25" style="font-weight:bold;">.odf </span><span class="font25">in </span><span class="font25" style="font-weight:bold;">/data </span><span class="font25">and will also output all files that exist in directories named </span><span class="font25" style="font-weight:bold;">*.odf </span><span class="font25">(in </span><span class="font25" style="font-weight:bold;">/data</span><span class="font25">).</span></p>
<p><span class="font25">With two million files the command line would be expanded beyond the maximum that the shell can accept. The last part of the command line would be lost.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Write a find command that finds all files created after January 30th 2010.</span></p></li></ul>
<p><span class="font19">touch -t 201001302359 marker_date find . -type f -newer marker_date</span></p>
<p><span class="font19">There is another solution : find . -type f -newerat &quot;20100130 23:59:59&quot;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Write a find command that finds all *.odf files created in September 2009.</span></p></li></ul>
<p><span class="font19">touch -t 200908312359 marker_start</span></p>
<p><span class="font19">touch -t 200910010000 marker_end</span></p>
<p><span class="font19">find . -type f -name &quot;*.odf&quot; -newer marker_start ! -newer marker_end</span></p>
<p><span class="font25">The exclamation mark </span><span class="font25" style="font-weight:bold;">! -newer </span><span class="font25">can be read as </span><span class="font25" style="font-weight:bold;">not newer</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Count the number of *.conf files in /etc and all its subdirs.</span></p></li></ul>
<p><span class="font19">find /etc -type f -name '*.conf' | wc -l</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Here are two commands that do the same thing: copy *.odf files to /backup/ . What would be a reason to replace the first command with the second ? Again, this is an important question.</span></p></li></ul>
<p><span class="font19">cp -r /data/*.odf /backup/</span></p>
<p><span class="font19">find /data -name &quot;*.odf&quot; -exec cp {} /backup/ \;</span></p>
<p><span class="font25">The first might fail when there are too many files to fit on one command line.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. Create a file called </span><span class="font25" style="font-weight:bold;">loctest.txt</span><span class="font25">. Can you find this file with </span><span class="font25" style="font-weight:bold;">locate </span><span class="font25">? Why not ? How do you make locate find this file ?</span></p></li></ul>
<p><span class="font25">You cannot locate this with </span><span class="font25" style="font-weight:bold;">locate </span><span class="font25">because it is not yet in the index. </span><span class="font19">updatedb</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. Use find and -exec to rename all .htm files to .html.</span></p></li></ul>
<p><span class="font19">paul@rhel55 ~$ find</span></p>
<div>
<p><span class="font19">-name '*.htm'</span></p>
</div><br clear="all">
<div>
<p><span class="font19">-name '*.htm' -exec mv {} {}l \;</span></p>
<p><span class="font19">-name '*.htm*'</span></p>
</div><br clear="all">
<p><span class="font19">./one.htm</span></p>
<p><span class="font19">./two.htm</span></p>
<p><span class="font19">paul@rhel55 ~$ find</span></p>
<p><span class="font19">paul@rhel55 ~$ find</span></p>
<p><span class="font19">./one.html</span></p>
<p><span class="font19">./two.html</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">9. Issue the </span><span class="font25" style="font-weight:bold;">date </span><span class="font25">command. Now display the date in YYYY/MM/DD format.</span></p></li></ul>
<p><span class="font19">date +%Y/%m/%d</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">10. Issue the </span><span class="font25" style="font-weight:bold;">cal </span><span class="font25">command. Display a calendar of 1582 and 1752. Notice anything special ? </span><span class="font19">cal 1582</span></p></li></ul>
<p><span class="font25">The calendars are different depending on the country. Check </span><a href="http://linux-training.be/files/"><span class="font25">http://linux-training.be/files/</span></a><span class="font25"> studentfiles/dates.txt</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark1871"></a><span class="font11" style="font-weight:bold;"><a name="bookmark208"></a><a name="bookmark1872"></a>Chapter 21. regular expressions</span></h1></li></ul>
<p><span class="font25" style="font-weight:bold;">Regular expressions </span><span class="font25">are a very powerful tool in Linux. They can be used with a variety of programs like bash, vi, rename, grep, sed, and more.</span></p>
<p><span class="font25">This chapter introduces you to the basics of </span><span class="font25" style="font-weight:bold;">regular expressions</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1873"></a><span class="font10" style="font-weight:bold;"><a name="bookmark209"></a><a name="bookmark1874"></a>21.1. regex versions</span></h2></li></ul>
<p><span class="font25">There are three different versions of regular expression syntax:</span></p>
<p><span class="font19">BRE: Basic Regular Expressions</span></p>
<p><span class="font19">ERE: Extended Regular Expressions</span></p>
<p><span class="font19">PRCE: Perl Regular Expressions</span></p>
<p><span class="font25">Depending on the tool being used, one or more of these syntaxes can be used.</span></p>
<p><a name="bookmark1875"></a><span class="font25">For example the </span><span class="font25" style="font-weight:bold;">grep </span><span class="font25">tool has the </span><span class="font25" style="font-weight:bold;">-E </span><span class="font25">option to force a string to be read as ERE while </span><span class="font25" style="font-weight:bold;">-G </span><span class="font25">forces BRE and </span><span class="font25" style="font-weight:bold;">-P </span><span class="font25">forces PRCE.</span></p>
<p><span class="font25">Note that </span><span class="font25" style="font-weight:bold;">grep </span><span class="font25">also has </span><span class="font25" style="font-weight:bold;">-F </span><span class="font25">to force the string to be read literally.</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">sed </span><span class="font25">tool also has options to choose a regex syntax.</span></p>
<p><span class="font25" style="font-weight:bold;">Read the manual of the tools you use!</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1876"></a><span class="font10" style="font-weight:bold;"><a name="bookmark210"></a><a name="bookmark1877"></a>21.2. grep</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark1878"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1879"></a>21.2.1. print lines matching a pattern</span></h3></li></ul></li></ul>
<p><a name="bookmark1880"></a><span class="font25" style="font-weight:bold;">grep </span><span class="font25">is a popular Linux tool to search for lines that match a certain pattern. Below are some examples of the simplest </span><span class="font25" style="font-weight:bold;">regular expressions</span><span class="font25">.</span></p>
<p><span class="font25">This is the contents of the test file. This file contains three lines (or three </span><span class="font25" style="font-weight:bold;">newline </span><span class="font25">characters).</span></p>
<p><span class="font19">paul@rhel65:~$ cat names</span></p>
<p><span class="font19">Tania</span></p>
<p><span class="font19">Laura</span></p>
<p><span class="font19">Valentina</span></p>
<p><span class="font25">When </span><span class="font25" style="font-weight:bold;">grepping </span><span class="font25">for a single character, only the lines containing that character are returned.</span></p>
<p><span class="font19">paul@rhel65:~$ grep u names Laura</span></p>
<p><span class="font19">paul@rhel65:~$ grep e names Valentina</span></p>
<p><span class="font19">paul@rhel65:~$ grep i names Tania</span></p>
<p><span class="font19">Valentina</span></p>
<p><span class="font25">The pattern matching in this example should be very straightforward; if the given character occurs on a line, then </span><span class="font25" style="font-weight:bold;">grep </span><span class="font25">will return that line.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1881"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1882"></a>21.2.2. concatenating characters</span></h3></li></ul>
<p><span class="font25">Two concatenated characters will have to be concatenated in the same way to have a match.</span></p>
<p><span class="font25">This example demonstrates that </span><span class="font25" style="font-weight:bold;">ia </span><span class="font25">will match Tan</span><span class="font25" style="font-weight:bold;">ia </span><span class="font25">but not V</span><span class="font25" style="font-weight:bold;">a</span><span class="font25">lent</span><span class="font25" style="font-weight:bold;">i</span><span class="font25">na and </span><span class="font25" style="font-weight:bold;">in </span><span class="font25">will match Valent</span><span class="font25" style="font-weight:bold;">in</span><span class="font25">a but not Ta</span><span class="font25" style="font-weight:bold;">ni</span><span class="font25">a. </span><span class="font19">paul@rhel65:~$ grep a names Tania Laura Valentina paul@rhel65:~$ grep ia names Tania paul@rhel65:~$ grep in names Valentina paul@rhel65:~$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1883"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1884"></a>21.2.3. one or the other</span></h3></li></ul>
<p><span class="font25">PRCE and ERE both use the pipe symbol to signify OR. In this example we </span><span class="font25" style="font-weight:bold;">grep </span><span class="font25">for lines containing the letter i or the letter a. </span><span class="font19">paul@debian7:~$ cat list Tania Laura paul@debian7:~$ grep -E 'i|a' list Tania Laura</span></p>
<p><span class="font25">Note that we use the </span><span class="font25" style="font-weight:bold;">-E </span><span class="font25">switch of grep to force interpretion of our string as an ERE.</span></p>
<p><span class="font25">We need to </span><span class="font25" style="font-weight:bold;">escape </span><span class="font25">the pipe symbol in a BRE to get the same logical OR.</span></p>
<p><span class="font19">paul@debian7:~$ grep -G 'i|a' list paul@debian7:~$ grep -G 'i\|a' list Tania Laura</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1885"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1886"></a>21.2.4. one or more</span></h3></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">* </span><span class="font25">signifies zero, one or more occurences of the previous and the </span><span class="font25" style="font-weight:bold;">+ </span><span class="font25">signifies one or more of the previous.</span></p>
<p><span class="font19">paul@debian7:~$ cat list2 ll lol lool loool</span></p>
<p><span class="font19">paul@debian7:~$ grep -E 'o*' list2 ll lol lool loool</span></p>
<p><span class="font19">paul@debian7:~$ grep -E 'o+' list2 lol lool loool paul@debian7:~$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1887"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1888"></a>21.2.5. match the end of a string</span></h3></li></ul>
<p><span class="font25">For the following examples, we will use this file.</span></p>
<p><span class="font19">paul@debian7:~$ cat names</span></p>
<p><span class="font19">Tania</span></p>
<p><span class="font19">Laura</span></p>
<p><span class="font19">Valentina</span></p>
<p><span class="font19">Fleur</span></p>
<p><span class="font19">Floor</span></p>
<p><span class="font25">The two examples below show how to use the </span><span class="font25" style="font-weight:bold;">dollar character </span><span class="font25">to match the end of a string.</span></p>
<p><span class="font19">paul@debian7:~$ grep a$ names</span></p>
<p><span class="font19">Tania</span></p>
<p><span class="font19">Laura</span></p>
<p><span class="font19">Valentina</span></p>
<p><span class="font19">paul@debian7:~$ grep r$ names</span></p>
<p><span class="font19">Fleur</span></p>
<p><span class="font19">Floor</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1889"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1890"></a>21.2.6. match the start of a string</span></h3></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">caret character (</span><span class="font4"><sup>A</sup></span><span class="font25" style="font-weight:bold;">) </span><span class="font25">will match a string at the start (or the beginning) of a line.</span></p>
<p><span class="font25">Given the same file as above, here are two examples.</span></p>
<p><span class="font19">paul@debian7:~$ grep *Val names</span></p>
<p><span class="font19">Valentina</span></p>
<p><span class="font19">paul@debian7:~$ grep *F names</span></p>
<p><span class="font19">Fleur</span></p>
<p><span class="font19">Floor</span></p>
<p><span class="font25">Both the dollar sign and the little hat are called </span><span class="font25" style="font-weight:bold;">anchors </span><span class="font25">in a regex.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1891"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1892"></a>21.2.7. separating words</span></h3></li></ul>
<h4><a name="bookmark1893"></a><span class="font25"><a name="bookmark1894"></a>Regular expressions use a </span><span class="font25" style="font-weight:bold;">\b </span><span class="font25">sequence to reference a word separator. Take for example this file:</span></h4>
<p><span class="font19">paul@debian7:~$ cat text</span></p>
<p><span class="font19">The governer is governing.</span></p>
<p><span class="font19">The winter is over.</span></p>
<p><span class="font19">Can you get over there?</span></p>
<h4><a name="bookmark1895"></a><span class="font25"><a name="bookmark1896"></a>Simply grepping for </span><span class="font25" style="font-weight:bold;">over </span><span class="font25">will give too many results.</span></h4>
<p><span class="font19">paul@debian7:~$ grep over text</span></p>
<p><span class="font19">The governer is governing.</span></p>
<p><span class="font19">The winter is over.</span></p>
<p><span class="font19">Can you get over there?</span></p>
<h4><a name="bookmark1897"></a><span class="font25"><a name="bookmark1898"></a>Surrounding the searched word with spaces is not a good solution (because other characters can be word separators). This screenshot below show how to use </span><span class="font25" style="font-weight:bold;">\b </span><span class="font25">to find only the searched word:</span></h4>
<p><span class="font19">paul@debian7:~$ grep '\bover\b' text</span></p>
<p><span class="font19">The winter is over.</span></p>
<p><span class="font19">Can you get over there?</span></p>
<p><span class="font19">paul@debian7:~$</span></p>
<h4><a name="bookmark1899"></a><span class="font25"><a name="bookmark1900"></a><a name="bookmark1901"></a>Note that </span><span class="font25" style="font-weight:bold;">grep </span><span class="font25">also has a </span><span class="font25" style="font-weight:bold;">-w </span><span class="font25">option to grep for words.</span></h4>
<p><span class="font19">paul@debian7:~$ cat text</span></p>
<p><span class="font19">The governer is governing.</span></p>
<p><span class="font19">The winter is over.</span></p>
<p><span class="font19">Can you get over there?</span></p>
<p><span class="font19">paul@debian7:~$ grep -w over text</span></p>
<p><span class="font19">The winter is over.</span></p>
<p><span class="font19">Can you get over there?</span></p>
<p><span class="font19">paul@debian7:~$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1902"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1903"></a>21.2.8. grep features</span></h3></li></ul>
<p><span class="font25">Sometimes it is easier to combine a simple regex with </span><span class="font25" style="font-weight:bold;">grep </span><span class="font25">options, than it is to write a more complex regex. These options where discussed before:</span></p>
<p><span class="font19">grep -i grep -v grep -w grep -A5 grep -B5 grep -C5</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1904"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1905"></a>21.2.9. preventing shell expansion of a regex</span></h3></li></ul>
<p><span class="font25">The dollar sign is a special character, both for the regex and also for the shell (remember variables and embedded shells). Therefore it is advised to always quote the regex, this prevents shell expansion.</span></p>
<p><span class="font19">paul@debian7:~$ grep 'r$' names</span></p>
<p><span class="font19">Fleur</span></p>
<p><span class="font19">Floor</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1906"></a><span class="font10" style="font-weight:bold;"><a name="bookmark211"></a><a name="bookmark1907"></a>21.3. rename</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark1908"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1909"></a>21.3.1. the rename command</span></h3></li></ul></li></ul>
<h4><a name="bookmark1910"></a><span class="font25"><a name="bookmark1911"></a><a name="bookmark1912"></a><a name="bookmark1913"></a><a name="bookmark1914"></a>On Debian Linux the </span><span class="font25" style="font-weight:bold;">/usr/bin/rename </span><span class="font25">command is a link to </span><span class="font25" style="font-weight:bold;">/usr/bin/prename </span><span class="font25">installed by the </span><span class="font25" style="font-weight:bold;">perl </span><span class="font25">package.</span></h4>
<p><span class="font19">paul@pi ~ $ dpkg -S $(readlink -f $(which rename)) perl: /usr/bin/prename</span></p>
<h4><a name="bookmark1915"></a><span class="font25"><a name="bookmark1916"></a>Red Hat derived systems do not install the same </span><span class="font25" style="font-weight:bold;">rename </span><span class="font25">command, so this section does not describe </span><span class="font25" style="font-weight:bold;">rename </span><span class="font25">on Red Hat (unless you copy the perl script manually).</span></h4>
<p><span class="font25" style="font-weight:bold;">There is often confusion on the internet about the rename command because solutions that work fine in Debian (and Ubuntu, xubuntu, Mint, ...) cannot be used in Red Hat (and CentOS, Fedora, ...).</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1917"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1918"></a>21.3.2. perl</span></h3></li></ul>
<h4><a name="bookmark1919"></a><span class="font25"><a name="bookmark1920"></a><a name="bookmark1921"></a>The </span><span class="font25" style="font-weight:bold;">rename </span><span class="font25">command is actually a perl script that uses </span><span class="font25" style="font-weight:bold;">perl regular expressions</span><span class="font25">. The complete manual for these can be found by typing </span><span class="font25" style="font-weight:bold;">perldoc perlrequick </span><span class="font25">(after installing </span><span class="font25" style="font-weight:bold;">perldoc</span><span class="font25">).</span></h4>
<p><span class="font19">root@pi:~# </span><span class="font19" style="font-weight:bold;">aptitude install perl-doc</span></p>
<p><span class="font19">The following NEW packages will be installed: perl-doc</span></p>
<p><span class="font19">0 packages upgraded, 1 newly installed, 0 to remove and 0 not upgraded.</span></p>
<p><span class="font19">Need to get 8,170 kB of archives. After unpacking 13.2 MB will be used.</span></p>
<p><span class="font19">Get: 1 </span><a href="http://mirrordirector.raspbian.org/raspbian/"><span class="font19">http://mirrordirector.raspbian.org/raspbian/</span></a><span class="font19"> wheezy/main perl-do...</span></p>
<p><span class="font19">Fetched 8,170 kB in 19s (412 kB/s)</span></p>
<p><span class="font19">Selecting previously unselected package perl-doc.</span></p>
<p><span class="font19">(Reading database ... 67121 files and directories currently installed.)</span></p>
<p><span class="font19">Unpacking perl-doc (from .../perl-doc_5.14.2-21+rpi2_all.deb) ...</span></p>
<p><span class="font19">Adding 'diversion of /usr/bin/perldoc to /usr/bin/perldoc.stub by perl-doc' Processing triggers for man-db ...</span></p>
<p><span class="font19">Setting up perl-doc (5.14.2-21+rpi2) ...</span></p>
<p><span class="font19">root@pi:~# </span><span class="font19" style="font-weight:bold;">perldoc perlrequick</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1922"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1923"></a>21.3.3. well known syntax</span></h3></li></ul>
<p><a name="bookmark1924"></a><span class="font25">The most common use of the </span><span class="font25" style="font-weight:bold;">rename </span><span class="font25">is to search for filenames matching a certain </span><span class="font25" style="font-weight:bold;">string </span><span class="font25">and replacing this string with an </span><span class="font25" style="font-weight:bold;">other string</span><span class="font25">.</span></p>
<p><span class="font25">This is often presented as </span><span class="font25" style="font-weight:bold;">s/string/other string/ </span><span class="font25">as seen in this example: </span><span class="font19">paul@pi ~ $ ls abc &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allfiles.TXT bllfiles.TXT Scratch tennis2.TXT</span></p>
<p><span class="font19">abc.conf backup &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cllfiles.TXT temp.TXT tennis.TXT</span></p>
<p><span class="font19">paul@pi ~ $ </span><span class="font19" style="font-weight:bold;">rename 's/TXT/text/' * </span><span class="font19">paul@pi ~ $ ls abc &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allfiles.text bllfiles.text Scratch tennis2.text</span></p>
<p><span class="font19">abc.conf backup &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cllfiles.text temp.text tennis.text</span></p>
<p><span class="font25">And here is another example that uses </span><span class="font25" style="font-weight:bold;">rename </span><span class="font25">with the well know syntax to change the extensions of the same files once more: </span><span class="font19">paul@pi ~ $ ls abc &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allfiles.text bllfiles.text Scratch tennis2.text</span></p>
<p><span class="font19">abc.conf backup &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cllfiles.text temp.text tennis.text</span></p>
<p><span class="font19">paul@pi ~ $ </span><span class="font19" style="font-weight:bold;">rename 's/text/txt/' *.text </span><span class="font19">paul@pi ~ $ ls abc &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allfiles.txt bllfiles.txt Scratch tennis2.txt</span></p>
<p><span class="font19">abc.conf backup &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cllfiles.txt temp.txt tennis.txt</span></p>
<p><span class="font19">paul@pi ~ $</span></p>
<p><span class="font25">These two examples appear to work because the strings we used only exist at the end of the filename. Remember that file extensions have no meaning in the bash shell.</span></p>
<p><span class="font25">The next example shows what can go wrong with this syntax.</span></p>
<p><span class="font19">paul@pi ~ $ touch atxt.txt</span></p>
<p><span class="font19">paul@pi ~ $ </span><span class="font19" style="font-weight:bold;">rename 's/txt/problem/' atxt.txt</span></p>
<p><span class="font19">paul@pi ~ $ ls</span></p>
<p><span class="font19">abc &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allfiles.txt backup &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cllfiles.txt temp.txt tennis.txt</span></p>
<p><span class="font19">abc.conf &nbsp;</span><span class="font19" style="font-weight:bold;">aproblem.txt </span><span class="font19">bllfiles.txt Scratch &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tennis2.txt</span></p>
<p><span class="font19">paul@pi ~ $</span></p>
<p><span class="font25">Only the first occurrence of the searched string is replaced.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1925"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1926"></a>21.3.4. a global replace</span></h3></li></ul>
<p><span class="font25">The syntax used in the previous example can be described as </span><span class="font25" style="font-weight:bold;">s/regex/replacement/</span><span class="font25">. This is simple and straightforward, you enter a </span><span class="font25" style="font-weight:bold;">regex </span><span class="font25">between the first two slashes and a </span><span class="font25" style="font-weight:bold;">replacement string </span><span class="font25">between the last two.</span></p>
<p><span class="font25">This example expands this syntax only a little, by adding a </span><span class="font25" style="font-weight:bold;">modifier</span><span class="font25">.</span></p>
<p><span class="font19">paul@pi ~ $ rename -n 's/TXT/txt/g' aTXT.TXT aTXT.TXT renamed as atxt.txt paul@pi ~ $</span></p>
<p><span class="font25">The syntax we use now can be described as </span><span class="font25" style="font-weight:bold;">s/regex/replacement/g </span><span class="font25">where s signifies </span><span class="font25" style="font-weight:bold;">switch </span><span class="font25">and g stands for </span><span class="font25" style="font-weight:bold;">global</span><span class="font25">.</span></p>
<p><span class="font25">Note that this example used the </span><span class="font25" style="font-weight:bold;">-n </span><span class="font25">switch to show what is being done (instead of actually renaming the file).</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1927"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1928"></a>21.3.5. case insensitive replace</span></h3></li></ul>
<p><span class="font25">Another </span><span class="font25" style="font-weight:bold;">modifier </span><span class="font25">that can be useful is </span><span class="font25" style="font-weight:bold;">i</span><span class="font25">. this example shows how to replace a case insensitive string with another string.</span></p>
<p><span class="font19">paul@debian7:~/files$ ls filel.text file2.TEXT file3.txt paul@debian7:~/files$ rename 's/.text/.txt/i' * paul@debian7:~/files$ ls file1.txt file2.txt file3.txt paul@debian7:~/files$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1929"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1930"></a>21.3.6. renaming extensions</span></h3></li></ul>
<p><span class="font25">Command line Linux has no knowledge of MS-DOS like extensions, but many end users and graphical application do use them.</span></p>
<p><a name="bookmark1931"></a><span class="font25">Here is an example on how to use </span><span class="font25" style="font-weight:bold;">rename </span><span class="font25">to only rename the file extension. It uses the dollar sign to mark the ending of the filename.</span></p>
<p><span class="font19">paul@pi ~ $ ls *.txt allfiles.txt bllfiles.txt cllfiles.txt really.txt.txt temp.txt tennis.txt paul@pi ~ $ rename 's/.txt$/.TXT/' *.txt paul@pi ~ $ ls *.TXT allfiles.TXT bllfiles.TXT cllfiles.TXT really.txt.TXT temp.TXT tennis.TXT paul@pi ~ $</span></p>
<p><span class="font25">Note that the </span><span class="font25" style="font-weight:bold;">dollar sign </span><span class="font25">in the regex means </span><span class="font25" style="font-weight:bold;">at the end</span><span class="font25">. Without the dollar sign this command would fail on the really.txt.txt file.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1932"></a><span class="font10" style="font-weight:bold;"><a name="bookmark212"></a><a name="bookmark1933"></a>21.4. sed</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark1934"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1935"></a>21.4.1. stream editor</span></h3></li></ul></li></ul>
<p><a name="bookmark1936"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">stream editor </span><span class="font25">or short </span><span class="font25" style="font-weight:bold;">sed </span><span class="font25">uses </span><span class="font25" style="font-weight:bold;">regex </span><span class="font25">for stream editing.</span></p>
<p><span class="font25">In this example </span><span class="font25" style="font-weight:bold;">sed </span><span class="font25">is used to replace a string.</span></p>
<p><span class="font19">echo Sunday | sed 's/Sun/Mon/'</span></p>
<p><span class="font19">Monday</span></p>
<p><span class="font25">The slashes can be replaced by a couple of other characters, which can be handy in some cases to improve readability.</span></p>
<p><span class="font19">echo Sunday | sed 's:Sun:Mon:'</span></p>
<p><span class="font19">Monday</span></p>
<p><span class="font19">echo Sunday | sed 's_Sun_Mon_'</span></p>
<p><span class="font19">Monday</span></p>
<p><span class="font19">echo Sunday | sed 's|Sun|Mon|'</span></p>
<p><span class="font19">Monday</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1937"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1938"></a>21.4.2. interactive editor</span></h3></li></ul>
<p><span class="font25">While </span><span class="font25" style="font-weight:bold;">sed </span><span class="font25">is meant to be used in a stream, it can also be used interactively on a file.</span></p>
<p><span class="font19">paul@debian7:~/files$ echo Sunday &gt;&nbsp;today</span></p>
<p><span class="font19">paul@debian7:~/files$ cat today</span></p>
<p><span class="font19">Sunday</span></p>
<p><span class="font19">paul@debian7:~/files$ sed -i 's/Sun/Mon/' today</span></p>
<p><span class="font19">paul@debian7:~/files$ cat today</span></p>
<p><span class="font19">Monday</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1939"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1940"></a>21.4.3. simple back referencing</span></h3></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">ampersand </span><span class="font25">character can be used to reference the searched (and found) string.</span></p>
<p><span class="font25">In this example the </span><span class="font25" style="font-weight:bold;">ampersand </span><span class="font25">is used to double the occurence of the found string.</span></p>
<p><span class="font19">echo Sunday | sed 's/Sun/&amp;&amp;/'</span></p>
<p><span class="font19">SunSunday</span></p>
<p><span class="font19">echo Sunday | sed 's/day/&amp;&amp;/'</span></p>
<p><span class="font19">Sundayday</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1941"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1942"></a>21.4.4. back referencing</span></h3></li></ul>
<p><span class="font25">Parentheses (often called round brackets) are used to group sections of the regex so they can leter be referenced.</span></p>
<p><span class="font25">Consider this simple example:</span></p>
<p><span class="font19">paul@debian7:~$ echo Sunday | sed 's_\(Sun\)_\1ny_'</span></p>
<p><span class="font19">Sunnyday</span></p>
<p><span class="font19">paul@debian7:~$ echo Sunday | sed 's_\(Sun\)_\1ny \1_'</span></p>
<p><span class="font19">Sunny Sunday</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1943"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1944"></a>21.4.5. a dot for any character</span></h3></li></ul>
<p><a name="bookmark1945"></a><span class="font25">In a </span><span class="font25" style="font-weight:bold;">regex </span><span class="font25">a simple dot can signify any character.</span></p>
<p><span class="font19">paul@debian7:~$ echo 2014-04-01 | sed 's/....-..-../YYYY-MM-DD/'</span></p>
<p><span class="font19">YYYY-MM-DD</span></p>
<p><span class="font19">paul@debian7:~$ echo abcd-ef-gh | sed 's/....-..-../YYYY-MM-DD/'</span></p>
<p><span class="font19">YYYY-MM-DD</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1946"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1947"></a>21.4.6. multiple back referencing</span></h3></li></ul>
<p><span class="font25">When more than one pair of </span><span class="font25" style="font-weight:bold;">parentheses </span><span class="font25">is used, each of them can be referenced separately by consecutive numbers.</span></p>
<p><span class="font19">paul@debian7:~$ echo 2014-04-01 | sed 's/\(....\)-\(..\)-\(..\)/\1+\2+\3/'</span></p>
<p><span class="font19">2014+04+01</span></p>
<p><span class="font19">paul@debian7:~$ echo 2014-04-01 | sed 's/\(....\)-\(..\)-\(..\)/\3:\2:\1/'</span></p>
<p><span class="font19">01:04:2014</span></p>
<p><span class="font25">This feature is called </span><span class="font25" style="font-weight:bold;">grouping</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1948"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1949"></a>21.4.7. white space</span></h3></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">\s </span><span class="font25">can refer to white space such as a space or a tab.</span></p>
<p><span class="font25">This example looks for white spaces (\s) globally and replaces them with 1 space.</span></p>
<p><span class="font19">paul@debian7:~$ echo -e 'today\tis\twarm' today is warm</span></p>
<p><span class="font19">paul@debian7:~$ echo -e 'today\tis\twarm' | sed 's_\s_ _g' today is warm</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1950"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1951"></a>21.4.8. optional occurrence</span></h3></li></ul>
<p><span class="font25">A question mark signifies that the previous is </span><span class="font25" style="font-weight:bold;">optional</span><span class="font25">.</span></p>
<p><span class="font25">The example below searches for three consecutive letter o, but the third o is optional.</span></p>
<p><span class="font19">paul@debian7:~$ cat list2 ll lol lool loool</span></p>
<p><span class="font19">paul@debian7:~$ grep -E 'ooo?' list2 lool loool</span></p>
<p><span class="font19">paul@debian7:~$ cat list2 | sed 's/ooo\?/A/' ll lol lAl lAl</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1952"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1953"></a>21.4.9. exactly n times</span></h3></li></ul>
<h4><a name="bookmark1954"></a><span class="font25"><a name="bookmark1955"></a>You can demand an exact number of times the oprevious has to occur.</span><br><br><span class="font25"><a name="bookmark1956"></a>This example wants exactly three o's.</span></h4>
<p><span class="font19">paul@debian7:~$ cat list2 ll lol lool loool</span></p>
<p><span class="font19">paul@debian7:~$ grep -E 'o{3}' list2 loool</span></p>
<p><span class="font19">paul@debian7:~$ cat list2 | sed 's/o\{3\}/A/' ll lol lool lAl</span></p>
<p><span class="font19">paul@debian7:~$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1957"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1958"></a>21.4.10. between n and m times</span></h3></li></ul>
<h4><a name="bookmark1959"></a><span class="font25"><a name="bookmark1960"></a>And here we demand exactly from minimum 2 to maximum 3 times.</span></h4>
<p><span class="font19">paul@debian7:~$ cat list2 ll lol lool loool</span></p>
<p><span class="font19">paul@debian7:~$ grep -E 'o{2,3}' list2 lool loool</span></p>
<p><span class="font19">paul@debian7:~$ grep 'o\{2,3\}' list2 lool loool</span></p>
<p><span class="font19">paul@debian7:~$ cat list2 | sed 's/o\{2,3\}/A/' ll lol lAl lAl</span></p>
<p><span class="font19">paul@debian7:~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1961"></a><span class="font10" style="font-weight:bold;"><a name="bookmark213"></a><a name="bookmark1962"></a>21.5. bash history</span></h2></li></ul>
<h4><a name="bookmark1963"></a><span class="font25"><a name="bookmark1964"></a><a name="bookmark1965"></a>The </span><span class="font25" style="font-weight:bold;">bash shell </span><span class="font25">can also interprete some regular expressions.</span></h4>
<h4><a name="bookmark1966"></a><span class="font25"><a name="bookmark1967"></a>This example shows how to manipulate the exclamation mask history feature of the bash shell.</span></h4>
<p><span class="font19">paul@debian7:~$ mkdir hist</span></p>
<p><span class="font19">paul@debian7:~$ cd hist/</span></p>
<p><span class="font19">paul@debian7:~/hist$ touch filel file2 file3</span></p>
<p><span class="font19">paul@debian7:~/hist$ ls -l filel</span></p>
<p><span class="font19">-rw-r--r-- 1 paul paul 0 Apr 15 22:07 filel</span></p>
<p><span class="font19">paul@debian7:~/hist$ !l</span></p>
<p><span class="font19">ls -l file1</span></p>
<p><span class="font19">-rw-r--r-- 1 paul paul 0 Apr 15 22:07 file1 paul@debian7:~/hist$ !l:s/1/3 ls -l file3</span></p>
<p><span class="font19">-rw-r--r-- 1 paul paul 0 Apr 15 22:07 file3</span></p>
<p><span class="font19">paul@debian7:~/hist$</span></p>
<h4><a name="bookmark1968"></a><span class="font25"><a name="bookmark1969"></a>This also works with the history numbers in bash.</span></h4>
<p><span class="font19">paul@debian7:~/hist$ history 6</span></p>
<p><span class="font19">2089 mkdir hist</span></p>
<p><span class="font19">2090 cd hist/</span></p>
<p><span class="font19">2091 touch file1 file2 file3</span></p>
<p><span class="font19">2092 ls -l file1</span></p>
<p><span class="font19">2093 ls -l file3</span></p>
<p><span class="font19">2094 history 6</span></p>
<p><span class="font19">paul@debian7:~/hist$ !2092</span></p>
<p><span class="font19">ls -l file1</span></p>
<p><span class="font19">-rw-r--r-- 1 paul paul 0 Apr 15 22:07 file1 paul@debian7:~/hist$ !2092:s/1/2 ls -l file2</span></p>
<p><span class="font19">-rw-r--r-- 1 paul paul 0 Apr 15 22:07 file2 paul@debian7:~/hist$</span></p>
<p><a name="bookmark1970"></a><span class="font11" style="font-weight:bold;">Part VI. vi</span></p>
<h3><a name="bookmark1971"></a><span class="font9" style="font-weight:bold;"><a name="bookmark1972"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1973"><span class="font24" style="font-weight:bold;">22. Introduction to vi </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1974"><span class="font24">22.1. command mode and insert mode </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1975"><span class="font24">22.2. start typing (a A i I o O) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1976"><span class="font24">22.3. replace and delete a character (r x X) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1977"><span class="font24">22.4. undo and repeat (u .) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1978"><span class="font24">22.5. cut, copy and paste a line (dd yy p P) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1979"><span class="font24">22.6. cut, copy and paste lines (3dd 2yy) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1980"><span class="font24">22.7. start and end of a line (0 or <sup>A</sup> and $)</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1981"><span class="font24">22.8. join two lines (J) and more </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1982"><span class="font24">22.9. words (w b) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1983"><span class="font24">22.10. save (or not) and exit (:w :q :q! ) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1984"><span class="font24">22.11. Searching (/ ?) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1985"><span class="font24">22.12. replace all ( :1,$ s/foo/bar/g ) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1986"><span class="font24">22.13. reading files (:r :r !cmd) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1987"><span class="font24">22.14. text buffers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1988"><span class="font24">22.15. multiple files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1989"><span class="font24">22.16. abbreviations </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1990"><span class="font24">22.17. key mappings </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1991"><span class="font24">22.18. setting options </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1992"><span class="font24">22.19. practice: vi(m) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1993"><span class="font24">22.20. solution: vi(m) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark1994"></a><span class="font11" style="font-weight:bold;"><a name="bookmark215"></a><a name="bookmark1995"></a>Chapter 22. Introduction to vi</span></h1></li></ul>
<p><a name="bookmark1996"></a><span class="font25"><a name="bookmark1997"></a>The </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">editor is installed on almost every Unix. Linux will very often install </span><span class="font25" style="font-weight:bold;">vim </span><span class="font25">(</span><span class="font25" style="font-weight:bold;">vi improved</span><span class="font25">) which is similar. Every system administrator should know </span><span class="font25" style="font-weight:bold;">vi(m)</span><span class="font25">, because it is an easy tool to solve problems.</span></p>
<p><a name="bookmark1998"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">editor is not intuitive, but once you get to know it, </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">becomes a very powerful application. Most Linux distributions will include the </span><span class="font25" style="font-weight:bold;">vimtutor </span><span class="font25">which is a 45 minute lesson in </span><span class="font25" style="font-weight:bold;">vi(m)</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark1999"></a><span class="font10" style="font-weight:bold;"><a name="bookmark216"></a><a name="bookmark2000"></a>22.1. command mode and insert mode</span></h2></li></ul>
<p><a name="bookmark2001"></a><span class="font25"><a name="bookmark2002"></a><a name="bookmark2003"></a>The vi editor starts in </span><span class="font25" style="font-weight:bold;">command mode</span><span class="font25">. In command mode, you can type commands. Some commands will bring you into </span><span class="font25" style="font-weight:bold;">insert mode</span><span class="font25">. In insert mode, you can type text. The </span><span class="font25" style="font-weight:bold;">escape key </span><span class="font25">will return you to command mode.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 22.1. getting to command mode</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">key</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">action</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">Esc</span></p></td><td style="vertical-align:top;">
<p><span class="font24">set vi(m) in command mode.</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2004"></a><span class="font10" style="font-weight:bold;"><a name="bookmark217"></a><a name="bookmark2005"></a>22.2. start typing (a A i I o O)</span></h2></li></ul>
<p><a name="bookmark2006"></a><span class="font25">The difference between a A i I o and O is the location where you can start typing. a will append after the current character and A will append at the end of the line. i will insert before the current character and I will insert at the beginning of the line. o will put you in a new line after the current line and O will put you in a new line before the current line.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 22.2. switch to insert mode</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">command</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">action</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">a</span></p></td><td style="vertical-align:top;">
<p><span class="font24">start typing after the current character</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">A</span></p></td><td style="vertical-align:top;">
<p><span class="font24">start typing at the end of the current line</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">i</span></p></td><td style="vertical-align:top;">
<p><span class="font24">start typing before the current character</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">I</span></p></td><td style="vertical-align:top;">
<p><span class="font24">start typing at the start of the current line</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">o</span></p></td><td style="vertical-align:top;">
<p><span class="font24">start typing on a new line after the current line</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">O</span></p></td><td style="vertical-align:top;">
<p><span class="font24">start typing on a new line before the current line</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2007"></a><span class="font10" style="font-weight:bold;"><a name="bookmark218"></a><a name="bookmark2008"></a>22.3. replace and delete a character (r x X)</span></h2></li></ul>
<p><a name="bookmark2009"></a><span class="font25">When in command mode (it doesn't hurt to hit the escape key more than once) you can use the x key to delete the current character. The big X key (or shift x) will delete the character left of the cursor. Also when in command mode, you can use the r key to replace one single character. The r key will bring you in insert mode for just one key press, and will return you immediately to command mode.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 22.3. replace and delete</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">command</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">action</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font24">x</span></p></td><td style="vertical-align:middle;">
<p><span class="font24">delete the character below the cursor</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">X</span></p></td><td style="vertical-align:top;">
<p><span class="font24">delete the character before the cursor</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">r</span></p></td><td style="vertical-align:top;">
<p><span class="font24">replace the character below the cursor</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">p</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">paste after the cursor (here the last deleted character)</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font24">xp</span></p></td><td style="vertical-align:middle;">
<p><span class="font24">switch two characters</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2010"></a><span class="font10" style="font-weight:bold;"><a name="bookmark219"></a><a name="bookmark2011"></a>22.4. undo and repeat (u .)</span></h2></li></ul>
<p><a name="bookmark2012"></a><span class="font25">When in command mode, you can undo your mistakes with u. You can do your mistakes twice with . (in other words, the . will repeat your last command).</span></p>
<p><span class="font25" style="font-weight:bold;">Table 22.4. undo and repeat</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">command</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">action</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">u</span></p></td><td style="vertical-align:top;">
<p><span class="font24">undo the last action</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font24">.</span></p></td><td style="vertical-align:top;">
<p><span class="font24">repeat the last action</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2013"></a><span class="font10" style="font-weight:bold;"><a name="bookmark220"></a><a name="bookmark2014"></a>22.5. cut, copy and paste a line (dd yy p P)</span></h2></li></ul>
<p><a name="bookmark2015"></a><span class="font25">When in command mode, dd will cut the current line. yy will copy the current line. You can paste the last copied or cut line after (p) or before (P) the current line.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 22.5. cut, copy and paste a line</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">command</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">action</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">dd</span></p></td><td style="vertical-align:top;">
<p><span class="font24">cut the current line</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">yy</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">(yank yank) copy the current line</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">p</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">paste after the current line</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font25" style="font-variant:small-caps;">p</span></p></td><td style="vertical-align:top;">
<p><span class="font24">paste before the current line</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2016"></a><span class="font10" style="font-weight:bold;"><a name="bookmark221"></a><a name="bookmark2017"></a>22.6. cut, copy and paste lines (3dd 2yy)</span></h2></li></ul>
<p><a name="bookmark2018"></a><span class="font25">When in command mode, before typing dd or yy, you can type a number to repeat the command a number of times. Thus, 5dd will cut 5 lines and 4yy will copy (yank) 4 lines. That last one will be noted by vi in the bottom left corner as &quot;4 line yanked&quot;.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 22.6. cut, copy and paste lines</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">command</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">action</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">3dd</span></p></td><td style="vertical-align:top;">
<p><span class="font24">cut three lines</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">4yy</span></p></td><td style="vertical-align:top;">
<p><span class="font24">copy four lines</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2019"></a><span class="font10" style="font-weight:bold;"><a name="bookmark222"></a><a name="bookmark2020"></a>22.7. start and end of a line (0 or <sup>A</sup> and $)</span></h2></li></ul>
<p><a name="bookmark2021"></a><span class="font25">When in command mode, the 0 and the caret </span><span class="font4"><sup>A</sup> </span><span class="font25">will bring you to the start of the current line, whereas the $ will put the cursor at the end of the current line. You can add 0 and $ to the d command, d0 will delete every character between the current character and the start of the line. Likewise d$ will delete everything from the current character till the end of the line. Similarly y0 and y$ will yank till start and end of the current line.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 22.7. start and end of line</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">command</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">action</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">0</span></p></td><td style="vertical-align:top;">
<p><span class="font24">jump to start of current line</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">A</span></p></td><td style="vertical-align:top;">
<p><span class="font24">jump to start of current line</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">$</span></p></td><td style="vertical-align:top;">
<p><span class="font24">jump to end of current line</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">d0</span></p></td><td style="vertical-align:top;">
<p><span class="font24">delete until start of line</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">d$</span></p></td><td style="vertical-align:top;">
<p><span class="font24">delete until end of line</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2022"></a><span class="font10" style="font-weight:bold;"><a name="bookmark223"></a><a name="bookmark2023"></a>22.8. join two lines (J) and more</span></h2></li></ul>
<p><a name="bookmark2024"></a><span class="font25">When in command mode, pressing </span><span class="font25" style="font-weight:bold;">J </span><span class="font25">will append the next line to the current line. With </span><span class="font25" style="font-weight:bold;">yyp </span><span class="font25">you duplicate a line and with </span><span class="font25" style="font-weight:bold;">ddp </span><span class="font25">you switch two lines.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 22.8. join two lines</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">command</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">action</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">J</span></p></td><td style="vertical-align:top;">
<p><span class="font24">join two lines</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">yyp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">duplicate a line</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">ddp</span></p></td><td style="vertical-align:top;">
<p><span class="font24">switch two lines</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2025"></a><span class="font10" style="font-weight:bold;"><a name="bookmark224"></a><a name="bookmark2026"></a>22.9. words (w b)</span></h2></li></ul>
<p><a name="bookmark2027"></a><span class="font25">When in command mode, </span><span class="font25" style="font-weight:bold;">w </span><span class="font25">will jump to the next word and </span><span class="font25" style="font-weight:bold;">b </span><span class="font25">will move to the previous word. w and b can also be combined with d and y to copy and cut words (dw db yw yb).</span></p>
<p><span class="font25" style="font-weight:bold;">Table 22.9. words</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">command</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">action</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font24">w</span></p></td><td style="vertical-align:middle;">
<p><span class="font24">forward one word</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">b</span></p></td><td style="vertical-align:top;">
<p><span class="font24">back one word</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">3w</span></p></td><td style="vertical-align:top;">
<p><span class="font24">forward three words</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">dw</span></p></td><td style="vertical-align:top;">
<p><span class="font24">delete one word</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">yw</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yank (copy) one word</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">5yb</span></p></td><td style="vertical-align:top;">
<p><span class="font24">yank five words back</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">7dw</span></p></td><td style="vertical-align:top;">
<p><span class="font24">delete seven words</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2028"></a><span class="font10" style="font-weight:bold;"><a name="bookmark225"></a><a name="bookmark2029"></a>22.10. save (or not) and exit (:w :q :q! )</span></h2></li></ul>
<p><a name="bookmark2030"></a><span class="font25">Pressing the colon : will allow you to give instructions to vi (technically speaking, typing the colon will open the </span><span class="font25" style="font-weight:bold;">ex </span><span class="font25">editor). </span><span class="font25" style="font-weight:bold;">:w </span><span class="font25">will write (save) the file, </span><span class="font25" style="font-weight:bold;">:q </span><span class="font25">will quit an unchanged file without saving, and </span><span class="font25" style="font-weight:bold;">:q! </span><span class="font25">will quit vi discarding any changes. </span><span class="font25" style="font-weight:bold;">:wq </span><span class="font25">will save and quit and is the same as typing </span><span class="font25" style="font-weight:bold;">ZZ </span><span class="font25">in command mode.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 22.10. save and exit vi</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">command</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">action</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">:w</span></p></td><td style="vertical-align:top;">
<p><span class="font24">save (write)</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">:w fname</span></p></td><td style="vertical-align:top;">
<p><span class="font24">save as fname</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">:q</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">quit</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">:wq</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">save and quit</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">ZZ</span></p></td><td style="vertical-align:top;">
<p><span class="font24">save and quit</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">:q!</span></p></td><td style="vertical-align:top;">
<p><span class="font24">quit (discarding your changes)</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">:w!</span></p></td><td style="vertical-align:top;">
<p><span class="font24">save (and write to non-writable file!)</span></p></td></tr>
</table>
<p><a name="bookmark2031"></a><span class="font25">The last one is a bit special. With </span><span class="font25" style="font-weight:bold;">:w! vi </span><span class="font25">will try to </span><span class="font25" style="font-weight:bold;">chmod </span><span class="font25">the file to get write permission (this works when you are the owner) and will </span><span class="font25" style="font-weight:bold;">chmod </span><span class="font25">it back when the write succeeds. This should always work when you are root (and the file system is writable).</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2032"></a><span class="font10" style="font-weight:bold;"><a name="bookmark226"></a><a name="bookmark2033"></a>22.11. Searching (/ ?)</span></h2></li></ul>
<p><a name="bookmark2034"></a><span class="font25">When in command mode typing / will allow you to search in vi for strings (can be a regular expression). Typing /foo will do a forward search for the string foo and typing ?bar will do a backward search for bar.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 22.11. searching</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">command</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">action</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">/string</span></p></td><td style="vertical-align:top;">
<p><span class="font24">forward search for string</span></p></td></tr>
</table>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">command</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">action</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">?string</span></p></td><td style="vertical-align:top;">
<p><span class="font24">backward search for string</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">n</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">go to next occurrence of search string</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">/<sup>A</sup>string</span></p></td><td style="vertical-align:top;">
<p><span class="font24">forward search string at beginning of line</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">/string$</span></p></td><td style="vertical-align:top;">
<p><span class="font24">forward search string at end of line</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">/br[aeio]l</span></p></td><td style="vertical-align:top;">
<p><span class="font24">search for bral brel bril and brol</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">A&lt;he\&gt;</span></p></td><td style="vertical-align:top;">
<p><span class="font24">search for the word </span><span class="font24" style="font-weight:bold;">he </span><span class="font24">(and not for </span><span class="font24" style="font-weight:bold;">he</span><span class="font24">re or t</span><span class="font24" style="font-weight:bold;">he</span><span class="font24">)</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2035"></a><span class="font10" style="font-weight:bold;"><a name="bookmark227"></a><a name="bookmark2036"></a>22.12. replace all ( :1,$ s/foo/bar/g )</span></h2></li></ul>
<p><a name="bookmark2037"></a><span class="font25">To replace all occurrences of the string foo with bar, first switch to ex mode with : . Then tell vi which lines to use, for example 1,$ will do the replace all from the first to the last line. You can write 1,5 to only process the first five lines. The s/foo/bar/g will replace all occurrences of foo with bar.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 22.12. replace</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">command</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">action</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">:4,8 s/foo/bar/g</span></p></td><td style="vertical-align:top;">
<p><span class="font24">replace foo with bar on lines 4 to 8</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">:1,$ s/foo/bar/g</span></p></td><td style="vertical-align:top;">
<p><span class="font24">replace foo with bar on all lines</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2038"></a><span class="font10" style="font-weight:bold;"><a name="bookmark228"></a><a name="bookmark2039"></a>22.13. reading files (:r :r !cmd)</span></h2></li></ul>
<p><a name="bookmark2040"></a><span class="font25">When in command mode, :r foo will read the file named foo, :r !foo will execute the command foo. The result will be put at the current location. Thus :r !ls will put a listing of the current directory in your text file.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 22.13. read files and input</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">command</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">action</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">:r fname</span></p></td><td style="vertical-align:top;">
<p><span class="font24">(read) file fname and paste contents</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">:r !cmd</span></p></td><td style="vertical-align:top;">
<p><span class="font24">execute cmd and paste its output</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2041"></a><span class="font10" style="font-weight:bold;"><a name="bookmark229"></a><a name="bookmark2042"></a>22.14. text buffers</span></h2></li></ul>
<p><a name="bookmark2043"></a><span class="font25">There are 36 buffers in vi to store text. You can use them with the </span><span class="font25" style="font-weight:bold;">&quot;&nbsp;</span><span class="font25">character.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 22.14. text buffers</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">command</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">action</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">&quot;add</span></p></td><td style="vertical-align:top;">
<p><span class="font24">delete current line and put text in buffer a</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">&quot;g7yy</span></p></td><td style="vertical-align:top;">
<p><span class="font24">copy seven lines into buffer g</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">&quot;ap</span></p></td><td style="vertical-align:top;">
<p><span class="font24">paste from buffer a</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2044"></a><span class="font10" style="font-weight:bold;"><a name="bookmark230"></a><a name="bookmark2045"></a>22.15. multiple files</span></h2></li></ul>
<p><span class="font25">You can edit multiple files with vi. Here are some tips.</span></p>
<p><a name="bookmark2046"></a><span class="font25" style="font-weight:bold;">Table 22.15. multiple files</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">command</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">action</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">vi filel file2 file3</span></p></td><td style="vertical-align:top;">
<p><span class="font24">start editing three files</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">:args</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">lists files and marks active file</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">:n</span></p></td><td style="vertical-align:top;">
<p><span class="font24">start editing the next file</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">:e</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">toggle with last edited file</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">:rew</span></p></td><td style="vertical-align:top;">
<p><span class="font24">rewind file pointer to first file</span></p></td></tr>
</table>
<h2><a name="bookmark2047"></a><span class="font10" style="font-weight:bold;"><a name="bookmark231"></a><a name="bookmark2048"></a>22.16. abbreviations</span></h2>
<h4><a name="bookmark2049"></a><span class="font25"><a name="bookmark2050"></a><a name="bookmark2051"></a>With </span><span class="font25" style="font-weight:bold;">:ab </span><span class="font25">you can put abbreviations in vi. Use </span><span class="font25" style="font-weight:bold;">:una </span><span class="font25">to undo the abbreviation.</span></h4>
<p><span class="font25" style="font-weight:bold;">Table 22.16. abbreviations</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">command</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">action</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">:ab str long string</span></p></td><td style="vertical-align:top;">
<p><span class="font24">abbreviate </span><span class="font24" style="font-weight:bold;">str </span><span class="font24">to be 'long string'</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">:una str</span></p></td><td style="vertical-align:top;">
<p><span class="font24">un-abbreviate str</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2052"></a><span class="font10" style="font-weight:bold;"><a name="bookmark232"></a><a name="bookmark2053"></a>22.17. key mappings</span></h2></li></ul>
<p><span class="font25">Similarly to their abbreviations, you can use mappings with </span><span class="font25" style="font-weight:bold;">:map </span><span class="font25">for command mode and </span><span class="font25" style="font-weight:bold;">:map! </span><span class="font25">for insert mode.</span></p>
<p><span class="font25">This example shows how to set the F6 function key to toggle between </span><span class="font25" style="font-weight:bold;">set number </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">set nonumber</span><span class="font25">. The &lt;bar&gt; separates the two commands, </span><span class="font25" style="font-weight:bold;">set number! </span><span class="font25">toggles the state and </span><span class="font25" style="font-weight:bold;">set number? </span><span class="font25">reports the current state.</span></p>
<p><span class="font19">:map &lt;F6&gt; :set number!&lt;bar&gt;set number?&lt;CR&gt;</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2054"></a><span class="font10" style="font-weight:bold;"><a name="bookmark233"></a><a name="bookmark2055"></a>22.18. setting options</span></h2></li></ul>
<p><span class="font25">Some options that you can set in vim.</span></p>
<p><span class="font19">:set number ( also try :se nu )</span></p>
<p><span class="font19">:set nonumber</span></p>
<p><span class="font19">:syntax on</span></p>
<p><span class="font19">:syntax off</span></p>
<p><span class="font19">:set all (list all options)</span></p>
<p><span class="font19">:set tabstop=8</span></p>
<p><span class="font19">:set tx (CR/LF style endings)</span></p>
<p><span class="font19">:set notx</span></p>
<p><a name="bookmark2056"></a><span class="font25"><a name="bookmark2057"></a>You can set these options (and much more) in </span><span class="font25" style="font-weight:bold;">~/.vimrc </span><span class="font25">for vim or in </span><span class="font25" style="font-weight:bold;">~/.exrc </span><span class="font25">for standard vi.</span></p>
<p><span class="font19">paul@barry:~$ cat ~/.vimrc</span></p>
<p><span class="font19">set number</span></p>
<p><span class="font19">set tabstop=8</span></p>
<p><span class="font19">set textwidth=78</span></p>
<p><span class="font19">map &lt;F6&gt; :set number!&lt;bar&gt;set number?&lt;CR&gt; paul@barry:~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2058"></a><span class="font10" style="font-weight:bold;"><a name="bookmark234"></a><a name="bookmark2059"></a>22.19. practice: vi(m)</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Start the vimtutor and do some or all of the exercises. You might need to run </span><span class="font25" style="font-weight:bold;">aptitude install vim </span><span class="font25">on xubuntu.</span></p></li>
<li>
<p><span class="font25">2. What 3 key sequence in command mode will duplicate the current line.</span></p></li>
<li>
<p><span class="font25">3. What 3 key sequence in command mode will switch two lines' place (line five becomes line six and line six becomes line five).</span></p></li>
<li>
<p><span class="font25">4. What 2 key sequence in command mode will switch a character's place with the next one.</span></p></li>
<li>
<p><span class="font25">5. vi can understand macro's. A macro can be recorded with q followed by the name of the macro. So qa will record the macro named a. Pressing q again will end the recording. You can recall the macro with @ followed by the name of the macro. Try this example: i 1 'Escape Key' qa yyp 'Ctrl a' q 5@a (Ctrl a will increase the number with one).</span></p></li>
<li>
<p><span class="font25">6. Copy /etc/passwd to your ~/passwd. Open the last one in vi and press Ctrl v. Use the arrow keys to select a Visual Block, you can copy this with y or delete it with d. Try pasting it.</span></p></li>
<li>
<p><span class="font25">7. What does dwwP do when you are at the beginning of a word in a sentence ?</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2060"></a><span class="font10" style="font-weight:bold;"><a name="bookmark235"></a><a name="bookmark2061"></a>22.20. solution: vi(m)</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Start the vimtutor and do some or all of the exercises. You might need to run </span><span class="font25" style="font-weight:bold;">aptitude install vim </span><span class="font25">on xubuntu.</span></p></li></ul>
<p><span class="font19">vimtutor</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. What 3 key sequence in command mode will duplicate the current line.</span></p></li></ul>
<p><span class="font19">yyp</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. What 3 key sequence in command mode will switch two lines' place (line five becomes line six and line six becomes line five).</span></p></li></ul>
<p><span class="font19">ddp</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. What 2 key sequence in command mode will switch a character's place with the next one.</span></p></li></ul>
<p><span class="font19">xp</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. vi can understand macro's. A macro can be recorded with q followed by the name of the macro. So qa will record the macro named a. Pressing q again will end the recording. You can recall the macro with @ followed by the name of the macro. Try this example: i 1 'Escape Key' qa yyp 'Ctrl a' q 5@a (Ctrl a will increase the number with one).</span></p></li>
<li>
<p><span class="font25">6. Copy /etc/passwd to your ~/passwd. Open the last one in vi and press Ctrl v. Use the arrow keys to select a Visual Block, you can copy this with y or delete it with d. Try pasting it.</span></p></li></ul>
<p><span class="font19">cp /etc/passwd ~</span></p>
<p><span class="font19">vi passwd</span></p>
<p><span class="font19">(press Ctrl-V)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. What does </span><span class="font25" style="font-weight:bold;">dwwP </span><span class="font25">do when you are at the beginning of a word in a sentence ?</span></p></li></ul>
<p><span class="font25" style="font-weight:bold;">dwwP </span><span class="font25">can switch the current word with the next word.</span></p>
<p><a name="bookmark2062"></a><span class="font11" style="font-weight:bold;">Part VII. scripting</span></p>
<h3><a name="bookmark2063"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2064"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2065"><span class="font24" style="font-weight:bold;">23. scripting introduction </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2066"><span class="font24">23.1. prerequisites </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2067"><span class="font24">23.2. hello world </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2068"><span class="font24">23.3. she-bang </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2069"><span class="font24">23.4. comment </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2070"><span class="font24">23.5. variables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2071"><span class="font24">23.6. sourcing a script </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2072"><span class="font24">23.7. troubleshooting a script </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2073"><span class="font24">23.8. prevent setuid root spoofing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2074"><span class="font24">23.9. practice: introduction to scripting </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2075"><span class="font24">23.10. solution: introduction to scripting </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2076"><span class="font24" style="font-weight:bold;">24. scripting loops </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2077"><span class="font24">24.1. test [ ] </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2078"><span class="font24">24.2. if then else </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2079"><span class="font24">24.3. if then elif </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2080"><span class="font24">24.4. for loop </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2081"><span class="font24">24.5. while loop </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2082"><span class="font24">24.6. until loop </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2083"><span class="font24">24.7. practice: scripting tests and loops </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2084"><span class="font24">24.8. solution: scripting tests and loops </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2085"><span class="font24" style="font-weight:bold;">25. scripting parameters </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2086"><span class="font24">25.1. script parameters </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2087"><span class="font24">25.2. shift through parameters </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2088"><span class="font24">25.3. runtime input </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2089"><span class="font24">25.4. sourcing a config file </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2090"><span class="font24">25.5. get script options with getopts </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2091"><span class="font24">25.6. get shell options with shopt </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2092"><span class="font24">25.7. practice: parameters and options </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2093"><span class="font24">25.8. solution: parameters and options </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2094"><span class="font24" style="font-weight:bold;">26. more scripting </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2095"><span class="font24">26.1. eval </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2096"><span class="font24">26.2. (( )) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2097"><span class="font24">26.3. let </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2098"><span class="font24">26.4. case </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2099"><span class="font24">26.5. shell functions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2100"><span class="font24">26.6. practice : more scripting </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2101"><span class="font24">26.7. solution : more scripting </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark2102"></a><span class="font11" style="font-weight:bold;"><a name="bookmark237"></a><a name="bookmark2103"></a>Chapter 23. scripting introduction</span></h1></li></ul>
<p><span class="font25">Shells like </span><span class="font25" style="font-weight:bold;">bash </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">Korn </span><span class="font25">have support for programming constructs that can be saved as </span><span class="font25" style="font-weight:bold;">scripts</span><span class="font25">. These </span><span class="font25" style="font-weight:bold;">scripts </span><span class="font25">in turn then become more </span><span class="font25" style="font-weight:bold;">shell </span><span class="font25">commands. Many Linux commands are </span><span class="font25" style="font-weight:bold;">scripts</span><span class="font25">. </span><span class="font25" style="font-weight:bold;">User profile scripts </span><span class="font25">are run when a user logs on and </span><span class="font25" style="font-weight:bold;">init scripts </span><span class="font25">are run when a </span><span class="font25" style="font-weight:bold;">daemon </span><span class="font25">is stopped or started.</span></p>
<p><span class="font25">This means that system administrators also need basic knowledge of </span><span class="font25" style="font-weight:bold;">scripting </span><span class="font25">to understand how their servers and their applications are started, updated, upgraded, patched, maintained, configured and removed, and also to understand how a user environment is built.</span></p>
<p><span class="font25">The goal of this chapter is to give you enough information to be able to read and understand scripts. Not to become a writer of complex scripts.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2104"></a><span class="font10" style="font-weight:bold;"><a name="bookmark238"></a><a name="bookmark2105"></a>23.1. prerequisites</span></h2></li></ul>
<p><span class="font25">You should have read and understood </span><span class="font25" style="font-weight:bold;">part III shell expansion </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">part IV pipes and commands </span><span class="font25">before starting this chapter.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2106"></a><span class="font10" style="font-weight:bold;"><a name="bookmark239"></a><a name="bookmark2107"></a>23.2. hello world</span></h2></li></ul>
<p><span class="font25">Just like in every programming course, we start with a simple </span><span class="font25" style="font-weight:bold;">hello_world </span><span class="font25">script. The following script will output </span><span class="font25" style="font-weight:bold;">Hello World</span><span class="font25">.</span></p>
<p><span class="font19">echo Hello World</span></p>
<p><a name="bookmark2108"></a><span class="font25">After creating this simple script in </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">or with </span><span class="font25" style="font-weight:bold;">echo</span><span class="font25">, you'll have to </span><span class="font25" style="font-weight:bold;">chmod +x hello_world </span><span class="font25">to make it executable. And unless you add the scripts directory to your path, you'll have to type the path to the script for the shell to be able to find it.</span></p>
<p><span class="font19">[paul@RHEL4a ~]$ echo echo Hello World &gt;&nbsp;hello_world</span></p>
<p><span class="font19">[paul@RHEL4a ~]$ chmod +x hello_world</span></p>
<p><span class="font19">[paul@RHEL4a ~]$ ./hello_world</span></p>
<p><span class="font19">Hello World</span></p>
<p><span class="font19">[paul@RHEL4a ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2109"></a><span class="font10" style="font-weight:bold;"><a name="bookmark240"></a><a name="bookmark2110"></a>23.3. she-bang</span></h2></li></ul>
<p><a name="bookmark2111"></a><span class="font25"><a name="bookmark2112"></a>Let's expand our example a little further by putting </span><span class="font25" style="font-weight:bold;">#!/bin/bash </span><span class="font25">on the first line of the script. The </span><span class="font25" style="font-weight:bold;">#! </span><span class="font25">is called a </span><span class="font25" style="font-weight:bold;">she-bang </span><span class="font25">(sometimes called </span><span class="font25" style="font-weight:bold;">sha-bang</span><span class="font25">), where the </span><span class="font25" style="font-weight:bold;">she-bang </span><span class="font25">is the first two characters of the script.</span></p>
<p><span class="font19">#!/bin/bash</span></p>
<p><span class="font19">echo Hello World</span></p>
<p><a name="bookmark2113"></a><span class="font25"><a name="bookmark2114"></a><a name="bookmark2115"></a>You can never be sure which shell a user is running. A script that works flawlessly in </span><span class="font25" style="font-weight:bold;">bash </span><span class="font25">might not work in </span><span class="font25" style="font-weight:bold;">ksh</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">csh</span><span class="font25">, or </span><span class="font25" style="font-weight:bold;">dash</span><span class="font25">. To instruct a shell to run your script in a certain shell, you can start your script with a </span><span class="font25" style="font-weight:bold;">she-bang </span><span class="font25">followed by the shell it is supposed to run in. This script will run in a bash shell.</span></p>
<p><span class="font19">#!/bin/bash echo -n hello echo A bash subshell 'echo -n hello'</span></p>
<p><a name="bookmark2116"></a><span class="font25">This script will run in a Korn shell (unless </span><span class="font25" style="font-weight:bold;">/bin/ksh </span><span class="font25">is a hard link to </span><span class="font25" style="font-weight:bold;">/bin/bash</span><span class="font25">). The </span><span class="font25" style="font-weight:bold;">/etc/ shells </span><span class="font25">file contains a list of shells on your system.</span></p>
<p><span class="font19">#!/bin/ksh</span></p>
<p><span class="font19">echo -n hello</span></p>
<p><span class="font19">echo a Korn subshell 'echo -n hello'</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2117"></a><span class="font10" style="font-weight:bold;"><a name="bookmark241"></a><a name="bookmark2118"></a>23.4. comment</span></h2></li></ul>
<p><span class="font25">Let's expand our example a little further by adding comment lines.</span></p>
<p><span class="font19">#!/bin/bash #</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Hello World Script</span></p></li></ul>
<p><span class="font19">#</span></p>
<p><span class="font19">echo Hello World</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2119"></a><span class="font10" style="font-weight:bold;"><a name="bookmark242"></a><a name="bookmark2120"></a>23.5. variables</span></h2></li></ul>
<p><span class="font25">Here is a simple example of a variable inside a script.</span></p>
<p><span class="font19">#!/bin/bash #</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># simple variable in script</span></p></li></ul>
<p><span class="font19">#</span></p>
<p><span class="font19">var1=4</span></p>
<p><span class="font19">echo varl = $var1</span></p>
<p><span class="font25">Scripts can contain variables, but since scripts are run in their own shell, the variables do not survive the end of the script.</span></p>
<p><span class="font19">[paul@RHEL4a ~]$ echo $var1</span></p>
<p><span class="font19">[paul@RHEL4a ~]$ ./vars</span></p>
<p><span class="font19">var1 = 4</span></p>
<p><span class="font19">[paul@RHEL4a ~]$ echo $var1</span></p>
<p><span class="font19">[paul@RHEL4a ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2121"></a><span class="font10" style="font-weight:bold;"><a name="bookmark243"></a><a name="bookmark2122"></a>23.6. sourcing a script</span></h2></li></ul>
<p><a name="bookmark2123"></a><span class="font25">Luckily, you can force a script to run in the same shell; this is called </span><span class="font25" style="font-weight:bold;">sourcing </span><span class="font25">a script.</span></p>
<p><span class="font19">[paul@RHEL4a ~]$ source ./vars</span></p>
<p><span class="font19">var1 = 4</span></p>
<p><span class="font19">[paul@RHEL4a ~]$ echo $var1</span></p>
<p><span class="font19">4 [paul@RHEL4a ~]$</span></p>
<p><a name="bookmark2124"></a><span class="font25">The above is identical to the below.</span></p>
<p><span class="font19">[paul@RHEL4a ~]$ . ./vars var1 = 4</span></p>
<p><span class="font19">[paul@RHEL4a ~]$ echo $var1 4</span></p>
<p><span class="font19">[paul@RHEL4a ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2125"></a><span class="font10" style="font-weight:bold;"><a name="bookmark244"></a><a name="bookmark2126"></a>23.7. troubleshooting a script</span></h2></li></ul>
<p><span class="font25">Another way to run a script in a separate shell is by typing </span><span class="font25" style="font-weight:bold;">bash </span><span class="font25">with the name of the script as a parameter.</span></p>
<p><span class="font19">paul@debian6~/test$ bash runme 42</span></p>
<p><a name="bookmark2127"></a><span class="font25">Expanding this to </span><span class="font25" style="font-weight:bold;">bash -x </span><span class="font25">allows you to see the commands that the shell is executing (after shell expansion).</span></p>
<p><span class="font19">paul@debian6~/test$ bash -x runme + var4=42</span></p>
<p><span class="font19">+ echo 42</span></p>
<p><span class="font19">42</span></p>
<p><span class="font19">paul@debian6~/test$ cat runme # the runme script var4=42 echo $var4</span></p>
<p><span class="font19">paul@debian6~/test$</span></p>
<p><span class="font25">Notice the absence of the commented (#) line, and the replacement of the variable before execution of </span><span class="font25" style="font-weight:bold;">echo</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2128"></a><span class="font10" style="font-weight:bold;"><a name="bookmark245"></a><a name="bookmark2129"></a>23.8. prevent setuid root spoofing</span></h2></li></ul>
<p><a name="bookmark2130"></a><span class="font25">Some user may try to perform </span><span class="font25" style="font-weight:bold;">setuid </span><span class="font25">based script </span><span class="font25" style="font-weight:bold;">root spoofing</span><span class="font25">. This is a rare but possible attack. To improve script security and to avoid interpreter spoofing, you need to add </span><span class="font25" style="font-weight:bold;">-- </span><span class="font25">after the </span><span class="font25" style="font-weight:bold;">#!/bin/bash</span><span class="font25">, which disables further option processing so the shell will not accept any options.</span></p>
<p><span class="font19">#!/bin/bash -</span></p>
<p><span class="font19">or</span></p>
<p><span class="font19">#!/bin/bash -</span></p>
<p><a name="bookmark2131"></a><span class="font25">Any arguments after the </span><span class="font25" style="font-weight:bold;">-- </span><span class="font25">are treated as filenames and arguments. An argument of - is equivalent to --.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2132"></a><span class="font10" style="font-weight:bold;"><a name="bookmark246"></a><a name="bookmark2133"></a>23.9. practice: introduction to scripting</span></h2></li></ul>
<p><span class="font25">0. Give each script a different name, keep them for later!</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Write a script that outputs the name of a city.</span></p></li>
<li>
<p><span class="font25">2. Make sure the script runs in the bash shell.</span></p></li>
<li>
<p><span class="font25">3. Make sure the script runs in the Korn shell.</span></p></li>
<li>
<p><span class="font25">4. Create a script that defines two variables, and outputs their value.</span></p></li>
<li>
<p><span class="font25">5. The previous script does not influence your current shell (the variables do not exist outside of the script). Now run the script so that it influences your current shell.</span></p></li>
<li>
<p><span class="font25">6. Is there a shorter way to </span><span class="font25" style="font-weight:bold;">source </span><span class="font25">the script ?</span></p></li>
<li>
<p><span class="font25">7. Comment your scripts so that you know what they are doing.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2134"></a><span class="font10" style="font-weight:bold;"><a name="bookmark247"></a><a name="bookmark2135"></a>23.10. solution: introduction to scripting</span></h2></li></ul>
<p><span class="font25">0. Give each script a different name, keep them for later!</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Write a script that outputs the name of a city.</span></p></li></ul>
<p><span class="font19">$ echo 'echo Antwerp' &gt;&nbsp;first.bash</span></p>
<p><span class="font19">$ chmod +x first.bash</span></p>
<p><span class="font19">$ ./first.bash</span></p>
<p><span class="font19">Antwerp</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Make sure the script runs in the bash shell.</span></p></li></ul>
<p><span class="font19">$ cat first.bash</span></p>
<p><span class="font19">#!/bin/bash echo Antwerp</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Make sure the script runs in the Korn shell.</span></p></li></ul>
<p><span class="font19">$ cat first.bash</span></p>
<p><span class="font19">#!/bin/ksh echo Antwerp</span></p>
<p><span class="font25">Note that while first.bash will technically work as a Korn shell script, the name ending in .bash is confusing.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Create a script that defines two variables, and outputs their value.</span></p></li></ul>
<p><span class="font19">$ cat second.bash</span></p>
<p><span class="font19">#!/bin/bash</span></p>
<p><span class="font19">var33=300</span></p>
<p><span class="font19">var42=400</span></p>
<p><span class="font19">echo $var33 $var42</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. The previous script does not influence your current shell (the variables do not exist outside of the script). Now run the script so that it influences your current shell.</span></p></li></ul>
<p><span class="font19">source second.bash</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Is there a shorter way to </span><span class="font25" style="font-weight:bold;">source </span><span class="font25">the script ?</span></p></li></ul>
<p><span class="font19">. ./second.bash</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. Comment your scripts so that you know what they are doing.</span></p></li></ul>
<p><span class="font19">$ cat second.bash</span></p>
<p><span class="font19">#!/bin/bash</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># script to test variables and sourcing</span></p></li>
<li>
<p><span class="font19"># define two variables</span></p></li></ul>
<p><span class="font19">var33=300</span></p>
<p><span class="font19">var42=400</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># output the value of these variables echo $var33 $var42</span></p></li></ul>
<ul style="list-style:none;"><li>
<p><a name="bookmark2136"></a><span class="font11" style="font-weight:bold;">Chapter 24. scripting loops</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2137"></a><span class="font10" style="font-weight:bold;"><a name="bookmark249"></a><a name="bookmark2138"></a>24.1. test [ ]</span></h2></li></ul>
<h4><a name="bookmark2139"></a><span class="font25"><a name="bookmark2140"></a><a name="bookmark2141"></a>The </span><span class="font25" style="font-weight:bold;">test </span><span class="font25">command can test whether something is true or false. Let's start by testing whether 10 is greater than 55.</span></h4>
<p><span class="font19">[paul@RHEL4b ~]$ test 10 -gt 55 ; echo $?</span></p>
<p><span class="font19">1</span></p>
<p><span class="font19">[paul@RHEL4b ~]$</span></p>
<h4><a name="bookmark2142"></a><span class="font25"><a name="bookmark2143"></a>The test command returns 1 if the test fails. And as you see in the next screenshot, test returns 0 when a test succeeds.</span></h4>
<p><span class="font19">[paul@RHEL4b ~]$ test 56 -gt 55 ; echo $?</span></p>
<p><span class="font19">0 [paul@RHEL4b ~]$</span></p>
<h4><a name="bookmark2144"></a><span class="font25"><a name="bookmark2145"></a>If you prefer true and false, then write the test like this.</span></h4>
<p><span class="font19">[paul@RHEL4b ~]$ test 56 -gt 55 &amp;&amp;&nbsp;echo true || echo false</span></p>
<p><span class="font19">true</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ test 6 -gt 55 &amp;&amp;&nbsp;echo true || echo false</span></p>
<p><span class="font19">false</span></p>
<h4><a name="bookmark2146"></a><span class="font25"><a name="bookmark2147"></a><a name="bookmark2148"></a>The test command can also be written as square brackets, the screenshot below is identical to the one above.</span></h4>
<p><span class="font19">[paul@RHEL4b ~]$ [ 56 -gt 55 ] &amp;&amp;&nbsp;echo true || echo false</span></p>
<p><span class="font19">true</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ [ 6 -gt 55 ] &amp;&amp;&nbsp;echo true || echo false</span></p>
<p><span class="font19">false</span></p>
<h4><a name="bookmark2149"></a><span class="font25"><a name="bookmark2150"></a>Below are some example tests. Take a look at </span><span class="font25" style="font-weight:bold;">man test </span><span class="font25">to see more options for tests.</span></h4>
<p><span class="font19">[ [</span></p>
<p><span class="font19">-d foo ]</span></p>
<p><span class="font19">-e bar ]</span></p>
<p><span class="font19">Does the directory foo exist Does the file bar exist ?</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[ '/etc'</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">= $PWD ]</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Is</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">the string /etc equal to the variab</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">le</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">$PWD</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[ $1 != ' [ 55 -lt</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">secret' ] $bar ]</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Is</span></p>
<p><span class="font19">Is</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">the first parameter different from 55 less than the value of $bar ?</span></p></td><td colspan="2" style="vertical-align:top;">
<p><span class="font19">secret '</span></p></td></tr>
<tr><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">[ $foo -ge 1000 ]</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Is</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">the value of $foo greater or equal</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">to</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1000</span></p></td></tr>
<tr><td colspan="2" style="vertical-align:top;">
<p><span class="font19">[ &quot;abc&quot; &lt;&nbsp;$bar ]</span></p>
<p><span class="font19">[ -f foo ]</span></p>
<p><span class="font19">[ -r bar ]</span></p>
<p><span class="font19">[ foo -nt bar ]</span></p>
<p><span class="font19">[ -o nounset ]</span></p></td><td colspan="2" style="vertical-align:top;">
<p><span class="font19">Does abc sort before the value of $bar Is foo a regular file ?</span></p>
<p><span class="font19">Is bar a readable file ?</span></p>
<p><span class="font19">Is file foo newer than file bar ?</span></p>
<p><span class="font19">Is the shell option nounset set ?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">?</span></p></td><td style="vertical-align:top;"></td></tr>
</table>
<h4><a name="bookmark2151"></a><span class="font25"><a name="bookmark2152"></a>Tests can be combined with logical AND and OR.</span></h4>
<p><span class="font19">paul@RHEL4b:~$ [ 66 -gt 55 -a 66 -lt 500 ] &amp;&amp;&nbsp;echo true || echo false true</span></p>
<p><span class="font19">paul@RHEL4b:~$ [ 66 -gt 55 -a 660 -lt 500 ] &amp;&amp;&nbsp;echo true || echo false false</span></p>
<p><span class="font19">paul@RHEL4b:~$ [ 66 -gt 55 -o 660 -lt 500 ] &amp;&amp;&nbsp;echo true || echo false true</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2153"></a><span class="font10" style="font-weight:bold;"><a name="bookmark250"></a><a name="bookmark2154"></a>24.2. if then else</span></h2></li></ul>
<p><a name="bookmark2155"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">if then else </span><span class="font25">construction is about choice. If a certain condition is met, then execute something, else execute something else. The example below tests whether a file exists, and if the file exists then a proper message is echoed.</span></p>
<p><span class="font19">#!/bin/bash</span></p>
<p><span class="font19">if [ -f isit.txt ]</span></p>
<p><span class="font19">then echo isit.txt exists!</span></p>
<p><span class="font19">else echo isit.txt not found fi</span></p>
<p><span class="font25">If we name the above script 'choice', then it executes like this.</span></p>
<p><span class="font19">[paul@RHEL4a scripts]$ ./choice isit.txt not found!</span></p>
<p><span class="font19">[paul@RHEL4a scripts]$ touch isit.txt</span></p>
<p><span class="font19">[paul@RHEL4a scripts]$ ./choice isit.txt exists!</span></p>
<p><span class="font19">[paul@RHEL4a scripts]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2156"></a><span class="font10" style="font-weight:bold;"><a name="bookmark251"></a><a name="bookmark2157"></a>24.3. if then elif</span></h2></li></ul>
<p><a name="bookmark2158"></a><span class="font25">You can nest a new </span><span class="font25" style="font-weight:bold;">if </span><span class="font25">inside an </span><span class="font25" style="font-weight:bold;">else </span><span class="font25">with </span><span class="font25" style="font-weight:bold;">elif</span><span class="font25">. This is a simple example.</span></p>
<p><span class="font19">#!/bin/bash count=42 if [ $count -eq 42 ] then</span></p>
<p><span class="font19">echo &quot;42 is correct.&quot; elif [ $count -gt 42 ] then</span></p>
<p><span class="font19">echo &quot;Too much.&quot;</span></p>
<p><span class="font19">else</span></p>
<p><span class="font19">echo &quot;Not enough.&quot; fi</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2159"></a><span class="font10" style="font-weight:bold;"><a name="bookmark252"></a><a name="bookmark2160"></a>24.4. for loop</span></h2></li></ul>
<p><a name="bookmark2161"></a><span class="font25">The example below shows the syntax of a classical </span><span class="font25" style="font-weight:bold;">for loop </span><span class="font25">in bash.</span></p>
<p><span class="font19">for i in 1 2 4 do</span></p>
<p><span class="font19">echo $i done</span></p>
<p><span class="font25">An example of a </span><span class="font25" style="font-weight:bold;">for loop </span><span class="font25">combined with an embedded shell.</span></p>
<p><span class="font19">#!/bin/ksh</span></p>
<p><span class="font19">for counter in 'seq 1 20' do</span></p>
<p><span class="font19">echo counting from 1 to 20, now at $counter sleep 1</span></p>
<p><span class="font19">done</span></p>
<p><span class="font25">The same example as above can be written without the embedded shell using the bash </span><span class="font25" style="font-weight:bold;">{from..to} </span><span class="font25">shorthand.</span></p>
<p><span class="font19">#!/bin/bash</span></p>
<p><span class="font19">for counter in {1..20} do</span></p>
<p><span class="font19">echo counting from 1 to 20, now at $counter sleep 1</span></p>
<p><span class="font19">done</span></p>
<h4><a name="bookmark2162"></a><span class="font25"><a name="bookmark2163"></a>This </span><span class="font25" style="font-weight:bold;">for loop </span><span class="font25">uses file globbing (from the shell expansion). Putting the instruction on the command line has identical functionality.</span></h4>
<p><span class="font19">kahlan@solexp11$ ls</span></p>
<p><span class="font19">count.ksh go.ksh</span></p>
<p><span class="font19">kahlan@solexp11$ for file in *.ksh ; do cp $file $file.backup ; done kahlan@solexp11$ ls count.ksh count.ksh.backup go.ksh go.ksh.backup</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2164"></a><span class="font10" style="font-weight:bold;"><a name="bookmark253"></a><a name="bookmark2165"></a>24.5. while loop</span></h2></li></ul>
<h4><a name="bookmark2166"></a><span class="font25"><a name="bookmark2167"></a><a name="bookmark2168"></a>Below a simple example of a </span><span class="font25" style="font-weight:bold;">while loop</span><span class="font25">.</span></h4>
<p><span class="font19">i=100;</span></p>
<p><span class="font19">while [ $i -ge 0 ] ; do</span></p>
<p><span class="font19">echo Counting down, from 100 to 0, now at $i;</span></p>
<p><span class="font19">let i--;</span></p>
<p><span class="font19">done</span></p>
<h4><a name="bookmark2169"></a><span class="font25"><a name="bookmark2170"></a>Endless loops can be made with </span><span class="font25" style="font-weight:bold;">while true </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">while : </span><span class="font25">, where the </span><span class="font25" style="font-weight:bold;">colon </span><span class="font25">is the equivalent of </span><span class="font25" style="font-weight:bold;">no operation </span><span class="font25">in the </span><span class="font25" style="font-weight:bold;">Korn </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">bash </span><span class="font25">shells.</span></h4>
<p><span class="font19">#!/bin/ksh # endless loop while : do</span></p>
<p><span class="font19">echo hello</span></p>
<p><span class="font19">sleep 1 done</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2171"></a><span class="font10" style="font-weight:bold;"><a name="bookmark254"></a><a name="bookmark2172"></a>24.6. until loop</span></h2></li></ul>
<h4><a name="bookmark2173"></a><span class="font25"><a name="bookmark2174"></a><a name="bookmark2175"></a>Below a simple example of an </span><span class="font25" style="font-weight:bold;">until loop</span><span class="font25">.</span></h4>
<p><span class="font19">let i=100;</span></p>
<p><span class="font19">until [ $i -le 0 ] ; do</span></p>
<p><span class="font19">echo Counting down, from 100 to 1, now at $i;</span></p>
<p><span class="font19">let i--;</span></p>
<p><span class="font19">done</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2176"></a><span class="font10" style="font-weight:bold;"><a name="bookmark255"></a><a name="bookmark2177"></a>24.7. practice: scripting tests and loops</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Write a script that uses a </span><span class="font25" style="font-weight:bold;">for </span><span class="font25">loop to count from 3 to 7.</span></p></li>
<li>
<p><span class="font25">2. Write a script that uses a </span><span class="font25" style="font-weight:bold;">for </span><span class="font25">loop to count from 1 to 17000.</span></p></li>
<li>
<p><span class="font25">3. Write a script that uses a </span><span class="font25" style="font-weight:bold;">while </span><span class="font25">loop to count from 3 to 7.</span></p></li>
<li>
<p><span class="font25">4. Write a script that uses an </span><span class="font25" style="font-weight:bold;">until </span><span class="font25">loop to count down from 8 to 4.</span></p></li>
<li>
<p><span class="font25">5. Write a script that counts the number of files ending in </span><span class="font25" style="font-weight:bold;">.txt </span><span class="font25">in the current directory.</span></p></li>
<li>
<p><span class="font25">6. Wrap an </span><span class="font25" style="font-weight:bold;">if </span><span class="font25">statement around the script so it is also correct when there are zero files ending in </span><span class="font25" style="font-weight:bold;">.txt</span><span class="font25">.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2178"></a><span class="font10" style="font-weight:bold;"><a name="bookmark256"></a><a name="bookmark2179"></a>24.8. solution: scripting tests and loops</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2180"></a><span class="font25"><a name="bookmark2181"></a>1. Write a script that uses a </span><span class="font25" style="font-weight:bold;">for </span><span class="font25">loop to count from 3 to 7.</span></h4></li></ul>
<p><span class="font19">#!/bin/bash</span></p>
<p><span class="font19">for i in 3 4 5 6 7 do</span></p>
<p><span class="font19">echo Counting from 3 to 7, now at $i done</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2182"></a><span class="font25"><a name="bookmark2183"></a>2. Write a script that uses a </span><span class="font25" style="font-weight:bold;">for </span><span class="font25">loop to count from 1 to 17000.</span></h4></li></ul>
<p><span class="font19">#!/bin/bash</span></p>
<p><span class="font19">for i in 'seq 1 17000' do</span></p>
<p><span class="font19">echo Counting from 1 to 17000, now at $i done</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2184"></a><span class="font25"><a name="bookmark2185"></a>3. Write a script that uses a </span><span class="font25" style="font-weight:bold;">while </span><span class="font25">loop to count from 3 to 7.</span></h4></li></ul>
<p><span class="font19">#!/bin/bash</span></p>
<p><span class="font19">i=3</span></p>
<p><span class="font19">while [ $i -le 7 ] do</span></p>
<p><span class="font19">echo Counting from 3 to 7, now at $i let i=i+1</span></p>
<p><span class="font19">done</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2186"></a><span class="font25"><a name="bookmark2187"></a>4. Write a script that uses an </span><span class="font25" style="font-weight:bold;">until </span><span class="font25">loop to count down from 8 to 4.</span></h4></li></ul>
<p><span class="font19">#!/bin/bash</span></p>
<p><span class="font19">i=8</span></p>
<p><span class="font19">until [ $i -lt 4 ] do</span></p>
<p><span class="font19">echo Counting down from 8 to 4, now at $i let i=i-1</span></p>
<p><span class="font19">done</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2188"></a><span class="font25"><a name="bookmark2189"></a>5. Write a script that counts the number of files ending in </span><span class="font25" style="font-weight:bold;">.txt </span><span class="font25">in the current directory. </span><span class="font19">#!/bin/bash let i=0</span></h4></li></ul>
<p><span class="font19">for file in *.txt do</span></p>
<p><span class="font19">let i++ done</span></p>
<p><span class="font19">echo &quot;There are $i files ending in .txt&quot;</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2190"></a><span class="font25"><a name="bookmark2191"></a>6. Wrap an </span><span class="font25" style="font-weight:bold;">if </span><span class="font25">statement around the script so it is also correct when there are zero files ending in </span><span class="font25" style="font-weight:bold;">.txt</span><span class="font25">.</span></h4></li></ul>
<p><span class="font19">#!/bin/bash</span></p>
<p><span class="font19">ls *.txt &gt;&nbsp;/dev/null 2&gt;&amp;1</span></p>
<p><span class="font19">if [ $? -ne 0 ]</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">then echo &quot;There are 0 files ending else</span></p></td><td style="vertical-align:top;">
<p><span class="font19">in .txt&quot;</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">let i=0</span></p>
<p><span class="font19">for file in *.txt do</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">let i++</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">done</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">echo &quot;There are $i files ending in fi</span></p></td><td style="vertical-align:top;">
<p><span class="font19">.txt&quot;</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<p><a name="bookmark2192"></a><span class="font11" style="font-weight:bold;">Chapter 25. scripting parameters</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2193"></a><span class="font10" style="font-weight:bold;"><a name="bookmark257"></a><a name="bookmark2194"></a>25.1. script parameters</span></h2></li></ul>
<p><a name="bookmark2195"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">bash </span><span class="font25">shell script can have parameters. The numbering you see in the script below continues if you have more parameters. You also have special parameters containing the number of parameters, a string of all of them, and also the process id, and the last return code. The man page of </span><span class="font25" style="font-weight:bold;">bash </span><span class="font25">has a full list.</span></p>
<p><span class="font19">#!/bin/bash</span></p>
<p><span class="font19">echo The first argument is $1</span></p>
<p><span class="font19">echo The second argument is $2</span></p>
<p><span class="font19">echo The third argument is $3</span></p>
<p><span class="font19">echo \$ $$ PID of the script echo \# $# count arguments echo \? $? last return code echo \* $* all the arguments</span></p>
<p><span class="font25">Below is the output of the script above in action.</span></p>
<p><span class="font19">[paul@RHEL4a scripts]$ ./pars one two three The first argument is one The second argument is two The third argument is three</span></p>
<p><span class="font19">$ 5610 PID of the script</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># 3 count arguments ? 0 last return code</span></p></li>
<li>
<p><span class="font19">* one two three all the arguments</span></p></li></ul>
<p><span class="font25">Once more the same script, but with only two parameters.</span></p>
<p><span class="font19">[paul@RHEL4a scripts]$ ./pars 1 2</span></p>
<p><span class="font19">The first argument is 1</span></p>
<p><span class="font19">The second argument is 2</span></p>
<p><span class="font19">The third argument is $ 5612 PID of the script # 2 count arguments ? 0 last return code * 1 2 all the arguments [paul@RHEL4a scripts]$</span></p>
<p><span class="font25">Here is another example, where we use </span><span class="font25" style="font-weight:bold;">$0</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">$0 </span><span class="font25">parameter contains the name of the script.</span></p>
<p><span class="font19">paul@debian6~$ cat myname</span></p>
<p><span class="font19">echo this script is called $0 paul@debian6~$ ./myname this script is called ./myname paul@debian6~$ mv myname test42 paul@debian6~$ ./test42 this script is called ./test42</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2196"></a><span class="font10" style="font-weight:bold;"><a name="bookmark259"></a><a name="bookmark2197"></a>25.2. shift through parameters</span></h2></li></ul>
<h4><a name="bookmark2198"></a><span class="font25"><a name="bookmark2199"></a><a name="bookmark2200"></a>The </span><span class="font25" style="font-weight:bold;">shift </span><span class="font25">statement can parse all </span><span class="font25" style="font-weight:bold;">parameters </span><span class="font25">one by one. This is a sample script.</span></h4>
<p><span class="font19">kahlan@solexp11$ cat shift.ksh</span></p>
<p><span class="font19">#!/bin/ksh</span></p>
<p><span class="font19">if [ &quot;$#&quot; == &quot;0&quot; ]</span></p>
<p><span class="font19">then</span></p>
<p><span class="font19">echo You have to give at least one parameter. exit 1</span></p>
<p><span class="font19">fi</span></p>
<p><span class="font19">while (( $# ))</span></p>
<p><span class="font19">do</span></p>
<p><span class="font19">echo You gave me $1</span></p>
<p><span class="font19">shift</span></p>
<p><span class="font19">done</span></p>
<h4><a name="bookmark2201"></a><span class="font25"><a name="bookmark2202"></a>Below is some sample output of the script above.</span></h4>
<p><span class="font19">kahlan@solexp11$ ./shift.ksh one</span></p>
<p><span class="font19">You gave me one</span></p>
<p><span class="font19">kahlan@solexp11$ ./shift.ksh one two three 1201 &quot;33 42&quot;</span></p>
<p><span class="font19">You gave me one</span></p>
<p><span class="font19">You gave me two</span></p>
<p><span class="font19">You gave me three</span></p>
<p><span class="font19">You gave me 1201</span></p>
<p><span class="font19">You gave me 33 42</span></p>
<p><span class="font19">kahlan@solexp11$ ./shift.ksh</span></p>
<p><span class="font19">You have to give at least one parameter.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2203"></a><span class="font10" style="font-weight:bold;"><a name="bookmark260"></a><a name="bookmark2204"></a>25.3. runtime input</span></h2></li></ul>
<h4><a name="bookmark2205"></a><span class="font25"><a name="bookmark2206"></a><a name="bookmark2207"></a>You can ask the user for input with the </span><span class="font25" style="font-weight:bold;">read </span><span class="font25">command in a script.</span></h4>
<p><span class="font19">#!/bin/bash</span></p>
<p><span class="font19">echo -n Enter a number: read number</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2208"></a><span class="font10" style="font-weight:bold;"><a name="bookmark261"></a><a name="bookmark2209"></a>25.4. sourcing a config file</span></h2></li></ul>
<h4><a name="bookmark2210"></a><span class="font25"><a name="bookmark2211"></a><a name="bookmark2212"></a>The </span><span class="font25" style="font-weight:bold;">source </span><span class="font25">(as seen in the shell chapters) can be used to source a configuration file.</span><br><br><span class="font25"><a name="bookmark2213"></a>Below a sample configuration file for an application.</span></h4>
<p><span class="font19">[paul@RHEL4a scripts]$ cat myApp.conf</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># The config file of myApp</span></p></li>
<li>
<p><span class="font19"># Enter the path here</span></p></li></ul>
<p><span class="font19">myAppPath=/var/myApP</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Enter the number of quines here quines=5</span></p></li></ul>
<h4><a name="bookmark2214"></a><span class="font25"><a name="bookmark2215"></a>And here an application that uses this file.</span></h4>
<p><span class="font19">[paul@RHEL4a scripts]$ cat myApp.bash</span></p>
<p><span class="font19">#!/bin/bash</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">#</span></p></li>
<li>
<p><span class="font19"># Welcome to the myApp application</span></p></li>
<li>
<p><span class="font19">#</span></p></li></ul>
<p><span class="font19">. ./myApp.conf</span></p>
<p><span class="font19">echo There are $quines quines</span></p>
<h4><a name="bookmark2216"></a><span class="font25"><a name="bookmark2217"></a>The running application can use the values inside the sourced configuration file.</span></h4>
<p><span class="font19">[paul@RHEL4a scripts]$ ./myApp.bash</span></p>
<p><span class="font19">There are 5 quines [paul@RHEL4a scripts]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2218"></a><span class="font10" style="font-weight:bold;"><a name="bookmark262"></a><a name="bookmark2219"></a>25.5. get script options with getopts</span></h2></li></ul>
<h4><a name="bookmark2220"></a><span class="font25"><a name="bookmark2221"></a><a name="bookmark2222"></a>The </span><span class="font25" style="font-weight:bold;">getopts </span><span class="font25">function allows you to parse options given to a command. The following script allows for any combination of the options a, f and z.</span></h4>
<p><span class="font19">kahlan@solexp11$ cat options.ksh</span></p>
<p><span class="font19">#!/bin/ksh</span></p>
<p><span class="font19">while getopts &quot;:afz&quot; option;</span></p>
<p><span class="font19">do</span></p>
<p><span class="font19">case $option in</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">a)</span></p></li></ul>
<p><span class="font19">echo received -a</span></p>
<p><span class="font19">f)</span></p>
<p><span class="font19">echo received -f</span></p>
<p><span class="font19">z)</span></p>
<p><span class="font19">echo received -z</span></p>
<p><span class="font19">*)</span></p>
<p><span class="font19">echo &quot;invalid option -$OPTARG&quot;</span></p>
<p><span class="font19">esac</span></p>
<p><span class="font19">done</span></p>
<h4><a name="bookmark2223"></a><span class="font25"><a name="bookmark2224"></a>This is sample output from the script above. First we use correct options, then we enter twice an invalid option.</span></h4>
<p><span class="font19">kahlan@solexp11$ ./options.ksh</span></p>
<p><span class="font19">kahlan@solexp11$ ./options.ksh -af received -a received -f kahlan@solexp11$ ./options.ksh -zfg received -z received -f invalid option -g</span></p>
<p><span class="font19">kahlan@solexp11$ ./options.ksh -a -b -z received -a invalid option -b received -z</span></p>
<p><span class="font25">You can also check for options that need an argument, as this example shows.</span></p>
<p><span class="font19">kahlan@solexp11$ cat argoptions.ksh</span></p>
<p><span class="font19">#!/bin/ksh</span></p>
<p><span class="font19">while getopts &quot;:af:z&quot; option;</span></p>
<p><span class="font19">do</span></p>
<p><span class="font19">case $option in</span></p>
<p><span class="font19">a) echo received -a</span></p>
<p><span class="font19">f)</span></p>
<p><span class="font19">echo received -f with $OPTARG</span></p>
<p><span class="font19">z) echo received -z</span></p>
<p><span class="font19">:)</span></p>
<p><span class="font19">echo &quot;option -$OPTARG needs an argument&quot;</span></p>
<p><span class="font19">*)</span></p>
<p><span class="font19">echo &quot;invalid option -$OPTARG&quot;</span></p>
<p><span class="font19">esac</span></p>
<p><span class="font19">done</span></p>
<p><span class="font25">This is sample output from the script above.</span></p>
<p><span class="font19">kahlan@solexp11$ ./argoptions.ksh -a -f hello -z received -a received -f with hello received -z kahlan@solexp11$ ./argoptions.ksh -zaf 42 received -z received -a received -f with 42 kahlan@solexp11$ ./argoptions.ksh -zf received -z option -f needs an argument</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2225"></a><span class="font10" style="font-weight:bold;"><a name="bookmark263"></a><a name="bookmark2226"></a>25.6. get shell options with shopt</span></h2></li></ul>
<p><a name="bookmark2227"></a><span class="font25">You can toggle the values of variables controlling optional shell behaviour with the </span><span class="font25" style="font-weight:bold;">shopt </span><span class="font25">built-in shell command. The example below first verifies whether the cdspell option is set; it is not. The next shopt command sets the value, and the third shopt command verifies that the option really is set. You can now use minor spelling mistakes in the cd command. The man page of bash has a complete list of options.</span></p>
<p><span class="font19">paul@laika:~$ shopt -q cdspell ; echo $?</span></p>
<p><span class="font19">1</span></p>
<p><span class="font19">paul@laika:~$ shopt -s cdspell</span></p>
<p><span class="font19">paul@laika:~$ shopt -q cdspell ; echo $?</span></p>
<p><span class="font19">0</span></p>
<p><span class="font19">paul@laika:~$ cd /Etc</span></p>
<p><span class="font19">/etc</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2228"></a><span class="font10" style="font-weight:bold;"><a name="bookmark264"></a><a name="bookmark2229"></a>25.7. practice: parameters and options</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Write a script that receives four parameters, and outputs them in reverse order.</span></p></li>
<li>
<p><span class="font25">2. Write a script that receives two parameters (two filenames) and outputs whether those files exist.</span></p></li>
<li>
<p><span class="font25">3. Write a script that asks for a filename. Verify existence of the file, then verify that you own the file, and whether it is writable. If not, then make it writable.</span></p></li>
<li>
<p><span class="font25">4. Make a configuration file for the previous script. Put a logging switch in the config file, logging means writing detailed output of everything the script does to a log file in /tmp.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2230"></a><span class="font10" style="font-weight:bold;"><a name="bookmark265"></a><a name="bookmark2231"></a>25.8. solution: parameters and options</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Write a script that receives four parameters, and outputs them in reverse order. </span><span class="font19">echo $4 $3 $2 $1</span></p></li>
<li>
<p><span class="font25">2. Write a script that receives two parameters (two filenames) and outputs whether those files exist.</span></p></li></ul>
<p><span class="font19">#!/bin/bash</span></p>
<p><span class="font19">if [ -f $1 ]</span></p>
<p><span class="font19">then echo $1 exists!</span></p>
<p><span class="font19">else echo $1 not found! fi</span></p>
<p><span class="font19">if [ -f $2 ]</span></p>
<p><span class="font19">then echo $2 exists!</span></p>
<p><span class="font19">else echo $2 not found! fi</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Write a script that asks for a filename. Verify existence of the file, then verify that you own the file, and whether it is writable. If not, then make it writable.</span></p></li>
<li>
<p><span class="font25">4. Make a configuration file for the previous script. Put a logging switch in the config file, logging means writing detailed output of everything the script does to a log file in /tmp.</span></p></li></ul>
<ul style="list-style:none;"><li>
<p><a name="bookmark2232"></a><span class="font11" style="font-weight:bold;">Chapter 26. more scripting</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2233"></a><span class="font10" style="font-weight:bold;"><a name="bookmark267"></a><a name="bookmark2234"></a>26.1. eval</span></h2></li></ul>
<h4><a name="bookmark2235"></a><span class="font25" style="font-weight:bold;"><a name="bookmark2236"></a><a name="bookmark2237"></a>eval </span><span class="font25">reads arguments as input to the shell (the resulting commands are executed). This allows using the value of a variable as a variable.</span></h4>
<p><span class="font19">paul@deb503:~/test42$ answer=42</span></p>
<p><span class="font19">paul@deb503:~/test42$ word=answer</span></p>
<p><span class="font19">paul@deb503:~/test42$ eval x=\$$word ; echo $x</span></p>
<p><span class="font19">42</span></p>
<h4><a name="bookmark2238"></a><span class="font25"><a name="bookmark2239"></a>Both in </span><span class="font25" style="font-weight:bold;">bash </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">Korn </span><span class="font25">the arguments can be quoted.</span></h4>
<p><span class="font19">kahlan@solexp11$ answer=42</span></p>
<p><span class="font19">kahlan@solexp11$ word=answer</span></p>
<p><span class="font19">kahlan@solexp11$ eval &quot;y=\$$word&quot; ; echo $y</span></p>
<p><span class="font19">42</span></p>
<h4><a name="bookmark2240"></a><span class="font25"><a name="bookmark2241"></a>Sometimes the </span><span class="font25" style="font-weight:bold;">eval </span><span class="font25">is needed to have correct parsing of arguments. Consider this example where the </span><span class="font25" style="font-weight:bold;">date </span><span class="font25">command receives one parameter </span><span class="font25" style="font-weight:bold;">1 week ago</span><span class="font25">.</span></h4>
<p><span class="font19">paul@debian6~$ date --date=&quot;1 week ago&quot;</span></p>
<p><span class="font19">Thu Mar 8 21:36:25 CET 2012</span></p>
<h4><a name="bookmark2242"></a><span class="font25"><a name="bookmark2243"></a>When we set this command in a variable, then executing that variable fails unless we use </span><span class="font25" style="font-weight:bold;">eval</span><span class="font25">.</span></h4>
<p><span class="font19">paul@debian6~$ lastweek='date --date=&quot;1 week ago&quot;' paul@debian6~$ $lastweek date: extra operand 'ago&quot;' Try 'date --help' for more information. paul@debian6~$ eval $lastweek Thu Mar 8 21:36:39 CET 2012</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2244"></a><span class="font10" style="font-weight:bold;"><a name="bookmark268"></a><a name="bookmark2245"></a>26.2. (( ))</span></h2></li></ul>
<h4><a name="bookmark2246"></a><span class="font25"><a name="bookmark2247"></a><a name="bookmark2248"></a>The </span><span class="font25" style="font-weight:bold;">(( )) </span><span class="font25">allows for evaluation of numerical expressions.</span></h4>
<p><span class="font19">paul@deb503:~/test42$ (( 42 &gt;&nbsp;33 )) &amp;&amp;&nbsp;echo true || echo false true</span></p>
<p><span class="font19">paul@deb503:~/test42$ (( 42 &gt;&nbsp;1201 )) &amp;&amp;&nbsp;echo true || echo false false</span></p>
<p><span class="font19">paul@deb503:~/test42$ var42=42</span></p>
<p><span class="font19">paul@deb503:~/test42$ (( 42 == var42 )) &amp;&amp;&nbsp;echo true || echo false true</span></p>
<p><span class="font19">paul@deb503:~/test42$ (( 42 == $var42 )) &amp;&amp;&nbsp;echo true || echo false true</span></p>
<p><span class="font19">paul@deb503:~/test42$ var42=33</span></p>
<p><span class="font19">paul@deb503:~/test42$ (( 42 == var42 )) &amp;&amp;&nbsp;echo true || echo false false</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2249"></a><span class="font10" style="font-weight:bold;"><a name="bookmark269"></a><a name="bookmark2250"></a>26.3. let</span></h2></li></ul>
<h4><a name="bookmark2251"></a><span class="font25"><a name="bookmark2252"></a><a name="bookmark2253"></a>The </span><span class="font25" style="font-weight:bold;">let </span><span class="font25">built-in shell function instructs the shell to perform an evaluation of arithmetic expressions. It will return 0 unless the last arithmetic expression evaluates to 0.</span></h4>
<p><span class="font19">[paul@RHEL4b ~]$ let x=&quot;3 + 4&quot; ; echo $x 7</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ let x=&quot;10 + 100/10&quot; ; echo $x 20</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ let x=&quot;10-2+100/10&quot; ; echo $x 18</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ let x=&quot;10*2+100/10&quot; ; echo $x 30</span></p>
<h4><a name="bookmark2254"></a><span class="font25"><a name="bookmark2255"></a>The </span><span class="font25" style="font-weight:bold;">shell </span><span class="font25">can also convert between different bases.</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[paul@RHEL4b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~]$</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">let</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">x=&quot;0xFF&quot; ;</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">echo</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">$x</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">255 [paul@RHEL4b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~]$</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">let</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">x=&quot;0xC0&quot; ;</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">echo</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">$x</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">192 [paul@RHEL4b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~]$</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">let</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">X=&quot;0xA8&quot; ;</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">echo</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">$x</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">168 [paul@RHEL4b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~]$</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">let</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">x=&quot;8#70&quot; ;</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">echo</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">$x</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">56</span></p>
<p><span class="font19">[paul@RHEL4b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~]$</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">let</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">x=&quot;8#77&quot; ;</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">echo</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">$x</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">63</span></p>
<p><span class="font19">[paul@RHEL4b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~]$</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">let</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">x=&quot;16#c0&quot;</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">; echo</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">&gt; $x</span></p></td></tr>
</table>
<p><span class="font19">192</span></p>
<h4><a name="bookmark2256"></a><span class="font25"><a name="bookmark2257"></a>There is a difference between assigning a variable directly, or using </span><span class="font25" style="font-weight:bold;">let </span><span class="font25">to evaluate the arithmetic expressions (even if it is just assigning a value).</span></h4>
<p><span class="font19">kahlan@solexp11$ dec=15 ; oct=017 ; hex=0x0f</span></p>
<p><span class="font19">kahlan@solexp11$ echo $dec $oct $hex</span></p>
<p><span class="font19">15 017 0x0f</span></p>
<p><span class="font19">kahlan@solexp11$ let dec=15 ; let oct=017 ; let hex=0x0f</span></p>
<p><span class="font19">kahlan@solexp11$ echo $dec $oct $hex</span></p>
<p><span class="font19">15 15 15</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2258"></a><span class="font10" style="font-weight:bold;"><a name="bookmark270"></a><a name="bookmark2259"></a>26.4. case</span></h2></li></ul>
<h4><a name="bookmark2260"></a><span class="font25"><a name="bookmark2261"></a><a name="bookmark2262"></a>You can sometimes simplify nested if statements with a </span><span class="font25" style="font-weight:bold;">case </span><span class="font25">construct.</span></h4>
<p><span class="font19">[paul@RHEL4b ~]$ ./help</span></p>
<p><span class="font19">What animal did you see ? lion</span></p>
<p><span class="font19">You better start running fast! [paul@RHEL4b ~]$ ./help</span></p>
<p><span class="font19">What animal did you see ? dog</span></p>
<p><span class="font19">Don't worry, give it a cookie.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ cat help</span></p>
<p><span class="font19">#!/bin/bash #</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Wild Animals Helpdesk Advice #</span></p></li></ul>
<p><span class="font19">echo -n &quot;What animal did you see ? &quot;&nbsp;read animal case $animal in &quot;lion&quot; | &quot;tiger&quot;)</span></p>
<p><span class="font19">echo &quot;You better start running fast!&quot;</span></p>
<p><span class="font19">&quot;cat&quot;) echo &quot;Let that mouse go...&quot;</span></p>
<p><span class="font19">&quot;dog&quot;)</span></p>
<p><span class="font19">echo &quot;Don't worry, give it a cookie.&quot;</span></p>
<p><span class="font19">&quot;chicken&quot; | &quot;goose&quot; | &quot;duck&quot; ) echo &quot;Eggs for breakfast!&quot;</span></p>
<p><span class="font19">&quot;liger&quot;)</span></p>
<p><span class="font19">echo &quot;Approach and say 'Ah you big fluffy kitty...'.&quot;</span></p>
<p><span class="font19">&quot;babelfish&quot;) echo &quot;Did it fall out your ear ?&quot;</span></p>
<p><span class="font19">*) echo &quot;You discovered an unknown animal, name it!&quot;</span></p>
<p><span class="font19">esac [paul@RHEL4b ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2263"></a><span class="font10" style="font-weight:bold;"><a name="bookmark271"></a><a name="bookmark2264"></a>26.5. shell functions</span></h2></li></ul>
<h4><a name="bookmark2265"></a><span class="font25"><a name="bookmark2266"></a><a name="bookmark2267"></a>Shell </span><span class="font25" style="font-weight:bold;">functions </span><span class="font25">can be used to group commands in a logical way.</span></h4>
<p><span class="font19">kahlan@solexp11$ cat funcs.ksh</span></p>
<p><span class="font19">#!/bin/ksh</span></p>
<p><span class="font19">function greetings { echo Hello World!</span></p>
<p><span class="font19">echo and hello to $USER to! }</span></p>
<p><span class="font19">echo We will now call a function greetings echo The end</span></p>
<h4><a name="bookmark2268"></a><span class="font25"><a name="bookmark2269"></a><a name="bookmark2270"></a>This is sample output from this script with a </span><span class="font25" style="font-weight:bold;">function</span><span class="font25">.</span></h4>
<p><span class="font19">kahlan@solexp11$ ./funcs.ksh</span></p>
<p><span class="font19">We will now call a function</span></p>
<p><span class="font19">Hello World!</span></p>
<p><span class="font19">and hello to kahlan to!</span></p>
<p><span class="font19">The end</span></p>
<h4><a name="bookmark2271"></a><span class="font25"><a name="bookmark2272"></a>A shell function can also receive parameters.</span></h4>
<p><span class="font19">kahlan@solexp11$ cat addfunc.ksh #!/bin/ksh</span></p>
<p><span class="font19">function plus {</span></p>
<p><span class="font19">let result=&quot;$1 + $2&quot; echo $1 + $2 = $result }</span></p>
<p><span class="font19">plus 3 10</span></p>
<p><span class="font19">plus 20 13</span></p>
<p><span class="font19">plus 20 22</span></p>
<h4><a name="bookmark2273"></a><span class="font25"><a name="bookmark2274"></a>This script produces the following output.</span></h4>
<p><span class="font19">kahlan@solexp11$ ./addfunc.ksh</span></p>
<p><span class="font19">3 + 10 = 13</span></p>
<p><span class="font19">20 + 13 = 33</span></p>
<p><span class="font19">20 + 22 = 42</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2275"></a><span class="font10" style="font-weight:bold;"><a name="bookmark272"></a><a name="bookmark2276"></a>26.6. practice : more scripting</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Write a script that asks for two numbers, and outputs the sum and product (as shown here).</span></p></li></ul>
<p><span class="font19">Enter a number: 5</span></p>
<p><span class="font19">Enter another number: 2</span></p>
<p><span class="font19">Sum: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5 + 2 = 7</span></p>
<p><span class="font19">Product: &nbsp;&nbsp;5 x 2 = 10</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Improve the previous script to test that the numbers are between 1 and 100, exit with an error if necessary.</span></p></li>
<li>
<p><span class="font25">3. Improve the previous script to congratulate the user if the sum equals the product.</span></p></li>
<li>
<p><span class="font25">4. Write a script with a case insensitive case statement, using the shopt nocasematch option. The nocasematch option is reset to the value it had before the scripts started.</span></p></li>
<li>
<p><span class="font25">5. If time permits (or if you are waiting for other students to finish this practice), take a look at Linux system scripts in /etc/init.d and /etc/rc.d and try to understand them. Where does execution of a script start in /etc/init.d/samba ? There are also some hidden scripts in ~, we will discuss them later.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2277"></a><span class="font10" style="font-weight:bold;"><a name="bookmark273"></a><a name="bookmark2278"></a>26.7. solution : more scripting</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2279"></a><span class="font25"><a name="bookmark2280"></a>1. Write a script that asks for two numbers, and outputs the sum and product (as shown here).</span></h4></li></ul>
<p><span class="font19">Enter a number: 5</span></p>
<p><span class="font19">Enter another number: 2</span></p>
<p><span class="font19">Sum: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5 + 2 = 7</span></p>
<p><span class="font19">Product: &nbsp;&nbsp;5 x 2 = 10</span></p>
<p><span class="font19">#!/bin/bash</span></p>
<p><span class="font19">echo -n &quot;Enter a number : &quot;</span></p>
<p><span class="font19">read n1</span></p>
<p><span class="font19">echo -n &quot;Enter another number : &quot;&nbsp;read n2</span></p>
<p><span class="font19">let sum=&quot;$n1+$n2&quot;</span></p>
<p><span class="font19">let pro=&quot;$n1*$n2&quot;</span></p>
<p><span class="font19">echo -e &quot;Sum\t: $n1 + $n2 = $sum&quot;</span></p>
<p><span class="font19">echo -e &quot;Product\t: $n1 * $n2 = $pro&quot;</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2281"></a><span class="font25"><a name="bookmark2282"></a>2. Improve the previous script to test that the numbers are between 1 and 100, exit with an error if necessary.</span></h4></li></ul>
<p><span class="font19">echo -n &quot;Enter a number between 1 and 100 : read n1</span></p>
<p><span class="font19">if [ $n1 -lt 1 -o $n1 -gt 100 ]</span></p>
<p><span class="font19">then</span></p>
<p><span class="font19">echo Wrong number...</span></p>
<p><span class="font19">exit 1</span></p>
<p><span class="font19">fi</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2283"></a><span class="font25"><a name="bookmark2284"></a>3. Improve the previous script to congratulate the user if the sum equals the product.</span></h4></li></ul>
<p><span class="font19">if [ $sum -eq $pro ]</span></p>
<p><span class="font19">then echo Congratulations $sum == $pro fi</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2285"></a><span class="font25"><a name="bookmark2286"></a>4. Write a script with a case insensitive case statement, using the shopt nocasematch option.</span><br><br><span class="font25"><a name="bookmark2287"></a>The nocasematch option is reset to the value it had before the scripts started.</span></h4>
<p><span class="font19">#!/bin/bash</span></p></li></ul>
<p><span class="font19">#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Wild Animals Case Insensitive Helpdesk Advice #</span></p></li></ul>
<p><span class="font19">if shopt -q nocasematch; then nocase=yes;</span></p>
<p><span class="font19">else</span></p>
<p><span class="font19">nocase=no;</span></p>
<p><span class="font19">shopt -s nocasematch; fi</span></p>
<p><span class="font19">echo -n &quot;What animal did you see ? &quot;&nbsp;read animal</span></p>
<p><span class="font19">case $animal in</span></p>
<p><span class="font19">&quot;lion&quot; | &quot;tiger&quot;) echo &quot;You better start running fast!&quot; ; ;</span></p>
<p><span class="font19">&quot;cat&quot;) echo &quot;Let that mouse go...&quot;</span></p>
<p><span class="font19">; ;</span></p>
<p><span class="font19">&quot;dog&quot;) echo &quot;Don't worry, give it a cookie.&quot;</span></p>
<p><span class="font19">; ;</span></p>
<p><span class="font19">&quot;chicken&quot; | &quot;goose&quot; | &quot;duck&quot; ) echo &quot;Eggs for breakfast!&quot; ; ;</span></p>
<p><span class="font19">&quot;liger&quot;)</span></p>
<p><span class="font19">echo &quot;Approach and say 'Ah you big fluffy kitty.'&quot; ; ;</span></p>
<p><span class="font19">&quot;babelfish&quot;) echo &quot;Did it fall out your ear ?&quot;</span></p>
<p><span class="font19">; ;</span></p>
<p><span class="font19">*) echo &quot;You discovered an unknown animal, name it!&quot;</span></p>
<p><span class="font19">; ; esac</span></p>
<p><span class="font19">if [ nocase = yes ] ; then shopt -s nocasematch;</span></p>
<p><span class="font19">else shopt -u nocasematch;</span></p>
<p><span class="font19">fi</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. If time permits (or if you are waiting for other students to finish this practice), take a look at Linux system scripts in /etc/init.d and /etc/rc.d and try to understand them. Where does execution of a script start in /etc/init.d/samba ? There are also some hidden scripts in ~, we will discuss them later.</span></p></li></ul>
<p><a name="bookmark2288"></a><span class="font11" style="font-weight:bold;">Part VIII. local user management</span></p>
<h3><a name="bookmark2289"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2290"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2291"><span class="font24" style="font-weight:bold;">27. introduction to users </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2292"><span class="font24">27.1. whoami </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2293"><span class="font24">27.2. who </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2294"><span class="font24">27.3. who am i </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2295"><span class="font24">27.4. w </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2296"><span class="font24">27.5. id </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2297"><span class="font24">27.6. su to another user </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2298"><span class="font24">27.7. su to root </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2299"><span class="font24">27.8. su as root </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2300"><span class="font24">27.9. su - $username </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2301"><span class="font24">27.10. su - </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2302"><span class="font24">27.11. run a program as another user </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2303"><span class="font24">27.12. visudo </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2304"><span class="font24">27.13. sudo su - </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2305"><span class="font24">27.14. sudo logging </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2306"><span class="font24">27.15. practice: introduction to users </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2307"><span class="font24">27.16. solution: introduction to users </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2308"><span class="font24" style="font-weight:bold;">28. user management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2309"><span class="font24">28.1. user management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2310"><span class="font24">28.2. /etc/passwd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2311"><span class="font24">28.3. root </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2312"><span class="font24">28.4. useradd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2313"><span class="font24">28.5. /etc/default/useradd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2314"><span class="font24">28.6. userdel </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2315"><span class="font24">28.7. usermod </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2316"><span class="font24">28.8. creating home directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2317"><span class="font24">28.9. /etc/skel/ </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2318"><span class="font24">28.10. deleting home directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2319"><span class="font24">28.11. login shell </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2320"><span class="font24">28.12. chsh </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2321"><span class="font24">28.13. practice: user management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2322"><span class="font24">28.14. solution: user management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2323"><span class="font24" style="font-weight:bold;">29. user passwords </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2324"><span class="font24">29.1. passwd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2325"><span class="font24">29.2. shadow file </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2326"><span class="font24">29.3. encryption with passwd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2327"><span class="font24">29.4. encryption with openssl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2328"><span class="font24">29.5. encryption with crypt </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2329"><span class="font24">29.6. /etc/login.defs </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2330"><span class="font24">29.7. chage </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2331"><span class="font24">29.8. disabling a password </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2332"><span class="font24">29.9. editing local files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2333"><span class="font24">29.10. practice: user passwords </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2334"><span class="font24">29.11. solution: user passwords </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2335"><span class="font24" style="font-weight:bold;">30. user profiles </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2336"><span class="font24">30.1. system profile </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2337"><span class="font24">30.2. ~/.bash_profile </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2338"><span class="font24">30.3. ~/.bash_login </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2339"><span class="font24">30.4. ~/.profile </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2340"><span class="font24">30.5. ~/.bashrc </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2341"><span class="font24">30.6. ~/.bash_logout </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2342"><span class="font24">30.7. Debian overview </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2343"><span class="font24">30.8. RHEL5 overview </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2344"><span class="font24">30.9. practice: user profiles </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2345"><span class="font24">30.10. solution: user profiles </span></a></p></li></ul>
<p><span class="font24">local user management</span></p>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2346"><span class="font24" style="font-weight:bold;">31. groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2347"><span class="font24">31.1. groupadd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2348"><span class="font24">31.2. group file </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2349"><span class="font24">31.3. groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2350"><span class="font24">31.4. usermod </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2351"><span class="font24">31.5. groupmod </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2352"><span class="font24">31.6. groupdel </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2353"><span class="font24">31.7. gpasswd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2354"><span class="font24">31.8. newgrp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2355"><span class="font24">31.9. vigr </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2356"><span class="font24">31.10. practice: groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2357"><span class="font24">31.11. solution: groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark2358"></a><span class="font11" style="font-weight:bold;"><a name="bookmark275"></a><a name="bookmark2359"></a>Chapter 27. introduction to users</span></h1></li></ul>
<p><span class="font25">This little chapter will teach you how to identify your user account on a Unix computer using commands like </span><span class="font25" style="font-weight:bold;">who am i</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">id</span><span class="font25">, and more.</span></p>
<p><span class="font25">In a second part you will learn how to become another user with the </span><span class="font25" style="font-weight:bold;">su </span><span class="font25">command.</span></p>
<p><span class="font25">And you will learn how to run a program as another user with </span><span class="font25" style="font-weight:bold;">sudo</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2360"></a><span class="font10" style="font-weight:bold;"><a name="bookmark276"></a><a name="bookmark2361"></a>27.1. whoami</span></h2></li></ul>
<h4><a name="bookmark2362"></a><span class="font25"><a name="bookmark2363"></a><a name="bookmark2364"></a>The </span><span class="font25" style="font-weight:bold;">whoami </span><span class="font25">command tells you your username.</span></h4>
<p><span class="font19">[paul@centos7 ~]$ </span><span class="font19" style="font-weight:bold;">whoami</span></p>
<p><span class="font19">paul</span></p>
<p><span class="font19">[paul@centos7 ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2365"></a><span class="font10" style="font-weight:bold;"><a name="bookmark277"></a><a name="bookmark2366"></a>27.2. who</span></h2></li></ul>
<h4><a name="bookmark2367"></a><span class="font25"><a name="bookmark2368"></a><a name="bookmark2369"></a>The </span><span class="font25" style="font-weight:bold;">who </span><span class="font25">command will give you information about who is logged on the system.</span></h4>
<p><span class="font19">[paul@centos7 ~]$ </span><span class="font19" style="font-weight:bold;">who</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pts/0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2014-10-10</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">23:07</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">(10.104.33.101)</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pts/1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2014-10-10</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">23:30</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">(10.104.33.101)</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">laura</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2014-10-10</span></p></td><td style="vertical-align:top;">
<p><span class="font19">23:34</span></p></td><td style="vertical-align:top;">
<p><span class="font19">(10.104.33.96)</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">tania</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2014-10-10</span></p></td><td style="vertical-align:top;">
<p><span class="font19">23:39</span></p></td><td style="vertical-align:top;">
<p><span class="font19">(10.104.33.91)</span></p></td></tr>
</table>
<p><span class="font19">[paul@centos7 ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2370"></a><span class="font10" style="font-weight:bold;"><a name="bookmark278"></a><a name="bookmark2371"></a>27.3. who am i</span></h2></li></ul>
<h4><a name="bookmark2372"></a><span class="font25"><a name="bookmark2373"></a><a name="bookmark2374"></a>With </span><span class="font25" style="font-weight:bold;">who am i </span><span class="font25">the </span><span class="font25" style="font-weight:bold;">who </span><span class="font25">command will display only the line pointing to your current session.</span></h4>
<p><span class="font19">[paul@centos7 ~]$ </span><span class="font19" style="font-weight:bold;">who am i</span></p>
<p><span class="font19">paul pts/1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2014-10-10 23:30 (10.104.33.101)</span></p>
<p><span class="font19">[paul@centos7 ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2375"></a><span class="font10" style="font-weight:bold;"><a name="bookmark279"></a><a name="bookmark2376"></a>27.4. w</span></h2></li></ul>
<h4><a name="bookmark2377"></a><span class="font25"><a name="bookmark2378"></a><a name="bookmark2379"></a>The </span><span class="font25" style="font-weight:bold;">w </span><span class="font25">command shows you who is logged on and what they are doing.</span></h4>
<p><span class="font19">[paul@centos7 ~]$ </span><span class="font19" style="font-weight:bold;">w</span></p>
<p><span class="font19">23:34:07 up 31 min, 2 users, load average: 0.00, 0.01, 0.02</span></p>
<p><span class="font19">USER TTY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGIN@ IDLE JCPU PCPU WHAT</span></p>
<p><span class="font19">root &nbsp;&nbsp;&nbsp;&nbsp;pts/0 &nbsp;&nbsp;&nbsp;&nbsp;23:07 &nbsp;&nbsp;15.00s &nbsp;0.01s &nbsp;0.01s top</span></p>
<p><span class="font19">paul &nbsp;&nbsp;&nbsp;&nbsp;pts/1 &nbsp;&nbsp;&nbsp;&nbsp;23:30 &nbsp;&nbsp;&nbsp;7.00s &nbsp;0.00s &nbsp;0.00s w</span></p>
<p><span class="font19">[paul@centos7 ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2380"></a><span class="font10" style="font-weight:bold;"><a name="bookmark280"></a><a name="bookmark2381"></a>27.5. id</span></h2></li></ul>
<h4><a name="bookmark2382"></a><span class="font25"><a name="bookmark2383"></a><a name="bookmark2384"></a>The </span><span class="font25" style="font-weight:bold;">id </span><span class="font25">command will give you your user id, primary group id, and a list of the groups that you belong to.</span></h4>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">id</span></p>
<p><span class="font19">uid=1000(paul) gid=1000(paul) groups=1000(paul)</span></p>
<h4><a name="bookmark2385"></a><span class="font25"><a name="bookmark2386"></a>On RHEL/CentOS you will also get </span><span class="font25" style="font-weight:bold;">SELinux </span><span class="font25">context information with this command.</span></h4>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">id</span></p>
<p><span class="font19">uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r\</span></p>
<p><span class="font19">:unconfined_t:s0-s0:c0.c1023</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2387"></a><span class="font10" style="font-weight:bold;"><a name="bookmark281"></a><a name="bookmark2388"></a>27.6. su to another user</span></h2></li></ul>
<p><a name="bookmark2389"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">su </span><span class="font25">command allows a user to run a shell as another user.</span></p>
<p><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">su tania</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">tania@debian7:/home/laura$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2390"></a><span class="font10" style="font-weight:bold;"><a name="bookmark282"></a><a name="bookmark2391"></a>27.7. su to root</span></h2></li></ul>
<p><a name="bookmark2392"></a><span class="font25">Yes you can also </span><span class="font25" style="font-weight:bold;">su </span><span class="font25">to become </span><span class="font25" style="font-weight:bold;">root</span><span class="font25">, when you know the </span><span class="font25" style="font-weight:bold;">root password</span><span class="font25">.</span></p>
<p><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">su root</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">root@debian7:/home/laura#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2393"></a><span class="font10" style="font-weight:bold;"><a name="bookmark283"></a><a name="bookmark2394"></a>27.8. su as root</span></h2></li></ul>
<p><span class="font25">You need to know the password of the user you want to substitute to, unless your are logged in as </span><span class="font25" style="font-weight:bold;">root</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">user can become any existing user without knowing that user's password.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">id</span></p>
<p><span class="font19">uid=0(root) gid=0(root) groups=0(root)</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">su - valentina </span><span class="font19">valentina@debian7:~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2395"></a><span class="font10" style="font-weight:bold;"><a name="bookmark284"></a><a name="bookmark2396"></a>27.9. su - $username</span></h2></li></ul>
<p><a name="bookmark2397"></a><span class="font25">By default, the </span><span class="font25" style="font-weight:bold;">su </span><span class="font25">command maintains the same shell environment. To become another user and also get the target user's environment, issue the </span><span class="font25" style="font-weight:bold;">su - </span><span class="font25">command followed by the target username.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">su laura</span></p>
<p><span class="font19">laura@debian7:/root$ </span><span class="font19" style="font-weight:bold;">exit</span></p>
<p><span class="font19">exit</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">su - laura </span><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">pwd </span><span class="font19">/home/laura</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2398"></a><span class="font10" style="font-weight:bold;"><a name="bookmark285"></a><a name="bookmark2399"></a>27.10. su -</span></h2></li></ul>
<p><span class="font25">When no username is provided to </span><span class="font25" style="font-weight:bold;">su </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">su -</span><span class="font25">, the command will assume </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">is the target.</span></p>
<p><span class="font19">tania@debian7:~$ </span><span class="font19" style="font-weight:bold;">su -</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2400"></a><span class="font10" style="font-weight:bold;"><a name="bookmark286"></a><a name="bookmark2401"></a>27.11. run a program as another user</span></h2></li></ul>
<p><a name="bookmark2402"></a><span class="font25">The sudo program allows a user to start a program with the credentials of another user. Before this works, the system administrator has to set up the </span><span class="font25" style="font-weight:bold;">/etc/sudoers </span><span class="font25">file. This can be useful to delegate administrative tasks to another user (without giving the root password).</span></p>
<p><a name="bookmark2403"></a><span class="font25"><a name="bookmark2404"></a>The screenshot below shows the usage of </span><span class="font25" style="font-weight:bold;">sudo</span><span class="font25">. User </span><span class="font25" style="font-weight:bold;">paul </span><span class="font25">received the right to run </span><span class="font25" style="font-weight:bold;">useradd </span><span class="font25">with the credentials of </span><span class="font25" style="font-weight:bold;">root</span><span class="font25">. This allows </span><span class="font25" style="font-weight:bold;">paul </span><span class="font25">to create new users on the system without becoming </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">and without knowing the </span><span class="font25" style="font-weight:bold;">root password</span><span class="font25">.</span></p>
<p><span class="font25">First the command fails for </span><span class="font25" style="font-weight:bold;">paul</span><span class="font25">.</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">/usr/sbin/useradd -m valentina</span></p>
<p><span class="font19">useradd: Permission denied.</span></p>
<p><span class="font19">useradd: cannot lock /etc/passwd; try again later.</span></p>
<p><span class="font25">But with </span><span class="font25" style="font-weight:bold;">sudo </span><span class="font25">it works.</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">sudo /usr/sbin/useradd -m valentina</span></p>
<p><span class="font19">[sudo] password for paul:</span></p>
<p><span class="font19">paul@debian7:~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2405"></a><span class="font10" style="font-weight:bold;"><a name="bookmark287"></a><a name="bookmark2406"></a>27.12. visudo</span></h2></li></ul>
<p><a name="bookmark2407"></a><span class="font25">Check the man page of </span><span class="font25" style="font-weight:bold;">visudo </span><span class="font25">before playing with the </span><span class="font25" style="font-weight:bold;">/etc/sudoers </span><span class="font25">file. Editing the </span><span class="font25" style="font-weight:bold;">sudoers </span><span class="font25">is out of scope for this fundamentals book.</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">apropos visudo</span></p>
<p><span class="font19">visudo &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(8) &nbsp;- edit the sudoers file</span></p>
<p><span class="font19">paul@rhel65:~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2408"></a><span class="font10" style="font-weight:bold;"><a name="bookmark288"></a><a name="bookmark2409"></a>27.13. sudo su -</span></h2></li></ul>
<p><a name="bookmark2410"></a><span class="font25"><a name="bookmark2411"></a><a name="bookmark2412"></a>On some Linux systems like Ubuntu and Xubuntu, the </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">user does not have a password set. This means that it is not possible to login as </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">(extra security). To perform tasks as </span><span class="font25" style="font-weight:bold;">root</span><span class="font25">, the first user is given all </span><span class="font25" style="font-weight:bold;">sudo rights </span><span class="font25">via the </span><span class="font25" style="font-weight:bold;">/etc/sudoers</span><span class="font25">. In fact all users that are members of the admin group can use sudo to run all commands as root.</span></p>
<p><span class="font19">root@laika:~# </span><span class="font19" style="font-weight:bold;">grep admin /etc/sudoers</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Members of the admin group may gain root privileges %admin ALL=(ALL) ALL</span></p></li></ul>
<p><a name="bookmark2413"></a><span class="font25">The end result of this is that the user can type </span><span class="font25" style="font-weight:bold;">sudo su - </span><span class="font25">and become root without having to enter the root password. The sudo command does require you to enter your own password. Thus the password prompt in the screenshot below is for sudo, not for su.</span></p>
<p><span class="font19">paul@laika:~$ </span><span class="font19" style="font-weight:bold;">sudo su -</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">root@laika:~#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2414"></a><span class="font10" style="font-weight:bold;"><a name="bookmark289"></a><a name="bookmark2415"></a>27.14. sudo logging</span></h2></li></ul>
<p><span class="font25">Using </span><span class="font25" style="font-weight:bold;">sudo </span><span class="font25">without authorization will result in a severe warning:</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">sudo su -</span></p>
<p><span class="font19">We trust you have received the usual lecture from the local System Administrator. It usually boils down to these three things:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># 1) Respect the privacy of others.</span></p></li>
<li>
<p><span class="font19"># 2) Think before you type.</span></p></li>
<li>
<p><span class="font19"># 3) With great power comes great responsibility.</span></p></li></ul>
<p><span class="font19">[sudo] password for paul:</span></p>
<p><span class="font19">paul is not in the sudoers file. This incident will be reported. paul@rhel65:~$</span></p>
<p><span class="font25">The root user can see this in the </span><span class="font25" style="font-weight:bold;">/var/log/secure </span><span class="font25">on Red Hat and in </span><span class="font25" style="font-weight:bold;">/var/log/auth.log </span><span class="font25">on Debian).</span></p>
<p><span class="font19">root@rhel65:~# </span><span class="font19" style="font-weight:bold;">tail /var/log/secure | grep sudo | tr -s ' '</span></p>
<p><span class="font19">Apr 13 16:03:42 rhel65 sudo: paul : user NOT in sudoers ; TTY=pts/0 ; PWD=\ /home/paul ; USER=root ; COMMAND=/bin/su -root@rhel65:~#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2416"></a><span class="font10" style="font-weight:bold;"><a name="bookmark290"></a><a name="bookmark2417"></a>27.15. practice: introduction to users</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Run a command that displays only your currently logged on user name.</span></p></li>
<li>
<p><span class="font25">2. Display a list of all logged on users.</span></p></li>
<li>
<p><span class="font25">3. Display a list of all logged on users including the command they are running at this very moment.</span></p></li>
<li>
<p><span class="font25">4. Display your user name and your unique user identification (userid).</span></p></li>
<li>
<p><span class="font25">5. Use </span><span class="font25" style="font-weight:bold;">su </span><span class="font25">to switch to another user account (unless you are root, you will need the password of the other account). And get back to the previous account.</span></p></li>
<li>
<p><span class="font25">6. Now use </span><span class="font25" style="font-weight:bold;">su - </span><span class="font25">to switch to another user and notice the difference.</span></p></li></ul>
<p><span class="font25">Note that </span><span class="font25" style="font-weight:bold;">su - </span><span class="font25">gets you into the home directory of </span><span class="font25" style="font-weight:bold;">Tania</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. Try to create a new user account (when using your normal user account). this should fail. (Details on adding user accounts are explained in the next chapter.)</span></p></li>
<li>
<p><span class="font25">8. Now try the same, but with </span><span class="font25" style="font-weight:bold;">sudo </span><span class="font25">before your command.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2418"></a><span class="font10" style="font-weight:bold;"><a name="bookmark291"></a><a name="bookmark2419"></a>27.16. solution: introduction to users</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2420"></a><span class="font25"><a name="bookmark2421"></a>1. Run a command that displays only your currently logged on user name.</span></h4></li></ul>
<p><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">whoami </span><span class="font19">laura</span></p>
<p><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">echo $USER </span><span class="font19">laura</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2422"></a><span class="font25"><a name="bookmark2423"></a>2. Display a list of all logged on users.</span></h4></li></ul>
<p><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">who</span></p>
<p><span class="font19">laura pts/0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2014-10-13 07:22 (10.104.33.101)</span></p>
<p><span class="font19">laura@debian7:~$</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2424"></a><span class="font25"><a name="bookmark2425"></a>3. Display a list of all logged on users including the command they are running at this very moment.</span></h4></li></ul>
<p><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">w</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">07:47:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">:02 up 16 min, 2 users,</span></p></td><td style="vertical-align:top;">
<p><span class="font19">load average</span></p></td><td style="vertical-align:top;">
<p><span class="font19">: 0.00,</span></p></td><td style="vertical-align:top;">
<p><span class="font19">, 0.00,</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">USER</span></p></td><td style="vertical-align:top;">
<p><span class="font19">TTY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM</span></p></td><td style="vertical-align:top;">
<p><span class="font19">LOGIN@</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IDLE</span></p></td><td style="vertical-align:top;">
<p><span class="font19">JCPU</span></p></td><td style="vertical-align:top;">
<p><span class="font19">PCPU WHAT</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/0 &nbsp;&nbsp;&nbsp;10.104.33.101</span></p></td><td style="vertical-align:top;">
<p><span class="font19">07:30</span></p></td><td style="vertical-align:top;">
<p><span class="font19">6.00s</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.04s</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00s w</span></p></td></tr>
<tr><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">root &nbsp;&nbsp;&nbsp;&nbsp;pts/1 &nbsp;&nbsp;&nbsp;10.104.33.101</span></p>
<p><span class="font19">laura@debian7:~$</span></p></td><td style="vertical-align:top;">
<p><span class="font19">07:46</span></p></td><td style="vertical-align:top;">
<p><span class="font19">6.00s</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.01s</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00s sleep 42</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2426"></a><span class="font25"><a name="bookmark2427"></a>4. Display your user name and your unique user identification (userid).</span></h4></li></ul>
<p><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">id</span></p>
<p><span class="font19">uid=1005(laura) gid=1007(laura) groups=1007(laura) laura@debian7:~$</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2428"></a><span class="font25"><a name="bookmark2429"></a>5. Use </span><span class="font25" style="font-weight:bold;">su </span><span class="font25">to switch to another user account (unless you are root, you will need the password of the other account). And get back to the previous account.</span></h4></li></ul>
<p><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">su tania</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">tania@debian7:/home/laura$ </span><span class="font19" style="font-weight:bold;">id</span></p>
<p><span class="font19">uid=1006(tania) gid=1008(tania) groups=1008(tania)</span></p>
<p><span class="font19">tania@debian7:/home/laura$ </span><span class="font19" style="font-weight:bold;">exit</span></p>
<p><span class="font19">laura@debian7:~$</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2430"></a><span class="font25"><a name="bookmark2431"></a>6. Now use </span><span class="font25" style="font-weight:bold;">su - </span><span class="font25">to switch to another user and notice the difference.</span></h4></li></ul>
<p><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">su - tania</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">tania@debian7:~$ </span><span class="font19" style="font-weight:bold;">pwd</span></p>
<p><span class="font19">/home/tania</span></p>
<p><span class="font19">tania@debian7:~$ </span><span class="font19" style="font-weight:bold;">logout</span></p>
<p><span class="font19">laura@debian7:~$</span></p>
<h4><a name="bookmark2432"></a><span class="font25"><a name="bookmark2433"></a>Note that </span><span class="font25" style="font-weight:bold;">su - </span><span class="font25">gets you into the home directory of </span><span class="font25" style="font-weight:bold;">Tania</span><span class="font25">.</span></h4>
<ul style="list-style:none;"><li>
<p><span class="font25">7. Try to create a new user account (when using your normal user account). this should fail. (Details on adding user accounts are explained in the next chapter.) </span><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">useradd valentina </span><span class="font19">-su: useradd: command not found laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">/usr/sbin/useradd valentina </span><span class="font19">useradd: Permission denied.</span></p></li></ul>
<p><span class="font19">useradd: cannot lock /etc/passwd; try again later.</span></p>
<p><span class="font25">It is possible that </span><span class="font25" style="font-weight:bold;">useradd </span><span class="font25">is located in </span><span class="font25" style="font-weight:bold;">/sbin/useradd </span><span class="font25">on your computer.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. Now try the same, but with </span><span class="font25" style="font-weight:bold;">sudo </span><span class="font25">before your command.</span></p></li></ul>
<p><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">sudo /usr/sbin/useradd valentina </span><span class="font19">[sudo] password for laura: laura is not in the sudoers file. This incident will be reported. laura@debian7:~$</span></p>
<p><span class="font25">Notice that </span><span class="font25" style="font-weight:bold;">laura </span><span class="font25">has no permission to use the </span><span class="font25" style="font-weight:bold;">sudo </span><span class="font25">on this system.</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark2434"></a><span class="font11" style="font-weight:bold;"><a name="bookmark292"></a><a name="bookmark2435"></a>Chapter 28. user management</span></h1></li></ul>
<p><span class="font25">This chapter will teach you how to use </span><span class="font25" style="font-weight:bold;">useradd</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">usermod </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">userdel </span><span class="font25">to create, modify and remove user accounts.</span></p>
<p><span class="font25">You will need </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">access on a Linux computer to complete this chapter.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2436"></a><span class="font10" style="font-weight:bold;"><a name="bookmark293"></a><a name="bookmark2437"></a>28.1. user management</span></h2></li></ul>
<p><span class="font25">User management on Linux can be done in three complementary ways. You can use the </span><span class="font25" style="font-weight:bold;">graphical </span><span class="font25">tools provided by your distribution. These tools have a look and feel that depends on the distribution. If you are a novice Linux user on your home system, then use the graphical tool that is provided by your distribution. This will make sure that you do not run into problems.</span></p>
<p><span class="font25">Another option is to use </span><span class="font25" style="font-weight:bold;">command line tools </span><span class="font25">like useradd, usermod, gpasswd, passwd and others. Server administrators are likely to use these tools, since they are familiar and very similar across many different distributions. This chapter will focus on these command line tools.</span></p>
<p><span class="font25">A third and rather extremist way is to </span><span class="font25" style="font-weight:bold;">edit the local configuration files </span><span class="font25">directly using vi (or vipw/vigr). Do not attempt this as a novice on production systems!</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2438"></a><span class="font10" style="font-weight:bold;"><a name="bookmark294"></a><a name="bookmark2439"></a>28.2. /etc/passwd</span></h2></li></ul>
<p><a name="bookmark2440"></a><span class="font25">The local user database on Linux (and on most Unixes) is </span><span class="font25" style="font-weight:bold;">/etc/passwd</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">tail /etc/passwd</span></p>
<p><span class="font19">inge:x:518:524:art dealer:/home/inge:/bin/ksh ann:x:519:525:flute player:/home/ann:/bin/bash frederik:x:520:526:rubius poet:/home/frederik:/bin/bash steven:x:521:527:roman emperor:/home/steven:/bin/bash pascale:x:522:528:artist:/home/pascale:/bin/ksh geert:x:524:530:kernel developer:/home/geert:/bin/bash wim:x:525:531:master damuti:/home/wim:/bin/bash sandra:x:526:532:radish stresser:/home/sandra:/bin/bash annelies:x:527:533:sword fighter:/home/annelies:/bin/bash laura:x:528:534:art dealer:/home/laura:/bin/ksh</span></p>
<p><span class="font25">As you can see, this file contains seven columns separated by a colon. The columns contain the username, an x, the user id, the primary group id, a description, the name of the home directory, and the login shell.</span></p>
<p><span class="font25">More information can be found by typing </span><span class="font25" style="font-weight:bold;">man 5 passwd</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">man 5 passwd</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2441"></a><span class="font10" style="font-weight:bold;"><a name="bookmark295"></a><a name="bookmark2442"></a>28.3. root</span></h2></li></ul>
<p><a name="bookmark2443"></a><span class="font25"><a name="bookmark2444"></a>The </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">user also called the </span><span class="font25" style="font-weight:bold;">superuser </span><span class="font25">is the most powerful account on your Linux system. This user can do almost anything, including the creation of other users. The root user always has userid 0 (regardless of the name of the account).</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">head -1 /etc/passwd</span></p>
<p><span class="font19">root:x:0:0:root:/root:/bin/bash</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2445"></a><span class="font10" style="font-weight:bold;"><a name="bookmark296"></a><a name="bookmark2446"></a>28.4. useradd</span></h2></li></ul>
<p><a name="bookmark2447"></a><span class="font25">You can add users with the </span><span class="font25" style="font-weight:bold;">useradd </span><span class="font25">command. The example below shows how to add a user named yanina (last parameter) and at the same time forcing the creation of the home directory (-m), setting the name of the home directory (-d), and setting a description (-c).</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">useradd -m -d /home/yanina -c &quot;yanina wickmayer&quot; yanina </span><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">tail -1 /etc/passwd</span></p>
<p><span class="font19">yanina:x:529:529:yanina wickmayer:/home/yanina:/bin/bash</span></p>
<p><a name="bookmark2448"></a><span class="font25">The user named yanina received userid 529 and </span><span class="font25" style="font-weight:bold;">primary group </span><span class="font25">id 529.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2449"></a><span class="font10" style="font-weight:bold;"><a name="bookmark297"></a><a name="bookmark2450"></a>28.5. /etc/default/useradd</span></h2></li></ul>
<p><a name="bookmark2451"></a><span class="font25"><a name="bookmark2452"></a>Both Red Hat Enterprise Linux and Debian/Ubuntu have a file called </span><span class="font25" style="font-weight:bold;">/etc/default/useradd </span><span class="font25">that contains some default user options. Besides using cat to display this file, you can also use </span><span class="font25" style="font-weight:bold;">useradd -D</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL4 ~]# </span><span class="font19" style="font-weight:bold;">useradd -D</span></p>
<p><span class="font19">GROUP=100</span></p>
<p><span class="font19">HOME=/home</span></p>
<p><span class="font19">INACTIVE=-1</span></p>
<p><span class="font19">EXPIRE=</span></p>
<p><span class="font19">SHELL=/bin/bash</span></p>
<p><span class="font19">SKEL=/etc/skel</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2453"></a><span class="font10" style="font-weight:bold;"><a name="bookmark298"></a><a name="bookmark2454"></a>28.6. userdel</span></h2></li></ul>
<p><a name="bookmark2455"></a><span class="font25">You can delete the user yanina with </span><span class="font25" style="font-weight:bold;">userdel</span><span class="font25">. The -r option of userdel will also remove the home directory.</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">userdel -r yanina</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2456"></a><span class="font10" style="font-weight:bold;"><a name="bookmark299"></a><a name="bookmark2457"></a>28.7. usermod</span></h2></li></ul>
<p><a name="bookmark2458"></a><span class="font25">You can modify the properties of a user with the </span><span class="font25" style="font-weight:bold;">usermod </span><span class="font25">command. This example uses </span><span class="font25" style="font-weight:bold;">usermod </span><span class="font25">to change the description of the user harry.</span></p>
<p><span class="font19">[root@RHEL4 ~]# </span><span class="font19" style="font-weight:bold;">tail -1 /etc/passwd</span></p>
<p><span class="font19">harry:x:516:520:harry potter:/home/harry:/bin/bash</span></p>
<p><span class="font19">[root@RHEL4 ~]# </span><span class="font19" style="font-weight:bold;">usermod -c 'wizard' harry</span></p>
<p><span class="font19">[root@RHEL4 ~]# </span><span class="font19" style="font-weight:bold;">tail -1 /etc/passwd</span></p>
<p><span class="font19">harry:x:516:520:wizard:/home/harry:/bin/bash</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2459"></a><span class="font10" style="font-weight:bold;"><a name="bookmark300"></a><a name="bookmark2460"></a>28.8. creating home directories</span></h2></li></ul>
<p><a name="bookmark2461"></a><span class="font25">The easiest way to create a home directory is to supply the </span><span class="font25" style="font-weight:bold;">-m </span><span class="font25">option with </span><span class="font25" style="font-weight:bold;">useradd </span><span class="font25">(it is likely set as a default option on Linux).</span></p>
<p><a name="bookmark2462"></a><span class="font25"><a name="bookmark2463"></a><a name="bookmark2464"></a>A less easy way is to create a home directory manually with </span><span class="font25" style="font-weight:bold;">mkdir </span><span class="font25">which also requires setting the owner and the permissions on the directory with </span><span class="font25" style="font-weight:bold;">chmod </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">chown </span><span class="font25">(both commands are discussed in detail in another chapter).</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">mkdir /home/laura</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">chown laura:laura /home/laura</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">chmod 700 /home/laura</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">ls -ld /home/laura/</span></p>
<p><span class="font19">drwx------ 2 laura laura 4096 Jun 24 15:17 /home/laura/</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2465"></a><span class="font10" style="font-weight:bold;"><a name="bookmark301"></a><a name="bookmark2466"></a>28.9. /etc/skel/</span></h2></li></ul>
<p><a name="bookmark2467"></a><span class="font25">When using </span><span class="font25" style="font-weight:bold;">useradd </span><span class="font25">the </span><span class="font25" style="font-weight:bold;">-m </span><span class="font25">option, the </span><span class="font25" style="font-weight:bold;">/etc/skel/ </span><span class="font25">directory is copied to the newly created home directory. The </span><span class="font25" style="font-weight:bold;">/etc/skel/ </span><span class="font25">directory contains some (usually hidden) files that contain profile settings and default values for applications. In this way </span><span class="font25" style="font-weight:bold;">/etc/skel/ </span><span class="font25">serves as a default home directory and as a default user profile.</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">ls -la /etc/skel/</span></p>
<p><span class="font19">total 48</span></p>
<p><span class="font19">drwxr-xr-x 2 root root 4096 Apr 1 00:11 drwxr-xr-x 97 root root 12288 Jun 24 15:36 -rw-r--r-- 1 root root 24 Jul 12 2006 -rw-r--r-- 1 root root 176 Jul 12 2006 -rw-r--r-- 1 root root 124 Jul 12 2006</span></p>
<div>
<p><span class="font19">bash_logout bash_profile bashrc</span></p>
</div><br clear="all">
<ul style="list-style:none;"><li>
<h2><a name="bookmark2468"></a><span class="font10" style="font-weight:bold;"><a name="bookmark302"></a><a name="bookmark2469"></a>28.10. deleting home directories</span></h2></li></ul>
<p><a name="bookmark2470"></a><span class="font25">The -r option of </span><span class="font25" style="font-weight:bold;">userdel </span><span class="font25">will make sure that the home directory is deleted together with the user account.</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">ls -ld /home/wim/</span></p>
<p><span class="font19">drwx------ 2 wim wim 4096 Jun 24 15:19 /home/wim/</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">userdel -r wim</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">ls -ld /home/wim/</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">ls: /home/wim/: No such file or directory</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2471"></a><span class="font10" style="font-weight:bold;"><a name="bookmark303"></a><a name="bookmark2472"></a>28.11. login shell</span></h2></li></ul>
<p><a name="bookmark2473"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">/etc/passwd </span><span class="font25">file specifies the </span><span class="font25" style="font-weight:bold;">login shell </span><span class="font25">for the user. In the screenshot below you can see that user annelies will log in with the </span><span class="font25" style="font-weight:bold;">/bin/bash </span><span class="font25">shell, and user laura with the </span><span class="font25" style="font-weight:bold;">/bin/ksh </span><span class="font25">shell.</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">tail -2 /etc/passwd</span></p>
<p><span class="font19">annelies:x:527:533:sword fighter:/home/annelies:/bin/bash laura:x:528:534:art dealer:/home/laura:/bin/ksh</span></p>
<p><span class="font25">You can use the usermod command to change the shell for a user.</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">usermod -s /bin/bash laura</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">tail -1 /etc/passwd</span></p>
<p><span class="font19">laura:x:528:534:art dealer:/home/laura:/bin/bash</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2474"></a><span class="font10" style="font-weight:bold;"><a name="bookmark304"></a><a name="bookmark2475"></a>28.12. chsh</span></h2></li></ul>
<p><a name="bookmark2476"></a><span class="font25"><a name="bookmark2477"></a><a name="bookmark2478"></a>Users can change their login shell with the </span><span class="font25" style="font-weight:bold;">chsh </span><span class="font25">command. First, user harry obtains a list of available shells (he could also have done a </span><span class="font25" style="font-weight:bold;">cat /etc/shells</span><span class="font25">) and then changes his login shell to the </span><span class="font25" style="font-weight:bold;">Korn shell </span><span class="font25">(/bin/ksh). At the next login, harry will default into ksh instead of bash.</span></p>
<p><span class="font19">[laura@centos7 ~]$ </span><span class="font19" style="font-weight:bold;">chsh -l</span></p>
<p><span class="font19">/bin/sh</span></p>
<p><span class="font19">/bin/bash</span></p>
<p><span class="font19">/sbin/nologin</span></p>
<p><span class="font19">/usr/bin/sh</span></p>
<p><span class="font19">/usr/bin/bash</span></p>
<p><span class="font19">/usr/sbin/nologin</span></p>
<p><span class="font19">/bin/ksh</span></p>
<p><span class="font19">/bin/tcsh</span></p>
<p><span class="font19">/bin/csh</span></p>
<p><span class="font19">[laura@centos7 ~]$</span></p>
<p><span class="font25">Note that the </span><span class="font25" style="font-weight:bold;">-l </span><span class="font25">option does not exist on Debian and that the above screenshot assumes that </span><span class="font25" style="font-weight:bold;">ksh </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">csh </span><span class="font25">shells are installed.</span></p>
<p><span class="font25">The screenshot below shows how </span><span class="font25" style="font-weight:bold;">laura </span><span class="font25">can change her default shell (active on next login).</span></p>
<p><span class="font19">[laura@centos7 ~]$ </span><span class="font19" style="font-weight:bold;">chsh -s /bin/ksh</span></p>
<p><span class="font19">Changing shell for laura.</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">Shell changed.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2479"></a><span class="font10" style="font-weight:bold;"><a name="bookmark305"></a><a name="bookmark2480"></a>28.13. practice: user management</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create a user account named </span><span class="font25" style="font-weight:bold;">serena</span><span class="font25">, including a home directory and a description (or comment) that reads </span><span class="font25" style="font-weight:bold;">Serena Williams</span><span class="font25">. Do all this in one single command.</span></p></li>
<li>
<p><span class="font25">2. Create a user named </span><span class="font25" style="font-weight:bold;">venus</span><span class="font25">, including home directory, bash shell, a description that reads </span><span class="font25" style="font-weight:bold;">Venus Williams </span><span class="font25">all in one single command.</span></p></li>
<li>
<p><span class="font25">3. Verify that both users have correct entries in </span><span class="font25" style="font-weight:bold;">/etc/passwd</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">/etc/shadow </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/etc/group</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">4. Verify that their home directory was created.</span></p></li>
<li>
<p><span class="font25">5. Create a user named </span><span class="font25" style="font-weight:bold;">einstime </span><span class="font25">with </span><span class="font25" style="font-weight:bold;">/bin/date </span><span class="font25">as his default logon shell.</span></p></li>
<li>
<p><span class="font25">7. What happens when you log on with the </span><span class="font25" style="font-weight:bold;">einstime </span><span class="font25">user ? Can you think of a useful real world example for changing a user's login shell to an application ?</span></p></li>
<li>
<p><span class="font25">8. Create a file named </span><span class="font25" style="font-weight:bold;">welcome.txt </span><span class="font25">and make sure every new user will see this file in their home directory.</span></p></li>
<li>
<p><span class="font25">9. Verify this setup by creating (and deleting) a test user account.</span></p></li>
<li>
<p><span class="font25">10. Change the default login shell for the </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">user to </span><span class="font25" style="font-weight:bold;">/bin/bash</span><span class="font25">. Verify before and after you make this change.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2481"></a><span class="font10" style="font-weight:bold;"><a name="bookmark306"></a><a name="bookmark2482"></a>28.14. solution: user management</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create a user account named </span><span class="font25" style="font-weight:bold;">serena</span><span class="font25">, including a home directory and a description (or comment) that reads </span><span class="font25" style="font-weight:bold;">Serena Williams</span><span class="font25">. Do all this in one single command.</span></p></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">useradd -m -c 'Serena Williams' serena</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Create a user named </span><span class="font25" style="font-weight:bold;">venus</span><span class="font25">, including home directory, bash shell, a description that reads </span><span class="font25" style="font-weight:bold;">Venus Williams </span><span class="font25">all in one single command.</span></p></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">useradd -m -c &quot;Venus Williams&quot; -s /bin/bash venus</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Verify that both users have correct entries in </span><span class="font25" style="font-weight:bold;">/etc/passwd</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">/etc/shadow </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/etc/group</span><span class="font25">.</span></p></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">tail -2 /etc/passwd</span></p>
<p><span class="font19">serena:x:1008:1010:Serena Williams:/home/serena:/bin/sh</span></p>
<p><span class="font19">venus:x:1009:1011:Venus Williams:/home/venus:/bin/bash</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">tail -2 /etc/shadow</span></p>
<p><span class="font19">serena:!:16358:0:99999:7:::</span></p>
<p><span class="font19">venus:!:16358:0:99999:7:::</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">tail -2 /etc/group</span></p>
<p><span class="font19">serena:x:1010:</span></p>
<p><span class="font19">venus:x:1011:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Verify that their home directory was created.</span></p></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">ls -lrt /home | tail -2</span></p>
<p><span class="font19">drwxr-xr-x 2 serena &nbsp;&nbsp;&nbsp;serena &nbsp;&nbsp;&nbsp;4096 Oct 15 10:50 serena</span></p>
<p><span class="font19">drwxr-xr-x 2 venus &nbsp;&nbsp;&nbsp;&nbsp;venus &nbsp;&nbsp;&nbsp;&nbsp;4096 Oct 15 10:59 venus</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Create a user named </span><span class="font25" style="font-weight:bold;">einstime </span><span class="font25">with </span><span class="font25" style="font-weight:bold;">/bin/date </span><span class="font25">as his default logon shell.</span></p></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">useradd -s /bin/date einstime</span></p>
<p><span class="font25">Or even better:</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">useradd -s $(which date) einstime</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. What happens when you log on with the </span><span class="font25" style="font-weight:bold;">einstime </span><span class="font25">user ? Can you think of a useful real world example for changing a user's login shell to an application ?</span></p></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">su - einstime</span></p>
<p><span class="font19">Wed Oct 15 11:05:56 UTC 2014 # You get the output of the date command root@debian7:~#</span></p>
<p><span class="font25">It can be useful when users need to access only one application on the server. Just logging in opens the application for them, and closing the application automatically logs them out.</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2483"></a><span class="font25"><a name="bookmark2484"></a>8. Create a file named </span><span class="font25" style="font-weight:bold;">welcome.txt </span><span class="font25">and make sure every new user will see this file in their home directory.</span></h4></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">echo Hello &gt;&nbsp;/etc/skel/welcome.txt</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2485"></a><span class="font25"><a name="bookmark2486"></a>9. Verify this setup by creating (and deleting) a test user account.</span></h4></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">useradd -m test</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">ls -l /home/test</span></p>
<p><span class="font19">total 4</span></p>
<p><span class="font19">-rw-r--r-- 1 test test 6 Oct 15 11:16 welcome.txt</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">userdel -r test</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2487"></a><span class="font25"><a name="bookmark2488"></a>10. Change the default login shell for the </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">user to </span><span class="font25" style="font-weight:bold;">/bin/bash</span><span class="font25">. Verify before and after you make this change.</span></h4></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep serena /etc/passwd</span></p>
<p><span class="font19">serena:x:1008:1010:Serena Williams:/home/serena:/bin/sh</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">usermod -s /bin/bash serena</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep serena /etc/passwd</span></p>
<p><span class="font19">serena:x:1008:1010:Serena Williams:/home/serena:/bin/bash</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark2489"></a><span class="font11" style="font-weight:bold;"><a name="bookmark307"></a><a name="bookmark2490"></a>Chapter 29. user passwords</span></h1></li></ul>
<p><span class="font25">This chapter will tell you more about passwords for local users.</span></p>
<p><span class="font25">Three methods for setting passwords are explained; using the </span><span class="font25" style="font-weight:bold;">passwd </span><span class="font25">command, using </span><span class="font25" style="font-weight:bold;">openssel passwd</span><span class="font25">, and using the </span><span class="font25" style="font-weight:bold;">crypt </span><span class="font25">function in a C program.</span></p>
<p><span class="font25">The chapter will also discuss password settings and disabling, suspending or locking accounts.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2491"></a><span class="font10" style="font-weight:bold;"><a name="bookmark308"></a><a name="bookmark2492"></a>29.1. passwd</span></h2></li></ul>
<p><a name="bookmark2493"></a><span class="font25">Passwords of users can be set with the </span><span class="font25" style="font-weight:bold;">passwd </span><span class="font25">command. Users will have to provide their old password before twice entering the new one.</span></p>
<p><span class="font19">[tania@centos7 ~]$ </span><span class="font19" style="font-weight:bold;">passwd</span></p>
<p><span class="font19">Changing password for user tania.</span></p>
<p><span class="font19">Changing password for tania.</span></p>
<p><span class="font19">(current) UNIX password:</span></p>
<p><span class="font19">New password:</span></p>
<p><span class="font19">BAD PASSWORD: The password is shorter than 8 characters</span></p>
<p><span class="font19">New password:</span></p>
<p><span class="font19">BAD PASSWORD: The password is a palindrome</span></p>
<p><span class="font19">New password:</span></p>
<p><span class="font19">BAD PASSWORD: The password is too similar to the old one passwd: Have exhausted maximum number of retries for service</span></p>
<p><span class="font25">As you can see, the passwd tool will do some basic verification to prevent users from using too simple passwords. The </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">user does not have to follow these rules (there will be a warning though). The </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">user also does not have to provide the old password before entering the new password twice.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">passwd tania</span></p>
<p><span class="font19">Enter new UNIX password:</span></p>
<p><span class="font19">Retype new UNIX password:</span></p>
<p><span class="font19">passwd: password updated successfully</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2494"></a><span class="font10" style="font-weight:bold;"><a name="bookmark309"></a><a name="bookmark2495"></a>29.2. shadow file</span></h2></li></ul>
<p><a name="bookmark2496"></a><span class="font25"><a name="bookmark2497"></a>User passwords are encrypted and kept in </span><span class="font25" style="font-weight:bold;">/etc/shadow</span><span class="font25">. The /etc/shadow file is read only and can only be read by root. We will see in the file permissions section how it is possible for users to change their password. For now, you will have to know that users can change their password with the </span><span class="font25" style="font-weight:bold;">/usr/bin/passwd </span><span class="font25">command.</span></p>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">tail -4 /etc/shadow</span></p>
<p><span class="font19">paul:$6$ikp2Xta5BT.Tml.p$2TZjNnOYNNQKpwLJqoGJbVsZG5/Fti8ovBRd.VzRbiDSl7TEq\ IaSMH.TeBKnTS/SjlMruW8qffC0JNORW.BTW1:16338:0:99999:7:::</span></p>
<p><span class="font19">tania:$6$8Z/zovxj$9qvoqT8i9KIrmN.k4EQwAF5ryz5yzNwEvYjAa9L5XVXQu.z4DlpvMREH\ eQpQzvRnqFdKkVj17H5ST.c79HDZw0:16356:0:99999:7:::</span></p>
<p><span class="font19">laura:$6$glDuTY5e$/NYYWLxfHgZFWeoujaXSMcR.Mz.lGOxtcxFocFVJNb98nbTPhWFXfKWG\ SyYh1WCv6763Wq54.w24Yr3uAZBOm/:16356:0:99999:7:::</span></p>
<p><span class="font19">valentina:$6$jrZa6PVI$1uQgqR6En9mZB6mKJ3LXRB4CnFko6LRhbh.v4iqUk9MVreui1lv7\ GxHOUDSKA0N55ZRNhGHa6T2ouFnVno/0o1:16356:0:99999:7:::</span></p>
<p><span class="font19">[root@centos7 ~]#</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">/etc/shadow </span><span class="font25">file contains nine colon separated columns. The nine fields contain (from left to right) the user name, the encrypted password (note that only inge and laura have an encrypted password), the day the password was last changed (day 1 is January 1, 1970), number of days the password must be left unchanged, password expiry day, warning number of days before password expiry, number of days after expiry before disabling the account, and the day the account was disabled (again, since 1970). The last field has no meaning yet.</span></p>
<p><span class="font25">All the passwords in the screenshot above are hashes of </span><span class="font25" style="font-weight:bold;">hunter2</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2498"></a><span class="font10" style="font-weight:bold;"><a name="bookmark310"></a><a name="bookmark2499"></a>29.3. encryption with passwd</span></h2></li></ul>
<p><a name="bookmark2500"></a><span class="font25"><a name="bookmark2501"></a><a name="bookmark2502"></a>Passwords are stored in an encrypted format. This encryption is done by the </span><span class="font25" style="font-weight:bold;">crypt </span><span class="font25">function. The easiest (and recommended) way to add a user with a password to the system is to add the user with the </span><span class="font25" style="font-weight:bold;">useradd -m user </span><span class="font25">command, and then set the user's password with </span><span class="font25" style="font-weight:bold;">passwd</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL4 ~]# </span><span class="font19" style="font-weight:bold;">useradd -m xavier</span></p>
<p><span class="font19">[root@RHEL4 ~]# </span><span class="font19" style="font-weight:bold;">passwd xavier</span></p>
<p><span class="font19">Changing password for user xavier.</span></p>
<p><span class="font19">New UNIX password:</span></p>
<p><span class="font19">Retype new UNIX password:</span></p>
<p><span class="font19">passwd: all authentication tokens updated successfully.</span></p>
<p><span class="font19">[root@RHEL4 ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2503"></a><span class="font10" style="font-weight:bold;"><a name="bookmark311"></a><a name="bookmark2504"></a>29.4. encryption with openssl</span></h2></li></ul>
<p><a name="bookmark2505"></a><span class="font25">Another way to create users with a password is to use the -p option of useradd, but that option requires an encrypted password. You can generate this encrypted password with the </span><span class="font25" style="font-weight:bold;">openssl passwd </span><span class="font25">command.</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">openssl passwd </span><span class="font25">command will generate several distinct hashes for the same password, for this it uses a </span><span class="font25" style="font-weight:bold;">salt</span><span class="font25">.</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">openssl passwd hunter2</span></p>
<p><span class="font19">86jcUNlnGDFpY</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">openssl passwd hunter2</span></p>
<p><span class="font19">Yj7mDO9OAnvq6</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">openssl passwd hunter2</span></p>
<p><span class="font19">YqDcJeGoDbzKA</span></p>
<p><span class="font19">paul@rhel65:~$</span></p>
<p><span class="font25">This </span><span class="font25" style="font-weight:bold;">salt </span><span class="font25">can be chosen and is visible as the first two characters of the hash.</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">openssl passwd -salt 42 hunter2</span></p>
<p><span class="font19">42ZrbtP1Ze8G.</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">openssl passwd -salt 42 hunter2</span></p>
<p><span class="font19">42ZrbtP1Ze8G.</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">openssl passwd -salt 42 hunter2</span></p>
<p><span class="font19">42ZrbtP1Ze8G.</span></p>
<p><span class="font19">paul@rhel65:~$</span></p>
<p><span class="font25">This example shows how to create a user with password.</span></p>
<p><span class="font19">root@rhel65:~# </span><span class="font19" style="font-weight:bold;">useradd -m -p $(openssl passwd hunter2) mohamed</span></p>
<p><span class="font25" style="font-style:italic;">Note that this command puts the password in your command history!</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2506"></a><span class="font10" style="font-weight:bold;"><a name="bookmark312"></a><a name="bookmark2507"></a>29.5. encryption with crypt</span></h2></li></ul>
<p><span class="font25">A third option is to create your own C program using the crypt function, and compile this into a command.</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">cat MyCrypt.c</span></p>
<p><span class="font19">#include &lt;stdio.h&gt;</span></p>
<p><span class="font19">#define __USE_XOPEN</span></p>
<p><span class="font19">#include &lt;unistd.h&gt;</span></p>
<p><span class="font19">int main(int argc, char** argv)</span></p>
<p><span class="font19">{</span></p>
<p><span class="font19">if(argc==3)</span></p>
<p><span class="font19">{ printf(&quot;%s\n&quot;, crypt(argv[1],argv[2]));</span></p>
<p><span class="font19">} else { printf(&quot;Usage: MyCrypt $password $salt\n&quot; );</span></p>
<p><span class="font19">} return 0;</span></p>
<p><span class="font19">}</span></p>
<p><a name="bookmark2508"></a><span class="font25">This little program can be compiled with </span><span class="font25" style="font-weight:bold;">gcc </span><span class="font25">like this.</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">gcc MyCrypt.c -o MyCrypt -lcrypt</span></p>
<p><span class="font25">To use it, we need to give two parameters to MyCrypt. The first is the unencrypted password, the second is the salt. The salt is used to perturb the encryption algorithm in one of 4096 different ways. This variation prevents two users with the same password from having the same entry in </span><span class="font25" style="font-weight:bold;">/etc/shadow</span><span class="font25">.</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">./MyCrypt hunter2 42</span></p>
<p><span class="font19">42ZrbtP1Ze8G.</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">./MyCrypt hunter2 33 </span><span class="font19">33d6taYSiEUXI</span></p>
<p><a name="bookmark2509"></a><span class="font25">Did you notice that the first two characters of the password are the </span><span class="font25" style="font-weight:bold;">salt</span><span class="font25">?</span></p>
<p><a name="bookmark2510"></a><span class="font25">The standard output of the crypt function is using the DES algorithm which is old and can be cracked in minutes. A better method is to use </span><span class="font25" style="font-weight:bold;">md5 </span><span class="font25">passwords which can be recognized by a salt starting with $1$.</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">./MyCrypt hunter2 '$1$42'</span></p>
<p><span class="font19">$1$42$7l6Y3xT5282XmZrtDOF9f0</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">./MyCrypt hunter2 '$6$42'</span></p>
<p><span class="font19">$6$42$OqFFAVnI3gTSYG0yI9TZWX9cpyQzwIop7HwpG1LLEsNBiMr4w6OvLX1KDa./UpwXfrFk1i...</span></p>
<p><a name="bookmark2511"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">md5 </span><span class="font25">salt can be up to eight characters long. The salt is displayed in </span><span class="font25" style="font-weight:bold;">/etc/shadow </span><span class="font25">between the second and third $, so never use the password as the salt!</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">./MyCrypt hunter2 '$1$hunter2' </span><span class="font19">$1$hunter2$YVxrxDmidq7Xf8Gdt6qM2.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2512"></a><span class="font10" style="font-weight:bold;"><a name="bookmark313"></a><a name="bookmark2513"></a>29.6. /etc/login.defs</span></h2></li></ul>
<p><a name="bookmark2514"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">/etc/login.defs </span><span class="font25">file contains some default settings for user passwords like password aging and length settings. (You will also find the numerical limits of user ids and group ids and whether or not a home directory should be created by default).</span></p>
<p><span class="font19">root@rhel65:~# </span><span class="font19" style="font-weight:bold;">grep *PASS /etc/login.defs</span></p>
<p><span class="font19">PASS_MAX_DAYS 99999</span></p>
<p><span class="font19">PASS_MIN_DAYS 0</span></p>
<p><span class="font19">PASS_MIN_LEN 5</span></p>
<p><span class="font19">PASS WARN AGE 7</span></p>
<p><span class="font25">Debian also has this file.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep PASS /etc/login.defs</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># PASS_MAX_DAYS &nbsp;&nbsp;Maximum number of days a password may be used.</span></p></li>
<li>
<p><span class="font19"># PASS_MIN_DAYS &nbsp;&nbsp;Minimum number of days allowed between password changes.</span></p></li>
<li>
<p><span class="font19"># PASS_WARN_AGE &nbsp;&nbsp;Number of days warning given before a password expires.</span></p></li></ul>
<p><span class="font19">PASS_MAX_DAYS 99999</span></p>
<p><span class="font19">PASS_MIN_DAYS 0</span></p>
<p><span class="font19">PASS_WARN_AGE 7</span></p>
<p><span class="font19">#PASS_CHANGE_TRIES</span></p>
<p><span class="font19">#PASS_ALWAYS_WARN</span></p>
<p><span class="font19">#PASS_MIN_LEN</span></p>
<p><span class="font19">#PASS_MAX_LEN</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># NO_PASSWORD_CONSOLE</span></p></li></ul>
<p><span class="font19">root@debian7:~#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2515"></a><span class="font10" style="font-weight:bold;"><a name="bookmark314"></a><a name="bookmark2516"></a>29.7. chage</span></h2></li></ul>
<p><a name="bookmark2517"></a><span class="font25"><a name="bookmark2518"></a>The </span><span class="font25" style="font-weight:bold;">chage </span><span class="font25">command can be used to set an expiration date for a user account (-E), set a minimum (-m) and maximum (-M) password age, a password expiration date, and set the number of warning days before the password expiration date. Much of this functionality is also available from the </span><span class="font25" style="font-weight:bold;">passwd </span><span class="font25">command. The </span><span class="font25" style="font-weight:bold;">-l </span><span class="font25">option of chage will list these settings for a user.</span></p>
<p><span class="font19">root@rhel65:~# </span><span class="font19" style="font-weight:bold;">chage -l paul </span><span class="font19">Last password change Password expires Password inactive Account expires</span></p>
<div style="border-left:solid;">
<p><span class="font19">Mar 27, 2014 never</span></p>
<p><span class="font19">never</span></p>
<p><span class="font19">never</span></p>
<p><span class="font19">0</span></p>
<p><span class="font19">99999</span></p>
<p><span class="font19">7</span></p>
</div><br clear="all">
<p><span class="font19">Minimum number of days between password change Maximum number of days between password change Number of days of warning before password expires root@rhel65:~#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2519"></a><span class="font10" style="font-weight:bold;"><a name="bookmark315"></a><a name="bookmark2520"></a>29.8. disabling a password</span></h2></li></ul>
<p><span class="font25">Passwords in </span><span class="font25" style="font-weight:bold;">/etc/shadow </span><span class="font25">cannot begin with an exclamation mark. When the second field in </span><span class="font25" style="font-weight:bold;">/etc/passwd </span><span class="font25">starts with an exclamation mark, then the password can not be used.</span></p>
<p><a name="bookmark2521"></a><span class="font25">Using this feature is often called </span><span class="font25" style="font-weight:bold;">locking</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">disabling</span><span class="font25">, or </span><span class="font25" style="font-weight:bold;">suspending </span><span class="font25">a user account. Besides </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">(or vipw) you can also accomplish this with </span><span class="font25" style="font-weight:bold;">usermod</span><span class="font25">.</span></p>
<p><span class="font25">The first command in the next screenshot will show the hashed password of </span><span class="font25" style="font-weight:bold;">laura </span><span class="font25">in </span><span class="font25" style="font-weight:bold;">/etc/ shadow</span><span class="font25">. The next command disables the password of </span><span class="font25" style="font-weight:bold;">laura</span><span class="font25">, making it impossible for Laura to authenticate using this password.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep laura /etc/shadow | cut -c1-70</span></p>
<p><span class="font19">laura:$6$JYj4JZqp$stwwWACp3OtE1R2aZuE87j.nbW.puDkNUYVk7mCHfCVMa3CoDUJV root@debian7:~# </span><span class="font19" style="font-weight:bold;">usermod -L laura</span></p>
<p><span class="font25">As you can see below, the password hash is simply preceded with an exclamation mark.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep laura /etc/shadow | cut -c1-70</span></p>
<p><span class="font19">laura:!$6$JYj4JZqp$stwwWACp3OtE1R2aZuE87j.nbW.puDkNUYVk7mCHfCVMa3CoDUJ root@debian7:~#</span></p>
<p><a name="bookmark2522"></a><span class="font25"><a name="bookmark2523"></a>The root user (and users with </span><span class="font25" style="font-weight:bold;">sudo </span><span class="font25">rights on </span><span class="font25" style="font-weight:bold;">su</span><span class="font25">) still will be able to </span><span class="font25" style="font-weight:bold;">su </span><span class="font25">into the </span><span class="font25" style="font-weight:bold;">laura </span><span class="font25">account (because the password is not needed here). Also note that </span><span class="font25" style="font-weight:bold;">laura </span><span class="font25">will still be able to login if she has set up passwordless ssh!</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">su - laura</span></p>
<p><span class="font19">laura@debian7:~$</span></p>
<p><a name="bookmark2524"></a><span class="font25">You can unlock the account again with </span><span class="font25" style="font-weight:bold;">usermod -U</span><span class="font25">.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">usermod -U laura</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep laura /etc/shadow | cut -c1-70</span></p>
<p><span class="font19">laura:$6$JYj4JZqp$stwwWACp3OtE1R2aZuE87j.nbW.puDkNUYVk7mCHfCVMa3CoDUJV</span></p>
<p><span class="font25">Watch out for tiny differences in the command line options of </span><span class="font25" style="font-weight:bold;">passwd</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">usermod</span><span class="font25">, and </span><span class="font25" style="font-weight:bold;">useradd </span><span class="font25">on different Linux distributions. Verify the local files when using features like </span><span class="font25" style="font-weight:bold;">&quot;disabling, suspending, or locking&quot; </span><span class="font25">on user accounts and their passwords.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2525"></a><span class="font10" style="font-weight:bold;"><a name="bookmark316"></a><a name="bookmark2526"></a>29.9. editing local files</span></h2></li></ul>
<p><a name="bookmark2527"></a><span class="font25"><a name="bookmark2528"></a><a name="bookmark2529"></a>If you still want to manually edit the </span><span class="font25" style="font-weight:bold;">/etc/passwd </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">/etc/shadow</span><span class="font25">, after knowing these commands for password management, then use </span><span class="font25" style="font-weight:bold;">vipw </span><span class="font25">instead of vi(m) directly. The </span><span class="font25" style="font-weight:bold;">vipw </span><span class="font25">tool will do proper locking of the file.</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">vipw /etc/passwd</span></p>
<p><span class="font19">vipw: the password file is busy (/etc/ptmp present)</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2530"></a><span class="font10" style="font-weight:bold;"><a name="bookmark317"></a><a name="bookmark2531"></a>29.10. practice: user passwords</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Set the password for </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">to </span><span class="font25" style="font-weight:bold;">hunter2</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">2. Also set a password for </span><span class="font25" style="font-weight:bold;">venus </span><span class="font25">and then lock the </span><span class="font25" style="font-weight:bold;">venus </span><span class="font25">user account with </span><span class="font25" style="font-weight:bold;">usermod</span><span class="font25">. Verify the locking in </span><span class="font25" style="font-weight:bold;">/etc/shadow </span><span class="font25">before and after you lock it.</span></p></li>
<li>
<p><span class="font25">3. Use </span><span class="font25" style="font-weight:bold;">passwd -d </span><span class="font25">to disable the </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">password. Verify the </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">line in </span><span class="font25" style="font-weight:bold;">/etc/shadow </span><span class="font25">before and after disabling.</span></p></li>
<li>
<p><span class="font25">4. What is the difference between locking a user account and disabling a user account's password like we just did with </span><span class="font25" style="font-weight:bold;">usermod -L </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">passwd -d</span><span class="font25">?</span></p></li>
<li>
<p><span class="font25">5. Try changing the password of serena to serena as serena.</span></p></li>
<li>
<p><span class="font25">6. Make sure </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">has to change her password in 10 days.</span></p></li>
<li>
<p><span class="font25">7. Make sure every new user needs to change their password every 10 days.</span></p></li>
<li>
<p><span class="font25">8. Take a backup as root of </span><span class="font25" style="font-weight:bold;">/etc/shadow</span><span class="font25">. Use </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">to copy an encrypted </span><span class="font25" style="font-weight:bold;">hunter2 </span><span class="font25">hash from </span><span class="font25" style="font-weight:bold;">venus </span><span class="font25">to </span><span class="font25" style="font-weight:bold;">serena</span><span class="font25">. Can </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">now log on with </span><span class="font25" style="font-weight:bold;">hunter2 </span><span class="font25">as a password ?</span></p></li>
<li>
<p><span class="font25">9. Why use </span><span class="font25" style="font-weight:bold;">vipw </span><span class="font25">instead of </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">? What could be the problem when using </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">vim </span><span class="font25">?</span></p></li>
<li>
<p><span class="font25">10. Use </span><span class="font25" style="font-weight:bold;">chsh </span><span class="font25">to list all shells (only works on RHEL/CentOS/Fedora), and compare to </span><span class="font25" style="font-weight:bold;">cat / etc/shells</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">11. Which </span><span class="font25" style="font-weight:bold;">useradd </span><span class="font25">option allows you to name a home directory ?</span></p></li>
<li>
<p><span class="font25">12. How can you see whether the password of user </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">is locked or unlocked ? Give a solution with </span><span class="font25" style="font-weight:bold;">grep </span><span class="font25">and a solution with </span><span class="font25" style="font-weight:bold;">passwd</span><span class="font25">.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2532"></a><span class="font10" style="font-weight:bold;"><a name="bookmark318"></a><a name="bookmark2533"></a>29.11. solution: user passwords</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2534"></a><span class="font25"><a name="bookmark2535"></a>1. Set the password for </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">to </span><span class="font25" style="font-weight:bold;">hunter2</span><span class="font25">.</span></h4></li></ul>
<p><span class="font19" style="font-weight:bold;">root@debian7:~# passwd serena</span></p>
<p><span class="font19">Enter new UNIX password:</span></p>
<p><span class="font19">Retype new UNIX password: passwd: password updated successfully</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2536"></a><span class="font25"><a name="bookmark2537"></a>2. Also set a password for </span><span class="font25" style="font-weight:bold;">venus </span><span class="font25">and then lock the </span><span class="font25" style="font-weight:bold;">venus </span><span class="font25">user account with </span><span class="font25" style="font-weight:bold;">usermod</span><span class="font25">. Verify the locking in </span><span class="font25" style="font-weight:bold;">/etc/shadow </span><span class="font25">before and after you lock it.</span></h4></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">passwd venus</span></p>
<p><span class="font19">Enter new UNIX password:</span></p>
<p><span class="font19">Retype new UNIX password:</span></p>
<p><span class="font19">passwd: password updated successfully</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep venus /etc/shadow | cut -c1-70</span></p>
<p><span class="font19">venus:$6$gswzXICW$uSnKFV1kFKZmTPaMVS4AvNA/KO27OxN0v5LHdV9ed0gTyXrjUeM/ root@debian7:~# </span><span class="font19" style="font-weight:bold;">usermod -L venus</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep venus /etc/shadow | cut -c1-70</span></p>
<p><span class="font19">venus:!$6$gswzXICW$uSnKFV1kFKZmTPaMVS4AvNA/KO27OxN0v5LHdV9ed0gTyXrjUeM</span></p>
<h4><a name="bookmark2538"></a><span class="font25"><a name="bookmark2539"></a>Note that </span><span class="font25" style="font-weight:bold;">usermod -L </span><span class="font25">precedes the password hash with an exclamation mark (!).</span></h4>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2540"></a><span class="font25"><a name="bookmark2541"></a>3. Use </span><span class="font25" style="font-weight:bold;">passwd -d </span><span class="font25">to disable the </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">password. Verify the </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">line in </span><span class="font25" style="font-weight:bold;">/etc/shadow </span><span class="font25">before and after disabling.</span></h4></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep serena /etc/shadow | cut -c1-70</span></p>
<p><span class="font19">serena:$6$Es/omrPE$F2Ypu8kpLrfKdW0v/UIwA5jrYyBD2nwZ/dt.i/IypRgiPZSdB/B root@debian7:~# </span><span class="font19" style="font-weight:bold;">passwd -d serena </span><span class="font19">passwd: password expiry information changed.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep serena /etc/shadow</span></p>
<p><span class="font19">serena::16358:0:99999:7:::</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2542"></a><span class="font25"><a name="bookmark2543"></a>4. What is the difference between locking a user account and disabling a user account's password like we just did with </span><span class="font25" style="font-weight:bold;">usermod -L </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">passwd -d</span><span class="font25">?</span></h4></li></ul>
<h4><a name="bookmark2544"></a><span class="font25"><a name="bookmark2545"></a>Locking will prevent the user from logging on to the system with his password by putting a ! in front of the password in </span><span class="font25" style="font-weight:bold;">/etc/shadow</span><span class="font25">.</span></h4>
<h4><a name="bookmark2546"></a><span class="font25"><a name="bookmark2547"></a>Disabling with </span><span class="font25" style="font-weight:bold;">passwd </span><span class="font25">will erase the password from </span><span class="font25" style="font-weight:bold;">/etc/shadow</span><span class="font25">.</span></h4>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2548"></a><span class="font25"><a name="bookmark2549"></a>5. Try changing the password of serena to serena as serena.</span></h4></li></ul>
<p><span class="font19">log on as serena, then execute: passwd serena... it should fail!</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2550"></a><span class="font25"><a name="bookmark2551"></a>6. Make sure </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">has to change her password in 10 days.</span></h4></li></ul>
<p><span class="font19">chage -M 10 serena</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark2552"></a><span class="font25"><a name="bookmark2553"></a>7. Make sure every new user needs to change their password every 10 days.</span></h4></li></ul>
<p><span class="font19">vi /etc/login.defs (and change PASS_MAX_DAYS to 10)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. Take a backup as root of </span><span class="font25" style="font-weight:bold;">/etc/shadow</span><span class="font25">. Use </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">to copy an encrypted </span><span class="font25" style="font-weight:bold;">hunter2 </span><span class="font25">hash from </span><span class="font25" style="font-weight:bold;">venus </span><span class="font25">to </span><span class="font25" style="font-weight:bold;">serena</span><span class="font25">. Can </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">now log on with </span><span class="font25" style="font-weight:bold;">hunter2 </span><span class="font25">as a password ?</span></p></li></ul>
<p><span class="font19">Yes.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">9. Why use </span><span class="font25" style="font-weight:bold;">vipw </span><span class="font25">instead of </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">? What could be the problem when using </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">vim </span><span class="font25">?</span></p></li></ul>
<p><span class="font19" style="font-weight:bold;">vipw </span><span class="font19">will give a warning when someone else is already using that file (with </span><span class="font19" style="font-weight:bold;">vipw</span><span class="font19">).</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">10. Use </span><span class="font25" style="font-weight:bold;">chsh </span><span class="font25">to list all shells (only works on RHEL/CentOS/Fedora), and compare to </span><span class="font25" style="font-weight:bold;">cat / etc/shells</span><span class="font25">.</span></p></li></ul>
<p><span class="font19">chsh -l</span></p>
<p><span class="font19">cat /etc/shells</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">11. Which </span><span class="font25" style="font-weight:bold;">useradd </span><span class="font25">option allows you to name a home directory ?</span></p></li></ul>
<p><span class="font19">-d</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">12. How can you see whether the password of user </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">is locked or unlocked ? Give a solution with </span><span class="font25" style="font-weight:bold;">grep </span><span class="font25">and a solution with </span><span class="font25" style="font-weight:bold;">passwd</span><span class="font25">.</span></p></li></ul>
<p><span class="font19">grep serena /etc/shadow</span></p>
<p><span class="font19">passwd -S serena</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark2554"></a><span class="font11" style="font-weight:bold;"><a name="bookmark319"></a><a name="bookmark2555"></a>Chapter 30. user profiles</span></h1></li></ul>
<p><a name="bookmark2556"></a><span class="font25">Logged on users have a number of preset (and customized) aliases, variables, and functions, but where do they come from ? The </span><span class="font25" style="font-weight:bold;">shell </span><span class="font25">uses a number of startup files that are executed (or rather </span><span class="font25" style="font-weight:bold;">sourced</span><span class="font25">) whenever the shell is invoked. What follows is an overview of startup scripts.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2557"></a><span class="font10" style="font-weight:bold;"><a name="bookmark320"></a><a name="bookmark2558"></a>30.1. system profile</span></h2></li></ul>
<p><a name="bookmark2559"></a><span class="font25"><a name="bookmark2560"></a><a name="bookmark2561"></a>Both the </span><span class="font25" style="font-weight:bold;">bash </span><span class="font25">and the </span><span class="font25" style="font-weight:bold;">ksh </span><span class="font25">shell will verify the existence of </span><span class="font25" style="font-weight:bold;">/etc/profile </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">source </span><span class="font25">it if it exists.</span></p>
<p><a name="bookmark2562"></a><span class="font25">When reading this script, you will notice (both on Debian and on Red Hat Enterprise Linux) that it builds the PATH environment variable (among others). The script might also change the PS1 variable, set the HOSTNAME and execute even more scripts like </span><span class="font25" style="font-weight:bold;">/etc/inputrc</span></p>
<p><span class="font25">This screenshot uses grep to show PATH manipulation in </span><span class="font25" style="font-weight:bold;">/etc/profile </span><span class="font25">on Debian.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep PATH /etc/profile</span></p>
<p><span class="font19">PATH=&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot; PATH=&quot;/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games&quot;</span></p>
<p><span class="font19">export PATH</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<p><span class="font25">This screenshot uses grep to show PATH manipulation in </span><span class="font25" style="font-weight:bold;">/etc/profile </span><span class="font25">on RHEL7/CentOS7.</span></p>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">grep PATH /etc/profile</span></p>
<p><span class="font19">case &quot;:${PATH}:&quot; in</span></p>
<p><span class="font19">PATH=$PATH:$1</span></p>
<p><span class="font19">PATH=$1:$PATH</span></p>
<p><span class="font19">export PATH USER LOGNAME MAIL HOSTNAME HISTSIZE HISTCONTROL [root@centos7 ~]#</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">root user </span><span class="font25">can use this script to set aliases, functions, and variables for every user on the system.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2563"></a><span class="font10" style="font-weight:bold;"><a name="bookmark321"></a><a name="bookmark2564"></a>30.2. ~/.bash_profile</span></h2></li></ul>
<p><span class="font25">When this file exists in the home directory, then </span><span class="font25" style="font-weight:bold;">bash </span><span class="font25">will source it. On Debian Linux 5/6/7 this file does not exist by default.</span></p>
<p><a name="bookmark2565"></a><span class="font25"><a name="bookmark2566"></a>RHEL7/CentOS7 uses a small </span><span class="font25" style="font-weight:bold;">~/.bash_profile </span><span class="font25">where it checks for the existence of </span><span class="font25" style="font-weight:bold;">~/.bashrc </span><span class="font25">and then sources it. It also adds $HOME/bin to the $PATH variable.</span></p>
<p><span class="font19">[root@rhel7 ~]# </span><span class="font19" style="font-weight:bold;">cat /home/paul/.bash_profile</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># .bash_profile</span></p></li>
<li>
<p><span class="font19"># Get the aliases and functions</span></p></li></ul>
<p><span class="font19">if [ -f ~/.bashrc ]; then . ~/.bashrc</span></p>
<p><span class="font19">fi</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># User specific environment and startup programs</span></p></li></ul>
<p><span class="font19">PATH=$PATH:$HOME/.local/bin:$HOME/bin</span></p>
<p><span class="font19">export PATH</span></p>
<p><span class="font19">[root@rhel7 ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2567"></a><span class="font10" style="font-weight:bold;"><a name="bookmark322"></a><a name="bookmark2568"></a>30.3. ~/.bash_login</span></h2></li></ul>
<p><a name="bookmark2569"></a><span class="font25">When </span><span class="font25" style="font-weight:bold;">.bash_profile </span><span class="font25">does not exist, then </span><span class="font25" style="font-weight:bold;">bash </span><span class="font25">will check for </span><span class="font25" style="font-weight:bold;">~/.bash_login </span><span class="font25">and source it.</span></p>
<p><span class="font25">Neither Debian nor Red Hat have this file by default.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2570"></a><span class="font10" style="font-weight:bold;"><a name="bookmark323"></a><a name="bookmark2571"></a>30.4. ~/.profile</span></h2></li></ul>
<p><span class="font25">When neither </span><span class="font25" style="font-weight:bold;">~/.bash_profile </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">~/.bash_login </span><span class="font25">exist, then bash will verify the existence of </span><span class="font25" style="font-weight:bold;">~/.profile </span><span class="font25">and execute it. This file does not exist by default on Red Hat.</span></p>
<p><a name="bookmark2572"></a><span class="font25">On Debian this script can execute </span><span class="font25" style="font-weight:bold;">~/.bashrc </span><span class="font25">and will add $HOME/bin to the $PATH variable.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">tail -11 /home/paul/.profile </span><span class="font19">if [ -n &quot;$BASH_VERSION&quot; ]; then # include .bashrc if it exists if [ -f &quot;$HOME/.bashrc&quot; ]; then . &quot;$HOME/.bashrc&quot; fi fi</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># set PATH so it includes user's private bin if it exists if [ -d &quot;$HOME/bin&quot; ] ; then</span></p></li></ul>
<p><span class="font19">PATH=&quot;$HOME/bin:$PATH&quot; fi</span></p>
<p><span class="font25">RHEL/CentOS does not have this file by default.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2573"></a><span class="font10" style="font-weight:bold;"><a name="bookmark324"></a><a name="bookmark2574"></a>30.5. ~/.bashrc</span></h2></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">~/.bashrc </span><span class="font25">script is often sourced by other scripts. Let us take a look at what it does by default.</span></p>
<p><a name="bookmark2575"></a><span class="font25">Red Hat uses a very simple </span><span class="font25" style="font-weight:bold;">~/.bashrc</span><span class="font25">, checking for </span><span class="font25" style="font-weight:bold;">/etc/bashrc </span><span class="font25">and sourcing it. It also leaves room for custom aliases and functions.</span></p>
<p><span class="font19">[root@rhel7 ~]# </span><span class="font19" style="font-weight:bold;">cat /home/paul/.bashrc </span><span class="font19"># .bashrc</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Source global definitions if [ -f /etc/bashrc ]; then . /etc/bashrc fi</span></p></li>
<li>
<p><span class="font19"># Uncomment the following line if you don't like systemctl's auto-paging feature: # export SYSTEMD_PAGER=</span></p></li>
<li>
<p><span class="font19"># User specific aliases and functions</span></p></li></ul>
<p><span class="font25">On Debian this script is quite a bit longer and configures $PS1, some history variables and a number af active and inactive aliases.</span></p>
<p><span class="font19">root@debian7:~# wc -l /home/paul/.bashrc 110 /home/paul/.bashrc</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2576"></a><span class="font10" style="font-weight:bold;"><a name="bookmark325"></a><a name="bookmark2577"></a>30.6. ~/.bash_logout</span></h2></li></ul>
<h4><a name="bookmark2578"></a><span class="font25"><a name="bookmark2579"></a><a name="bookmark2580"></a>When exiting </span><span class="font25" style="font-weight:bold;">bash</span><span class="font25">, it can execute </span><span class="font25" style="font-weight:bold;">~/.bash_logout</span><span class="font25">.</span><br><br><span class="font25"><a name="bookmark2581"></a>Debian use this opportunity to clear the console screen.</span></h4>
<p><span class="font19">serena@deb503:~$ </span><span class="font19" style="font-weight:bold;">cat .bash_logout</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># ~/.bash_logout: executed by bash(1) when login shell exits.</span></p></li>
<li>
<p><span class="font19"># when leaving the console clear the screen to increase privacy</span></p></li></ul>
<p><span class="font19">if [ &quot;$SHLVL&quot; = 1 ]; then</span></p>
<p><span class="font19">[ -x /usr/bin/clear_console ] &amp;&amp;&nbsp;/usr/bin/clear_console -q</span></p>
<p><span class="font19">fi</span></p>
<h4><a name="bookmark2582"></a><span class="font25"><a name="bookmark2583"></a>Red Hat Enterprise Linux 5 will simple call the </span><span class="font25" style="font-weight:bold;">/usr/bin/clear </span><span class="font25">command in this script.</span></h4>
<p><span class="font19">[serena@rhel53 ~]$ cat .bash_logout</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># ~/.bash_logout</span></p></li></ul>
<p><span class="font19">/usr/bin/clear</span></p>
<h4><a name="bookmark2584"></a><span class="font25"><a name="bookmark2585"></a>Red Hat Enterprise Linux 6 and 7 create this file, but leave it empty (except for a comment).</span></h4>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">cat .bash_logout</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># ~/.bash_logout</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2586"></a><span class="font10" style="font-weight:bold;"><a name="bookmark326"></a><a name="bookmark2587"></a>30.7. Debian overview</span></h2></li></ul>
<p><a name="bookmark2588"></a><span class="font25">Below is a table overview of when Debian is running any of these bash startup scripts.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 30.1. Debian User Environment</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">script</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">su</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">su -</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">ssh</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">gdm</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">~./bashrc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">no</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">~/.profile</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">no</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">/etc/profile</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">no</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font24">/etc/bash.bashrc</span></p></td><td style="vertical-align:middle;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:middle;">
<p><span class="font24">no</span></p></td><td style="vertical-align:middle;">
<p><span class="font24">no</span></p></td><td style="vertical-align:middle;">
<p><span class="font24">yes</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2589"></a><span class="font10" style="font-weight:bold;"><a name="bookmark327"></a><a name="bookmark2590"></a>30.8. RHEL5 overview</span></h2></li></ul>
<p><a name="bookmark2591"></a><span class="font25">Below is a table overview of when Red Hat Enterprise Linux 5 is running any of these bash startup scripts.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 30.2. Red Hat User Environment</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">script</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">su</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">su -</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">ssh</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">gdm</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">~./bashrc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">~/.bash_profile</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">no</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">/etc/profile</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">no</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">/etc/bashrc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2592"></a><span class="font10" style="font-weight:bold;"><a name="bookmark328"></a><a name="bookmark2593"></a>30.9. practice: user profiles</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Make a list of all the profile files on your system.</span></p></li>
<li>
<p><span class="font25">2. Read the contents of each of these, often they </span><span class="font25" style="font-weight:bold;">source </span><span class="font25">extra scripts.</span></p></li>
<li>
<p><span class="font25">3. Put a unique variable, alias and function in each of those files.</span></p></li>
<li>
<p><span class="font25">4. Try several different ways to obtain a shell (su, su -, ssh, tmux, gnome-terminal, Ctrl-alt-F1, ...) and verify which of your custom variables, aliases and function are present in your environment.</span></p></li>
<li>
<p><span class="font25">5. Do you also know the order in which they are executed?</span></p></li>
<li>
<p><span class="font25">6. When an application depends on a setting in $HOME/.profile, does it matter whether $HOME/.bash_profile exists or not ?</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2594"></a><span class="font10" style="font-weight:bold;"><a name="bookmark329"></a><a name="bookmark2595"></a>30.10. solution: user profiles</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Make a list of all the profile files on your system.</span></p></li></ul>
<p><span class="font19">ls -a ~ </span><span class="font23" style="font-style:italic;">;</span><span class="font19"> ls -l /etc/pro* /etc/bash*</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Read the contents of each of these, often they </span><span class="font25" style="font-weight:bold;">source </span><span class="font25">extra scripts.</span></p></li>
<li>
<p><span class="font25">3. Put a unique variable, alias and function in each of those files.</span></p></li>
<li>
<p><span class="font25">4. Try several different ways to obtain a shell (su, su -, ssh, tmux, gnome-terminal, Ctrl-alt-F1, ...) and verify which of your custom variables, aliases and function are present in your environment.</span></p></li>
<li>
<p><span class="font25">5. Do you also know the order in which they are executed?</span></p></li></ul>
<p><span class="font19">same name aliases, functions and variables will overwrite each other</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. When an application depends on a setting in $HOME/.profile, does it matter whether $HOME/.bash_profile exists or not ?</span></p></li></ul>
<p><span class="font19">Yes it does matter. (man bash /INVOCATION)</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark2596"></a><span class="font11" style="font-weight:bold;"><a name="bookmark2597"></a><a name="bookmark2598"></a>Chapter 31. groups</span></h1></li></ul>
<p><a name="bookmark2599"></a><span class="font25">Users can be listed in </span><span class="font25" style="font-weight:bold;">groups</span><span class="font25">. Groups allow you to set permissions on the group level instead of having to set permissions for every individual user.</span></p>
<p><span class="font25">Every Unix or Linux distribution will have a graphical tool to manage groups. Novice users are advised to use this graphical tool. More experienced users can use command line tools to manage users, but be careful: Some distributions do not allow the mixed use of GUI and CLI tools to manage groups (YaST in Novell Suse). Senior administrators can edit the relevant files directly with </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">vigr</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2600"></a><span class="font10" style="font-weight:bold;"><a name="bookmark331"></a><a name="bookmark2601"></a>31.1. groupadd</span></h2></li></ul>
<p><a name="bookmark2602"></a><span class="font25">Groups can be created with the </span><span class="font25" style="font-weight:bold;">groupadd </span><span class="font25">command. The example below shows the creation of five (empty) groups.</span></p>
<p><span class="font19">root@laika:~# groupadd tennis</span></p>
<p><span class="font19">root@laika:~# groupadd football</span></p>
<p><span class="font19">root@laika:~# groupadd snooker</span></p>
<p><span class="font19">root@laika:~# groupadd formulal root@laika:~# groupadd salsa</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2603"></a><span class="font10" style="font-weight:bold;"><a name="bookmark332"></a><a name="bookmark2604"></a>31.2. group file</span></h2></li></ul>
<p><a name="bookmark2605"></a><span class="font25">Users can be a member of several groups. Group membership is defined by the </span><span class="font25" style="font-weight:bold;">/etc/group </span><span class="font25">file.</span></p>
<p><span class="font19">root@laika:~# tail -5 /etc/group</span></p>
<p><span class="font19">tennis:x:1006:</span></p>
<p><span class="font19">football:x:1007:</span></p>
<p><span class="font19">snooker:x:1008:</span></p>
<p><span class="font19">formula1:x:1009:</span></p>
<p><span class="font19">salsa:x:1010:</span></p>
<p><span class="font19">root@laika:~#</span></p>
<p><a name="bookmark2606"></a><span class="font25">The first field is the group's name. The second field is the group's (encrypted) password (can be empty). The third field is the group identification or </span><span class="font25" style="font-weight:bold;">GID</span><span class="font25">. The fourth field is the list of members, these groups have no members.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2607"></a><span class="font10" style="font-weight:bold;"><a name="bookmark330"></a><a name="bookmark2608"></a>31.3. groups</span></h2></li></ul>
<p><a name="bookmark2609"></a><span class="font25">A user can type the </span><span class="font25" style="font-weight:bold;">groups </span><span class="font25">command to see a list of groups where the user belongs to.</span></p>
<p><span class="font19">[harry@RHEL4b ~]$ groups harry sports</span></p>
<p><span class="font19">[harry@RHEL4b ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2610"></a><span class="font10" style="font-weight:bold;"><a name="bookmark334"></a><a name="bookmark2611"></a>31.4. usermod</span></h2></li></ul>
<h4><a name="bookmark2612"></a><span class="font25"><a name="bookmark2613"></a><a name="bookmark2614"></a>Group membership can be modified with the useradd or </span><span class="font25" style="font-weight:bold;">usermod </span><span class="font25">command.</span></h4>
<p><span class="font19">root@laika:~# usermod -a -G tennis inge root@laika:~# usermod -a -G tennis katrien root@laika:~# usermod -a -G salsa katrien root@laika:~# usermod -a -G snooker sandra root@laika:~# usermod -a -G formulal annelies root@laika:~# tail -5 /etc/group tennis:x:1006:inge,katrien football:x:1007: snooker:x:1008:sandra formula1:x:1009:annelies salsa:x:1010:katrien root@laika:~#</span></p>
<h4><a name="bookmark2615"></a><span class="font25"><a name="bookmark2616"></a>Be careful when using </span><span class="font25" style="font-weight:bold;">usermod </span><span class="font25">to add users to groups. By default, the </span><span class="font25" style="font-weight:bold;">usermod </span><span class="font25">command will </span><span class="font25" style="font-weight:bold;">remove </span><span class="font25">the user from every group of which he is a member if the group is not listed in the command! Using the </span><span class="font25" style="font-weight:bold;">-a </span><span class="font25">(append) switch prevents this behaviour.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2617"></a><span class="font10" style="font-weight:bold;"><a name="bookmark333"></a><a name="bookmark2618"></a>31.5. groupmod</span></h2></li></ul>
<h4><a name="bookmark2619"></a><span class="font25"><a name="bookmark2620"></a><a name="bookmark2621"></a>You can change the group name with the </span><span class="font25" style="font-weight:bold;">groupmod </span><span class="font25">command.</span></h4>
<p><span class="font19">root@laika:~# groupmod -n darts snooker root@laika:~# tail -5 /etc/group tennis:x:1006:inge,katrien football:x:1007:</span></p>
<p><span class="font19">formula1:x:1009:annelies salsa:x:1010:katrien darts:x:1008:sandra</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2622"></a><span class="font10" style="font-weight:bold;"><a name="bookmark336"></a><a name="bookmark2623"></a>31.6. groupdel</span></h2></li></ul>
<h4><a name="bookmark2624"></a><span class="font25"><a name="bookmark2625"></a><a name="bookmark2626"></a>You can permanently remove a group with the </span><span class="font25" style="font-weight:bold;">groupdel </span><span class="font25">command.</span></h4>
<p><span class="font19">root@laika:~# groupdel tennis root@laika:~#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2627"></a><span class="font10" style="font-weight:bold;"><a name="bookmark337"></a><a name="bookmark2628"></a>31.7. gpasswd</span></h2></li></ul>
<h4><a name="bookmark2629"></a><span class="font25"><a name="bookmark2630"></a><a name="bookmark2631"></a><a name="bookmark2632"></a>You can delegate control of group membership to another user with the </span><span class="font25" style="font-weight:bold;">gpasswd </span><span class="font25">command. In the example below we delegate permissions to add and remove group members to serena for the sports group. Then we </span><span class="font25" style="font-weight:bold;">su </span><span class="font25">to serena and add harry to the sports group.</span></h4>
<p><span class="font19">[root@RHEL4b ~]# gpasswd -A serena sports</span></p>
<p><span class="font19">[root@RHEL4b ~]# su - serena</span></p>
<p><span class="font19">[serena@RHEL4b ~]$ id harry</span></p>
<p><span class="font19">uid=516(harry) gid=520(harry) groups=520(harry)</span></p>
<p><span class="font19">[serena@RHEL4b ~]$ gpasswd -a harry sports</span></p>
<p><span class="font19">Adding user harry to group sports</span></p>
<p><span class="font19">[serena@RHEL4b ~]$ id harry</span></p>
<p><span class="font19">uid=516(harry) gid=520(harry) groups=520(harry),522(sports)</span></p>
<p><span class="font19">[serena@RHEL4b ~]$ tail -1 /etc/group</span></p>
<p><span class="font19">sports:x:522:serena,venus,harry</span></p>
<p><span class="font19">[serena@RHEL4b ~]$</span></p>
<h4><a name="bookmark2633"></a><span class="font25"><a name="bookmark2634"></a>Group administrators do not have to be a member of the group. They can remove themselves from a group, but this does not influence their ability to add or remove members.</span></h4>
<p><span class="font19">[serena@RHEL4b ~]$ gpasswd -d serena sports</span></p>
<p><span class="font19">Removing user serena from group sports</span></p>
<p><span class="font19">[serena@RHEL4b ~]$ exit</span></p>
<h4><a name="bookmark2635"></a><span class="font25"><a name="bookmark2636"></a><a name="bookmark2637"></a>Information about group administrators is kept in the </span><span class="font25" style="font-weight:bold;">/etc/gshadow </span><span class="font25">file.</span></h4>
<p><span class="font19">[root@RHEL4b ~]# tail -1 /etc/gshadow</span></p>
<p><span class="font19">sports:!:serena:venus,harry</span></p>
<p><span class="font19">[root@RHEL4b ~]#</span></p>
<h4><a name="bookmark2638"></a><span class="font25"><a name="bookmark2639"></a>To remove all group administrators from a group, use the </span><span class="font25" style="font-weight:bold;">gpasswd </span><span class="font25">command to set an empty administrators list.</span></h4>
<p><span class="font19">[root@RHEL4b ~]# gpasswd -A &quot;&quot;&nbsp;sports</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2640"></a><span class="font10" style="font-weight:bold;"><a name="bookmark338"></a><a name="bookmark2641"></a>31.8. newgrp</span></h2></li></ul>
<h4><a name="bookmark2642"></a><span class="font25"><a name="bookmark2643"></a>You can start a </span><span class="font25" style="font-weight:bold;">child shell </span><span class="font25">with a new temporary </span><span class="font25" style="font-weight:bold;">primary group </span><span class="font25">using the </span><span class="font25" style="font-weight:bold;">newgrp </span><span class="font25">command.</span></h4>
<p><span class="font19">root@rhel65:~# mkdir prigroup</span></p>
<p><span class="font19">root@rhel65:~# cd prigroup/</span></p>
<p><span class="font19">root@rhel65:~/prigroup# touch standard.txt</span></p>
<p><span class="font19">root@rhel65:~/prigroup# ls -l</span></p>
<p><span class="font19">total 0</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-r--r--. 1 root root 0 Apr 13 17:49 standard.txt root@rhel65:~/prigroup# echo $SHLVL 1</span></p></li></ul>
<p><span class="font19">root@rhel65:~/prigroup# newgrp tennis</span></p>
<p><span class="font19">root@rhel65:~/prigroup# echo $SHLVL 2</span></p>
<p><span class="font19">root@rhel65:~/prigroup# touch newgrp.txt</span></p>
<p><span class="font19">root@rhel65:~/prigroup# ls -l</span></p>
<p><span class="font19">total 0</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-r--r--. 1 root tennis 0 Apr 13 17:49 newgrp.txt</span></p></li>
<li>
<p><span class="font19">- rw-r--r--. 1 root root 0 Apr 13 17:49 standard.txt root@rhel65:~/prigroup# exit exit</span></p></li></ul>
<p><span class="font19">root@rhel65:~/prigroup#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2644"></a><span class="font10" style="font-weight:bold;"><a name="bookmark339"></a><a name="bookmark2645"></a>31.9. vigr</span></h2></li></ul>
<h4><a name="bookmark2646"></a><span class="font25"><a name="bookmark2647"></a><a name="bookmark2648"></a><a name="bookmark2649"></a>Similar to vipw, the </span><span class="font25" style="font-weight:bold;">vigr </span><span class="font25">command can be used to manually edit the </span><span class="font25" style="font-weight:bold;">/etc/group </span><span class="font25">file, since it will do proper locking of the file. Only experienced senior administrators should use </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">vigr </span><span class="font25">to manage groups.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2650"></a><span class="font10" style="font-weight:bold;"><a name="bookmark340"></a><a name="bookmark2651"></a>31.10. practice: groups</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create the groups tennis, football and sports.</span></p></li>
<li>
<p><span class="font25">2. In one command, make venus a member of tennis and sports.</span></p></li>
<li>
<p><span class="font25">3. Rename the football group to foot.</span></p></li>
<li>
<p><span class="font25">4. Use vi to add serena to the tennis group.</span></p></li>
<li>
<p><span class="font25">5. Use the id command to verify that serena is a member of tennis.</span></p></li>
<li>
<p><span class="font25">6. Make someone responsible for managing group membership of foot and sports. Test that it works.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2652"></a><span class="font10" style="font-weight:bold;"><a name="bookmark341"></a><a name="bookmark2653"></a>31.11. solution: groups</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create the groups tennis, football and sports.</span></p></li></ul>
<p><span class="font19">groupadd tennis ; groupadd football ; groupadd sports</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. In one command, make venus a member of tennis and sports.</span></p></li></ul>
<p><span class="font19">usermod -a -G tennis,sports venus</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Rename the football group to foot. </span><span class="font19">groupmod -n foot football</span></p></li>
<li>
<p><span class="font25">4. Use vi to add serena to the tennis group.</span></p></li></ul>
<p><span class="font19">vi /etc/group</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Use the id command to verify that serena is a member of tennis.</span></p></li></ul>
<p><span class="font19">id (and after logoff logon serena should be member)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Make someone responsible for managing group membership of foot and sports. Test that it works.</span></p></li></ul>
<p><span class="font19">gpasswd -A (to make manager)</span></p>
<p><span class="font19">gpasswd -a (to add member)</span></p>
<p><a name="bookmark2654"></a><span class="font11" style="font-weight:bold;">Part IX. file security</span></p>
<h3><a name="bookmark2655"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2656"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2657"><span class="font24" style="font-weight:bold;">32. standard file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2658"><span class="font24">32.1. file ownership </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2659"><span class="font24">32.2. list of special files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2660"><span class="font24">32.3. permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2661"><span class="font24">32.4. practice: standard file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2662"><span class="font24">32.5. solution: standard file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2663"><span class="font24" style="font-weight:bold;">33. advanced file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2664"><span class="font24">33.1. sticky bit on directory </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2665"><span class="font24">33.2. setgid bit on directory </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2666"><span class="font24">33.3. setgid and setuid on regular files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2667"><span class="font24">33.4. setuid on sudo </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2668"><span class="font24">33.5. practice: sticky, setuid and setgid bits </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2669"><span class="font24">33.6. solution: sticky, setuid and setgid bits </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2670"><span class="font24" style="font-weight:bold;">34. access control lists </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2671"><span class="font24">34.1. acl in /etc/fstab </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2672"><span class="font24">34.2. getfacl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2673"><span class="font24">34.3. setfacl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2674"><span class="font24">34.4. remove an acl entry </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2675"><span class="font24">34.5. remove the complete acl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2676"><span class="font24">34.6. the acl mask </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2677"><span class="font24">34.7. eiciel </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2678"><span class="font24" style="font-weight:bold;">35. file links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2679"><span class="font24">35.1. inodes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2680"><span class="font24">35.2. about directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2681"><span class="font24">35.3. hard links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2682"><span class="font24">35.4. symbolic links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2683"><span class="font24">35.5. removing links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2684"><span class="font24">35.6. practice : links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2685"><span class="font24">35.7. solution : links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark2686"></a><span class="font11" style="font-weight:bold;"><a name="bookmark343"></a><a name="bookmark2687"></a>Chapter 32. standard file permissions</span></h1></li></ul>
<p><span class="font25">This chapter contains details about basic file security through </span><span class="font25" style="font-weight:bold;">file ownership </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">file permissions</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2688"></a><span class="font10" style="font-weight:bold;"><a name="bookmark344"></a><a name="bookmark2689"></a>32.1. file ownership</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark2690"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2691"></a>32.1.1. user owner and group owner</span></h3></li></ul></li></ul>
<p><a name="bookmark2692"></a><span class="font25"><a name="bookmark2693"></a><a name="bookmark2694"></a>The </span><span class="font25" style="font-weight:bold;">users </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">groups </span><span class="font25">of a system can be locally managed in </span><span class="font25" style="font-weight:bold;">/etc/passwd </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/etc/group</span><span class="font25">, or they can be in a NIS, LDAP, or Samba domain. These users and groups can </span><span class="font25" style="font-weight:bold;">own </span><span class="font25">files. Actually, every file has a </span><span class="font25" style="font-weight:bold;">user owner </span><span class="font25">and a </span><span class="font25" style="font-weight:bold;">group owner</span><span class="font25">, as can be seen in the following screenshot.</span></p>
<p><span class="font19">paul@rhel65:~/owners$ ls -Ih</span></p>
<p><span class="font19">total 636K</span></p>
<p><span class="font19">-rw-r--r--. 1 paul snooker 1.1K Apr &nbsp;8 18:47 data.odt</span></p>
<p><span class="font19">-rw-r--r--. 1 paul paul &nbsp;&nbsp;&nbsp;626K Apr &nbsp;8 18:46 file1</span></p>
<p><span class="font19">-rw-r--r--. 1 root tennis &nbsp;&nbsp;185 Apr &nbsp;8 18:46 file2</span></p>
<p><span class="font19">-rw-rw-r--. 1 root root &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 Apr &nbsp;8 18:47 stuff.txt</span></p>
<p><span class="font19">paul@rhel65:~/owners$</span></p>
<p><span class="font25">User paul owns three files; file1 has paul as </span><span class="font25" style="font-weight:bold;">user owner </span><span class="font25">and has the group paul as </span><span class="font25" style="font-weight:bold;">group owner</span><span class="font25">, data.odt is </span><span class="font25" style="font-weight:bold;">group owned </span><span class="font25">by the group snooker, file2 by the group tennis.</span></p>
<p><span class="font25">The last file is called stuff.txt and is owned by the root user and the root group.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark2695"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2696"></a>32.1.2. listing user accounts</span></h3></li></ul>
<p><span class="font25">You can use the following command to list all local user accounts.</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">paul@debian7~$</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cut -d: -f1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/etc/passwd |</span></p></td><td colspan="2" style="vertical-align:top;">
<p><span class="font19">column</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ntp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sam</span></p></td><td style="vertical-align:top;">
<p><span class="font19">bert</span></p></td><td style="vertical-align:top;">
<p><span class="font19">naomi</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">daemon</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mysql</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tom</span></p></td><td style="vertical-align:top;">
<p><span class="font19">rino</span></p></td><td style="vertical-align:top;">
<p><span class="font19">matthias2</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">bin</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">wouter</span></p></td><td style="vertical-align:top;">
<p><span class="font19">antonio</span></p></td><td style="vertical-align:top;">
<p><span class="font19">bram</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sys</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">maarten</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">robrecht</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">simon</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">fabrice</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sync</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">kevin</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">bilal</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sven</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">chimene</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">games</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">yuri</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">dimitri</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">wouter2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">messagebus</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">man</span></p></td><td style="vertical-align:top;">
<p><span class="font19">william</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ahmed</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tarik</span></p></td><td style="vertical-align:top;">
<p><span class="font19">roger</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">lp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">yves</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">dylan</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">jan</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">frank</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">mail</span></p></td><td style="vertical-align:top;">
<p><span class="font19">kris</span></p></td><td style="vertical-align:top;">
<p><span class="font19">robin</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ian</span></p></td><td style="vertical-align:top;">
<p><span class="font19">toon</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">news</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">hamid</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">matthias</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ivan</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">rinus</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">uucp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">vladimir</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ben</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">azeddine</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">eddy</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">proxy</span></p></td><td style="vertical-align:top;">
<p><span class="font19">abiy</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mike</span></p></td><td style="vertical-align:top;">
<p><span class="font19">eric</span></p></td><td style="vertical-align:top;">
<p><span class="font19">bram2</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">www-data</span></p></td><td style="vertical-align:top;">
<p><span class="font19">david</span></p></td><td style="vertical-align:top;">
<p><span class="font19">kevin2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">kamel</span></p></td><td style="vertical-align:top;">
<p><span class="font19">keith</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">backup</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">chahid</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">kenzo</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ischa</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">jesse</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">list</span></p></td><td style="vertical-align:top;">
<p><span class="font19">stef</span></p></td><td style="vertical-align:top;">
<p><span class="font19">aaron</span></p></td><td style="vertical-align:top;">
<p><span class="font19">bart</span></p></td><td style="vertical-align:top;">
<p><span class="font19">frederick</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">irc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">joeri</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">lorenzo</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">omer</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">hans</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">gnats</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">glenn</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">jens</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">kurt</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">dries</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">nobody</span></p></td><td style="vertical-align:top;">
<p><span class="font19">yannick</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ruben</span></p></td><td style="vertical-align:top;">
<p><span class="font19">steve</span></p></td><td style="vertical-align:top;">
<p><span class="font19">steve2</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">libuuid</span></p></td><td style="vertical-align:top;">
<p><span class="font19">christof</span></p></td><td style="vertical-align:top;">
<p><span class="font19">jelle</span></p></td><td style="vertical-align:top;">
<p><span class="font19">constantin</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tomas</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Debian-exim</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">george</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">stefaan</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sam2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">johan</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">statd</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">joost</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">marc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">bjorn</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tom2</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sshd</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">arno</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">thomas</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ronald</span></p></td><td style="vertical-align:top;"></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark2697"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2698"></a>32.1.3. chgrp</span></h3></li></ul>
<h4><a name="bookmark2699"></a><span class="font25"><a name="bookmark2700"></a><a name="bookmark2701"></a>You can change the group owner of a file using the </span><span class="font25" style="font-weight:bold;">chgrp </span><span class="font25">command.</span></h4>
<p><span class="font19">root@rhel65:/home/paul/owners# ls -l file2</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-r--r--. 1 root tennis 185 Apr 8 18:46 file2 root@rhel65:/home/paul/owners# </span><span class="font19" style="font-weight:bold;">chgrp snooker file2 </span><span class="font19">root@rhel65:/home/paul/owners# ls -l file2 -rw-r--r--. 1 root </span><span class="font19" style="font-weight:bold;">snooker </span><span class="font19">185 Apr 8 18:46 file2 root@rhel65:/home/paul/owners#</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark2702"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2703"></a>32.1.4. chown</span></h3></li></ul>
<h4><a name="bookmark2704"></a><span class="font25"><a name="bookmark2705"></a><a name="bookmark2706"></a>The user owner of a file can be changed with </span><span class="font25" style="font-weight:bold;">chown </span><span class="font25">command.</span></h4>
<p><span class="font19">root@laika:/home/paul# ls -l FileForPaul</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-r--r-- 1 root paul 0 2008-08-06 14:11 FileForPaul root@laika:/home/paul# chown paul FileForPaul root@laika:/home/paul# ls -l FileForPaul</span></p></li>
<li>
<p><span class="font19">- rw-r--r-- 1 paul paul 0 2008-08-06 14:11 FileForPaul</span></p></li></ul>
<h4><a name="bookmark2707"></a><span class="font25"><a name="bookmark2708"></a>You can also use </span><span class="font25" style="font-weight:bold;">chown </span><span class="font25">to change both the user owner and the group owner.</span></h4>
<p><span class="font19">root@laika:/home/paul# ls -l FileForPaul</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-r--r-- 1 paul paul 0 2008-08-06 14:11 FileForPaul root@laika:/home/paul# chown root:project42 FileForPaul root@laika:/home/paul# ls -l FileForPaul</span></p></li>
<li>
<p><span class="font19">- rw-r--r-- 1 root project42 0 2008-08-06 14:11 FileForPaul</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2709"></a><span class="font10" style="font-weight:bold;"><a name="bookmark345"></a><a name="bookmark2710"></a>32.2. list of special files</span></h2></li></ul>
<p><a name="bookmark2711"></a><span class="font25"><a name="bookmark2712"></a>When you use </span><span class="font25" style="font-weight:bold;">ls -l</span><span class="font25">, for each file you can see ten characters before the user and group owner. The first character tells us the type of file. Regular files get a </span><span class="font25" style="font-weight:bold;">-</span><span class="font25">, directories get a </span><span class="font25" style="font-weight:bold;">d</span><span class="font25">, symbolic links are shown with an </span><span class="font25" style="font-weight:bold;">l</span><span class="font25">, pipes get a </span><span class="font25" style="font-weight:bold;">p</span><span class="font25">, character devices a </span><span class="font25" style="font-weight:bold;">c</span><span class="font25">, block devices a </span><span class="font25" style="font-weight:bold;">b</span><span class="font25">, and sockets an </span><span class="font25" style="font-weight:bold;">s</span><span class="font25">.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 32.1. Unix special files</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">first character</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">file type</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font24">-</span></p></td><td style="vertical-align:middle;">
<p><span class="font24">normal file</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">d</span></p></td><td style="vertical-align:top;">
<p><span class="font24">directory</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">l</span></p></td><td style="vertical-align:top;">
<p><span class="font24">symbolic link</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">P</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">named pipe</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">b</span></p></td><td style="vertical-align:top;">
<p><span class="font24">block device</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">c</span></p></td><td style="vertical-align:top;">
<p><span class="font24">character device</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">s</span></p></td><td style="vertical-align:top;">
<p><span class="font24">socket</span></p></td></tr>
</table>
<p><span class="font25">Below a screenshot of a character device (the console) and a block device (the hard disk).</span></p>
<p><span class="font19">paul@debian6lt~$ ls -ld /dev/console /dev/sda</span></p>
<p><span class="font19">crw------- 1 root root 5, 1 Mar 15 12:45 /dev/console</span></p>
<p><span class="font19">brw-rw---- &nbsp;&nbsp;1 root disk 8, 0 Mar 15 12:45 /dev/sda</span></p>
<p><span class="font25">And here you can see a directory, a regular file and a symbolic link.</span></p>
<p><span class="font19">paul@debian6lt~$ ls -ld /etc /etc/hosts /etc/motd</span></p>
<p><span class="font19">drwxr-xr-x 128 root root 12288 Mar 15 18:34 /etc</span></p>
<p><span class="font19">-rw-r--r-- &nbsp;&nbsp;1 root root &nbsp;&nbsp;372 Dec 10 17:36 /etc/hosts</span></p>
<p><span class="font19">lrwxrwxrwx 1 root root &nbsp;&nbsp;&nbsp;13 Dec &nbsp;5 10:36 /etc/motd -&gt; /var/run/motd</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2713"></a><span class="font10" style="font-weight:bold;"><a name="bookmark346"></a><a name="bookmark2714"></a>32.3. permissions</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark2715"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2716"></a>32.3.1. rwx</span></h3></li></ul></li></ul>
<p><a name="bookmark2717"></a><span class="font25">The nine characters following the file type denote the permissions in three triplets. A permission can be </span><span class="font25" style="font-weight:bold;">r </span><span class="font25">for read access, </span><span class="font25" style="font-weight:bold;">w </span><span class="font25">for write access, and </span><span class="font25" style="font-weight:bold;">x </span><span class="font25">for execute. You need the </span><span class="font25" style="font-weight:bold;">r </span><span class="font25">permission to list (ls) the contents of a directory. You need the </span><span class="font25" style="font-weight:bold;">x </span><span class="font25">permission to enter (cd) a directory. You need the </span><span class="font25" style="font-weight:bold;">w </span><span class="font25">permission to create files in or remove files from a directory.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 32.2. standard Unix file permissions</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">permission</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">on a file</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">on a directory</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">r (read)</span></p></td><td style="vertical-align:top;">
<p><span class="font24">read file contents (cat)</span></p></td><td style="vertical-align:top;">
<p><span class="font24">read directory contents (Is)</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">w (write)</span></p></td><td style="vertical-align:top;">
<p><span class="font24">change file contents (vi)</span></p></td><td style="vertical-align:top;">
<p><span class="font24">create files in (touch)</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">x (execute)</span></p></td><td style="vertical-align:top;">
<p><span class="font24">execute the file</span></p></td><td style="vertical-align:top;">
<p><span class="font24">enter the directory (cd)</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark2718"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2719"></a>32.3.2. three sets of rwx</span></h3></li></ul>
<p><a name="bookmark2720"></a><span class="font25">We already know that the output of </span><span class="font25" style="font-weight:bold;">ls -l </span><span class="font25">starts with ten characters for each file. This screenshot shows a regular file (because the first character is a - ).</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ ls -l proc42.bash</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rwxr-xr-- 1 paul proj 984 Feb 6 12:01 proc42.bash</span></p></li></ul>
<p><a name="bookmark2721"></a><span class="font25">Below is a table describing the function of all ten characters.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 32.3. Unix file permissions position</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">position</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">characters</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">function</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font24">1</span></p></td><td style="vertical-align:middle;">
<p><span class="font24">-</span></p></td><td style="vertical-align:middle;">
<p><span class="font24">this is a regular file</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">2-4</span></p></td><td style="vertical-align:top;">
<p><span class="font24">rwx</span></p></td><td style="vertical-align:top;">
<p><span class="font24">permissions for the </span><span class="font24" style="font-weight:bold;">user owner</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">5-7</span></p></td><td style="vertical-align:top;">
<p><span class="font24">r-x</span></p></td><td style="vertical-align:top;">
<p><span class="font24">permissions for the </span><span class="font24" style="font-weight:bold;">group owner</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">8-10</span></p></td><td style="vertical-align:top;">
<p><span class="font24">r--</span></p></td><td style="vertical-align:top;">
<p><span class="font24">permissions for </span><span class="font24" style="font-weight:bold;">others</span></p></td></tr>
</table>
<p><a name="bookmark2722"></a><span class="font25">When you are the </span><span class="font25" style="font-weight:bold;">user owner </span><span class="font25">of a file, then the </span><span class="font25" style="font-weight:bold;">user owner permissions </span><span class="font25">apply to you. The rest of the permissions have no influence on your access to the file.</span></p>
<p><span class="font25">When you belong to the </span><span class="font25" style="font-weight:bold;">group </span><span class="font25">that is the </span><span class="font25" style="font-weight:bold;">group owner </span><span class="font25">of a file, then the </span><span class="font25" style="font-weight:bold;">group owner permissions </span><span class="font25">apply to you. The rest of the permissions have no influence on your access to the file.</span></p>
<p><span class="font25">When you are not the </span><span class="font25" style="font-weight:bold;">user owner </span><span class="font25">of a file and you do not belong to the </span><span class="font25" style="font-weight:bold;">group owner</span><span class="font25">, then the </span><span class="font25" style="font-weight:bold;">others permissions </span><span class="font25">apply to you. The rest of the permissions have no influence on your access to the file.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark2723"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2724"></a>32.3.3. permission examples</span></h3></li></ul>
<p><span class="font25">Some example combinations on files and directories are seen in this screenshot. The name of the file explains the permissions.</span></p>
<p><span class="font19">paul@laika:~/perms$ ls -Ih</span></p>
<p><span class="font19">total 12K</span></p>
<p><span class="font19">drwxr-xr-x 2 paul paul 4.0K 2007-02-07 22:26 AllEnter_UserCreateDelete</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rwxrwxrwx 1 paul paul &nbsp;&nbsp;&nbsp;0 2007-02-07 22:21 EveryoneFullControl.txt</span></p></li>
<li>
<p><span class="font19">- r--r----- 1 paul paul &nbsp;&nbsp;&nbsp;0 2007-02-07 22:21 OnlyOwnersRead.txt</span></p></li>
<li>
<p><span class="font19">- rwxrwx--- 1 paul paul &nbsp;&nbsp;&nbsp;0 2007-02-07 22:21 OwnersAll_RestNothing.txt</span></p></li></ul>
<p><span class="font19">dr-xr-x--- 2 paul paul 4.0K 2007-02-07 22:25 UserAndGroupEnter</span></p>
<p><span class="font19">dr-x------ 2 paul paul 4.0K 2007-02-07 22:25 OnlyUserEnter</span></p>
<p><span class="font19">paul@laika:~/perms$</span></p>
<p><span class="font25">To summarise, the first </span><span class="font25" style="font-weight:bold;">rwx </span><span class="font25">triplet represents the permissions for the </span><span class="font25" style="font-weight:bold;">user owner</span><span class="font25">. The second triplet corresponds to the </span><span class="font25" style="font-weight:bold;">group owner</span><span class="font25">; it specifies permissions for all members of that group. The third triplet defines permissions for all </span><span class="font25" style="font-weight:bold;">other </span><span class="font25">users that are not the user owner and are not a member of the group owner.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark2725"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2726"></a>32.3.4. setting permissions (chmod)</span></h3></li></ul>
<h4><a name="bookmark2727"></a><span class="font25"><a name="bookmark2728"></a><a name="bookmark2729"></a>Permissions can be changed with </span><span class="font25" style="font-weight:bold;">chmod</span><span class="font25">. The first example gives the user owner execute permissions.</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">paul@laika:~/perms$ ls</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">-l</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">permissions.txt</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-rw-r--r-- 1 paul paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2007-02-07 22:34 permissions.txt</span></p></td></tr>
<tr><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">paul@laika:~/perms$ chmod</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">u+x permissions.txt</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">paul@laika:~/perms$ ls</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-l</span></p></td><td style="vertical-align:top;">
<p><span class="font19">permissions.txt</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-rwxr--r-- 1 paul paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2007-02-07 22:34 permissions.txt</span></p></td></tr>
</table>
<h4><a name="bookmark2730"></a><span class="font25"><a name="bookmark2731"></a>This example removes the group owners read permission.</span></h4>
<p><span class="font19">paul@laika:~/perms$ chmod g-r permissions.txt</span></p>
<p><span class="font19">paul@laika:~/perms$ ls -l permissions.txt</span></p>
<p><span class="font19">-rwx---r-- 1 paul paul 0 2007-02-07 22:34 permissions.txt</span></p>
<h4><a name="bookmark2732"></a><span class="font25"><a name="bookmark2733"></a>This example removes the others read permission.</span></h4>
<p><span class="font19">paul@laika:~/perms$ chmod o-r permissions.txt</span></p>
<p><span class="font19">paul@laika:~/perms$ ls -l permissions.txt</span></p>
<p><span class="font19">-rwx------ 1 paul paul 0 2007-02-07 22:34 permissions.txt</span></p>
<h4><a name="bookmark2734"></a><span class="font25"><a name="bookmark2735"></a>This example gives all of them the write permission.</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">paul@laika:~/perms$ chmod</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">a+w permissions.txt</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">paul@laika:~/perms$ ls -l</span></p></td><td style="vertical-align:top;">
<p><span class="font19">permissions.txt</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-rwx-w--w- 1 paul paul 0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2007-02-07 22:34 permissions.txt</span></p></td></tr>
</table>
<h4><a name="bookmark2736"></a><span class="font25"><a name="bookmark2737"></a>You don't even have to type the a.</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">paul@laika:~/perms$ chmod</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">+x permissions.txt</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">paul@laika:~/perms$ ls -l</span></p></td><td style="vertical-align:top;">
<p><span class="font19">permissions.txt</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-rwx-wx-wx 1 paul paul 0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2007-02-07 22:34 permissions.txt</span></p></td></tr>
</table>
<h4><a name="bookmark2738"></a><span class="font25"><a name="bookmark2739"></a>You can also set explicit permissions.</span></h4>
<p><span class="font19">paul@laika:~/perms$ chmod u=rw permissions.txt</span></p>
<p><span class="font19">paul@laika:~/perms$ ls -l permissions.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw--wx-wx 1 paul paul 0 2007-02-07 22:34 permissions.txt</span></p></li></ul>
<h4><a name="bookmark2740"></a><span class="font25"><a name="bookmark2741"></a>Feel free to make any kind of combination.</span></h4>
<p><span class="font19">paul@laika:~/perms$ chmod u=rw,g=rw,o=r permissions.txt</span></p>
<p><span class="font19">paul@laika:~/perms$ ls -l permissions.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-rw-r-- 1 paul paul 0 2007-02-07 22:34 permissions.txt</span></p></li></ul>
<h4><a name="bookmark2742"></a><span class="font25"><a name="bookmark2743"></a>Even fishy combinations are accepted by chmod.</span></h4>
<p><span class="font19">paul@laika:~/perms$ chmod u=rwx,ug+rw,o=r permissions.txt</span></p>
<p><span class="font19">paul@laika:~/perms$ ls -l permissions.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rwxrw-r-- 1 paul paul 0 2007-02-07 22:34 permissions.txt</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark409"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2744"></a>32.3.5. setting octal permissions</span></h3></li></ul>
<h4><a name="bookmark2745"></a><span class="font25"><a name="bookmark2746"></a><a name="bookmark2747"></a><a name="bookmark2748"></a>Most Unix administrators will use the </span><span class="font25" style="font-weight:bold;">old school </span><span class="font25">octal system to talk about and set permissions. Look at the triplet bitwise, equating r to 4, w to 2, and x to 1.</span></h4>
<p><span class="font25" style="font-weight:bold;">Table 32.4. Octal permissions</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">binary</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">octal</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">permission</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font24">000</span></p></td><td style="vertical-align:middle;">
<p><span class="font24">0</span></p></td><td style="vertical-align:middle;">
<p><span class="font24">---</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">001</span></p></td><td style="vertical-align:top;">
<p><span class="font24">1</span></p></td><td style="vertical-align:top;">
<p><span class="font24">--x</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">010</span></p></td><td style="vertical-align:top;">
<p><span class="font24">2</span></p></td><td style="vertical-align:top;">
<p><span class="font24">-w-</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">011</span></p></td><td style="vertical-align:top;">
<p><span class="font24">3</span></p></td><td style="vertical-align:top;">
<p><span class="font24">-wx</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">100</span></p></td><td style="vertical-align:top;">
<p><span class="font24">4</span></p></td><td style="vertical-align:top;">
<p><span class="font24">r--</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">101</span></p></td><td style="vertical-align:top;">
<p><span class="font24">5</span></p></td><td style="vertical-align:top;">
<p><span class="font24">r-x</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">110</span></p></td><td style="vertical-align:top;">
<p><span class="font24">6</span></p></td><td style="vertical-align:top;">
<p><span class="font24">rw-</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">111</span></p></td><td style="vertical-align:top;">
<p><span class="font24">7</span></p></td><td style="vertical-align:top;">
<p><span class="font24">rwx</span></p></td></tr>
</table>
<h4><a name="bookmark2749"></a><span class="font25"><a name="bookmark2750"></a><a name="bookmark2751"></a><a name="bookmark2752"></a>This makes </span><span class="font25" style="font-weight:bold;">777 </span><span class="font25">equal to rwxrwxrwx and by the same logic, 654 mean rw-r-xr-- . The </span><span class="font25" style="font-weight:bold;">chmod </span><span class="font25">command will accept these numbers.</span></h4>
<p><span class="font19">paul@laika:~/perms$ chmod 777 permissions.txt</span></p>
<p><span class="font19">paul@laika:~/perms$ ls -l permissions.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rwxrwxrwx 1 paul paul 0 2007-02-07 22:34 permissions.txt</span></p></li></ul>
<p><span class="font19">paul@laika:~/perms$ chmod 664 permissions.txt</span></p>
<p><span class="font19">paul@laika:~/perms$ ls -l permissions.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-rw-r-- 1 paul paul 0 2007-02-07 22:34 permissions.txt</span></p></li></ul>
<p><span class="font19">paul@laika:~/perms$ chmod 750 permissions.txt</span></p>
<p><span class="font19">paul@laika:~/perms$ ls -l permissions.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rwxr-x--- 1 paul paul 0 2007-02-07 22:34 permissions.txt</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark2753"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2754"></a>32.3.6. umask</span></h3></li></ul>
<p><a name="bookmark2755"></a><span class="font25">When creating a file or directory, a set of default permissions are applied. These default permissions are determined by the </span><span class="font25" style="font-weight:bold;">umask</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">umask </span><span class="font25">specifies permissions that you do not want set on by default. You can display the </span><span class="font25" style="font-weight:bold;">umask </span><span class="font25">with the </span><span class="font25" style="font-weight:bold;">umask </span><span class="font25">command.</span></p>
<p><span class="font19">[Harry@RHEL4b ~]$ umask 0002</span></p>
<p><span class="font19">[Harry@RHEL4b ~]$ touch test</span></p>
<p><span class="font19">[Harry@RHEL4b ~]$ ls -l test</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-rw-r-- 1 Harry Harry 0 Jul 24 06:03 test</span></p></li></ul>
<p><span class="font19">[Harry@RHEL4b ~]$</span></p>
<p><a name="bookmark2756"></a><span class="font25">As you can also see, the file is also not executable by default. This is a general security feature among Unixes; newly created files are never executable by default. You have to explicitly do a </span><span class="font25" style="font-weight:bold;">chmod +x </span><span class="font25">to make a file executable. This also means that the 1 bit in the </span><span class="font25" style="font-weight:bold;">umask </span><span class="font25">has no meaning--a </span><span class="font25" style="font-weight:bold;">umask </span><span class="font25">of 0022 is the same as 0033.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark2757"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2758"></a>32.3.7. mkdir -m</span></h3></li></ul>
<p><a name="bookmark2759"></a><span class="font25">When creating directories with </span><span class="font25" style="font-weight:bold;">mkdir </span><span class="font25">you can use the </span><span class="font25" style="font-weight:bold;">-m </span><span class="font25">option to set the </span><span class="font25" style="font-weight:bold;">mode</span><span class="font25">. This screenshot explains.</span></p>
<p><span class="font19">paul@debian5~$ mkdir -m 700 MyDir</span></p>
<p><span class="font19">paul@debian5~$ mkdir -m 777 Public</span></p>
<p><span class="font19">paul@debian5~$ ls -dl MyDir/ Public/</span></p>
<p><span class="font19">drwx------ 2 paul paul 4096 2011-10-16 19:16 MyDir/</span></p>
<p><span class="font19">drwxrwxrwx 2 paul paul 4096 2011-10-16 19:16 Public/</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark2760"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2761"></a>32.3.8. cp -p</span></h3></li></ul>
<p><span class="font25">To preserve permissions and time stamps from source files, use </span><span class="font25" style="font-weight:bold;">cp -p</span><span class="font25">.</span></p>
<p><span class="font19">paul@laika:~/perms$ cp file* cp paul@laika:~/perms$ cp -p file* cpp paul@laika:~/perms$ ll *</span></p>
<p><span class="font19">-rwx------ 1 paul paul &nbsp;&nbsp;&nbsp;0 2008-08-25 13:26 file33</span></p>
<p><span class="font19">-rwxr-x &nbsp;1 paul paul &nbsp;&nbsp;&nbsp;0 2008-08-25 13:26 file42</span></p>
<p><span class="font19">cp:</span></p>
<p><span class="font19">total 0</span></p>
<p><span class="font19">-rwx------ 1 paul paul 0 2008-08-25 13:34 file33</span></p>
<p><span class="font19">-rwxr-x &nbsp;1 paul paul 0 2008-08-25 13:34 file42</span></p>
<p><span class="font19">cpp:</span></p>
<p><span class="font19">total 0</span></p>
<p><span class="font19">-rwx------ 1 paul paul 0 2008-08-25 13:26 file33</span></p>
<p><span class="font19">-rwxr-x &nbsp;1 paul paul 0 2008-08-25 13:26 file42</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2762"></a><span class="font10" style="font-weight:bold;"><a name="bookmark347"></a><a name="bookmark2763"></a>32.4. practice: standard file permissions</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. As normal user, create a directory ~/permissions. Create a file owned by yourself in there.</span></p></li>
<li>
<p><span class="font25">2. Copy a file owned by root from /etc/ to your permissions dir, who owns this file now ?</span></p></li>
<li>
<p><span class="font25">3. As root, create a file in the users ~/permissions directory.</span></p></li>
<li>
<p><span class="font25">4. As normal user, look at who owns this file created by root.</span></p></li>
<li>
<p><span class="font25">5. Change the ownership of all files in ~/permissions to yourself.</span></p></li>
<li>
<p><span class="font25">6. Make sure you have all rights to these files, and others can only read.</span></p></li>
<li>
<p><span class="font25">7. With chmod, is 770 the same as rwxrwx--- ?</span></p></li>
<li>
<p><span class="font25">8. With chmod, is 664 the same as r-xr-xr-- ?</span></p></li>
<li>
<p><span class="font25">9. With chmod, is 400 the same as r--------?</span></p></li>
<li>
<p><span class="font25">10. With chmod, is 734 the same as rwxr-xr-- ?</span></p></li></ul>
<p><span class="font25">11a. Display the umask in octal and in symbolic form.</span></p>
<p><span class="font25">11b. Set the umask to 077, but use the symbolic format to set it. Verify that this works.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">12. Create a file as root, give only read to others. Can a normal user read this file ? Test writing to this file with vi.</span></p></li></ul>
<p><span class="font25">13a. Create a file as normal user, give only read to others. Can another normal user read this file ? Test writing to this file with vi.</span></p>
<p><span class="font25">13b. Can root read this file ? Can root write to this file with vi ?</span></p>
<p><span class="font25">14. Create a directory that belongs to a group, where every member of that group can read and write to files, and create files. Make sure that people can only delete their own files.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2764"></a><span class="font10" style="font-weight:bold;"><a name="bookmark348"></a><a name="bookmark2765"></a>32.5. solution: standard file permissions</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. As normal user, create a directory ~/permissions. Create a file owned by yourself in there. </span><span class="font19">mkdir ~/permissions ; touch ~/permissions/myfile.txt</span></p></li>
<li>
<p><span class="font25">2. Copy a file owned by root from /etc/ to your permissions dir, who owns this file now ? </span><span class="font19">cp /etc/hosts ~/permissions/</span></p></li></ul>
<p><span class="font25">The copy is owned by you.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. As root, create a file in the users ~/permissions directory.</span></p></li></ul>
<p><span class="font19">(become root)# touch /home/username/permissions/rootfile</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. As normal user, look at who owns this file created by root.</span></p></li></ul>
<p><span class="font19">ls -l ~/permissions</span></p>
<p><span class="font25">The file created by root is owned by root.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Change the ownership of all files in ~/permissions to yourself.</span></p></li></ul>
<p><span class="font19">chown user ~/permissions/*</span></p>
<p><span class="font25">You cannot become owner of the file that belongs to root.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Make sure you have all rights to these files, and others can only read.</span></p></li></ul>
<p><span class="font19">chmod 644 (on files)</span></p>
<p><span class="font19">chmod 755 (on directories)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. With chmod, is 770 the same as rwxrwx--- ?</span></p></li></ul>
<p><span class="font25">yes</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. With chmod, is 664 the same as r-xr-xr-- ?</span></p></li></ul>
<p><span class="font25">No</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">9. With chmod, is 400 the same as r--------?</span></p></li></ul>
<p><span class="font25">yes</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">10. With chmod, is 734 the same as rwxr-xr-- ?</span></p></li></ul>
<p><span class="font25">no</span></p>
<p><span class="font25">11a. Display the umask in octal and in symbolic form.</span></p>
<p><span class="font19">umask ; umask -S</span></p>
<p><span class="font25">11b. Set the umask to 077, but use the symbolic format to set it. Verify that this works.</span></p>
<p><span class="font19">umask -S u=rwx,go=</span></p>
<p><span class="font25">12. Create a file as root, give only read to others. Can a normal user read this file ? Test writing to this file with vi.</span></p>
<p><span class="font19">(become root)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># echo hello &gt;&nbsp;/home/username/root.txt</span></p></li>
<li>
<p><span class="font19"># chmod 744 /home/username/root.txt</span></p></li></ul>
<p><span class="font19">(become user)</span></p>
<p><span class="font19">vi ~/root.txt</span></p>
<p><span class="font25">13a. Create a file as normal user, give only read to others. Can another normal user read this file ? Test writing to this file with vi.</span></p>
<p><span class="font19">echo hello &gt;&nbsp;file ; chmod 744 file</span></p>
<p><span class="font25">Yes, others can read this file</span></p>
<p><span class="font25">13b. Can root read this file ? Can root write to this file with vi ?</span></p>
<p><span class="font25">Yes, root can read and write to this file. Permissions do not apply to root.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">14. Create a directory that belongs to a group, where every member of that group can read and write to files, and create files. Make sure that people can only delete their own files.</span></p></li></ul>
<p><span class="font19">mkdir /home/project42 ; groupadd project42</span></p>
<p><span class="font19">chgrp project42 /home/project42 ; chmod 775 /home/project42</span></p>
<p><span class="font25">You can not yet do the last part of this exercise...</span></p>
<ul style="list-style:none;"><li>
<p><a name="bookmark2766"></a><span class="font11" style="font-weight:bold;">Chapter 33. advanced file permissions</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2767"></a><span class="font10" style="font-weight:bold;"><a name="bookmark350"></a><a name="bookmark2768"></a>33.1. sticky bit on directory</span></h2></li></ul>
<p><a name="bookmark2769"></a><span class="font25">You can set the </span><span class="font25" style="font-weight:bold;">sticky bit </span><span class="font25">on a directory to prevent users from removing files that they do not own as a user owner. The sticky bit is displayed at the same location as the x permission for others. The sticky bit is represented by a </span><span class="font25" style="font-weight:bold;">t </span><span class="font25">(meaning x is also there) or a </span><span class="font25" style="font-weight:bold;">T </span><span class="font25">(when there is no x for others).</span></p>
<p><span class="font19">root@RHELv4u4:~# mkdir /project55</span></p>
<p><span class="font19">root@RHELv4u4:~# ls -ld /project55</span></p>
<p><span class="font19">drwxr-xr-x 2 root root 4096 Feb 7 17:38 /project55</span></p>
<p><span class="font19">root@RHELv4u4:~# chmod +t /project55/</span></p>
<p><span class="font19">root@RHELv4u4:~# ls -ld /project55</span></p>
<p><span class="font19">drwxr-xr-t 2 root root 4096 Feb 7 17:38 /project55</span></p>
<p><span class="font19">root@RHELv4u4:~#</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">sticky bit </span><span class="font25">can also be set with octal permissions, it is binary 1 in the first of four triplets.</span></p>
<p><span class="font19">root@RHELv4u4:~# chmod 1775 /project55/</span></p>
<p><span class="font19">root@RHELv4u4:~# ls -ld /project55</span></p>
<p><span class="font19">drwxrwxr-t 2 root root 4096 Feb 7 17:38 /project55 root@RHELv4u4:~#</span></p>
<p><a name="bookmark2770"></a><span class="font25">You will typically find the </span><span class="font25" style="font-weight:bold;">sticky bit </span><span class="font25">on the </span><span class="font25" style="font-weight:bold;">/tmp </span><span class="font25">directory.</span></p>
<p><span class="font19">root@barry:~# ls -ld /tmp</span></p>
<p><span class="font19">drwxrwxrwt 6 root root 4096 2009-06-04 19:02 /tmp</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2771"></a><span class="font10" style="font-weight:bold;"><a name="bookmark351"></a><a name="bookmark2772"></a>33.2. setgid bit on directory</span></h2></li></ul>
<p><a name="bookmark2773"></a><span class="font25" style="font-weight:bold;">setgid </span><span class="font25">can be used on directories to make sure that all files inside the directory are owned by the group owner of the directory. The </span><span class="font25" style="font-weight:bold;">setgid </span><span class="font25">bit is displayed at the same location as the x permission for group owner. The </span><span class="font25" style="font-weight:bold;">setgid </span><span class="font25">bit is represented by an </span><span class="font25" style="font-weight:bold;">s </span><span class="font25">(meaning x is also there) or a </span><span class="font25" style="font-weight:bold;">S </span><span class="font25">(when there is no x for the group owner). As this example shows, even though </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">does not belong to the group proj55, the files created by root in /project55 will belong to proj55 since the </span><span class="font25" style="font-weight:bold;">setgid </span><span class="font25">is set.</span></p>
<p><span class="font19">root@RHELv4u4:~# groupadd proj55</span></p>
<p><span class="font19">root@RHELv4u4:~# chown root:proj55 /project55/</span></p>
<p><span class="font19">root@RHELv4u4:~# chmod 2775 /project55/</span></p>
<p><span class="font19">root@RHELv4u4:~# touch /project55/fromroot.txt</span></p>
<p><span class="font19">root@RHELv4u4:~# ls -ld /project55/</span></p>
<p><span class="font19">drwxrwsr-x 2 root proj55 4096 Feb 7 17:45 /project55/</span></p>
<p><span class="font19">root@RHELv4u4:~# ls -l /project55/ total 4</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-r--r-- &nbsp;1 root proj55 0 Feb 7 17:45 fromroot.txt</span></p></li></ul>
<p><span class="font19">root@RHELv4u4:~#</span></p>
<p><a name="bookmark2774"></a><span class="font25"><a name="bookmark2775"></a>You can use the </span><span class="font25" style="font-weight:bold;">find </span><span class="font25">command to find all </span><span class="font25" style="font-weight:bold;">setgid </span><span class="font25">directories.</span></p>
<p><span class="font19">paul@laika:~$ find / -type d -perm -2000 2&gt; /dev/null /var/log/mysql</span></p>
<p><span class="font19">/var/log/news</span></p>
<p><span class="font19">/var/local</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2776"></a><span class="font10" style="font-weight:bold;"><a name="bookmark352"></a><a name="bookmark2777"></a>33.3. setgid and setuid on regular files</span></h2></li></ul>
<p><a name="bookmark2778"></a><span class="font25">These two permissions cause an executable file to be executed with the permissions of the </span><span class="font25" style="font-weight:bold;">file owner </span><span class="font25">instead of the </span><span class="font25" style="font-weight:bold;">executing owner</span><span class="font25">. This means that if any user executes a program that belongs to the </span><span class="font25" style="font-weight:bold;">root user</span><span class="font25">, and the </span><span class="font25" style="font-weight:bold;">setuid </span><span class="font25">bit is set on that program, then the program runs as </span><span class="font25" style="font-weight:bold;">root</span><span class="font25">. This can be dangerous, but sometimes this is good for security.</span></p>
<p><a name="bookmark2779"></a><span class="font25">Take the example of passwords; they are stored in </span><span class="font25" style="font-weight:bold;">/etc/shadow </span><span class="font25">which is only readable by </span><span class="font25" style="font-weight:bold;">root</span><span class="font25">. (The </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">user never needs permissions anyway.)</span></p>
<p><span class="font19">root@RHELv4u4:~# ls -l /etc/shadow</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">—r-------- 1 root root 1260 Jan 21 07:49 /etc/shadow</span></p></li></ul>
<p><a name="bookmark2780"></a><span class="font25">Changing your password requires an update of this file, so how can normal non-root users do this? Let's take a look at the permissions on the </span><span class="font25" style="font-weight:bold;">/usr/bin/passwd</span><span class="font25">.</span></p>
<p><span class="font19">root@RHELv4u4:~# ls -l /usr/bin/passwd</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-r-s--x--x 1 root root 21200 Jun 17 &nbsp;2005 /usr/bin/passwd</span></p></li></ul>
<p><a name="bookmark2781"></a><span class="font25">When running the </span><span class="font25" style="font-weight:bold;">passwd </span><span class="font25">program, you are executing it with </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">credentials.</span></p>
<p><a name="bookmark2782"></a><span class="font25"><a name="bookmark2783"></a>You can use the </span><span class="font25" style="font-weight:bold;">find </span><span class="font25">command to find all </span><span class="font25" style="font-weight:bold;">setuid </span><span class="font25">programs.</span></p>
<p><span class="font19">paul@laika:~$ find /usr/bin -type f -perm -04000</span></p>
<p><span class="font19">/usr/bin/arping</span></p>
<p><span class="font19">/usr/bin/kgrantpty</span></p>
<p><span class="font19">/usr/bin/newgrp</span></p>
<p><span class="font19">/usr/bin/chfn</span></p>
<p><span class="font19">/usr/bin/sudo</span></p>
<p><span class="font19">/usr/bin/fping6</span></p>
<p><span class="font19">/usr/bin/passwd</span></p>
<p><span class="font19">/usr/bin/gpasswd</span></p>
<p><span class="font25">In most cases, setting the </span><span class="font25" style="font-weight:bold;">setuid </span><span class="font25">bit on executables is sufficient. Setting the </span><span class="font25" style="font-weight:bold;">setgid </span><span class="font25">bit will result in these programs to run with the credentials of their group owner.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2784"></a><span class="font10" style="font-weight:bold;"><a name="bookmark353"></a><a name="bookmark2785"></a>33.4. setuid on sudo</span></h2></li></ul>
<p><a name="bookmark2786"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">sudo </span><span class="font25">binary has the </span><span class="font25" style="font-weight:bold;">setuid </span><span class="font25">bit set, so any user can run it with the effective userid of root.</span></p>
<p><span class="font19">paul@rhel65:~$ ls -l $(which sudo) ---s--x--x. 1 root root 123832 Oct 7 &nbsp;2013 /usr/bin/sudo paul@rhel65:~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2787"></a><span class="font10" style="font-weight:bold;"><a name="bookmark354"></a><a name="bookmark2788"></a>33.5. practice: sticky, setuid and setgid bits</span></h2></li></ul>
<p><span class="font25">1a. Set up a directory, owned by the group sports.</span></p>
<p><span class="font25">1b. Members of the sports group should be able to create files in this directory.</span></p>
<p><span class="font25">1c. All files created in this directory should be group-owned by the sports group.</span></p>
<p><span class="font25">1d. Users should be able to delete only their own user-owned files.</span></p>
<p><span class="font25">1e. Test that this works!</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Verify the permissions on </span><span class="font25" style="font-weight:bold;">/usr/bin/passwd</span><span class="font25">. Remove the </span><span class="font25" style="font-weight:bold;">setuid</span><span class="font25">, then try changing your password as a normal user. Reset the permissions back and try again.</span></p></li>
<li>
<p><span class="font25">3. If time permits (or if you are waiting for other students to finish this practice), read about file attributes in the man page of chattr and lsattr. Try setting the i attribute on a file and test that it works.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2789"></a><span class="font10" style="font-weight:bold;"><a name="bookmark355"></a><a name="bookmark2790"></a>33.6. solution: sticky, setuid and setgid bits</span></h2></li></ul>
<p><span class="font25">1a. Set up a directory, owned by the group sports.</span></p>
<p><span class="font19">groupadd sports</span></p>
<p><span class="font19">mkdir /home/sports</span></p>
<p><span class="font19">chown root:sports /home/sports</span></p>
<p><span class="font25">1b. Members of the sports group should be able to create files in this directory.</span></p>
<p><span class="font19">chmod 770 /home/sports</span></p>
<p><span class="font25">1c. All files created in this directory should be group-owned by the sports group.</span></p>
<p><span class="font19">chmod 2770 /home/sports</span></p>
<p><span class="font25">1d. Users should be able to delete only their own user-owned files.</span></p>
<p><span class="font19">chmod +t /home/sports</span></p>
<p><span class="font25">1e. Test that this works!</span></p>
<p><span class="font25">Log in with different users (group members and others and root), create files and watch the permissions. Try changing and deleting files...</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Verify the permissions on </span><span class="font25" style="font-weight:bold;">/usr/bin/passwd</span><span class="font25">. Remove the </span><span class="font25" style="font-weight:bold;">setuid</span><span class="font25">, then try changing your password as a normal user. Reset the permissions back and try again.</span></p></li></ul>
<p><span class="font19">root@deb503:~# ls -l /usr/bin/passwd</span></p>
<p><span class="font19">-rwsr-xr-x 1 root root 31704 2009-11-14 15:41 /usr/bin/passwd root@deb503:~# chmod 755 /usr/bin/passwd root@deb503:~# ls -l /usr/bin/passwd</span></p>
<p><span class="font19">-rwxr-xr-x 1 root root 31704 2009-11-14 15:41 /usr/bin/passwd</span></p>
<p><span class="font25">A normal user cannot change password now.</span></p>
<p><span class="font19">root@deb503:~# chmod 4755 /usr/bin/passwd root@deb503:~# ls -l /usr/bin/passwd</span></p>
<p><span class="font19">-rwsr-xr-x 1 root root 31704 2009-11-14 15:41 /usr/bin/passwd</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. If time permits (or if you are waiting for other students to finish this practice), read about file attributes in the man page of chattr and lsattr. Try setting the i attribute on a file and test that it works.</span></p></li></ul>
<p><span class="font19">paul@laika:~$ sudo su -</span></p>
<p><span class="font19">[sudo] password for paul: root@laika:~# mkdir attr root@laika:~# cd attr/ root@laika:~/attr# touch file42 root@laika:~/attr# lsattr ------------------ ./file42 root@laika:~/attr# chattr +i file42</span></p>
<p><span class="font19">root@laika:~/attr#</span></p>
<p><span class="font19">root@laika:~/attr# rm -rf rm: cannot remove 'file42 root@laika:~/attr# chattr root@laika:~/attr# rm -rf root@laika:~/attr#</span></p>
<div>
<p><span class="font19">lsattr</span></p>
<p><span class="font19">./file42</span></p>
</div><br clear="all">
<p><span class="font19">file42</span></p>
<p><span class="font19">: Operation not permitted</span></p>
<p><span class="font19">-i file42</span></p>
<p><span class="font19">file42</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark2791"></a><span class="font11" style="font-weight:bold;"><a name="bookmark356"></a><a name="bookmark2792"></a>Chapter 34. access control lists</span></h1></li></ul>
<p><span class="font25">Standard Unix permissions might not be enough for some organisations. This chapter introduces </span><span class="font25" style="font-weight:bold;">access control lists </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">acl's </span><span class="font25">to further protect files and directories.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2793"></a><span class="font10" style="font-weight:bold;"><a name="bookmark357"></a><a name="bookmark2794"></a>34.1. acl in /etc/fstab</span></h2></li></ul>
<p><a name="bookmark2795"></a><span class="font25"><a name="bookmark2796"></a><a name="bookmark2797"></a>File systems that support </span><span class="font25" style="font-weight:bold;">access control lists</span><span class="font25">, or </span><span class="font25" style="font-weight:bold;">acls</span><span class="font25">, have to be mounted with the </span><span class="font25" style="font-weight:bold;">acl </span><span class="font25">option listed in </span><span class="font25" style="font-weight:bold;">/etc/fstab</span><span class="font25">. In the example below, you can see that the root file system has </span><span class="font25" style="font-weight:bold;">acl </span><span class="font25">support, whereas /home/data does not.</span></p>
<p><span class="font19">root@laika:~# tail -4 /etc/fstab</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sda1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ext3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">acl,relatime</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdb2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/home/data</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">auto</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">noacl,defaults</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">pasha:/home/r</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/home/pasha</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nfs</span></p></td><td style="vertical-align:top;">
<p><span class="font19">defaults</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">wolf:/srv/data</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/home/wolf</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nfs</span></p></td><td style="vertical-align:top;">
<p><span class="font19">defaults</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2798"></a><span class="font10" style="font-weight:bold;"><a name="bookmark358"></a><a name="bookmark2799"></a>34.2. getfacl</span></h2></li></ul>
<p><a name="bookmark2800"></a><span class="font25"><a name="bookmark2801"></a>Reading </span><span class="font25" style="font-weight:bold;">acls </span><span class="font25">can be done with </span><span class="font25" style="font-weight:bold;">/usr/bin/getfacl</span><span class="font25">. This screenshot shows how to read the </span><span class="font25" style="font-weight:bold;">acl </span><span class="font25">of </span><span class="font25" style="font-weight:bold;">file33 </span><span class="font25">with </span><span class="font25" style="font-weight:bold;">getfacl</span><span class="font25">.</span></p>
<p><span class="font19">paul@laika:~/test$ getfacl file33</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># file: file33</span></p></li>
<li>
<p><span class="font19"># owner: paul</span></p></li>
<li>
<p><span class="font19"># group: paul</span></p></li></ul>
<p><span class="font19">user::rw-</span></p>
<p><span class="font19">group::r--mask::rwx other::r--</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2802"></a><span class="font10" style="font-weight:bold;"><a name="bookmark359"></a><a name="bookmark2803"></a>34.3. setfacl</span></h2></li></ul>
<p><a name="bookmark2804"></a><span class="font25"><a name="bookmark2805"></a>Writing or changing </span><span class="font25" style="font-weight:bold;">acls </span><span class="font25">can be done with </span><span class="font25" style="font-weight:bold;">/usr/bin/setfacl</span><span class="font25">. These screenshots show how to change the </span><span class="font25" style="font-weight:bold;">acl </span><span class="font25">of </span><span class="font25" style="font-weight:bold;">file33 </span><span class="font25">with </span><span class="font25" style="font-weight:bold;">setfacl</span><span class="font25">.</span></p>
<p><span class="font25">First we add </span><span class="font25" style="font-weight:bold;">u</span><span class="font25">ser </span><span class="font25" style="font-weight:bold;">sandra </span><span class="font25">with octal permission </span><span class="font25" style="font-weight:bold;">7 </span><span class="font25">to the </span><span class="font25" style="font-weight:bold;">acl</span><span class="font25">.</span></p>
<p><span class="font19">paul@laika:~/test$ setfacl -m u:sandra:7 file33</span></p>
<p><span class="font25">Then we add the </span><span class="font25" style="font-weight:bold;">g</span><span class="font25">roup tennis with octal permission </span><span class="font25" style="font-weight:bold;">6 </span><span class="font25">to the </span><span class="font25" style="font-weight:bold;">acl </span><span class="font25">of the same file.</span></p>
<p><span class="font19">paul@laika:~/test$ setfacl -m g:tennis:6 file33</span></p>
<p><span class="font25">The result is visible with </span><span class="font25" style="font-weight:bold;">getfacl</span><span class="font25">.</span></p>
<p><span class="font19">paul@laika:~/test$ getfacl file33</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># file: file33</span></p></li>
<li>
<p><span class="font19"># owner: paul # group: paul user::rw-user:sandra:rwx group::r--group:tennis:rw-mask::rwx other::r--</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2806"></a><span class="font10" style="font-weight:bold;"><a name="bookmark360"></a><a name="bookmark2807"></a>34.4. remove an acl entry</span></h2></li></ul>
<h4><a name="bookmark2808"></a><span class="font25"><a name="bookmark2809"></a>The </span><span class="font25" style="font-weight:bold;">-x </span><span class="font25">option of the </span><span class="font25" style="font-weight:bold;">setfacl </span><span class="font25">command will remove an </span><span class="font25" style="font-weight:bold;">acl </span><span class="font25">entry from the targeted file.</span></h4>
<p><span class="font19">paul@laika:~/test$ setfacl -m u:sandra:7 file33 paul@laika:~/test$ getfacl file33 | grep sandra user:sandra:rwx</span></p>
<p><span class="font19">paul@laika:~/test$ setfacl -x sandra file33</span></p>
<p><span class="font19">paul@laika:~/test$ getfacl file33 | grep sandra</span></p>
<h4><a name="bookmark2810"></a><span class="font25"><a name="bookmark2811"></a>Note that omitting the </span><span class="font25" style="font-weight:bold;">u </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">g </span><span class="font25">when defining the </span><span class="font25" style="font-weight:bold;">acl </span><span class="font25">for an account will default it to a user account.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2812"></a><span class="font10" style="font-weight:bold;"><a name="bookmark361"></a><a name="bookmark2813"></a>34.5. remove the complete acl</span></h2></li></ul>
<h4><a name="bookmark2814"></a><span class="font25"><a name="bookmark2815"></a>The </span><span class="font25" style="font-weight:bold;">-b </span><span class="font25">option of the </span><span class="font25" style="font-weight:bold;">setfacl </span><span class="font25">command will remove the </span><span class="font25" style="font-weight:bold;">acl </span><span class="font25">from the targeted file.</span></h4>
<p><span class="font19">paul@laika:~/test$ setfacl -b file33</span></p>
<p><span class="font19">paul@laika:~/test$ getfacl file33</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># file: file33</span></p></li>
<li>
<p><span class="font19"># owner: paul</span></p></li>
<li>
<p><span class="font19"># group: paul</span></p></li></ul>
<p><span class="font19">user::rw-</span></p>
<p><span class="font19">group::r--other::r--</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2816"></a><span class="font10" style="font-weight:bold;"><a name="bookmark362"></a><a name="bookmark2817"></a>34.6. the acl mask</span></h2></li></ul>
<h4><a name="bookmark2818"></a><span class="font25"><a name="bookmark2819"></a>The </span><span class="font25" style="font-weight:bold;">acl mask </span><span class="font25">defines the maximum effective permissions for any entry in the </span><span class="font25" style="font-weight:bold;">acl</span><span class="font25">. This </span><span class="font25" style="font-weight:bold;">mask </span><span class="font25">is calculated every time you execute the </span><span class="font25" style="font-weight:bold;">setfacl </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">chmod </span><span class="font25">commands.</span></h4>
<h4><a name="bookmark2820"></a><span class="font25"><a name="bookmark2821"></a>You can prevent the calculation by using the </span><span class="font25" style="font-weight:bold;">--no-mask </span><span class="font25">switch.</span></h4>
<p><span class="font19">paul@laika:~/test$ setfacl --no-mask -m u:sandra:7 file33 paul@laika:~/test$ getfacl file33</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># file: file33</span></p></li>
<li>
<p><span class="font19"># owner: paul</span></p></li>
<li>
<p><span class="font19"># group: paul</span></p></li></ul>
<p><span class="font19">user::rw-</span></p>
<p><span class="font19">user:sandra:rwx #effective:rw-</span></p>
<p><span class="font19">group::r--</span></p>
<p><span class="font19">mask::rw-</span></p>
<p><span class="font19">other::r--</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2822"></a><span class="font10" style="font-weight:bold;"><a name="bookmark363"></a><a name="bookmark2823"></a>34.7. eiciel</span></h2></li></ul>
<p><a name="bookmark2824"></a><span class="font25"><a name="bookmark2825"></a>Desktop users might want to use </span><span class="font25" style="font-weight:bold;">eiciel </span><span class="font25">to manage </span><span class="font25" style="font-weight:bold;">acls </span><span class="font25">with a graphical tool.</span></p>
<p><span class="font22">Basic Emblems Permissions Open With Notes Access Control List</span></p><img src="linux_guide_files/The Complete Linux Guide-86.jpg" alt="" style="width:362pt;height:156pt;">
<p><span class="font25">You will need to install </span><span class="font25" style="font-weight:bold;">eiciel </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">nautilus-actions </span><span class="font25">to have an extra tab in </span><span class="font25" style="font-weight:bold;">nautilus </span><span class="font25">to manage </span><span class="font25" style="font-weight:bold;">acls</span><span class="font25">.</span></p>
<p><span class="font19">paul@laika:~$ sudo aptitude install eiciel nautilus-actions</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark2826"></a><span class="font11" style="font-weight:bold;"><a name="bookmark2827"></a><a name="bookmark2828"></a>Chapter 35. file links</span></h1></li></ul>
<p><span class="font25">An average computer using Linux has a file system with many </span><span class="font25" style="font-weight:bold;">hard links </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">symbolic links</span><span class="font25">.</span></p>
<p><a name="bookmark2829"></a><span class="font25">To understand links in a file system, you first have to understand what an </span><span class="font25" style="font-weight:bold;">inode </span><span class="font25">is.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2830"></a><span class="font10" style="font-weight:bold;"><a name="bookmark365"></a><a name="bookmark2831"></a>35.1. inodes</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark2832"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2833"></a>35.1.1. inode contents</span></h3></li></ul></li></ul>
<p><span class="font25">An </span><span class="font25" style="font-weight:bold;">inode </span><span class="font25">is a data structure that contains metadata about a file. When the file system stores a new file on the hard disk, it stores not only the contents (data) of the file, but also extra properties like the name of the file, the creation date, its permissions, the owner of the file, and more. All this information (except the name of the file and the contents of the file) is stored in the </span><span class="font25" style="font-weight:bold;">inode </span><span class="font25">of the file.</span></p>
<p><a name="bookmark2834"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">ls -l </span><span class="font25">command will display some of the inode contents, as seen in this screenshot.</span></p>
<p><span class="font19">root@rhel53 ~# ls -ld /home/project42/</span></p>
<p><span class="font19">drwxr-xr-x 4 root pro42 4.0K Mar 27 14:29 /home/project42/</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark2835"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2836"></a>35.1.2. inode table</span></h3></li></ul>
<p><a name="bookmark2837"></a><span class="font25"><a name="bookmark2838"></a><a name="bookmark2839"></a>The </span><span class="font25" style="font-weight:bold;">inode table </span><span class="font25">contains all of the </span><span class="font25" style="font-weight:bold;">inodes </span><span class="font25">and is created when you create the file system (with </span><span class="font25" style="font-weight:bold;">mkfs</span><span class="font25">). You can use the </span><span class="font25" style="font-weight:bold;">df -i </span><span class="font25">command to see how many </span><span class="font25" style="font-weight:bold;">inodes </span><span class="font25">are used and free on mounted file systems.</span></p>
<p><span class="font19">root@rhel53 ~# df -i</span></p>
<p><span class="font19">Filesystem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Inodes lUsed IFree IUse% Mounted on</span></p>
<p><span class="font19">/dev/mapper/VolGroup00-LogVol00</span></p>
<table border="1">
<tr><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">4947968</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">115326</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4832642</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3%</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/hda1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">26104</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">45</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">26059</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1%</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/boot</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">tmpfs</span></p></td><td style="vertical-align:top;">
<p><span class="font19">64417</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">64416</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1%</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/dev/shm</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/sda1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">262144</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2207</span></p></td><td style="vertical-align:top;">
<p><span class="font19">259937</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1%</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/home/project42</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/sdb1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">74400</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5519</span></p></td><td style="vertical-align:top;">
<p><span class="font19">68881</span></p></td><td style="vertical-align:top;">
<p><span class="font19">8%</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/home/project33</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/sdb5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/home/sales</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/sdb6</span></p></td><td style="vertical-align:top;">
<p><span class="font19">100744</span></p></td><td style="vertical-align:top;">
<p><span class="font19">11</span></p></td><td style="vertical-align:top;">
<p><span class="font19">100733</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1%</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/home/research</span></p></td></tr>
</table>
<p><span class="font25">In the </span><span class="font25" style="font-weight:bold;">df -i </span><span class="font25">screenshot above you can see the </span><span class="font25" style="font-weight:bold;">inode </span><span class="font25">usage for several mounted </span><span class="font25" style="font-weight:bold;">file systems</span><span class="font25">.</span></p>
<p><span class="font25">You don't see numbers for </span><span class="font25" style="font-weight:bold;">/dev/sdb5 </span><span class="font25">because it is a </span><span class="font25" style="font-weight:bold;">fat </span><span class="font25">file system.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark2840"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2841"></a>35.1.3. inode number</span></h3></li></ul>
<p><a name="bookmark2842"></a><span class="font25">Each </span><span class="font25" style="font-weight:bold;">inode </span><span class="font25">has a unique number (the inode number). You can see the </span><span class="font25" style="font-weight:bold;">inode </span><span class="font25">numbers with the </span><span class="font25" style="font-weight:bold;">ls -li </span><span class="font25">command.</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ touch file1</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ touch file2</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ touch file3</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ ls -li total 12</span></p>
<p><span class="font19">817266 -rw-rw-r-- &nbsp;1 paul paul 0 Feb &nbsp;5 15:38 file1</span></p>
<p><span class="font19">817267 -rw-rw-r-- &nbsp;1 paul paul 0 Feb &nbsp;5 15:38 file2</span></p>
<p><span class="font19">817268 -rw-rw-r-- &nbsp;1 paul paul 0 Feb &nbsp;5 15:38 file3</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$</span></p>
<p><span class="font25">These three files were created one after the other and got three different </span><span class="font25" style="font-weight:bold;">inodes </span><span class="font25">(the first column). All the information you see with this </span><span class="font25" style="font-weight:bold;">ls </span><span class="font25">command resides in the </span><span class="font25" style="font-weight:bold;">inode</span><span class="font25">, except for the filename (which is contained in the directory).</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark2843"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2844"></a>35.1.4. inode and file contents</span></h3></li></ul>
<p><span class="font25">Let's put some data in one of the files.</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ ls -li total 16</span></p>
<p><span class="font19">817266 -rw-rw-r-- &nbsp;1 paul paul &nbsp;0 Feb &nbsp;5 15:38 filel</span></p>
<p><span class="font19">817270 -rw-rw-r-- &nbsp;1 paul paul 92 Feb &nbsp;5 15:42 file2</span></p>
<p><span class="font19">817268 -rw-rw-r-- &nbsp;1 paul paul &nbsp;0 Feb &nbsp;5 15:38 file3</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ cat file2</span></p>
<p><span class="font19">It is winter now and it is very cold.</span></p>
<p><span class="font19">We do not like the cold, we prefer hot summer nights. paul@RHELv4u4:~/test$</span></p>
<p><span class="font25">The data that is displayed by the </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">command is not in the </span><span class="font25" style="font-weight:bold;">inode</span><span class="font25">, but somewhere else on the disk. The </span><span class="font25" style="font-weight:bold;">inode </span><span class="font25">contains a pointer to that data.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2845"></a><span class="font10" style="font-weight:bold;"><a name="bookmark366"></a><a name="bookmark2846"></a>35.2. about directories</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark2847"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2848"></a>35.2.1. a directory is a table</span></h3></li></ul></li></ul>
<p><a name="bookmark2849"></a><span class="font25"><a name="bookmark2850"></a>A </span><span class="font25" style="font-weight:bold;">directory </span><span class="font25">is a special kind of file that contains a table which maps filenames to inodes. Listing our current directory with </span><span class="font25" style="font-weight:bold;">ls -ali </span><span class="font25">will display the contents of the directory file.</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ ls -ali total 32</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">817262</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">drwxrwxr-x</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15:42 .</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">800768</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">drwx------</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">16</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15:42 ..</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">817266</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">-rw-rw-r--</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15:38 file1</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">817270</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">-rw-rw-r--</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">92</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15:42 file2</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">817268</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-rw-rw-r--</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">15:38 file3</span></p></td></tr>
</table>
<p><span class="font19">paul@RHELv4u4:~/test$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark2851"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2852"></a>35.2.2. . and ..</span></h3></li></ul>
<p><a name="bookmark2853"></a><span class="font25"><a name="bookmark2854"></a>You can see five names, and the mapping to their five inodes. The dot </span><span class="font25" style="font-weight:bold;">. </span><span class="font25">is a mapping to itself, and the dotdot </span><span class="font25" style="font-weight:bold;">.. </span><span class="font25">is a mapping to the parent directory. The three other names are mappings to different inodes.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2855"></a><span class="font10" style="font-weight:bold;"><a name="bookmark367"></a><a name="bookmark2856"></a>35.3. hard links</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark2857"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2858"></a>35.3.1. creating hard links</span></h3></li></ul></li></ul>
<p><a name="bookmark2859"></a><span class="font25"><a name="bookmark2860"></a>When we create a </span><span class="font25" style="font-weight:bold;">hard link </span><span class="font25">to a file with </span><span class="font25" style="font-weight:bold;">ln</span><span class="font25">, an extra entry is added in the directory. A new file name is mapped to an existing inode.</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ ln file2 hardlink_to_file2</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ ls -li total 24</span></p>
<p><span class="font19">817266 -rw-rw-r-- &nbsp;1 paul paul &nbsp;0 Feb &nbsp;5 15:38 filel</span></p>
<p><span class="font19">817270 -rw-rw-r-- &nbsp;2 paul paul 92 Feb &nbsp;5 15:42 file2</span></p>
<p><span class="font19">817268 -rw-rw-r-- &nbsp;1 paul paul &nbsp;0 Feb &nbsp;5 15:38 file3</span></p>
<p><span class="font19">817270 -rw-rw-r-- &nbsp;2 paul paul 92 Feb &nbsp;5 15:42 hardlink_to_file2</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$</span></p>
<p><span class="font25">Both files have the same inode, so they will always have the same permissions and the same owner. Both files will have the same content. Actually, both files are equal now, meaning you can safely remove the original file, the hardlinked file will remain. The inode contains a counter, counting the number of hard links to itself. When the counter drops to zero, then the inode is emptied.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark2861"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2862"></a>35.3.2. finding hard links</span></h3></li></ul>
<p><a name="bookmark2863"></a><span class="font25"><a name="bookmark2864"></a>You can use the </span><span class="font25" style="font-weight:bold;">find </span><span class="font25">command to look for files with a certain inode. The screenshot below shows how to search for all filenames that point to </span><span class="font25" style="font-weight:bold;">inode </span><span class="font25">817270. Remember that an </span><span class="font25" style="font-weight:bold;">inode </span><span class="font25">number is unique to its partition.</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ find / -inum 817270 2&gt; /dev/null</span></p>
<p><span class="font19">/home/paul/test/file2</span></p>
<p><span class="font19">/home/paul/test/hardlink_to_file2</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2865"></a><span class="font10" style="font-weight:bold;"><a name="bookmark368"></a><a name="bookmark2866"></a>35.4. symbolic links</span></h2></li></ul>
<h4><a name="bookmark2867"></a><span class="font25"><a name="bookmark2868"></a><a name="bookmark2869"></a><a name="bookmark2870"></a><a name="bookmark2871"></a>Symbolic links (sometimes called </span><span class="font25" style="font-weight:bold;">soft links</span><span class="font25">) do not link to inodes, but create a name to name mapping. Symbolic links are created with </span><span class="font25" style="font-weight:bold;">ln -s</span><span class="font25">. As you can see below, the </span><span class="font25" style="font-weight:bold;">symbolic link </span><span class="font25">gets an inode of its own.</span></h4>
<p><span class="font19">paul@RHELv4u4:~/test$ ln -s file2 symlink_to_file2</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ ls -li</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">total 32</span></p>
<p><span class="font19">817273 -rw-rw-r-- &nbsp;1 paul paul &nbsp;13 Feb &nbsp;5 17:06</span></p>
<p><span class="font19">817270 -rw-rw-r-- &nbsp;2 paul paul 106 Feb &nbsp;5 17:04</span></p>
<p><span class="font19">817268 -rw-rw-r-- &nbsp;1 paul paul &nbsp;&nbsp;0 Feb &nbsp;5 15:38</span></p>
<p><span class="font19">817270 -rw-rw-r-- &nbsp;2 paul paul 106 Feb &nbsp;5 17:04</span></p>
<p><span class="font19">817267 lrwxrwxrwx &nbsp;1 paul paul &nbsp;&nbsp;5 Feb &nbsp;5 16:55</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">file1</span></p>
<p><span class="font19">file2</span></p>
<p><span class="font19">file3</span></p>
<p><span class="font19">hardlink_to_file2</span></p>
<p><span class="font19">symlink_to_file2 -&gt; file2</span></p></td></tr>
</table>
<h4><a name="bookmark2872"></a><span class="font25"><a name="bookmark2873"></a>Permissions on a symbolic link have no meaning, since the permissions of the target apply. Hard links are limited to their own partition (because they point to an inode), symbolic links can link anywhere (other file systems, even networked).</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2874"></a><span class="font10" style="font-weight:bold;"><a name="bookmark369"></a><a name="bookmark2875"></a>35.5. removing links</span></h2></li></ul>
<h4><a name="bookmark2876"></a><span class="font25"><a name="bookmark2877"></a><a name="bookmark2878"></a>Links can be removed with </span><span class="font25" style="font-weight:bold;">rm</span><span class="font25">.</span></h4>
<p><span class="font19">paul@laika:~$ touch data.txt</span></p>
<p><span class="font19">paul@laika:~$ ln -s data.txt sl_data.txt</span></p>
<p><span class="font19">paul@laika:~$ ln data.txt hl_data.txt</span></p>
<p><span class="font19">paul@laika:~$ rm sl_data.txt</span></p>
<p><span class="font19">paul@laika:~$ rm hl_data.txt</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2879"></a><span class="font10" style="font-weight:bold;"><a name="bookmark370"></a><a name="bookmark2880"></a>35.6. practice : links</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create two files named winter.txt and summer.txt, put some text in them.</span></p></li>
<li>
<p><span class="font25">2. Create a hard link to winter.txt named hlwinter.txt.</span></p></li>
<li>
<p><span class="font25">3. Display the inode numbers of these three files, the hard links should have the same inode.</span></p></li>
<li>
<p><span class="font25">4. Use the find command to list the two hardlinked files</span></p></li>
<li>
<p><span class="font25">5. Everything about a file is in the inode, except two things : name them!</span></p></li>
<li>
<p><span class="font25">6. Create a symbolic link to summer.txt called slsummer.txt.</span></p></li>
<li>
<p><span class="font25">7. Find all files with inode number 2. What does this information tell you ?</span></p></li>
<li>
<p><span class="font25">8. Look at the directories /etc/init.d/ /etc/rc2.d/ /etc/rc3.d/ ... do you see the links ?</span></p></li>
<li>
<p><span class="font25">9. Look in /lib with ls -l...</span></p></li>
<li>
<p><span class="font25">10. Use </span><span class="font25" style="font-weight:bold;">find </span><span class="font25">to look in your home directory for regular files that do not(!) have one hard link.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2881"></a><span class="font10" style="font-weight:bold;"><a name="bookmark371"></a><a name="bookmark2882"></a>35.7. solution : links</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create two files named winter.txt and summer.txt, put some text in them.</span></p></li></ul>
<p><span class="font19">echo cold &gt;&nbsp;winter.txt ; echo hot &gt;&nbsp;summer.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Create a hard link to winter.txt named hlwinter.txt.</span></p></li></ul>
<p><span class="font19">ln winter.txt hlwinter.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Display the inode numbers of these three files, the hard links should have the same inode.</span></p></li></ul>
<p><span class="font19">ls -li winter.txt summer.txt hlwinter.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Use the find command to list the two hardlinked files</span></p></li></ul>
<p><span class="font19">find . -inum xyz #replace xyz with the inode number</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Everything about a file is in the inode, except two things : name them!</span></p></li></ul>
<p><span class="font25">The name of the file is in a directory, and the contents is somewhere on the disk.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Create a symbolic link to summer.txt called slsummer.txt.</span></p></li></ul>
<p><span class="font19">ln -s summer.txt slsummer.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. Find all files with inode number 2. What does this information tell you ?</span></p></li></ul>
<p><span class="font25">It tells you there is more than one inode table (one for every formatted partition + virtual file systems)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. Look at the directories /etc/init.d/ /etc/rc.d/ /etc/rc3.d/ ... do you see the links ?</span></p></li></ul>
<p><span class="font19">ls -l /etc/init.d</span></p>
<p><span class="font19">ls -l /etc/rc2.d</span></p>
<p><span class="font19">ls -l /etc/rc3.d</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">9. Look in /lib with ls -l...</span></p></li></ul>
<p><span class="font19">ls -l /lib</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">10. Use </span><span class="font25" style="font-weight:bold;">find </span><span class="font25">to look in your home directory for regular files that do not(!) have one hard link. </span><span class="font19">find ~ ! -links 1 -type f</span></p></li></ul>
<p><a name="bookmark2883"></a><span class="font11" style="font-weight:bold;">Part X. Appendices</span></p>
<h3><a name="bookmark2884"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2885"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2886"><span class="font24" style="font-weight:bold;">A. keyboard settings </span></a></p></li></ul>
<p><a href="#bookmark2887"><span class="font24">A.1. about keyboard layout </span></a></p>
<p><a href="#bookmark2888"><span class="font24">A.2. X Keyboard Layout </span></a></p>
<p><a href="#bookmark2889"><span class="font24">A.3. shell keyboard layout </span></a></p>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2890"><span class="font24" style="font-weight:bold;">B. hardware </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2891"><span class="font24">B.1. buses </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2892"><span class="font24">B.2. interrupts </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2893"><span class="font24">B.3. io ports </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2894"><span class="font24">B.4. dma </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2895"><span class="font24" style="font-weight:bold;">C. License </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark2896"></a><span class="font11" style="font-weight:bold;"><a name="bookmark2897"></a><a name="bookmark373"></a><a name="bookmark2898"></a>Appendix A. keyboard settings</span></h1></li></ul>
<h2><a name="bookmark374"></a><span class="font10" style="font-weight:bold;"><a name="bookmark2899"></a>A.1. about keyboard layout</span></h2>
<p><span class="font25">Many people (like US-Americans) prefer the default US-qwerty keyboard layout. So when you are not from the USA and want a local keyboard layout on your system, then the best practice is to select this keyboard at installation time. Then the keyboard layout will always be correct. Also, whenever you use ssh to remotely manage a Linux system, your local keyboard layout will be used, independent of the server keyboard configuration. So you will not find much information on changing keyboard layout on the fly on linux, because not many people need it. Below are some tips to help you.</span></p>
<h2><a name="bookmark2900"></a><span class="font10" style="font-weight:bold;"><a name="bookmark375"></a><a name="bookmark2901"></a>A.2. X Keyboard Layout</span></h2>
<p><span class="font25">This is the relevant portion in /etc/X11/xorg.conf, first for Belgian azerty, then for US-qwerty.</span></p>
<p><span class="font19">[paul@RHEL5 ~]$ grep -i xkb /etc/X11/xorg.conf</span></p>
<p><span class="font19">Option &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;XkbModel&quot; &quot;pc105&quot;</span></p>
<p><span class="font19">Option &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;XkbLayout&quot; &quot;be&quot;</span></p>
<p><span class="font19">[paul@RHEL5 ~]$ grep -i xkb /etc/X11/xorg.conf</span></p>
<p><span class="font19">Option &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;XkbModel&quot; &quot;pc105&quot;</span></p>
<p><span class="font19">Option &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;XkbLayout&quot; &quot;us&quot;</span></p>
<p><span class="font25">When in Gnome or KDE or any other graphical environment, look in the graphical menu in preferences, there will be a keyboard section to choose your layout. Use the graphical menu instead of editing xorg.conf.</span></p>
<h2><a name="bookmark2902"></a><span class="font10" style="font-weight:bold;"><a name="bookmark376"></a><a name="bookmark2903"></a>A.3. shell keyboard layout</span></h2>
<p><span class="font25">When in bash, take a look in the /etc/sysconfig/keyboard file. Below a sample US-qwerty configuration, followed by a Belgian azerty configuration.</span></p>
<p><span class="font19">[paul@RHEL5 ~]$ cat /etc/sysconfig/keyboard</span></p>
<p><span class="font19">KEYBOARDTYPE=&quot;pc&quot;</span></p>
<p><span class="font19">KEYTABLE=&quot;us&quot;</span></p>
<p><span class="font19">[paul@RHEL5 ~]$ cat /etc/sysconfig/keyboard KEYBOARDTYPE=&quot;pc&quot; KEYTABLE=&quot;be-latin1&quot;</span></p>
<p><span class="font25">The keymaps themselves can be found in /usr/share/keymaps or /lib/kbd/keymaps.</span></p>
<p><span class="font19">[paul@RHEL5 ~]$ ls -l /lib/kbd/keymaps/ total 52</span></p>
<p><span class="font19">drwxr-xr-x 2 root root 4096 Apr 1 00:14 amiga</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">drwxr-xr-x</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">00:14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">atari</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">drwxr-xr-x</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">8</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">00:14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">i386</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">drwxr-xr-x</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">00:14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">include</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">drwxr-xr-x</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:14</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mac</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">lrwxrwxrwx</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">00:14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ppc -&gt; mac</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">drwxr-xr-x</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:14</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sun</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h1><a name="bookmark2904"></a><span class="font11" style="font-weight:bold;"><a name="bookmark2905"></a><a name="bookmark2906"></a><a name="bookmark2907"></a>Appendix B. hardware</span></h1></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark378"></a><span class="font10" style="font-weight:bold;"><a name="bookmark2908"></a>B.1. buses</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark2909"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2910"></a>B.1.1. about buses</span></h3></li></ul></li></ul>
<p><a name="bookmark2911"></a><span class="font25"><a name="bookmark2912"></a><a name="bookmark2913"></a><a name="bookmark2914"></a><a name="bookmark2915"></a><a name="bookmark2916"></a><a name="bookmark2917"></a>Hardware components communicate with the </span><span class="font25" style="font-weight:bold;">Central Processing Unit </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">c<a name="bookmark2918"></a>pu </span><span class="font25">over a </span><span class="font25" style="font-weight:bold;">bus</span><span class="font25">. The most common buses today are </span><span class="font25" style="font-weight:bold;">usb</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">pci</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">agp</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">pci-express </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">pcmcia </span><span class="font25">aka </span><span class="font25" style="font-weight:bold;">pc-card</span><span class="font25">. These are all </span><span class="font25" style="font-weight:bold;">Plag and Play </span><span class="font25">buses.</span></p>
<p><a name="bookmark2919"></a><span class="font25">Older </span><span class="font25" style="font-weight:bold;">x86 </span><span class="font25">computers often had </span><span class="font25" style="font-weight:bold;">isa </span><span class="font25">buses, which can be configured using </span><span class="font25" style="font-weight:bold;">jumpers </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">dip switches</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark2920"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2921"></a>B.1.2. /proc/bus</span></h3></li></ul>
<p><a name="bookmark2922"></a><span class="font25">To list the buses recognised by the Linux kernel on your computer, look at the contents of the </span><span class="font25" style="font-weight:bold;">/proc/bus/ </span><span class="font25">directory (screenshot from Ubuntu 7.04 and RHEL4u4 below).</span></p>
<p><span class="font19">root@laika:~# ls /proc/bus/</span></p>
<p><span class="font19">input pccard pci usb</span></p>
<p><span class="font19">[root@RHEL4b ~]# ls /proc/bus/ input pci usb</span></p>
<p><span class="font25">Can you guess which of these two screenshots was taken on a laptop ?</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark2923"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2924"></a>B.1.3. /usr/sbin/lsusb</span></h3></li></ul>
<p><a name="bookmark2925"></a><span class="font25"><a name="bookmark2926"></a>To list all the usb devices connected to your system, you could read the contents of </span><span class="font25" style="font-weight:bold;">/proc/ bus/usb/devices </span><span class="font25">(if it exists) or you could use the more readable output of </span><span class="font25" style="font-weight:bold;">lsusb</span><span class="font25">, which is executed here on a SPARC system with Ubuntu.</span></p>
<p><span class="font19">root@shaka:~# lsusb</span></p>
<p><span class="font19">Bus 001 Device 002: ID 0430:0100 Sun Microsystems, Inc. 3-button Mouse</span></p>
<p><span class="font19">Bus 001 Device 003: ID 0430:0005 Sun Microsystems, Inc. Type 6 Keyboard</span></p>
<p><span class="font19">Bus 001 Device 001: ID 04b0:0136 Nikon Corp. Coolpix 7900 (storage)</span></p>
<p><span class="font19">root@shaka:~#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark2927"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2928"></a>B.1.4. /var/lib/usbutils/usb.ids</span></h3></li></ul>
<p><a name="bookmark2929"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">/var/lib/usbutils/usb.ids </span><span class="font25">file contains a gzipped list of all known usb devices.</span></p>
<p><span class="font19">paul@barry:~$ zmore /var/lib/usbutils/usb.ids | head</span></p>
<p><span class="font19">------&gt; /var/lib/usbutils/usb.ids &lt;------</span></p>
<p><span class="font19">#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># List of USB ID's</span></p></li></ul>
<p><span class="font19">#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Maintained by Vojtech Pavlik &lt;</span><a href="mailto:vojtech@suse.cz"><span class="font19">vojtech@suse.cz</span></a><span class="font19">&gt;</span></p></li>
<li>
<p><span class="font23" style="font-style:italic;"># If you</span><span class="font19"> have any new entries, send them to the maintainer.</span></p></li>
<li>
<p><span class="font19"># The latest version can be obtained from</span></p></li>
<li>
<p><span class="font19"># </span><a href="http://www.linux-usb.org/usb.ids"><span class="font19">http://www.linux-usb.org/usb.ids</span></a></p></li></ul>
<p><span class="font19">#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># $Id: usb.ids,v 1.225 2006/07/13 04:18:02 dbrownell Exp $</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark2930"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2931"></a>B.1.5. /usr/sbin/lspci</span></h3></li></ul>
<h4><a name="bookmark2932"></a><span class="font25"><a name="bookmark2933"></a><a name="bookmark2934"></a><a name="bookmark2935"></a>To get a list of all pci devices connected, you could take a look at </span><span class="font25" style="font-weight:bold;">/proc/bus/pci </span><span class="font25">or run </span><span class="font25" style="font-weight:bold;">lspci </span><span class="font25">(partial output below).</span></h4>
<p><span class="font19">paul@laika:~$ lspci</span></p>
<p><span class="font19">00:06.0 FireWire (IEEE 1394): Texas Instruments TSB43AB22/A IEEE-139...</span></p>
<p><span class="font19">00:08.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL-816... 00:09.0 Multimedia controller: Philips Semiconductors SAA7133/SAA713... 00:0a.0 Network controller: RaLink RT2500 802.11g Cardbus/mini-PCI 00:0f.0 RAID bus controller: VIA Technologies, Inc. VIA VT6420 SATA ... 00:0f.1 IDE interface: VIA Technologies, Inc. VT82C586A/B/VT82C686/A... 00:10.0 USB Controller: VIA Technologies, Inc. VT82xxxxx UHCI USB 1.... 00:10.1 USB Controller: VIA Technologies, Inc. VT82xxxxx UHCI USB 1....</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2936"></a><span class="font10" style="font-weight:bold;"><a name="bookmark379"></a><a name="bookmark2937"></a>B.2. interrupts</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark2938"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2939"></a>B.2.1. about interrupts</span></h3></li></ul></li></ul>
<h4><a name="bookmark2940"></a><span class="font25"><a name="bookmark2941"></a><a name="bookmark2942"></a><a name="bookmark2943"></a>An </span><span class="font25" style="font-weight:bold;">interrupt request </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">IRQ </span><span class="font25">is a request from a device to the CPU. A device raises an interrupt when it requires the attention of the CPU (could be because the device has data ready to be read by the CPU).</span></h4>
<h4><a name="bookmark2944"></a><span class="font25"><a name="bookmark2945"></a>Since the introduction of pci, irq's can be shared among devices.</span></h4>
<h4><a name="bookmark2946"></a><span class="font25"><a name="bookmark2947"></a>Interrupt 0 is always reserved for the timer, interrupt 1 for the keyboard. IRQ 2 is used as a channel for IRQ's 8 to 15, and thus is the same as IRQ 9.</span></h4>
<ul style="list-style:none;"><li>
<h3><a name="bookmark2948"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2949"></a>B.2.2. /proc/interrupts</span></h3></li></ul>
<h4><a name="bookmark2950"></a><span class="font25"><a name="bookmark2951"></a><a name="bookmark2952"></a>You can see a listing of interrupts on your system in </span><span class="font25" style="font-weight:bold;">/proc/interrupts</span><span class="font25">.</span></h4>
<p><span class="font19">paul@laika:~$ cat /proc/interrupts</span></p>
<table border="1">
<tr><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">CPU0</span></p></td><td colspan="3" style="vertical-align:bottom;">
<p><span class="font19">CPU1</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">0:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1320048</span></p></td><td style="vertical-align:top;">
<p><span class="font19">555</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IO-APIC-edge</span></p></td><td style="vertical-align:top;">
<p><span class="font19">timer</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">1:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">10224</span></p></td><td style="vertical-align:top;">
<p><span class="font19">7</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IO-APIC-edge</span></p></td><td style="vertical-align:top;">
<p><span class="font19">i8042</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">7:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IO-APIC-edge</span></p></td><td style="vertical-align:top;">
<p><span class="font19">parport0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">8:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IO-APIC-edge</span></p></td><td style="vertical-align:top;">
<p><span class="font19">rtc</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">10:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3062</span></p></td><td style="vertical-align:top;">
<p><span class="font19">21</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IO-APIC-fasteoi</span></p></td><td style="vertical-align:top;">
<p><span class="font19">acpi</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">12:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">131</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IO-APIC-edge</span></p></td><td style="vertical-align:top;">
<p><span class="font19">i8042</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">15:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">47073</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IO-APIC-edge</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ide1</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">18:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IO-APIC-fasteoi</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">yenta</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">19:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">31056</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IO-APIC-fasteoi</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">libata, ohci1394</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">20:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19042</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IO-APIC-fasteoi</span></p></td><td style="vertical-align:top;">
<p><span class="font19">eth0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">21:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">44052</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IO-APIC-fasteoi</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">uhci_hcd:usb1, uhci_hcd:usb2</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">22:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">188352</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IO-APIC-fasteoi</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ra0</span></p></td></tr>
</table>
<p><span class="font19">23: &nbsp;&nbsp;632444 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;lO-APIC-fasteoi &nbsp;&nbsp;nvidia</span></p>
<p><span class="font19">24: &nbsp;&nbsp;&nbsp;&nbsp;1585 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;lO-APIC-fasteoi &nbsp;&nbsp;VIA82XX-MODEM, VIA8237</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark2953"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2954"></a>B.2.3. dmesg</span></h3></li></ul>
<p><a name="bookmark2955"></a><span class="font25">You can also use </span><span class="font25" style="font-weight:bold;">dmesg </span><span class="font25">to find irq's allocated at boot time.</span></p>
<p><span class="font19">paul@laika:~$ dmesg | grep &quot;irq 1[45]&quot;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">[ 28.930069] ata3: PATA max UDMA/133 cmd 0x1f0 ctl 0x3f6 bmdma 0x2090 irq 14</span></p></li>
<li>
<p><span class="font19">[ 28.930071] ata4: PATA max UDMA/133 cmd 0x170 ctl 0x376 bmdma 0x2098 irq 15</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2956"></a><span class="font10" style="font-weight:bold;"><a name="bookmark380"></a><a name="bookmark2957"></a>B.3. io ports</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark2958"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2959"></a>B.3.1. about io ports</span></h3></li></ul></li></ul>
<p><a name="bookmark2960"></a><span class="font25">Communication in the other direction, from CPU to device, happens through </span><span class="font25" style="font-weight:bold;">IO ports</span><span class="font25">. The CPU writes data or control codes to the IO port of the device. But this is not only a one way communication, the CPU can also use a device's IO port to read status information about the device. Unlike interrupts, ports cannot be shared!</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark2961"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2962"></a>B.3.2. /proc/ioports</span></h3></li></ul>
<p><a name="bookmark2963"></a><span class="font25">You can see a listing of your system's IO ports via </span><span class="font25" style="font-weight:bold;">/proc/ioports</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL4b ~]# cat /proc/ioports</span></p>
<div style="border-right:solid;">
<p><span class="font19">0000-001f 0020-0021 0040-0043 0050-0053 0060-006f 0070-0077 0080-008f 00a0-00a1 00c0-00df</span></p>
<p><span class="font19">00f0-00ff</span></p>
<p><span class="font19">0170-0177</span></p>
<p><span class="font19">02f8-02ff</span></p>
</div><br clear="all">
<p><span class="font19">dma1</span></p>
<p><span class="font19">pic1</span></p>
<p><span class="font19">timer0</span></p>
<p><span class="font19">timer1</span></p>
<p><span class="font19">keyboard rtc</span></p>
<p><span class="font19">dma page reg</span></p>
<p><span class="font19">pic2</span></p>
<p><span class="font19">dma2 fpu ide1 serial</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark2964"></a><span class="font10" style="font-weight:bold;"><a name="bookmark381"></a><a name="bookmark2965"></a>B.4. dma</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark2966"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2967"></a>B.4.1. about dma</span></h3></li></ul></li></ul>
<p><a name="bookmark2968"></a><span class="font25">A device that needs a lot of data, interrupts and ports can pose a heavy load on the cpu. With </span><span class="font25" style="font-weight:bold;">dma </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">Direct Memory Access </span><span class="font25">a device can gain (temporary) access to a specific range of the </span><span class="font25" style="font-weight:bold;">ram </span><span class="font25">memory.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark2969"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2970"></a>B.4.2. /proc/dma</span></h3></li></ul>
<p><a name="bookmark2971"></a><span class="font25">Looking at </span><span class="font25" style="font-weight:bold;">/proc/dma </span><span class="font25">might not give you the information that you want, since it only contains currently assigned </span><span class="font25" style="font-weight:bold;">dma </span><span class="font25">channels for </span><span class="font25" style="font-weight:bold;">isa </span><span class="font25">devices.</span></p>
<p><span class="font19">root@laika:~# cat /proc/dma</span></p>
<p><span class="font19">1: parportO</span></p>
<p><span class="font19">4: cascade</span></p>
<h4><a name="bookmark2972"></a><span class="font25" style="font-weight:bold;"><a name="bookmark2973"></a><a name="bookmark2974"></a>pci </span><span class="font25">devices that are using dma are not listed in </span><span class="font25" style="font-weight:bold;">/proc/dma</span><span class="font25">, in this case </span><span class="font25" style="font-weight:bold;">dmesg </span><span class="font25">can be useful. The screenshot below shows that during boot the parallel port received dma channel 1, and the Infrared port received dma channel 3.</span></h4>
<p><span class="font19">root@laika:~# dmesg | egrep -C 1 'dma 1|dma 3'</span></p>
<p><span class="font19">[ &nbsp;&nbsp;20.576000] parport: PnPBIOS parport detected.</span></p>
<p><span class="font19">[ &nbsp;&nbsp;20.580000] parport0: PC-style at 0x378 (0x778), irq 7, dma 1...</span></p>
<p><span class="font19">[ &nbsp;&nbsp;20.764000] irda_init()</span></p>
<p><span class="font19">—</span></p>
<p><span class="font19">[ &nbsp;&nbsp;21.204000] pnp: Device 00:0b activated.</span></p>
<p><span class="font19">[ &nbsp;&nbsp;21.204000] nsc_ircc_pnp_probe() : From PnP, found firbase 0x2F8...</span></p>
<p><span class="font19">[ &nbsp;&nbsp;21.204000] nsc-ircc, chip-&gt;init</span></p>
<h1><a name="bookmark2975"></a><span class="font11" style="font-weight:bold;"><a name="bookmark2976"></a><a name="bookmark2977"></a>Appendix C. License</span></h1>
<p><span class="font19">GNU Free Documentation License</span></p>
<p><span class="font19">Version 1.3, 3 November 2008</span></p>
<p><span class="font19">Copyright © 2000, 2001, 2002, 2007, 2008 Free Software Foundation, Inc.</span></p>
<p><span class="font19">Everyone is permitted to copy and distribute verbatim copies of this license document, but changing it is not allowed.</span></p>
<p><span class="font19">0. PREAMBLE</span></p>
<p><span class="font19">The purpose of this License is to make a manual, textbook, or other functional and useful document &quot;free&quot; in the sense of freedom: to assure everyone the effective freedom to copy and redistribute it, with or without modifying it, either commercially or noncommercially. Secondarily, this License preserves for the author and publisher a way to get credit for their work, while not being considered responsible for modifications made by others.</span></p>
<p><span class="font19">This License is a kind of &quot;copyleft&quot;, which means that derivative works of the document must themselves be free in the same sense. It complements the GNU General Public License, which is a copyleft license designed for free software.</span></p>
<p><span class="font19">We have designed this License in order to use it for manuals for free software, because free software needs free documentation: a free program should come with manuals providing the same freedoms that the software does. But this License is not limited to software manuals; it can be used for any textual work, regardless of subject matter or whether it is published as a printed book. We recommend this License principally for works whose purpose is instruction or reference.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">1. APPLICABILITY AND DEFINITIONS</span></p></li></ul>
<p><span class="font19">This License applies to any manual or other work, in any medium, that contains a notice placed by the copyright holder saying it can be distributed under the terms of this License. Such a notice grants a world-wide, royalty-free license, unlimited in duration, to use that work under the conditions stated herein. The &quot;Document&quot;, below, refers to any such manual or work. Any member of the public is a licensee, and is addressed as &quot;you&quot;. You accept the license if you copy, modify or distribute the work in a way requiring permission under copyright law.</span></p>
<p><span class="font19">A &quot;Modified Version&quot; of the Document means any work containing the Document or a portion of it, either copied verbatim, or with modifications and/or translated into another language.</span></p>
<p><span class="font19">A &quot;Secondary Section&quot; is a named appendix or a front-matter section of the Document that deals exclusively with the relationship of the publishers or authors of the Document to the Document's overall subject (or to related matters) and contains nothing that could fall directly within that overall subject. (Thus, if the Document is in part a textbook of mathematics, a Secondary Section may not explain any mathematics.) The relationship could be a matter of historical connection with the subject or with related matters, or of legal, commercial, philosophical, ethical or political position regarding them.</span></p>
<p><span class="font19">The &quot;Invariant Sections&quot; are certain Secondary Sections whose titles are designated, as being those of Invariant Sections, in the notice that says that the Document is released under this License. If a section does not fit the above definition of Secondary then it is not allowed to be designated as Invariant. The Document may contain zero Invariant Sections. If the Document does not identify any Invariant Sections then there are none.</span></p>
<p><span class="font19">The &quot;Cover Texts&quot; are certain short passages of text that are listed, as Front-Cover Texts or Back-Cover Texts, in the notice that says that the Document is released under this License. A Front-Cover Text may be at most 5 words, and a Back-Cover Text may be at most 25 words.</span></p>
<p><span class="font19">A &quot;Transparent&quot; copy of the Document means a machine-readable copy, represented in a format whose specification is available to the general public, that is suitable for revising the document straightforwardly with generic text editors or (for images composed of pixels) generic paint programs or (for drawings) some widely available drawing editor, and that is suitable for input to text formatters or for automatic translation to a variety of formats suitable for input to text formatters. A copy made in an otherwise Transparent file format whose markup, or absence of markup, has been arranged to thwart or discourage subsequent modification by readers is not Transparent. An image format is not Transparent if used for any substantial amount of text. A copy that is not &quot;Transparent&quot; is called &quot;Opaque&quot;.</span></p>
<p><span class="font19">Examples of suitable formats for Transparent copies include plain ASCII without markup, Texinfo input format, LaTeX input format, SGML or XML using a publicly available DTD, and standard-conforming simple HTML, PostScript or PDF designed for human modification. Examples of transparent image formats include PNG, XCF and JPG. Opaque formats include proprietary formats that can be read and edited only by proprietary word processors, SGML or XML for which the DTD and/or processing tools are not generally available, and the machine-generated HTML, PostScript or PDF produced by some word processors for output purposes only.</span></p>
<p><span class="font19">The &quot;Title Page&quot; means, for a printed book, the title page itself, plus such following pages as are needed to hold, legibly, the material this License requires to appear in the title page. For works in formats which do not have any title page as such, &quot;Title Page&quot; means the text near the most prominent appearance of the work's title, preceding the beginning of the body of the text.</span></p>
<p><span class="font19">The &quot;publisher&quot; means any person or entity that distributes copies of the Document to the public.</span></p>
<p><span class="font19">A section &quot;Entitled XYZ&quot; means a named subunit of the Document whose title either is precisely XYZ or contains XYZ in parentheses following text that translates XYZ in another language. (Here XYZ stands for a specific section name mentioned below, such as &quot;Acknowledgements&quot;, &quot;Dedications&quot;, &quot;Endorsements&quot;, or &quot;History&quot;.) To &quot;Preserve the Title&quot; of such a section when you modify the Document means that it remains a section &quot;Entitled XYZ&quot; according to this definition.</span></p>
<p><span class="font19">The Document may include Warranty Disclaimers next to the notice which states that this License applies to the Document. These Warranty Disclaimers are considered to be included by reference in this License, but only as regards disclaiming warranties: any other implication that these Warranty Disclaimers may have is void and has no effect on the meaning of this License.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">2. VERBATIM COPYING</span></p></li></ul>
<p><span class="font19">You may copy and distribute the Document in any medium, either commercially or noncommercially, provided that this License, the copyright notices, and the license notice saying this License applies to the Document are reproduced in all copies, and that you add no other conditions whatsoever to those of this License. You may not use technical measures to obstruct or control the reading or further copying of the copies you make or distribute. However, you may accept compensation in exchange for copies. If you distribute a large enough number of copies you must also follow the conditions in section 3.</span></p>
<p><span class="font19">You may also lend copies, under the same conditions stated above, and you may publicly display copies.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">3. COPYING IN QUANTITY</span></p></li></ul>
<p><span class="font19">If you publish printed copies (or copies in media that commonly have printed covers) of the Document, numbering more than 100, and the Document's license notice requires Cover Texts, you must enclose the copies in covers that carry, clearly and legibly, all these Cover Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on the back cover. Both covers must also clearly and legibly identify you as the publisher of these copies. The front cover must present the full title with all words of the title equally prominent and visible. You may add other material on the covers in addition. Copying with changes limited to the covers, as long as they preserve the title of the Document and satisfy these conditions, can be treated as verbatim copying in other respects.</span></p>
<p><span class="font19">If the required texts for either cover are too voluminous to fit legibly, you should put the first ones listed (as many as fit reasonably) on the actual cover, and continue the rest onto adjacent pages.</span></p>
<p><span class="font19">If you publish or distribute Opaque copies of the Document numbering more than 100, you must either include a machine-readable Transparent copy along with each Opaque copy, or state in or with each Opaque copy a computer-network location from which the general network-using public has access to download using public-standard network protocols a complete Transparent copy of the Document, free of added material. If you use the latter option, you must take reasonably prudent steps, when you begin distribution of Opaque copies in quantity, to ensure that this Transparent copy will remain thus accessible at the stated location until at least one year after the last time you distribute an Opaque copy (directly or through your agents or retailers) of that edition to the public.</span></p>
<p><span class="font19">It is requested, but not required, that you contact the authors of the Document well before redistributing any large number of copies, to give them a chance to provide you with an updated version of the Document.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">4. MODIFICATIONS</span></p></li></ul>
<p><span class="font19">You may copy and distribute a Modified Version of the Document under the conditions of sections 2 and 3 above, provided that you release the Modified Version under precisely this License, with the Modified Version filling the role of the Document, thus licensing distribution and modification of the Modified Version to whoever possesses a copy of it. In addition, you must do these things in the Modified Version:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">* A. Use in the Title Page (and on the covers, if any) a title distinct from that of the Document, and from those of previous versions (which should, if there were any, be listed in the History section of the Document). You may use the same title as a previous version if the original publisher of that version gives permission.</span></p></li>
<li>
<p><span class="font19">* B. List on the Title Page, as authors, one or more persons or entities responsible for authorship of the modifications in the Modified Version, together with at least five of the principal authors of the Document (all of its principal authors, if it has fewer than five), unless they release you from this requirement.</span></p></li>
<li>
<p><span class="font19">* C. State on the Title page the name of the publisher of the Modified Version, as the publisher.</span></p></li>
<li>
<p><span class="font19">* D. Preserve all the copyright notices of the Document.</span></p></li>
<li>
<p><span class="font19">* E. Add an appropriate copyright notice for your modifications adjacent to the other copyright notices.</span></p></li>
<li>
<p><span class="font19">* F. Include, immediately after the copyright notices, a license notice giving the public permission to use the Modified Version under the terms of this License, in the form shown in the Addendum below.</span></p></li>
<li>
<p><span class="font19">* G. Preserve in that license notice the full lists of Invariant Sections and required Cover Texts given in the Document's license notice.</span></p></li>
<li>
<p><span class="font19">* H. Include an unaltered copy of this License.</span></p></li>
<li>
<p><span class="font19">* I. Preserve the section Entitled &quot;History&quot;, Preserve its Title, and add to it an item stating at least the title, year, new authors, and publisher of the Modified Version as given on the Title Page. If there is no section Entitled &quot;History&quot; in the Document, create one stating the title, year, authors, and publisher of the Document as given on its Title Page, then add an item describing the Modified Version as stated in the previous sentence.</span></p></li>
<li>
<p><span class="font19">* J. Preserve the network location, if any, given in the Document for public access to a Transparent copy of the Document, and likewise the network locations given in the Document for previous versions it was based on. These may be placed in the &quot;History&quot; section. You may omit a network location for a work that was published at least four years before the Document itself, or if the original publisher of the version it refers to gives permission.</span></p></li>
<li>
<p><span class="font19">* K. For any section Entitled &quot;Acknowledgements&quot; or &quot;Dedications&quot;, Preserve the Title of the section, and preserve in the section all the substance and tone of each of the contributor acknowledgements and/or dedications given therein.</span></p></li>
<li>
<p><span class="font19">* L. Preserve all the Invariant Sections of the Document, unaltered in their text and in their titles. Section numbers or the equivalent are not considered part of the section titles.</span></p></li>
<li>
<p><span class="font19">* M. Delete any section Entitled &quot;Endorsements&quot;. Such a section may not be included in the Modified Version.</span></p></li>
<li>
<p><span class="font19">* N. Do not retitle any existing section to be Entitled &quot;Endorsements&quot; or to conflict in title with any Invariant Section.</span></p></li>
<li>
<p><span class="font19">* O. Preserve any Warranty Disclaimers.</span></p></li></ul>
<p><span class="font19">If the Modified Version includes new front-matter sections or appendices that qualify as Secondary Sections and contain no material copied from the Document, you may at your option designate some or all of these sections as invariant. To do this, add their titles to the list of Invariant Sections in the Modified Version's license notice. These titles must be distinct from any other section titles.</span></p>
<p><span class="font19">You may add a section Entitled &quot;Endorsements&quot;, provided it contains nothing but endorsements of your Modified Version by various parties—for example, statements of peer review or that the text has been approved by an organization as the authoritative definition of a standard.</span></p>
<p><span class="font19">You may add a passage of up to five words as a Front-Cover Text, and a passage of up to 25 words as a Back-Cover Text, to the end of the list of Cover Texts in the Modified Version. Only one passage of Front-Cover Text and one of Back-Cover Text may be added by (or through arrangements made by) any one entity. If the Document already includes a cover text for the same cover, previously added by you or by arrangement made by the same entity you are acting on behalf of, you may not add another; but you may replace the old one, on explicit permission from the previous publisher that added the old one.</span></p>
<p><span class="font19">The author(s) and publisher(s) of the Document do not by this License give permission to use their names for publicity for or to assert or imply endorsement of any Modified Version.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">5. COMBINING DOCUMENTS</span></p></li></ul>
<p><span class="font19">You may combine the Document with other documents released under this License, under the terms defined in section 4 above for modified versions, provided that you include in the combination all of the Invariant Sections of all of the original documents, unmodified, and list them all as Invariant Sections of your combined work in its license notice, and that you preserve all their Warranty Disclaimers.</span></p>
<p><span class="font19">The combined work need only contain one copy of this License, and multiple identical Invariant Sections may be replaced with a single copy. If there are multiple Invariant Sections with the same name but different contents, make the title of each such section unique by adding at the end of it, in parentheses, the name of the original author or publisher of that section if known, or else a unique number. Make the same adjustment to the section titles in the list of Invariant Sections in the license notice of the combined work.</span></p>
<p><span class="font19">In the combination, you must combine any sections Entitled &quot;History&quot; in the various original documents, forming one section Entitled &quot;History&quot;; likewise combine any sections Entitled &quot;Acknowledgements&quot;, and any sections Entitled &quot;Dedications&quot;. You must delete all sections Entitled &quot;Endorsements&quot;.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">6. COLLECTIONS OF DOCUMENTS</span></p></li></ul>
<p><span class="font19">You may make a collection consisting of the Document and other documents released under this License, and replace the individual copies of this License in the various documents with a single copy that is included in the collection, provided that you follow the rules of this License for verbatim copying of each of the documents in all other respects.</span></p>
<p><span class="font19">You may extract a single document from such a collection, and distribute it individually under this License, provided you insert a copy of this License into the extracted document, and follow this License in all other respects regarding verbatim copying of that document.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">7. AGGREGATION WITH INDEPENDENT WORKS</span></p></li></ul>
<p><span class="font19">A compilation of the Document or its derivatives with other separate and independent documents or works, in or on a volume of a storage or distribution medium, is called an &quot;aggregate&quot; if the copyright resulting from the compilation is not used to limit the legal rights of the compilation's users beyond what the individual works permit. When the Document is included in an aggregate, this License does not apply to the other works in the aggregate which are not themselves derivative works of the Document.</span></p>
<p><span class="font19">If the Cover Text requirement of section 3 is applicable to these copies of the Document, then if the Document is less than one half of the entire aggregate, the Document's Cover Texts may be placed on covers that bracket the Document within the aggregate, or the electronic equivalent of covers if the Document is in electronic form. Otherwise they must appear on printed covers that bracket the whole aggregate.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">8. TRANSLATION</span></p></li></ul>
<p><span class="font19">Translation is considered a kind of modification, so you may distribute translations of the Document under the terms of section 4. Replacing Invariant Sections with translations requires special permission from their copyright holders, but you may include translations of some or all Invariant Sections in addition to the original versions of these Invariant Sections. You may include a translation of this License, and all the license notices in the Document, and any Warranty Disclaimers, provided that you also include the original English version of this License and the original versions of those notices and disclaimers. In case of a disagreement between the translation and the original version of this License or a notice or disclaimer, the original version will prevail.</span></p>
<p><span class="font19">If a section in the Document is Entitled &quot;Acknowledgements&quot;, &quot;Dedications&quot;, or &quot;History&quot;, the requirement (section 4) to Preserve its Title (section 1) will typically require changing the actual title.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">9. TERMINATION</span></p></li></ul>
<p><span class="font19">You may not copy, modify, sublicense, or distribute the Document except as expressly provided under this License. Any attempt otherwise to copy, modify, sublicense, or distribute it is void, and will automatically terminate your rights under this License.</span></p>
<p><span class="font19">However, if you cease all violation of this License, then your license from a particular copyright holder is reinstated (a) provisionally, unless and until the copyright holder explicitly and finally terminates your license, and (b) permanently, if the copyright holder fails to notify you of the violation by some reasonable means prior to 60 days after the cessation.</span></p>
<p><span class="font19">Moreover, your license from a particular copyright holder is reinstated permanently if the copyright holder notifies you of the violation by some reasonable means, this is the first time you have received notice of violation of this License (for any work) from that copyright holder, and you cure the violation prior to 30 days after your receipt of the notice.</span></p>
<p><span class="font19">Termination of your rights under this section does not terminate the licenses of parties who have received copies or rights from you under this License. If your rights have been terminated and not permanently reinstated, receipt of a copy of some or all of the same material does not give you any rights to use it.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">10. FUTURE REVISIONS OF THIS LICENSE</span></p></li></ul>
<p><span class="font19">The Free Software Foundation may publish new, revised versions of the GNU Free Documentation License from time to time. Such new versions will be similar in spirit to the present version, but may differ in detail to address new problems or concerns. See </span><a href="http://www.gnu.org/copyleft/"><span class="font19">http://www.gnu.org/copyleft/</span></a><span class="font19">.</span></p>
<p><span class="font19">Each version of the License is given a distinguishing version number. If the Document specifies that a particular numbered version of this License &quot;or any later version&quot; applies to it, you have the option of following the terms and conditions either of that specified version or of any later version that has been published (not as a draft) by the Free Software Foundation. If the Document does not specify a version number of this License, you may choose any version ever published (not as a draft) by the Free Software Foundation. If the Document specifies that a proxy can decide which future versions of this License can be used, that proxy's public statement of acceptance of a version permanently authorizes you to choose that version for the Document.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">11. RELICENSING</span></p></li></ul>
<p><span class="font19">&quot;Massive Multiauthor Collaboration Site&quot; (or &quot;MMC Site&quot;) means any World Wide Web server that publishes copyrightable works and also provides prominent facilities for anybody to edit those works. A public wiki that anybody can edit is an example of such a server. A &quot;Massive Multiauthor Collaboration&quot; (or &quot;MMC&quot;) contained in the site means any set of copyrightable works thus published on the MMC site.</span></p>
<p><span class="font19">&quot;CC-BY-SA&quot; means the Creative Commons Attribution-Share Alike 3.0 license published by Creative Commons Corporation, a not-for-profit corporation with a principal place of business in San Francisco, California, as well as future copyleft versions of that license published by that same organization.</span></p>
<p><span class="font19">&quot;Incorporate&quot; means to publish or republish a Document, in whole or in part, as part of another Document.</span></p>
<p><span class="font19">An MMC is &quot;eligible for relicensing&quot; if it is licensed under this License, and if all works that were first published under this License somewhere other than this MMC, and subsequently incorporated in whole or in part into the MMC, (1) had no cover texts or invariant sections, and (2) were thus incorporated prior to November 1, 2008.</span></p>
<p><span class="font19">The operator of an MMC Site may republish an MMC contained in the site under CC-BY-SA on the same site at any time before August 1, 2009, provided the MMC is eligible for relicensing.</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><a name="bookmark2978"></a><span class="font11" style="font-weight:bold;">Index</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">/lib32,</span><a href="#bookmark1052"><span class="font24"> 104</span></a></p>
<p><span class="font24">/lib64,</span><a href="#bookmark1053"><span class="font24"> 104</span></a></p>
<p><span class="font24">/media,</span><a href="#bookmark1102"><span class="font24"> 107</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">Symbols</span></p>
<p><span class="font24">; (shell),</span><a href="#bookmark1362"><span class="font24"> 136</span></a></p>
<p><span class="font24">!! (shell),</span><a href="#bookmark1470"><span class="font24"> 156</span></a></p>
<p><span class="font24">! (bash history),</span><a href="#bookmark1478"><span class="font24"> 156</span></a></p>
<p><span class="font24">! (file globbing),</span><a href="#bookmark1522"><span class="font24"> 163</span></a></p>
<p><span class="font24">? (file globbing),</span><a href="#bookmark1516"><span class="font24"> 162</span></a></p>
<p><span class="font24">/, </span><a href="#bookmark820"><span class="font24">76</span></a><span class="font24">,</span><a href="#bookmark1031"><span class="font24"> 102</span></a></p>
<p><span class="font24">/bin,</span><a href="#bookmark1038"><span class="font24"> 103</span></a><span class="font24">,</span><a href="#bookmark1320"><span class="font24"> 128</span></a></p>
<p><span class="font24">/bin/bash,</span><a href="#bookmark1292"><span class="font24"> 125</span></a><span class="font24">, </span><a href="#bookmark2559"><span class="font24">292</span></a></p>
<p><span class="font24">/bin/cat,</span><a href="#bookmark1039"><span class="font24"> 103</span></a></p>
<p><span class="font24">/bin/csh,</span><a href="#bookmark1293"><span class="font24"> 125</span></a></p>
<p><span class="font24">/bin/date,</span><a href="#bookmark1040"><span class="font24"> 103</span></a></p>
<p><span class="font24">/bin/ksh,</span><a href="#bookmark1294"><span class="font24"> 125</span></a><span class="font24">,</span><a href="#bookmark2560"><span class="font24"> 292</span></a></p>
<p><span class="font24">/bin/rm,</span><a href="#bookmark1341"><span class="font24"> 129</span></a></p>
<p><span class="font24">/bin/sh,</span><a href="#bookmark1295"><span class="font24"> 125</span></a></p>
<p><span class="font24">/boot,</span><a href="#bookmark1064"><span class="font24"> 105</span></a></p>
<p><span class="font24">/boot/grub,</span><a href="#bookmark1065"><span class="font24"> 105</span></a></p>
<p><span class="font24">/boot/grub/grub.cfg,</span><a href="#bookmark1067"><span class="font24"> 105</span></a></p>
<p><span class="font24">/boot/grub/grub.conf,</span><a href="#bookmark1066"><span class="font24"> 105</span></a></p>
<p><span class="font24">/dev,</span><a href="#bookmark880"><span class="font24"> 85</span></a><span class="font24">,</span><a href="#bookmark1112"><span class="font24"> 109</span></a></p>
<p><span class="font24">/dev/null,</span><a href="#bookmark1115"><span class="font24"> 109</span></a><span class="font24">,</span><a href="#bookmark1631"><span class="font24"> 175</span></a></p>
<p><span class="font24">/dev/pts/1,</span><a href="#bookmark1113"><span class="font24"> 109</span></a></p>
<p><span class="font24">/dev/random,</span><a href="#bookmark1217"><span class="font24"> 120</span></a></p>
<p><span class="font24">/dev/tty1,</span><a href="#bookmark1114"><span class="font24"> 109</span></a></p>
<p><span class="font24">/dev/urandom,</span><a href="#bookmark1213"><span class="font24"> 119</span></a><span class="font24">,</span><a href="#bookmark1221"><span class="font24"> 121</span></a></p>
<p><span class="font24">/dev/zero,</span><a href="#bookmark1216"><span class="font24"> 120</span></a></p>
<p><span class="font24">/etc,</span><a href="#bookmark1070"><span class="font24"> 105</span></a></p>
<p><span class="font24">/etc/bashrc,</span><a href="#bookmark2575"><span class="font24"> 293</span></a></p>
<p><span class="font24">/etc/default/useradd,</span><a href="#bookmark2451"><span class="font24"> 276</span></a></p>
<p><span class="font24">/etc/fstab, </span><a href="#bookmark2795"><span class="font24">326</span></a></p>
<p><span class="font24">/etc/group, </span><a href="#bookmark2605"><span class="font24">299</span></a><span class="font24">,</span><a href="#bookmark2692"><span class="font24"> 308</span></a></p>
<p><span class="font24">/etc/gshadow,</span><a href="#bookmark2635"><span class="font24"> 301</span></a></p>
<p><span class="font24">/etc/hosts,</span><a href="#bookmark1219"><span class="font24"> 120</span></a></p>
<p><span class="font24">/etc/init.d/,</span><a href="#bookmark1071"><span class="font24"> 105</span></a></p>
<p><span class="font24">/etc/inputrc, </span><a href="#bookmark2562"><span class="font24">292</span></a></p>
<p><span class="font24">/etc/login.defs, </span><a href="#bookmark2514"><span class="font24">286</span></a></p>
<p><span class="font24">/etc/passwd,</span><a href="#bookmark1798"><span class="font24"> 191</span></a><span class="font24">, </span><a href="#bookmark2440"><span class="font24">275</span></a><span class="font24">, </span><a href="#bookmark2473"><span class="font24">278</span></a><span class="font24">,</span><a href="#bookmark2527"><span class="font24"> 287</span></a><span class="font24">, </span><a href="#bookmark2528"><span class="font24">287</span></a><span class="font24">,</span><a href="#bookmark2693"><span class="font24"> 308</span></a></p>
<p><span class="font24">/etc/profile, </span><a href="#bookmark2561"><span class="font24">292</span></a></p>
<p><span class="font24">/etc/resolv.conf,</span><a href="#bookmark1220"><span class="font24"> 120</span></a></p>
<p><span class="font24">/etc/shadow, </span><a href="#bookmark2496"><span class="font24">283</span></a><span class="font24">, </span><a href="#bookmark2511"><span class="font24">285</span></a><span class="font24">, </span><a href="#bookmark2779"><span class="font24">321</span></a></p>
<p><span class="font24">/etc/shells, </span><a href="#bookmark2116"><span class="font24">235</span></a><span class="font24">, </span><a href="#bookmark2476"><span class="font24">278</span></a></p>
<p><span class="font24">/etc/skel,</span><a href="#bookmark1075"><span class="font24"> 105</span></a><span class="font24">, </span><a href="#bookmark2467"><span class="font24">277</span></a></p>
<p><span class="font24">/etc/sudoers, </span><a href="#bookmark2402"><span class="font24">269</span></a><span class="font24">, </span><a href="#bookmark2410"><span class="font24">270</span></a></p>
<p><span class="font24">/etc/sysconfig,</span><a href="#bookmark1077"><span class="font24"> 105</span></a></p>
<p><span class="font24">/etc/sysconfig/firstboot,</span><a href="#bookmark1078"><span class="font24"> 106</span></a></p>
<p><span class="font24">/etc/sysconfig/harddisks,</span><a href="#bookmark1080"><span class="font24"> 106</span></a></p>
<p><span class="font24">/etc/sysconfig/hwconf,</span><a href="#bookmark1081"><span class="font24"> 106</span></a></p>
<p><span class="font24">/etc/sysconfig/keyboard,</span><a href="#bookmark1083"><span class="font24"> 106</span></a></p>
<p><span class="font24">/etc/X11/xorg.conf,</span><a href="#bookmark1072"><span class="font24"> 105</span></a></p>
<p><span class="font24">/export,</span><a href="#bookmark1099"><span class="font24"> 107</span></a></p>
<p><span class="font24">/home,</span><a href="#bookmark1092"><span class="font24"> 107</span></a></p>
<p><span class="font24">/lib,</span><a href="#bookmark1049"><span class="font24"> 104</span></a></p>
<p><span class="font24">/lib/kbd/keymaps/,</span><a href="#bookmark1084"><span class="font24"> 106</span></a></p>
<p><span class="font24">/lib/modules,</span><a href="#bookmark1050"><span class="font24"> 104</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">/opt,</span><a href="#bookmark1059"><span class="font24"> 104</span></a></p>
<p><span class="font24">/proc,</span><a href="#bookmark881"><span class="font24"> 85</span></a><span class="font24">,</span><a href="#bookmark1118"><span class="font24"> 109</span></a></p>
<p><span class="font24">/proc/bus,</span><a href="#bookmark2922"><span class="font24"> 340</span></a></p>
<p><span class="font24">/proc/bus/pci, </span><a href="#bookmark2932"><span class="font24">341</span></a></p>
<p><span class="font24">/proc/bus/usb/devices,</span><a href="#bookmark2925"><span class="font24"> 340</span></a></p>
<p><span class="font24">/proc/cpuinfo,</span><a href="#bookmark1123"><span class="font24"> 110</span></a></p>
<p><span class="font24">/proc/dma,</span><a href="#bookmark2971"><span class="font24"> 342</span></a></p>
<p><span class="font24">/proc/interrupts,</span><a href="#bookmark1129"><span class="font24"> 112</span></a><span class="font24">,</span><a href="#bookmark2950"><span class="font24"> 341</span></a></p>
<p><span class="font24">/proc/ioports,</span><a href="#bookmark2963"><span class="font24"> 342</span></a></p>
<p><span class="font24">/proc/kcore,</span><a href="#bookmark1134"><span class="font24"> 112</span></a></p>
<p><span class="font24">/proc/sys,</span><a href="#bookmark1126"><span class="font24"> 111</span></a></p>
<p><span class="font24">/root,</span><a href="#bookmark1095"><span class="font24"> 107</span></a></p>
<p><span class="font24">/run,</span><a href="#bookmark1207"><span class="font24"> 117</span></a></p>
<p><span class="font24">/sbin,</span><a href="#bookmark1045"><span class="font24"> 103</span></a><span class="font24">,</span><a href="#bookmark1321"><span class="font24"> 128</span></a></p>
<p><span class="font24">/srv,</span><a href="#bookmark1098"><span class="font24"> 107</span></a></p>
<p><span class="font24">/sys,</span><a href="#bookmark1139"><span class="font24"> 113</span></a></p>
<p><span class="font24">/tmp,</span><a href="#bookmark1107"><span class="font24"> 108</span></a><span class="font24">,</span><a href="#bookmark2770"><span class="font24"> 320</span></a></p>
<p><span class="font24">/usr,</span><a href="#bookmark1147"><span class="font24"> 114</span></a></p>
<p><span class="font24">/usr/bin,</span><a href="#bookmark1150"><span class="font24"> 114</span></a></p>
<p><span class="font24">/usr/bin/getfacl,</span><a href="#bookmark2800"><span class="font24"> 326</span></a></p>
<p><span class="font24">/usr/bin/passwd, </span><a href="#bookmark2780"><span class="font24">321</span></a></p>
<p><span class="font24">/usr/bin/setfacl, </span><a href="#bookmark2804"><span class="font24">326</span></a></p>
<p><span class="font24">/usr/include,</span><a href="#bookmark1153"><span class="font24"> 114</span></a></p>
<p><span class="font24">/usr/lib,</span><a href="#bookmark1156"><span class="font24"> 114</span></a></p>
<p><span class="font24">/usr/local,</span><a href="#bookmark1159"><span class="font24"> 114</span></a></p>
<p><span class="font24">/usr/share,</span><a href="#bookmark1162"><span class="font24"> 114</span></a></p>
<p><span class="font24">/usr/share/games,</span><a href="#bookmark1166"><span class="font24"> 115</span></a></p>
<p><span class="font24">/usr/share/man,</span><a href="#bookmark1163"><span class="font24"> 115</span></a></p>
<p><span class="font24">/usr/src,</span><a href="#bookmark1171"><span class="font24"> 115</span></a></p>
<p><span class="font24">/var,</span><a href="#bookmark1176"><span class="font24"> 116</span></a></p>
<p><span class="font24">/var/cache,</span><a href="#bookmark1192"><span class="font24"> 116</span></a></p>
<p><span class="font24">/var/lib,</span><a href="#bookmark1202"><span class="font24"> 117</span></a></p>
<p><span class="font24">/var/lib/rpm,</span><a href="#bookmark1203"><span class="font24"> 117</span></a></p>
<p><span class="font24">/var/lib/usbutils/usb.ids,</span><a href="#bookmark2929"><span class="font24"> 340</span></a></p>
<p><span class="font24">/var/lock,</span><a href="#bookmark1208"><span class="font24"> 117</span></a></p>
<p><span class="font24">/var/log,</span><a href="#bookmark1181"><span class="font24"> 116</span></a></p>
<p><span class="font24">/var/log/messages,</span><a href="#bookmark1186"><span class="font24"> 116</span></a></p>
<p><span class="font24">/var/log/syslog,</span><a href="#bookmark1187"><span class="font24"> 116</span></a></p>
<p><span class="font24">/var/run,</span><a href="#bookmark1209"><span class="font24"> 117</span></a></p>
<p><span class="font24">/var/spool,</span><a href="#bookmark1197"><span class="font24"> 116</span></a></p>
<p><span class="font24">/var/tmp,</span><a href="#bookmark1210"><span class="font24"> 117</span></a></p>
<p><span class="font24">., </span><a href="#bookmark814"><span class="font24">75</span></a></p>
<p><span class="font24">.., </span><a href="#bookmark812"><span class="font24">75</span></a></p>
<p><span class="font24">.. (directory),</span><a href="#bookmark2853"><span class="font24"> 331</span></a></p>
<p><span class="font24">. (directory),</span><a href="#bookmark2854"><span class="font24"> 331</span></a></p>
<p><span class="font24">. (shell),</span><a href="#bookmark2124"><span class="font24"> 236</span></a></p>
<p><span class="font24">.bash_history,</span><a href="#bookmark1487"><span class="font24"> 157</span></a></p>
<p><span class="font24">.bash_login,</span><a href="#bookmark2569"><span class="font24"> 293</span></a></p>
<p><span class="font24">.bash_logout, </span><a href="#bookmark2578"><span class="font24">294</span></a></p>
<p><span class="font24">.bash_profile, </span><a href="#bookmark2565"><span class="font24">292</span></a></p>
<p><span class="font24">.bashrc, </span><a href="#bookmark2566"><span class="font24">292</span></a><span class="font24">,</span><a href="#bookmark2572"><span class="font24"> 293</span></a></p>
<p><span class="font24">.exrc, </span><a href="#bookmark2056"><span class="font24">229</span></a></p>
<p><span class="font24">.vimrc, </span><a href="#bookmark2057"><span class="font24">229</span></a></p>
<p><span class="font24">'(backtick),</span><a href="#bookmark1454"><span class="font24"> 151</span></a></p>
<p><span class="font24">~, </span><a href="#bookmark809"><span class="font24">75</span></a></p></td></tr>
</table>
<p><span class="font24">'(single quote),</span><a href="#bookmark1455"><span class="font24"> 151</span></a></p>
<p><span class="font24">&quot; (double quotes),</span><a href="#bookmark1312"><span class="font24"> 127</span></a></p>
<p><span class="font24">(( (shell),</span><a href="#bookmark2246"><span class="font24"> 256</span></a></p>
<p><span class="font24">-- (shell),</span><a href="#bookmark2131"><span class="font24"> 237</span></a></p>
<p><span class="font24">[ (file globbing),</span><a href="#bookmark1519"><span class="font24"> 163</span></a></p>
<p><span class="font24">[ (shell), </span><a href="#bookmark2146"><span class="font24">241</span></a></p>
<p><span class="font24">$? (shell variables),</span><a href="#bookmark1368"><span class="font24"> 136</span></a><span class="font24"> $() embedded shell,</span><a href="#bookmark1451"><span class="font24"> 151</span></a><span class="font24"> $ (shell variables),</span><a href="#bookmark1407"><span class="font24"> 142</span></a><span class="font24"> $HISTFILE,</span><a href="#bookmark1488"><span class="font24"> 157</span></a><span class="font24"> $HISTFILESIZE,</span><a href="#bookmark1493"><span class="font24"> 157</span></a></p>
<p><span class="font24">$HISTSIZE,</span><a href="#bookmark1484"><span class="font24"> 157</span></a></p>
<p><span class="font24">$LANG,</span><a href="#bookmark1532"><span class="font24"> 164</span></a></p>
<p><span class="font24">$PATH,</span><a href="#bookmark1329"><span class="font24"> 128</span></a><span class="font24">,</span><a href="#bookmark1425"><span class="font24"> 145</span></a></p>
<p><span class="font24">$PS1, </span><a href="#bookmark822"><span class="font24">76</span></a></p>
<p><span class="font24">* (file globbing),</span><a href="#bookmark1512"><span class="font24"> 162</span></a></p>
<p><span class="font24">\ (backslash),</span><a href="#bookmark1395"><span class="font24"> 138</span></a></p>
<p><span class="font24">&amp;,</span><a href="#bookmark1365"><span class="font24"> 136</span></a></p>
<p><span class="font24">&amp;&amp;,</span><a href="#bookmark1371"><span class="font24"> 137</span></a></p>
<p><span class="font24">#!/bin/bash,</span><a href="#bookmark2113"><span class="font24"> 235</span></a></p>
<p><span class="font24">#! (shell),</span><a href="#bookmark2111"><span class="font24"> 235</span></a></p>
<p><span class="font24"># (pound sign),</span><a href="#bookmark1391"><span class="font24"> 138</span></a></p>
<p><span class="font24">&gt;,</span><a href="#bookmark1608"><span class="font24"> 173</span></a></p>
<p><span class="font24">&gt;&gt;,</span><a href="#bookmark1623"><span class="font24"> 174</span></a></p>
<p><span class="font24">&gt;|,</span><a href="#bookmark1618"><span class="font24"> 174</span></a></p>
<p><span class="font24">||,</span><a href="#bookmark1379"><span class="font24"> 137</span></a></p>
<p><span class="font24">1&gt;,</span><a href="#bookmark1632"><span class="font24"> 175</span></a></p>
<p><span class="font24">2&gt;,</span><a href="#bookmark1630"><span class="font24"> 175</span></a></p>
<p><span class="font24">2&gt;&amp;1,</span><a href="#bookmark1635"><span class="font24"> 175</span></a></p>
<p><span class="font24">777,</span><a href="#bookmark2749"><span class="font24"> 314</span></a></p>
<p><span class="font7" style="font-weight:bold;">A</span></p>
<p><span class="font24">access control list,</span><a href="#bookmark2796"><span class="font24"> 326</span></a><span class="font24"> acl,</span><a href="#bookmark2824"><span class="font24"> 328</span></a></p>
<p><span class="font24">acls, </span><a href="#bookmark2797"><span class="font24">326</span></a></p>
<p><span class="font24">agp,</span><a href="#bookmark2911"><span class="font24"> 340</span></a></p>
<p><span class="font24">AIX, </span><a href="#bookmark444"><span class="font24">4</span></a></p>
<p><span class="font24">alias(bash),</span><a href="#bookmark1335"><span class="font24"> 129</span></a><span class="font24"> alias(shell),</span><a href="#bookmark1338"><span class="font24"> 129</span></a><span class="font24"> apropos, </span><a href="#bookmark768"><span class="font24">72</span></a><span class="font24"> arguments(shell),</span><a href="#bookmark1304"><span class="font24"> 126</span></a></p>
<p><span class="font7" style="font-weight:bold;">B</span></p>
<p><span class="font24">backticks,</span><a href="#bookmark1456"><span class="font24"> 151</span></a><span class="font24"> base64,</span><a href="#bookmark1661"><span class="font24"> 177</span></a><span class="font24"> bash, </span><a href="#bookmark1963"><span class="font24">219</span></a><span class="font24">, </span><a href="#bookmark2195"><span class="font24">248</span></a><span class="font24"> bash history,</span><a href="#bookmark1475"><span class="font24"> 156</span></a><span class="font24"> bash -x,</span><a href="#bookmark2127"><span class="font24"> 237</span></a></p>
<p><span class="font24">binaries,</span><a href="#bookmark1041"><span class="font24"> 103</span></a></p>
<p><span class="font24">Bourne again shell,</span><a href="#bookmark1296"><span class="font24"> 125</span></a></p>
<p><span class="font24">BSD, </span><a href="#bookmark438"><span class="font24">4</span></a></p>
<p><span class="font24">bunzip2, </span><a href="#bookmark1857"><span class="font24">201</span></a></p>
<p><span class="font24">bus, </span><a href="#bookmark2912"><span class="font24">340</span></a></p>
<p><span class="font24">bzcat, </span><a href="#bookmark1862"><span class="font24">201</span></a></p>
<p><span class="font24">bzip2,</span><a href="#bookmark1836"><span class="font24"> 199</span></a><span class="font24">, </span><a href="#bookmark1854"><span class="font24">201</span></a><span class="font24">, </span><a href="#bookmark1863"><span class="font24">201</span></a></p>
<p><span class="font24">bzmore, </span><a href="#bookmark1864"><span class="font24">201</span></a></p>
<p><span class="font7" style="font-weight:bold;">C</span></p>
<p><span class="font24">cal,</span><a href="#bookmark1819"><span class="font24"> 198</span></a><span class="font24"> case, </span><a href="#bookmark2260"><span class="font24">258</span></a><span class="font24"> case sensitive,</span><a href="#bookmark873"><span class="font24"> 85</span></a><span class="font24"> cat, </span><a href="#bookmark984"><span class="font24">96</span></a><span class="font24">,</span><a href="#bookmark1676"><span class="font24"> 182</span></a></p>
<p><span class="font24">cd, </span><a href="#bookmark806"><span class="font24">75</span></a></p>
<p><span class="font24">cd -, </span><a href="#bookmark817"><span class="font24">76</span></a></p>
<p><span class="font24">CentOS, </span><a href="#bookmark475"><span class="font24">7</span></a><span class="font24"> chage, </span><a href="#bookmark2517"><span class="font24">286</span></a><span class="font24"> chgrp(1),</span><a href="#bookmark2699"><span class="font24"> 309</span></a><span class="font24"> chkconfig,</span><a href="#bookmark1079"><span class="font24"> 106</span></a><span class="font24"> chmod,</span><a href="#bookmark2462"><span class="font24"> 277</span></a><span class="font24">,</span><a href="#bookmark2750"><span class="font24"> 314</span></a><span class="font24"> chmod(1), </span><a href="#bookmark2031"><span class="font24">226</span></a><span class="font24">,</span><a href="#bookmark2727"><span class="font24"> 313</span></a><span class="font24"> chmod +x, </span><a href="#bookmark2108"><span class="font24">235</span></a><span class="font24">,</span><a href="#bookmark2756"><span class="font24"> 315</span></a><span class="font24"> chown, </span><a href="#bookmark2463"><span class="font24">277</span></a><span class="font24"> chown(1), </span><a href="#bookmark2704"><span class="font24">309</span></a><span class="font24"> chsh(1), </span><a href="#bookmark2477"><span class="font24">278</span></a><span class="font24"> comm(1),</span><a href="#bookmark1757"><span class="font24"> 188</span></a><span class="font24"> command line scan,</span><a href="#bookmark1300"><span class="font24"> 126</span></a><span class="font24"> command mode(vi),</span><a href="#bookmark2002"><span class="font24"> 223</span></a><span class="font24"> copyleft,</span><a href="#bookmark515"><span class="font24"> 11</span></a><span class="font24"> copyright,</span><a href="#bookmark495"><span class="font24"> 10</span></a><span class="font24">,</span><a href="#bookmark503"><span class="font24"> 10</span></a><span class="font24"> cp,</span><a href="#bookmark909"><span class="font24"> 88</span></a><span class="font24"> cp(1),</span><a href="#bookmark918"><span class="font24"> 88</span></a><span class="font24"> cpu,</span><a href="#bookmark2913"><span class="font24"> 340</span></a><span class="font24"> crypt, </span><a href="#bookmark2500"><span class="font24">284</span></a><span class="font24"> csh, </span><a href="#bookmark2114"><span class="font24">235</span></a></p>
<p><span class="font24">Ctrl d, </span><a href="#bookmark991"><span class="font24">96</span></a><span class="font24"> ctrl-r,</span><a href="#bookmark1481"><span class="font24"> 157</span></a><span class="font24"> current directory, </span><a href="#bookmark802"><span class="font24">75</span></a><span class="font24"> cut,</span><a href="#bookmark1792"><span class="font24"> 191</span></a><span class="font24"> cut(1),</span><a href="#bookmark1709"><span class="font24"> 184</span></a></p>
<p><span class="font7" style="font-weight:bold;">D</span></p>
<p><span class="font24">daemon, </span><a href="#bookmark763"><span class="font24">72</span></a><span class="font24"> date,</span><a href="#bookmark1816"><span class="font24"> 197</span></a></p>
<p><span class="font24">Debian, </span><a href="#bookmark472"><span class="font24">7</span></a></p>
<p><span class="font24">Dennis Ritchie, </span><a href="#bookmark439"><span class="font24">4</span></a><span class="font24"> devfs,</span><a href="#bookmark1140"><span class="font24"> 113</span></a><span class="font24"> df -i, </span><a href="#bookmark2837"><span class="font24">330</span></a><span class="font24"> directory,</span><a href="#bookmark2849"><span class="font24"> 331</span></a><span class="font24"> distribution,</span><a href="#bookmark461"><span class="font24"> 6</span></a><span class="font24"> distributions,</span><a href="#bookmark1027"><span class="font24"> 102</span></a><span class="font24"> dma,</span><a href="#bookmark2968"><span class="font24"> 342</span></a><span class="font24"> dmesg(1),</span><a href="#bookmark2955"><span class="font24"> 342</span></a><span class="font24">, </span><a href="#bookmark2972"><span class="font24">343</span></a><span class="font24"> dumpkeys(1),</span><a href="#bookmark1085"><span class="font24"> 106</span></a></p>
<p><span class="font7" style="font-weight:bold;">E</span></p>
<p><span class="font24">echo,</span><a href="#bookmark1307"><span class="font24"> 126</span></a><span class="font24"> echo(1),</span><a href="#bookmark1297"><span class="font24"> 125</span></a><span class="font24">,</span><a href="#bookmark1315"><span class="font24"> 127</span></a><span class="font24"> echo $-,</span><a href="#bookmark1461"><span class="font24"> 152</span></a></p>
<p><span class="font24">echo *,</span><a href="#bookmark1539"><span class="font24"> 165</span></a><span class="font24"> Edubuntu, </span><a href="#bookmark476"><span class="font24">7</span></a><span class="font24"> eiciel,</span><a href="#bookmark2825"><span class="font24"> 328</span></a></p>
<p><span class="font24">ELF,</span><a href="#bookmark1055"><span class="font24"> 104</span></a><span class="font24"> elif, </span><a href="#bookmark2158"><span class="font24">242</span></a><span class="font24"> embedding(shell),</span><a href="#bookmark1448"><span class="font24"> 151</span></a></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24">env(1),</span><a href="#bookmark1429"><span class="font24"> 146</span></a><span class="font24">,</span><a href="#bookmark1430"><span class="font24"> 146</span></a></p>
<p><span class="font24">environment variable,</span><a href="#bookmark1408"><span class="font24"> 142</span></a></p>
<p><span class="font24">EOF, </span><a href="#bookmark992"><span class="font24">96</span></a><span class="font24">,</span><a href="#bookmark1657"><span class="font24"> 177</span></a></p>
<p><span class="font24">escaping (shell),</span><a href="#bookmark1542"><span class="font24"> 165</span></a></p>
<p><span class="font24">eval, </span><a href="#bookmark2235"><span class="font24">256</span></a></p>
<p><span class="font24">executables,</span><a href="#bookmark1035"><span class="font24"> 103</span></a></p>
<p><span class="font24">exit (bash),</span><a href="#bookmark1489"><span class="font24"> 157</span></a></p>
<p><span class="font24">export,</span><a href="#bookmark1433"><span class="font24"> 146</span></a></p></td><td style="vertical-align:top;">
<p><span class="font24">hidden files, </span><a href="#bookmark833"><span class="font24">77</span></a></p>
<p><span class="font24">HP, </span><a href="#bookmark452"><span class="font24">4</span></a></p>
<p><span class="font24">HP-UX, </span><a href="#bookmark449"><span class="font24">4</span></a></p>
<p><a href="http://www.pathname.com/fhs/"><span class="font24">http://www.pathname.com/fhs/</span></a><span class="font24">,</span><a href="#bookmark1024"><span class="font24"> 102</span></a></p>
<p><span class="font7" style="font-weight:bold;">I</span></p>
<p><span class="font24">IBM, </span><a href="#bookmark448"><span class="font24">4</span></a></p>
<p><span class="font24">id,</span><a href="#bookmark2382"><span class="font24"> 267</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">F</span></p>
<p><span class="font24">Fedora, </span><a href="#bookmark465"><span class="font24">7</span></a></p>
<p><span class="font24">FHS,</span><a href="#bookmark1022"><span class="font24"> 102</span></a></p>
<p><span class="font24">file,</span><a href="#bookmark878"><span class="font24"> 85</span></a></p>
<p><span class="font24">file(1),</span><a href="#bookmark1054"><span class="font24"> 104</span></a></p>
<p><span class="font24">file globbing,</span><a href="#bookmark1509"><span class="font24"> 161</span></a></p>
<p><span class="font24">file ownership,</span><a href="#bookmark2694"><span class="font24"> 308</span></a></p>
<p><span class="font24">Filesystem Hierarchy Standard,</span><a href="#bookmark1023"><span class="font24"> 102</span></a></p>
<p><span class="font24">filters,</span><a href="#bookmark1673"><span class="font24"> 181</span></a></p>
<p><span class="font24">find(1),</span><a href="#bookmark1809"><span class="font24"> 196</span></a><span class="font24">,</span><a href="#bookmark2774"><span class="font24"> 320</span></a><span class="font24">,</span><a href="#bookmark2782"><span class="font24"> 321</span></a><span class="font24">, </span><a href="#bookmark2863"><span class="font24">332</span></a></p>
<p><span class="font24">FireWire,</span><a href="#bookmark1141"><span class="font24"> 113</span></a></p>
<p><span class="font24">for (bash), </span><a href="#bookmark2161"><span class="font24">242</span></a></p>
<p><span class="font24">FOSS,</span><a href="#bookmark496"><span class="font24"> 10</span></a></p>
<p><span class="font24">four freedoms,</span><a href="#bookmark511"><span class="font24"> 11</span></a></p>
<p><span class="font24">Free Software,</span><a href="#bookmark497"><span class="font24"> 10</span></a></p>
<p><span class="font24">free software,</span><a href="#bookmark507"><span class="font24"> 10</span></a></p>
<p><span class="font24">freeware,</span><a href="#bookmark504"><span class="font24"> 10</span></a></p>
<p><span class="font24">function (shell), </span><a href="#bookmark2265"><span class="font24">259</span></a></p></td><td style="vertical-align:top;">
<p><span class="font24">IEEE 1394,</span><a href="#bookmark1142"><span class="font24"> 113</span></a></p>
<p><span class="font24">if then else (bash),</span><a href="#bookmark2155"><span class="font24"> 242</span></a><span class="font24"> inode, </span><a href="#bookmark2829"><span class="font24">329</span></a><span class="font24">,</span><a href="#bookmark2864"><span class="font24"> 332</span></a><span class="font24"> inode table,</span><a href="#bookmark2838"><span class="font24"> 330</span></a></p>
<p><span class="font24">insert mode(vi), </span><a href="#bookmark2003"><span class="font24">223</span></a></p>
<p><span class="font24">interrupt,</span><a href="#bookmark2940"><span class="font24"> 341</span></a></p>
<p><span class="font24">IO Ports,</span><a href="#bookmark2960"><span class="font24"> 342</span></a></p>
<p><span class="font24">IRQ,</span><a href="#bookmark2941"><span class="font24"> 341</span></a></p>
<p><span class="font24">isa,</span><a href="#bookmark2919"><span class="font24"> 340</span></a></p>
<p><span class="font7" style="font-weight:bold;">K</span></p>
<p><span class="font24">Ken Thompson, </span><a href="#bookmark440"><span class="font24">4</span></a><span class="font24"> kernel,</span><a href="#bookmark1051"><span class="font24"> 104</span></a><span class="font24"> keymaps(5),</span><a href="#bookmark1086"><span class="font24"> 106</span></a><span class="font24"> Korn shell,</span><a href="#bookmark1501"><span class="font24"> 158</span></a></p>
<p><span class="font24">Korn Shell, </span><a href="#bookmark2478"><span class="font24">278</span></a><span class="font24"> ksh,</span><a href="#bookmark1502"><span class="font24"> 158</span></a><span class="font24">, </span><a href="#bookmark2115"><span class="font24">235</span></a><span class="font24"> kudzu,</span><a href="#bookmark1082"><span class="font24"> 106</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">G</span></p>
<p><span class="font24">gcc(1),</span><a href="#bookmark2508"><span class="font24"> 285</span></a></p>
<p><span class="font24">getfacl,</span><a href="#bookmark2801"><span class="font24"> 326</span></a><span class="font24"> getopts, </span><a href="#bookmark2220"><span class="font24">251</span></a><span class="font24"> GID, </span><a href="#bookmark2606"><span class="font24">299</span></a></p>
<p><span class="font24">glob(7),</span><a href="#bookmark1513"><span class="font24"> 162</span></a></p>
<p><span class="font24">GNU, </span><a href="#bookmark450"><span class="font24">4</span></a><span class="font24"> gpasswd,</span><a href="#bookmark2629"><span class="font24"> 301</span></a><span class="font24"> GPL,</span><a href="#bookmark516"><span class="font24"> 11</span></a></p>
<p><span class="font24">GPLv3,</span><a href="#bookmark519"><span class="font24"> 11</span></a></p>
<p><span class="font24">grep, </span><a href="#bookmark1875"><span class="font24">206</span></a><span class="font24">, </span><a href="#bookmark1880"><span class="font24">207</span></a><span class="font24">, </span><a href="#bookmark1899"><span class="font24">210</span></a><span class="font24"> grep(1),</span><a href="#bookmark1688"><span class="font24"> 182</span></a></p>
<p><span class="font24">grep -i,</span><a href="#bookmark1693"><span class="font24"> 182</span></a></p>
<p><span class="font24">grep -v,</span><a href="#bookmark1696"><span class="font24"> 183</span></a></p>
<p><span class="font24">groupadd(1), </span><a href="#bookmark2602"><span class="font24">299</span></a><span class="font24"> groupdel(1), </span><a href="#bookmark2624"><span class="font24">300</span></a><span class="font24"> groupmod(1),</span><a href="#bookmark2619"><span class="font24"> 300</span></a><span class="font24"> groups,</span><a href="#bookmark2599"><span class="font24"> 298</span></a><span class="font24"> groups(1), </span><a href="#bookmark2609"><span class="font24">299</span></a><span class="font24"> gunzip(1), </span><a href="#bookmark1842"><span class="font24">200</span></a><span class="font24"> gzip, </span><a href="#bookmark1847"><span class="font24">200</span></a></p>
<p><span class="font24">gzip(1), </span><a href="#bookmark1839"><span class="font24">200</span></a></p></td><td style="vertical-align:top;">
<p><span class="font7" style="font-weight:bold;">L</span></p>
<p><span class="font24">less(1), </span><a href="#bookmark1009"><span class="font24">98</span></a><span class="font24"> let, </span><a href="#bookmark2251"><span class="font24">257</span></a></p>
<p><span class="font24">Linus Torvalds, </span><a href="#bookmark455"><span class="font24">4</span></a><span class="font24"> Linux Mint, </span><a href="#bookmark480"><span class="font24">7</span></a><span class="font24"> ln,</span><a href="#bookmark2867"><span class="font24"> 333</span></a><span class="font24"> ln(1),</span><a href="#bookmark2860"><span class="font24"> 332</span></a><span class="font24"> loadkeys(1),</span><a href="#bookmark1087"><span class="font24"> 106</span></a><span class="font24"> locate(1),</span><a href="#bookmark1812"><span class="font24"> 197</span></a><span class="font24"> logical AND,</span><a href="#bookmark1374"><span class="font24"> 137</span></a><span class="font24"> logical OR,</span><a href="#bookmark1382"><span class="font24"> 137</span></a><span class="font24"> Logiciel Libre,</span><a href="#bookmark508"><span class="font24"> 10</span></a><span class="font24"> ls, </span><a href="#bookmark830"><span class="font24">77</span></a><span class="font24">,</span><a href="#bookmark2720"><span class="font24"> 311</span></a><span class="font24">, </span><a href="#bookmark2834"><span class="font24">330</span></a><span class="font24"> ls(1), </span><a href="#bookmark836"><span class="font24">77</span></a><span class="font24">,</span><a href="#bookmark2842"><span class="font24"> 330</span></a><span class="font24">,</span><a href="#bookmark2850"><span class="font24"> 331</span></a><span class="font24"> ls -l, </span><a href="#bookmark2712"><span class="font24">310</span></a><span class="font24"> lspci, </span><a href="#bookmark2933"><span class="font24">341</span></a><span class="font24"> lsusb, </span><a href="#bookmark2926"><span class="font24">340</span></a></p>
<p><span class="font7" style="font-weight:bold;">M</span></p>
<p><span class="font24">magic,</span><a href="#bookmark879"><span class="font24"> 85</span></a><span class="font24"> makewhatis, </span><a href="#bookmark797"><span class="font24">73</span></a><span class="font24"> man(1), </span><a href="#bookmark754"><span class="font24">72</span></a><span class="font24">, </span><a href="#bookmark782"><span class="font24">72</span></a><span class="font24">, </span><a href="#bookmark787"><span class="font24">73</span></a><span class="font24"> mandb(1), </span><a href="#bookmark796"><span class="font24">73</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">H</span></p>
<p><span class="font24">hard link,</span><a href="#bookmark2859"><span class="font24"> 332</span></a></p>
<p><span class="font24">head(1), </span><a href="#bookmark966"><span class="font24">95</span></a></p>
<p><span class="font24">here directive, </span><a href="#bookmark995"><span class="font24">97</span></a></p>
<p><span class="font24">here document,</span><a href="#bookmark1656"><span class="font24"> 177</span></a></p>
<p><span class="font24">here string,</span><a href="#bookmark1660"><span class="font24"> 177</span></a></p></td><td style="vertical-align:top;">
<p><span class="font24">man hier,</span><a href="#bookmark1028"><span class="font24"> 102</span></a><span class="font24"> man -k, </span><a href="#bookmark769"><span class="font24">72</span></a><span class="font24"> md5, </span><a href="#bookmark2510"><span class="font24">285</span></a><span class="font24"> mkdir, </span><a href="#bookmark2464"><span class="font24">277</span></a><span class="font24"> mkdir(1), </span><a href="#bookmark843"><span class="font24">79</span></a><span class="font24">, </span><a href="#bookmark2759"><span class="font24">315</span></a><span class="font24"> mkdir -p, </span><a href="#bookmark850"><span class="font24">79</span></a><span class="font24"> mkfs,</span><a href="#bookmark2839"><span class="font24"> 330</span></a></p></td></tr>
</table>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24">more(1), </span><a href="#bookmark1010"><span class="font24">98</span></a></p></td><td style="vertical-align:top;">
<p><span class="font7" style="font-weight:bold;">S</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">mv,</span><a href="#bookmark933"><span class="font24"> 89</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">salt (encryption), </span><a href="#bookmark2509"><span class="font24">285</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">N</span></p></td><td style="vertical-align:top;">
<p><span class="font24">Scientific, </span><a href="#bookmark479"><span class="font24">7</span></a><span class="font24"> sed,</span><a href="#bookmark1773"><span class="font24"> 190</span></a><span class="font24">, </span><a href="#bookmark1936"><span class="font24">215</span></a><span class="font24">, </span><a href="#bookmark1945"><span class="font24">216</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">noclobber,</span><a href="#bookmark1613"><span class="font24"> 174</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">set,</span><a href="#bookmark1459"><span class="font24"> 152</span></a></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">nounset(shell),</span><a href="#bookmark1438"><span class="font24"> 147</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">set(shell),</span><a href="#bookmark1417"><span class="font24"> 143</span></a></p>
<p><span class="font24">set +x,</span><a href="#bookmark1350"><span class="font24"> 130</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">O</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">setfacl,</span><a href="#bookmark2805"><span class="font24"> 326</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">octal permissions,</span><a href="#bookmark2746"><span class="font24"> 314</span></a></p></td><td style="vertical-align:top;">
<p><span class="font24">setgid, </span><a href="#bookmark2773"><span class="font24">320</span></a><span class="font24">,</span><a href="#bookmark2775"><span class="font24"> 320</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">od(1),</span><a href="#bookmark1764"><span class="font24"> 189</span></a></p></td><td style="vertical-align:top;">
<p><span class="font24">setuid, </span><a href="#bookmark2130"><span class="font24">237</span></a><span class="font24">,</span><a href="#bookmark2778"><span class="font24"> 321</span></a><span class="font24">,</span><a href="#bookmark2783"><span class="font24"> 321</span></a><span class="font24">, </span><a href="#bookmark2786"><span class="font24">321</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">OEL, </span><a href="#bookmark477"><span class="font24">7</span></a></p></td><td style="vertical-align:top;">
<p><span class="font24">set -x,</span><a href="#bookmark1351"><span class="font24"> 130</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">open source,</span><a href="#bookmark509"><span class="font24"> 10</span></a></p>
<p><span class="font24">open source definition,</span><a href="#bookmark512"><span class="font24"> 11</span></a></p></td><td style="vertical-align:top;">
<p><span class="font24">she-bang (shell),</span><a href="#bookmark2112"><span class="font24"> 235</span></a></p>
<p><span class="font24">shell, </span><a href="#bookmark2556"><span class="font24">291</span></a></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">open source software,</span><a href="#bookmark498"><span class="font24"> 10</span></a></p>
<p><span class="font24">openssl, </span><a href="#bookmark2505"><span class="font24">284</span></a></p>
<p><span class="font24">Oracle Enterprise Linux, </span><a href="#bookmark478"><span class="font24">7</span></a><span class="font24"> owner,</span><a href="#bookmark2722"><span class="font24"> 311</span></a></p></td><td style="vertical-align:top;">
<p><span class="font24">shell comment,</span><a href="#bookmark1392"><span class="font24"> 138</span></a></p>
<p><span class="font24">shell embedding,</span><a href="#bookmark1447"><span class="font24"> 151</span></a></p>
<p><span class="font24">shell escaping,</span><a href="#bookmark1396"><span class="font24"> 138</span></a></p>
<p><span class="font24">shell expansion,</span><a href="#bookmark1301"><span class="font24"> 126</span></a><span class="font24">,</span><a href="#bookmark1306"><span class="font24"> 126</span></a></p>
<p><span class="font24">shell functions, </span><a href="#bookmark2268"><span class="font24">259</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">P</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">shift, </span><a href="#bookmark2198"><span class="font24">249</span></a></p>
<p><span class="font24">shopt,</span><a href="#bookmark2227"><span class="font24"> 252</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">parent directory, </span><a href="#bookmark813"><span class="font24">75</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">skeleton,</span><a href="#bookmark1076"><span class="font24"> 105</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">passwd, </span><a href="#bookmark2493"><span class="font24">283</span></a><span class="font24">, </span><a href="#bookmark2497"><span class="font24">283</span></a><span class="font24">, </span><a href="#bookmark2501"><span class="font24">284</span></a><span class="font24">, </span><a href="#bookmark2518"><span class="font24">286</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">sleep,</span><a href="#bookmark1832"><span class="font24"> 198</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">passwd(1), </span><a href="#bookmark790"><span class="font24">73</span></a><span class="font24">, </span><a href="#bookmark2781"><span class="font24">321</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">soft link,</span><a href="#bookmark2868"><span class="font24"> 333</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">passwd(5), </span><a href="#bookmark791"><span class="font24">73</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">Solaris, </span><a href="#bookmark451"><span class="font24">4</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">path, </span><a href="#bookmark821"><span class="font24">76</span></a><span class="font24">, </span><a href="#bookmark827"><span class="font24">77</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">sort,</span><a href="#bookmark1789"><span class="font24"> 191</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">pc-card,</span><a href="#bookmark2914"><span class="font24"> 340</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">sort(1),</span><a href="#bookmark1741"><span class="font24"> 186</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">pci,</span><a href="#bookmark2915"><span class="font24"> 340</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">source, </span><a href="#bookmark2123"><span class="font24">236</span></a><span class="font24">, </span><a href="#bookmark2210"><span class="font24">250</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">pci-express, </span><a href="#bookmark2916"><span class="font24">340</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">standard input, </span><a href="#bookmark985"><span class="font24">96</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">pcmcia,</span><a href="#bookmark2918"><span class="font24"> 340</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">standard output, </span><a href="#bookmark986"><span class="font24">96</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">perl, </span><a href="#bookmark1910"><span class="font24">212</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">stderr,</span><a href="#bookmark1601"><span class="font24"> 172</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">perldoc, </span><a href="#bookmark1919"><span class="font24">212</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">stdin,</span><a href="#bookmark1602"><span class="font24"> 172</span></a><span class="font24">,</span><a href="#bookmark1681"><span class="font24"> 182</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">popd,</span><a href="#bookmark867"><span class="font24"> 83</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">stdout,</span><a href="#bookmark1603"><span class="font24"> 172</span></a><span class="font24">,</span><a href="#bookmark1682"><span class="font24"> 182</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">prename,</span><a href="#bookmark1911"><span class="font24"> 212</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">sticky bit,</span><a href="#bookmark2769"><span class="font24"> 320</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">primary group,</span><a href="#bookmark2448"><span class="font24"> 276</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">strings(1), </span><a href="#bookmark1013"><span class="font24">98</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">proprietary,</span><a href="#bookmark499"><span class="font24"> 10</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">su, </span><a href="#bookmark2389"><span class="font24">268</span></a><span class="font24">,</span><a href="#bookmark2397"><span class="font24"> 268</span></a><span class="font24">, </span><a href="#bookmark2522"><span class="font24">287</span></a><span class="font24">,</span><a href="#bookmark2630"><span class="font24"> 301</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">public domain,</span><a href="#bookmark500"><span class="font24"> 10</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">su -,</span><a href="#bookmark1426"><span class="font24"> 145</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">pushd,</span><a href="#bookmark868"><span class="font24"> 83</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">sudo, </span><a href="#bookmark2404"><span class="font24">269</span></a><span class="font24">, </span><a href="#bookmark2412"><span class="font24">270</span></a><span class="font24">,</span><a href="#bookmark2523"><span class="font24"> 287</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">pwd, </span><a href="#bookmark803"><span class="font24">75</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">sudo su -,</span><a href="#bookmark2413"><span class="font24"> 270</span></a></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">pwd(1), </span><a href="#bookmark823"><span class="font24">76</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">Sun, </span><a href="#bookmark446"><span class="font24">4</span></a></p>
<p><span class="font24">SunOS, </span><a href="#bookmark445"><span class="font24">4</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">R</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">superuser, </span><a href="#bookmark2444"><span class="font24">275</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">random number generator,</span><a href="#bookmark1218"><span class="font24"> 120</span></a></p>
<p><span class="font24">read, </span><a href="#bookmark2205"><span class="font24">249</span></a></p>
<p><span class="font24">reboot,</span><a href="#bookmark1490"><span class="font24"> 157</span></a></p>
<p><span class="font24">Red Hat, </span><a href="#bookmark466"><span class="font24">7</span></a></p>
<p><span class="font24">regular expressions,</span><a href="#bookmark1498"><span class="font24"> 158</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">symbolic link,</span><a href="#bookmark2869"><span class="font24"> 333</span></a></p>
<p><span class="font24">sysfs,</span><a href="#bookmark1143"><span class="font24"> 113</span></a></p>
<p><span class="font24">System V,</span><a href="#bookmark1056"><span class="font24"> 104</span></a></p>
<p><span class="font7" style="font-weight:bold;">T</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">rename,</span><a href="#bookmark953"><span class="font24"> 90</span></a><span class="font24">, </span><a href="#bookmark1912"><span class="font24">212</span></a><span class="font24">,</span><a href="#bookmark1924"><span class="font24"> 213</span></a><span class="font24">, </span><a href="#bookmark1931"><span class="font24">214</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">tab key(bash), </span><a href="#bookmark826"><span class="font24">77</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">repository, </span><a href="#bookmark462"><span class="font24">6</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">tac, </span><a href="#bookmark1004"><span class="font24">97</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">Richard Stallman, </span><a href="#bookmark447"><span class="font24">4</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">tail(1), </span><a href="#bookmark975"><span class="font24">95</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">rm,</span><a href="#bookmark899"><span class="font24"> 87</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">tee(1),</span><a href="#bookmark1683"><span class="font24"> 182</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">rm(1),</span><a href="#bookmark2876"><span class="font24"> 333</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">test, </span><a href="#bookmark2139"><span class="font24">241</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">rmdir(1), </span><a href="#bookmark855"><span class="font24">79</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">time,</span><a href="#bookmark1835"><span class="font24"> 199</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">rmdir -p,</span><a href="#bookmark860"><span class="font24"> 80</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">touch(1),</span><a href="#bookmark886"><span class="font24"> 86</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">rm -rf,</span><a href="#bookmark904"><span class="font24"> 87</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">tr,</span><a href="#bookmark1729"><span class="font24"> 185</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">root,</span><a href="#bookmark1046"><span class="font24"> 103</span></a><span class="font24">,</span><a href="#bookmark2392"><span class="font24"> 268</span></a><span class="font24">, </span><a href="#bookmark2403"><span class="font24">269</span></a><span class="font24">, </span><a href="#bookmark2411"><span class="font24">270</span></a><span class="font24">,</span><a href="#bookmark2443"><span class="font24"> 275</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">tr(1),</span><a href="#bookmark1720"><span class="font24"> 184</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">root directory,</span><a href="#bookmark1032"><span class="font24"> 102</span></a></p>
<p><span class="font24">rpm,</span><a href="#bookmark1204"><span class="font24"> 117</span></a></p></td><td style="vertical-align:top;">
<p><span class="font24">type(shell),</span><a href="#bookmark1324"><span class="font24"> 128</span></a></p></td></tr>
</table>
<p><span class="font7" style="font-weight:bold;">U</span></p>
<p><span class="font24">Ubuntu, </span><a href="#bookmark469"><span class="font24">7</span></a></p>
<p><span class="font24">umask(1),</span><a href="#bookmark2755"><span class="font24"> 315</span></a></p>
<p><span class="font24">unalias(bash),</span><a href="#bookmark1345"><span class="font24"> 130</span></a></p>
<p><span class="font24">uniq,</span><a href="#bookmark1793"><span class="font24"> 191</span></a></p>
<p><span class="font24">uniq(1),</span><a href="#bookmark1750"><span class="font24"> 187</span></a></p>
<p><span class="font24">Unix, </span><a href="#bookmark441"><span class="font24">4</span></a></p>
<p><span class="font24">unset,</span><a href="#bookmark1460"><span class="font24"> 152</span></a></p>
<p><span class="font24">unset(shell),</span><a href="#bookmark1420"><span class="font24"> 143</span></a></p>
<p><span class="font24">until (bash), </span><a href="#bookmark2173"><span class="font24">243</span></a></p>
<p><span class="font24">updatedb(1),</span><a href="#bookmark1813"><span class="font24"> 197</span></a></p>
<p><span class="font24">usb,</span><a href="#bookmark1144"><span class="font24"> 113</span></a><span class="font24">,</span><a href="#bookmark2917"><span class="font24"> 340</span></a></p>
<p><span class="font24">useradd,</span><a href="#bookmark2447"><span class="font24"> 276</span></a><span class="font24">, </span><a href="#bookmark2470"><span class="font24">277</span></a><span class="font24">, </span><a href="#bookmark2502"><span class="font24">284</span></a></p>
<p><span class="font24">useradd(1), </span><a href="#bookmark2461"><span class="font24">277</span></a></p>
<p><span class="font24">useradd -D, </span><a href="#bookmark2452"><span class="font24">276</span></a></p>
<p><span class="font24">userdel(1), </span><a href="#bookmark2455"><span class="font24">276</span></a></p>
<p><span class="font24">usermod,</span><a href="#bookmark2521"><span class="font24"> 287</span></a><span class="font24">, </span><a href="#bookmark2524"><span class="font24">287</span></a><span class="font24">,</span><a href="#bookmark2612"><span class="font24"> 300</span></a><span class="font24"> usermod(1), </span><a href="#bookmark2458"><span class="font24">276</span></a></p>
<p><span class="font7" style="font-weight:bold;">V</span></p>
<p><span class="font24">vi,</span><a href="#bookmark2646"><span class="font24"> 302</span></a></p>
<p><span class="font24">vi(1), </span><a href="#bookmark1996"><span class="font24">222</span></a></p>
<p><span class="font24">vigr(1), </span><a href="#bookmark2647"><span class="font24">302</span></a></p>
<p><span class="font24">vim(1),</span><a href="#bookmark1997"><span class="font24"> 222</span></a></p>
<p><span class="font24">vimtutor(1), </span><a href="#bookmark1998"><span class="font24">222</span></a></p>
<p><span class="font24">vipw, </span><a href="#bookmark2529"><span class="font24">287</span></a></p>
<p><span class="font24">visudo, </span><a href="#bookmark2407"><span class="font24">269</span></a></p>
<p><span class="font24">vrije software,</span><a href="#bookmark510"><span class="font24"> 10</span></a></p>
<p><span class="font7" style="font-weight:bold;">W</span></p>
<p><span class="font24">w, </span><a href="#bookmark2377"><span class="font24">267</span></a></p>
<p><span class="font24">wc(1),</span><a href="#bookmark1736"><span class="font24"> 185</span></a></p>
<p><span class="font24">whatis(1), </span><a href="#bookmark774"><span class="font24">72</span></a></p>
<p><span class="font24">whereis(1), </span><a href="#bookmark779"><span class="font24">72</span></a></p>
<p><span class="font24">which(1),</span><a href="#bookmark1330"><span class="font24"> 128</span></a></p>
<p><span class="font24">while (bash), </span><a href="#bookmark2166"><span class="font24">243</span></a></p>
<p><span class="font24">white space(shell),</span><a href="#bookmark1305"><span class="font24"> 126</span></a></p>
<p><span class="font24">who,</span><a href="#bookmark1784"><span class="font24"> 191</span></a><span class="font24">, </span><a href="#bookmark2367"><span class="font24">267</span></a></p>
<p><span class="font24">whoami, </span><a href="#bookmark2362"><span class="font24">267</span></a></p>
<p><span class="font24">who am i, </span><a href="#bookmark2372"><span class="font24">267</span></a></p>
<p><span class="font24">wild cards,</span><a href="#bookmark1523"><span class="font24"> 163</span></a></p>
<p><span class="font7" style="font-weight:bold;">X</span></p>
<p><span class="font24">X,</span><a href="#bookmark1073"><span class="font24"> 105</span></a></p>
<p><span class="font24">X Window System,</span><a href="#bookmark1074"><span class="font24"> 105</span></a></p>
<p><span class="font7" style="font-weight:bold;">Z</span></p>
<p><span class="font24">zcat, </span><a href="#bookmark1848"><span class="font24">200</span></a></p>
<p><span class="font24">zmore, </span><a href="#bookmark1849"><span class="font24">200</span></a></p>
<p><span class="font11" style="font-weight:bold;">Linux Storage</span></p>
<p><span class="font9" style="font-weight:bold;">Paul Cobbaut</span></p>
<p><span class="font7" style="font-weight:bold;">Linux Storage</span></p>
<p><span class="font24">Paul Cobbaut</span></p>
<p><span class="font24">Paul Cobbaut</span></p>
<p><span class="font24">Publication date 2015-05-24 CEST</span></p>
<p><span class="font4" style="font-weight:bold;">Abstract</span></p>
<p><span class="font25">This book is meant to be used in an instructor-led training. For self-study, the intent is to read this book next to a working Linux computer so you can immediately do every subject, practicing each command.</span></p>
<p><span class="font25">This book is aimed at novice Linux system administrators (and might be interesting and useful for home users that want to know a bit more about their Linux system). However, this book is not meant as an introduction to Linux desktop applications like text editors, browsers, mail clients, multimedia or office applications.</span></p>
<p><span class="font25">More information and free .pdf available at </span><a href="http://linux-training.be"><span class="font25" style="font-weight:bold;">http://linux-training.be</span></a><span class="font25" style="font-weight:bold;"> </span><span class="font25">.</span></p>
<p><span class="font25">Feel free to contact the author:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">• Paul Cobbaut: </span><a href="mailto:paul.cobbaut@gmail.com"><span class="font25">paul.cobbaut@gmail.com</span></a><span class="font25">, </span><a href="http://www.linkedin.com/in/cobbaut"><span class="font25">http://www.linkedin.com/in/cobbaut</span></a></p></li></ul>
<p><span class="font25">Contributors to the Linux Training project are:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">• Serge van Ginderachter: </span><a href="mailto:serge@ginsys.be"><span class="font25">serge@ginsys.be</span></a><span class="font25">, build scripts; infrastructure setup; minor stuff</span></p></li>
<li>
<p><span class="font25">• Hendrik De Vloed: </span><a href="mailto:hendrik.devloed@ugent.be"><span class="font25">hendrik.devloed@ugent.be</span></a><span class="font25">, buildheader.pl script</span></p></li></ul>
<p><span class="font25">We'd also like to thank our reviewers:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">• Wouter Verhelst: </span><a href="mailto:wouter@grep.be"><span class="font25">wouter@grep.be</span></a><span class="font25">, </span><a href="http://grep.be"><span class="font25">http://grep.be</span></a></p></li>
<li>
<p><span class="font25">• Geert Goossens: </span><a href="mailto:mail.goossens.geert@gmail.com"><span class="font25">mail.goossens.geert@gmail.com</span></a><span class="font25">, </span><a href="http://www.linkedin.com/in/"><span class="font25">http://www.linkedin.com/in/</span></a><span class="font25"> geertgoossens</span></p></li>
<li>
<p><span class="font25">• Elie De Brauwer: </span><a href="mailto:elie@de-brauwer.be"><span class="font25">elie@de-brauwer.be</span></a><span class="font25">, </span><a href="http://www.de-brauwer.be"><span class="font25">http://www.de-brauwer.be</span></a></p></li>
<li>
<p><span class="font25">• Christophe Vandeplas: </span><a href="mailto:christophe@vandeplas.com"><span class="font25">christophe@vandeplas.com</span></a><span class="font25">, </span><a href="http://christophe.vandeplas.com"><span class="font25">http://christophe.vandeplas.com</span></a></p></li>
<li>
<p><span class="font25">• Bert Desmet: </span><a href="mailto:bert@devnox.be"><span class="font25">bert@devnox.be</span></a><span class="font25">, </span><a href="http://bdesmet.be"><span class="font25">http://bdesmet.be</span></a></p></li>
<li>
<p><span class="font25">• Rich Yonts: </span><a href="mailto:richyonts@gmail.com"><span class="font25">richyonts@gmail.com</span></a><span class="font25">,</span></p></li></ul>
<p><span class="font25">Copyright 2007-2015 Paul Cobbaut</span></p>
<p><span class="font25">Permission is granted to copy, distribute and/or modify this document under the terms of the </span><span class="font25" style="font-weight:bold;">GNU Free Documentation License</span><span class="font25">, Version 1.3 or any later version published by the Free Software Foundation; with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts. A copy of the license is included in the section entitled 'GNU Free Documentation License'.</span></p>
<h3><a name="bookmark2979"></a><span class="font9" style="font-weight:bold;"><a name="bookmark2980"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2981"><span class="font24" style="font-weight:bold;">I. file security </span><span class="font24">[</span><span class="font24" style="font-weight:bold;">REMOVED - CHECK SECTION - 1</span><span class="font24">]</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2982"><span class="font24" style="font-weight:bold;">1. standard file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2983"><span class="font24">1.1. file ownership </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2984"><span class="font24">1.2. list of special files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2985"><span class="font24">1.3. permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2986"><span class="font24">1.4. practice: standard file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2987"><span class="font24">1.5. solution: standard file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2988"><span class="font24" style="font-weight:bold;">2. advanced file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2989"><span class="font24">2.1. sticky bit on directory </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2990"><span class="font24">2.2. setgid bit on directory </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2991"><span class="font24">2.3. setgid and setuid on regular files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2992"><span class="font24">2.4. setuid on sudo </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2993"><span class="font24">2.5. practice: sticky, setuid and setgid bits </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2994"><span class="font24">2.6. solution: sticky, setuid and setgid bits </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2995"><span class="font24" style="font-weight:bold;">3. access control lists </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2996"><span class="font24">3.1. acl in /etc/fstab </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2997"><span class="font24">3.2. getfacl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2998"><span class="font24">3.3. setfacl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2999"><span class="font24">3.4. remove an acl entry </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3000"><span class="font24">3.5. remove the complete acl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3001"><span class="font24">3.6. the acl mask </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3002"><span class="font24">3.7. eiciel </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3003"><span class="font24" style="font-weight:bold;">4. file links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3004"><span class="font24">4.1. inodes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3005"><span class="font24">4.2. about directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3006"><span class="font24">4.3. hard links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3007"><span class="font24">4.4. symbolic links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3008"><span class="font24">4.5. removing links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3009"><span class="font24">4.6. practice : links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3010"><span class="font24">4.7. solution : links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3011"><span class="font24">II. disk management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3012"><span class="font24" style="font-weight:bold;">5. disk devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3013"><span class="font24">5.1. terminology </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3014"><span class="font24">5.2. device naming </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3015"><span class="font24">5.3. discovering disk devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3016"><span class="font24">5.4. erasing a hard disk </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3017"><span class="font24">5.5. advanced hard disk settings </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3018"><span class="font24">5.6. practice: hard disk devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3019"><span class="font24">5.7. solution: hard disk devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3020"><span class="font24" style="font-weight:bold;">6. disk partitions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3021"><span class="font24">6.1. about partitions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3022"><span class="font24">6.2. discovering partitions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3023"><span class="font24">6.3. partitioning new disks </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3024"><span class="font24">6.4. about the partition table </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3025"><span class="font24">6.5. GUID partition table </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3026"><span class="font24">6.6. labeling with parted </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3027"><span class="font24">6.7. practice: partitions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3028"><span class="font24">6.8. solution: partitions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3029"><span class="font24" style="font-weight:bold;">7. file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3030"><span class="font24">7.1. about file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3031"><span class="font24">7.2. common file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3032"><span class="font24">7.3. putting a file system on a partition </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3033"><span class="font24">7.4. tuning a file system </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3034"><span class="font24">7.5. checking a file system </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3035"><span class="font24">7.6. practice: file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3036"><span class="font24">7.7. solution: file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3037"><span class="font24" style="font-weight:bold;">8. mounting </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3038"><span class="font24">8.1. mounting local file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3039"><span class="font24">8.2. displaying mounted file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3040"><span class="font24">8.3. from start to finish </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3041"><span class="font24">8.4. permanent mounts </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3042"><span class="font24">8.5. securing mounts </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3043"><span class="font24">8.6. mounting remote file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3044"><span class="font24">8.7. practice: mounting file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3045"><span class="font24">8.8. solution: mounting file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3046"><span class="font24" style="font-weight:bold;">9. troubleshooting tools </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3047"><span class="font24">9.1. lsof </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3048"><span class="font24">9.2. fuser </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3049"><span class="font24">9.3. chroot </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3050"><span class="font24">9.4. iostat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3051"><span class="font24">9.5. iotop </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3052"><span class="font24">9.6. vmstat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3053"><span class="font24">9.7. practice: troubleshooting tools </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3054"><span class="font24">9.8. solution: troubleshooting tools </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3055"><span class="font24" style="font-weight:bold;">10. introduction to uuid's </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3056"><span class="font24">10.1. about unique objects </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3057"><span class="font24">10.2. tune2fs </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3058"><span class="font24">10.3. uuid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3059"><span class="font24">10.4. uuid in /etc/fstab </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3060"><span class="font24">10.5. uuid as a boot device </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3061"><span class="font24">10.6. practice: uuid and filesystems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3062"><span class="font24">10.7. solution: uuid and filesystems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3063"><span class="font24" style="font-weight:bold;">11. introduction to raid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3064"><span class="font24">11.1. hardware or software </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3065"><span class="font24">11.2. raid levels </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3066"><span class="font24">11.3. building a software raid5 array </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3067"><span class="font24">11.4. practice: raid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3068"><span class="font24">11.5. solution: raid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3069"><span class="font24" style="font-weight:bold;">12. logical volume management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3070"><span class="font24">12.1. introduction to lvm </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3071"><span class="font24">12.2. lvm terminology </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3072"><span class="font24">12.3. example: using lvm </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3073"><span class="font24">12.4. example: extend a logical volume </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3074"><span class="font24">12.5. example: resize a physical Volume </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3075"><span class="font24">12.6. example: mirror a logical volume </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3076"><span class="font24">12.7. example: snapshot a logical volume </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3077"><span class="font24">12.8. verifying existing physical volumes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3078"><span class="font24">12.9. verifying existing volume groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3079"><span class="font24">12.10. verifying existing logical volumes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3080"><span class="font24">12.11. manage physical volumes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3081"><span class="font24">12.12. manage volume groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3082"><span class="font24">12.13. manage logical volumes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3083"><span class="font24">12.14. practice : lvm </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3084"><span class="font24">12.15. solution : lvm </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3085"><span class="font24" style="font-weight:bold;">13. iSCSI devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3086"><span class="font24">13.1. iSCSI terminology </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3087"><span class="font24">13.2. iSCSI Target in RHEL/CentOS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3088"><span class="font24">13.3. iSCSI Initiator in RHEL/CentOS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3089"><span class="font24">13.4. iSCSI target on Debian </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3090"><span class="font24">13.5. iSCSI target setup with dd files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3091"><span class="font24">13.6. ISCSI initiator on ubuntu </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3092"><span class="font24">13.7. using iSCSI devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3093"><span class="font24">13.8. iSCSI Target RHEL7/CentOS7 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3094"><span class="font24">13.9. iSCSI Initiator RHEL7/CentOS7 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3095"><span class="font24">13.10. practice: iSCSI devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3096"><span class="font24">13.11. solution: iSCSI devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3097"><span class="font24" style="font-weight:bold;">14. introduction to multipathing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3098"><span class="font24">14.1. install multipath </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3099"><span class="font24">14.2. configure multipath </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3100"><span class="font24">14.3. network </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3101"><span class="font24">14.4. start multipathd and iscsi </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3102"><span class="font24">14.5. multipath list </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3103"><span class="font24">14.6. using the device </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3104"><span class="font24">14.7. practice: multipathing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3105"><span class="font24">14.8. solution: multipathing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3106"><span class="font24" style="font-weight:bold;">III. backup management </span><span class="font24">[</span><span class="font24" style="font-weight:bold;">REMOVED - CHECK SECTION - 4</span><span class="font24">]</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3107"><span class="font24" style="font-weight:bold;">15. backup </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3108"><span class="font24">15.1. About tape devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3109"><span class="font24">15.2. Compression </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3110"><span class="font24">15.3. tar </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3111"><span class="font24">15.4. Backup Types </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3112"><span class="font24">15.5. dump and restore </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3113"><span class="font24">15.6. cpio </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3114"><span class="font24">15.7. dd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3115"><span class="font24">15.8. split </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3116"><span class="font24">15.9. practice: backup </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3117"><span class="font24" style="font-weight:bold;">IV. mysql database </span><span class="font24">[</span><span class="font24" style="font-weight:bold;">REMOVED - CHECK SECTION - 5</span><span class="font24">]</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3118"><span class="font24" style="font-weight:bold;">16. introduction to sql using mysql </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3119"><span class="font24">16.1. installing mysql </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3120"><span class="font24">16.2. accessing mysql </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3121"><span class="font24">16.3. mysql databases </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3122"><span class="font24">16.4. mysql tables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3123"><span class="font24">16.5. mysql records </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3124"><span class="font24">16.6. joining two tables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3125"><span class="font24">16.7. mysql triggers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3126"><span class="font24" style="font-weight:bold;">V. Introduction to Samba [REMOVED - CHECK SECTION - 5]</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3127"><span class="font24" style="font-weight:bold;">17. introduction to samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3128"><span class="font24">17.1. verify installed version </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3129"><span class="font24">17.2. installing samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3130"><span class="font24">17.3. documentation </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3131"><span class="font24">17.4. starting and stopping samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3132"><span class="font24">17.5. samba daemons </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3133"><span class="font24">17.6. the SMB protocol </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3134"><span class="font24">17.7. practice: introduction to samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3135"><span class="font24" style="font-weight:bold;">18. getting started with samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3136"><span class="font24">18.1. /etc/samba/smb.conf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3137"><span class="font24">18.2. /usr/bin/testparm </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3138"><span class="font24">18.3. /usr/bin/smbclient </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3139"><span class="font24">18.4. /usr/bin/smbtree </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3140"><span class="font24">18.5. server string </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3141"><span class="font24">18.6. Samba Web Administration Tool (SWAT) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3142"><span class="font24">18.7. practice: getting started with samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3143"><span class="font24">18.8. solution: getting started with samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3144"><span class="font24" style="font-weight:bold;">19. a read only file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3145"><span class="font24">19.1. Setting up a directory to share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3146"><span class="font24">19.2. configure the share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3147"><span class="font24">19.3. restart the server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3148"><span class="font24">19.4. verify the share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3149"><span class="font24">19.5. a note on netcat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3150"><span class="font24">19.6. practice: read only file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3151"><span class="font24">19.7. solution: read only file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3152"><span class="font24" style="font-weight:bold;">20. a writable file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3153"><span class="font24">20.1. set up a directory to share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3154"><span class="font24">20.2. share section in smb.conf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3155"><span class="font24">20.3. configure the share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3156"><span class="font24">20.4. test connection with windows </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3157"><span class="font24">20.5. test writing with windows </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3158"><span class="font24">20.6. How is this possible ? </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3159"><span class="font24">20.7. practice: writable file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3160"><span class="font24">20.8. solution: writable file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3161"><span class="font24" style="font-weight:bold;">21. samba first user account </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3162"><span class="font24">21.1. creating a samba user </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3163"><span class="font24">21.2. ownership of files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3164"><span class="font24">21.3. /usr/bin/smbpasswd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3165"><span class="font24">21.4. /etc/samba/smbpasswd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3166"><span class="font24">21.5. passdb backend </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3167"><span class="font24">21.6. forcing this user </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3168"><span class="font24">21.7. practice: first samba user account </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3169"><span class="font24">21.8. solution: first samba user account </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3170"><span class="font24" style="font-weight:bold;">22. samba authentication </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3171"><span class="font24">22.1. creating the users on Linux </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3172"><span class="font24">22.2. creating the users on samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3173"><span class="font24">22.3. security = user </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3174"><span class="font24">22.4. configuring the share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3175"><span class="font24">22.5. testing access with net use </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3176"><span class="font24">22.6. testing access with smbclient </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3177"><span class="font24">22.7. verify ownership </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3178"><span class="font24">22.8. common problems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3179"><span class="font24">22.9. practice : samba authentication </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3180"><span class="font24">22.10. solution: samba authentication </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3181"><span class="font24" style="font-weight:bold;">23. samba securing shares </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3182"><span class="font24">23.1. security based on user name </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3183"><span class="font24">23.2. security based on ip-address </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3184"><span class="font24">23.3. security through obscurity </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3185"><span class="font24">23.4. file system security </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3186"><span class="font24">23.5. practice: securing shares </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3187"><span class="font24">23.6. solution: securing shares </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3188"><span class="font24" style="font-weight:bold;">24. samba domain member </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3189"><span class="font24">24.1. changes in smb.conf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3190"><span class="font24">24.2. joining an Active Directory domain </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3191"><span class="font24">24.3. winbind </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3192"><span class="font24">24.4. wbinfo </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3193"><span class="font24">24.5. getent </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3194"><span class="font24">24.6. file ownership </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3195"><span class="font24">24.7. practice : samba domain member </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3196"><span class="font24" style="font-weight:bold;">25. samba domain controller </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3197"><span class="font24">25.1. about Domain Controllers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3198"><span class="font24">25.2. About security modes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3199"><span class="font24">25.3. About password backends </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3200"><span class="font24">25.4. [global] section in smb.conf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3201"><span class="font24">25.5. netlogon share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3202"><span class="font24">25.6. other [share] sections </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3203"><span class="font24">25.7. Users and Groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3204"><span class="font24">25.8. tdbsam </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3205"><span class="font24">25.9. about computer accounts </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3206"><span class="font24">25.10. local or roaming profiles </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3207"><span class="font24">25.11. Groups in NTFS acls </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3208"><span class="font24">25.12. logon scripts </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3209"><span class="font24">25.13. practice: samba domain controller </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3210"><span class="font24" style="font-weight:bold;">26. a brief look at samba 4 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3211"><span class="font24">26.1. Samba 4 alpha 6 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3212"><span class="font24">VI. Appendix </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3213"><span class="font24" style="font-weight:bold;">A. License </span></a></p></li></ul>
<p><a href="#bookmark3214"><span class="font24">Index </span></a></p>
<h3><a name="bookmark3215"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3216"></a>List of Tables</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3217"><span class="font24">1.1. Unix special files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3218"><span class="font24">1.2. standard Unix file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3219"><span class="font24">1.3. Unix file permissions position </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3220"><span class="font24">1.4. Octal permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3221"><span class="font24">5.1. ide device naming </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3222"><span class="font24">5.2. scsi device naming </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3223"><span class="font24">6.1. primary, extended and logical partitions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3224"><span class="font24">6.2. Partition naming </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3225"><span class="font24">13.1. iSCSI Target and Initiator practice </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3226"><span class="font24">13.2. iSCSI Target and Initiator practice </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a name="bookmark3227"></a><span class="font11" style="font-weight:bold;">Part II. disk management</span></p></li></ul>
<h3><a name="bookmark3228"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3229"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3230"><span class="font24" style="font-weight:bold;">5. disk devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3231"><span class="font24">5.1. terminology </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3232"><span class="font24">5.2. device naming </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3233"><span class="font24">5.3. discovering disk devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3234"><span class="font24">5.4. erasing a hard disk </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3235"><span class="font24">5.5. advanced hard disk settings </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3236"><span class="font24">5.6. practice: hard disk devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3237"><span class="font24">5.7. solution: hard disk devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3238"><span class="font24" style="font-weight:bold;">6. disk partitions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3239"><span class="font24">6.1. about partitions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3240"><span class="font24">6.2. discovering partitions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3241"><span class="font24">6.3. partitioning new disks </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3242"><span class="font24">6.4. about the partition table </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3243"><span class="font24">6.5. GUID partition table </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3244"><span class="font24">6.6. labeling with parted </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3245"><span class="font24">6.7. practice: partitions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3246"><span class="font24">6.8. solution: partitions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3247"><span class="font24" style="font-weight:bold;">7. file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3248"><span class="font24">7.1. about file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3249"><span class="font24">7.2. common file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3250"><span class="font24">7.3. putting a file system on a partition </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3251"><span class="font24">7.4. tuning a file system </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3252"><span class="font24">7.5. checking a file system </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3253"><span class="font24">7.6. practice: file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3254"><span class="font24">7.7. solution: file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3255"><span class="font24" style="font-weight:bold;">8. mounting </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3256"><span class="font24">8.1. mounting local file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3257"><span class="font24">8.2. displaying mounted file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3258"><span class="font24">8.3. from start to finish </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3259"><span class="font24">8.4. permanent mounts </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3260"><span class="font24">8.5. securing mounts </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3261"><span class="font24">8.6. mounting remote file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3262"><span class="font24">8.7. practice: mounting file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3263"><span class="font24">8.8. solution: mounting file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3264"><span class="font24" style="font-weight:bold;">9. troubleshooting tools </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3265"><span class="font24">9.1. lsof </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3266"><span class="font24">9.2. fuser </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3267"><span class="font24">9.3. chroot </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3268"><span class="font24">9.4. iostat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3269"><span class="font24">9.5. iotop </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3270"><span class="font24">9.6. vmstat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3271"><span class="font24">9.7. practice: troubleshooting tools </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3272"><span class="font24">9.8. solution: troubleshooting tools </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3273"><span class="font24" style="font-weight:bold;">10. introduction to uuid's </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3274"><span class="font24">10.1. about unique objects </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3275"><span class="font24">10.2. tune2fs </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3276"><span class="font24">10.3. uuid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3277"><span class="font24">10.4. uuid in /etc/fstab </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3278"><span class="font24">10.5. uuid as a boot device </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3279"><span class="font24">10.6. practice: uuid and filesystems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3280"><span class="font24">10.7. solution: uuid and filesystems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3281"><span class="font24" style="font-weight:bold;">11. introduction to raid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3282"><span class="font24">11.1. hardware or software </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3283"><span class="font24">11.2. raid levels </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3284"><span class="font24">11.3. building a software raid5 array </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3285"><span class="font24">11.4. practice: raid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3286"><span class="font24">11.5. solution: raid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3287"><span class="font24" style="font-weight:bold;">12. logical volume management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3288"><span class="font24">12.1. introduction to lvm </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3289"><span class="font24">12.2. lvm terminology </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3290"><span class="font24">12.3. example: using lvm </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3291"><span class="font24">12.4. example: extend a logical volume </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3292"><span class="font24">12.5. example: resize a physical Volume </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3293"><span class="font24">12.6. example: mirror a logical volume </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3294"><span class="font24">12.7. example: snapshot a logical volume </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3295"><span class="font24">12.8. verifying existing physical volumes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3296"><span class="font24">12.9. verifying existing volume groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3297"><span class="font24">12.10. verifying existing logical volumes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3298"><span class="font24">12.11. manage physical volumes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3299"><span class="font24">12.12. manage volume groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3300"><span class="font24">12.13. manage logical volumes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3301"><span class="font24">12.14. practice : lvm </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3302"><span class="font24">12.15. solution : lvm </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3303"><span class="font24" style="font-weight:bold;">13. iSCSI devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3304"><span class="font24">13.1. iSCSI terminology </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3305"><span class="font24">13.2. iSCSI Target in RHEL/CentOS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3306"><span class="font24">13.3. iSCSI Initiator in RHEL/CentOS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3307"><span class="font24">13.4. iSCSI target on Debian </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3308"><span class="font24">13.5. iSCSI target setup with dd files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3309"><span class="font24">13.6. ISCSI initiator on ubuntu </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3310"><span class="font24">13.7. using iSCSI devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3311"><span class="font24">13.8. iSCSI Target RHEL7/CentOS7 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3312"><span class="font24">13.9. iSCSI Initiator RHEL7/CentOS7 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3313"><span class="font24">13.10. practice: iSCSI devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3314"><span class="font24">13.11. solution: iSCSI devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3315"><span class="font24" style="font-weight:bold;">14. introduction to multipathing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3316"><span class="font24">14.1. install multipath </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3317"><span class="font24">14.2. configure multipath </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3318"><span class="font24">14.3. network </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3319"><span class="font24">14.4. start multipathd and iscsi </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3320"><span class="font24">14.5. multipath list </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3321"><span class="font24">14.6. using the device </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3322"><span class="font24">14.7. practice: multipathing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3323"><span class="font24">14.8. solution: multipathing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark3324"></a><span class="font11" style="font-weight:bold;"><a name="bookmark3325"></a><a name="bookmark3326"></a>Chapter 5. disk devices</span></h1></li></ul>
<p><span class="font25">This chapter teaches you how to locate and recognise </span><span class="font25" style="font-weight:bold;">hard disk devices</span><span class="font25">. This prepares you for the next chapter, where we put </span><span class="font25" style="font-weight:bold;">partitions </span><span class="font25">on these devices.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3327"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3013"></a><a name="bookmark3328"></a>5.1. terminology</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark3329"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3330"></a>5.1.1. platter, head, track, cylinder, sector</span></h3></li></ul></li></ul>
<p><a name="bookmark3331"></a><span class="font25"><a name="bookmark3332"></a>Data is commonly stored on magnetic or optical </span><span class="font25" style="font-weight:bold;">disk platters</span><span class="font25">. The platters are rotated (at high speeds). Data is read by </span><span class="font25" style="font-weight:bold;">heads</span><span class="font25">, which are very close to the surface of the platter, without touching it! The heads are mounted on an arm (sometimes called a comb or a fork).</span></p>
<p><a name="bookmark3333"></a><span class="font25"><a name="bookmark3334"></a><a name="bookmark3335"></a><a name="bookmark3336"></a>Data is written in concentric circles called </span><span class="font25" style="font-weight:bold;">tracks</span><span class="font25">. Track zero is (usually) on the outside. The time it takes to position the head over a certain track is called the </span><span class="font25" style="font-weight:bold;">seek time</span><span class="font25">. Often the platters are stacked on top of each other, hence the set of tracks accessible at a certain position of the comb forms a </span><span class="font25" style="font-weight:bold;">cylinder</span><span class="font25">. Tracks are divided into 512 byte </span><span class="font25" style="font-weight:bold;">sectors</span><span class="font25">, with more unused space (</span><span class="font25" style="font-weight:bold;">gap</span><span class="font25">) between the sectors on the outside of the platter.</span></p>
<p><a name="bookmark3337"></a><span class="font25"><a name="bookmark3338"></a>When you break down the advertised </span><span class="font25" style="font-weight:bold;">access time </span><span class="font25">of a hard drive, you will notice that most of that time is taken by movement of the heads (about 65%) and </span><span class="font25" style="font-weight:bold;">rotational latency </span><span class="font25">(about 30%).</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3339"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3340"></a>5.1.2. ide or scsi</span></h3></li></ul>
<p><a name="bookmark3341"></a><span class="font25"><a name="bookmark3342"></a>Actually, the title should be </span><span class="font25" style="font-weight:bold;">ata </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">scsi</span><span class="font25">, since ide is an ata compatible device. Most desktops use </span><span class="font25" style="font-weight:bold;">ata devices</span><span class="font25">, most servers use </span><span class="font25" style="font-weight:bold;">scsi</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3343"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3344"></a>5.1.3. ata</span></h3></li></ul>
<p><a name="bookmark3345"></a><span class="font25"><a name="bookmark3346"></a><a name="bookmark3347"></a>An </span><span class="font25" style="font-weight:bold;">ata controller </span><span class="font25">allows two devices per bus, one </span><span class="font25" style="font-weight:bold;">master </span><span class="font25">and one </span><span class="font25" style="font-weight:bold;">slave</span><span class="font25">. Unless your controller and devices support </span><span class="font25" style="font-weight:bold;">cable select</span><span class="font25">, you have to set this manually with jumpers.</span></p>
<p><a name="bookmark3348"></a><span class="font25"><a name="bookmark3349"></a><a name="bookmark3350"></a>With the introduction of </span><span class="font25" style="font-weight:bold;">sata </span><span class="font25">(serial ata), the original ata was renamed to </span><span class="font25" style="font-weight:bold;">parallel ata</span><span class="font25">. Optical drives often use </span><span class="font25" style="font-weight:bold;">atapi</span><span class="font25">, which is an ATA interface using the SCSI communication protocol.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3351"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3352"></a>5.1.4. scsi</span></h3></li></ul>
<p><a name="bookmark3353"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">scsi controller </span><span class="font25">allows more than two devices. When using </span><span class="font25" style="font-weight:bold;">SCSI (small computer system interface)</span><span class="font25">, each device gets a unique </span><span class="font25" style="font-weight:bold;">scsi id</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">scsi controller </span><span class="font25">also needs a </span><span class="font25" style="font-weight:bold;">scsi id</span><span class="font25">, do not use this id for a scsi-attached device.</span></p>
<p><span class="font25">Older 8-bit SCSI is now called </span><span class="font25" style="font-weight:bold;">narrow</span><span class="font25">, whereas 16-bit is </span><span class="font25" style="font-weight:bold;">wide</span><span class="font25">. When the bus speeds was doubled to 10Mhz, this was known as </span><span class="font25" style="font-weight:bold;">fast SCSI</span><span class="font25">. Doubling to 20Mhz made it </span><span class="font25" style="font-weight:bold;">ultra SCSI</span><span class="font25">. Take a look at </span><a href="http://en.wikipedia.org/wiki/SCSI"><span class="font25">http://en.wikipedia.org/wiki/SCSI</span></a><span class="font25"> for more SCSI standards.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3354"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3355"></a>5.1.5. block device</span></h3></li></ul>
<p><a name="bookmark3356"></a><span class="font25">Random access hard disk devices have an abstraction layer called </span><span class="font25" style="font-weight:bold;">block device </span><span class="font25">to enable formatting in fixed-size (usually 512 bytes) blocks. Blocks can be accessed independent of access to other blocks.</span></p>
<table border="1">
<tr><td colspan="9" style="vertical-align:bottom;">
<p><span class="font19">[root@centos65 ~]# lsblk</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">NAME</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">MAJ:MIN</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">RM</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIZE</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">RO</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">TYPE</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">MOUNTPOINT</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sda</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">8 : 0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">40G</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">disk</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">--sda1</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">8:1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">500M</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">part</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/boot</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">--sda2</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">8:2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">39.5G</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">part</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">--VolGroup-lv_</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">(dm-0)</span></p></td><td style="vertical-align:top;">
<p><span class="font19">253 : 0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">38.6G</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">lvm</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">--VolGroup-lv_</span></p></td><td style="vertical-align:top;">
<p><span class="font19">_swap</span></p></td><td style="vertical-align:top;">
<p><span class="font19">(dm-1)</span></p></td><td style="vertical-align:top;">
<p><span class="font19">253:1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">928M</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">lvm</span></p></td><td style="vertical-align:top;">
<p><span class="font19">[SWAP]</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">sdb</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">8:16</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">72G</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">disk</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">sdc</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">8:32</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">144G</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">disk</span></p></td><td style="vertical-align:top;"></td></tr>
</table>
<p><span class="font25">A block device has the letter b to denote the file type in the output of </span><span class="font25" style="font-weight:bold;">ls -l</span><span class="font25">.</span></p>
<p><span class="font19">[root@centos65 ~]# Is -l /dev/sd*</span></p>
<p><span class="font19">brw-rw----. 1 root disk 8, &nbsp;0 Apr 19 10:12 /dev/sda</span></p>
<p><span class="font19">brw-rw----. 1 root disk 8, &nbsp;1 Apr 19 10:12 /dev/sda1</span></p>
<p><span class="font19">brw-rw----. 1 root disk 8, &nbsp;2 Apr 19 10:12 /dev/sda2</span></p>
<p><span class="font19">brw-rw----. 1 root disk 8, 16 Apr 19 10:12 /dev/sdb</span></p>
<p><span class="font19">brw-rw----. 1 root disk 8, 32 Apr 19 10:12 /dev/sdc</span></p>
<p><a name="bookmark3357"></a><span class="font25">Note that a </span><span class="font25" style="font-weight:bold;">character device </span><span class="font25">is a constant stream of characters, being denoted by a c in </span><span class="font25" style="font-weight:bold;">ls -l</span><span class="font25">. Note also that the </span><span class="font25" style="font-weight:bold;">ISO 9660 </span><span class="font25">standard for cdrom uses a </span><span class="font25" style="font-weight:bold;">2048 byte </span><span class="font25">block size.</span></p>
<p><a name="bookmark3358"></a><span class="font25"><a name="bookmark3359"></a>Old hard disks (and floppy disks) use </span><span class="font25" style="font-weight:bold;">cylinder-head-sector </span><span class="font25">addressing to access a sector on the disk. Most current disks use </span><span class="font25" style="font-weight:bold;">LBA (Logical Block Addressing)</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3360"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3361"></a>5.1.6. solid state drive</span></h3></li></ul>
<p><a name="bookmark3362"></a><span class="font25"><a name="bookmark3363"></a>A </span><span class="font25" style="font-weight:bold;">solid state drive </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">ssd </span><span class="font25">is a block device without moving parts. It is comparable to </span><span class="font25" style="font-weight:bold;">flash memory</span><span class="font25">. An </span><span class="font25" style="font-weight:bold;">ssd </span><span class="font25">is more expensive than a hard disk, but it typically has a much faster access time.</span></p>
<p><span class="font25">In this book we will use the following pictograms for </span><span class="font25" style="font-weight:bold;">spindle disks </span><span class="font25">(in brown) and </span><span class="font25" style="font-weight:bold;">solid state disks </span><span class="font25">(in blue).</span></p><img src="linux_guide_files/The Complete Linux Guide-87.jpg" alt="" style="width:199pt;height:185pt;">
<ul style="list-style:none;"><li>
<h2><a name="bookmark3364"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3014"></a><a name="bookmark3365"></a>5.2. device naming</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark3221"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3366"></a>5.2.1. ata (ide) device naming</span></h3></li></ul></li></ul>
<p><a name="bookmark3367"></a><span class="font25"><a name="bookmark3368"></a>All </span><span class="font25" style="font-weight:bold;">ata </span><span class="font25">drives on your system will start with </span><span class="font25" style="font-weight:bold;">/dev/hd </span><span class="font25">followed by a unit letter. The master hdd on the first </span><span class="font25" style="font-weight:bold;">ata controller </span><span class="font25">is /dev/hda, the slave is /dev/hdb. For the second controller, the names of the devices are /dev/hdc and /dev/hdd.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 5.1. ide device naming</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">controller</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">connection</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">device name</span></p></td></tr>
<tr><td rowspan="2" style="vertical-align:middle;">
<p><span class="font24">ide0</span></p></td><td style="vertical-align:top;">
<p><span class="font24">master</span></p></td><td style="vertical-align:top;">
<p><span class="font24">/dev/hda</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">slave</span></p></td><td style="vertical-align:top;">
<p><span class="font24">/dev/hdb</span></p></td></tr>
<tr><td rowspan="2" style="vertical-align:middle;">
<p><span class="font24">idel</span></p></td><td style="vertical-align:top;">
<p><span class="font24">master</span></p></td><td style="vertical-align:top;">
<p><span class="font24">/dev/hdc</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">slave</span></p></td><td style="vertical-align:top;">
<p><span class="font24">/dev/hdd</span></p></td></tr>
</table>
<p><span class="font25">It is possible to have only </span><span class="font25" style="font-weight:bold;">/dev/hda </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/dev/hdd</span><span class="font25">. The first one is a single ata hard disk, the second one is the cdrom (by default configured as slave).</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3222"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3369"></a>5.2.2. scsi device naming</span></h3></li></ul>
<p><a name="bookmark3370"></a><span class="font25" style="font-weight:bold;">scsi </span><span class="font25">drives follow a similar scheme, but all start with </span><span class="font25" style="font-weight:bold;">/dev/sd</span><span class="font25">. When you run out of letters (after /dev/sdz), you can continue with /dev/sdaa and /dev/sdab and so on. (We will see later on that </span><span class="font25" style="font-weight:bold;">lvm </span><span class="font25">volumes are commonly seen as /dev/md0, /dev/md1 etc.)</span></p>
<p><a name="bookmark3371"></a><span class="font25">Below a </span><span class="font25" style="font-weight:bold;">sample </span><span class="font25">of how scsi devices on a Linux can be named. Adding a scsi disk or raid controller with a lower scsi address will change the naming scheme (shifting the higher scsi addresses one letter further in the alphabet).</span></p>
<p><span class="font25" style="font-weight:bold;">Table 5.2. scsi device naming</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">device</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">scsi id</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">device name</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">disk 0</span></p></td><td style="vertical-align:top;">
<p><span class="font24">0</span></p></td><td style="vertical-align:top;">
<p><span class="font24">/dev/sda</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">disk 1</span></p></td><td style="vertical-align:top;">
<p><span class="font24">1</span></p></td><td style="vertical-align:top;">
<p><span class="font24">/dev/sdb</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">raid controller 0</span></p></td><td style="vertical-align:top;">
<p><span class="font24">5</span></p></td><td style="vertical-align:top;">
<p><span class="font24">/dev/sdc</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">raid controller 1</span></p></td><td style="vertical-align:top;">
<p><span class="font24">6</span></p></td><td style="vertical-align:top;">
<p><span class="font24">/dev/sdd</span></p></td></tr>
</table>
<p><span class="font25">A modern Linux system will use </span><span class="font25" style="font-weight:bold;">/dev/sd* </span><span class="font25">for scsi and sata devices, and also for sd-cards, usb-sticks, (legacy) ATA/IDE devices and solid state drives.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3372"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3015"></a><a name="bookmark3373"></a>5.3. discovering disk devices</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark3374"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3375"></a>5.3.1. fdisk</span></h3></li></ul></li></ul>
<h4><a name="bookmark3376"></a><span class="font25"><a name="bookmark3377"></a><a name="bookmark3378"></a>You can start by using </span><span class="font25" style="font-weight:bold;">/sbin/fdisk </span><span class="font25">to find out what kind of disks are seen by the kernel.</span><br><br><span class="font25"><a name="bookmark3379"></a>Below the result on old Debian desktop, with two </span><span class="font25" style="font-weight:bold;">ata-ide disks </span><span class="font25">present.</span></h4>
<p><span class="font19">root@barry:~# fdisk -l | grep Disk</span></p>
<p><span class="font19">Disk /dev/hda: 60.0 GB, 60022480896 bytes</span></p>
<p><span class="font19">Disk /dev/hdb: 81.9 GB, 81964302336 bytes</span></p>
<h4><a name="bookmark3380"></a><span class="font25"><a name="bookmark3381"></a>And here an example of </span><span class="font25" style="font-weight:bold;">sata and scsi disks </span><span class="font25">on a server with CentOS. Remember that </span><span class="font25" style="font-weight:bold;">sata </span><span class="font25">disks are also presented to you with the </span><span class="font25" style="font-weight:bold;">scsi </span><span class="font25">/dev/sd* notation.</span></h4>
<p><span class="font19">[root@centos65 ~]# fdisk -l | grep 'Disk /dev/sd'</span></p>
<p><span class="font19">Disk /dev/sda: 42.9 GB, 42949672960 bytes</span></p>
<p><span class="font19">Disk /dev/sdb: 77.3 GB, 77309411328 bytes</span></p>
<p><span class="font19">Disk /dev/sdc: 154.6 GB, 154618822656 bytes</span></p>
<p><span class="font19">Disk /dev/sdd: 154.6 GB, 154618822656 bytes</span></p>
<h4><a name="bookmark3382"></a><span class="font25"><a name="bookmark3383"></a>Here is an overview of disks on a RHEL4u3 server with two real 72GB </span><span class="font25" style="font-weight:bold;">scsi disks</span><span class="font25">. This server is attached to a </span><span class="font25" style="font-weight:bold;">NAS </span><span class="font25">with four </span><span class="font25" style="font-weight:bold;">NAS disks </span><span class="font25">of half a terabyte. On the NAS disks, four LVM (/dev/mdx) software RAID devices are configured.</span></h4>
<p><span class="font19">[root@tsvtl1 ~]# fdisk -l | grep Disk Disk /dev/sda: 73.4 GB, 73407488000 bytes Disk /dev/sdb: 73.4 GB, 73407488000 bytes Disk /dev/sdc: 499.0 GB, 499036192768 bytes Disk /dev/sdd: 499.0 GB, 499036192768 bytes Disk /dev/sde: 499.0 GB, 499036192768 bytes Disk /dev/sdf: 499.0 GB, 499036192768 bytes Disk /dev/md0: 271 MB, 271319040 bytes Disk /dev/md2: 21.4 GB, 21476081664 bytes Disk /dev/md3: 21.4 GB, 21467889664 bytes Disk /dev/md1: 21.4 GB, 21476081664 bytes</span></p>
<h4><a name="bookmark3384"></a><span class="font25"><a name="bookmark3385"></a>You can also use </span><span class="font25" style="font-weight:bold;">fdisk </span><span class="font25">to obtain information about one specific hard disk device.</span></h4>
<p><span class="font19">[root@centos65 ~]# fdisk -l /dev/sdc</span></p>
<p><span class="font19">Disk /dev/sdc: 154.6 GB, 154618822656 bytes 255 heads, 63 sectors/track, 18798 cylinders Units = cylinders of 16065 * 512 = 8225280 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disk identifier: 0x00000000</span></p>
<h4><a name="bookmark3386"></a><span class="font25"><a name="bookmark3387"></a>Later we will use fdisk to do dangerous stuff like creating and deleting partitions.</span></h4>
<h3><a name="bookmark3388"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3389"></a>5.3.2. dmesg</span></h3>
<h4><a name="bookmark3390"></a><span class="font25"><a name="bookmark3391"></a><a name="bookmark3392"></a>Kernel boot messages can be seen after boot with </span><span class="font25" style="font-weight:bold;">dmesg</span><span class="font25">. Since hard disk devices are detected by the kernel during boot, you can also use dmesg to find information about disk devices.</span></h4>
<p><span class="font19">[root@centos65 ~]# dmesg | grep 'sd[a-z]' | head</span></p>
<p><span class="font19">sd 0:0:0:0: [sda] 83886080 512-byte logical blocks: (42.9 GB/40.0 GiB)</span></p>
<p><span class="font19">sd 0:0:0:0: [sda] Write Protect is off</span></p>
<p><span class="font19">sd 0:0:0:0: [sda] Mode Sense: 00 3a 00 00</span></p>
<p><span class="font19">sd 0:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn't support \ DPO or FUA sda: sda1 sda2</span></p>
<p><span class="font19">sd 0:0:0:0: [sda] Attached SCSI disk</span></p>
<p><span class="font19">sd 3:0:0:0: [sdb] 150994944 512-byte logical blocks: (77.3 GB/72.0 GiB)</span></p>
<p><span class="font19">sd 3:0:0:0: [sdb] Write Protect is off</span></p>
<p><span class="font19">sd 3:0:0:0: [sdb] Mode Sense: 00 3a 00 00</span></p>
<p><span class="font19">sd 3:0:0:0: [sdb] Write cache: enabled, read cache: enabled, doesn't support \ DPO or FUA</span></p>
<h4><a name="bookmark3393"></a><span class="font25"><a name="bookmark3394"></a><a name="bookmark3395"></a>Here is another example of </span><span class="font25" style="font-weight:bold;">dmesg </span><span class="font25">on a computer with a 200GB ata disk.</span></h4>
<p><span class="font19">paul@barry:~$ dmesg | grep -i &quot;ata disk&quot;</span></p>
<p><span class="font19">[ &nbsp;&nbsp;&nbsp;2.624149] hda: ST360021A, ATA DISK drive</span></p>
<p><span class="font19">[ &nbsp;&nbsp;&nbsp;2.904150] hdb: Maxtor 6Y080L0, ATA DISK drive</span></p>
<p><span class="font19">[ &nbsp;&nbsp;&nbsp;3.472148] hdd: WDC WD2000BB-98DWA0, ATA DISK drive</span></p>
<h4><a name="bookmark3396"></a><span class="font25"><a name="bookmark3397"></a>Third and last example of </span><span class="font25" style="font-weight:bold;">dmesg </span><span class="font25">running on RHEL5.3.</span></h4>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">root@rhel53</span></p></td><td style="vertical-align:top;">
<p><span class="font19">~# dmesg</span></p></td><td style="vertical-align:top;">
<p><span class="font19">| grep -i</span></p></td><td style="vertical-align:top;">
<p><span class="font19">&quot;scsi disk&quot;</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">sd 0:0:2:0:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Attached</span></p></td><td style="vertical-align:top;">
<p><span class="font19">scsi disk</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sda</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">sd 0:0:3:0:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Attached</span></p></td><td style="vertical-align:top;">
<p><span class="font19">scsi disk</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sdb</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">sd 0:0:6:0:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Attached</span></p></td><td style="vertical-align:top;">
<p><span class="font19">scsi disk</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sdc</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3398"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3399"></a>5.3.3. /sbin/lshw</span></h3></li></ul>
<h4><a name="bookmark3400"></a><span class="font25"><a name="bookmark3401"></a>The </span><span class="font25" style="font-weight:bold;">lshw </span><span class="font25">tool will </span><span class="font25" style="font-weight:bold;">list hardware</span><span class="font25">. With the right options </span><span class="font25" style="font-weight:bold;">lshw </span><span class="font25">can show a lot of information about disks (and partitions).</span></h4>
<h4><a name="bookmark3402"></a><span class="font25"><a name="bookmark3403"></a>Below a truncated screenshot on Debian 6:</span></h4>
<p><span class="font19">root@debian6~# lshw -class volume | grep -A1 -B2 scsi description: Linux raid autodetect partition physical id: 1 bus info: scsi@1:0.0.0,1 logical name: /dev/sdb1 _ _ description: Linux raid autodetect partition physical id: 1 bus info: scsi@2:0.0.0,1 logical name: /dev/sdc1 _ _ description: Linux raid autodetect partition physical id: 1 bus info: scsi@3:0.0.0,1 logical name: /dev/sdd1 _ _ description: Linux raid autodetect partition physical id: 1 bus info: scsi@4:0.0.0,1 logical name: /dev/sde1 _ _ vendor: Linux physical id: 1 bus info: scsi@0:0.0.0,1 logical name: /dev/sda1 _ _ vendor: Linux physical id: 2 bus info: scsi@0:0.0.0,2 logical name: /dev/sda2 _ _ description: Extended partition physical id: 3 bus info: scsi@0:0.0.0,3 logical name: /dev/sda3</span></p>
<h4><a name="bookmark3404"></a><span class="font25"><a name="bookmark3405"></a>Redhat and CentOS do not have this tool (unless you add a repository).</span></h4>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3406"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3407"></a>5.3.4. /sbin/lsscsi</span></h3></li></ul>
<h4><a name="bookmark3408"></a><span class="font25"><a name="bookmark3409"></a><a name="bookmark3410"></a>The </span><span class="font25" style="font-weight:bold;">lsscsi </span><span class="font25">command provides a nice readable output of all scsi (and scsi emulated devices).</span><br><br><span class="font25"><a name="bookmark3411"></a>This first screenshot shows </span><span class="font25" style="font-weight:bold;">lsscsi </span><span class="font25">on a SPARC system.</span></h4>
<p><span class="font19">root@shaka:~# lsscsi</span></p>
<p><span class="font19">[0:0:0:0] &nbsp;&nbsp;&nbsp;disk &nbsp;&nbsp;&nbsp;Adaptec &nbsp;RAID5 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V1.0 &nbsp;/dev/sda</span></p>
<p><span class="font19">[1:0:0:0] &nbsp;&nbsp;&nbsp;disk &nbsp;&nbsp;&nbsp;SEAGATE &nbsp;ST336605FSUN36G &nbsp;0438 &nbsp;/dev/sdb</span></p>
<p><span class="font19">root@shaka:~#</span></p>
<h4><a name="bookmark3412"></a><span class="font25"><a name="bookmark3413"></a>Below a screenshot of </span><span class="font25" style="font-weight:bold;">lsscsi </span><span class="font25">on a QNAP NAS (which has four 750GB disks and boots from a usb stick).</span></h4>
<p><span class="font19">lroot@debian6~# lsscsi</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">[0:0:0:0]</span></p></td><td style="vertical-align:top;">
<p><span class="font19">disk</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SanDisk</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Cruzer Edge</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1.19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/dev/sda</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[1:0:0:0]</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">disk</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ATA</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ST3750330AS</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SD04</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdb</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[2:0:0:0]</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">disk</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ATA</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ST3750330AS</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SD04</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdc</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[3:0:0:0]</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">disk</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ATA</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ST3750330AS</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SD04</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdd</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[4:0:0:0]</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">disk</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ATA</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ST3750330AS</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SD04</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sde</span></p></td></tr>
</table>
<h4><a name="bookmark3414"></a><span class="font25"><a name="bookmark3415"></a>This screenshot shows the classic output of </span><span class="font25" style="font-weight:bold;">lsscsi</span><span class="font25">.</span></h4>
<p><span class="font19">root@debian6~# lsscsi -c Attached devices:</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Host: scsi0 Channel: 00 Target: 00 Lun:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">00</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Vendor: SanDisk Model: Cruzer Edge</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">Rev:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1.19</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Type: &nbsp;&nbsp;Direct-Access</span></p>
<p><span class="font19">Host: scsi1 Channel: 00 Target: 00 Lun:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ANSI</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SCSI</span></p></td><td style="vertical-align:top;">
<p><span class="font19">revision:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">02</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Vendor: ATA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Model: ST3750330AS</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">Rev:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SD04</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Type: &nbsp;&nbsp;Direct-Access</span></p>
<p><span class="font19">Host: scsi2 Channel: 00 Target: 00 Lun:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ANSI</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SCSI</span></p></td><td style="vertical-align:top;">
<p><span class="font19">revision:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">05</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Vendor: ATA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Model: ST3750330AS</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">Rev:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SD04</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Type: &nbsp;&nbsp;Direct-Access</span></p>
<p><span class="font19">Host: scsi3 Channel: 00 Target: 00 Lun:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ANSI</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SCSI</span></p></td><td style="vertical-align:top;">
<p><span class="font19">revision:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">05</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Vendor: ATA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Model: ST3750330AS</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">Rev:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SD04</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Type: &nbsp;&nbsp;Direct-Access</span></p>
<p><span class="font19">Host: scsi4 Channel: 00 Target: 00 Lun:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ANSI</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SCSI</span></p></td><td style="vertical-align:top;">
<p><span class="font19">revision:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">05</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Vendor: ATA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Model: ST3750330AS</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">Rev:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SD04</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Type: &nbsp;&nbsp;Direct-Access</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">ANSI</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SCSI</span></p></td><td style="vertical-align:top;">
<p><span class="font19">revision:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">05</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3416"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3417"></a>5.3.5. /proc/scsi/scsi</span></h3></li></ul>
<h4><a name="bookmark3418"></a><span class="font25"><a name="bookmark3419"></a><a name="bookmark3420"></a>Another way to locate </span><span class="font25" style="font-weight:bold;">scsi </span><span class="font25">(or sd) devices is via </span><span class="font25" style="font-weight:bold;">/proc/scsi/scsi</span><span class="font25">.</span><br><br><span class="font25"><a name="bookmark3421"></a>This screenshot is from a </span><span class="font25" style="font-weight:bold;">sparc </span><span class="font25">computer with adaptec RAID5.</span></h4>
<p><span class="font19">root@shaka:~# cat /proc/scsi/scsi</span></p>
<p><span class="font19">Attached devices:</span></p>
<p><span class="font19">Host: scsiO Channel: 00 Id: 00 Lun: 00</span></p>
<p><span class="font19">Vendor: Adaptec Model: RAID5 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rev: V1.0</span></p>
<p><span class="font19">Type: &nbsp;&nbsp;Direct-Access &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ANSI SCSI revision: 02</span></p>
<p><span class="font19">Host: scsi1 Channel: 00 Id: 00 Lun: 00</span></p>
<p><span class="font19">Vendor: SEAGATE Model: ST336605FSUN36G Rev: 0438</span></p>
<p><span class="font19">Type: &nbsp;&nbsp;Direct-Access &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ANSI SCSI revision: 03</span></p>
<p><span class="font19">root@shaka:~#</span></p>
<h4><a name="bookmark3422"></a><span class="font25"><a name="bookmark3423"></a>Here we run </span><span class="font25" style="font-weight:bold;">cat /proc/scsi/scsi </span><span class="font25">on the QNAP from above (with Debian Linux).</span></h4>
<p><span class="font19">root@debian6~# cat /proc/scsi/scsi</span></p>
<p><span class="font19">Attached devices:</span></p>
<p><span class="font19">Host: scsi0 Channel: 00 Id: 00 Lun: 00</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">Vendor: SanDisk Model</span></p></td><td rowspan="2" style="vertical-align:top;">
<p><span class="font19">: Cruzer Edge</span></p></td><td rowspan="2" style="vertical-align:top;">
<p><span class="font19">Rev:</span></p>
<p><span class="font19">ANSI</span></p></td><td colspan="3" style="vertical-align:top;">
<p><span class="font19">1.19</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Type: &nbsp;&nbsp;Direct-Access</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SCSI</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">revision:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">02</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Host: scsi1 Channel: 00</span></p>
<p><span class="font19">Vendor: ATA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Model</span></p>
<p><span class="font19">Type: &nbsp;&nbsp;Direct-Access</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Id: 00 Lun: 00 : ST3750330AS</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Rev:</span></p>
<p><span class="font19">ANSI</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SD04</span></p>
<p><span class="font19">SCSI</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">revision:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">05</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Host: scsi2 Channel: 00</span></p>
<p><span class="font19">Vendor: ATA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Model</span></p>
<p><span class="font19">Type: &nbsp;&nbsp;Direct-Access</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Id: 00 Lun: 00 : ST3750330AS</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Rev:</span></p>
<p><span class="font19">ANSI</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SD04</span></p>
<p><span class="font19">SCSI</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">revision:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">05</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Host: scsi3 Channel: 00</span></p>
<p><span class="font19">Vendor: ATA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Model</span></p>
<p><span class="font19">Type: &nbsp;&nbsp;Direct-Access</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Id: 00 Lun: 00 : ST3750330AS</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Rev:</span></p>
<p><span class="font19">ANSI</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SD04</span></p>
<p><span class="font19">SCSI</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">revision:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">05</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Host: scsi4 Channel: 00</span></p>
<p><span class="font19">Vendor: ATA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Model</span></p>
<p><span class="font19">Type: &nbsp;&nbsp;Direct-Access</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Id: 00 Lun: 00 : ST3750330AS</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Rev:</span></p>
<p><span class="font19">ANSI</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SD04</span></p>
<p><span class="font19">SCSI</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">revision:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">05</span></p></td></tr>
</table>
<h4><a name="bookmark3424"></a><span class="font25"><a name="bookmark3425"></a>Note that some recent versions of Debian have this disabled in the kernel. You can enable it (after a kernel compile) using this entry:</span></h4>
<ul style="list-style:none;"><li>
<p><span class="font19"># CONFIG_SCSI_PROC_FS is not set</span></p></li></ul>
<h4><a name="bookmark3426"></a><span class="font25"><a name="bookmark3427"></a>Redhat and CentOS have this by default (if there are scsi devices present).</span></h4>
<p><span class="font19">[root@centos65 ~]# cat /proc/scsi/scsi Attached devices:</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">Host: scsi0 Channel: 00 Id: 00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Lun: 00</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Vendor: ATA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Model: VBOX</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">HARDDISK</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Rev:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1.0</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Type: &nbsp;&nbsp;Direct-Access</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">ANSI</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SCSI</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">revision:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">05</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Host: scsi3 Channel: 00 Id: 00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Lun: 00</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Vendor: ATA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Model: VBOX</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">HARDDISK</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Rev:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1.0</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Type: &nbsp;&nbsp;Direct-Access</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">ANSI</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SCSI</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">revision:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">05</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Host: scsi4 Channel: 00 Id: 00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Lun: 00</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Vendor: ATA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Model: VBOX</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">HARDDISK</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Rev:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1.0</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Type: &nbsp;&nbsp;Direct-Access</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">ANSI</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SCSI</span></p></td><td style="vertical-align:top;">
<p><span class="font19">revision:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">05</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3428"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3016"></a><a name="bookmark3429"></a>5.4. erasing a hard disk</span></h2></li></ul>
<p><span class="font25">Before selling your old hard disk on the internet, it may be a good idea to erase it. By simply repartitioning, or by using the Microsoft Windows format utility, or even after an </span><span class="font25" style="font-weight:bold;">mkfs </span><span class="font25">command, some people will still be able to read most of the data on the disk.</span></p>
<p><span class="font19">root@debian6~# aptitude search foremost autopsy sleuthkit | tr -s ' '</span></p>
<p><span class="font19">p autopsy - graphical interface to SleuthKit</span></p>
<p><span class="font19">p foremost - Forensics application to recover data</span></p>
<p><span class="font19">p sleuthkit - collection of tools for forensics analysis</span></p>
<p><a name="bookmark3430"></a><span class="font25">Although technically the </span><span class="font25" style="font-weight:bold;">/sbin/badblocks </span><span class="font25">tool is meant to look for bad blocks, you can use it to completely erase all data from a disk. Since this is really writing to every sector of the disk, it can take a long time!</span></p>
<p><span class="font19">root@RHELv4u2:~# badblocks -ws /dev/sdb</span></p>
<p><span class="font19">Testing with pattern 0xaa: done</span></p>
<p><span class="font19">Reading and comparing: done</span></p>
<p><span class="font19">Testing with pattern 0x55: done</span></p>
<p><span class="font19">Reading and comparing: done</span></p>
<p><span class="font19">Testing with pattern 0xff: done</span></p>
<p><span class="font19">Reading and comparing: done</span></p>
<p><span class="font19">Testing with pattern 0x00: done</span></p>
<p><span class="font19">Reading and comparing: done</span></p>
<p><span class="font25">The previous screenshot overwrites every sector of the disk </span><span class="font25" style="font-weight:bold;">four times</span><span class="font25">. Erasing </span><span class="font25" style="font-weight:bold;">once </span><span class="font25">with a tool like </span><span class="font25" style="font-weight:bold;">dd </span><span class="font25">is enough to destroy all data.</span></p>
<p><span class="font25">Warning, this screenshot shows how to permanently destroy all data on a block device.</span></p>
<p><span class="font19">[root@rhel65 ~]# dd if=/dev/zero of=/dev/sdb</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3431"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3017"></a><a name="bookmark3432"></a>5.5. advanced hard disk settings</span></h2></li></ul>
<h4><a name="bookmark3433"></a><span class="font25"><a name="bookmark3434"></a>Tweaking of hard disk settings (dma, gap, ...) are not covered in this course. Several tools exists, </span><span class="font25" style="font-weight:bold;">hdparm </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">sdparm </span><span class="font25">are two of them.</span></h4>
<h4><a name="bookmark3435"></a><span class="font25" style="font-weight:bold;"><a name="bookmark3436"></a><a name="bookmark3437"></a>hdparm </span><span class="font25">can be used to display or set information and parameters about an ATA (or SATA) hard disk device. The -i and -I options will give you even more information about the physical properties of the device.</span></h4>
<p><span class="font19">root@laika:~# hdparm /dev/sdb</span></p>
<p><span class="font19">/dev/sdb:</span></p>
<p><span class="font19">IO_support &nbsp;&nbsp;= &nbsp;0 (default 16-bit)</span></p>
<p><span class="font19">readonly &nbsp;&nbsp;&nbsp;&nbsp;= &nbsp;0 (off)</span></p>
<p><span class="font19">readahead &nbsp;&nbsp;&nbsp;= 256 (on)</span></p>
<p><span class="font19">geometry &nbsp;&nbsp;&nbsp;&nbsp;= 12161/255/63, sectors = 195371568, start = 0</span></p>
<h4><a name="bookmark3438"></a><span class="font25"><a name="bookmark3439"></a>Below </span><span class="font25" style="font-weight:bold;">hdparm </span><span class="font25">info about a 200GB IDE disk.</span></h4>
<p><span class="font19">root@barry:~# hdparm /dev/hdd</span></p>
<p><span class="font19">/dev/hdd:</span></p>
<p><span class="font19">multcount &nbsp;&nbsp;&nbsp;&nbsp;= &nbsp;0 (off)</span></p>
<p><span class="font19">IO_support &nbsp;&nbsp;&nbsp;= &nbsp;0 (default)</span></p>
<p><span class="font19">unmaskirq &nbsp;&nbsp;&nbsp;&nbsp;= &nbsp;0 (off)</span></p>
<p><span class="font19">using_dma &nbsp;&nbsp;&nbsp;&nbsp;= &nbsp;1 (on)</span></p>
<p><span class="font19">keepsettings &nbsp;= &nbsp;0 (off)</span></p>
<p><span class="font19">readonly &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= &nbsp;0 (off)</span></p>
<p><span class="font19">readahead = 256 (on)</span></p>
<p><span class="font19">geometry = 24321/255/63, sectors = 390721968, start = 0</span></p>
<h4><a name="bookmark3440"></a><span class="font25"><a name="bookmark3441"></a>Here a screenshot of </span><span class="font25" style="font-weight:bold;">sdparm </span><span class="font25">on Ubuntu 10.10.</span></h4>
<p><span class="font19">root@ubu1010:~# aptitude install sdparm</span></p>
<p><span class="font19">...</span></p>
<p><span class="font19">root@ubu1010:~# sdparm /dev/sda | head -1</span></p>
<p><span class="font19">/dev/sda: ATA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FUJITSU MJA2160B 0081</span></p>
<p><span class="font19">root@ubu1010:~# man sdparm</span></p>
<h4><a name="bookmark3442"></a><span class="font25"><a name="bookmark3443"></a>Use </span><span class="font25" style="font-weight:bold;">hdparm </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">sdparm </span><span class="font25">with care.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3444"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3018"></a><a name="bookmark3445"></a>5.6. practice: hard disk devices</span></h2></li></ul>
<p><span class="font25" style="font-weight:bold;">About this lab: </span><span class="font25">To practice working with hard disks, you will need some hard disks. When there are no physical hard disk available, you can use virtual disks in </span><span class="font25" style="font-weight:bold;">vmware </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">VirtualBox</span><span class="font25">. The teacher will help you in attaching a couple of ATA and/or SCSI disks to a virtual machine. The results of this lab can be used in the next three labs (partitions, file systems, mounting).</span></p>
<p><span class="font25">It is adviced to attach three 1GB disks and three 2GB disks to the virtual machine. This will allow for some freedom in the practices of this chapter as well as the next chapters (raid, lvm, iSCSI).</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Use </span><span class="font25" style="font-weight:bold;">dmesg </span><span class="font25">to make a list of hard disk devices detected at boot-up.</span></p></li>
<li>
<p><span class="font25">2. Use </span><span class="font25" style="font-weight:bold;">fdisk </span><span class="font25">to find the total size of all hard disk devices on your system.</span></p></li>
<li>
<p><span class="font25">3. Stop a virtual machine, add three virtual 1 gigabyte </span><span class="font25" style="font-weight:bold;">scsi </span><span class="font25">hard disk devices and one virtual 400 megabyte </span><span class="font25" style="font-weight:bold;">ide </span><span class="font25">hard disk device. If possible, also add another virtual 400 megabyte </span><span class="font25" style="font-weight:bold;">ide </span><span class="font25">disk.</span></p></li>
<li>
<p><span class="font25">4. Use </span><span class="font25" style="font-weight:bold;">dmesg </span><span class="font25">to verify that all the new disks are properly detected at boot-up.</span></p></li>
<li>
<p><span class="font25">5. Verify that you can see the disk devices in </span><span class="font25" style="font-weight:bold;">/dev</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">6. Use </span><span class="font25" style="font-weight:bold;">fdisk </span><span class="font25">(with </span><span class="font25" style="font-weight:bold;">grep </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/dev/null</span><span class="font25">) to display the total size of the new disks.</span></p></li>
<li>
<p><span class="font25">7. Use </span><span class="font25" style="font-weight:bold;">badblocks </span><span class="font25">to completely erase one of the smaller hard disks.</span></p></li>
<li>
<p><span class="font25">8. Look at </span><span class="font25" style="font-weight:bold;">/proc/scsi/scsi</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">9. If possible, install </span><span class="font25" style="font-weight:bold;">lsscsi</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">lshw </span><span class="font25">and use them to list the disks.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3446"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3019"></a><a name="bookmark3447"></a>5.7. solution: hard disk devices</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3448"></a><span class="font25"><a name="bookmark3449"></a>1. Use </span><span class="font25" style="font-weight:bold;">dmesg </span><span class="font25">to make a list of hard disk devices detected at boot-up.</span></h4></li></ul>
<p><span class="font19">Some possible answers...</span></p>
<p><span class="font19">dmesg | grep -i disk</span></p>
<p><span class="font19">Looking for ATA disks: dmesg | grep hd[abcd]</span></p>
<p><span class="font19">Looking for ATA disks: dmesg | grep -i &quot;ata disk&quot;</span></p>
<p><span class="font19">Looking for SCSI disks: dmesg | grep sd[a-f]</span></p>
<p><span class="font19">Looking for SCSI disks: dmesg | grep -i &quot;scsi disk&quot;</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3450"></a><span class="font25"><a name="bookmark3451"></a>2. Use </span><span class="font25" style="font-weight:bold;">fdisk </span><span class="font25">to find the total size of all hard disk devices on your system.</span></h4></li></ul>
<p><span class="font19">fdisk -l</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3452"></a><span class="font25"><a name="bookmark3453"></a>3. Stop a virtual machine, add three virtual 1 gigabyte </span><span class="font25" style="font-weight:bold;">scsi </span><span class="font25">hard disk devices and one virtual 400 megabyte </span><span class="font25" style="font-weight:bold;">ide </span><span class="font25">hard disk device. If possible, also add another virtual 400 megabyte </span><span class="font25" style="font-weight:bold;">ide </span><span class="font25">disk.</span></h4></li></ul>
<p><span class="font19">This exercise happens in the settings of vmware or VirtualBox.</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3454"></a><span class="font25"><a name="bookmark3455"></a>4. Use </span><span class="font25" style="font-weight:bold;">dmesg </span><span class="font25">to verify that all the new disks are properly detected at boot-up.</span></h4></li></ul>
<p><span class="font19">See 1.</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3456"></a><span class="font25"><a name="bookmark3457"></a>5. Verify that you can see the disk devices in </span><span class="font25" style="font-weight:bold;">/dev</span><span class="font25">.</span></h4></li></ul>
<p><span class="font19">SCSI+SATA: ls -l /dev/sd*</span></p>
<p><span class="font19">ATA: ls -l /dev/hd*</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3458"></a><span class="font25"><a name="bookmark3459"></a>6. Use </span><span class="font25" style="font-weight:bold;">fdisk </span><span class="font25">(with </span><span class="font25" style="font-weight:bold;">grep </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/dev/null</span><span class="font25">) to display the total size of the new disks.</span></h4></li></ul>
<p><span class="font19">root@rhel53 ~# fdisk -l 2&gt;/dev/null | grep [MGT]B</span></p>
<p><span class="font19">Disk /dev/hda: 21.4 GB, 21474836480 bytes</span></p>
<p><span class="font19">Disk /dev/hdb: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk /dev/sda: 2147 MB, 2147483648 bytes</span></p>
<p><span class="font19">Disk /dev/sdb: 2147 MB, 2147483648 bytes</span></p>
<p><span class="font19">Disk /dev/sdc: 2147 MB, 2147483648 bytes</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3460"></a><span class="font25"><a name="bookmark3461"></a>7. Use </span><span class="font25" style="font-weight:bold;">badblocks </span><span class="font25">to completely erase one of the smaller hard disks.</span></h4></li></ul>
<p><span class="font19">#Verify the device (/dev/sdc??) you want to erase before typing this. # root@rhel53 ~# badblocks -ws /dev/sdc</span></p>
<p><span class="font19">Testing with pattern 0xaa: done</span></p>
<p><span class="font19">Reading and comparing: done</span></p>
<p><span class="font19">Testing with pattern 0x55: done</span></p>
<p><span class="font19">Reading and comparing: done</span></p>
<p><span class="font19">Testing with pattern 0xff: done</span></p>
<p><span class="font19">Reading and comparing: done</span></p>
<p><span class="font19">Testing with pattern 0x00: done</span></p>
<p><span class="font19">Reading and comparing: done</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3462"></a><span class="font25"><a name="bookmark3463"></a>8. Look at </span><span class="font25" style="font-weight:bold;">/proc/scsi/scsi</span><span class="font25">.</span></h4></li></ul>
<p><span class="font19">root@rhel53 ~# cat /proc/scsi/scsi</span></p>
<p><span class="font19">Attached devices:</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">Host: scsi0 Channel: 00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Id: 02 Lun:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Vendor: VBOX &nbsp;&nbsp;&nbsp;&nbsp;Model</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">: HARDDISK</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">Rev:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1.0</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Type: &nbsp;&nbsp;Direct-Access</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">ANSI</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SCSI</span></p></td><td style="vertical-align:top;">
<p><span class="font19">revision:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">05</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Host: scsi0 Channel: 00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Id: 03 Lun:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Vendor: VBOX &nbsp;&nbsp;&nbsp;&nbsp;Model</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">: HARDDISK</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">Rev:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1.0</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Type: &nbsp;&nbsp;Direct-Access</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">ANSI</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SCSI</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">revision:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">05</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Host: scsi0 Channel: 00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Id: 06 Lun:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Vendor: VBOX &nbsp;&nbsp;&nbsp;&nbsp;Model</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">: HARDDISK</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">Rev:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1.0</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Type: &nbsp;&nbsp;Direct-Access</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">ANSI</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SCSI</span></p></td><td style="vertical-align:top;">
<p><span class="font19">revision:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">05</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3464"></a><span class="font25"><a name="bookmark3465"></a>9. If possible, install </span><span class="font25" style="font-weight:bold;">lsscsi</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">lshw </span><span class="font25">and use them to list the disks.</span></h4></li></ul>
<p><span class="font19">Debian,Ubuntu: aptitude install lsscsi lshw</span></p>
<p><span class="font19">Fedora: yum install lsscsi lshw</span></p>
<p><span class="font19">root@rhel53 ~# lsscsi</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">[0:0:2:0]</span></p></td><td style="vertical-align:top;">
<p><span class="font19">disk</span></p></td><td style="vertical-align:top;">
<p><span class="font19">VBOX</span></p></td><td style="vertical-align:top;">
<p><span class="font19">HARDDISK</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1.0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/dev/sda</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[0:0:3:0]</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">disk</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">VBOX</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">HARDDISK</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1.0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdb</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[0:0:6:0]</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">disk</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">VBOX</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">HARDDISK</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1.0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdc</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h1><a name="bookmark3466"></a><span class="font11" style="font-weight:bold;"><a name="bookmark3020"></a><a name="bookmark3467"></a>Chapter 6. disk partitions</span></h1></li></ul>
<p><span class="font25">This chapter continues on the </span><span class="font25" style="font-weight:bold;">hard disk devices </span><span class="font25">from the previous one. Here we will put </span><span class="font25" style="font-weight:bold;">partitions </span><span class="font25">on those devices.</span></p>
<p><span class="font25">This chapter prepares you for the next chapter, where we put </span><span class="font25" style="font-weight:bold;">file systems </span><span class="font25">on our partitions.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3468"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3021"></a><a name="bookmark3469"></a>6.1. about partitions</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark3223"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3470"></a>6.1.1. primary, extended and logical</span></h3></li></ul></li></ul>
<p><a name="bookmark3471"></a><span class="font25">Linux requires you to create one or more </span><span class="font25" style="font-weight:bold;">partitions</span><span class="font25">. The next paragraphs will explain how to create and use partitions.</span></p>
<p><a name="bookmark3472"></a><span class="font25"><a name="bookmark3473"></a><a name="bookmark3474"></a><a name="bookmark3475"></a>A partition's </span><span class="font25" style="font-weight:bold;">geometry </span><span class="font25">and size is usually defined by a starting and ending cylinder (sometimes by sector). Partitions can be of type </span><span class="font25" style="font-weight:bold;">primary </span><span class="font25">(maximum four), </span><span class="font25" style="font-weight:bold;">extended </span><span class="font25">(maximum one) or </span><span class="font25" style="font-weight:bold;">logical </span><span class="font25">(contained within the extended partition). Each partition has a </span><span class="font25" style="font-weight:bold;">type field </span><span class="font25">that contains a code. This determines the computers operating system or the partitions file system.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 6.1. primary, extended and logical partitions</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font24" style="font-weight:bold;">Partition Type</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24" style="font-weight:bold;">naming</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">Primary (max 4)</span></p></td><td style="vertical-align:top;">
<p><span class="font24">1-4</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">Extended (max 1)</span></p></td><td style="vertical-align:top;">
<p><span class="font24">1-4</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">Logical</span></p></td><td style="vertical-align:top;">
<p><span class="font24">5-</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3224"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3476"></a>6.1.2. partition naming</span></h3></li></ul>
<p><a name="bookmark3477"></a><span class="font25">We saw before that hard disk devices are named /dev/hdx or /dev/sdx with x depending on the hardware configuration. Next is the partition number, starting the count at 1. Hence the four (possible) primary partitions are numbered 1 to 4. Logical partition counting always starts at 5. Thus /dev/hda2 is the second partition on the first ATA hard disk device, and / dev/hdb5 is the first logical partition on the second ATA hard disk device. Same for SCSI, / dev/sdb3 is the third partition on the second SCSI disk.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 6.2. Partition naming</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">partition</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">device</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">/dev/hda1</span></p></td><td style="vertical-align:top;">
<p><span class="font24">first primary partition on /dev/hda</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">/dev/hda2</span></p></td><td style="vertical-align:top;">
<p><span class="font24">second primary or extended partition on /dev/hda</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">/dev/sda5</span></p></td><td style="vertical-align:top;">
<p><span class="font24">first logical drive on /dev/sda</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">/dev/sdb6</span></p></td><td style="vertical-align:top;">
<p><span class="font24">second logical on /dev/sdb</span></p></td></tr>
</table>
<p><span class="font25">The picture below shows two (spindle) disks with partitions. Note that an extended partition is a container holding logical drives.</span></p><img src="linux_guide_files/The Complete Linux Guide-88.jpg" alt="" style="width:199pt;height:139pt;">
<ul style="list-style:none;"><li>
<h2><a name="bookmark3478"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3022"></a><a name="bookmark3479"></a>6.2. discovering partitions</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark3480"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3481"></a>6.2.1. fdisk -l</span></h3></li></ul></li></ul>
<p><a name="bookmark3482"></a><span class="font25">In the </span><span class="font25" style="font-weight:bold;">fdisk -l </span><span class="font25">example below you can see that two partitions exist on </span><span class="font25" style="font-weight:bold;">/dev/sdb</span><span class="font25">. The first partition spans 31 cylinders and contains a Linux swap partition. The second partition is much bigger.</span></p>
<p><span class="font19">root@laika:~# fdisk -l /dev/sdb</span></p>
<p><span class="font19">Disk /dev/sdb: 100.0 GB, 100030242816 bytes</span></p>
<p><span class="font19">255 heads, 63 sectors/track, 12161 cylinders</span></p>
<p><span class="font19">Units = cylinders of 16065 * 512 = 8225280 bytes</span></p>
<p><span class="font19">Device Boot &nbsp;&nbsp;&nbsp;Start &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End &nbsp;&nbsp;&nbsp;&nbsp;Blocks &nbsp;&nbsp;Id &nbsp;System</span></p>
<p><span class="font19">/dev/sdb1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;31 &nbsp;&nbsp;&nbsp;&nbsp;248976 &nbsp;&nbsp;82 &nbsp;Linux swap / Solaris</span></p>
<p><span class="font19">/dev/sdb2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;32 &nbsp;&nbsp;&nbsp;12161 &nbsp;&nbsp;97434225 &nbsp;&nbsp;83 &nbsp;Linux</span></p>
<p><span class="font19">root@laika:~#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3483"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3484"></a>6.2.2. /proc/partitions</span></h3></li></ul>
<p><a name="bookmark3485"></a><span class="font25"><a name="bookmark3486"></a><a name="bookmark3487"></a>The </span><span class="font25" style="font-weight:bold;">/proc/partitions </span><span class="font25">file contains a table with major and minor number of partitioned devices, their number of blocks and the device name in </span><span class="font25" style="font-weight:bold;">/dev</span><span class="font25">. Verify with </span><span class="font25" style="font-weight:bold;">/proc/devices </span><span class="font25">to link the major number to the proper device.</span></p>
<p><span class="font19">paul@RHELv4u4:~$ cat /proc/partitions</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">major</span></p></td><td style="vertical-align:top;">
<p><span class="font19">minor</span></p></td><td style="vertical-align:top;">
<p><span class="font19">#blocks</span></p></td><td style="vertical-align:top;">
<p><span class="font19">name</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">524288</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">hda</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">64</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">734003</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">hdb</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">8</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">8388608</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sda</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">8</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">104391</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sda1</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">8</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">8281507</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sda2</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">8</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">16</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1048576</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sdb</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">8</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">32</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1048576</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sdc</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">8</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">48</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1048576</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sdd</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">253</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7176192</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">dm-0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">253</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1048576</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">dm-1</span></p></td></tr>
</table>
<p><a name="bookmark3488"></a><span class="font25"><a name="bookmark3489"></a><a name="bookmark3490"></a><a name="bookmark3491"></a>The </span><span class="font25" style="font-weight:bold;">major </span><span class="font25">number corresponds to the device type (or driver) and can be found in </span><span class="font25" style="font-weight:bold;">/proc/ devices</span><span class="font25">. In this case 3 corresponds to </span><span class="font25" style="font-weight:bold;">ide </span><span class="font25">and 8 to </span><span class="font25" style="font-weight:bold;">sd</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">major </span><span class="font25">number determines the </span><span class="font25" style="font-weight:bold;">device driver </span><span class="font25">to be used with this device.</span></p>
<p><a name="bookmark3492"></a><span class="font25"><a name="bookmark3493"></a>The </span><span class="font25" style="font-weight:bold;">minor </span><span class="font25">number is a unique identification of an instance of this device type. The </span><span class="font25" style="font-weight:bold;">devices.txt </span><span class="font25">file in the kernel tree contains a full list of major and minor numbers.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3494"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3495"></a>6.2.3. parted and others</span></h3></li></ul>
<h4><a name="bookmark3496"></a><span class="font25"><a name="bookmark3497"></a>You may be interested in alternatives to </span><span class="font25" style="font-weight:bold;">fdisk </span><span class="font25">like </span><span class="font25" style="font-weight:bold;">parted</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">cfdisk</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">sfdisk </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">gparted</span><span class="font25">. This course mainly uses </span><span class="font25" style="font-weight:bold;">fdisk </span><span class="font25">to partition hard disks.</span></h4>
<h4><a name="bookmark3498"></a><span class="font25" style="font-weight:bold;"><a name="bookmark3499"></a>parted </span><span class="font25">is recommended by some Linux distributions for handling storage with </span><span class="font25" style="font-weight:bold;">gpt </span><span class="font25">instead of </span><span class="font25" style="font-weight:bold;">mbr</span><span class="font25">.</span></h4>
<h4><a name="bookmark3500"></a><span class="font25"><a name="bookmark3501"></a>Below a screenshot of </span><span class="font25" style="font-weight:bold;">parted </span><span class="font25">on CentOS.</span></h4>
<p><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">rpm -q parted</span></p>
<p><span class="font19">parted-2.1-21.el6.x86_64</span></p>
<p><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">parted /dev/sda</span></p>
<p><span class="font19">GNU Parted 2.1</span></p>
<p><span class="font19">Using /dev/sda</span></p>
<p><span class="font19">Welcome to GNU Parted! Type 'help' to view a list of commands.</span></p>
<p><span class="font19">(parted) </span><span class="font19" style="font-weight:bold;">print</span></p>
<p><span class="font19">Model: ATA VBOX HARDDISK (scsi)</span></p>
<p><span class="font19">Disk /dev/sda: 42.9GB</span></p>
<p><span class="font19">Sector size (logical/physical): 512B/512B</span></p>
<p><span class="font19">Partition Table: msdos</span></p>
<p><span class="font19">Number &nbsp;Start &nbsp;&nbsp;End &nbsp;&nbsp;&nbsp;&nbsp;Size &nbsp;&nbsp;&nbsp;Type &nbsp;&nbsp;&nbsp;&nbsp;File system &nbsp;Flags</span></p>
<p><span class="font19">1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1049kB &nbsp;525MB &nbsp;&nbsp;524MB &nbsp;&nbsp;primary &nbsp;ext4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boot</span></p>
<p><span class="font19">2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;525MB &nbsp;&nbsp;42.9GB &nbsp;42.4GB &nbsp;primary &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lvm</span></p>
<p><span class="font19">(parted)</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3502"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3023"></a><a name="bookmark3503"></a>6.3. partitioning new disks</span></h2></li></ul>
<h4><a name="bookmark3504"></a><span class="font25"><a name="bookmark3505"></a><a name="bookmark3506"></a>In the example below, we bought a new disk for our system. After the new hardware is properly attached, you can use </span><span class="font25" style="font-weight:bold;">fdisk </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">parted </span><span class="font25">to create the necessary partition(s). This example uses </span><span class="font25" style="font-weight:bold;">fdisk</span><span class="font25">, but there is nothing wrong with using </span><span class="font25" style="font-weight:bold;">parted</span><span class="font25">.</span></h4>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3507"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3508"></a>6.3.1. recognising the disk</span></h3></li></ul>
<h4><a name="bookmark3509"></a><span class="font25"><a name="bookmark3510"></a>First, we check with </span><span class="font25" style="font-weight:bold;">fdisk -l </span><span class="font25">whether Linux can see the new disk. Yes it does, the new disk is seen as /dev/sdb, but it does not have any partitions yet.</span></h4>
<p><span class="font19">root@RHELv4u2:~# fdisk -l</span></p>
<p><span class="font19">Disk /dev/sda: 12.8 GB, 12884901888 bytes 255 heads, 63 sectors/track, 1566 cylinders</span></p>
<p><span class="font19">Units = cylinders of 16065 * 512 = 8225280 bytes</span></p>
<p><span class="font19">Device Boot &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Start &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End Blocks Id System</span></p>
<p><span class="font19">/dev/sda1 &nbsp;&nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;13 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;104391 &nbsp;&nbsp;83 &nbsp;Linux</span></p>
<p><span class="font19">/dev/sda2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;14 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1566 &nbsp;&nbsp;&nbsp;12474472+ &nbsp;8e &nbsp;Linux LVM</span></p>
<p><span class="font19">Disk /dev/sdb: 1073 MB, 1073741824 bytes 255 heads, 63 sectors/track, 130 cylinders</span></p>
<p><span class="font19">Units = cylinders of 16065 * 512 = 8225280 bytes</span></p>
<p><span class="font19">Disk /dev/sdb doesn't contain a valid partition table</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3511"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3512"></a>6.3.2. opening the disk with fdisk</span></h3></li></ul>
<h4><a name="bookmark3513"></a><span class="font25"><a name="bookmark3514"></a>Then we create a partition with fdisk on /dev/sdb. First we start the fdisk tool with /dev/sdb as argument. Be very very careful not to partition the wrong disk!!</span></h4>
<p><span class="font19">root@RHELv4u2:~# fdisk /dev/sdb</span></p>
<p><span class="font19">Device contains neither a valid DOS partition table, nor Sun, SGI... Building a new DOS disklabel. Changes will remain in memory only, until you decide to write them. After that, of course, the previous content won't be recoverable.</span></p>
<p><span class="font19">Warning: invalid flag 0x0000 of partition table 4 will be corrected...</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3243"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3515"></a>6.3.3. empty partition table</span></h3></li></ul>
<h4><a name="bookmark3516"></a><span class="font25"><a name="bookmark3517"></a><a name="bookmark3518"></a>Inside the fdisk tool, we can issue the </span><span class="font25" style="font-weight:bold;">p </span><span class="font25">command to see the current disks partition table.</span></h4>
<p><span class="font19">Command (m for help): p</span></p>
<p><span class="font19">Disk /dev/sdb: 1073 MB, 1073741824 bytes 255 heads, 63 sectors/track, 130 cylinders</span></p>
<p><span class="font19">Units = cylinders of 16065 * 512 = 8225280 bytes</span></p>
<p><span class="font19">Device Boot &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Start &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End Blocks Id System</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3519"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3520"></a>6.3.4. create a new partition</span></h3></li></ul>
<h4><a name="bookmark3521"></a><span class="font25"><a name="bookmark3522"></a>No partitions exist yet, so we issue </span><span class="font25" style="font-weight:bold;">n </span><span class="font25">to create a new partition. We choose p for primary, 1 for the partition number, 1 for the start cylinder and 14 for the end cylinder.</span></h4>
<p><span class="font19">Command (m for help): n Command action e extended p primary partition (1-4) P Partition number (1-4): 1 First cylinder (1-130, default 1): Using default value 1</span></p>
<p><span class="font19">Last cylinder or +size or +sizeM or +sizeK (1-130, default 130): 14</span></p>
<h4><a name="bookmark3523"></a><span class="font25"><a name="bookmark3524"></a>We can now issue p again to verify our changes, but they are not yet written to disk. This means we can still cancel this operation! But it looks good, so we use </span><span class="font25" style="font-weight:bold;">w </span><span class="font25">to write the changes to disk, and then quit the fdisk tool.</span></h4>
<p><span class="font19">Command (m for help): p</span></p>
<p><span class="font19">Disk /dev/sdb: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">255 heads, 63 sectors/track, 130 cylinders</span></p>
<p><span class="font19">Units = cylinders of 16065 * 512 = 8225280 bytes</span></p>
<p><span class="font19">Device Boot &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Start &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End Blocks Id System</span></p>
<p><span class="font19">/dev/sdb1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;14 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;112423+ &nbsp;83 Linux</span></p>
<p><span class="font19">Command (m for help): w</span></p>
<p><span class="font19">The partition table has been altered!</span></p>
<p><span class="font19">Calling ioctl() to re-read partition table.</span></p>
<p><span class="font19">Syncing disks.</span></p>
<p><span class="font19">root@RHELv4u2:~#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3525"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3526"></a>6.3.5. display the new partition</span></h3></li></ul>
<h4><a name="bookmark3527"></a><span class="font25"><a name="bookmark3528"></a><a name="bookmark3529"></a>Let's verify again with </span><span class="font25" style="font-weight:bold;">fdisk -l </span><span class="font25">to make sure reality fits our dreams. Indeed, the screenshot below now shows a partition on /dev/sdb.</span></h4>
<p><span class="font19">root@RHELv4u2:~# fdisk -l</span></p>
<p><span class="font19">Disk /dev/sda: 12.8 GB, 12884901888 bytes 255 heads, 63 sectors/track, 1566 cylinders</span></p>
<p><span class="font19">Units = cylinders of 16065 * 512 = 8225280 bytes</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Device Boot</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Start</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">End</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Blocks</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Id</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">System</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sda1 *</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">13</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">104391</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">83</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Linux</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/sda2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">14</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1566</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12474472+</span></p></td><td style="vertical-align:top;">
<p><span class="font19">8e</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Linux LVM</span></p></td></tr>
</table>
<p><span class="font19">Disk /dev/sdb: 1073 MB, 1073741824 bytes 255 heads, 63 sectors/track, 130 cylinders Units = cylinders of 16065 * 512 = 8225280 bytes</span></p>
<p><span class="font19">Device Boot &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Start &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End Blocks Id System</span></p>
<p><span class="font19">/dev/sdb1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;14 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;112423+ &nbsp;83 Linux</span></p>
<p><span class="font19">root@RHELv4u2:~#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3530"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3024"></a><a name="bookmark3531"></a>6.4. about the partition table</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark3532"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3533"></a>6.4.1. master boot record</span></h3></li></ul></li></ul>
<p><a name="bookmark3534"></a><span class="font25"><a name="bookmark3535"></a><a name="bookmark3536"></a><a name="bookmark3537"></a>The </span><span class="font25" style="font-weight:bold;">partition table </span><span class="font25">information (primary and extended partitions) is written in the </span><span class="font25" style="font-weight:bold;">master boot record </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">mbr</span><span class="font25">. You can use </span><span class="font25" style="font-weight:bold;">dd </span><span class="font25">to copy the mbr to a file.</span></p>
<p><span class="font25">This example copies the master boot record from the first SCSI hard disk.</span></p>
<p><span class="font19">dd if=/dev/sda of=/SCSIdisk.mbr bs=512 count=1</span></p>
<p><span class="font25">The same tool can also be used to wipe out all information about partitions on a disk. This example writes zeroes over the master boot record.</span></p>
<p><span class="font19">dd if=/dev/zero of=/dev/sda bs=512 count=1</span></p>
<p><span class="font25">Or to wipe out the whole partition or disk.</span></p>
<p><span class="font19">dd if=/dev/zero of=/dev/sda</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3538"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3539"></a>6.4.2. partprobe</span></h3></li></ul>
<p><a name="bookmark3540"></a><span class="font25">Don't forget that after restoring a </span><span class="font25" style="font-weight:bold;">master boot record </span><span class="font25">with </span><span class="font25" style="font-weight:bold;">dd</span><span class="font25">, that you need to force the kernel to reread the partition table with </span><span class="font25" style="font-weight:bold;">partprobe</span><span class="font25">. After running </span><span class="font25" style="font-weight:bold;">partprobe</span><span class="font25">, the partitions can be used again.</span></p>
<p><span class="font19">[root@RHEL5 ~]# partprobe</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3541"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3542"></a>6.4.3. logical drives</span></h3></li></ul>
<p><a name="bookmark3543"></a><span class="font25"><a name="bookmark3544"></a><a name="bookmark3545"></a><a name="bookmark3546"></a>The </span><span class="font25" style="font-weight:bold;">partition table </span><span class="font25">does not contain information about </span><span class="font25" style="font-weight:bold;">logical drives</span><span class="font25">. So the </span><span class="font25" style="font-weight:bold;">dd </span><span class="font25">backup of the </span><span class="font25" style="font-weight:bold;">mbr </span><span class="font25">only works for primary and extended partitions. To backup the partition table including the logical drives, you can use </span><span class="font25" style="font-weight:bold;">sfdisk</span><span class="font25">.</span></p>
<p><span class="font25">This example shows how to backup all partition and logical drive information to a file.</span></p>
<p><span class="font19">sfdisk -d /dev/sda &gt;&nbsp;parttable.sda.sfdisk</span></p>
<p><span class="font25">The following example copies the </span><span class="font25" style="font-weight:bold;">mbr </span><span class="font25">and all </span><span class="font25" style="font-weight:bold;">logical drive </span><span class="font25">info from /dev/sda to /dev/sdb.</span></p>
<p><span class="font19">sfdisk -d /dev/sda | sfdisk /dev/sdb</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3547"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3025"></a><a name="bookmark3548"></a>6.5. GUID partition table</span></h2></li></ul>
<p><span class="font25" style="font-weight:bold;">gpt </span><span class="font25">was developed because of the limitations of the 1980s </span><span class="font25" style="font-weight:bold;">mbr </span><span class="font25">partitioning scheme (for example only four partitions can be defined, and they have a maximum size two terabytes).</span></p>
<p><a name="bookmark3549"></a><span class="font25">Since 2010 </span><span class="font25" style="font-weight:bold;">gpt </span><span class="font25">is a part of the </span><span class="font25" style="font-weight:bold;">uefi </span><span class="font25">specification, but it is also used on </span><span class="font25" style="font-weight:bold;">bios </span><span class="font25">systems.</span></p>
<p><span class="font25">Newer versions of </span><span class="font25" style="font-weight:bold;">fdisk </span><span class="font25">work fine with </span><span class="font25" style="font-weight:bold;">gpt</span><span class="font25">, but most production servers today (mid 2015) still have an older </span><span class="font25" style="font-weight:bold;">fdisk.</span><span class="font25">. You can use </span><span class="font25" style="font-weight:bold;">parted </span><span class="font25">instead.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3550"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3026"></a><a name="bookmark3551"></a>6.6. labeling with parted</span></h2></li></ul>
<p><a name="bookmark3552"></a><span class="font25" style="font-weight:bold;">parted </span><span class="font25">is an interactive tool, just like </span><span class="font25" style="font-weight:bold;">fdisk</span><span class="font25">. Type </span><span class="font25" style="font-weight:bold;">help </span><span class="font25">in </span><span class="font25" style="font-weight:bold;">parted </span><span class="font25">for a list of commands and options.</span></p>
<p><a name="bookmark3553"></a><span class="font25">This screenshot shows how to start </span><span class="font25" style="font-weight:bold;">parted </span><span class="font25">to manage partitions on </span><span class="font25" style="font-weight:bold;">/dev/sdb</span><span class="font25">.</span></p>
<p><span class="font19">[root@rhel71 ~]# </span><span class="font19" style="font-weight:bold;">parted /dev/sdb</span></p>
<p><span class="font19">GNU Parted 3.1</span></p>
<p><span class="font19">Using /dev/sdb</span></p>
<p><span class="font19">Welcome to GNU Parted! Type 'help' to view a list of commands. (parted)</span></p>
<p><a name="bookmark3554"></a><span class="font25">Each command also has built-in help. For example </span><span class="font25" style="font-weight:bold;">help mklabel </span><span class="font25">will list all supported labels. Note that we only discussed </span><span class="font25" style="font-weight:bold;">mbr</span><span class="font25">(msdos) and </span><span class="font25" style="font-weight:bold;">gpt </span><span class="font25">in this book.</span></p>
<p><span class="font19">(parted) </span><span class="font19" style="font-weight:bold;">help mklabel </span><span class="font19">mklabel,mktable LABEL-TYPE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;create a new disklabel (partition table)</span></p>
<p><span class="font19">LABEL-TYPE is one of: aix, amiga, bsd, dvh, gpt, mac, msdos, pc98, sun, loop (parted)</span></p>
<p><a name="bookmark3555"></a><span class="font25">We create an </span><span class="font25" style="font-weight:bold;">mbr </span><span class="font25">label.</span></p>
<table border="1">
<tr><td colspan="8" style="vertical-align:bottom;">
<p><span class="font19">(parted) </span><span class="font19" style="font-weight:bold;">mklabel msdos</span><span class="font19">&gt;</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Warning: The existing disk this disk will be lost. Do Yes/No? yes (parted) </span><span class="font19" style="font-weight:bold;">mklabel gpt</span></p></td><td style="vertical-align:top;">
<p><span class="font19">label on you want</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/dev/sdb will to continue?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">be</span></p></td><td style="vertical-align:top;">
<p><span class="font19">destroyed</span></p></td><td style="vertical-align:top;">
<p><span class="font19">and</span></p></td><td style="vertical-align:top;">
<p><span class="font19">all</span></p></td><td style="vertical-align:top;">
<p><span class="font19">data on</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Warning: The existing disk this disk will be lost. Do Yes/No? Y (parted)</span></p></td><td style="vertical-align:top;">
<p><span class="font19">label on you want</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/dev/sdb will to continue?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">be</span></p></td><td style="vertical-align:top;">
<p><span class="font19">destroyed</span></p></td><td style="vertical-align:top;">
<p><span class="font19">and</span></p></td><td style="vertical-align:top;">
<p><span class="font19">all</span></p></td><td style="vertical-align:top;">
<p><span class="font19">data on</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3244"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3556"></a>6.6.1. partitioning with parted</span></h3></li></ul>
<h4><a name="bookmark3557"></a><span class="font25"><a name="bookmark3558"></a><a name="bookmark3559"></a>Once labeled it is easy to create partitions with </span><span class="font25" style="font-weight:bold;">parted</span><span class="font25">. This screenshot starts with an unpartitioned (but </span><span class="font25" style="font-weight:bold;">gpt </span><span class="font25">labeled) disk.</span></h4>
<p><span class="font19">(parted) </span><span class="font19" style="font-weight:bold;">print</span></p>
<p><span class="font19">Model: ATA VBOX HARDDISK (scsi)</span></p>
<p><span class="font19">Disk /dev/sdb: 8590MB</span></p>
<p><span class="font19">Sector size (logical/physical): 512B/512B</span></p>
<p><span class="font19">Partition Table: gpt</span></p>
<p><span class="font19">Disk Flags:</span></p>
<p><span class="font19">Number Start End Size File system Name Flags</span></p>
<p><span class="font19">(parted)</span></p>
<h4><a name="bookmark3560"></a><span class="font25"><a name="bookmark3561"></a>This example shows how to create two primary partitions of equal size.</span></h4>
<p><span class="font19">(parted) </span><span class="font19" style="font-weight:bold;">mkpart primary 0 50%</span></p>
<p><span class="font19">Warning: The resulting partition is not properly aligned for best performance.</span></p>
<p><span class="font19">Ignore/Cancel? I</span></p>
<p><span class="font19">(parted) </span><span class="font19" style="font-weight:bold;">mkpart primary 50% 100%</span></p>
<p><span class="font19">(parted)</span></p>
<h4><a name="bookmark3562"></a><span class="font25"><a name="bookmark3563"></a>Verify with </span><span class="font25" style="font-weight:bold;">print </span><span class="font25">and exit with </span><span class="font25" style="font-weight:bold;">quit</span><span class="font25">. Since </span><span class="font25" style="font-weight:bold;">parted </span><span class="font25">works directly on the disk, there is no need to </span><span class="font25" style="font-weight:bold;">w(rite) </span><span class="font25">like in </span><span class="font25" style="font-weight:bold;">fdisk</span><span class="font25">.</span></h4>
<p><span class="font19">(parted) </span><span class="font19" style="font-weight:bold;">print</span></p>
<p><span class="font19">Model: ATA VBOX HARDDISK (scsi)</span></p>
<p><span class="font19">Disk /dev/sdb: 8590MB</span></p>
<p><span class="font19">Sector size (logical/physical): 512B/512B</span></p>
<p><span class="font19">Partition Table: gpt</span></p>
<p><span class="font19">Disk Flags:</span></p>
<p><span class="font19">Number Start End Size File system Name Flags</span></p>
<p><span class="font19">1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17.4kB 4295MB 4295MB &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;primary</span></p>
<p><span class="font19">2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4295MB 8589MB 4294MB &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;primary</span></p>
<p><span class="font19">(parted) </span><span class="font19" style="font-weight:bold;">quit</span></p>
<p><span class="font19">Information: You may need to update /etc/fstab.</span></p>
<p><span class="font19">[root@rhel71 ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3564"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3027"></a><a name="bookmark3565"></a>6.7. practice: partitions</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Use </span><span class="font25" style="font-weight:bold;">fdisk -l </span><span class="font25">to display existing partitions and sizes.</span></p></li>
<li>
<p><span class="font25">2. Use </span><span class="font25" style="font-weight:bold;">df -h </span><span class="font25">to display existing partitions and sizes.</span></p></li>
<li>
<p><span class="font25">3. Compare the output of </span><span class="font25" style="font-weight:bold;">fdisk </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">df</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">4. Create a 200MB primary partition on a small disk.</span></p></li>
<li>
<p><span class="font25">5. Create a 400MB primary partition and two 300MB logical drives on a big disk.</span></p></li>
<li>
<p><span class="font25">6. Use </span><span class="font25" style="font-weight:bold;">df -h </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">fdisk -l </span><span class="font25">to verify your work.</span></p></li>
<li>
<p><span class="font25">7. Compare the output again of </span><span class="font25" style="font-weight:bold;">fdisk </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">df</span><span class="font25">. Do both commands display the new partitions ?</span></p></li>
<li>
<p><span class="font25">8. Create a backup with </span><span class="font25" style="font-weight:bold;">dd </span><span class="font25">of the </span><span class="font25" style="font-weight:bold;">mbr </span><span class="font25">that contains your 200MB primary partition.</span></p></li>
<li>
<p><span class="font25">9. Take a backup of the </span><span class="font25" style="font-weight:bold;">partition table </span><span class="font25">containing your 400MB primary and 300MB logical drives. Make sure the logical drives are in the backup.</span></p></li>
<li>
<p><span class="font25">10. (optional) Remove all your partitions with fdisk. Then restore your backups.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3566"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3028"></a><a name="bookmark3567"></a>6.8. solution: partitions</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3568"></a><span class="font25"><a name="bookmark3569"></a>1. Use </span><span class="font25" style="font-weight:bold;">fdisk -l </span><span class="font25">to display existing partitions and sizes.</span></h4></li></ul>
<p><span class="font19">as root: # fdisk -l</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3570"></a><span class="font25"><a name="bookmark3571"></a>2. Use </span><span class="font25" style="font-weight:bold;">df -h </span><span class="font25">to display existing partitions and sizes.</span></h4></li></ul>
<p><span class="font19">df -h</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3572"></a><span class="font25"><a name="bookmark3573"></a>3. Compare the output of </span><span class="font25" style="font-weight:bold;">fdisk </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">df</span><span class="font25">.</span></h4></li></ul>
<p><span class="font19">Some partitions will be listed in both outputs (maybe /dev/sdal or /dev/hdal).</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3574"></a><span class="font25"><a name="bookmark3575"></a>4. Create a 200MB primary partition on a small disk.</span></h4></li></ul>
<p><span class="font19">Choose one of the disks you added (this example uses /dev/sdc). root@rhel53 ~# fdisk /dev/sdc ... Command (m for help): n Command action e extended p primary partition (1-4) p Partition number (1-4): 1 First cylinder (1-261, default 1): 1 Last cylinder or +size or +sizeM or +sizeK (1-261, default 261): +200m Command (m for help): w The partition table has been altered!</span></p>
<p><span class="font19">Calling ioctl() to re-read partition table. Syncing disks.</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3576"></a><span class="font25"><a name="bookmark3577"></a>5. Create a 400MB primary partition and two 300MB logical drives on a big disk.</span></h4></li></ul>
<p><span class="font19">Choose one of the disks you added (this example uses /dev/sdb) fdisk /dev/sdb inside fdisk : n p 1 +400m enter --- n e 2 enter enter --- n l +300m (twice)</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3578"></a><span class="font25"><a name="bookmark3579"></a>6. Use </span><span class="font25" style="font-weight:bold;">df -h </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">fdisk -l </span><span class="font25">to verify your work.</span></h4></li></ul>
<p><span class="font19">fdisk -l ; df -h</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3580"></a><span class="font25"><a name="bookmark3581"></a>7. Compare the output again of </span><span class="font25" style="font-weight:bold;">fdisk </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">df</span><span class="font25">. Do both commands display the new partitions ?</span></h4></li></ul>
<p><span class="font19">The newly created partitions are visible with </span><span class="font19" style="font-weight:bold;">fdisk</span><span class="font19">.</span></p>
<p><span class="font19">But they are not displayed by </span><span class="font19" style="font-weight:bold;">df</span><span class="font19">.</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3582"></a><span class="font25"><a name="bookmark3583"></a>8. Create a backup with </span><span class="font25" style="font-weight:bold;">dd </span><span class="font25">of the </span><span class="font25" style="font-weight:bold;">mbr </span><span class="font25">that contains your 200MB primary partition.</span></h4></li></ul>
<p><span class="font19">dd if=/dev/sdc of=bootsector.sdc.dd count=1 bs=512</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3584"></a><span class="font25"><a name="bookmark3585"></a>9. Take a backup of the </span><span class="font25" style="font-weight:bold;">partition table </span><span class="font25">containing your 400MB primary and 300MB logical drives. Make sure the logical drives are in the backup.</span></h4></li></ul>
<p><span class="font19">sfdisk -d /dev/sdb &gt;&nbsp;parttable.sdb.sfdisk</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark3586"></a><span class="font11" style="font-weight:bold;"><a name="bookmark3587"></a><a name="bookmark3588"></a>Chapter 7. file systems</span></h1></li></ul>
<p><a name="bookmark3589"></a><span class="font25">When you are finished partitioning the hard disk, you can put a </span><span class="font25" style="font-weight:bold;">file system </span><span class="font25">on each partition.</span></p>
<p><span class="font25">This chapter builds on the </span><span class="font25" style="font-weight:bold;">partitions </span><span class="font25">from the previous chapter, and prepares you for the next one where we will </span><span class="font25" style="font-weight:bold;">mount </span><span class="font25">the filesystems.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3590"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3030"></a><a name="bookmark3591"></a>7.1. about file systems</span></h2></li></ul>
<p><span class="font25">A file system is a way of organizin<a name="bookmark3592"></a>g files on your partition. Besides file-based storage, file systems usually include </span><span class="font25" style="font-weight:bold;">directories </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">access control</span><span class="font25">, and contain meta information about files like access times, modification times and file ownership.</span></p>
<p><span class="font25">The properties (length, character set, ...) of filenames are determined by the file system you choose. Directories are usually implemented as files, you will have to learn how this is implemented! Access control in file systems is tracked by user ownership (and group owner-and membership) in combination with one or more access control lists.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3593"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3594"></a>7.1.1. man fs</span></h3></li></ul>
<p><span class="font25">The manual page about filesystems is accessed by typing </span><span class="font25" style="font-weight:bold;">man fs</span><span class="font25">.</span></p>
<p><span class="font19">[root@rhel65 ~]# man fs</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3595"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3596"></a>7.1.2. /proc/filesystems</span></h3></li></ul>
<p><span class="font25">The Linux kernel will inform you about currently loaded file system drivers in </span><span class="font25" style="font-weight:bold;">/proc/ filesystems</span><span class="font25">.</span></p>
<p><span class="font19">root@rhel53 ~# cat /proc/filesystems | grep -v nodev</span></p>
<p><span class="font19">ext2</span></p>
<p><span class="font19">iso9660</span></p>
<p><span class="font19">ext3</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3597"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3598"></a>7.1.3. /etc/filesystems</span></h3></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">/etc/filesystems </span><span class="font25">file contains a list of autodetected filesystems (in case the </span><span class="font25" style="font-weight:bold;">mount </span><span class="font25">command is used without the </span><span class="font25" style="font-weight:bold;">-t </span><span class="font25">option.</span></p>
<p><span class="font25">Help for this file is provided by </span><span class="font25" style="font-weight:bold;">man mount</span><span class="font25">.</span></p>
<p><span class="font19">[root@rhel65 ~]# man mount</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3599"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3031"></a><a name="bookmark3600"></a>7.2. common file systems</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark3601"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3602"></a>7.2.1. ext2 and ext3</span></h3></li></ul></li></ul>
<p><a name="bookmark3603"></a><span class="font25">Once the most common Linux file systems is the </span><span class="font25" style="font-weight:bold;">ext2 </span><span class="font25">(the second extended) file system. A disadvantage is that file system checks on ext2 can take a long time.</span></p>
<p><a name="bookmark3604"></a><span class="font25" style="font-weight:bold;"><a name="bookmark3605"></a>ext2 </span><span class="font25">was being replaced by </span><span class="font25" style="font-weight:bold;">ext3 </span><span class="font25">on most Linux machines. They are essentially the same, except for the </span><span class="font25" style="font-weight:bold;">journaling </span><span class="font25">which is only present in ext3.</span></p>
<p><span class="font25">Journaling means that changes are first written to a journal on the disk. The journal is flushed regularly, writing the changes in the file system. Journaling keeps the file system in a consistent state, so you don't need a file system check after an unclean shutdown or power failure.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3606"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3607"></a>7.2.2. creating ext2 and ext3</span></h3></li></ul>
<p><a name="bookmark3608"></a><span class="font25"><a name="bookmark3609"></a>You can create these file systems with the </span><span class="font25" style="font-weight:bold;">/sbin/mkfs </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">/sbin/mke2fs </span><span class="font25">commands. Use </span><span class="font25" style="font-weight:bold;">mke2fs -j </span><span class="font25">to create an </span><span class="font25" style="font-weight:bold;">ext3 </span><span class="font25">file system.</span></p>
<p><a name="bookmark3610"></a><span class="font25"><a name="bookmark3611"></a>You can convert an ext2 to ext3 with </span><span class="font25" style="font-weight:bold;">tune2fs -j</span><span class="font25">. You can mount an ext3 file system as ext2, but then you lose the journaling. Do not forget to run </span><span class="font25" style="font-weight:bold;">mkinitrd </span><span class="font25">if you are booting from this device.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3612"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3613"></a>7.2.3. ext4</span></h3></li></ul>
<p><span class="font25">The newest incarnation of the ext file system is named </span><span class="font25" style="font-weight:bold;">ext4 </span><span class="font25">and is available in the Linux kernel since 2008. </span><span class="font25" style="font-weight:bold;">ext4 </span><span class="font25">supports larger files (up to 16 terabyte) and larger file systems than </span><span class="font25" style="font-weight:bold;">ext3 </span><span class="font25">(and many more features).</span></p>
<p><span class="font25">Development started by making </span><span class="font25" style="font-weight:bold;">ext3 </span><span class="font25">fully capable for 64-bit. When it turned out the changes were significant, the developers decided to name it </span><span class="font25" style="font-weight:bold;">ext4</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3614"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3615"></a>7.2.4. xfs</span></h3></li></ul>
<p><span class="font25">Redhat Enterprise Linux 7 will have </span><span class="font25" style="font-weight:bold;">XFS </span><span class="font25">as the default file system. This is a highly scalable high-performance file system.</span></p>
<p><span class="font25" style="font-weight:bold;">xfs </span><span class="font25">was created for </span><span class="font25" style="font-weight:bold;">Irix </span><span class="font25">and for a couple of years it was also used in </span><span class="font25" style="font-weight:bold;">FreeBSD</span><span class="font25">. It is supported by the Linux kernel, but rarely used in dsitributions outside of the Redhat/CentOS realm.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3616"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3617"></a>7.2.5. vfat</span></h3></li></ul>
<p><a name="bookmark3618"></a><span class="font25"><a name="bookmark3619"></a><a name="bookmark3620"></a>The </span><span class="font25" style="font-weight:bold;">vfat </span><span class="font25">file system exists in a couple of forms : </span><span class="font25" style="font-weight:bold;">fat12 </span><span class="font25">for floppy disks, </span><span class="font25" style="font-weight:bold;">fat16 </span><span class="font25">on </span><span class="font25" style="font-weight:bold;">ms-dos</span><span class="font25">, and </span><span class="font25" style="font-weight:bold;">fat32 </span><span class="font25">for larger disks. The Linux </span><span class="font25" style="font-weight:bold;">vfat </span><span class="font25">implementation supports all of these, but vfat lacks a lot of features like security and links. </span><span class="font25" style="font-weight:bold;">fat </span><span class="font25">disks can be read by every operating system, and are used a lot for digital cameras, </span><span class="font25" style="font-weight:bold;">usb </span><span class="font25">sticks and to exchange data between different OS'ses on a home user's computer.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3621"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3622"></a>7.2.6. iso 9660</span></h3></li></ul>
<p><a name="bookmark3623"></a><span class="font25" style="font-weight:bold;"><a name="bookmark3624"></a><a name="bookmark3625"></a><a name="bookmark3626"></a>iso 9660 </span><span class="font25">is the standard format for cdroms. Chances are you will encounter this file system also on your hard disk in the form of images of cdroms (often with the .iso extension). The </span><span class="font25" style="font-weight:bold;">iso 9660 </span><span class="font25">standard limits filenames to the 8.3 format. The Unix world didn't like this, and thus added the </span><span class="font25" style="font-weight:bold;">rock ridge </span><span class="font25">extensions, which allows for filenames up to 255 characters and Unix-style file-modes, ownership and symbolic links. Another extensions to </span><span class="font25" style="font-weight:bold;">iso 9660 </span><span class="font25">is </span><span class="font25" style="font-weight:bold;">joliet</span><span class="font25">, which adds 64 unicode characters to the filename. The </span><span class="font25" style="font-weight:bold;">el torito </span><span class="font25">standard extends </span><span class="font25" style="font-weight:bold;">iso 9660 </span><span class="font25">to be able to boot from CD-ROM's.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3627"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3628"></a>7.2.7. udf</span></h3></li></ul>
<p><a name="bookmark3629"></a><span class="font25">Most optical media today (including cd's and dvd's) use </span><span class="font25" style="font-weight:bold;">udf</span><span class="font25">, the Universal Disk Format.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3630"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3631"></a>7.2.8. swap</span></h3></li></ul>
<p><a name="bookmark3632"></a><span class="font25">All things considered, swap is not a file system. But to use a partition as a </span><span class="font25" style="font-weight:bold;">swap partition </span><span class="font25">it must be formatted and mounted as swap space.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3633"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3634"></a>7.2.9. gfs</span></h3></li></ul>
<p><span class="font25">Linux clusters often use a dedicated cluster filesystem like GFS, GFS2, ClusterFS, ...</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3635"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3636"></a>7.2.10. and more...</span></h3></li></ul>
<p><a name="bookmark3637"></a><span class="font25"><a name="bookmark3638"></a><a name="bookmark3639"></a>You may encounter </span><span class="font25" style="font-weight:bold;">reiserfs </span><span class="font25">on older Linux systems. Maybe you will see Sun's </span><span class="font25" style="font-weight:bold;">zfs </span><span class="font25">or the open source </span><span class="font25" style="font-weight:bold;">btrfs</span><span class="font25">. This last one requires a chapter on itself.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3640"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3641"></a>7.2.11. /proc/filesystems</span></h3></li></ul>
<p><a name="bookmark3642"></a><span class="font25"><a name="bookmark3643"></a><a name="bookmark3644"></a>The </span><span class="font25" style="font-weight:bold;">/proc/filesystems </span><span class="font25">file displays a list of supported file systems. When you mount a file system without explicitly defining one, then mount will first try to probe </span><span class="font25" style="font-weight:bold;">/etc/filesystems </span><span class="font25">and then probe </span><span class="font25" style="font-weight:bold;">/proc/filesystems </span><span class="font25">for all the filesystems without the </span><span class="font25" style="font-weight:bold;">nodev </span><span class="font25">label. If </span><span class="font25" style="font-weight:bold;">/etc/ filesystems </span><span class="font25">ends with a line containing only an asterisk (*) then both files are probed.</span></p>
<p><span class="font19">paul@RHELv4u4:~$ cat /proc/filesystems nodev sysfs nodev rootfs nodev bdev nodev proc nodev sockfs nodev binfmt_misc nodev usbfs nodev usbdevfs nodev futexfs nodev tmpfs nodev pipefs nodev eventpollfs nodev devpts ext2 nodev ramfs nodev hugetlbfs iso9660 nodev relayfs nodev mqueue nodev selinuxfs ext3 nodev rpc_pipefs nodev vmware-hgfs nodev autofs paul@RHELv4u4:~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3645"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3032"></a><a name="bookmark3646"></a>7.3. putting a file system on a partition</span></h2></li></ul>
<h4><a name="bookmark3647"></a><span class="font25"><a name="bookmark3648"></a>We now have a fresh partition. The system binaries to make file systems can be found with ls.</span></h4>
<div>
<p><span class="font19">[root@RHEL4b ~]# ls -lS</span></p>
</div><br clear="all">
<div>
<p><span class="font19">-rwxr-xr-x</span></p>
<p><span class="font19">-rwxr-xr-x</span></p>
<p><span class="font19">-rwxr-xr-x</span></p>
<p><span class="font19">-rwxr-xr-x</span></p>
<p><span class="font19">-rwxr-xr-x</span></p>
<p><span class="font19">-rwxr-xr-x</span></p>
<p><span class="font19">-rwxr-xr-x</span></p>
<p><span class="font19">-rwxr-x---</span></p>
<p><span class="font19">-rwxr-xr-x</span></p>
<p><span class="font19">-rwxr-xr-x</span></p>
<p><span class="font19">-rwxr-xr-x</span></p>
<p><span class="font19">-rwxr-xr-x</span></p>
</div><br clear="all">
<div>
<p><span class="font19">3 root root</span></p>
<p><span class="font19">3 root root</span></p>
<p><span class="font19">3 root root</span></p>
<p><span class="font19">3 root root</span></p>
<p><span class="font19">3 root root</span></p>
<p><span class="font19">3 root root</span></p>
<p><span class="font19">1 root root</span></p>
<p><span class="font19">1 root root</span></p>
<p><span class="font19">1 root root</span></p>
<p><span class="font19">1 root root</span></p>
<p><span class="font19">1 root root</span></p>
<p><span class="font19">1 root root</span></p>
</div><br clear="all">
<div>
<p><span class="font19">/sbin/mk*</span></p>
<p><span class="font19">34832 Apr 24</span></p>
<p><span class="font19">34832 Apr 24</span></p>
<p><span class="font19">34832 Apr 24</span></p>
<p><span class="font19">28484 Oct 13</span></p>
<p><span class="font19">28484 Oct 13</span></p>
<p><span class="font19">28484 Oct 13</span></p>
<p><span class="font19">20313 Apr 10</span></p>
<p><span class="font19">15444 Oct 5</span></p>
<p><span class="font19">15300 May 24</span></p>
<p><span class="font19">13036 May 24</span></p>
<p><span class="font19">6912 May 24</span></p>
<p><span class="font19">5905 Aug 3</span></p>
</div><br clear="all">
<div>
<p><span class="font19">2006 /sbin/mke2fs</span></p>
<p><span class="font19">2006 /sbin/mkfs.ext2</span></p>
<p><span class="font19">2006 /sbin/mkfs.ext3</span></p>
<p><span class="font19">2004 /sbin/mkdosfs</span></p>
<p><span class="font19">2004 /sbin/mkfs.msdos</span></p>
<p><span class="font19">2004 /sbin/mkfs.vfat</span></p>
<p><span class="font19">2006 /sbin/mkinitrd</span></p>
<p><span class="font19">2004 /sbin/mkzonedb</span></p>
<p><span class="font19">2006 /sbin/mkfs.cramfs</span></p>
<p><span class="font19">2006 /sbin/mkswap</span></p>
<p><span class="font19">2006 /sbin/mkfs</span></p>
<p><span class="font19">2004 /sbin/mkbootdisk</span></p>
</div><br clear="all">
<p><span class="font19">[root@RHEL4b ~]#</span></p>
<h4><a name="bookmark3649"></a><span class="font25"><a name="bookmark3650"></a><a name="bookmark3651"></a><a name="bookmark3652"></a><a name="bookmark3653"></a>It is time for you to read the manual pages of </span><span class="font25" style="font-weight:bold;">mkfs </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">mke2fs</span><span class="font25">. In the example below, you see the creation of an </span><span class="font25" style="font-weight:bold;">ext2 file system </span><span class="font25">on /dev/sdb1. In real life, you might want to use options like -m0 and -j.</span></h4>
<p><span class="font19">root@RHELv4u2:~# mke2fs /dev/sdb1 mke2fs 1.35 (28-Feb-2004)</span></p>
<p><span class="font19">Filesystem label=</span></p>
<p><span class="font19">OS type: Linux</span></p>
<p><span class="font19">Block size=1024 (log=0)</span></p>
<p><span class="font19">Fragment size=1024 (log=0) 28112 inodes, 112420 blocks 5621 blocks (5.00%) reserved for the super user First data block=1</span></p>
<p><span class="font19">Maximum filesystem blocks=67371008 14 block groups</span></p>
<p><span class="font19">8192 blocks per group, 8192 fragments per group</span></p>
<p><span class="font19">2008 inodes per group</span></p>
<p><span class="font19">Superblock backups stored on blocks: 8193, 24577, 40961, 57345, 73729</span></p>
<p><span class="font19">Writing inode tables: done</span></p>
<p><span class="font19">Writing superblocks and filesystem accounting information: done</span></p>
<p><span class="font19">This filesystem will be automatically checked every 37 mounts or 180 days, whichever comes first. Use tune2fs -c or -i to override.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3654"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3033"></a><a name="bookmark3655"></a>7.4. tuning a file system</span></h2></li></ul>
<h4><a name="bookmark3656"></a><span class="font25"><a name="bookmark3657"></a><a name="bookmark3658"></a>You can use </span><span class="font25" style="font-weight:bold;">tune2fs </span><span class="font25">to list and set file system settings. The first screenshot lists the reserved space for root (which is set at five percent).</span></h4>
<p><span class="font19">[root@rhel4 ~]# tune2fs -l /dev/sdal | grep -i &quot;block count&quot;</span></p>
<p><span class="font19">Block count: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;104388</span></p>
<p><span class="font19">Reserved block count: &nbsp;&nbsp;&nbsp;&nbsp;5219</span></p>
<p><span class="font19">[root@rhel4 ~]#</span></p>
<h4><a name="bookmark3659"></a><span class="font25"><a name="bookmark3660"></a>This example changes this value to ten percent. You can use tune2fs while the file system is active, even if it is the root file system (as in this example).</span></h4>
<p><span class="font19">[root@rhel4 ~]# tune2fs -m10 /dev/sda1</span></p>
<p><span class="font19">tune2fs 1.35 (28-Feb-2004)</span></p>
<p><span class="font19">Setting reserved blocks percentage to 10 (10430 blocks)</span></p>
<p><span class="font19">[root@rhel4 ~]# tune2fs -l /dev/sda1 | grep -i &quot;block count&quot;</span></p>
<p><span class="font19">Block count: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;104388</span></p>
<p><span class="font19">Reserved block count: &nbsp;&nbsp;&nbsp;&nbsp;10430</span></p>
<p><span class="font19">[root@rhel4 ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3661"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3034"></a><a name="bookmark3662"></a>7.5. checking a file system</span></h2></li></ul>
<h4><a name="bookmark3663"></a><span class="font25"><a name="bookmark3664"></a><a name="bookmark3665"></a>The </span><span class="font25" style="font-weight:bold;">fsck </span><span class="font25">command is a front end tool used to check a file system for errors.</span></h4>
<p><span class="font19">[root@RHEL4b ~]# ls /sbin/*fsck*</span></p>
<p><span class="font19">/sbin/dosfsck /sbin/fsck &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/sbin/fsck.ext2 /sbin/fsck.msdos</span></p>
<p><span class="font19">/sbin/e2fsck /sbin/fsck.cramfs /sbin/fsck.ext3 /sbin/fsck.vfat [root@RHEL4b ~]#</span></p>
<h4><a name="bookmark3666"></a><span class="font25"><a name="bookmark3667"></a><a name="bookmark3668"></a>The last column in </span><span class="font25" style="font-weight:bold;">/etc/fstab </span><span class="font25">is used to determine whether a file system should be checked at boot-up.</span></h4>
<p><span class="font19">[paul@RHEL4b ~]$ grep ext /etc/fstab</span></p>
<p><span class="font19">/dev/VolGroup00/LogVol00 &nbsp;&nbsp;/ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ext3 &nbsp;&nbsp;&nbsp;defaults &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 1</span></p>
<p><span class="font19">LABEL=/boot &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/boot &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ext3 &nbsp;&nbsp;&nbsp;defaults &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 2</span></p>
<p><span class="font19">[paul@RHEL4b ~]$</span></p>
<h4><a name="bookmark3669"></a><span class="font25"><a name="bookmark3670"></a>Manually checking a mounted file system results in a warning from fsck.</span></h4>
<p><span class="font19">[root@RHEL4b ~]# fsck /boot fsck 1.35 (28-Feb-2004) e2fsck 1.35 (28-Feb-2004) /dev/sda1 is mounted.</span></p>
<p><span class="font19">WARNING!!! Running e2fsck on a mounted filesystem may cause SEVERE filesystem damage.</span></p>
<p><span class="font19">Do you really want to continue (y/n)? no</span></p>
<p><span class="font19">check aborted.</span></p>
<h4><a name="bookmark3671"></a><span class="font25"><a name="bookmark3672"></a><a name="bookmark3673"></a>But after unmounting fsck and </span><span class="font25" style="font-weight:bold;">e2fsck </span><span class="font25">can be used to check an ext2 file system.</span></h4>
<p><span class="font19">[root@RHEL4b ~]# fsck /boot fsck 1.35 (28-Feb-2004) e2fsck 1.35 (28-Feb-2004) /boot: clean, 44/26104 files, 17598/104388 blocks [root@RHEL4b ~]# fsck -p /boot fsck 1.35 (28-Feb-2004)</span></p>
<p><span class="font19">/boot: clean, 44/26104 files, 17598/104388 blocks [root@RHEL4b ~]# e2fsck -p /dev/sda1 /boot: clean, 44/26104 files, 17598/104388 blocks</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3674"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3035"></a><a name="bookmark3675"></a>7.6. practice: file systems</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. List the filesystems that are known by your system.</span></p></li>
<li>
<p><span class="font25">2. Create an </span><span class="font25" style="font-weight:bold;">ext2 </span><span class="font25">filesystem on the 200MB partition.</span></p></li>
<li>
<p><span class="font25">3. Create an </span><span class="font25" style="font-weight:bold;">ext3 </span><span class="font25">filesystem on one of the 300MB logical drives.</span></p></li>
<li>
<p><span class="font25">4. Create an </span><span class="font25" style="font-weight:bold;">ext4 </span><span class="font25">on the 400MB partition.</span></p></li>
<li>
<p><span class="font25">5. Set the reserved space for root on the ext3 filesystem to 0 percent.</span></p></li>
<li>
<p><span class="font25">6. Verify your work with </span><span class="font25" style="font-weight:bold;">fdisk </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">df</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">7. Perform a file system check on all the new file systems.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3676"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3036"></a><a name="bookmark3677"></a>7.7. solution: file systems</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3678"></a><span class="font25"><a name="bookmark3679"></a>1. List the filesystems that are known by your system.</span></h4></li></ul>
<p><span class="font19">man fs</span></p>
<p><span class="font19">cat /proc/filesystems</span></p>
<p><span class="font19">cat /etc/filesystems (not on all Linux distributions)</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3680"></a><span class="font25"><a name="bookmark3681"></a>2. Create an </span><span class="font25" style="font-weight:bold;">ext2 </span><span class="font25">filesystem on the 200MB partition.</span></h4></li></ul>
<p><span class="font19">mke2fs /dev/sdc1 (replace sdc1 with the correct partition)</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3682"></a><span class="font25"><a name="bookmark3683"></a>3. Create an </span><span class="font25" style="font-weight:bold;">ext3 </span><span class="font25">filesystem on one of the 300MB logical drives.</span></h4></li></ul>
<p><span class="font19">mke2fs -j /dev/sdb5 (replace sdb5 with the correct partition)</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3684"></a><span class="font25"><a name="bookmark3685"></a>4. Create an </span><span class="font25" style="font-weight:bold;">ext4 </span><span class="font25">on the 400MB partition.</span></h4></li></ul>
<p><span class="font19">mkfs.ext4 /dev/sdb1 (replace sdb1 with the correct partition)</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3686"></a><span class="font25"><a name="bookmark3687"></a>5. Set the reserved space for root on the ext3 filesystem to 0 percent.</span></h4></li></ul>
<p><span class="font19">tune2fs -m 0 /dev/sdb5</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3688"></a><span class="font25"><a name="bookmark3689"></a>6. Verify your work with </span><span class="font25" style="font-weight:bold;">fdisk </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">df</span><span class="font25">.</span></h4></li></ul>
<p><span class="font19">mkfs (mke2fs) makes no difference in the output of these commands The big change is in the next topic: mounting</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3690"></a><span class="font25"><a name="bookmark3691"></a>7. Perform a file system check on all the new file systems.</span></h4></li></ul>
<p><span class="font19">fsck /dev/sdb1</span></p>
<p><span class="font19">fsck /dev/sdc1</span></p>
<p><span class="font19">fsck /dev/sdb5</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark3692"></a><span class="font11" style="font-weight:bold;"><a name="bookmark3693"></a><a name="bookmark3694"></a>Chapter 8. mounting</span></h1></li></ul>
<p><a name="bookmark3695"></a><span class="font25"><a name="bookmark3696"></a>Once you've put a file system on a partition, you can </span><span class="font25" style="font-weight:bold;">mount </span><span class="font25">it. Mounting a file system makes it available for use, usually as a directory. We say </span><span class="font25" style="font-weight:bold;">mounting a file system </span><span class="font25">instead of mounting a partition because we will see later that we can also mount file systems that do not exists on partitions.</span></p>
<p><a name="bookmark3697"></a><span class="font25">On all </span><span class="font25" style="font-weight:bold;">Unix </span><span class="font25">systems, every file and every directory is part of one big file tree. To access a file, you need to know the full path starting from the root directory. When adding a </span><span class="font25" style="font-weight:bold;">file system </span><span class="font25">to your computer, you need to make it available somewhere in the file tree. The directory where you make a file system available is called a </span><span class="font25" style="font-weight:bold;">mount point</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3698"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3038"></a><a name="bookmark3699"></a>8.1. mounting local file systems</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark713"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3700"></a>8.1.1. mkdir</span></h3></li></ul></li></ul>
<p><a name="bookmark3701"></a><span class="font25">This example shows how to create a new </span><span class="font25" style="font-weight:bold;">mount point </span><span class="font25">with </span><span class="font25" style="font-weight:bold;">mkdir</span><span class="font25">.</span></p>
<p><span class="font19">root@RHELv4u2:~# mkdir /home/project42</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3702"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3703"></a>8.1.2. mount</span></h3></li></ul>
<p><span class="font25">When the </span><span class="font25" style="font-weight:bold;">mount point </span><span class="font25">is created, and a </span><span class="font25" style="font-weight:bold;">file system </span><span class="font25">is present on the partition, then </span><span class="font25" style="font-weight:bold;">mount </span><span class="font25">can </span><span class="font25" style="font-weight:bold;">mount </span><span class="font25">the </span><span class="font25" style="font-weight:bold;">file system </span><span class="font25">on the </span><span class="font25" style="font-weight:bold;">mount point directory</span><span class="font25">.</span></p>
<p><span class="font19">root@RHELv4u2:~# mount -t ext2 /dev/sdbl /home/project42/</span></p>
<p><span class="font25">Once mounted, the new file system is accessible to users.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3704"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3705"></a>8.1.3. /etc/filesystems</span></h3></li></ul>
<p><span class="font25">Actually the explicit </span><span class="font25" style="font-weight:bold;">-t ext2 </span><span class="font25">option to set the file system is not always necessary. The </span><span class="font25" style="font-weight:bold;">mount </span><span class="font25">command is able to automatically detect a lot of file systems.</span></p>
<p><a name="bookmark3706"></a><span class="font25"><a name="bookmark3707"></a><a name="bookmark3708"></a>When mounting a file system without specifying explicitly the file system, then </span><span class="font25" style="font-weight:bold;">mount </span><span class="font25">will first probe </span><span class="font25" style="font-weight:bold;">/etc/filesystems</span><span class="font25">. Mount will skip lines with the </span><span class="font25" style="font-weight:bold;">nodev </span><span class="font25">directive.</span></p>
<p><span class="font19">paul@RHELv4u4:~$ cat /etc/filesystems ext3 ext2 nodev proc nodev devpts iso9660 vfat hfs</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3709"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3710"></a>8.1.4. /proc/filesystems</span></h3></li></ul>
<p><a name="bookmark3711"></a><span class="font25">When </span><span class="font25" style="font-weight:bold;">/etc/filesystems </span><span class="font25">does not exist, or ends with a single * on the last line, then </span><span class="font25" style="font-weight:bold;">mount </span><span class="font25">will read </span><span class="font25" style="font-weight:bold;">/proc/filesystems</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL52 ~]# cat /proc/filesystems | grep -v </span><span class="font18"><sup>A</sup></span><span class="font19">nodev ext2 iso9660 ext3</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3712"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3713"></a>8.1.5. umount</span></h3></li></ul>
<p><span class="font25">You can </span><span class="font25" style="font-weight:bold;">unmount </span><span class="font25">a mounted file system using the </span><span class="font25" style="font-weight:bold;">umount </span><span class="font25">command.</span></p>
<p><span class="font19">root@pasha:~# umount /home/reet</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3714"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3039"></a><a name="bookmark3715"></a>8.2. displaying mounted file systems</span></h2></li></ul>
<p><a name="bookmark3716"></a><span class="font25"><a name="bookmark3717"></a>To display all mounted file systems, issue the </span><span class="font25" style="font-weight:bold;">mount </span><span class="font25">command. Or look at the files </span><span class="font25" style="font-weight:bold;">/proc/ mounts </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/etc/mtab</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3718"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3719"></a>8.2.1. mount</span></h3></li></ul>
<p><a name="bookmark3720"></a><span class="font25">The simplest and most common way to view all mounts is by issuing the </span><span class="font25" style="font-weight:bold;">mount </span><span class="font25">command without any arguments.</span></p>
<p><span class="font19">root@RHELv4u2:~# mount | grep /dev/sdb</span></p>
<p><span class="font19">/dev/sdbl on /home/project42 type ext2 (rw)</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3721"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3722"></a>8.2.2. /proc/mounts</span></h3></li></ul>
<p><span class="font25">The kernel provides the info in </span><span class="font25" style="font-weight:bold;">/proc/mounts </span><span class="font25">in file form, but </span><span class="font25" style="font-weight:bold;">/proc/mounts </span><span class="font25">does not exist as a file on any hard disk. Looking at </span><span class="font25" style="font-weight:bold;">/proc/mounts </span><span class="font25">is looking at information that comes directly from the kernel.</span></p>
<p><span class="font19">root@RHELv4u2:~# cat /proc/mounts | grep /dev/sdb /dev/sdbl /home/project42 ext2 rw 0 0</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3723"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3724"></a>8.2.3. /etc/mtab</span></h3></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">/etc/mtab </span><span class="font25">file is not updated by the kernel, but is maintained by the </span><span class="font25" style="font-weight:bold;">mount </span><span class="font25">command.</span></p>
<p><span class="font25">Do not edit </span><span class="font25" style="font-weight:bold;">/etc/mtab </span><span class="font25">manually.</span></p>
<p><span class="font19">root@RHELv4u2:~# cat /etc/mtab | grep /dev/sdb /dev/sdb1 /home/project42 ext2 rw 0 0</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark709"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3725"></a>8.2.4. df</span></h3></li></ul>
<p><a name="bookmark3726"></a><span class="font25">A more user friendly way to look at mounted file systems is </span><span class="font25" style="font-weight:bold;">df</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">df (diskfree) </span><span class="font25">command has the added benefit of showing you the free space on each mounted disk. Like a lot of Linux commands, </span><span class="font25" style="font-weight:bold;">df </span><span class="font25">supports the </span><span class="font25" style="font-weight:bold;">-h </span><span class="font25">switch to make the output more </span><span class="font25" style="font-weight:bold;">human readable</span><span class="font25">.</span></p>
<p><span class="font19">root@RHELv4u2:~# df</span></p>
<p><span class="font19">Filesystem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lK-blocks Used Available Use% Mounted on</span></p>
<p><span class="font19">/dev/mapper/VolGroup00-LogVol00</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">11707972</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6366996</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4746240</span></p></td><td colspan="4" style="vertical-align:bottom;">
<p><span class="font19">58% /</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sda1</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">101086</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">9300</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">86567</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10%</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/boot</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">none</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">127988</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">127988</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0%</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/dev/shm</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/sdb1</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">108865</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1550</span></p></td><td style="vertical-align:top;">
<p><span class="font19">101694</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2%</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/home/project42</span></p></td></tr>
</table>
<p><span class="font19">root@RHELv4u2:~# df -h</span></p>
<p><span class="font19">Filesystem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size Used Avail Use% Mounted on</span></p>
<p><span class="font19">/dev/mapper/VolGroup00-LogVol00</span></p>
<p><span class="font19">12G 6.1G 4.6G 58% /</span></p>
<p><span class="font19">/dev/sda1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;99M &nbsp;9.1M &nbsp;&nbsp;85M &nbsp;10% /boot</span></p>
<p><span class="font19">none &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;125M &nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;125M &nbsp;&nbsp;0% /dev/shm</span></p>
<p><span class="font19">/dev/sdb1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;107M &nbsp;1.6M &nbsp;100M &nbsp;&nbsp;2% /home/project42</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3727"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3728"></a>8.2.5. df -h</span></h3></li></ul>
<p><a name="bookmark3729"></a><span class="font25">In the </span><span class="font25" style="font-weight:bold;">df -h </span><span class="font25">example below you can see the size, free space, used gigabytes and percentage and mount point of a partition.</span></p>
<div>
<p><span class="font19">root@laika:~# df -h | egrep -e &quot;(sdb2|File)&quot; Filesystem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size Used Avail Use% Mounted on</span></p>
<p><span class="font19">/dev/sdb2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;92G &nbsp;&nbsp;83G 8.6G 91% /media/sdb2</span></p>
<p><span class="font9" style="font-weight:bold;">2.6. du</span></p>
</div><br clear="all">
<h3><a name="bookmark3730"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3731"></a>8.</span></h3>
<p><a name="bookmark3732"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">du </span><span class="font25">command can summarize </span><span class="font25" style="font-weight:bold;">disk usage </span><span class="font25">for files and directories. By using </span><span class="font25" style="font-weight:bold;">du </span><span class="font25">on a mount point you effectively get the disk space used on a file system.</span></p>
<p><span class="font25">While </span><span class="font25" style="font-weight:bold;">du </span><span class="font25">can go display each subdirectory recursively, the </span><span class="font25" style="font-weight:bold;">-s </span><span class="font25">option will give you a total summary for the parent directory. This option is often used together with </span><span class="font25" style="font-weight:bold;">-h</span><span class="font25">. This means </span><span class="font25" style="font-weight:bold;">du -sh </span><span class="font25">on a mount point gives the total amount used by the file system in that partition.</span></p>
<p><span class="font19">root@debian6~# du -sh /boot /srv/wolf</span></p>
<p><span class="font19">6.2M /boot</span></p>
<p><span class="font19">1.1T /srv/wolf</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3733"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3040"></a><a name="bookmark3734"></a>8.3. from start to finish</span></h2></li></ul>
<h4><a name="bookmark3735"></a><span class="font25"><a name="bookmark3736"></a>Below is a screenshot that show a summary roadmap starting with detection of the hardware (/dev/sdb) up until mounting on </span><span class="font25" style="font-weight:bold;">/mnt</span><span class="font25">.</span></h4>
<p><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">dmesg | grep '\[sdb\]' </span><span class="font19">sd 3:0:0:0: [sdb] 150994944 512-byte logical blocks: (77.3 GB/72.0 GiB) sd 3:0:0:0: [sdb] Write Protect is off sd 3:0:0:0: [sdb] Mode Sense: 00 3a 00 00 sd 3:0:0:0: [sdb] Write cache: enabled, read cache: enabled, doesn't support \ DPO or FUA sd 3:0:0:0: [sdb] Attached SCSI disk</span></p>
<p><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">parted /dev/sdb</span></p>
<p><span class="font19">(parted) </span><span class="font19" style="font-weight:bold;">mklabel msdos </span><span class="font19">(parted) </span><span class="font19" style="font-weight:bold;">mkpart primary ext4 1 77000 </span><span class="font19">(parted) </span><span class="font19" style="font-weight:bold;">print </span><span class="font19">Model: ATA VBOX HARDDISK (scsi) Disk /dev/sdb: 77.3GB Sector size (logical/physical): 512B/512B Partition Table: msdos</span></p>
<p><span class="font19">Number &nbsp;Start &nbsp;&nbsp;End &nbsp;&nbsp;&nbsp;&nbsp;Size &nbsp;&nbsp;&nbsp;Type &nbsp;&nbsp;&nbsp;&nbsp;File system Flags</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">1 1049kB &nbsp;77.0GB &nbsp;77.0GB &nbsp;primary</span></p></li></ul>
<p><span class="font19">(parted) </span><span class="font19" style="font-weight:bold;">quit </span><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">mkfs.ext4 /dev/sdb1 </span><span class="font19">mke2fs 1.41.12 (17-May-2010) Filesystem label= OS type: Linux Block size=4096 (log=2) Fragment size=4096 (log=2) Stride=0 blocks, Stripe width=0 blocks 4702208 inodes, 18798592 blocks 939929 blocks (5.00%) reserved for the super user First data block=0 Maximum filesystem blocks=4294967296 574 block groups 32768 blocks per group, 32768 fragments per group 8192 inodes per group ( output truncated ) ...</span></p>
<p><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">mount /dev/sdb1 /mnt </span><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">mount | grep mnt </span><span class="font19">/dev/sdb1 on /mnt type ext4 (rw) [root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">df -h | grep mnt </span><span class="font19">/dev/sdb1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;71G 180M &nbsp;&nbsp;67G &nbsp;&nbsp;1% /mnt</span></p>
<p><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">du -sh /mnt </span><span class="font19">20K /mnt [root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">umount /mnt</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3737"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3041"></a><a name="bookmark3738"></a>8.4. permanent mounts</span></h2></li></ul>
<p><span class="font25">Until now, we performed all mounts manually. This works nice, until the next reboot. Luckily there is a way to tell your computer to automatically mount certain file systems during boot.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3739"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3740"></a>8.4.1. /etc/fstab</span></h3></li></ul>
<p><a name="bookmark3741"></a><span class="font25">The file system table located in </span><span class="font25" style="font-weight:bold;">/etc/fstab </span><span class="font25">contains a list of file systems, with an option to automtically mount each of them at boot time.</span></p>
<p><span class="font25">Below is a sample </span><span class="font25" style="font-weight:bold;">/etc/fstab </span><span class="font25">file.</span></p>
<table border="1">
<tr><td colspan="6" style="vertical-align:bottom;">
<p><span class="font19">root@RHELv4u2:~# cat /etc/fstab</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/VolGroup00/LogVol00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ext3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">defaults</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">LABEL=/boot</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/boot</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ext3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">defaults</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">none</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/dev/pts</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">devpts</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">gid=5,mode=620</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">none</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/dev/shm</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tmpfs</span></p></td><td style="vertical-align:top;">
<p><span class="font19">defaults</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">none</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/proc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">proc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">defaults</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">none</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/sys</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sysfs</span></p></td><td style="vertical-align:top;">
<p><span class="font19">defaults</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/VolGroup00/LogVol01</span></p></td><td style="vertical-align:top;">
<p><span class="font19">swap</span></p></td><td style="vertical-align:top;">
<p><span class="font19">swap</span></p></td><td style="vertical-align:top;">
<p><span class="font19">defaults</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td></tr>
</table>
<p><span class="font25">By adding the following line, we can automate the mounting of a file system.</span></p>
<p><span class="font19">/dev/sdbl &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/home/project42 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ext2 defaults 0 0</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3742"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3743"></a>8.4.2. mount /mountpoint</span></h3></li></ul>
<p><span class="font25">Adding an entry to </span><span class="font25" style="font-weight:bold;">/etc/fstab </span><span class="font25">has the added advantage that you can simplify the </span><span class="font25" style="font-weight:bold;">mount </span><span class="font25">command. The command in the screenshot below forces </span><span class="font25" style="font-weight:bold;">mount </span><span class="font25">to look for the partition info in </span><span class="font25" style="font-weight:bold;">/etc/fstab</span><span class="font25">.</span></p>
<p><span class="font19">root@rhel65:~# mount /home/project42</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3744"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3042"></a><a name="bookmark3745"></a>8.5. securing mounts</span></h2></li></ul>
<h4><a name="bookmark3746"></a><span class="font25"><a name="bookmark3747"></a>File systems can be secured with several </span><span class="font25" style="font-weight:bold;">mount options</span><span class="font25">. Here are some examples.</span></h4>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3748"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3749"></a>8.5.1. ro</span></h3></li></ul>
<h4><a name="bookmark3750"></a><span class="font25"><a name="bookmark3751"></a>The </span><span class="font25" style="font-weight:bold;">ro </span><span class="font25">option will mount a file system as read only, preventing anyone from writing.</span></h4>
<p><span class="font19">root@rhel53 ~# mount -t ext2 -o ro /dev/hdbl /home/project42 root@rhel53 ~# touch /home/project42/testwrite</span></p>
<p><span class="font19">touch: cannot touch '/home/project42/testwrite': Read-only file system</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3752"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3753"></a>8.5.2. noexec</span></h3></li></ul>
<h4><a name="bookmark3754"></a><span class="font25"><a name="bookmark3755"></a><a name="bookmark3756"></a>The </span><span class="font25" style="font-weight:bold;">noexec </span><span class="font25">option will prevent the execution of binaries and scripts on the mounted file system.</span></h4>
<p><span class="font19">root@rhel53 ~# mount -t ext2 -o noexec /dev/hdbl /home/project42</span></p>
<p><span class="font19">root@rhel53 ~# cp /bin/cat /home/project42</span></p>
<p><span class="font19">root@rhel53 ~# /home/project42/cat /etc/hosts</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-bash: /home/project42/cat: Permission denied</span></p></li></ul>
<p><span class="font19">root@rhel53 ~# echo echo hello &gt;&nbsp;/home/project42/helloscript</span></p>
<p><span class="font19">root@rhel53 ~# chmod +x /home/project42/helloscript</span></p>
<p><span class="font19">root@rhel53 ~# /home/project42/helloscript</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-bash: /home/project42/helloscript: Permission denied</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3757"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3758"></a>8.5.3. nosuid</span></h3></li></ul>
<h4><a name="bookmark3759"></a><span class="font25"><a name="bookmark3760"></a><a name="bookmark3761"></a><a name="bookmark3762"></a>The </span><span class="font25" style="font-weight:bold;">nosuid </span><span class="font25">option will ignore </span><span class="font25" style="font-weight:bold;">setuid </span><span class="font25">bit set binaries on the mounted file system.</span><br><br><span class="font25"><a name="bookmark3763"></a>Note that you can still set the </span><span class="font25" style="font-weight:bold;">setuid </span><span class="font25">bit on files.</span></h4>
<p><span class="font19">root@rhel53 ~# mount -o nosuid /dev/hdb1 /home/project42</span></p>
<p><span class="font19">root@rhel53 ~# cp /bin/sleep /home/project42/</span></p>
<p><span class="font19">root@rhel53 ~# chmod 4555 /home/project42/sleep</span></p>
<p><span class="font19">root@rhel53 ~# ls -l /home/project42/sleep</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-r-sr-xr-x 1 root root 19564 Jun 24 17:57 /home/project42/sleep</span></p></li></ul>
<h4><a name="bookmark3764"></a><span class="font25"><a name="bookmark3765"></a>But users cannot exploit the </span><span class="font25" style="font-weight:bold;">setuid </span><span class="font25">feature.</span></h4>
<p><span class="font19">root@rhel53 ~# su - paul</span></p>
<p><span class="font19">[paul@rhel53 ~]$ /home/project42/sleep 500 &amp;</span></p>
<p><span class="font19">[1] 2876</span></p>
<p><span class="font19">[paul@rhel53 ~]$ ps -f 2876</span></p>
<p><span class="font19">UID &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PID &nbsp;PPID &nbsp;C STIME TTY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STAT &nbsp;&nbsp;TIME CMD</span></p>
<p><span class="font19">paul &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2876 &nbsp;2853 &nbsp;0 17:58 pts/0 &nbsp;&nbsp;&nbsp;S &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0:00 /home/project42/sleep 500</span></p>
<p><span class="font19">[paul@rhel53 ~]$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3766"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3767"></a>8.5.4. noacl</span></h3></li></ul>
<h4><a name="bookmark3768"></a><span class="font25"><a name="bookmark3769"></a><a name="bookmark3770"></a>To prevent cluttering permissions with </span><span class="font25" style="font-weight:bold;">acl's</span><span class="font25">, use the </span><span class="font25" style="font-weight:bold;">noacl </span><span class="font25">option.</span></h4>
<p><span class="font19">root@rhel53 ~# mount -o noacl /dev/hdb1 /home/project42</span></p>
<h4><a name="bookmark3771"></a><span class="font25"><a name="bookmark3772"></a>More </span><span class="font25" style="font-weight:bold;">mount options </span><span class="font25">can be found in the manual page of </span><span class="font25" style="font-weight:bold;">mount</span><span class="font25">.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3773"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3043"></a><a name="bookmark3774"></a>8.6. mounting remote file systems</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark3775"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3776"></a>8.6.1. smb/cifs</span></h3></li></ul></li></ul>
<p><span class="font25">The Samba team (samba.org) has a Unix/Linux service that is compatible with the SMB/ CIFS protocol. This protocol is mainly used by networked Microsoft Windows computers.</span></p>
<p><span class="font25">Connecting to a Samba server (or to a Microsoft computer) is also done with the mount command.</span></p>
<p><span class="font25">This example shows how to connect to the </span><span class="font25" style="font-weight:bold;">10.0.0.42 </span><span class="font25">server, to a share named </span><span class="font25" style="font-weight:bold;">data2</span><span class="font25">.</span></p>
<p><span class="font19">[root@centos65 ~]# mount -t cifs -o user=paul //10.0.0.42/data2 /home/data2 Password:</span></p>
<p><span class="font19">[root@centos65 ~]# mount | grep cifs</span></p>
<p><span class="font19">//10.0.0.42/data2 on /home/data2 type cifs (rw)</span></p>
<p><span class="font25">The above requires </span><span class="font25" style="font-weight:bold;">yum install cifs-client</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3777"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3778"></a>8.6.2. nfs</span></h3></li></ul>
<p><span class="font25">Unix servers often use </span><span class="font25" style="font-weight:bold;">nfs </span><span class="font25">(aka the network file system) to share directories over the network. Setting up an nfs server is discussed later. Connecting as a client to an nfs server is done with </span><span class="font25" style="font-weight:bold;">mount</span><span class="font25">, and is very similar to connecting to local storage.</span></p>
<p><span class="font25">This command shows how to connect to the nfs server named </span><span class="font25" style="font-weight:bold;">server42</span><span class="font25">, which is sharing the directory </span><span class="font25" style="font-weight:bold;">/srv/data</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">mount point </span><span class="font25">at the end of the command (</span><span class="font25" style="font-weight:bold;">/home/data</span><span class="font25">) must already exist.</span></p>
<p><span class="font19">[root@centos65 ~]# mount -t nfs server42:/srv/data /home/data [root@centos65 ~]#</span></p>
<p><span class="font25">If this </span><span class="font25" style="font-weight:bold;">server42 </span><span class="font25">has ip-address </span><span class="font25" style="font-weight:bold;">10.0.0.42 </span><span class="font25">then you can also write:</span></p>
<p><span class="font19">[root@centos65 ~]# mount -t nfs 10.0.0.42:/srv/data /home/data</span></p>
<p><span class="font19">[root@centos65 ~]# mount | grep data</span></p>
<p><span class="font19">10.0.0.42:/srv/data on /home/data type nfs (rw,vers=4,addr=10.0.0.42,clienta\ ddr=10.0.0.33)</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3779"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3780"></a>8.6.3. nfs specific mount options</span></h3></li></ul>
<p><span class="font19" style="font-weight:bold;">bg </span><span class="font19">If mount fails, retry in background.</span></p>
<p><span class="font19" style="font-weight:bold;">fg </span><span class="font19">(default)If mount fails, retry in foreground.</span></p>
<p><span class="font19" style="font-weight:bold;">soft </span><span class="font19">Stop trying to mount after X attempts.</span></p>
<p><span class="font19" style="font-weight:bold;">hard </span><span class="font19">(default)Continue trying to mount.</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">soft+bg </span><span class="font25">options combined guarantee the fastest client boot if there are NFS problems.</span></p>
<p><span class="font19" style="font-weight:bold;">retrans=X </span><span class="font19">Try X times to connect (over udp). </span><span class="font19" style="font-weight:bold;">tcp </span><span class="font19">Force tcp (default and supported) </span><span class="font19" style="font-weight:bold;">udp </span><span class="font19">Force udp (unsupported)</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3781"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3044"></a><a name="bookmark3782"></a>8.7. practice: mounting file systems</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Mount the small 200MB partition on /home/project22.</span></p></li>
<li>
<p><span class="font25">2. Mount the big 400MB primary partition on /mnt, the copy some files to it (everything in / etc). Then umount, and mount the file system as read only on /srv/nfs/salesnumbers. Where are the files you copied ?</span></p></li>
<li>
<p><span class="font25">3. Verify your work with </span><span class="font25" style="font-weight:bold;">fdisk</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">df </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">mount</span><span class="font25">. Also look in </span><span class="font25" style="font-weight:bold;">/etc/mtab </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/proc/mounts</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">4. Make both mounts permanent, test that it works.</span></p></li>
<li>
<p><span class="font25">5. What happens when you mount a file system on a directory that contains some files ?</span></p></li>
<li>
<p><span class="font25">6. What happens when you mount two file systems on the same mount point ?</span></p></li>
<li>
<p><span class="font25">7. (optional) Describe the difference between these commands: find, locate, updatedb, makewhatis, whereis, apropos, which and type.</span></p></li>
<li>
<p><span class="font25">8. (optional) Perform a file system check on the partition mounted at /srv/nfs/salesnumbers.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3783"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3045"></a><a name="bookmark3784"></a>8.8. solution: mounting file systems</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3785"></a><span class="font25"><a name="bookmark3786"></a>1. Mount the small 200MB partition on /home/project22.</span></h4></li></ul>
<p><span class="font19">mkdir /home/project22</span></p>
<p><span class="font19">mount /dev/sdcl /home/project22</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3787"></a><span class="font25"><a name="bookmark3788"></a>2. Mount the big 400MB primary partition on /mnt, the copy some files to it (everything in / etc). Then umount, and mount the file system as read only on /srv/nfs/salesnumbers. Where are the files you copied ?</span></h4></li></ul>
<p><span class="font19">mount /dev/sdbl /mnt</span></p>
<p><span class="font19">cp -r /etc /mnt</span></p>
<p><span class="font19">ls -l /mnt</span></p>
<p><span class="font19">umount /mnt</span></p>
<p><span class="font19">ls -l /mnt</span></p>
<p><span class="font19">mkdir -p /srv/nfs/salesnumbers</span></p>
<p><span class="font19">mount /dev/sdbl /srv/nfs/salesnumbers</span></p>
<p><span class="font19">You see the files in /srv/nfs/salenumbers now...</span></p>
<p><span class="font19">But physically they are on ext3 on partition /dev/sdb1</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3789"></a><span class="font25"><a name="bookmark3790"></a>3. Verify your work with </span><span class="font25" style="font-weight:bold;">fdisk</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">df </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">mount</span><span class="font25">. Also look in </span><span class="font25" style="font-weight:bold;">/etc/mtab </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/proc/mounts</span><span class="font25">.</span></h4></li></ul>
<p><span class="font19">fdisk -l</span></p>
<p><span class="font19">df -h</span></p>
<p><span class="font19">mount</span></p>
<p><span class="font19">All three the above commands should show your mounted partitions.</span></p>
<p><span class="font19">grep project22 /etc/mtab</span></p>
<p><span class="font19">grep project22 /proc/mounts</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3791"></a><span class="font25"><a name="bookmark3792"></a>4. Make both mounts permanent, test that it works.</span></h4></li></ul>
<p><span class="font19">add the following lines to /etc/fstab</span></p>
<p><span class="font19">/dev/sdc1 /home/project22 auto defaults 0 0</span></p>
<p><span class="font19">/dev/sdb1 /srv/nfs/salesnumbers auto defaults 0 0</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3793"></a><span class="font25"><a name="bookmark3794"></a>5. What happens when you mount a file system on a directory that contains some files ?</span></h4></li></ul>
<p><span class="font19">The files are hidden until </span><span class="font19" style="font-weight:bold;">umount</span><span class="font19">.</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark3795"></a><span class="font25"><a name="bookmark3796"></a>6. What happens when you mount two file systems on the same mount point ?</span></h4></li></ul>
<p><span class="font19">Only the last mounted fs is visible.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. (optional) Describe the difference between these commands: find, locate, updatedb, makewhatis, whereis, apropos, which and type.</span></p></li></ul>
<p><span class="font19">man find</span></p>
<p><span class="font19">man locate</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. (optional) Perform a file system check on the partition mounted at /srv/nfs/salesnumbers.</span></p></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font19"># umount /srv/nfs/salesnumbers (optional but recommended)</span></p></li>
<li>
<p><span class="font19"># fsck /dev/sdbl</span></p></li></ul>
<h1><a name="bookmark3797"></a><span class="font11" style="font-weight:bold;"><a name="bookmark3046"></a><a name="bookmark3798"></a>Chapter 9. troubleshooting tools</span></h1>
<p><span class="font25">This chapter introduces some tools that go beyond </span><span class="font25" style="font-weight:bold;">df -h </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">du -sh</span><span class="font25">. Tools that will enable you to troubleshoot a variety of issues with </span><span class="font25" style="font-weight:bold;">file systems </span><span class="font25">and storage.</span></p>
<h2><a name="bookmark3799"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3047"></a><a name="bookmark3800"></a>9.1. lsof</span></h2>
<p><a name="bookmark3801"></a><span class="font25">List open files with </span><span class="font25" style="font-weight:bold;">lsof</span><span class="font25">.</span></p>
<p><span class="font25">When invoked without options, </span><span class="font25" style="font-weight:bold;">lsof </span><span class="font25">will list all open files. You can see the command (init in this case), its PID (1) and the user (root) has openend the root directory and </span><span class="font25" style="font-weight:bold;">/sbin/init</span><span class="font25">. The FD (file descriptor) columns shows that / is both the root directory (rtd) and current working directory (cwd) for the /sbin/init command. The FD column displays </span><span class="font25" style="font-weight:bold;">rtd </span><span class="font25">for root directory, </span><span class="font25" style="font-weight:bold;">cwd </span><span class="font25">for current directory and </span><span class="font25" style="font-weight:bold;">txt </span><span class="font25">for text (both including data and code).</span></p>
<p><span class="font19">root@debian7:~# lsof | head -4</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">COMMAND</span></p></td><td style="vertical-align:top;">
<p><span class="font19">PID</span></p></td><td style="vertical-align:top;">
<p><span class="font19">TID</span></p></td><td style="vertical-align:top;">
<p><span class="font19">USER</span></p></td><td style="vertical-align:top;">
<p><span class="font19">FD</span></p></td><td style="vertical-align:top;">
<p><span class="font19">TYPE</span></p></td><td style="vertical-align:top;">
<p><span class="font19">DEVICE</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SIZE/OFF</span></p></td><td style="vertical-align:top;">
<p><span class="font19">NODE</span></p></td><td style="vertical-align:top;">
<p><span class="font19">NAME</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">init</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">cwd</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">DIR</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">254,0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">init</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">rtd</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">DIR</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">254,0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">init</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">txt</span></p></td><td style="vertical-align:top;">
<p><span class="font19">REG</span></p></td><td style="vertical-align:top;">
<p><span class="font19">254,0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">36992</span></p></td><td style="vertical-align:top;">
<p><span class="font19">130856</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/sbin/init</span></p></td></tr>
</table>
<p><span class="font25">Other options in the FD column besides w for writing, are r for reading and u for both reading and writing. You can look at open files for a process id by typing </span><span class="font25" style="font-weight:bold;">lsof -p PID</span><span class="font25">. For </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">this would look like this:</span></p>
<p><span class="font19">lsof -p 1</span></p>
<p><span class="font25">The screenshot below shows basic use of </span><span class="font25" style="font-weight:bold;">lsof </span><span class="font25">to prove that </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">keeps a </span><span class="font25" style="font-weight:bold;">.swp </span><span class="font25">file open (even when stopped in background) on our freshly mounted file system.</span></p>
<p><span class="font19">[root@RHEL65 ~]# df -h | grep sdb</span></p>
<p><span class="font19">/dev/sdbl &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;541M &nbsp;&nbsp;17M 497M &nbsp;&nbsp;4% /srv/project33</span></p>
<p><span class="font19">[root@RHEL65 ~]# vi /srv/project33/busyfile.txt</span></p>
<p><span class="font19">[1]+ Stopped &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vi /srv/project33/busyfile.txt</span></p>
<p><span class="font19">[root@RHEL65 ~]# lsof /srv/*</span></p>
<p><span class="font19">COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME</span></p>
<p><span class="font19">vi 3243 root &nbsp;&nbsp;3u REG 8,17 &nbsp;&nbsp;4096 &nbsp;&nbsp;12 /srv/project33/.busyfile.txt.swp</span></p>
<p><a name="bookmark3802"></a><span class="font25">Here we see that </span><span class="font25" style="font-weight:bold;">rsyslog </span><span class="font25">has a couple of log files open for writing (the FD column).</span></p>
<table border="1">
<tr><td colspan="3" style="vertical-align:bottom;">
<p><span class="font19">root@debian7:~# lsof</span></p></td><td colspan="6" style="vertical-align:bottom;">
<p><span class="font19">/var/log/*</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">COMMAND</span></p></td><td style="vertical-align:top;">
<p><span class="font19">PID</span></p></td><td style="vertical-align:top;">
<p><span class="font19">USER</span></p></td><td style="vertical-align:top;">
<p><span class="font19">FD</span></p></td><td style="vertical-align:top;">
<p><span class="font19">TYPE</span></p></td><td style="vertical-align:top;">
<p><span class="font19">DEVICE</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SIZE/OFF</span></p></td><td style="vertical-align:top;">
<p><span class="font19">NODE</span></p></td><td style="vertical-align:top;">
<p><span class="font19">NAME</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">rsyslogd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2013</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1w</span></p></td><td style="vertical-align:top;">
<p><span class="font19">REG</span></p></td><td style="vertical-align:top;">
<p><span class="font19">254,0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">454297</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1308187</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/var/log/syslog</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">rsyslogd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2013</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2w</span></p></td><td style="vertical-align:top;">
<p><span class="font19">REG</span></p></td><td style="vertical-align:top;">
<p><span class="font19">254,0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">419328</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1308189</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/var/log/kern.log</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">rsyslogd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2013</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5w</span></p></td><td style="vertical-align:top;">
<p><span class="font19">REG</span></p></td><td style="vertical-align:top;">
<p><span class="font19">254,0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">116725</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1308200</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/var/log/debug</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">rsyslogd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2013</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">6w</span></p></td><td style="vertical-align:top;">
<p><span class="font19">REG</span></p></td><td style="vertical-align:top;">
<p><span class="font19">254,0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">309847</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1308201</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/var/log/messages</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">rsyslogd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2013</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">7w</span></p></td><td style="vertical-align:top;">
<p><span class="font19">REG</span></p></td><td style="vertical-align:top;">
<p><span class="font19">254,0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">17591</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1308188</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/var/log/daemon.log</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">rsyslogd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2013</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">8w</span></p></td><td style="vertical-align:top;">
<p><span class="font19">REG</span></p></td><td style="vertical-align:top;">
<p><span class="font19">254,0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">101768</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1308186</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/var/log/auth.log</span></p></td></tr>
</table>
<p><span class="font25">You can specify a specific user with </span><span class="font25" style="font-weight:bold;">lsof -u</span><span class="font25">. This example shows the current working directory for a couple of command line programs.</span></p>
<table border="1">
<tr><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">[paul@RHEL65</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~]$</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">lsof -u</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">| grep</span></p></td><td colspan="3" style="vertical-align:bottom;">
<p><span class="font19">home</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">bash</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3302</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cwd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">DIR</span></p></td><td style="vertical-align:top;">
<p><span class="font19">253,0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:top;">
<p><span class="font19">788024</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/home/paul</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">lsof</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3329</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cwd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">DIR</span></p></td><td style="vertical-align:top;">
<p><span class="font19">253,0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:top;">
<p><span class="font19">788024</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/home/paul</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">grep</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3330</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cwd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">DIR</span></p></td><td style="vertical-align:top;">
<p><span class="font19">253,0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:top;">
<p><span class="font19">788024</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/home/paul</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">lsof</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3331</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cwd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">DIR</span></p></td><td style="vertical-align:top;">
<p><span class="font19">253,0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:top;">
<p><span class="font19">788024</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/home/paul</span></p></td></tr>
</table>
<p><span class="font25">The -u switch of </span><span class="font25" style="font-weight:bold;">lsof </span><span class="font25">also supports the </span><span class="font4"><sup>A</sup> </span><span class="font25">character meaning 'not'. To see all open files, but not those open by root:</span></p>
<p><span class="font19">lsof -u*roct</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3803"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3048"></a><a name="bookmark3804"></a>9.2. fuser</span></h2></li></ul>
<h4><a name="bookmark3805"></a><span class="font25"><a name="bookmark3806"></a><a name="bookmark3807"></a>The </span><span class="font25" style="font-weight:bold;">fuser </span><span class="font25">command will display the 'user' of a file system.</span></h4>
<h4><a name="bookmark3808"></a><span class="font25"><a name="bookmark3809"></a><a name="bookmark3810"></a>In this example we still have a vi process in background and we use </span><span class="font25" style="font-weight:bold;">fuser </span><span class="font25">to find the process id of the process using this file system.</span></h4>
<p><span class="font19">[root@RHEL65 ~]# jobs</span></p>
<p><span class="font19">[1]+ Stopped &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vi /srv/project33/busyfile.txt</span></p>
<p><span class="font19">[root@RHEL65 ~]# fuser -m /srv/project33/</span></p>
<p><span class="font19">/srv/project33/: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3243</span></p>
<h4><a name="bookmark3811"></a><span class="font25"><a name="bookmark3812"></a>Adding the </span><span class="font25" style="font-weight:bold;">-u </span><span class="font25">switch will also display the user name.</span></h4>
<p><span class="font19">[root@RHEL65 ~]# fuser -m -u /srv/project33/ /srv/project33/: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3243(root)</span></p>
<h4><a name="bookmark3813"></a><span class="font25"><a name="bookmark3814"></a>You can quickly kill all processes that are using a specific file (or directory) with the -k switch.</span></h4>
<p><span class="font19">[root@RHEL65 ~]# fuser -m -k -u /srv/project33/</span></p>
<p><span class="font19">/srv/project33/: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3243(root)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">[1] + Killed &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vi /srv/project33/busyfile.txt</span></p></li></ul>
<p><span class="font19">[root@RHEL65 ~]# fuser -m -u /srv/project33/</span></p>
<p><span class="font19">[root@RHEL65 ~]#</span></p>
<h4><a name="bookmark3815"></a><span class="font25"><a name="bookmark3816"></a>This example shows all processes that are using the current directory (bash and vi in this case).</span></h4>
<p><span class="font19">root@debian7:~/test42# vi file42</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">[1] + Stopped root@debian7:~/test42# fuser</span></p>
<div>
<p><span class="font19">vi file42</span></p>
</div><br clear="all">
<div>
<p><span class="font19">-v .</span></p>
<p><span class="font19">PID ACCESS COMMAND</span></p>
<p><span class="font19">2909 ..c.. bash</span></p>
<p><span class="font19">3113 ..c.. vi</span></p>
</div><br clear="all"></li></ul>
<p><span class="font19">USER</span></p>
<p><span class="font19">/root/test42: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root</span></p>
<p><span class="font19">root</span></p>
<h4><a name="bookmark3817"></a><span class="font25"><a name="bookmark3818"></a>This example shows that the </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">command actually accesses </span><span class="font25" style="font-weight:bold;">/usr/bin/vim.basic </span><span class="font25">as an </span><span class="font25" style="font-weight:bold;">executable </span><span class="font25">file.</span></h4>
<p><span class="font19">root@debian7:~/test42# fuser -v $(which vi)</span></p>
<p><span class="font19">USER &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PID ACCESS COMMAND</span></p>
<p><span class="font19">/usr/bin/vim.basic: root &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3113 ...e. vi</span></p>
<h4><a name="bookmark3819"></a><span class="font25"><a name="bookmark3820"></a>The last example shows how to find the process that is accessing a specific file.</span></h4>
<p><span class="font19">[root@RHEL65 ~]# vi /srv/project33/busyfile.txt</span></p>
<p><span class="font19">[1]+ Stopped &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vi /srv/project33/busyfile.txt</span></p>
<p><span class="font19">[root@RHEL65 ~]# fuser -v -m /srv/project33/busyfile.txt USER &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PID ACCESS COMMAND</span></p>
<p><span class="font19">/srv/project33/busyfile.txt: root &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;13938 F.... vi</span></p>
<p><span class="font19">[root@RHEL65 ~]# ps -fp 13938</span></p>
<p><span class="font19">UID &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PID PPID C STIME TTY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TIME CMD</span></p>
<p><span class="font19">root &nbsp;&nbsp;&nbsp;&nbsp;13938 3110 0 15:47 pts/0 &nbsp;&nbsp;&nbsp;00:00:00 vi /srv/project33/busyfile.txt</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3821"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3049"></a><a name="bookmark3822"></a>9.3. chroot</span></h2></li></ul>
<p><a name="bookmark3823"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">chroot </span><span class="font25">command creates a shell with an alternate root directory. It effectively hides anything outside of this directory.</span></p>
<p><span class="font25">In the example below we assume that our system refuses to start (maybe because there is a problem with </span><span class="font25" style="font-weight:bold;">/etc/fstab </span><span class="font25">or the mounting of the root file system).</span></p>
<p><span class="font25">We start a live system (booted from cd/dvd/usb) to troubleshoot our server. The live system will not use our main hard disk as root device</span></p>
<p><span class="font19">root@livecd:~# </span><span class="font19" style="font-weight:bold;">df -h | grep root</span></p>
<p><span class="font19">rootfs &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;186M &nbsp;&nbsp;11M 175M &nbsp;&nbsp;6% /</span></p>
<p><span class="font19">/dev/loop0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;807M 807M &nbsp;&nbsp;&nbsp;&nbsp;0 100% /lib/live/mount/rootfs/filesystem.squashfs</span></p>
<p><span class="font19">root@livecd:~# </span><span class="font19" style="font-weight:bold;">mount | grep root</span></p>
<p><span class="font19">/dev/loop0 on /lib/live/mount/rootfs/filesystem.squashfs type squashfs (ro)</span></p>
<p><span class="font25">We create some test file on the current rootfs.</span></p>
<p><span class="font19">root@livecd:~# </span><span class="font19" style="font-weight:bold;">touch /file42 </span><span class="font19">root@livecd:~# </span><span class="font19" style="font-weight:bold;">mkdir /dir42 </span><span class="font19">root@livecd:~# </span><span class="font19" style="font-weight:bold;">ls /</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">bin</span></p></td><td style="vertical-align:top;">
<p><span class="font19">dir42</span></p></td><td style="vertical-align:top;">
<p><span class="font19">home</span></p></td><td style="vertical-align:top;">
<p><span class="font19">lib64</span></p></td><td style="vertical-align:top;">
<p><span class="font19">opt</span></p></td><td style="vertical-align:top;">
<p><span class="font19">run</span></p></td><td style="vertical-align:top;">
<p><span class="font19">srv</span></p></td><td style="vertical-align:top;">
<p><span class="font19">usr</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">boot</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">etc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">initrd.img</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">media</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">proc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sbin</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sys</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">var</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">dev</span></p></td><td style="vertical-align:top;">
<p><span class="font19">file42</span></p></td><td style="vertical-align:top;">
<p><span class="font19">lib</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mnt</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">selinux</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tmp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">vmlinuz</span></p></td></tr>
</table>
<p><a name="bookmark3824"></a><span class="font25">First we mount the root file system from the disk (which is on </span><span class="font25" style="font-weight:bold;">lvm </span><span class="font25">so we use </span><span class="font25" style="font-weight:bold;">/dev/mapper </span><span class="font25">instead of </span><span class="font25" style="font-weight:bold;">/dev/sda5</span><span class="font25">).</span></p>
<p><span class="font19">root@livecd:~# </span><span class="font19" style="font-weight:bold;">mount /dev/miapper/packer--debian--7-root /mint</span></p>
<p><span class="font25">We are now ready to </span><span class="font25" style="font-weight:bold;">chroot </span><span class="font25">into the rootfs on disk.</span></p>
<p><span class="font19">root@livecd:~# </span><span class="font19" style="font-weight:bold;">cd /mint </span><span class="font19">root@livecd:/mnt# </span><span class="font19" style="font-weight:bold;">chroot /mint </span><span class="font19">root@livecd:/# </span><span class="font19" style="font-weight:bold;">ls /</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">bin</span></p></td><td style="vertical-align:top;">
<p><span class="font19">dev</span></p></td><td style="vertical-align:top;">
<p><span class="font19">initrd.img</span></p></td><td style="vertical-align:top;">
<p><span class="font19">lost+found</span></p></td><td style="vertical-align:top;">
<p><span class="font19">opt</span></p></td><td style="vertical-align:top;">
<p><span class="font19">run</span></p></td><td style="vertical-align:top;">
<p><span class="font19">srv</span></p></td><td style="vertical-align:top;">
<p><span class="font19">usr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">vmlinuz</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">boot</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">etc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">lib</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">media</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">proc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sbin</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sys</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">vagrant</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">data</span></p></td><td style="vertical-align:top;">
<p><span class="font19">home</span></p></td><td style="vertical-align:top;">
<p><span class="font19">lib64</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mnt</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">selinux</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tmp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">var</span></p></td><td style="vertical-align:top;"></td></tr>
</table>
<p><span class="font25">Our test files (file42 and dir42) are not visible because they are out of the </span><span class="font25" style="font-weight:bold;">chrooted </span><span class="font25">environment.</span></p>
<p><span class="font25">Note that the </span><span class="font25" style="font-weight:bold;">hostname </span><span class="font25">of the chrooted environment is identical to the existing hostname.</span></p>
<p><span class="font25">To exit the </span><span class="font25" style="font-weight:bold;">chrooted </span><span class="font25">file system:</span></p>
<p><span class="font19">root@livecd:/# </span><span class="font19" style="font-weight:bold;">exit </span><span class="font19">exit</span></p>
<p><span class="font19">root@livecd:~# </span><span class="font19" style="font-weight:bold;">ls /</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">bin</span></p></td><td style="vertical-align:top;">
<p><span class="font19">dir42</span></p></td><td style="vertical-align:top;">
<p><span class="font19">home</span></p></td><td style="vertical-align:top;">
<p><span class="font19">lib64</span></p></td><td style="vertical-align:top;">
<p><span class="font19">opt</span></p></td><td style="vertical-align:top;">
<p><span class="font19">run</span></p></td><td style="vertical-align:top;">
<p><span class="font19">srv</span></p></td><td style="vertical-align:top;">
<p><span class="font19">usr</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">boot</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">etc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">initrd.img</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">media</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">proc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sbin</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sys</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">var</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">dev</span></p></td><td style="vertical-align:top;">
<p><span class="font19">file42</span></p></td><td style="vertical-align:top;">
<p><span class="font19">lib</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mnt</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">selinux</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tmp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">vmlinuz</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3825"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3050"></a><a name="bookmark3826"></a>9.4. iostat</span></h2></li></ul>
<h4><a name="bookmark3827"></a><span class="font25" style="font-weight:bold;"><a name="bookmark3828"></a><a name="bookmark3829"></a>iostat </span><span class="font25">reports IO statitics every given period of time. It also includes a small cpu usage summary. This example shows </span><span class="font25" style="font-weight:bold;">iostat </span><span class="font25">running every ten seconds with </span><span class="font25" style="font-weight:bold;">/dev/sdc </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/dev/sde </span><span class="font25">showing a lot of write activity.</span></h4>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">[root@RHEL65 ~]#</span></p>
<p><span class="font19">Linux 2.6.32-431</span></p></td><td style="vertical-align:top;">
<p><span class="font19">iostat .el6.x86</span></p></td><td style="vertical-align:top;">
<p><span class="font19">10 3</span></p>
<p><span class="font19">_64 (RHEL65) 06/16/2014</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">_x86_64_</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">(1 CPU)</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">avg-cpu: %user</span></p>
<p><span class="font19">5.81</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">%nice 0.00</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">%system %iowait %steal</span></p>
<p><span class="font19">3.15 &nbsp;&nbsp;&nbsp;0.18 &nbsp;&nbsp;&nbsp;0.00</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">%idle 90.85</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Device:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tps</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Blk_read/s Blk_wrtn/s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Blk_read</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Blk_wrtn</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">sda</span></p></td><td style="vertical-align:top;">
<p><span class="font19">42.08</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1204.10 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1634.88</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1743708</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2367530</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sdb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1.20</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7.69 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;45.78</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">11134</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">66292</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sdc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.92</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5.30 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;45.82</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7672</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">66348</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sdd</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.91</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5.29 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;45.78</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7656</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">66292</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sde</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1.04</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6.28 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;91.49</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">9100</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">132496</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sdf</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.70</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3.40 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;91.46</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4918</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">132440</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sdg</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.69</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3.40 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;91.46</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4918</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">132440</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">dm-0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">191.68</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1045.78 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1362.30</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1514434</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1972808</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">dm-1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">49.26</span></p></td><td style="vertical-align:top;">
<p><span class="font19">150.54 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;243.55</span></p></td><td style="vertical-align:top;">
<p><span class="font19">218000</span></p></td><td style="vertical-align:top;">
<p><span class="font19">352696</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">avg-cpu: %user</span></p>
<p><span class="font19">56.11</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">%nice 0.00</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">%system %iowait %steal</span></p>
<p><span class="font19">16.83 &nbsp;&nbsp;&nbsp;0.10 &nbsp;&nbsp;&nbsp;0.00</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">%idle 26.95</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Device:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tps</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Blk_read/s Blk_wrtn/s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Blk_read</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Blk_wrtn</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">sda</span></p></td><td style="vertical-align:top;">
<p><span class="font19">257.01</span></p></td><td style="vertical-align:top;">
<p><span class="font19">10185.97 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;76.95</span></p></td><td style="vertical-align:top;">
<p><span class="font19">101656</span></p></td><td style="vertical-align:top;">
<p><span class="font19">768</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sdb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sdc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3.81</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1.60 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2953.11</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">16</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">29472</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sdd</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sde</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4.91</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1.60 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4813.63</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">16</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">48040</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sdf</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sdg</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">dm-0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">283.77</span></p></td><td style="vertical-align:top;">
<p><span class="font19">10185.97 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;76.95</span></p></td><td style="vertical-align:top;">
<p><span class="font19">101656</span></p></td><td style="vertical-align:top;">
<p><span class="font19">768</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">dm-1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">avg-cpu: %user</span></p>
<p><span class="font19">67.65</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">%nice 0.00</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">%system %iowait %steal</span></p>
<p><span class="font19">31.11 &nbsp;&nbsp;&nbsp;0.11 &nbsp;&nbsp;&nbsp;0.00</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">%idle 1.13</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Device:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tps</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Blk_read/s Blk_wrtn/s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Blk_read</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Blk_wrtn</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">sda</span></p></td><td style="vertical-align:top;">
<p><span class="font19">466.86</span></p></td><td style="vertical-align:top;">
<p><span class="font19">26961.09 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;178.28</span></p></td><td style="vertical-align:top;">
<p><span class="font19">238336</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1576</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sdb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sdc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">31.45</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.90 &nbsp;&nbsp;&nbsp;&nbsp;24997.29</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">8</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">220976</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sdd</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sde</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.34</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.43</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">48</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sdf</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sdg</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">dm-0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">503.62</span></p></td><td style="vertical-align:top;">
<p><span class="font19">26938.46 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;178.28</span></p></td><td style="vertical-align:top;">
<p><span class="font19">238136</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1576</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">dm-1</span></p>
<p><span class="font19">[root@RHEL65 ~]#</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2.83</span></p></td><td style="vertical-align:top;">
<p><span class="font19">22.62 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">200</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td></tr>
</table>
<h4><a name="bookmark3830"></a><span class="font25"><a name="bookmark3831"></a>Other options are to specify the disks you want to monitor (every 5 seconds here):</span></h4>
<p><span class="font19">iostat sdd sde sdf 5</span></p>
<h4><a name="bookmark3832"></a><span class="font25"><a name="bookmark3833"></a>Or to show statistics per partition:</span></h4>
<p><span class="font19">iostat -p sde -p sdf 5</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3834"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3051"></a><a name="bookmark3835"></a>9.5. iotop</span></h2></li></ul>
<h4><a name="bookmark3836"></a><span class="font25" style="font-weight:bold;"><a name="bookmark3837"></a><a name="bookmark3838"></a>iotop </span><span class="font25">works like the </span><span class="font25" style="font-weight:bold;">top </span><span class="font25">command but orders processes by input/output instead of by CPU.</span></h4>
<h4><a name="bookmark3839"></a><span class="font25"><a name="bookmark3840"></a>By default </span><span class="font25" style="font-weight:bold;">iotop </span><span class="font25">will show all processes. This example uses </span><span class="font25" style="font-weight:bold;">iotop -o </span><span class="font25">to only display processes with actual I/O.</span></h4>
<p><span class="font19">[root@RHEL65 ~]# iotop -o</span></p>
<p><span class="font19">Total DISK READ: 8.63 M/s | Total DISK WRITE: 0.00 B/s</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">TID</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">PRIO</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">&gt; USER</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">DISK :</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">READ</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">DISK WRITE</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SWAPIN</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IO&gt;</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">COMMAND</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">15000</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">be/4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2.43</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">M/s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 B/s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 %</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14.60 %</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tar cjf /srv/di.</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">25000</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">be/4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6.20</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">M/s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 B/s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 %</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6.15 %</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tar czf /srv/di.</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">24988</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">be/4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">B/s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7.21 M/s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 %</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 %</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">gzip</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">25003</span></p></td><td style="vertical-align:top;">
<p><span class="font19">be/4</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">B/s</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1591.19 K/s</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00 %</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00 %</span></p></td><td style="vertical-align:top;">
<p><span class="font19">gzip</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">25004</span></p></td><td style="vertical-align:top;">
<p><span class="font19">be/4</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">B/s</span></p></td><td style="vertical-align:top;">
<p><span class="font19">193.51 K/s</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00 %</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00 %</span></p></td><td style="vertical-align:top;">
<p><span class="font19">bzip2</span></p></td></tr>
</table>
<h4><a name="bookmark3841"></a><span class="font25"><a name="bookmark3842"></a>Use the </span><span class="font25" style="font-weight:bold;">-b </span><span class="font25">switch to create a log of </span><span class="font25" style="font-weight:bold;">iotop </span><span class="font25">output (instead of the default interactive view).</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[root@RHEL65 ~]#</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">iotop -bod :</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Total DISK READ:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12.82 M/s |</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Total DISK WRITE: 5.69 M/s</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">TID PRIO USER</span></p></td><td style="vertical-align:top;">
<p><span class="font19">. DISK READ</span></p></td><td style="vertical-align:top;">
<p><span class="font19">DISK WRITE SWAPIN &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IO &nbsp;&nbsp;&nbsp;COMMAND</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">25153 be/4 root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2.05 M/s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 B/s 0.00 % &nbsp;7.81 % tar cjf /srv/di...</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">25152 be/4 root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10.77 M/s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 B/s 0.00 % 2.94 % tar czf /srv/di...</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">25144 be/4 root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">408.54 B/s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 B/s 0.00 % &nbsp;0.05 % python /usr/sbi...</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">12516 be/3 root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 B/s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1491.33 K/s 0.00 % &nbsp;0.04 % [jbd2/sdc1-8]</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">12522 be/3 root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 B/s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">45.48 K/s 0.00 % &nbsp;0.01 % [jbd2/sde1-8]</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">25158 be/4 root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 B/s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 B/s 0.00 % &nbsp;0.00 % [flush-8:64]</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">25155 be/4 root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 B/s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">493.12 K/s 0.00 % &nbsp;0.00 % bzip2</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">25156 be/4 root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00 B/s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2.81 M/s 0.00 % &nbsp;0.00 % gzip</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">25159 be/4 root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00 B/s</span></p></td><td style="vertical-align:top;">
<p><span class="font19">528.63 K/s 0.00 % &nbsp;0.00 % [flush-8:32]</span></p></td></tr>
</table>
<h4><a name="bookmark3843"></a><span class="font25"><a name="bookmark3844"></a>This is an example of </span><span class="font25" style="font-weight:bold;">iotop </span><span class="font25">to track disk I/O every ten seconds for one user named </span><span class="font25" style="font-weight:bold;">vagrant </span><span class="font25">(and only one process of this user, but this can be omitted). The </span><span class="font25" style="font-weight:bold;">-a </span><span class="font25">switch accumulates I/ O over time.</span></h4>
<p><span class="font19">[root@RHEL65 ~]# iotop -q -a -u vagrant -b -p 5216 -d 10 -n 10</span></p>
<p><span class="font19">Total DISK READ: 0.00 B/s | Total DISK WRITE: 0.00 B/s</span></p>
<p><span class="font19">TID PRIO USER DISK READ DISK WRITE SWAPIN &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IO COMMAND</span></p>
<p><span class="font19">5216 be/4 vagrant &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.00 B &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.00 B &nbsp;0.00 % &nbsp;0.00 % gzip</span></p>
<p><span class="font19">Total DISK READ: 818.22 B/s | Total DISK WRITE: 20.78 M/s</span></p>
<p><span class="font19">5216 be/4 vagrant &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.00 B &nbsp;&nbsp;&nbsp;213.89 M &nbsp;0.00 % &nbsp;0.00 % gzip</span></p>
<p><span class="font19">Total DISK READ: 2045.95 B/s | Total DISK WRITE: 23.16 M/s</span></p>
<p><span class="font19">5216 be/4 vagrant &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.00 B &nbsp;&nbsp;&nbsp;430.70 M &nbsp;0.00 % &nbsp;0.00 % gzip</span></p>
<p><span class="font19">Total DISK READ: 1227.50 B/s | Total DISK WRITE: 22.37 M/s</span></p>
<p><span class="font19">5216 be/4 vagrant &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.00 B &nbsp;&nbsp;&nbsp;642.02 M &nbsp;0.00 % &nbsp;0.00 % gzip</span></p>
<p><span class="font19">Total DISK READ: 818.35 B/s | Total DISK WRITE: 16.44 M/s</span></p>
<p><span class="font19">5216 be/4 vagrant &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.00 B &nbsp;&nbsp;&nbsp;834.09 M &nbsp;0.00 % &nbsp;0.00 % gzip</span></p>
<p><span class="font19">Total DISK READ: 6.95 M/s | Total DISK WRITE: 8.74 M/s</span></p>
<p><span class="font19">5216 be/4 vagrant &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.00 B &nbsp;&nbsp;&nbsp;920.69 M &nbsp;0.00 % &nbsp;0.00 % gzip</span></p>
<p><span class="font19">Total DISK READ: 21.71 M/s | Total DISK WRITE: 11.99 M/s</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3845"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3052"></a><a name="bookmark3846"></a>9.6. vmstat</span></h2></li></ul>
<h4><a name="bookmark3847"></a><span class="font25"><a name="bookmark3848"></a><a name="bookmark3849"></a>While </span><span class="font25" style="font-weight:bold;">vmstat </span><span class="font25">is mainly a memory monitoring tool, it is worth mentioning here for its reporting on summary I/O data for block devices and swap space.</span></h4>
<h4><a name="bookmark3850"></a><span class="font25"><a name="bookmark3851"></a>This example shows some disk activity (underneath the -----</span><span class="font25" style="font-weight:bold;">io---- </span><span class="font25">column), without</span><br><br><span class="font25"><a name="bookmark3852"></a>swapping.</span></h4>
<p><span class="font19">[root@RHEL65 ~]# vmstat 5 10</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">procs ------</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">----memory---------- -</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">— swap--</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">-----io----</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">--system-- -----</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">■ cpu-----</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">r b swpd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">free buff cache</span></p></td><td style="vertical-align:top;">
<p><span class="font19">si so</span></p></td><td style="vertical-align:top;">
<p><span class="font19">bi &nbsp;&nbsp;&nbsp;bo</span></p></td><td style="vertical-align:top;">
<p><span class="font19">in cs us sy</span></p></td><td style="vertical-align:top;">
<p><span class="font19">id wa st</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">0 &nbsp;0 &nbsp;5420</span></p></td><td style="vertical-align:top;">
<p><span class="font19">9092 &nbsp;14020 340876</span></p></td><td style="vertical-align:top;">
<p><span class="font19">7 &nbsp;&nbsp;&nbsp;12</span></p></td><td style="vertical-align:top;">
<p><span class="font19">235 &nbsp;&nbsp;252</span></p></td><td style="vertical-align:top;">
<p><span class="font19">77 &nbsp;100 &nbsp;2 &nbsp;1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">98 &nbsp;&nbsp;0 &nbsp;0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">2 &nbsp;0 &nbsp;5420</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6104 &nbsp;13840 338176</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7401 &nbsp;7812</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">747 1887 38 12</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">50 &nbsp;&nbsp;0 &nbsp;0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">2 &nbsp;0 &nbsp;5420</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10136 &nbsp;13696 336012</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">11334 &nbsp;&nbsp;&nbsp;14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1725 4036 76 24</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0 &nbsp;&nbsp;0 &nbsp;&nbsp;0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0 &nbsp;0 &nbsp;5420</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14160 &nbsp;13404 341552</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10161 &nbsp;9914</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1174 1924 67 15</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">18 &nbsp;&nbsp;0 &nbsp;0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0 &nbsp;0 &nbsp;5420</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14300 &nbsp;13420 341564</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;16</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">28 &nbsp;&nbsp;&nbsp;18 &nbsp;&nbsp;0 &nbsp;&nbsp;0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">100 &nbsp;0 &nbsp;0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">0 &nbsp;0 &nbsp;5420</span></p></td><td style="vertical-align:top;">
<p><span class="font19">14300 &nbsp;13420 341564</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">22 &nbsp;&nbsp;&nbsp;16 &nbsp;&nbsp;0 &nbsp;&nbsp;0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">100 &nbsp;0 &nbsp;0</span></p></td></tr>
</table>
<p><span class="font19">[root@RHEL65 ~]#</span></p>
<h4><a name="bookmark3853"></a><span class="font25"><a name="bookmark3854"></a>You can benefit from </span><span class="font25" style="font-weight:bold;">vmstat</span><span class="font25">'s ability to display memory in kilobytes, megabytes or even kibibytes and mebibytes using -S (followed by k K m or M).</span></h4>
<table border="1">
<tr><td colspan="3" style="vertical-align:top;">
<p><span class="font19">[root@RHEL65</span></p></td><td colspan="2" style="vertical-align:top;">
<p><span class="font19">~]# vmstat -SM</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5 10</span></p></td><td rowspan="3" style="vertical-align:bottom;">
<p><span class="font19">— swap si</span></p></td><td rowspan="3" style="vertical-align:bottom;">
<p><span class="font19">_ _</span></p>
<p><span class="font19">so</span></p></td><td colspan="2" rowspan="2" style="vertical-align:bottom;">
<p><span class="font19">-----io----</span></p></td><td colspan="4" rowspan="2" style="vertical-align:bottom;">
<p><span class="font19">--system-- -----</span></p></td><td colspan="2" rowspan="3" style="vertical-align:bottom;">
<p><span class="font19">■ cpu---</span></p>
<p><span class="font19">id wa</span></p></td><td rowspan="3" style="vertical-align:bottom;">
<p><span class="font19">st</span></p></td></tr>
<tr><td colspan="2" style="vertical-align:top;"></td><td rowspan="2" style="vertical-align:bottom;">
<p><span class="font19">swpd</span></p></td><td colspan="2" style="vertical-align:top;">
<p><span class="font19">memory</span></p></td><td rowspan="2" style="vertical-align:top;">
<p><span class="font19">------</span></p>
<p><span class="font19">cache</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">r</span></p></td><td style="vertical-align:top;">
<p><span class="font19">b</span></p></td><td style="vertical-align:top;">
<p><span class="font19">free</span></p></td><td style="vertical-align:top;">
<p><span class="font19">buff</span></p></td><td style="vertical-align:top;">
<p><span class="font19">bi</span></p></td><td style="vertical-align:top;">
<p><span class="font19">bo</span></p></td><td style="vertical-align:top;">
<p><span class="font19">in</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cs</span></p></td><td style="vertical-align:top;">
<p><span class="font19">us</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sy</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">14</span></p></td><td style="vertical-align:top;">
<p><span class="font19">11</span></p></td><td style="vertical-align:top;">
<p><span class="font19">334</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">259</span></p></td><td style="vertical-align:top;">
<p><span class="font19">255</span></p></td><td style="vertical-align:top;">
<p><span class="font19">79</span></p></td><td style="vertical-align:top;">
<p><span class="font19">107</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">97</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">11</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">334</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">21</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">18</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">100</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">11</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">334</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">35</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">31</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">100</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">11</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">336</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">17100</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7814</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1378</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2945</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">48</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">21</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">31</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">11</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">336</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">13193</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1662</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3343</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">78</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">22</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">13</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">11</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">330</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">11656</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">9781</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1419</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2642</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">82</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">18</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">9</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">11</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">334</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10705</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2716</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1504</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2657</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">81</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">19</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">11</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">336</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6467</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3788</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">765</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1384</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">43</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">9</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">48</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">11</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">336</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">13</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">28</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">24</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">100</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td colspan="3" style="vertical-align:top;">
<p><span class="font19">0 &nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5</span></p>
<p><span class="font19">[root@RHEL65</span></p></td><td style="vertical-align:top;">
<p><span class="font19">14</span></p>
<p><span class="font19">~]#</span></p></td><td style="vertical-align:top;">
<p><span class="font19">11</span></p></td><td style="vertical-align:top;">
<p><span class="font19">336</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">20</span></p></td><td style="vertical-align:top;">
<p><span class="font19">15</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">100</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td></tr>
</table>
<h4><a name="bookmark3855"></a><span class="font25" style="font-weight:bold;"><a name="bookmark3856"></a>vmstat </span><span class="font25">is also discussed in other chapters.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3857"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3053"></a><a name="bookmark3858"></a>9.7. practice: troubleshooting tools</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">0. It is imperative that you practice these tools </span><span class="font25" style="font-weight:bold;">before </span><span class="font25">trouble arises. It will help you get familiar with the tools and allow you to create a base line of normal behaviour for your systems.</span></p></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Read the theory on </span><span class="font25" style="font-weight:bold;">fuser </span><span class="font25">and explore its man page. Use this command to find files that you open yourself.</span></p></li>
<li>
<p><span class="font25">2. Read the theory on </span><span class="font25" style="font-weight:bold;">lsof </span><span class="font25">and explore its man page. Use this command to find files that you open yourself.</span></p></li>
<li>
<p><span class="font25">3. Boot a live image on an existing computer (virtual or real) and </span><span class="font25" style="font-weight:bold;">chroot </span><span class="font25">into to it.</span></p></li>
<li>
<p><span class="font25">4. Start one or more disk intensive jobs and monitor them with </span><span class="font25" style="font-weight:bold;">iostat </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">iotop </span><span class="font25">(compare to </span><span class="font25" style="font-weight:bold;">vmstat</span><span class="font25">).</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3859"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3054"></a><a name="bookmark3860"></a>9.8. solution: troubleshooting tools</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">0. It is imperative that you practice these tools </span><span class="font25" style="font-weight:bold;">before </span><span class="font25">trouble arises. It will help you get familiar with the tools and allow you to create a base line of normal behaviour for your systems.</span></p></li>
<li>
<p><span class="font25">1. Read the theory on </span><span class="font25" style="font-weight:bold;">fuser </span><span class="font25">and explore its man page. Use this command to find files that you open yourself.</span></p></li>
<li>
<p><span class="font25">2. Read the theory on </span><span class="font25" style="font-weight:bold;">lsof </span><span class="font25">and explore its man page. Use this command to find files that you open yourself.</span></p></li>
<li>
<p><span class="font25">3. Boot a live image on an existing computer (virtual or real) and </span><span class="font25" style="font-weight:bold;">chroot </span><span class="font25">into to it.</span></p></li>
<li>
<p><span class="font25">4. Start one or more disk intensive jobs and monitor them with </span><span class="font25" style="font-weight:bold;">iostat </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">iotop </span><span class="font25">(compare to </span><span class="font25" style="font-weight:bold;">vmstat</span><span class="font25">).</span></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark3861"></a><span class="font11" style="font-weight:bold;"><a name="bookmark3055"></a><a name="bookmark3862"></a>Chapter 10. introduction to uuid's</span></h1></li></ul>
<p><a name="bookmark3863"></a><span class="font25"><a name="bookmark3864"></a>A </span><span class="font25" style="font-weight:bold;">uuid </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">universally unique identifier </span><span class="font25">is used to uniquely identify objects. This 128bit standard allows anyone to create a unique </span><span class="font25" style="font-weight:bold;">uuid</span><span class="font25">.</span></p>
<p><span class="font25">This chapter takes a brief look at </span><span class="font25" style="font-weight:bold;">uuid's</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3865"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3056"></a><a name="bookmark3866"></a>10.1. about unique objects</span></h2></li></ul>
<p><a name="bookmark3867"></a><span class="font25">Older versions of Linux have a </span><span class="font25" style="font-weight:bold;">vol_id </span><span class="font25">utility to display the </span><span class="font25" style="font-weight:bold;">uuid </span><span class="font25">of a file system.</span></p>
<p><span class="font19">root@debian5:~# vol_id --uuid /dev/sdal</span></p>
<p><span class="font19">193c3c9b-2c40-9290-8b71-4264ee4d4c82</span></p>
<p><span class="font25">Red Hat Enterprise Linux 5 puts </span><span class="font25" style="font-weight:bold;">vol_id </span><span class="font25">in </span><span class="font25" style="font-weight:bold;">/lib/udev/vol_id</span><span class="font25">, which is not in the $PATH. The syntax is also a bit different from Debian/Ubuntu/Mint.</span></p>
<p><span class="font19">root@rhel53 ~# /lib/udev/vol_id -u /dev/hdal</span></p>
<p><span class="font19">48a6a316-9ca9-4214-b5c6-e7b33a77e860</span></p>
<p><span class="font25">This utility is not available in standard installations of RHEL6 or Debian6.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3868"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3057"></a><a name="bookmark3869"></a>10.2. tune2fs</span></h2></li></ul>
<p><a name="bookmark3870"></a><span class="font25">Use </span><span class="font25" style="font-weight:bold;">tune2fs </span><span class="font25">to find the </span><span class="font25" style="font-weight:bold;">uuid </span><span class="font25">of a file system.</span></p>
<p><span class="font19">[root@RHEL5 ~]# tune2fs -l /dev/sdal | grep UUID</span></p>
<p><span class="font19">Filesystem UUID: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11cfc8bc-07c0-4c3f-9f64-78422ef1dd5c</span></p>
<p><span class="font19">[root@RHEL5 ~]# /lib/udev/vol_id -u /dev/sda1</span></p>
<p><span class="font19">11cfc8bc-07c0-4c3f-9f64-78422ef1dd5c</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3871"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3058"></a><a name="bookmark3872"></a>10.3. uuid</span></h2></li></ul>
<p><span class="font25">There is more information in the manual of </span><span class="font25" style="font-weight:bold;">uuid</span><span class="font25">, a tool that can generate uuid's.</span></p>
<p><span class="font19">[root@rhel65 ~]# yum install uuid</span></p>
<p><span class="font19">(output truncated)</span></p>
<p><span class="font19">[root@rhel65 ~]# man uuid</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3873"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3059"></a><a name="bookmark3874"></a>10.4. uuid in /etc/fstab</span></h2></li></ul>
<p><span class="font25">You can use the </span><span class="font25" style="font-weight:bold;">uuid </span><span class="font25">to make sure that a volume is universally uniquely identified in </span><span class="font25" style="font-weight:bold;">/etc/ fstab</span><span class="font25">. The device name can change depending on the disk devices that are present at boot time, but a </span><span class="font25" style="font-weight:bold;">uuid </span><span class="font25">never changes.</span></p>
<p><span class="font25">First we use </span><span class="font25" style="font-weight:bold;">tune2fs </span><span class="font25">to find the </span><span class="font25" style="font-weight:bold;">uuid</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL5 ~]# tune2fs -l /dev/sdcl | grep UUID</span></p>
<p><span class="font19">Filesystem UUID: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7626d73a-2bb6-4937-90ca-e451025d64e8</span></p>
<p><a name="bookmark3875"></a><span class="font25">Then we check that it is properly added to </span><span class="font25" style="font-weight:bold;">/etc/fstab</span><span class="font25">, the </span><span class="font25" style="font-weight:bold;">uuid </span><span class="font25">replaces the variable devicename /dev/sdc1.</span></p>
<p><span class="font19">[root@RHEL5 ~]# grep UUID /etc/fstab</span></p>
<p><span class="font19">UUID=7626d73a-2bb6-4937-90ca-e451025d64e8 /home/pro42 ext3 defaults 0 0</span></p>
<p><span class="font25">Now we can mount the volume using the mount point defined in </span><span class="font25" style="font-weight:bold;">/etc/fstab</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL5 ~]# mount /home/pro42</span></p>
<p><span class="font19">[root@RHEL5 ~]# df -h | grep 42</span></p>
<p><span class="font19">/dev/sdc1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;397M &nbsp;&nbsp;11M &nbsp;366M &nbsp;&nbsp;3% /home/pro42</span></p>
<p><a name="bookmark3876"></a><span class="font25">The real test now, is to remove </span><span class="font25" style="font-weight:bold;">/dev/sdb </span><span class="font25">from the system, reboot the machine and see what happens. After the reboot, the disk previously known as </span><span class="font25" style="font-weight:bold;">/dev/sdc </span><span class="font25">is now </span><span class="font25" style="font-weight:bold;">/dev/sdb</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL5 ~]# tune2fs -l /dev/sdb1 | grep UUID</span></p>
<p><span class="font19">Filesystem UUID: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7626d73a-2bb6-4937-90ca-e451025d64e8</span></p>
<p><span class="font25">And thanks to the </span><span class="font25" style="font-weight:bold;">uuid </span><span class="font25">in </span><span class="font25" style="font-weight:bold;">/etc/fstab</span><span class="font25">, the mountpoint is mounted on the same disk as before.</span></p>
<p><span class="font19">[root@RHEL5 ~]# df -h | grep sdb</span></p>
<p><span class="font19">/dev/sdb1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;397M &nbsp;&nbsp;11M &nbsp;366M &nbsp;&nbsp;3% /home/pro42</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3877"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3060"></a><a name="bookmark3878"></a>10.5. uuid as a boot device</span></h2></li></ul>
<p><span class="font25">Recent Linux distributions (Debian, Ubuntu, ...) use </span><span class="font25" style="font-weight:bold;">grub </span><span class="font25">with a </span><span class="font25" style="font-weight:bold;">uuid </span><span class="font25">to identify the root file system.</span></p>
<p><span class="font25">This example shows how a </span><span class="font25" style="font-weight:bold;">root=/dev/sda1 </span><span class="font25">is replaced with a </span><span class="font25" style="font-weight:bold;">uuid</span><span class="font25">.</span></p>
<p><span class="font19">title &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ubuntu 9.10, kernel 2.6.31-19-generic</span></p>
<p><span class="font19">uuid &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f001ba5d-9077-422a-9634-8d23d57e782a</span></p>
<p><span class="font19">kernel &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/boot/vmlinuz-2.6.31-19-generic \</span></p>
<p><span class="font19">root=UUID=f001ba5d-9077-422a-9634-8d23d57e782a ro quiet splash</span></p>
<p><span class="font19">initrd &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/boot/initrd.img-2.6.31-19-generic</span></p>
<p><span class="font25">The screenshot above contains only four lines. The line starting with </span><span class="font25" style="font-weight:bold;">root= </span><span class="font25">is the continuation of the </span><span class="font25" style="font-weight:bold;">kernel </span><span class="font25">line.</span></p>
<p><span class="font25">RHEL and CentOS boot from LVM after a default install.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3879"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3061"></a><a name="bookmark3880"></a>10.6. practice: uuid and filesystems</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Find the </span><span class="font25" style="font-weight:bold;">uuid </span><span class="font25">of one of your </span><span class="font25" style="font-weight:bold;">ext3 </span><span class="font25">partitions with </span><span class="font25" style="font-weight:bold;">tune2fs </span><span class="font25">( and </span><span class="font25" style="font-weight:bold;">vol_id </span><span class="font25">if you are on RHEL5).</span></p></li>
<li>
<p><span class="font25">2. Use this </span><span class="font25" style="font-weight:bold;">uuid </span><span class="font25">in </span><span class="font25" style="font-weight:bold;">/etc/fstab </span><span class="font25">and test that it works with a simple </span><span class="font25" style="font-weight:bold;">mount</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">3. (optional) Test it also by removing a disk (so the device name is changed). You can edit settings in vmware/Virtualbox to remove a hard disk.</span></p></li>
<li>
<p><span class="font25">4. Display the </span><span class="font25" style="font-weight:bold;">root= </span><span class="font25">directive in </span><span class="font25" style="font-weight:bold;">/boot/grub/menu.lst</span><span class="font25">. (We see later in the course how to maintain this file.)</span></p></li>
<li>
<p><span class="font25">5. (optional on ubuntu) Replace the </span><span class="font25" style="font-weight:bold;">/dev/xxx </span><span class="font25">in </span><span class="font25" style="font-weight:bold;">/boot/grub/menu.lst </span><span class="font25">with a </span><span class="font25" style="font-weight:bold;">uuid </span><span class="font25">(use an extra stanza for this). Test that it works.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3881"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3062"></a><a name="bookmark3882"></a>10.7. solution: uuid and filesystems</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Find the </span><span class="font25" style="font-weight:bold;">uuid </span><span class="font25">of one of your </span><span class="font25" style="font-weight:bold;">ext3 </span><span class="font25">partitions with </span><span class="font25" style="font-weight:bold;">tune2fs </span><span class="font25">( and </span><span class="font25" style="font-weight:bold;">vol_id </span><span class="font25">if you are on RHEL5).</span></p></li></ul>
<p><span class="font19">root@rhel55:~# /lib/udev/vol_id -u /dev/hdal</span></p>
<p><span class="font19">60926898-2c78-49b4-a71d-c1d6310c87cc</span></p>
<p><span class="font19">root@ubu1004:~# tune2fs -l /dev/sda2 | grep UUID</span></p>
<p><span class="font19">Filesystem UUID: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3007b743-1dce-2d62-9a59-cf25f85191b7</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Use this </span><span class="font25" style="font-weight:bold;">uuid </span><span class="font25">in </span><span class="font25" style="font-weight:bold;">/etc/fstab </span><span class="font25">and test that it works with a simple </span><span class="font25" style="font-weight:bold;">mount</span><span class="font25">.</span></p></li></ul>
<p><span class="font19">tail -1 /etc/fstab</span></p>
<p><span class="font19">UUID=60926898-2c78-49b4-a71d-c1d6310c87cc /home/pro42 ext3 defaults 0 0</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. (optional) Test it also by removing a disk (so the device name is changed). You can edit settings in vmware/Virtualbox to remove a hard disk.</span></p></li>
<li>
<p><span class="font25">4. Display the </span><span class="font25" style="font-weight:bold;">root= </span><span class="font25">directive in </span><span class="font25" style="font-weight:bold;">/boot/grub/menu.lst</span><span class="font25">. (We see later in the course how to maintain this file.)</span></p></li></ul>
<p><span class="font19">paul@deb503:~$ grep *[*#] /boot/grub/menu.lst | grep root=</span></p>
<p><span class="font19">kernel &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/boot/vmlinuz-2.6.26-2-686 root=/dev/hda1 ro selinux=1 quiet</span></p>
<p><span class="font19">kernel &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/boot/vmlinuz-2.6.26-2-686 root=/dev/hda1 ro selinux=1 single</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. (optional on ubuntu) Replace the </span><span class="font25" style="font-weight:bold;">/dev/xxx </span><span class="font25">in </span><span class="font25" style="font-weight:bold;">/boot/grub/menu.lst </span><span class="font25">with a </span><span class="font25" style="font-weight:bold;">uuid </span><span class="font25">(use an extra stanza for this). Test that it works.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark3883"></a><span class="font11" style="font-weight:bold;"><a name="bookmark3884"></a><a name="bookmark3063"></a><a name="bookmark3885"></a>Chapter 11. introduction to raid</span></h1></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3064"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3886"></a>11.1. hardware or software</span></h2></li></ul>
<p><a name="bookmark3887"></a><span class="font25">Redundant Array of Independent (originally Inexpensive) Disks or </span><span class="font25" style="font-weight:bold;">RAID </span><span class="font25">can be set up using hardware or software. Hardware RAID is more expensive, but offers better performance. Software RAID is cheaper and easier to manage, but it uses your CPU and your memory.</span></p>
<p><span class="font25">Where ten years ago nobody was arguing about the best choice being hardware RAID, this has changed since technologies like mdadm, lvm and even zfs focus more on managability. The workload on the cpu for software RAID used to be high, but cpu's have gotten a lot faster.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3888"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3065"></a><a name="bookmark3889"></a>11.2. raid levels</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark3890"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3891"></a>11.2.1. raid 0</span></h3></li></ul></li></ul>
<p><a name="bookmark3892"></a><span class="font25" style="font-weight:bold;">raid 0 </span><span class="font25">uses two or more disks, and is often called </span><span class="font25" style="font-weight:bold;">striping </span><span class="font25">(or stripe set, or striped volume). Data is divided in </span><span class="font25" style="font-weight:bold;">chunks</span><span class="font25">, those chunks are evenly spread across every disk in the array. The main advantage of </span><span class="font25" style="font-weight:bold;">raid 0 </span><span class="font25">is that you can create </span><span class="font25" style="font-weight:bold;">larger drives</span><span class="font25">. </span><span class="font25" style="font-weight:bold;">raid 0 </span><span class="font25">is the only </span><span class="font25" style="font-weight:bold;">raid </span><span class="font25">without redundancy.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3893"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3894"></a>11.2.2. jbod</span></h3></li></ul>
<p><a name="bookmark3895"></a><span class="font25" style="font-weight:bold;">jbod </span><span class="font25">uses two or more disks, and is often called </span><span class="font25" style="font-weight:bold;">concatenating </span><span class="font25">(spanning, spanned set, or spanned volume). Data is written to the first disk, until it is full. Then data is written to the second disk... The main advantage of </span><span class="font25" style="font-weight:bold;">jbod </span><span class="font25">(Just a Bunch of Disks) is that you can create </span><span class="font25" style="font-weight:bold;">larger drives</span><span class="font25">. JBOD offers no redundancy.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3896"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3897"></a>11.2.3. raid 1</span></h3></li></ul>
<p><a name="bookmark3898"></a><span class="font25" style="font-weight:bold;"><a name="bookmark3899"></a>raid 1 </span><span class="font25">uses exactly two disks, and is often called </span><span class="font25" style="font-weight:bold;">mirroring </span><span class="font25">(or mirror set, or mirrored volume). All data written to the array is written on each disk. The main advantage of raid 1 is </span><span class="font25" style="font-weight:bold;">redundancy</span><span class="font25">. The main disadvantage is that you lose at least half of your available disk space (in other words, you at least double the cost).</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3900"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3901"></a>11.2.4. raid 2, 3 and 4 ?</span></h3></li></ul>
<p><span class="font25" style="font-weight:bold;">raid 2 </span><span class="font25">uses bit level striping, </span><span class="font25" style="font-weight:bold;">raid 3 </span><span class="font25">byte level, and </span><span class="font25" style="font-weight:bold;">raid 4 </span><span class="font25">is the same as </span><span class="font25" style="font-weight:bold;">raid 5</span><span class="font25">, but with a dedicated parity disk. This is actually slower than </span><span class="font25" style="font-weight:bold;">raid 5</span><span class="font25">, because every write would have to write parity to this one (bottleneck) disk. It is unlikely that you will ever see these </span><span class="font25" style="font-weight:bold;">raid </span><span class="font25">levels in production.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3902"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3903"></a>11.2.5. raid 5</span></h3></li></ul>
<p><a name="bookmark3904"></a><span class="font25" style="font-weight:bold;">raid 5 </span><span class="font25">uses </span><span class="font25" style="font-weight:bold;">three </span><span class="font25">or more disks, each divided into chunks. Every time chunks are written to the array, one of the disks will receive a </span><span class="font25" style="font-weight:bold;">parity </span><span class="font25">chunk. Unlike </span><span class="font25" style="font-weight:bold;">raid 4</span><span class="font25">, the parity chunk will alternate between all disks. The main advantage of this is that </span><span class="font25" style="font-weight:bold;">raid 5 </span><span class="font25">will allow for full data recovery in case of </span><span class="font25" style="font-weight:bold;">one </span><span class="font25">hard disk failure.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3905"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3906"></a>11.2.6. raid 6</span></h3></li></ul>
<p><span class="font25" style="font-weight:bold;">raid 6 </span><span class="font25">is very similar to </span><span class="font25" style="font-weight:bold;">raid 5</span><span class="font25">, but uses two parity chunks. </span><span class="font25" style="font-weight:bold;">raid 6 </span><span class="font25">protects against two hard disk failures. Oracle Solaris </span><span class="font25" style="font-weight:bold;">zfs </span><span class="font25">calls this </span><span class="font25" style="font-weight:bold;">raidz2 </span><span class="font25">(and also had </span><span class="font25" style="font-weight:bold;">raidz3 </span><span class="font25">with triple parity).</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3907"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3908"></a>11.2.7. raid 0+1</span></h3></li></ul>
<p><span class="font25" style="font-weight:bold;">raid 0+1 </span><span class="font25">is a mirror(1) of stripes(0). This means you first create two </span><span class="font25" style="font-weight:bold;">raid 0 stripe </span><span class="font25">sets, and then you set them up as a mirror set. For example, when you have six 100GB disks, then the stripe sets are each 300GB. Combined in a mirror, this makes 300GB total. </span><span class="font25" style="font-weight:bold;">raid 0+1 </span><span class="font25">will survive one disk failure. It will only survive the second disk failure if this disk is in the same stripe set as the previous failed disk.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3909"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3910"></a>11.2.8. raid 1+0</span></h3></li></ul>
<p><span class="font25" style="font-weight:bold;">raid 1+0 </span><span class="font25">is a stripe(0) of mirrors(1). For example, when you have six 100GB disks, then you first create three mirrors of 100GB each. You then stripe them together into a 300GB drive. In this example, as long as not all disks in the same mirror fail, it can survive up to three hard disk failures.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3911"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3912"></a>11.2.9. raid 50</span></h3></li></ul>
<p><span class="font25" style="font-weight:bold;">raid 5+0 </span><span class="font25">is a stripe(0) of </span><span class="font25" style="font-weight:bold;">raid 5 </span><span class="font25">arrays. Suppose you have nine disks of 100GB, then you can create three </span><span class="font25" style="font-weight:bold;">raid 5 </span><span class="font25">arrays of 200GB each. You can then combine them into one large stripe set.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3913"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3914"></a>11.2.10. many others</span></h3></li></ul>
<p><span class="font25">There are many other nested </span><span class="font25" style="font-weight:bold;">raid </span><span class="font25">combinations, like </span><span class="font25" style="font-weight:bold;">raid </span><span class="font25">30, 51, 60, 100, 150, ...</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3915"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3066"></a><a name="bookmark3916"></a>11.3. building a software raid5 array</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark3917"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3918"></a>11.3.1. do we have three disks?</span></h3></li></ul></li></ul>
<p><a name="bookmark3919"></a><span class="font25">First, you have to attach some disks to your computer. In this scenario, three brand new disks of eight gigabyte each are added. Check with </span><span class="font25" style="font-weight:bold;">fdisk -l </span><span class="font25">that they are connected.</span></p>
<p><span class="font19">[root@rhel6c ~]# fdisk -l 2&gt; /dev/null | grep MB</span></p>
<p><span class="font19">Disk /dev/sdb: 8589 MB, 8589934592 bytes</span></p>
<p><span class="font19">Disk /dev/sdc: 8589 MB, 8589934592 bytes</span></p>
<p><span class="font19">Disk /dev/sdd: 8589 MB, 8589934592 bytes</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3920"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3921"></a>11.3.2. fd partition type</span></h3></li></ul>
<p><a name="bookmark3922"></a><span class="font25">The next step is to create a partition of type </span><span class="font25" style="font-weight:bold;">fd </span><span class="font25">on every disk. The </span><span class="font25" style="font-weight:bold;">fd </span><span class="font25">type is to set the partition as </span><span class="font25" style="font-weight:bold;">Linux RAID autodetect</span><span class="font25">. See this (truncated) screenshot: </span><span class="font19">[root@rhel6c ~]# fdisk /dev/sdd ...</span></p>
<p><span class="font19">Command (m for help): n</span></p>
<p><span class="font19">Command action e extended p primary partition (1-4)</span></p>
<p><span class="font19">P</span></p>
<p><span class="font19">Partition number (1-4): 1</span></p>
<p><span class="font19">First cylinder (1-1044, default 1):</span></p>
<p><span class="font19">Using default value 1</span></p>
<p><span class="font19">Last cylinder, +cylinders or +size{K,M,G} (1-1044, default 1044):</span></p>
<p><span class="font19">Using default value 1044</span></p>
<p><span class="font19">Command (m for help): t</span></p>
<p><span class="font19">Selected partition 1</span></p>
<p><span class="font19">Hex code (type L to list codes): fd</span></p>
<p><span class="font19">Changed system type of partition 1 to fd (Linux raid autodetect)</span></p>
<p><span class="font19">Command (m for help): w</span></p>
<p><span class="font19">The partition table has been altered!</span></p>
<p><span class="font19">Calling ioctl() to re-read partition table.</span></p>
<p><span class="font19">Syncing disks.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3923"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3924"></a>11.3.3. verify all three partitions</span></h3></li></ul>
<p><span class="font25">Now all three disks are ready for </span><span class="font25" style="font-weight:bold;">raid 5</span><span class="font25">, so we have to tell the system what to do with these disks.</span></p>
<p><span class="font19">[root@rhel6c ~]# fdisk -l 2&gt; /dev/null | grep raid</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdb1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1044</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">8385898+</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">fd</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Linux</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">raid</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">autodetect</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdc1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1044</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">8385898+</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">fd</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Linux</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">raid</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">autodetect</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/sdd1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1044</span></p></td><td style="vertical-align:top;">
<p><span class="font19">8385898+</span></p></td><td style="vertical-align:top;">
<p><span class="font19">fd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Linux</span></p></td><td style="vertical-align:top;">
<p><span class="font19">raid</span></p></td><td style="vertical-align:top;">
<p><span class="font19">autodetect</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3925"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3926"></a>11.3.4. create the raid5</span></h3></li></ul>
<h4><a name="bookmark3927"></a><span class="font25"><a name="bookmark3928"></a><a name="bookmark3929"></a><a name="bookmark3930"></a>The next step used to be </span><span class="font25" style="font-style:italic;">create the </span><span class="font25" style="font-weight:bold;font-style:italic;">raid table </span><span class="font25" style="font-style:italic;">in </span><span class="font25" style="font-weight:bold;font-style:italic;">/etc/raidtab</span><span class="font25">. Nowadays, you can just issue the command </span><span class="font25" style="font-weight:bold;">mdadm </span><span class="font25">with the correct parameters.</span></h4>
<h4><a name="bookmark3931"></a><span class="font25"><a name="bookmark3932"></a>The command below is split on two lines to fit this print, but you should type it on one line, without the backslash (\).</span></h4>
<p><span class="font19">[root@rhel6c ~]# mdadm --create /dev/md0 --chunk=64 --level=5 --raid-\ devices=3 /dev/sdbl /dev/sdcl /dev/sddl mdadm: Defaulting to version 1.2 metadata mdadm: array /dev/md0 started.</span></p>
<h4><a name="bookmark3933"></a><span class="font25"><a name="bookmark3934"></a>Below a partial screenshot how fdisk -l sees the </span><span class="font25" style="font-weight:bold;">raid 5</span><span class="font25">.</span></h4>
<p><span class="font19">[root@rhel6c ~]# fdisk -l /dev/md0</span></p>
<p><span class="font19">Disk /dev/md0: 17.2 GB, 17172135936 bytes 2 heads, 4 sectors/track, 4192416 cylinders Units = cylinders of 8 * 512 = 4096 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 65536 bytes / 131072 bytes Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/md0 doesn't contain a valid partition table</span></p>
<h4><a name="bookmark3935"></a><span class="font25"><a name="bookmark3936"></a>We could use this software </span><span class="font25" style="font-weight:bold;">raid 5 </span><span class="font25">array in the next topic: </span><span class="font25" style="font-weight:bold;">lvm</span><span class="font25">.</span></h4>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3937"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3938"></a>11.3.5. /proc/mdstat</span></h3></li></ul>
<h4><a name="bookmark3939"></a><span class="font25"><a name="bookmark3940"></a><a name="bookmark3941"></a>The status of the raid devices can be seen in </span><span class="font25" style="font-weight:bold;">/proc/mdstat</span><span class="font25">. This example shows a </span><span class="font25" style="font-weight:bold;">raid 5 </span><span class="font25">in the process of rebuilding.</span></h4>
<p><span class="font19">[root@rhel6c ~]# cat /proc/mdstat</span></p>
<p><span class="font19">Personalities : [raid6] [raid5] [raid4]</span></p>
<p><span class="font19">md0 : active raid5 sdd1[3] sdc1[1] sdb1[0]</span></p>
<p><span class="font19">16769664 blocks super 1.2 level 5, 64k chunk, algorithm 2 [3/2] [UU_] [ = = = = = = = = = = = =&gt;........] recovery = 62.8% (5266176/8384832) finish=0\</span></p>
<p><span class="font19">.3min speed=139200K/sec</span></p>
<h4><a name="bookmark3942"></a><span class="font25"><a name="bookmark3943"></a>This example shows an active software </span><span class="font25" style="font-weight:bold;">raid 5</span><span class="font25">.</span></h4>
<p><span class="font19">[root@rhel6c ~]# cat /proc/mdstat</span></p>
<p><span class="font19">Personalities : [raid6] [raid5] [raid4] md0 : active raid5 sdd1[3] sdc1[1] sdb1[0]</span></p>
<p><span class="font19">16769664 blocks super 1.2 level 5, 64k chunk, algorithm 2 [3/3] [UUU]</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3944"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3945"></a>11.3.6. mdadm --detail</span></h3></li></ul>
<h4><a name="bookmark3946"></a><span class="font25"><a name="bookmark3947"></a>Use </span><span class="font25" style="font-weight:bold;">mdadm --detail </span><span class="font25">to get information on a raid device.</span></h4>
<div>
<p><span class="font19">[root@rhel6c ~]# /dev/md0:</span></p>
<p><span class="font19">Version</span></p>
<p><span class="font19">Creation Time Raid Level Array Size Used Dev Size Raid Devices Total Devices</span></p>
<p><span class="font19">Persistence</span></p>
</div><br clear="all">
<p><span class="font19">mdadm --detail /dev/md0</span></p>
<p><span class="font19">1.2</span></p>
<p><span class="font19">Sun Jul 17 13:48:41 2011 raid5</span></p>
<p><span class="font19">16769664 (15.99 GiB 17.17 GB)</span></p>
<p><span class="font19">8384832 (8.00 GiB 8.59 GB) 3 3</span></p>
<p><span class="font19">Superblock is persistent</span></p>
<div>
<p><span class="font19">Update</span></p>
</div><br clear="all">
<div>
<p><span class="font19">Active Working Failed</span></p>
<p><span class="font19">Spare</span></p>
</div><br clear="all">
<div>
<p><span class="font19">Time</span></p>
<p><span class="font19">State Devices Devices Devices Devices</span></p>
</div><br clear="all">
<div>
<p><span class="font19">Sun Jul 17 13:49:43 2011 clean 3 3 0 0</span></p>
</div><br clear="all">
<p><span class="font19">Layout : left-symmetric Chunk Size : 64K</span></p>
<p><span class="font19">Name : rhel6c:0 (local to host rhel6c)</span></p>
<p><span class="font19">UUID : c10fd9c3:08f9a25f:be913027:999c8e1f</span></p>
<p><span class="font19">Events : 18</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">Number</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Major</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Minor</span></p></td><td style="vertical-align:top;">
<p><span class="font19">RaidDevice</span></p></td><td colspan="3" style="vertical-align:top;">
<p><span class="font19">State</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">8</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">17</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">active</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sync</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdb1</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">8</span></p></td><td style="vertical-align:top;">
<p><span class="font19">33</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sync</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/dev/sdc1</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">8</span></p></td><td style="vertical-align:top;">
<p><span class="font19">49</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sync</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/dev/sdd1</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3948"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3949"></a>11.3.7. removing a software raid</span></h3></li></ul>
<h4><a name="bookmark3950"></a><span class="font25"><a name="bookmark3951"></a>The software raid is visible in </span><span class="font25" style="font-weight:bold;">/proc/mdstat </span><span class="font25">when active. To remove the raid completely so you can use the disks for other purposes, you stop (de-activate) it with </span><span class="font25" style="font-weight:bold;">mdadm</span><span class="font25">.</span></h4>
<p><span class="font19">[root@rhel6c ~]# mdadm --stop /dev/md0 mdadm: stopped /dev/md0</span></p>
<h4><a name="bookmark3952"></a><span class="font25"><a name="bookmark3953"></a>The disks can now be repartitioned.</span></h4>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3954"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3955"></a>11.3.8. further reading</span></h3></li></ul>
<h4><a name="bookmark3956"></a><span class="font25"><a name="bookmark3957"></a>Take a look at the man page of </span><span class="font25" style="font-weight:bold;">mdadm </span><span class="font25">for more information. Below an example command to add a new partition while removing a faulty one.</span></h4>
<p><span class="font19">mdadm /dev/md0 --add /dev/sdd1 --fail /dev/sdb1 --remove /dev/sdb1</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3958"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3067"></a><a name="bookmark3959"></a>11.4. practice: raid</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Add three virtual disks of 1GB each to a virtual machine.</span></p></li>
<li>
<p><span class="font25">2. Create a software </span><span class="font25" style="font-weight:bold;">raid 5 </span><span class="font25">on the three disks. (It is not necessary to put a filesystem on it)</span></p></li>
<li>
<p><span class="font25">3. Verify with </span><span class="font25" style="font-weight:bold;">fdisk </span><span class="font25">and in </span><span class="font25" style="font-weight:bold;">/proc </span><span class="font25">that the </span><span class="font25" style="font-weight:bold;">raid 5 </span><span class="font25">exists.</span></p></li>
<li>
<p><span class="font25">4. Stop and remove the </span><span class="font25" style="font-weight:bold;">raid 5</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">5. Create a </span><span class="font25" style="font-weight:bold;">raid 1 </span><span class="font25">to mirror two disks.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3960"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3068"></a><a name="bookmark3961"></a>11.5. solution: raid</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Add three virtual disks of 1GB each to a virtual machine.</span></p></li>
<li>
<p><span class="font25">2. Create a software </span><span class="font25" style="font-weight:bold;">raid 5 </span><span class="font25">on the three disks. (It is not necessary to put a filesystem on it)</span></p></li>
<li>
<p><span class="font25">3. Verify with </span><span class="font25" style="font-weight:bold;">fdisk </span><span class="font25">and in </span><span class="font25" style="font-weight:bold;">/proc </span><span class="font25">that the </span><span class="font25" style="font-weight:bold;">raid 5 </span><span class="font25">exists.</span></p></li>
<li>
<p><span class="font25">4. Stop and remove the </span><span class="font25" style="font-weight:bold;">raid 5</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">5. Create a </span><span class="font25" style="font-weight:bold;">raid 1 </span><span class="font25">to mirror two disks.</span></p></li></ul>
<p><span class="font19">[root@rhel6c ~]# mdadm --create /dev/md0 --level=1 --raid-devices=2 \</span></p>
<p><span class="font19">/dev/sdbl /dev/sdcl</span></p>
<p><span class="font19">mdadm: Defaulting to version 1.2 metadata</span></p>
<p><span class="font19">mdadm: array /dev/md0 started.</span></p>
<p><span class="font19">[root@rhel6c ~]# cat /proc/mdstat</span></p>
<p><span class="font19">Personalities : [raid6] [raid5] [raid4] [raid1]</span></p>
<p><span class="font19">md0 : active raid1 sdc1[1] sdb1[0]</span></p>
<p><span class="font19">8384862 blocks super 1.2 [2/2] [UU]</span></p>
<p><span class="font19">[ = = = =&gt;................] &nbsp;&nbsp;resync = 20.8% (1745152/83 84 862) \</span></p>
<p><span class="font19">finish=0.5min speed=218144K/sec</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark3962"></a><span class="font11" style="font-weight:bold;"><a name="bookmark3069"></a><a name="bookmark3963"></a>Chapter 12. logical volume management</span></h1></li></ul>
<p><a name="bookmark3964"></a><span class="font25">Most </span><span class="font25" style="font-weight:bold;">lvm </span><span class="font25">implementations support </span><span class="font25" style="font-weight:bold;">physical storage grouping</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">logical volume resizing </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">data migration</span><span class="font25">.</span></p>
<p><span class="font25">Physical storage grouping is a fancy name for grouping multiple block devices (hard disks, but also iSCSI etc) into a logical mass storage device. To enlarge this physical group, block devices (including partitions) can be added at a later time.</span></p>
<p><span class="font25">The size of </span><span class="font25" style="font-weight:bold;">lvm volumes </span><span class="font25">on this </span><span class="font25" style="font-weight:bold;">physical group </span><span class="font25">is independent of the individual size of the components. The total size of the group is the limit.</span></p>
<p><span class="font25">One of the nice features of </span><span class="font25" style="font-weight:bold;">lvm </span><span class="font25">is the logical volume resizing. You can increase the size of an </span><span class="font25" style="font-weight:bold;">lvm volume</span><span class="font25">, sometimes even without any downtime. Additionally, you can migrate data away from a failing hard disk device, create mirrors and create snapshots.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3965"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3070"></a><a name="bookmark3966"></a>12.1. introduction to lvm</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark3967"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3968"></a>12.1.1. problems with standard partitions</span></h3></li></ul></li></ul>
<p><span class="font25">There are some problems when working with hard disks and standard partitions. Consider a system with a small and a large hard disk device, partitioned like this. The first disk (/ dev/sda) is partitioned in two, the second disk (/dev/sdb) has two partitions and some empty space.</span></p><img src="linux_guide_files/The Complete Linux Guide-89.jpg" alt="" style="width:454pt;height:74pt;">
<p><span class="font25">In the example above, consider the options when you want to enlarge the space available for </span><span class="font25" style="font-weight:bold;">/srv/project42</span><span class="font25">. What can you do ? The solution will always force you to unmount the file system, take a backup of the data, remove and recreate partitions, and then restore the data and remount the file system.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3302"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3969"></a>12.1.2. solution with lvm</span></h3></li></ul>
<p><span class="font25">Using </span><span class="font25" style="font-weight:bold;">lvm </span><span class="font25">will create a virtual layer between the mounted file systems and the hardware devices. This virtual layer will allow for an administrator to enlarge a mounted file system in use. When </span><span class="font25" style="font-weight:bold;">lvm </span><span class="font25">is properly used, then there is no need to unmount the file system to enlarge it.</span></p><img src="linux_guide_files/The Complete Linux Guide-90.jpg" alt="" style="width:340pt;height:200pt;">
<ul style="list-style:none;"><li>
<h2><a name="bookmark3970"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3071"></a><a name="bookmark3971"></a>12.2. lvm terminology</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark3972"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3973"></a>12.2.1. physical volume (pv)</span></h3></li></ul></li></ul>
<p><span class="font25">A </span><span class="font25" style="font-weight:bold;">physical volume </span><span class="font25">is any block device (a disk, a partition, a RAID device or even an iSCSI device). All these devices can become a member of a </span><span class="font25" style="font-weight:bold;">volume group</span><span class="font25">.</span></p>
<p><span class="font25">The commands used to manage a </span><span class="font25" style="font-weight:bold;">physical volume </span><span class="font25">start with pv.</span></p>
<p><span class="font19">[root@centos65 ~]# pv</span></p>
<p><span class="font19">pvchange pvck &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pvcreate pvdisplay pvmove pvremove</span></p>
<p><span class="font19">pvresize pvs &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pvscan</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3974"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3975"></a>12.2.2. volume group (vg)</span></h3></li></ul>
<p><span class="font25">A </span><span class="font25" style="font-weight:bold;">volume group </span><span class="font25">is an abstraction layer between </span><span class="font25" style="font-weight:bold;">block devices </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">logical volumes</span><span class="font25">.</span></p>
<p><span class="font25">The commands used to manage a </span><span class="font25" style="font-weight:bold;">volume group </span><span class="font25">start with vg.</span></p>
<div>
<p><span class="font19">[root@centos65 ~]# vg</span></p>
<p><span class="font19">vgcfgbackup &nbsp;&nbsp;&nbsp;vgconvert</span></p>
<p><span class="font19">vgcfgrestore &nbsp;&nbsp;vgcreate</span></p>
<p><span class="font19">vgchange &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vgdisplay</span></p>
<p><span class="font19">vgck &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vgexport</span></p>
</div><br clear="all">
<div>
<p><span class="font19">vgextend vgimport vgimportclone</span></p>
</div><br clear="all">
<div>
<p><span class="font19">vgmknodes vgreduce vgremove</span></p>
</div><br clear="all">
<div>
<p><span class="font19">vgs vgscan vgsplit</span></p>
</div><br clear="all">
<div>
<p><span class="font19">vgmerge</span></p>
</div><br clear="all">
<div>
<p><span class="font19">vgrename</span></p>
</div><br clear="all">
<ul style="list-style:none;"><li>
<h3><a name="bookmark3976"></a><span class="font9" style="font-weight:bold;"><a name="bookmark3977"></a>12.2.3. logical volume (lv)</span></h3></li></ul>
<p><span class="font25">A </span><span class="font25" style="font-weight:bold;">logical volume </span><span class="font25">is created in a </span><span class="font25" style="font-weight:bold;">volume group</span><span class="font25">. Logical volumes that contain a file system can be mounted. The use of </span><span class="font25" style="font-weight:bold;">logical volumes </span><span class="font25">is similar to the use of </span><span class="font25" style="font-weight:bold;">partitions </span><span class="font25">and is accomplished with the same standard commands (mkfs, mount, fsck, df, ...).</span></p>
<p><span class="font25">The commands used to manage a </span><span class="font25" style="font-weight:bold;">logical volume </span><span class="font25">start with lv.</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[root@cento</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">s65 ~]# lv</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">lvchange</span></p></td><td style="vertical-align:top;">
<p><span class="font19">lvextend</span></p></td><td style="vertical-align:top;">
<p><span class="font19">lvmdiskscan</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Ivmsar</span></p></td><td style="vertical-align:top;">
<p><span class="font19">lvresize</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">lvconvert</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Ivm</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">lvmdump</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Ivreduce</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">lvs</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">lvcreate</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">lvmchange</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">lvmetad</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Ivremove</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">lvscan</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">lvdisplay</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Ivmconf</span></p></td><td style="vertical-align:top;">
<p><span class="font19">lvmsadc</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Ivrename</span></p></td><td style="vertical-align:top;"></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3978"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3072"></a><a name="bookmark3979"></a>12.3. example: using lvm</span></h2></li></ul>
<p><span class="font25">This example shows how you can use a device (in this case /dev/sdc, but it could have been / dev/sdb or any other disk or partition) with lvm, how to create a volume group (vg) and how to create and use a logical volume (vg/lvol0).</span></p>
<p><a name="bookmark3980"></a><span class="font25">First thing to do, is create physical volumes that can join the volume group with </span><span class="font25" style="font-weight:bold;">pvcreate</span><span class="font25">. This command makes a disk or partition available for use in Volume Groups. The screenshot shows how to present the SCSI Disk device to LVM.</span></p>
<p><span class="font19">root@RHEL4:~# pvcreate /dev/sdc</span></p>
<p><span class="font19">Physical volume &quot;/dev/sdc&quot; successfully created</span></p>
<p><span class="font25" style="font-style:italic;">Note: lvm </span><span class="font25" style="font-weight:bold;font-style:italic;">will </span><span class="font25" style="font-style:italic;">work fine when using the complete device, but another operating system on the same computer (or on the same SAN) will not recognize lvm and will mark the block device as being empty! You can avoid this by creating a partition that spans the whole device, then run </span><span class="font25" style="font-weight:bold;font-style:italic;">pvcreate </span><span class="font25" style="font-style:italic;">on the partition instead of the disk.</span></p>
<p><a name="bookmark3981"></a><span class="font25">Then </span><span class="font25" style="font-weight:bold;">vgcreate </span><span class="font25">creates a volume group using one device. Note that more devices could be added to the volume group.</span></p>
<p><span class="font19">root@RHEL4:~# vgcreate vg /dev/sdc</span></p>
<p><span class="font19">Volume group &quot;vg&quot; successfully created</span></p>
<p><a name="bookmark3982"></a><span class="font25">The last step </span><span class="font25" style="font-weight:bold;">lvcreate </span><span class="font25">creates a logical volume.</span></p>
<p><span class="font19">root@RHEL4:~# lvcreate --size 500m vg</span></p>
<p><span class="font19">Logical volume &quot;lvol0&quot; created</span></p>
<h4><a name="bookmark3983"></a><span class="font25"><a name="bookmark3984"></a>The logical volume /dev/vg/lvol0 can now be formatted with ext3, and mounted for normal use.</span></h4>
<p><span class="font19">root@RHELv4u2:~# mke2fs -m0 -j /dev/vg/lvol0 mke2fs 1.35 (28-Feb-2004) Filesystem label= OS type: Linux</span></p>
<p><span class="font19">Block size=1024 (log=0)</span></p>
<p><span class="font19">Fragment size=1024 (log=0) 128016 inodes, 512000 blocks 0 blocks (0.00%) reserved for the super user First data block=1</span></p>
<p><span class="font19">Maximum filesystem blocks=67633152 63 block groups 8192 blocks per group, 8192 fragments per group 2032 inodes per group Superblock backups stored on blocks: 8193, 24577, 40961, 57345, 73729, 204801, 221185, 401409</span></p>
<p><span class="font19">Writing inode tables: done</span></p>
<p><span class="font19">Creating journal (8192 blocks): done</span></p>
<p><span class="font19">Writing superblocks and filesystem accounting information: done</span></p>
<p><span class="font19">This filesystem will be automatically checked every 37 mounts or 180 days, whichever comes first. Use tune2fs -c or -i to override. root@RHELv4u2:~# mkdir /home/project10 root@RHELv4u2:~# mount /dev/vg/lvol0 /home/project10/ root@RHELv4u2:~# df -h | grep proj /dev/mapper/vg-lvol0 485M &nbsp;&nbsp;11M &nbsp;474M &nbsp;&nbsp;3% /home/project10</span></p>
<h4><a name="bookmark3985"></a><span class="font25"><a name="bookmark3986"></a>A logical volume is very similar to a partition, it can be formatted with a file system, and can be mounted so users can access it.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark3987"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3073"></a><a name="bookmark3988"></a>12.4. example: extend a logical volume</span></h2></li></ul>
<p><span class="font25">A logical volume can be extended without unmounting the file system. Whether or not a volume can be extended depends on the file system it uses. Volumes that are mounted as vfat or ext2 cannot be extended, so in the example here we use the ext3 file system.</span></p>
<p><span class="font25">The fdisk command shows us newly added scsi-disks that will serve our lvm volume. This volume will then be extended. First, take a look at these disks.</span></p>
<p><span class="font19">[root@RHEL5 ~]# fdisk -l | grep sd[bc]</span></p>
<p><span class="font19">Disk /dev/sdb doesn't contain a valid partition table</span></p>
<p><span class="font19">Disk /dev/sdc doesn't contain a valid partition table</span></p>
<p><span class="font19">Disk /dev/sdb: 1181 MB, 1181115904 bytes</span></p>
<p><span class="font19">Disk /dev/sdc: 429 MB, 429496320 bytes</span></p>
<p><span class="font25">You already know how to partition a disk, below the first disk is partitioned (in one big primary partition), the second disk is left untouched.</span></p>
<p><span class="font19">[root@RHEL5 ~]# fdisk -l | grep sd[bc]</span></p>
<p><span class="font19">Disk /dev/sdc doesn't contain a valid partition table Disk /dev/sdb: 1181 MB, 1181115904 bytes /dev/sdb1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;143 &nbsp;&nbsp;&nbsp;&nbsp;1148616 &nbsp;&nbsp;83 Linux</span></p>
<p><span class="font19">Disk /dev/sdc: 429 MB, 429496320 bytes</span></p>
<p><a name="bookmark3989"></a><span class="font25"><a name="bookmark3990"></a>You also know how to prepare disks for lvm with </span><span class="font25" style="font-weight:bold;">pvcreate</span><span class="font25">, and how to create a volume group with </span><span class="font25" style="font-weight:bold;">vgcreate</span><span class="font25">. This example adds both the partitioned disk and the untouched disk to the volume group named </span><span class="font25" style="font-weight:bold;">vg2</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL5 ~]# pvcreate /dev/sdb1</span></p>
<p><span class="font19">Physical volume &quot;/dev/sdb1&quot; successfully created [root@RHEL5 ~]# pvcreate /dev/sdc</span></p>
<p><span class="font19">Physical volume &quot;/dev/sdc&quot; successfully created [root@RHEL5 ~]# vgcreate vg2 /dev/sdb1 /dev/sdc</span></p>
<p><span class="font19">Volume group &quot;vg2&quot; successfully created</span></p>
<p><a name="bookmark3991"></a><span class="font25">You can use </span><span class="font25" style="font-weight:bold;">pvdisplay </span><span class="font25">to verify that both the disk and the partition belong to the volume group.</span></p>
<p><span class="font19">[root@RHEL5 ~]# pvdisplay | grep -B1 vg2</span></p>
<p><span class="font19">PV Name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/dev/sdb1</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">VG Name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vg2</span></p></li></ul>
<p><span class="font19">—</span></p>
<p><span class="font19">PV Name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/dev/sdc</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">VG Name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vg2</span></p></li></ul>
<p><a name="bookmark3992"></a><span class="font25"><a name="bookmark3993"></a>And you are familiar both with the </span><span class="font25" style="font-weight:bold;">lvcreate </span><span class="font25">command to create a small logical volume and the </span><span class="font25" style="font-weight:bold;">mke2fs </span><span class="font25">command to put ext3 on it.</span></p>
<p><span class="font19">[root@RHEL5 ~]# lvcreate --size 200m vg2</span></p>
<p><span class="font19">Logical volume &quot;lvol0&quot; created</span></p>
<p><span class="font19">[root@RHEL5 ~]# mke2fs -m20 -j /dev/vg2/lvol0</span></p>
<h4><a name="bookmark3994"></a><span class="font25"><a name="bookmark3995"></a>As you see, we end up with a mounted logical volume that according to </span><span class="font25" style="font-weight:bold;">df </span><span class="font25">is almost 200 megabyte in size.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# mkdir /home/resizetest</span></p>
<p><span class="font19">[root@RHEL5 ~]# mount /dev/vg2/lvol0 /home/resizetest/</span></p>
<p><span class="font19">[root@RHEL5 ~]# df -h | grep resizetest</span></p>
<p><span class="font19">194M &nbsp;5.6M &nbsp;149M &nbsp;&nbsp;4% /home/resizetest</span></p>
<h4><a name="bookmark3996"></a><span class="font25"><a name="bookmark3997"></a><a name="bookmark3998"></a>Extending the volume is easy with </span><span class="font25" style="font-weight:bold;">lvextend</span><span class="font25">.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# lvextend -L +100 /dev/vg2/lvol0</span></p>
<p><span class="font19">Extending logical volume lvol0 to 300.00 MB</span></p>
<p><span class="font19">Logical volume lvol0 successfully resized</span></p>
<h4><a name="bookmark3999"></a><span class="font25"><a name="bookmark4000"></a>But as you can see, there is a small problem: it appears that df is not able to display the extended volume in its full size. This is because the filesystem is only set for the size of the volume before the extension was added.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# df -h | grep resizetest</span></p>
<p><span class="font19">194M &nbsp;5.6M &nbsp;149M &nbsp;&nbsp;4% /home/resizetest</span></p>
<h4><a name="bookmark4001"></a><span class="font25"><a name="bookmark4002"></a><a name="bookmark4003"></a>With </span><span class="font25" style="font-weight:bold;">lvdisplay </span><span class="font25">however we can see that the volume is indeed extended.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# lvdisplay /dev/vg2/lvol0 | grep Size</span></p>
<p><span class="font19">LV Size &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;300.00 MB</span></p>
<h4><a name="bookmark4004"></a><span class="font25"><a name="bookmark4005"></a><a name="bookmark4006"></a>To finish the extension, you need </span><span class="font25" style="font-weight:bold;">resize2fs </span><span class="font25">to span the filesystem over the full size of the logical volume.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# resize2fs /dev/vg2/lvol0</span></p>
<p><span class="font19">resize2fs 1.39 (29-May-2006)</span></p>
<p><span class="font19">Filesystem at /dev/vg2/lvol0 is mounted on /home/resizetest; on-line re\ sizing required</span></p>
<p><span class="font19">Performing an on-line resize of /dev/vg2/lvol0 to 307200 (1k) blocks.</span></p>
<p><span class="font19">The filesystem on /dev/vg2/lvol0 is now 307200 blocks long.</span></p>
<h4><a name="bookmark4007"></a><span class="font25"><a name="bookmark4008"></a>Congratulations, you just successfully expanded a logical volume.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# df -h | grep resizetest</span></p>
<p><span class="font19">291M &nbsp;6.1M &nbsp;225M &nbsp;&nbsp;3% /home/resizetest</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4009"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3074"></a><a name="bookmark4010"></a>12.5. example: resize a physical Volume</span></h2></li></ul>
<h4><a name="bookmark4011"></a><span class="font25"><a name="bookmark4012"></a>This is a humble demonstration of how to resize a physical Volume with lvm (after you resize it with fdisk). The demonstration starts with a 100MB partition named /dev/sde1. We used fdisk to create it, and to verify the size.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# fdisk -l 2&gt;/dev/null | grep sdel</span></p>
<p><span class="font19">/dev/sdel &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;100 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;102384 &nbsp;&nbsp;83 Linux</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<h4><a name="bookmark4013"></a><span class="font25"><a name="bookmark4014"></a>Now we can use pvcreate to create the Physical Volume, followed by pvs to verify the creation.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# pvcreate /dev/sde1</span></p>
<p><span class="font19">Physical volume &quot;/dev/sde1&quot; successfully created</span></p>
<p><span class="font19">[root@RHEL5 ~]# pvs | grep sde1 /dev/sde1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lvm2 -- &nbsp;&nbsp;&nbsp;99.98M &nbsp;99.98M</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<h4><a name="bookmark4015"></a><span class="font25"><a name="bookmark4016"></a>The next step is to use fdisk to enlarge the partition (actually deleting it and then recreating / dev/sde1 with more cylinders).</span></h4>
<p><span class="font19">[root@RHEL5 ~]# fdisk /dev/sde</span></p>
<p><span class="font19">Command (m for help): p</span></p>
<p><span class="font19">Disk /dev/sde: 858 MB, 858993152 bytes 64 heads, 32 sectors/track, 819 cylinders Units = cylinders of 2048 * 512 = 1048576 bytes</span></p>
<p><span class="font19">Device Boot &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Start &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Blocks &nbsp;&nbsp;Id &nbsp;System</span></p>
<p><span class="font19">/dev/sde1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;100 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;102384 &nbsp;&nbsp;83 &nbsp;Linux</span></p>
<p><span class="font19">Command (m for help): d</span></p>
<p><span class="font19">Selected partition 1</span></p>
<p><span class="font19">Command (m for help): n Command action e extended p primary partition (1-4) p Partition number (1-4): Value out of range. Partition number (1-4): 1 First cylinder (1-819, default 1): Using default value 1 Last cylinder or +size or +sizeM or +sizeK (1-819, default 819): 200</span></p>
<p><span class="font19">Command (m for help): w</span></p>
<p><span class="font19">The partition table has been altered!</span></p>
<p><span class="font19">Calling ioctl() to re-read partition table.</span></p>
<p><span class="font19">Syncing disks. [root@RHEL5 ~]#</span></p>
<div>
<h4><a name="bookmark4017"></a><span class="font25"><a name="bookmark4018"></a>When we now use fdisk and pvs to verify the size of the partition and the Physical Volume, then there is a size difference. LVM is still using the old size.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# fdisk -l 2&gt;/dev/null | grep sdel</span></p>
</div><br clear="all">
<div>
<p><span class="font19">/dev/sdel</span></p>
</div><br clear="all">
<div>
<p><span class="font19">200</span></p>
</div><br clear="all">
<div>
<p><span class="font19">204784</span></p>
</div><br clear="all">
<div>
<p><span class="font19">83 Linux</span></p>
</div><br clear="all">
<div>
<p><span class="font19">[root@RHEL5 ~]# pvs | grep sde1</span></p>
</div><br clear="all">
<div>
<p><span class="font19">/dev/sde1</span></p>
</div><br clear="all">
<div>
<p><span class="font19">lvm2</span></p>
</div><br clear="all">
<div>
<p><span class="font19">99.98M &nbsp;99.98M</span></p>
</div><br clear="all">
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<h4><a name="bookmark4019"></a><span class="font25"><a name="bookmark4020"></a>Executing pvresize on the Physical Volume will make lvm aware of the size change of the partition. The correct size can be displayed with pvs.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# pvresize /dev/sde1</span></p>
<p><span class="font19">Physical volume &quot;/dev/sde1&quot; changed</span></p>
<p><span class="font19">1 physical volume(s) resized / 0 physical volume(s) not resized</span></p>
<p><span class="font19">[root@RHEL5 ~]# pvs | grep sde1</span></p>
<p><span class="font19">/dev/sde1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lvm2 -- &nbsp;&nbsp;199.98M 199.98M</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4021"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3075"></a><a name="bookmark4022"></a>12.6. example: mirror a logical volume</span></h2></li></ul>
<p><span class="font25">We start by creating three physical volumes for lvm. Then we verify the creation and the size with pvs. Three physical disks because lvm uses two disks for the mirror and a third disk for the mirror log!</span></p>
<p><span class="font19">[root@RHEL5 ~]# pvcreate</span></p>
<div>
<p><span class="font19">/dev/sdb /dev/sdc /dev/sdd successfully created successfully created successfully created</span></p>
<p><span class="font19">Attr PSize &nbsp;&nbsp;PFree</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- - &nbsp;&nbsp;409.60M 409.60M</span></p></li>
<li>
<p><span class="font19">- - &nbsp;&nbsp;409.60M 409.60M</span></p></li>
<li>
<p><span class="font19">- - &nbsp;&nbsp;409.60M 409.60M</span></p></li></ul>
</div><br clear="all">
<p><span class="font19">Physical volume &quot;/dev/sdb&quot;</span></p>
<p><span class="font19">Physical volume &quot;/dev/sdc&quot;</span></p>
<p><span class="font19">Physical volume &quot;/dev/sdd&quot;</span></p>
<p><span class="font19">[root@RHEL5 ~]# pvs</span></p>
<p><span class="font19">PV &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fmt</span></p>
<p><a href="#bookmark4023"><span class="font19">/dev/sdb</span></a></p>
<p><a href="#bookmark4024"><span class="font19">/dev/sdc</span></a></p>
<p><a href="#bookmark4025"><span class="font19">/dev/sdd</span></a></p>
<p><span class="font25">Then we create the Volume Group and verify again with pvs. Notice how the three physical volumes now belong to vg33, and how the size is rounded down (in steps of the extent size, here 4MB).</span></p>
<p><span class="font19">[root@RHEL5 ~]# vgcreate vg33 /dev/sdb /dev/sdc /dev/sdd Volume group &quot;vg33&quot; successfully created</span></p>
<p><span class="font19">[root@RHEL5 ~]# pvs</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">PV</span></p></td><td style="vertical-align:top;">
<p><span class="font19">VG</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Fmt</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Attr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">PSize</span></p></td><td style="vertical-align:top;">
<p><span class="font19">PFree</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sda2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">VolGroup00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">lvm2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">a-</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15.88G</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/sdb</span></p></td><td style="vertical-align:top;">
<p><span class="font19">vg33</span></p></td><td style="vertical-align:top;">
<p><span class="font19">lvm2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">a-</span></p></td><td style="vertical-align:top;">
<p><span class="font19">408.00M</span></p></td><td style="vertical-align:top;">
<p><span class="font19">408.00M</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">vg33</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">lvm2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">a-</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">408.00M</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">408.00M</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/sdd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">vg33</span></p></td><td style="vertical-align:top;">
<p><span class="font19">lvm2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">a-</span></p></td><td style="vertical-align:top;">
<p><span class="font19">408.00M</span></p></td><td style="vertical-align:top;">
<p><span class="font19">408.00M</span></p></td></tr>
</table>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<p><span class="font25">The last step is to create the Logical Volume with </span><span class="font25" style="font-weight:bold;">lvcreate</span><span class="font25">. Notice the </span><span class="font25" style="font-weight:bold;">-m 1 </span><span class="font25">switch to create one mirror. Notice also the change in free space in all three Physical Volumes!</span></p>
<p><span class="font19">[root@RHEL5 ~]# lvcreate --size 300m -n lvmir -m 1 vg33 Logical volume &quot;lvmir&quot; created</span></p>
<p><span class="font19">[root@RHEL5 ~]# pvs</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">PV</span></p></td><td style="vertical-align:top;">
<p><span class="font19">VG</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Fmt</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Attr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">PSize</span></p></td><td style="vertical-align:top;">
<p><span class="font19">PFree</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sda2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">VolGroup00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">lvm2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">a-</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15.88G</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/sdb</span></p></td><td style="vertical-align:top;">
<p><span class="font19">vg33</span></p></td><td style="vertical-align:top;">
<p><span class="font19">lvm2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">a-</span></p></td><td style="vertical-align:top;">
<p><span class="font19">408.00M</span></p></td><td style="vertical-align:top;">
<p><span class="font19">108.00M</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">vg33</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">lvm2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">a-</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">408.00M</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">108.00M</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/sdd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">vg33</span></p></td><td style="vertical-align:top;">
<p><span class="font19">lvm2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">a-</span></p></td><td style="vertical-align:top;">
<p><span class="font19">408.00M</span></p></td><td style="vertical-align:top;">
<p><span class="font19">404.00M</span></p></td></tr>
</table>
<p><span class="font25">You can see the copy status of the mirror with lvs. It currently shows a 100 percent copy.</span></p>
<p><span class="font19">[root@RHEL5 ~]# lvs vg33/lvmir</span></p>
<p><span class="font19">LV VG Attr LSize &nbsp;&nbsp;Origin Snap% Move Log &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Copy%</span></p>
<p><span class="font19">lvmir vg33 mwi-ao 300.00M &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lvmir_mlog 100.00</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4026"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3076"></a><a name="bookmark4027"></a>12.7. example: snapshot a logical volume</span></h2></li></ul>
<p><span class="font25">A snapshot is a virtual copy of all the data at a point in time on a volume. A snapshot Logical</span></p>
<p><span class="font25">Volume will retain a copy of all changed files of the snapshotted Logical Volume.</span></p>
<p><span class="font25">The example below creates a snapshot of the bigLV Logical Volume.</span></p>
<p><span class="font19">[root@RHEL5 ~]# lvcreate -L100M -s -n snapLV vg42/bigLV</span></p>
<p><span class="font19">Logical volume &quot;snapLV&quot; created [root@RHEL5 ~]#</span></p>
<p><span class="font25">You can see with lvs that the snapshot snapLV is indeed a snapshot of bigLV. Moments after taking the snapshot, there are few changes to bigLV (0.02 percent).</span></p>
<div>
<p><span class="font19">[root@RHEL5 ~]# lvs</span></p>
<p><span class="font19">LV &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VG</span></p>
<p><span class="font19">bigLV &nbsp;&nbsp;&nbsp;vg42</span></p>
<p><span class="font19">snapLV vg42</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
</div><br clear="all">
<p><span class="font19">Attr LSize Origin Snap% Move Log Copy% owi-a- 200.00M swi-a- 100.00M bigLV 0.02</span></p>
<p><span class="font25">But after using bigLV for a while, more changes are done. This means the snapshot volume has to keep more original data (10.22 percent).</span></p>
<p><span class="font19">[root@RHEL5 ~]# lvs | grep vg42</span></p>
<p><span class="font19">bigLV vg42 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;owi-ao 200.00M</span></p>
<p><span class="font19">snapLV vg42 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;swi-a- 100.00M bigLV 10.22</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<p><span class="font25">You can now use regular backup tools (dump, tar, cpio, ...) to take a backup of the snapshot Logical Volume. This backup will contain all data as it existed on bigLV at the time the snapshot was taken. When the backup is done, you can remove the snapshot.</span></p>
<p><span class="font19">[root@RHEL5 ~]# lvremove vg42/snapLV</span></p>
<p><span class="font19">Do you really want to remove active logical volume &quot;snapLV&quot;? [y/n]: y</span></p>
<p><span class="font19">Logical volume &quot;snapLV&quot; successfully removed</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4028"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3077"></a><a name="bookmark4029"></a>12.8. verifying existing physical volumes</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark4030"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4031"></a>12.8.1. lvmdiskscan</span></h3></li></ul></li></ul>
<p><a name="bookmark4032"></a><span class="font25">To get a list of block devices that can be used with LVM, use </span><span class="font25" style="font-weight:bold;">lvmdiskscan</span><span class="font25">. The example below uses grep to limit the result to SCSI devices.</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">[root@RHEL5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">~]# lvmdiskscan</span></p></td><td style="vertical-align:top;">
<p><span class="font19">| grep sd</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/sdal</span></p></td><td style="vertical-align:top;">
<p><span class="font19">[</span></p></td><td style="vertical-align:top;">
<p><span class="font19">101.94 MB]</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sda2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">[</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15.90 GB] LVM physical volume</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">[</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">409.60 MB]</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">[</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">409.60 MB]</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdd</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">[</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">409.60 MB] LVM physical volume</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdel</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">[</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">95.98 MB]</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sde5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">[</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">191.98 MB]</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdf</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">[</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">819.20 MB] LVM physical volume</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdgl</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">[</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">818.98 MB]</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[root@RHEL5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~]#</span></p></td><td style="vertical-align:top;"></td></tr>
</table>
<h3><a name="bookmark4033"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4034"></a>12.8.2. pvs</span></h3>
<p><a name="bookmark4035"></a><span class="font25">The easiest way to verify whether devices are known to lvm is with the </span><span class="font25" style="font-weight:bold;">pvs </span><span class="font25">command. The screenshot below shows that only /dev/sda2 is currently known for use with LVM. It shows that /dev/sda2 is part of Volgroup00 and is almost 16GB in size. It also shows /dev/sdc and / dev/sdd as part of vg33. The device /dev/sdb is knwon to lvm, but not linked to any Volume Group.</span></p>
<p><span class="font19">[root@RHEL5 ~]# pvs</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">PV</span></p></td><td style="vertical-align:top;">
<p><span class="font19">VG</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Fmt</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Attr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">PSize</span></p></td><td style="vertical-align:top;">
<p><span class="font19">PFree</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sda2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">VolGroup00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">lvm2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">a-</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15.88G</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/sdb</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">lvm2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">—</span></p></td><td style="vertical-align:top;">
<p><span class="font19">409.60M</span></p></td><td style="vertical-align:top;">
<p><span class="font19">409.60M</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">vg33</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">lvm2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">a-</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">408.00M</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">408.00M</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/sdd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">vg33</span></p></td><td style="vertical-align:top;">
<p><span class="font19">lvm2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">a-</span></p></td><td style="vertical-align:top;">
<p><span class="font19">408.00M</span></p></td><td style="vertical-align:top;">
<p><span class="font19">408.00M</span></p></td></tr>
</table>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4036"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4037"></a>12.8.3. pvscan</span></h3></li></ul>
<p><a name="bookmark4038"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">pvscan </span><span class="font25">command will scan all disks for existing Physical Volumes. The information is similar to pvs, plus you get a line with total sizes.</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[root@RHEL5 ~]#</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pvscan</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">PV /dev/sdc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">VG vg33 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lvm2 [408.00 MB / 408.00 MB free]</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">PV /dev/sdd</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">VG vg33 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lvm2 [408.00 MB / 408.00 MB free]</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">PV /dev/sda2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">VG VolGroup00 lvm2 [15.88 GB / 0 &nbsp;&nbsp;&nbsp;free]</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">PV /dev/sdb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">lvm2 [409.60 MB]</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Total: 4 [17.</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">07 GB] / in use: 3 [16.67 GB] / in no VG: 1 [409.60 MB]</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">[root@RHEL5 ~]#</span></p></td><td style="vertical-align:top;"></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4039"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4040"></a>12.8.4. pvdisplay</span></h3></li></ul>
<h4><a name="bookmark4041"></a><span class="font25"><a name="bookmark4042"></a><a name="bookmark4043"></a>Use </span><span class="font25" style="font-weight:bold;">pvdisplay </span><span class="font25">to get more information about physical volumes. You can also use </span><span class="font25" style="font-weight:bold;">pvdisplay </span><span class="font25">without an argument to display information about all physical (lvm) volumes.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# pvdisplay /dev/sda2</span></p>
<p><span class="font19">--- Physical volume ---</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">PV Name VG Name PV Size Allocatable PE Size (KByte) Total PE Free PE Allocated PE PV UUID</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/dev/sda2 VolGroup00</span></p>
<p><span class="font19">15.90 GB / not usable 20.79 MB yes (but full) 32768 508 0 508</span></p>
<p><span class="font19">TobYfp-Ggg0-Rf8r-xtLd-5XgN-RSPc-8vkTHD</span></p></td></tr>
</table>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4044"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3078"></a><a name="bookmark4045"></a>12.9. verifying existing volume groups</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark4046"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4047"></a>12.9.1. vgs</span></h3></li></ul></li></ul>
<p><a name="bookmark4048"></a><span class="font25">Similar to </span><span class="font25" style="font-weight:bold;">pvs </span><span class="font25">is the use of </span><span class="font25" style="font-weight:bold;">vgs </span><span class="font25">to display a quick overview of all volume groups. There is only one volume group in the screenshot below, it is named VolGroup00 and is almost 16GB in size.</span></p>
<p><span class="font19">[root@RHEL5 ~]# vgs</span></p>
<p><span class="font19">VG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#PV #LV #SN Attr VSize VFree</span></p>
<p><span class="font19">VolGroup00 1 &nbsp;&nbsp;2 &nbsp;&nbsp;0 wz--n- 15.88G &nbsp;&nbsp;&nbsp;0</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4049"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4050"></a>12.9.2. vgscan</span></h3></li></ul>
<p><a name="bookmark4051"></a><span class="font25"><a name="bookmark4052"></a>The </span><span class="font25" style="font-weight:bold;">vgscan </span><span class="font25">command will scan all disks for existing Volume Groups. It will also update the </span><span class="font25" style="font-weight:bold;">/etc/lvm/.cache </span><span class="font25">file. This file contains a list of all current lvm devices.</span></p>
<p><span class="font19">[root@RHEL5 ~]# vgscan</span></p>
<p><span class="font19">Reading all physical volumes. This may take a while...</span></p>
<p><span class="font19">Found volume group &quot;VolGroup00&quot; using metadata type lvm2 [root@RHEL5 ~]#</span></p>
<p><span class="font25">LVM will run the vgscan automatically at boot-up, so if you add hot swap devices, then you will need to run vgscan to update /etc/lvm/.cache with the new devices.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4053"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4054"></a>12.9.3. vgdisplay</span></h3></li></ul>
<p><a name="bookmark4055"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">vgdisplay </span><span class="font25">command will give you more detailed information about a volume group (or about all volume groups if you omit the argument).</span></p>
<p><span class="font19">[root@RHEL5 ~]# vgdisplay VolGroup00</span></p>
<p><span class="font19">--- Volume group ---</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">VG Name</span></p></td><td style="vertical-align:top;">
<p><span class="font19">VolGroup00</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">System ID</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Format</span></p></td><td style="vertical-align:top;">
<p><span class="font19">lvm2</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Metadata Areas</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Metadata Sequence No</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">VG Access</span></p></td><td style="vertical-align:top;">
<p><span class="font19">read/write</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">VG Status</span></p></td><td style="vertical-align:top;">
<p><span class="font19">resizable</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">MAX LV</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Cur LV</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Open LV</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Max PV</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Cur PV</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Act PV</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">VG Size</span></p></td><td style="vertical-align:top;">
<p><span class="font19">15.88 GB</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">PE Size</span></p></td><td style="vertical-align:top;">
<p><span class="font19">32.00 MB</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Total PE</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">508</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Alloc PE / Size</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">508 / 15.88 GB</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Free PE / Size</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0 / 0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">VG UUID</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">qsXvJb-71qV-9l7U-ishX-FobM-qptE-VXmKIg</span></p></td></tr>
</table>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4056"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3079"></a><a name="bookmark4057"></a>12.10. verifying existing logical volumes</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark4058"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4059"></a>12.10.1. lvs</span></h3></li></ul></li></ul>
<h4><a name="bookmark4060"></a><span class="font25"><a name="bookmark4061"></a><a name="bookmark4062"></a>Use </span><span class="font25" style="font-weight:bold;">lvs </span><span class="font25">for a quick look at all existing logical volumes. Below you can see two logical volumes named LogVol00 and LogVol01.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# lvs</span></p>
<p><span class="font19">LV &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Attr LSize Origin Snap% Move Log Copy%</span></p>
<p><span class="font19">LogVolOO VolGroupOO -wi-ao 14.88G</span></p>
<p><span class="font19">LogVolOl VolGroup00 -wi-ao 1.00G</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4063"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4064"></a>12.10.2. lvscan</span></h3></li></ul>
<h4><a name="bookmark4065"></a><span class="font25"><a name="bookmark4066"></a><a name="bookmark4067"></a>The </span><span class="font25" style="font-weight:bold;">lvscan </span><span class="font25">command will scan all disks for existing Logical Volumes.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# lvscan</span></p>
<p><span class="font19">ACTIVE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'/dev/VolGroup00/LogVol00' [14.88 GB] inherit</span></p>
<p><span class="font19">ACTIVE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'/dev/VolGroup00/LogVol01' [1.00 GB] inherit</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4068"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4069"></a>12.10.3. lvdisplay</span></h3></li></ul>
<h4><a name="bookmark4070"></a><span class="font25"><a name="bookmark4071"></a><a name="bookmark4072"></a>More detailed information about logical volumes is available through the </span><span class="font25" style="font-weight:bold;">lvdisplay(1) </span><span class="font25">command.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# lvdisplay VolGroup00/LogVol01</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">--- Logical volume -LV Name</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">—</span></p>
<p><span class="font19">/dev/VolGroup00/LogVol01</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">VG Name</span></p></td><td style="vertical-align:top;">
<p><span class="font19">VolGroupOO</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">LV UUID</span></p>
<p><span class="font19">LV Write Access</span></p></td><td style="vertical-align:top;">
<p><span class="font19">RnTGK6-xWsi-t530-ksJx-7cax-co5c-A1KlDp read/write</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">LV Status # open LV Size</span></p></td><td style="vertical-align:top;">
<p><span class="font19">available</span></p>
<p><span class="font19">1</span></p>
<p><span class="font19">1.00 GB</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Current LE</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">32</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Segments Allocation Read ahead sectors Block device</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1 inherit</span></p>
<p><span class="font19">0</span></p>
<p><span class="font19">253:1</span></p></td></tr>
</table>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4073"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3080"></a><a name="bookmark4074"></a>12.11. manage physical volumes</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark4075"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4076"></a>12.11.1. pvcreate</span></h3></li></ul></li></ul>
<h4><a name="bookmark4077"></a><span class="font25"><a name="bookmark4078"></a><a name="bookmark4079"></a>Use the </span><span class="font25" style="font-weight:bold;">pvcreate </span><span class="font25">command to add devices to lvm. This example shows how to add a disk (or hardware RAID device) to lvm.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# pvcreate /dev/sdb</span></p>
<p><span class="font19">Physical volume &quot;/dev/sdb&quot; successfully created [root@RHEL5 ~]#</span></p>
<h4><a name="bookmark4080"></a><span class="font25"><a name="bookmark4081"></a>This example shows how to add a partition to lvm.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# pvcreate /dev/sdc1</span></p>
<p><span class="font19">Physical volume &quot;/dev/sdc1&quot; successfully created [root@RHEL5 ~]#</span></p>
<h4><a name="bookmark4082"></a><span class="font25"><a name="bookmark4083"></a>You can also add multiple disks or partitions as target to pvcreate. This example adds three disks to lvm.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# pvcreate /dev/sde /dev/sdf /dev/sdg</span></p>
<p><span class="font19">Physical volume &quot;/dev/sde&quot; successfully created</span></p>
<p><span class="font19">Physical volume &quot;/dev/sdf&quot; successfully created</span></p>
<p><span class="font19">Physical volume &quot;/dev/sdg&quot; successfully created</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4084"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4085"></a>12.11.2. pvremove</span></h3></li></ul>
<h4><a name="bookmark4086"></a><span class="font25"><a name="bookmark4087"></a><a name="bookmark4088"></a>Use the </span><span class="font25" style="font-weight:bold;">pvremove </span><span class="font25">command to remove physical volumes from lvm. The devices may not be in use.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# pvremove /dev/sde /dev/sdf /dev/sdg</span></p>
<p><span class="font19">Labels on physical volume &quot;/dev/sde&quot; successfully wiped</span></p>
<p><span class="font19">Labels on physical volume &quot;/dev/sdf&quot; successfully wiped</span></p>
<p><span class="font19">Labels on physical volume &quot;/dev/sdg&quot; successfully wiped [root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4089"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4090"></a>12.11.3. pvresize</span></h3></li></ul>
<h4><a name="bookmark4091"></a><span class="font25"><a name="bookmark4092"></a><a name="bookmark4093"></a>When you used fdisk to resize a partition on a disk, then you must use </span><span class="font25" style="font-weight:bold;">pvresize </span><span class="font25">to make lvm recognize the new size of the physical volume that represents this partition.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# pvresize /dev/sde1</span></p>
<p><span class="font19">Physical volume &quot;/dev/sde1&quot; changed</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">1 physical volume(s) resized / 0 physical volume(s) not resized</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4094"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4095"></a>12.11.4. pvchange</span></h3></li></ul>
<h4><a name="bookmark4096"></a><span class="font25"><a name="bookmark4097"></a><a name="bookmark4098"></a>With </span><span class="font25" style="font-weight:bold;">pvchange </span><span class="font25">you can prevent the allocation of a Physical Volume in a new Volume Group or Logical Volume. This can be useful if you plan to remove a Physical Volume.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# pvchange -xn /dev/sdd</span></p>
<p><span class="font19">Physical volume &quot;/dev/sdd&quot; changed</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">1 physical volume changed / 0 physical volumes not changed [root@RHEL5 ~]#</span></p></li></ul>
<h4><a name="bookmark4099"></a><span class="font25"><a name="bookmark4100"></a>To revert your previous decision, this example shows you how te re-enable the Physical Volume to allow allocation.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# pvchange -xy /dev/sdd</span></p>
<p><span class="font19">Physical volume &quot;/dev/sdd&quot; changed</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">1 physical volume changed / 0 physical volumes not changed [root@RHEL5 ~]#</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4101"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4102"></a>12.11.5. pvmove</span></h3></li></ul>
<h4><a name="bookmark4103"></a><span class="font25"><a name="bookmark4104"></a><a name="bookmark4105"></a>With </span><span class="font25" style="font-weight:bold;">pvmove </span><span class="font25">you can move Logical Volumes from within a Volume Group to another Physical Volume. This must be done before removing a Physical Volume.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# pvs | grep vg1</span></p>
<p><span class="font19">/dev/sdf vg1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lvm2 a- 816.00M &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span></p>
<p><span class="font19">/dev/sdg vg1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lvm2 a- 816.00M 816.00M</span></p>
<p><span class="font19">[root@RHEL5 ~]# pvmove /dev/sdf</span></p>
<p><span class="font19">/dev/sdf: Moved: 70.1%</span></p>
<p><span class="font19">/dev/sdf: Moved: 100.0%</span></p>
<p><span class="font19">[root@RHEL5 ~]# pvs | grep vg1</span></p>
<p><span class="font19">/dev/sdf vg1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lvm2 a- 816.00M 816.00M</span></p>
<p><span class="font19">/dev/sdg vg1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lvm2 a- 816.00M &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4106"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3081"></a><a name="bookmark4107"></a>12.12. manage volume groups</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark4108"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4109"></a>12.12.1. vgcreate</span></h3></li></ul></li></ul>
<h4><a name="bookmark4110"></a><span class="font25"><a name="bookmark4111"></a><a name="bookmark4112"></a>Use the </span><span class="font25" style="font-weight:bold;">vgcreate </span><span class="font25">command to create a volume group. You can immediately name all the physical volumes that span the volume group.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# vgcreate vg42 /dev/sde /dev/sdf</span></p>
<p><span class="font19">Volume group &quot;vg42&quot; successfully created</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4113"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4114"></a>12.12.2. vgextend</span></h3></li></ul>
<h4><a name="bookmark4115"></a><span class="font25"><a name="bookmark4116"></a><a name="bookmark4117"></a>Use the </span><span class="font25" style="font-weight:bold;">vgextend </span><span class="font25">command to extend an existing volume group with a physical volume.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# vgextend vg42 /dev/sdg</span></p>
<p><span class="font19">Volume group &quot;vg42&quot; successfully extended</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4118"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4119"></a>12.12.3. vgremove</span></h3></li></ul>
<h4><a name="bookmark4120"></a><span class="font25"><a name="bookmark4121"></a><a name="bookmark4122"></a>Use the </span><span class="font25" style="font-weight:bold;">vgremove </span><span class="font25">command to remove volume groups from lvm. The volume groups may not be in use.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# vgremove vg42</span></p>
<p><span class="font19">Volume group &quot;vg42&quot; successfully removed</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4123"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4124"></a>12.12.4. vgreduce</span></h3></li></ul>
<h4><a name="bookmark4125"></a><span class="font25"><a name="bookmark4126"></a><a name="bookmark4127"></a>Use the </span><span class="font25" style="font-weight:bold;">vgreduce </span><span class="font25">command to remove a Physical Volume from the Volume Group.</span></h4>
<h4><a name="bookmark4128"></a><span class="font25"><a name="bookmark4129"></a>The following example adds Physical Volume /dev/sdg to the vg1 Volume Group using vgextend. And then removes it again using vgreduce.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# pvs | grep sdg</span></p>
<p><span class="font19">/dev/sdg &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lvm2 -- &nbsp;&nbsp;819.20M 819.20M</span></p>
<p><span class="font19">[root@RHEL5 ~]# vgextend vg1 /dev/sdg</span></p>
<p><span class="font19">Volume group &quot;vg1&quot; successfully extended</span></p>
<p><span class="font19">[root@RHEL5 ~]# pvs | grep sdg</span></p>
<p><span class="font19">/dev/sdg vg1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lvm2 a- 816.00M 816.00M</span></p>
<p><span class="font19">[root@RHEL5 ~]# vgreduce vg1 /dev/sdg</span></p>
<p><span class="font19">Removed &quot;/dev/sdg&quot; from volume group &quot;vg1&quot;</span></p>
<p><span class="font19">[root@RHEL5 ~]# pvs | grep sdg</span></p>
<p><span class="font19">/dev/sdg &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lvm2 -- &nbsp;&nbsp;819.20M 819.20M</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4130"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4131"></a>12.12.5. vgchange</span></h3></li></ul>
<h4><a name="bookmark4132"></a><span class="font25"><a name="bookmark4133"></a><a name="bookmark4134"></a>Use the </span><span class="font25" style="font-weight:bold;">vgchange </span><span class="font25">command to change parameters of a Volume Group.</span></h4>
<h4><a name="bookmark4135"></a><span class="font25"><a name="bookmark4136"></a>This example shows how to prevent Physical Volumes from being added or removed to the Volume Group vg1.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# vgchange -xn vg1</span></p>
<p><span class="font19">Volume group &quot;vgl&quot; successfully changed</span></p>
<p><span class="font19">[root@RHEL5 ~]# vgextend vg1 /dev/sdg</span></p>
<p><span class="font19">Volume group vg1 is not resizable.</span></p>
<h4><a name="bookmark4137"></a><span class="font25"><a name="bookmark4138"></a>You can also use vgchange to change most other properties of a Volume Group. This example changes the maximum number of Logical Volumes and maximum number of Physical Volumes that vg1 can serve.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# vgdisplay vg1 | grep -i max</span></p>
<p><span class="font19">MAX LV &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span></p>
<p><span class="font19">Max PV &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span></p>
<p><span class="font19">[root@RHEL5 ~]# vgchange -l16 vg1</span></p>
<p><span class="font19">Volume group &quot;vg1&quot; successfully changed</span></p>
<p><span class="font19">[root@RHEL5 ~]# vgchange -p8 vg1</span></p>
<p><span class="font19">Volume group &quot;vg1&quot; successfully changed</span></p>
<p><span class="font19">[root@RHEL5 ~]# vgdisplay vg1 | grep -i max MAX LV &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;16</span></p>
<p><span class="font19">Max PV &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4139"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4140"></a>12.12.6. vgmerge</span></h3></li></ul>
<h4><a name="bookmark4141"></a><span class="font25"><a name="bookmark4142"></a><a name="bookmark4143"></a>Merging two Volume Groups into one is done with </span><span class="font25" style="font-weight:bold;">vgmerge</span><span class="font25">. The following example merges vg2 into vg1, keeping all the properties of vg1.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# vgmerge vg1 vg2</span></p>
<p><span class="font19">Volume group &quot;vg2&quot; successfully merged into &quot;vg1&quot;</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4144"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3082"></a><a name="bookmark4145"></a>12.13. manage logical volumes</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark4146"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4147"></a>12.13.1. lvcreate</span></h3></li></ul></li></ul>
<h4><a name="bookmark4148"></a><span class="font25"><a name="bookmark4149"></a><a name="bookmark4150"></a>Use the </span><span class="font25" style="font-weight:bold;">lvcreate </span><span class="font25">command to create Logical Volumes in a Volume Group. This example creates an 8GB Logical Volume in Volume Group vg42.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# lvcreate -L5G vg42</span></p>
<p><span class="font19">Logical volume &quot;lvol0&quot; created</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<h4><a name="bookmark4151"></a><span class="font25"><a name="bookmark4152"></a><a name="bookmark4153"></a>As you can see, lvm automatically names the Logical Volume </span><span class="font25" style="font-weight:bold;">lvol0</span><span class="font25">. The next example creates a 200MB Logical Volume named MyLV in Volume Group vg42.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# lvcreate -L200M -nMyLV vg42</span></p>
<p><span class="font19">Logical volume &quot;MyLV&quot; created</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<h4><a name="bookmark4154"></a><span class="font25"><a name="bookmark4155"></a>The next example does the same thing, but with different syntax.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# lvcreate --size 200M -n MyLV vg42 Logical volume &quot;MyLV&quot; created</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<h4><a name="bookmark4156"></a><span class="font25"><a name="bookmark4157"></a>This example creates a Logical Volume that occupies 10 percent of the Volume Group.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# lvcreate -l 10%VG -n MyLV2 vg42 Logical volume &quot;MyLV2&quot; created</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<h4><a name="bookmark4158"></a><span class="font25"><a name="bookmark4159"></a>This example creates a Logical Volume that occupies 30 percent of the remaining free space in the Volume Group.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# lvcreate -l 30%FREE -n MyLV3 vg42</span></p>
<p><span class="font19">Logical volume &quot;MyLV3&quot; created</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4160"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4161"></a>12.13.2. lvremove</span></h3></li></ul>
<h4><a name="bookmark4162"></a><span class="font25"><a name="bookmark4163"></a><a name="bookmark4164"></a>Use the </span><span class="font25" style="font-weight:bold;">lvremove </span><span class="font25">command to remove Logical Volumes from a Volume Group. Removing a Logical Volume requires the name of the Volume Group.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# lvremove vg42/MyLV</span></p>
<p><span class="font19">Do you really want to remove active logical volume &quot;MyLV&quot;? [y/n]: y Logical volume &quot;MyLV&quot; successfully removed [root@RHEL5 ~]#</span></p>
<h4><a name="bookmark4165"></a><span class="font25"><a name="bookmark4166"></a>Removing multiple Logical Volumes will request confirmation for each individual volume.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# lvremove vg42/MyLV vg42/MyLV2 vg42/MyLV3</span></p>
<p><span class="font19">Do you really want to remove active logical volume &quot;MyLV&quot;? [y/n]: y Logical volume &quot;MyLV&quot; successfully removed</span></p>
<p><span class="font19">Do you really want to remove active logical volume &quot;MyLV2&quot;? [y/n]: y Logical volume &quot;MyLV2&quot; successfully removed</span></p>
<p><span class="font19">Do you really want to remove active logical volume &quot;MyLV3&quot;? [y/n]: y Logical volume &quot;MyLV3&quot; successfully removed [root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4167"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4168"></a>12.13.3. lvextend</span></h3></li></ul>
<h4><a name="bookmark4169"></a><span class="font25"><a name="bookmark4170"></a><a name="bookmark4171"></a>Extending the volume is easy with </span><span class="font25" style="font-weight:bold;">lvextend</span><span class="font25">. This example extends a 200MB Logical</span><br><br><span class="font25"><a name="bookmark4172"></a>Volume with 100 MB.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# lvdisplay /dev/vg2/lvol0 | grep Size</span></p>
<p><span class="font19">LV Size &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;200.00 MB</span></p>
<p><span class="font19">[root@RHEL5 ~]# lvextend -L +100 /dev/vg2/lvol0</span></p>
<p><span class="font19">Extending logical volume lvol0 to 300.00 MB</span></p>
<p><span class="font19">Logical volume lvol0 successfully resized</span></p>
<p><span class="font19">[root@RHEL5 ~]# lvdisplay /dev/vg2/lvol0 | grep Size</span></p>
<p><span class="font19">LV Size &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;300.00 MB</span></p>
<h4><a name="bookmark4173"></a><span class="font25"><a name="bookmark4174"></a>The next example creates a 100MB Logical Volume, and then extends it to 500MB.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# lvcreate --size 100M -n extLV vg42</span></p>
<p><span class="font19">Logical volume &quot;extLV&quot; created</span></p>
<p><span class="font19">[root@RHEL5 ~]# lvextend -L 500M vg42/extLV</span></p>
<p><span class="font19">Extending logical volume extLV to 500.00 MB</span></p>
<p><span class="font19">Logical volume extLV successfully resized [root@RHEL5 ~]#</span></p>
<h4><a name="bookmark4175"></a><span class="font25"><a name="bookmark4176"></a>This example doubles the size of a Logical Volume.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# lvextend -l+100%LV vg42/extLV</span></p>
<p><span class="font19">Extending logical volume extLV to 1000.00 MB</span></p>
<p><span class="font19">Logical volume extLV successfully resized</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4177"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4178"></a>12.13.4. lvrename</span></h3></li></ul>
<h4><a name="bookmark4179"></a><span class="font25"><a name="bookmark4180"></a><a name="bookmark4181"></a>Renaming a Logical Volume is done with </span><span class="font25" style="font-weight:bold;">lvrename</span><span class="font25">. This example renames extLV to bigLV in the vg42 Volume Group.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# lvrename vg42/extLV vg42/bigLV</span></p>
<p><span class="font19">Renamed &quot;extLV&quot; to &quot;bigLV&quot; in volume group &quot;vg42&quot; [root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4182"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3083"></a><a name="bookmark4183"></a>12.14. practice : lvm</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create a volume group that contains a complete disk and a partition on another disk.</span></p></li>
<li>
<p><span class="font25">2. Create two logical volumes (a small one and a bigger one) in this volumegroup. Format them wih ext3, mount them and copy some files to them.</span></p></li>
<li>
<p><span class="font25">3. Verify usage with fdisk, mount, pvs, vgs, lvs, pvdisplay, vgdisplay, lvdisplay and df. Does fdisk give you any information about lvm?</span></p></li>
<li>
<p><span class="font25">4. Enlarge the small logical volume by 50 percent, and verify your work!</span></p></li>
<li>
<p><span class="font25">5. Take a look at other commands that start with vg* , pv* or lv*.</span></p></li>
<li>
<p><span class="font25">6. Create a mirror and a striped Logical Volume.</span></p></li>
<li>
<p><span class="font25">7. Convert a linear logical volume to a mirror.</span></p></li>
<li>
<p><span class="font25">8. Convert a mirror logical volume to a linear.</span></p></li>
<li>
<p><span class="font25">9. Create a snapshot of a Logical Volume, take a backup of the snapshot. Then delete some files on the Logical Volume, then restore your backup.</span></p></li>
<li>
<p><span class="font25">10. Move your volume group to another disk (keep the Logical Volumes mounted).</span></p></li>
<li>
<p><span class="font25">11. If time permits, split a Volume Group with vgsplit, then merge it again with vgmerge.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4184"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3084"></a><a name="bookmark4185"></a>12.15. solution : lvm</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark4186"></a><span class="font25"><a name="bookmark4187"></a>1. Create a volume group that contains a complete disk and a partition on another disk.</span><br><br><span class="font25"><a name="bookmark4188"></a>step 1: select disks:</span></h4>
<p><span class="font19">root@rhel65:~# </span><span class="font19" style="font-weight:bold;">fdisk -l | grep Disk</span></p></li></ul>
<p><span class="font19">Disk /dev/sda: 8589 MB, 8589934592 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00055ca0</span></p>
<p><span class="font19">Disk /dev/sdb: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdc: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<h4><a name="bookmark4189"></a><span class="font25"><a name="bookmark4190"></a>I choose /dev/sdb and /dev/sdc for now.</span><br><br><span class="font25"><a name="bookmark4191"></a>step 2: partition /dev/sdc</span></h4>
<p><span class="font19">root@rhel65:~# </span><span class="font19" style="font-weight:bold;">fdisk /dev/sdc</span></p>
<p><span class="font19">Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disk\ label</span></p>
<p><span class="font19">Building a new DOS disklabel with disk identifier 0x94c0e5d5.</span></p>
<p><span class="font19">Changes will remain in memory only, until you decide to write them. After that, of course, the previous content won't be recoverable.</span></p>
<p><span class="font19">Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)</span></p>
<p><span class="font19">WARNING: DOS-compatible mode is deprecated. It's strongly recommended to switch off the mode (command 'c') and change display units to sectors (command 'u').</span></p>
<p><span class="font19">Command (m for help): </span><span class="font19" style="font-weight:bold;">n </span><span class="font19">Command action e extended p primary partition (1-4)</span></p>
<p><span class="font19" style="font-weight:bold;">P</span></p>
<p><span class="font19">Partition number (1-4): </span><span class="font19" style="font-weight:bold;">1</span></p>
<p><span class="font19">First cylinder (1-130, default 1):</span></p>
<p><span class="font19">Using default value 1</span></p>
<p><span class="font19">Last cylinder, +cylinders or +size{K,M,G} (1-130, default 130):</span></p>
<p><span class="font19">Using default value 130</span></p>
<p><span class="font19">Command (m for help): </span><span class="font19" style="font-weight:bold;">w</span></p>
<p><span class="font19">The partition table has been altered!</span></p>
<p><span class="font19">Calling ioctl() to re-read partition table.</span></p>
<p><span class="font19">Syncing disks.</span></p>
<h4><a name="bookmark4192"></a><span class="font25"><a name="bookmark4193"></a>step 3: pvcreate and vgcreate</span></h4>
<p><span class="font19">root@rhel65:~# </span><span class="font19" style="font-weight:bold;">pvcreate /dev/sdb /dev/sdcl</span></p>
<p><span class="font19">Physical volume &quot;/dev/sdb&quot; successfully created</span></p>
<p><span class="font19">Physical volume &quot;/dev/sdc1&quot; successfully created</span></p>
<p><span class="font19">root@rhel65:~# </span><span class="font19" style="font-weight:bold;">vgcreate VG42 /dev/sdb /dev/sdcl</span></p>
<p><span class="font19">Volume group &quot;VG42&quot; successfully created</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark4194"></a><span class="font25"><a name="bookmark4195"></a>2. Create two logical volumes (a small one and a bigger one) in this volumegroup. Format them wih ext3, mount them and copy some files to them.</span></h4></li></ul>
<p><span class="font19">root@rhel65:~# </span><span class="font19" style="font-weight:bold;">lvcreate --size 200m --name LVsmall VG42</span></p>
<p><span class="font19">Logical volume &quot;LVsmall&quot; created root@rhel65:~# </span><span class="font19" style="font-weight:bold;">lvcreate --size 600m --name LVbig VG42</span></p>
<p><span class="font19">Logical volume &quot;LVbig&quot; created</span></p>
<p><span class="font19">root@rhel65:~# </span><span class="font19" style="font-weight:bold;">ls -l /dev/mapper/VG42-LVsmall </span><span class="font19">lrwxrwxrwx. 1 root root 7 Apr 20 20:41 /dev/mapper/VG42-LVsmall -&gt; ../dm-2 root@rhel65:~# </span><span class="font19" style="font-weight:bold;">ls -l /dev/VG42/LVsmall </span><span class="font19">lrwxrwxrwx. 1 root root 7 Apr 20 20:41 /dev/VG42/LVsmall -&gt; ../dm-2 root@rhel65:~# </span><span class="font19" style="font-weight:bold;">ls -l /dev/dm-2 </span><span class="font19">brw-rw----. 1 root disk 253, 2 Apr 20 20:41 /dev/dm-2</span></p>
<p><span class="font19">root@rhel65:~# </span><span class="font19" style="font-weight:bold;">mkfs.ext3 /dev/mapper/VG42-LVsmall </span><span class="font19">mke2fs 1.41.12 (17-May-2010) Filesystem label= OS type: Linux Block size=1024 (log=0) Fragment size=1024 (log=0) Stride=0 blocks, Stripe width=0 blocks 51200 inodes, 204800 blocks 10240 blocks (5.00%) reserved for the super user First data block=1</span></p>
<p><span class="font19">Maximum filesystem blocks=67371008 25 block groups 8192 blocks per group, 8192 fragments per group 2048 inodes per group Superblock backups stored on blocks: 8193, 24577, 40961, 57345, 73729</span></p>
<p><span class="font19">Writing inode tables: done Creating journal (4096 blocks): done Writing superblocks and filesystem accounting information: done</span></p>
<p><span class="font19">This filesystem will be automatically checked every 39 mounts or 180 days, whichever comes first. Use tune2fs -c or -i to override.</span></p>
<p><span class="font19">root@rhel65:~# </span><span class="font19" style="font-weight:bold;">mkfs.ext3 /dev/VG42/LVbig </span><span class="font19">mke2fs 1.41.12 (17-May-2010) Filesystem label= OS type: Linux</span></p>
<p><span class="font19">Block size=4096 (log=2)</span></p>
<p><span class="font19">Fragment size=4096 (log=2)</span></p>
<p><span class="font19">Stride=0 blocks, Stripe width=0 blocks 38400 inodes, 153600 blocks 7680 blocks (5.00%) reserved for the super user First data block=0 Maximum filesystem blocks=159383552 5 block groups 32768 blocks per group, 32768 fragments per group 7680 inodes per group Superblock backups stored on blocks: 32768, 98304</span></p>
<p><span class="font19">Writing inode tables: done Creating journal (4096 blocks): done Writing superblocks and filesystem accounting information: done</span></p>
<p><span class="font19">This filesystem will be automatically checked every 25 mounts or 180 days, whichever comes first. Use tune2fs -c or -i to override.</span></p>
<h4><a name="bookmark4196"></a><span class="font25"><a name="bookmark4197"></a>The mounting and copying of files.</span></h4>
<p><span class="font19">root@rhel65:~# mkdir /srv/LVsmall</span></p>
<p><span class="font19">root@rhel65:~# mkdir /srv/LVbig</span></p>
<p><span class="font19">root@rhel65:~# mount /dev/mapper/VG42-LVsmall /srv/LVsmall</span></p>
<p><span class="font19">root@rhel65:~# mount /dev/VG42/LVbig /srv/LVbig</span></p>
<p><span class="font19">root@rhel65:~# cp -r /etc /srv/LVsmall/</span></p>
<p><span class="font19">root@rhel65:~# cp -r /var/log /srv/LVbig/</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark4198"></a><span class="font25"><a name="bookmark4199"></a>3. Verify usage with fdisk, mount, pvs, vgs, lvs, pvdisplay, vgdisplay, lvdisplay and df. Does fdisk give you any information about lvm?</span></h4></li></ul>
<h4><a name="bookmark4200"></a><span class="font25"><a name="bookmark4201"></a>Run all those commands (only two are shown below), then answer 'no'.</span></h4>
<p><span class="font19">root@rhel65:~# df -h</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Filesystem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Used</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Avail</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Use%</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Mounted on</span></p></td></tr>
<tr><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">/dev/mapper/VolGroup-lv_root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">6.7G</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1.4G</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5.0G</span></p></td><td style="vertical-align:top;">
<p><span class="font19">21%</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">tmpfs &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;246M</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">246M</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0%</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/dev/shm</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sda1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;485M</span></p>
<p><span class="font19">/dev/mapper/VG42-LVsmall</span></p></td><td style="vertical-align:top;">
<p><span class="font19">77M</span></p></td><td style="vertical-align:top;">
<p><span class="font19">383M</span></p></td><td style="vertical-align:top;">
<p><span class="font19">17%</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/boot</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">194M</span></p>
<p><span class="font19">/dev/mapper/VG42-LVbig</span></p></td><td style="vertical-align:top;">
<p><span class="font19">30M</span></p></td><td style="vertical-align:top;">
<p><span class="font19">154M</span></p></td><td style="vertical-align:top;">
<p><span class="font19">17%</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/srv/LVsmall</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">591M</span></p>
<p><span class="font19">root@rhel65:~# </span><span class="font19" style="font-weight:bold;">mount | grep</span></p></td><td style="vertical-align:top;">
<p><span class="font19">20M</span></p>
<p><span class="font19" style="font-weight:bold;">VG4 2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">541M</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4%</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/srv/LVbig</span></p></td></tr>
</table>
<p><span class="font19">/dev/mapper/VG42-LVsmall on /srv/LVsmall type ext3 (rw) /dev/mapper/VG42-LVbig on /srv/LVbig type ext3 (rw)</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark4202"></a><span class="font25"><a name="bookmark4203"></a>4. Enlarge the small logical volume by 50 percent, and verify your work!</span></h4></li></ul>
<p><span class="font19">root@rhel65:~# </span><span class="font19" style="font-weight:bold;">lvextend VG42/LVsmall -l+50%LV</span></p>
<p><span class="font19">Extending logical volume LVsmall to 300.00 MiB</span></p>
<p><span class="font19">Logical volume LVsmall successfully resized</span></p>
<p><span class="font19">root@rhel65:~# </span><span class="font19" style="font-weight:bold;">resize2fs /dev/mapper/VG42-LVsmall</span></p>
<p><span class="font19">resize2fs 1.41.12 (17-May-2010)</span></p>
<p><span class="font19">Filesystem at /dev/mapper/VG42-LVsmall is mounted on /srv/LVsmall; on-line res\ izing required old desc_blocks = 1, new_desc_blocks = 2</span></p>
<p><span class="font19">Performing an on-line resize of /dev/mapper/VG42-LVsmall to 307200 (1k) blocks.</span></p>
<p><span class="font19">The filesystem on /dev/mapper/VG42-LVsmall is now 307200 blocks long.</span></p>
<p><span class="font19">root@rhel65:~# </span><span class="font19" style="font-weight:bold;">df -h | grep small</span></p>
<p><span class="font19">/dev/mapper/VG42-LVsmall</span></p>
<p><span class="font19">291M &nbsp;&nbsp;31M &nbsp;246M &nbsp;12% /srv/LVsmall</span></p>
<p><span class="font19">root@rhel65:~#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Take a look at other commands that start with vg* , pv* or lv*.</span></p></li>
<li>
<p><span class="font25">6. Create a mirror and a striped Logical Volume.</span></p></li>
<li>
<p><span class="font25">7. Convert a linear logical volume to a mirror.</span></p></li>
<li>
<p><span class="font25">8. Convert a mirror logical volume to a linear.</span></p></li>
<li>
<p><span class="font25">9. Create a snapshot of a Logical Volume, take a backup of the snapshot. Then delete some files on the Logical Volume, then restore your backup.</span></p></li>
<li>
<p><span class="font25">10. Move your volume group to another disk (keep the Logical Volumes mounted).</span></p></li>
<li>
<p><span class="font25">11. If time permits, split a Volume Group with vgsplit, then merge it again with vgmerge.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark4204"></a><span class="font11" style="font-weight:bold;"><a name="bookmark3085"></a><a name="bookmark4205"></a>Chapter 13. iSCSI devices</span></h1></li></ul>
<p><span class="font25">This chapter teaches you how to setup an </span><span class="font25" style="font-weight:bold;">iSCSI target server </span><span class="font25">and an </span><span class="font25" style="font-weight:bold;">iSCSI initiator client</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4206"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3086"></a><a name="bookmark4207"></a>13.1. iSCSI terminology</span></h2></li></ul>
<p><a name="bookmark4208"></a><span class="font25" style="font-weight:bold;">iSCSI </span><span class="font25">is a protocol that enables SCSI over IP. This means that you can have local SCSI devices (like /dev/sdb) without having the storage hardware in the local computer.</span></p>
<p><span class="font25">The computer holding the physical storage hardware is called the </span><span class="font25" style="font-weight:bold;">iSCSI Target</span><span class="font25">. Each individual addressable iSCSI device on the target server will get a </span><span class="font25" style="font-weight:bold;">LUN number</span><span class="font25">.</span></p>
<p><a name="bookmark4209"></a><span class="font25">The iSCSI client computer that is connecting to the Target server is called an </span><span class="font25" style="font-weight:bold;">Initiator</span><span class="font25">. An initiator will send SCSI commands over IP instead of directly to the hardware. The Initiator will connect to the Target.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4210"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3087"></a><a name="bookmark4211"></a>13.2. iSCSI Target in RHEL/CentOS</span></h2></li></ul>
<p><span class="font25">This section will describe iSCSI Target setup on RHEL6, RHEL7 and CentOS.</span></p>
<p><span class="font25">Start with installing the </span><span class="font25" style="font-weight:bold;">iSCSI Target </span><span class="font25">package.</span></p>
<p><span class="font19">yum install scsi-target-utils</span></p>
<p><span class="font25">We configure three local disks in </span><span class="font25" style="font-weight:bold;">/etc/tgt/targets.conf </span><span class="font25">to become three LUN's.</span></p>
<p><span class="font19">&lt;target iqn.2008-09.com.example:server.target2&gt;</span></p>
<p><span class="font19">direct-store /dev/sdb</span></p>
<p><span class="font19">direct-store /dev/sdc</span></p>
<p><span class="font19">direct-store /dev/sdd</span></p>
<p><span class="font19">incominguser paul hunter2</span></p>
<p><span class="font19">&lt;/target&gt;</span></p>
<p><span class="font25">Restart the service.</span></p>
<p><span class="font19">[root@centos65 ~]# service tgtd start Starting SCSI target daemon:</span></p>
<div>
<p><span class="font19">[ OK ]</span></p>
</div><br clear="all">
<p><span class="font25">The standard local port for iSCSI Target is 3260, in case of doubt you can verify this with </span><span class="font25" style="font-weight:bold;">netstat</span><span class="font25">.</span></p>
<p><span class="font19">[root@server1 tgt]# netstat -ntpl | grep tgt</span></p>
<p><span class="font19">tcp &nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;0 0.0.0.0:3260 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0:* &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LISTEN &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1670/tgtd</span></p>
<p><span class="font19">tcp &nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;0 :::3260 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:::* &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LISTEN &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1670/tgtd</span></p>
<h4><a name="bookmark4212"></a><span class="font25"><a name="bookmark4213"></a>The </span><span class="font25" style="font-weight:bold;">tgt-admin -s </span><span class="font25">command should now give you a nice overview of the three LUN's (and also LUN 0 for the controller).</span></h4>
<p><span class="font19">[root@server1 tgt]# tgt-admin -s</span></p>
<p><span class="font19">Target 1: iqn.2014-04.be.linux-training:server1.target1</span></p>
<p><span class="font19">System information: Driver: iscsi State: ready I_T nexus information: LUN information: LUN: 0</span></p>
<p><span class="font19">Type: controller SCSI ID: IET 00010000 SCSI SN: beaf10</span></p>
<p><span class="font19">Size: 0 MB, Block size: 1 Online: Yes Removable media: No Prevent removal: No Readonly: No Backing store type: null Backing store path: None Backing store flags: LUN: 1</span></p>
<p><span class="font19">Type: disk</span></p>
<p><span class="font19">SCSI ID: IET 00010001</span></p>
<p><span class="font19">SCSI SN: VB9f23197b-af6cfb60</span></p>
<p><span class="font19">Size: 1074 MB, Block size: 512 Online: Yes Removable media: No Prevent removal: No Readonly: No Backing store type: rdwr Backing store path: /dev/sdb Backing store flags:</span></p>
<p><span class="font19">LUN: 2</span></p>
<p><span class="font19">Type: disk</span></p>
<p><span class="font19">SCSI ID: IET 00010002 SCSI SN: VB8f554351-a1410828 Size: 1074 MB, Block size: 512 Online: Yes Removable media: No Prevent removal: No Readonly: No Backing store type: rdwr Backing store path: /dev/sdc Backing store flags: LUN: 3</span></p>
<p><span class="font19">Type: disk</span></p>
<p><span class="font19">SCSI ID: IET 00010003 SCSI SN: VB1035d2f0-7ae90b49</span></p>
<p><span class="font19">Size: 1074 MB, Block size: 512 Online: Yes Removable media: No Prevent removal: No Readonly: No Backing store type: rdwr Backing store path: /dev/sdd Backing store flags: Account information: ACL information:</span></p>
<p><span class="font19">ALL</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4214"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3088"></a><a name="bookmark4215"></a>13.3. iSCSI Initiator in RHEL/CentOS</span></h2></li></ul>
<h4><a name="bookmark4216"></a><span class="font25"><a name="bookmark4217"></a>This section will describe iSCSI Initiator setup on RHEL6, RHEL7 and CentOS.</span><br><br><span class="font25"><a name="bookmark4218"></a>Start with installing the </span><span class="font25" style="font-weight:bold;">iSCSI Initiator </span><span class="font25">package.</span></h4>
<p><span class="font19">[root@server2 ~]# yum install iscsi-initiator-utils</span></p>
<h4><a name="bookmark4219"></a><span class="font25"><a name="bookmark4220"></a>Then ask the </span><span class="font25" style="font-weight:bold;">iSCSI target server </span><span class="font25">to send you the target names.</span></h4>
<p><span class="font19">[root@server2 ~]# iscsiadm -m discovery -t sendtargets -p 192.168.1.95:3260 Starting iscsid: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p>
<p><span class="font19">192.168.1.95:3260,1 iqn.2014-04.be.linux-training:centos65.target1</span></p>
<p><span class="font25">We received </span><span class="font25" style="font-weight:bold;">iqn.2014-04.be.linux-training:centos65.target1</span><span class="font25">.</span></p>
<h4><a name="bookmark4221"></a><span class="font25"><a name="bookmark4222"></a>We use this iqn to configure the username and the password (paul and hunter2) that we set on the target server.</span></h4>
<p><span class="font19">[root@server2 iscsi]# iscsiadm -m node --targetname iqn.2014-04.be.linux-tra\ ining:centos65.target1 --portal &quot;192.168.1.95:3260&quot; --op=update --name node.\ session.auth.username --value=paul</span></p>
<p><span class="font19">[root@server2 iscsi]# iscsiadm -m node --targetname iqn.2014-04.be.linux-tra\ ining:centos65.target1 --portal &quot;192.168.1.95:3260&quot; --op=update --name node.\ session.auth.password --value=hunter2</span></p>
<p><span class="font19">[root@server2 iscsi]# iscsiadm -m node --targetname iqn.2014-04.be.linux-tra\ ining:centos65.target1 --portal &quot;192.168.1.95:3260&quot; --op=update --name node.\ session.auth.authmethod --value=CHAP</span></p>
<h4><a name="bookmark4223"></a><span class="font25"><a name="bookmark4224"></a>RHEL and CentOS will store these in </span><span class="font25" style="font-weight:bold;">/var/lib/iscsi/nodes/</span><span class="font25">.</span></h4>
<p><span class="font19">[root@server2 iscsi]# grep auth /var/lib/iscsi/nodes/iqn.2014-04.be.linux-tr\ aining\:centos65.target1/192.168.1.95\,3260\,1/default node.session.auth.authmethod = CHAP node.session.auth.username = paul node.session.auth.password = hunter2 node.conn[0].timeo.auth_timeout = 45 [root@server2 iscsi]#</span></p>
<h4><a name="bookmark4225"></a><span class="font25"><a name="bookmark4226"></a>A restart of the </span><span class="font25" style="font-weight:bold;">iscsi </span><span class="font25">service will add three new devices to our system.</span></h4>
<p><span class="font19">[root@server2 iscsi]# fdisk -l | grep Disk</span></p>
<p><span class="font19">Disk /dev/sda: 42.9 GB, 42949672960 bytes</span></p>
<p><span class="font19">Disk identifier: 0x0004f229</span></p>
<p><span class="font19">Disk /dev/sdb: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdc: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdd: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sde: 2147 MB, 2147483648 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdf: 2147 MB, 2147483648 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdg: 2147 MB, 2147483648 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/mapper/VolGroup-lv_root: 41.4 GB, 41448112128 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/mapper/VolGroup-lv_swap: 973 MB, 973078528 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">[root@server2 iscsi]# service iscsi restart</span></p>
<p><span class="font19">Stopping iscsi: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p>
<p><span class="font19">Starting iscsi: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p>
<p><span class="font19">[root@server2 iscsi]# fdisk -l | grep Disk</span></p>
<p><span class="font19">Disk /dev/sda: 42.9 GB, 42949672960 bytes</span></p>
<p><span class="font19">Disk identifier: 0x0004f229</span></p>
<p><span class="font19">Disk /dev/sdb: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdc: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdd: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sde: 2147 MB, 2147483648 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdf: 2147 MB, 2147483648 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdg: 2147 MB, 2147483648 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/mapper/VolGroup-lv_root: 41.4 GB, 41448112128 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/mapper/VolGroup-lv_swap: 973 MB, 973078528 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdh: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdi: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdj: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<h4><a name="bookmark4227"></a><span class="font25"><a name="bookmark4228"></a>You can verify iscsi status with:</span></h4>
<p><span class="font19">service iscsi status</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4229"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3089"></a><a name="bookmark4230"></a>13.4. iSCSI target on Debian</span></h2></li></ul>
<h4><a name="bookmark4231"></a><span class="font25"><a name="bookmark4232"></a>Installing the software for the target server requires </span><span class="font25" style="font-weight:bold;">iscsitarget </span><span class="font25">on Ubuntu and Debian, and an extra </span><span class="font25" style="font-weight:bold;">iscsitarget-dkms </span><span class="font25">for the kernel modules only on Debian.</span></h4>
<p><span class="font19">root@debby6:~# aptitude install iscsitarget</span></p>
<p><span class="font19">The following NEW packages will be installed: iscsitarget</span></p>
<p><span class="font19">0 packages upgraded, 1 newly installed, 0 to remove and 0 not upgraded.</span></p>
<p><span class="font19">Need to get 69.4 kB of archives. After unpacking 262 kB will be used.</span></p>
<p><span class="font19">Get:1 </span><a href="http://ftp.belnet.be/debian/"><span class="font19">http://ftp.belnet.be/debian/</span></a><span class="font19"> squeeze/main iscsitarget i386 1.4.20.2-1\ [69.4 kB]</span></p>
<p><span class="font19">Fetched 69.4 kB in 0s (415 kB/s)</span></p>
<p><span class="font19">Selecting previously deselected package iscsitarget.</span></p>
<p><span class="font19">(Reading database ... 36441 files and directories currently installed.)</span></p>
<p><span class="font19">Unpacking iscsitarget (from .../iscsitarget_1.4.20.2-1_i386.deb) ...</span></p>
<p><span class="font19">Processing triggers for man-db ...</span></p>
<p><span class="font19">Setting up iscsitarget (1.4.20.2-1) ...</span></p>
<p><span class="font19">iscsitarget not enabled in &quot;/etc/default/iscsitarget&quot;, not starting...(warning).</span></p>
<h4><a name="bookmark4233"></a><span class="font25"><a name="bookmark4234"></a>On Debian 6 you will also need </span><span class="font25" style="font-weight:bold;">aptitude install iscsitarget-dkms </span><span class="font25">for the kernel modules, on Debian 5 this is </span><span class="font25" style="font-weight:bold;">aptitude install iscsitarget-modules-'uname -a'</span><span class="font25">. Ubuntu includes the kernel modules in the main package.</span></h4>
<h4><a name="bookmark4235"></a><span class="font25"><a name="bookmark4236"></a>The iSCSI target server is disabled by default, so we enable it.</span></h4>
<p><span class="font19">root@debby6:~# cat /etc/default/iscsitarget</span></p>
<p><span class="font19">ISCSITARGET_ENABLE=false</span></p>
<p><span class="font19">root@debby6:~# vi /etc/default/iscsitarget</span></p>
<p><span class="font19">root@debby6:~# cat /etc/default/iscsitarget</span></p>
<p><span class="font19">ISCSITARGET ENABLE=true</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4237"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3090"></a><a name="bookmark4238"></a>13.5. iSCSI target setup with dd files</span></h2></li></ul>
<h4><a name="bookmark4239"></a><span class="font25"><a name="bookmark4240"></a>You can use LVM volumes (/dev/md0/lvol0), physical partitions (/dev/sda) ,raid devices (/ dev/md0) or just plain files for storage. In this demo, we use files created with </span><span class="font25" style="font-weight:bold;">dd</span><span class="font25">.</span></h4>
<h4><a name="bookmark4241"></a><span class="font25"><a name="bookmark4242"></a>This screenshot shows how to create three small files (100MB, 200MB and 300MB).</span></h4>
<p><span class="font19">root@debby6:~# mkdir /iscsi</span></p>
<p><span class="font19">root@debby6:~# dd if=/dev/zero of=/iscsi/lun1.img bs=1M count=100 100+0 records in 100+0 records out 104857600 bytes (105 MB) copied, 0.315825 s, 332 MB/s</span></p>
<p><span class="font19">root@debby6:~# dd if=/dev/zero of=/iscsi/lun2.img bs=1M count=200 200+0 records in 200+0 records out 209715200 bytes (210 MB) copied, 1.08342 s, 194 MB/s</span></p>
<p><span class="font19">root@debby6:~# dd if=/dev/zero of=/iscsi/lun3.img bs=1M count=300 300+0 records in 300+0 records out 314572800 bytes (315 MB) copied, 1.36209 s, 231 MB/s</span></p>
<h4><a name="bookmark4243"></a><span class="font25"><a name="bookmark4244"></a>We need to declare these three files as iSCSI targets in </span><span class="font25" style="font-weight:bold;">/etc/iet/ietd.conf </span><span class="font25">(used to be /etc/ ietd.conf).</span></h4>
<p><span class="font19">root@debby6:/etc/iet# cp ietd.conf ietd.conf.original</span></p>
<p><span class="font19">root@debby6:/etc/iet# &gt;&nbsp;ietd.conf</span></p>
<p><span class="font19">root@debby6:/etc/iet# vi ietd.conf</span></p>
<p><span class="font19">root@debby6:/etc/iet# cat ietd.conf</span></p>
<p><span class="font19">Target iqn.2010-02.be.linux-training:storage.lun1</span></p>
<p><span class="font19">IncomingUser isuser hunter2</span></p>
<p><span class="font19">OutgoingUser</span></p>
<p><span class="font19">Lun 0 Path=/iscsi/lun1.img,Type=fileio</span></p>
<p><span class="font19">Alias LUN1</span></p>
<p><span class="font19">Target iqn.2010-02.be.linux-training:storage.lun2</span></p>
<p><span class="font19">IncomingUser isuser hunter2</span></p>
<p><span class="font19">OutgoingUser</span></p>
<p><span class="font19">Lun 0 Path=/iscsi/lun2.img,Type=fileio Alias LUN2</span></p>
<p><span class="font19">Target iqn.2010-02.be.linux-training:storage.lun3</span></p>
<p><span class="font19">IncomingUser isuser hunter2</span></p>
<p><span class="font19">OutgoingUser</span></p>
<p><span class="font19">Lun 0 Path=/iscsi/lun3.img,Type=fileio Alias LUN3</span></p>
<h4><a name="bookmark4245"></a><span class="font25"><a name="bookmark4246"></a>We also need to add our devices to the </span><span class="font25" style="font-weight:bold;">/etc/initiators.allow </span><span class="font25">file.</span></h4>
<p><span class="font19">root@debby6:/etc/iet# cp initiators.allow initiators.allow.original root@debby6:/etc/iet# &gt;initiators.allow root@debby6:/etc/iet# vi initiators.allow root@debby6:/etc/iet# cat initiators.allow iqn.2010-02.be.linux-training:storage.lun1 iqn.2010-02.be.linux-training:storage.lun2 iqn.2010-02.be.linux-training:storage.lun3</span></p>
<h4><a name="bookmark4247"></a><span class="font25"><a name="bookmark4248"></a>Time to start the server now:</span></h4>
<p><span class="font19">root@debby6:/etc/iet# /etc/init.d/iscsitarget start Starting iSCSI enterprise target service:. .</span></p>
<p><span class="font19">root@debby6:/etc/iet#</span></p>
<h4><a name="bookmark4249"></a><span class="font25"><a name="bookmark4250"></a>Verify activation of the storage devices in </span><span class="font25" style="font-weight:bold;">/proc/net/iet</span><span class="font25">:</span></h4>
<p><span class="font19">root@debby6:/etc/iet# cat /proc/net/iet/volume</span></p>
<p><span class="font19">tid:3 name:iqn.2010-02.be.linux-training:storage.lun3</span></p>
<p><span class="font19">lun:0 state:0 iotype:fileio iomode:wt blocks:614400 blocksize:\ 512 path:/iscsi/lun3.img</span></p>
<p><span class="font19">tid:2 name:iqn.2010-02.be.linux-training:storage.lun2</span></p>
<p><span class="font19">lun:0 state:0 iotype:fileio iomode:wt blocks:409600 blocksize:\ 512 path:/iscsi/lun2.img</span></p>
<p><span class="font19">tid:1 name:iqn.2010-02.be.linux-training:storage.lun1</span></p>
<p><span class="font19">lun:0 state:0 iotype:fileio iomode:wt blocks:204800 blocksize:\ 512 path:/iscsi/lun1.img</span></p>
<p><span class="font19">root@debby6:/etc/iet# cat /proc/net/iet/session</span></p>
<p><span class="font19">tid:3 name:iqn.2010-02.be.linux-training:storage.lun3</span></p>
<p><span class="font19">tid:2 name:iqn.2010-02.be.linux-training:storage.lun2</span></p>
<p><span class="font19">tid:1 name:iqn.2010-02.be.linux-training:storage.lun1</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4251"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3091"></a><a name="bookmark4252"></a>13.6. ISCSI initiator on ubuntu</span></h2></li></ul>
<h4><a name="bookmark4253"></a><span class="font25"><a name="bookmark4254"></a>First we install the iSCSi client software (on another computer than the target).</span></h4>
<p><span class="font19">root@ubu1104:~# aptitude install open-iscsi</span></p>
<p><span class="font19">Reading package lists... Done</span></p>
<p><span class="font19">Building dependency tree</span></p>
<p><span class="font19">Reading state information... Done</span></p>
<p><span class="font19">Reading extended state information</span></p>
<p><span class="font19">Initializing package states... Done</span></p>
<p><span class="font19">The following NEW packages will be installed: open-iscsi open-iscsi-utils{a}</span></p>
<h4><a name="bookmark4255"></a><span class="font25"><a name="bookmark4256"></a>Then we set the iSCSI client to start automatically.</span></h4>
<p><span class="font19">root@ubu1104:/etc/iscsi# cp iscsid.conf iscsid.conf.original</span></p>
<p><span class="font19">root@ubu1104:/etc/iscsi# vi iscsid.conf</span></p>
<p><span class="font19">root@ubu1104:/etc/iscsi# grep 'ncde.startup iscsid.conf node.startup = automatic</span></p>
<h4><a name="bookmark4257"></a><span class="font25"><a name="bookmark4258"></a>Or you could start it manually.</span></h4>
<p><span class="font19">root@ubu1104:/etc/iscsi/nodes# /etc/init.d/open-iscsi start</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">* Starting iSCSI initiator service iscsid &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p></li>
<li>
<p><span class="font19">* Setting up iSCSI targets &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p></li></ul>
<p><span class="font19">root@ubu1104:/etc/iscsi/nodes#</span></p>
<h4><a name="bookmark4259"></a><span class="font25"><a name="bookmark4260"></a>Now we can connect to the Target server and use </span><span class="font25" style="font-weight:bold;">iscsiadm </span><span class="font25">to discover the devices it offers:</span></h4>
<p><span class="font19">root@ubu1104:/etc/iscsi# iscsiadm -m discovery -t st -p 192.168.1.31</span></p>
<p><span class="font19">192.168.1.31:3260,1 iqn.2010-02.be.linux-training:storage.lun2</span></p>
<p><span class="font19">192.168.1.31:3260,1 iqn.2010-02.be.linux-training:storage.lun1</span></p>
<p><span class="font19">192.168.1.31:3260,1 iqn.2010-02.be.linux-training:storage.lun3</span></p>
<h4><a name="bookmark4261"></a><span class="font25"><a name="bookmark4262"></a><a name="bookmark4263"></a>We can use the same </span><span class="font25" style="font-weight:bold;">iscsiadm </span><span class="font25">to edit the files in </span><span class="font25" style="font-weight:bold;">/etc/iscsi/nodes/</span><span class="font25">.</span></h4>
<p><span class="font19">root@ubu1104:/etc/iscsi# iscsiadm -m node --targetname &quot;iqn.2010-02.be.linu\ x-training:storage.lun1&quot; --portal &quot;192.168.1.31:3260&quot; --op=update --name no\ de.session.auth.authmethod --value=CHAP</span></p>
<p><span class="font19">root@ubu1104:/etc/iscsi# iscsiadm -m node --targetname &quot;iqn.2010-02.be.linu\ x-training:storage.lun1&quot; --portal &quot;192.168.1.31:3260&quot; --op=update --name no\ de.session.auth.username --value=isuser</span></p>
<p><span class="font19">root@ubu1104:/etc/iscsi# iscsiadm -m node --targetname &quot;iqn.2010-02.be.linu\ x-training:storage.lun1&quot; --portal &quot;192.168.1.31:3260&quot; --op=update --name no\ de.session.auth.password --value=hunter2</span></p>
<h4><a name="bookmark4264"></a><span class="font25"><a name="bookmark4265"></a>Repeat the above for the other two devices.</span></h4>
<h4><a name="bookmark4266"></a><span class="font25"><a name="bookmark4267"></a>Restart the initiator service to log in to the target.</span></h4>
<p><span class="font19">root@ubu1104:/etc/iscsi/nodes# /etc/init.d/open-iscsi restart</span></p>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4268"><span class="font19">* Disconnecting iSCSI targets &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4269"><span class="font19">* Stopping iSCSI initiator service &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4270"><span class="font19">* Starting iSCSI initiator service iscsid &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK</span></a></p></li>
<li>
<p><span class="font19">* Setting up iSCSI targets</span></p></li></ul>
<h4><a name="bookmark4271"></a><span class="font25"><a name="bookmark4272"></a><a name="bookmark4273"></a>Use </span><span class="font25" style="font-weight:bold;">fdisk -l </span><span class="font25">to enjoy three new iSCSI devices.</span></h4>
<p><span class="font19">root@ubu1104:/etc/iscsi/nodes# fdisk -l 2&gt; /dev/null | grep Disk</span></p>
<p><span class="font19">Disk /dev/sda: 17.2 GB, 17179869184 bytes</span></p>
<p><span class="font19">Disk identifier: 0x0001983f</span></p>
<p><span class="font19">Disk /dev/sdb: 209 MB, 209715200 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdd: 314 MB, 314572800 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdc: 104 MB, 104857600 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<h4><a name="bookmark4274"></a><span class="font25"><a name="bookmark4275"></a>The Target (the server) now shows active sessions.</span></h4>
<p><span class="font19">root@debby6:/etc/iet# cat /proc/net/iet/session</span></p>
<p><span class="font19">tid:3 name:iqn.2010-02.be.linux-training:storage.lun3</span></p>
<p><span class="font19">sid:5348024611832320 initiator:iqn.1993-08.org.debian:01:8983ed2d770</span></p>
<p><span class="font19">cid:0 ip:192.168.1.35 state:active hd:none dd:none</span></p>
<p><span class="font19">tid:2 name:iqn.2010-02.be.linux-training:storage.lun2</span></p>
<p><span class="font19">sid:4785074624856576 initiator:iqn.1993-08.org.debian:01:8983ed2d770</span></p>
<p><span class="font19">cid:0 ip:192.168.1.35 state:active hd:none dd:none</span></p>
<p><span class="font19">tid:1 name:iqn.2010-02.be.linux-training:storage.lun1</span></p>
<p><span class="font19">sid:5066549618344448 initiator:iqn.1993-08.org.debian:01:8983ed2d770</span></p>
<p><span class="font19">cid:0 ip:192.168.1.35 state:active hd:none dd:none</span></p>
<p><span class="font19">root@debby6:/etc/iet#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4276"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3092"></a><a name="bookmark4277"></a>13.7. using iSCSI devices</span></h2></li></ul>
<h4><a name="bookmark4278"></a><span class="font25"><a name="bookmark4279"></a>There is no difference between using SCSI or iSCSI devices once they are connected : partition, make filesystem, mount.</span></h4>
<p><span class="font19">root@ubu1104:/etc/iscsi/nodes# history | tail -13</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">94 fdisk /dev/sdc</span></p></li>
<li>
<p><span class="font19">95 fdisk /dev/sdd</span></p></li>
<li>
<p><span class="font19">96 fdisk /dev/sdb</span></p></li>
<li>
<p><span class="font19">97 mke2fs /dev/sdb1</span></p></li>
<li>
<p><span class="font19">98 mke2fs -j /dev/sdc1</span></p></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font19">99 mkfs.ext4 /dev/sdd1</span></p></li></ul>
<p><span class="font19">100 mkdir /mnt/is1</span></p>
<p><span class="font19">101 mkdir /mnt/is2</span></p>
<p><span class="font19">102 mkdir /mnt/is3</span></p>
<p><span class="font19">103 mount /dev/sdb1 /mnt/is1</span></p>
<p><span class="font19">104 mount /dev/sdc1 /mnt/is2</span></p>
<p><span class="font19">105 mount /dev/sdd1 /mnt/is3</span></p>
<p><span class="font19">106 history | tail -13</span></p>
<p><span class="font19">root@ubu1104:/etc/iscsi/nodes# mount | grep is</span></p>
<p><span class="font19">/dev/sdb1 on /mnt/is1 type ext2 (rw)</span></p>
<p><span class="font19">/dev/sdc1 on /mnt/is2 type ext3 (rw)</span></p>
<p><span class="font19">/dev/sdd1 on /mnt/is3 type ext4 (rw)</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4280"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3093"></a><a name="bookmark4281"></a>13 .8. iSCSI Target RHEL7/CentOS7</span></h2></li></ul>
<h4><a name="bookmark4282"></a><span class="font25"><a name="bookmark4283"></a>The prefered tool to setup an iSCSI Target on RHEL is </span><span class="font25" style="font-weight:bold;">targetcli</span><span class="font25">.</span></h4>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">yum install targetcli </span><span class="font19">Loaded plugins: fastestmirror</span></p>
<p><span class="font19">Installed: targetcli.noarch 0:2.1.fb37-3.el7</span></p>
<p><span class="font19">Complete!</span></p>
<p><span class="font19">[root@centos7 ~]#</span></p>
<h4><a name="bookmark4284"></a><span class="font25"><a name="bookmark4285"></a>The </span><span class="font25" style="font-weight:bold;">targetcli </span><span class="font25">tool is interactive and represents the configuration fo the </span><span class="font25" style="font-weight:bold;">target </span><span class="font25">in a structure that resembles a directory tree with several files. Although this is explorable inside </span><span class="font25" style="font-weight:bold;">targetcli </span><span class="font25">with </span><span class="font25" style="font-weight:bold;">ls</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">cd </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">pwd</span><span class="font25">, this are not files on the file system.</span></h4>
<h4><a name="bookmark4286"></a><span class="font25"><a name="bookmark4287"></a>This tool also has tab-completion, which is very handy for the </span><span class="font25" style="font-weight:bold;">iqn </span><span class="font25">names.</span></h4>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">targetcli</span></p>
<p><span class="font19">targetcli shell version 2.1.fb37</span></p>
<p><span class="font19">Copyright 2011-2013 by Datera, Inc and others.</span></p>
<p><span class="font19">For help on commands, type 'help'.</span></p>
<p><span class="font19">/&gt; </span><span class="font19" style="font-weight:bold;">cd backstores/</span></p>
<p><span class="font19">/backstores&gt; </span><span class="font19" style="font-weight:bold;">ls</span></p>
<p><a href="#bookmark4288"><span class="font19">o- backstores </span></a></p>
<p><a href="#bookmark4289"><span class="font19">o- block ................................................ [Storage Objects:</span></a></p>
<p><a href="#bookmark4290"><span class="font19">o- fileio ............................................... [Storage Objects:</span></a></p>
<p><a href="#bookmark4291"><span class="font19">o- pscsi ................................................ [Storage Objects:</span></a></p>
<p><a href="#bookmark4292"><span class="font19">o- ramdisk .............................................. [Storage Objects:</span></a></p>
<p><span class="font19">/backstores&gt; </span><span class="font19" style="font-weight:bold;">cd block</span></p>
<p><span class="font19">/backstores/block&gt; </span><span class="font19" style="font-weight:bold;">ls</span></p>
<p><span class="font19">o- block .................................................. [Storage Objects: 0]</span></p>
<p><span class="font19">/backstores/block&gt; </span><span class="font19" style="font-weight:bold;">create serverl.diskl /dev/sdb</span></p>
<p><span class="font19">Created block storage object server1.disk1 using /dev/sdb. /backstores/block&gt; </span><span class="font19" style="font-weight:bold;">ls</span></p>
<p><span class="font19">o- block .................................................. [Storage Objects: 1]</span></p>
<p><span class="font19">o- server1.disk1 .................. [/dev/sdb (2.0GiB) write-thru deactivated]</span></p>
<p><span class="font19">/backstores/block&gt; </span><span class="font19" style="font-weight:bold;">cd /iscsi</span></p>
<p><span class="font19">/iscsi&gt; </span><span class="font19" style="font-weight:bold;">create iqn.2015-04.be.linux:iscsi1</span></p>
<p><span class="font19">Created target iqn.2015-04.be.linux:iscsi1.</span></p>
<p><span class="font19">Created TPG 1.</span></p>
<p><span class="font19">Global pref auto_add_default_portal=true</span></p>
<p><span class="font19">Created default portal listening on all IPs (0.0.0.0), port 3260.</span></p>
<p><span class="font19">/iscsi&gt; </span><span class="font19" style="font-weight:bold;">cd /iscsi/iqn.2015-04.be.linux:iscsi1/tpg1/acls</span></p>
<p><span class="font19">/iscsi/iqn.20...si1/tpg1/acls&gt; </span><span class="font19" style="font-weight:bold;">create iqn.2015-04.be.linux:server2</span></p>
<p><span class="font19">Created Node ACL for iqn.2015-04.be.linux:server2</span></p>
<p><span class="font19">/iscsi/iqn.20...si1/tpg1/acls&gt; </span><span class="font19" style="font-weight:bold;">cd iqn.2015-04.be.linux:server2</span></p>
<p><span class="font19">/iscsi/iqn.20...linux:server2&gt; </span><span class="font19" style="font-weight:bold;">set auth userid=paul</span></p>
<p><span class="font19">Parameter userid is now 'paul'.</span></p>
<p><span class="font19">/iscsi/iqn.20...linux:server2&gt; </span><span class="font19" style="font-weight:bold;">set auth password=hunter2</span></p>
<p><span class="font19">Parameter password is now 'hunter2'.</span></p>
<p><span class="font19">/iscsi/iqn.20...linux:server2&gt; </span><span class="font19" style="font-weight:bold;">cd /iscsi/iqn.2015-04.be.linux:iscsi1/tpg1/luns </span><span class="font19">/iscsi/iqn.20...si1/tpg1/luns&gt; </span><span class="font19" style="font-weight:bold;">create /backstores/block/serverl.diskl </span><span class="font19">Created LUN 0.</span></p>
<p><span class="font19">Created LUN 0-&gt;0 mapping in node ACL iqn.2015-04.be.linux:server2</span></p>
<p><span class="font19">s/scsi/iqn.20...si1/tpg1/luns&gt; </span><span class="font19" style="font-weight:bold;">cd /iscsi/iqn.2015-04.be.linux:iscsi1/tpg1/portals </span><span class="font19">/iscsi/iqn.20.../tpg1/portals&gt; </span><span class="font19" style="font-weight:bold;">create 192.168.1.128</span></p>
<p><span class="font19">Using default IP port 3260</span></p>
<p><span class="font19">Could not create NetworkPortal in configFS.</span></p>
<p><span class="font19">/iscsi/iqn.20.../tpg1/portals&gt; </span><span class="font19" style="font-weight:bold;">cd /</span></p>
<p><a href="#bookmark4293"><span class="font19">/&gt; </span><span class="font19" style="font-weight:bold;">ls </span><span class="font19">o- / </span></a></p>
<p><a href="#bookmark4294"><span class="font19">o- backstores </span></a></p>
<p><span class="font19">o- block .............................................. [Storage Objects: 1]</span></p>
<p><span class="font19">| o- serverl-diskl ................ [/dev/sdb (2-0GiB) write-thru activated]</span></p>
<p><a href="#bookmark4295"><span class="font19">o- fileio ............................................. [Storage Objects:</span></a></p>
<p><a href="#bookmark4296"><span class="font19">o- pscsi .............................................. [Storage Objects:</span></a></p>
<p><a href="#bookmark4297"><span class="font19">o- ramdisk ............................................ [Storage Objects:</span></a></p>
<div>
<p><span class="font19">o-</span></p>
</div><br clear="all">
<p><a href="#bookmark4298"><span class="font19">iscsi ........................................................ [Targets:</span></a></p>
<p><a href="#bookmark4299"><span class="font19">o- iqn.2015-04.be.linux:iscsi1 ................................... [TPGs:</span></a></p>
<p><span class="font19">o- tpg1 ........................................... [no-gen-acls, no-auth]</span></p>
<p><a href="#bookmark4300"><span class="font19">o- acls ...................................................... [ACLs:</span></a></p>
<p><span class="font19">| o- iqn.2015-04.be.linux:server2 ..................... [Mapped LUNs: 1]</span></p>
<p><span class="font19">| o- mapped_lun0 ..................... [lun0 block/server1-disk1 (rw)]</span></p>
<p><a href="#bookmark4301"><span class="font19">o- luns ...................................................... [LUNs:</span></a></p>
<p><span class="font19">| o- lun0 ............................. [block/server1-disk1 (/dev/sdb)]</span></p>
<p><a href="#bookmark4302"><span class="font19">o- portals ................................................ [Portals:</span></a></p>
<p><a href="#bookmark4303"><span class="font19">o- 0.0.0.0:3260 </span></a></p>
<p><span class="font19">o- loopback .....................................................</span></p>
<div>
<p><span class="font19">[Targets: 0]</span></p>
</div><br clear="all">
<p><span class="font19">/&gt; </span><span class="font19" style="font-weight:bold;">saveconfig</span></p>
<p><span class="font19">Last 10 configs saved in /etc/target/backup.</span></p>
<p><span class="font19">Configuration saved to /etc/target/saveconfig.json</span></p>
<p><span class="font19">/&gt; </span><span class="font19" style="font-weight:bold;">exit</span></p>
<p><span class="font19">Global pref auto_save_on_exit=true</span></p>
<p><span class="font19">Last 10 configs saved in /etc/target/backup.</span></p>
<p><span class="font19">Configuration saved to /etc/target/saveconfig.json [root@centos7 ~]#</span></p>
<p><span class="font25">Use the </span><span class="font25" style="font-weight:bold;">systemd </span><span class="font25">tools to manage the service:</span></p>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">systemctl enable target</span></p>
<p><span class="font19">ln -s '/usr/lib/systemd/system/target.service' '/etc/systemd/system/multi-user.target.wants/ta [root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">systemctl start target</span></p>
<p><span class="font19">[root@centos7 ~]#</span></p>
<p><span class="font25">Depending on your organisations policy, you may need to configure firewall and SELinux.</span></p>
<p><span class="font25">The screenshot belows adds a firewall rule to allow all traffic over port 3260, and disables SELinux.</span></p>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">firewall-cmd --permanent --add-port=3260/tcp</span></p>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">firewall-cmd --reload</span></p>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">setenforce 0</span></p>
<p><span class="font25">The total configuration is visible using </span><span class="font25" style="font-weight:bold;">ls </span><span class="font25">from the root.</span></p>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">targetcli </span><span class="font19">targetcli shell version 2.1.fb37 Copyright 2011-2013 by Datera, Inc and others. For help on commands, type 'help'.</span></p>
<p><span class="font19">/&gt; </span><span class="font19" style="font-weight:bold;">ls</span></p>
<p><a href="#bookmark4304"><span class="font19">o- / </span></a></p>
<p><a href="#bookmark4305"><span class="font19">o- backstores </span></a></p>
<p><span class="font19">| o- block .............................................. [Storage Objects: 1]</span></p>
<p><span class="font19">| | o- server1.disk1 ................ [/dev/sdb (2.0GiB) write-thru activated]</span></p>
<p><a href="#bookmark4306"><span class="font19">| o- fileio ............................................. [Storage Objects:</span></a></p>
<p><a href="#bookmark4307"><span class="font19">| o- pscsi .............................................. [Storage Objects:</span></a></p>
<p><a href="#bookmark4308"><span class="font19">| o- ramdisk ............................................ [Storage Objects:</span></a></p>
<p><a href="#bookmark4309"><span class="font19">o- iscsi ........................................................ [Targets:</span></a></p>
<p><a href="#bookmark4310"><span class="font19">| o- iqn.2015-04.be.linux:iscsi1 ................................... [TPGs:</span></a></p>
<p><span class="font19">| o- tpg1 ........................................... [no-gen-acls, no-auth]</span></p>
<p><a href="#bookmark4311"><span class="font19">| o- acls ...................................................... [ACLs:</span></a></p>
<p><span class="font19">| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| o- iqn.2015-04.be.linux:server2 ..................... [Mapped LUNs: 1]</span></p>
<p><span class="font19">| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| o- mapped_lun0 ..................... [lun0 block/serverl.diskl (rw)]</span></p>
<p><span class="font19">| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o- luns ...................................................... [LUNs: 1]</span></p>
<p><span class="font19">| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| o- lun0 ............................. [block/server1.disk1 (/dev/sdb)]</span></p>
<p><a href="#bookmark4312"><span class="font19">| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o- portals ................................................ [Portals:</span></a></p>
<p><a href="#bookmark4313"><span class="font19">| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o- 0.0.0.0:3260 </span></a></p>
<p><a href="#bookmark4314"><span class="font19">o- loopback ..................................................... [Targets:</span></a></p>
<p><span class="font19">/&gt;</span></p>
<p><span class="font19">/&gt; </span><span class="font19" style="font-weight:bold;">exit</span></p>
<p><span class="font19">Global pref auto_save_on_exit=true</span></p>
<p><span class="font19">Last 10 configs saved in /etc/target/backup.</span></p>
<p><span class="font19">Configuration saved to /etc/target/saveconfig.json [root@centos7 ~]#</span></p>
<h4><a name="bookmark4315"></a><span class="font25"><a name="bookmark4316"></a>The iSCSI Target is now ready.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4317"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3094"></a><a name="bookmark4318"></a>13. 9. iSCSI Initiator RHEL7/CentOS7</span></h2></li></ul>
<h4><a name="bookmark4319"></a><span class="font25"><a name="bookmark4320"></a>This is identical to the RHEL6/CentOS6 procedure:</span></h4>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">yum install iscsi-initiator-utils </span><span class="font19">Loaded plugins: fastestmirror</span></p>
<p><span class="font19">Installed:</span></p>
<p><span class="font19">iscsi-initiator-utils.x86_64 0:6.2.0.873-29.el7</span></p>
<p><span class="font19">Dependency Installed:</span></p>
<p><span class="font19">iscsi-initiator-utils-iscsiuio.x86_64 0:6.2.0.873-29.el7</span></p>
<p><span class="font19">Complete!</span></p>
<h4><a name="bookmark4321"></a><span class="font25"><a name="bookmark4322"></a>Map your initiator name to the </span><span class="font25" style="font-weight:bold;">targetcli </span><span class="font25">acl.</span></h4>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">cat /etc/iscsi/initiatorname.iscsi</span></p>
<p><span class="font19">InitiatorName=iqn.2015-04.be.linux:server2 [root@centos7 ~]#</span></p>
<h4><a name="bookmark4323"></a><span class="font25"><a name="bookmark4324"></a>Enter the CHAP authentication in </span><span class="font25" style="font-weight:bold;">/etc/iscsi/iscsid.conf</span><span class="font25">.</span></h4>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">vi /etc/iscsi/iscsid.conf</span></p>
<p><span class="font19">...</span></p>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">grep *node.session.auth /etc/iscsi/iscsid.conf </span><span class="font19">node.session.auth.authmethod = CHAP node.session.auth.username = paul node.session.auth.password = hunter2 [root@centos7 ~]#</span></p>
<h4><a name="bookmark4325"></a><span class="font25"><a name="bookmark4326"></a>There are no extra devices yet...</span></h4>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">fdisk -l | grep sd</span></p>
<p><span class="font19">Disk /dev/sda: 22.0 GB, 22038806528 bytes, 43044544 sectors</span></p>
<p><span class="font19">/dev/sda1 &nbsp;&nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2048 &nbsp;&nbsp;&nbsp;&nbsp;1026047 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;512000 &nbsp;&nbsp;83 &nbsp;Linux</span></p>
<p><span class="font19">/dev/sda2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1026048 &nbsp;&nbsp;&nbsp;43042815 &nbsp;&nbsp;&nbsp;21008384 &nbsp;&nbsp;8e &nbsp;Linux LVM</span></p>
<p><span class="font19">Disk /dev/sdb: 2147 MB, 2147483648 bytes, 4194304 sectors</span></p>
<h4><a name="bookmark4327"></a><span class="font25"><a name="bookmark4328"></a>Enable the service and discover the target.</span></h4>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">systemctl enable iscsid</span></p>
<p><span class="font19">ln -s '/usr/lib/systemd/system/iscsid.service' '/etc/systemd/system/multi-user.target.wants/is [root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">iscsiadm -m discovery -t st -p 192.168.1.128</span></p>
<p><span class="font19">192.168.1.128:3260,1 iqn.2015-04.be.linux:iscsi1</span></p>
<h4><a name="bookmark4329"></a><span class="font25"><a name="bookmark4330"></a>Log into the target and see /dev/sdc appear.</span></h4>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">iscsiadm -m node -T iqn.2015-04.be.linux:iscsi1 -p 192.168.1.128 -l</span></p>
<p><span class="font19">Logging in to [iface: default, target: iqn.2015-04.be.linux:iscsi1, portal: 192.168.1.128,3260</span></p>
<p><span class="font19">Login to [iface: default, target: iqn.2015-04.be.linux:iscsi1, portal: 192.168.1.128,3260] suc [root@centos7 ~]#</span></p>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">fdisk -l | grep sd</span></p>
<p><span class="font19">Disk /dev/sda: 22.0 GB, 22038806528 bytes, 43044544 sectors</span></p>
<p><span class="font19">/dev/sda1 &nbsp;&nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2048 &nbsp;&nbsp;&nbsp;&nbsp;1026047 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;512000 &nbsp;&nbsp;83 &nbsp;Linux</span></p>
<p><span class="font19">/dev/sda2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1026048 &nbsp;&nbsp;&nbsp;43042815 &nbsp;&nbsp;&nbsp;21008384 &nbsp;&nbsp;8e &nbsp;Linux LVM</span></p>
<p><span class="font19">Disk /dev/sdb: 2147 MB, 2147483648 bytes, 4194304 sectors</span></p>
<p><span class="font19">Disk /dev/sdc: 2147 MB, 2147483648 bytes, 4194304 sectors [root@centos7 ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4331"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3095"></a><a name="bookmark4332"></a>13. 10. practice: iSCSI devices</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Set up a target (using an LVM and a SCSI device) and an initiator that connects to both.</span></p></li>
<li>
<p><a name="bookmark4333"></a><span class="font25">2. Set up an iSCSI Target and Initiator on two CentOS7/RHEL7 computers with the following information:</span></p></li></ul>
<p><span class="font25" style="font-weight:bold;">Table 13.1. iSCSI Target and Initiator practice</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">variable</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">value</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">Target Server IP</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">shared devices on target</span></p></td><td style="vertical-align:top;">
<p><span class="font24">/dev/sd /dev/sd /dev/sd</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">shared device name sd</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">shared device name sd</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">shared device name sd</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">target iqn</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">initiator iqn</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font24">username</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">password</span></p></td><td style="vertical-align:top;"></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4334"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3096"></a><a name="bookmark4335"></a>13. 11. solution: iSCSI devices</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Set up a target (using an LVM and a SCSI device) and an initiator that connects to both.</span></p></li></ul>
<p><span class="font25">This solution was done on </span><span class="font25" style="font-weight:bold;">Debian/ubuntu/Mint</span><span class="font25">. For RHEL/CentOS check the theory.</span></p>
<p><span class="font25">Decide (with a partner) on a computer to be the Target and another computer to be the Initiator.</span></p>
<p><span class="font25" style="font-weight:bold;">On the Target computer:</span></p>
<p><span class="font25">First install iscsitarget using the standard tools for installing software in your distribution. Then use your knowledge from the previous chapter to setup a logical volume (/dev/vg/ lvol0) and use the RAID chapter to setup /dev/md0. Then perform the following step:</span></p>
<p><span class="font19">vi /etc/default/iscsitarget (set enable to true)</span></p>
<p><span class="font25">Add your devices to /etc/iet/ietf.conf</span></p>
<p><span class="font19">root@debby6:/etc/iet# cat ietd.conf</span></p>
<p><span class="font19">Target iqn.2010-02.be.linux-training:storage.lun1</span></p>
<p><span class="font19">IncomingUser isuser hunter2</span></p>
<p><span class="font19">OutgoingUser</span></p>
<p><span class="font19">Lun 0 Path=/dev/vg/lvol0,Type=fileio</span></p>
<p><span class="font19">Alias LUN1</span></p>
<p><span class="font19">Target iqn.2010-02.be.linux-training:storage.lun2</span></p>
<p><span class="font19">IncomingUser isuser hunter2</span></p>
<p><span class="font19">OutgoingUser</span></p>
<p><span class="font19">Lun 0 Path=/dev/md0,Type=fileio</span></p>
<p><span class="font19">Alias LUN2</span></p>
<p><span class="font25">Add both devices to /etc/iet/initiators.allow</span></p>
<p><span class="font19">root@debby6:/etc/iet# cat initiators.allow</span></p>
<p><span class="font19">iqn.2010-02.be.linux-training:storage.lun1</span></p>
<p><span class="font19">iqn.2010-02.be.linux-training:storage.lun2</span></p>
<p><span class="font25">Now start the iscsitarget daemon and move over to the Initiator.</span></p>
<p><span class="font25" style="font-weight:bold;">On the Initiator computer:</span></p>
<p><span class="font25">Install open-iscsi and start the daemon.</span></p>
<p><span class="font25">Then use </span><span class="font25" style="font-weight:bold;">iscsiadm -m discovery -t st -p 'target-ip' </span><span class="font25">to see the iscsi devices on the Target.</span></p>
<p><span class="font25">Edit the files </span><span class="font25" style="font-weight:bold;">/etc/iscsi/nodes/ </span><span class="font25">as shown in the book. Then restart the iSCSI daemon and rund </span><span class="font25" style="font-weight:bold;">fdisk -l </span><span class="font25">to see the iSCSI devices.</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark4336"></a><span class="font25"><a name="bookmark4337"></a><a name="bookmark4338"></a>2. Set up an iSCSI Target and Initiator on two CentOS7/RHEL7 computers with the following information:</span></h4></li></ul>
<p><span class="font25" style="font-weight:bold;">Table 13.2. iSCSI Target and Initiator practice</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">variable</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">value</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">Target Server IP</span></p></td><td style="vertical-align:top;">
<p><span class="font24">192.168.1.143 (Adjust for your subnet!)</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">shared devices on target</span></p></td><td style="vertical-align:top;">
<p><span class="font24">/dev/sdb /dev/sdc /dev/sdd</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">shared device name sdb</span></p></td><td style="vertical-align:top;">
<p><span class="font24">target.disk1</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">shared device name sdc</span></p></td><td style="vertical-align:top;">
<p><span class="font24">target.disk2</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">shared device name sdd</span></p></td><td style="vertical-align:top;">
<p><span class="font24">target.disk3</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">target iqn</span></p></td><td style="vertical-align:top;">
<p><span class="font24">iqn.2015-04.be.linux:target</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">initiator iqn</span></p></td><td style="vertical-align:top;">
<p><span class="font24">iqn.2015-04.be.linux:initiator</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">username</span></p></td><td style="vertical-align:top;">
<p><span class="font24">paul</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">password</span></p></td><td style="vertical-align:top;">
<p><span class="font24">hunter2</span></p></td></tr>
</table>
<h4><a name="bookmark4339"></a><span class="font25"><a name="bookmark4340"></a>On the iSCSI Target server:</span></h4>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">targetcli</span></p>
<p><span class="font19">targetcli shell version 2.1.fb37</span></p>
<p><span class="font19">Copyright 2011-2013 by Datera, Inc and others.</span></p>
<p><span class="font19">For help on commands, type 'help'.</span></p>
<p><span class="font19">/&gt; cd /backstores/block</span></p>
<p><span class="font19">/backstores/block&gt; </span><span class="font19" style="font-weight:bold;">ls </span><span class="font19">o- block .................................................. [Storage Objects: 0]</span></p>
<p><span class="font19">/backstores/block&gt; </span><span class="font19" style="font-weight:bold;">create target.diskl /dev/sdb</span></p>
<p><span class="font19">Created block storage object target.disk1 using /dev/sdb.</span></p>
<p><span class="font19">/backstores/block&gt; </span><span class="font19" style="font-weight:bold;">create target.disk2 /dev/sdc</span></p>
<p><span class="font19">Created block storage object target.disk2 using /dev/sdc.</span></p>
<p><span class="font19">/backstores/block&gt; </span><span class="font19" style="font-weight:bold;">create target.disk3 /dev/sdd</span></p>
<p><span class="font19">Created block storage object target.disk3 using /dev/sdd. /backstores/block&gt; </span><span class="font19" style="font-weight:bold;">ls</span></p>
<p><span class="font19">o- block .................................................. [Storage Objects: 3]</span></p>
<p><span class="font19">o- target.disk1 ................... [/dev/sdb (8.0GiB) write-thru deactivated]</span></p>
<p><span class="font19">o- target.disk2 ................... [/dev/sdc (8.0GiB) write-thru deactivated]</span></p>
<p><span class="font19">o- target.disk3 ................... [/dev/sdd (8.0GiB) write-thru deactivated]</span></p>
<p><span class="font19">/backstores/block&gt; </span><span class="font19" style="font-weight:bold;">cd /iscsi</span></p>
<p><span class="font19">/iscsi&gt; </span><span class="font19" style="font-weight:bold;">create iqn.2015-04.be.linux:target</span></p>
<p><span class="font19">Created target iqn.2015-04.be.linux:target.</span></p>
<p><span class="font19">Created TPG 1.</span></p>
<p><span class="font19">Global pref auto_add_default_portal=true</span></p>
<p><span class="font19">Created default portal listening on all IPs (0.0.0.0), port 3260.</span></p>
<p><span class="font19">/iscsi&gt; </span><span class="font19" style="font-weight:bold;">cd /iscsi/iqn.2015-04.be.linux:target/tpg1/acls</span></p>
<p><span class="font19">/iscsi/iqn.20...get/tpg1/acls&gt; </span><span class="font19" style="font-weight:bold;">create iqn.2015-04.be.linux:initiator</span></p>
<p><span class="font19">Created Node ACL for iqn.2015-04.be.linux:initiator</span></p>
<p><span class="font19">/iscsi/iqn.20...get/tpg1/acls&gt; </span><span class="font19" style="font-weight:bold;">cd iqn.2015-04.be.linux:initiator</span></p>
<p><span class="font19">/iscsi/iqn.20...nux:initiator&gt; </span><span class="font19" style="font-weight:bold;">pwd</span></p>
<p><span class="font19">/iscsi/iqn.2015-04.be.linux:target/tpg1/acls/iqn.2015-04.be.linux:initiator</span></p>
<p><span class="font19">/iscsi/iqn.20...nux:initiator&gt; </span><span class="font19" style="font-weight:bold;">set auth userid=paul</span></p>
<p><span class="font19">Parameter userid is now 'paul'.</span></p>
<p><span class="font19">/iscsi/iqn.20...nux:initiator&gt; </span><span class="font19" style="font-weight:bold;">set auth password=hunter2</span></p>
<p><span class="font19">Parameter password is now 'hunter2'.</span></p>
<p><span class="font19">/iscsi/iqn.20...nux:initiator&gt; </span><span class="font19" style="font-weight:bold;">cd /iscsi/iqn.2015-04.be.linux:target/tpg1/</span></p>
<p><span class="font19">/iscsi/iqn.20...x:target/tpg1&gt; </span><span class="font19" style="font-weight:bold;">ls</span></p>
<p><span class="font19">o- tpg1 ................................................. [no-gen-acls, no-auth]</span></p>
<p><span class="font19">o- acls ............................................................ [ACLs: 1]</span></p>
<p><span class="font19">| o- iqn.2015-04.be.linux:initiator ......................... [Mapped LUNs: 0]</span></p>
<p><a href="#bookmark4341"><span class="font19">o- luns ............................................................ [LUNs:</span></a></p>
<p><a href="#bookmark4342"><span class="font19">o- portals ...................................................... [Portals:</span></a></p>
<p><a href="#bookmark4343"><span class="font19">o- 0.0.0.0:3260 </span></a><span class="font19">&nbsp;/iscsi/iqn.20...x:target/tpg1&gt; </span><span class="font19" style="font-weight:bold;">cd luns</span></p>
<p><span class="font19">/iscsi/iqn.20...get/tpg1/luns&gt; </span><span class="font19" style="font-weight:bold;">create /backstores/block/target.diskl </span><span class="font19">Created LUN 0.</span></p>
<p><span class="font19">Created LUN 0-&gt;0 mapping in node ACL iqn.2015-04.be.linux:initiator /iscsi/iqn.20...get/tpg1/luns&gt; </span><span class="font19" style="font-weight:bold;">create /backstores/block/target.disk2 </span><span class="font19">Created LUN 1.</span></p>
<p><span class="font19">Created LUN 1-&gt;1 mapping in node ACL iqn.2015-04.be.linux:initiator /iscsi/iqn.20...get/tpg1/luns&gt; </span><span class="font19" style="font-weight:bold;">create /backstores/block/target.disk3 </span><span class="font19">Created LUN 2.</span></p>
<p><span class="font19">Created LUN 2-&gt;2 mapping in node ACL iqn.2015-04.be.linux:initiator</span></p>
<p><span class="font19">s/scsi/iqn.20...get/tpg1/luns&gt; </span><span class="font19" style="font-weight:bold;">cd /iscsi/iqn.2015-04.be.linux:target/tpg1/portals </span><span class="font19">/iscsi/iqn.20.../tpg1/portals&gt; </span><span class="font19" style="font-weight:bold;">create 192.168.1.143</span></p>
<p><span class="font19">Using default IP port 3260</span></p>
<p><span class="font19">Could not create NetworkPortal in configFS.</span></p>
<p><span class="font19">/iscsi/iqn.20.../tpg1/portals&gt; </span><span class="font19" style="font-weight:bold;">cd /</span></p>
<p><span class="font19">/&gt; ls</span></p>
<p><span class="font19">o- / ..................................................................... [...]</span></p>
<p><span class="font19">o- backstores .......................................................... [...]</span></p>
<p><span class="font19">| o- block .............................................. [Storage Objects: 3]</span></p>
<p><span class="font19">| | o- target.disk1 ................. [/dev/sdb (8.0GiB) write-thru activated]</span></p>
<p><span class="font19">| | o- target.disk2 ................. [/dev/sdc (8.0GiB) write-thru activated]</span></p>
<p><span class="font19">| | o- target.disk3 ................. [/dev/sdd (8.0GiB) write-thru activated]</span></p>
<p><a href="#bookmark4344"><span class="font19">| o- fileio ............................................. [Storage Objects:</span></a></p>
<p><a href="#bookmark4345"><span class="font19">| o- pscsi .............................................. [Storage Objects:</span></a></p>
<p><a href="#bookmark4346"><span class="font19">| o- ramdisk ............................................ [Storage Objects:</span></a></p>
<p><span class="font19">o- iscsi ........................................................ [Targets: 1]</span></p>
<div>
<p><span class="font19">o-</span></p>
</div><br clear="all">
<p><a href="#bookmark4347"><span class="font19">iqn.2015-04.be.linux:target ................................... [TPGs:</span></a></p>
<p><span class="font19">o- tpg1 ........................................... [no-gen-acls, no-auth]</span></p>
<p><a href="#bookmark4348"><span class="font19">o- acls ...................................................... [ACLs:</span></a></p>
<p><span class="font19">| o- iqn.2015-04.be.linux:initiator ................... [Mapped LUNs: 3]</span></p>
<p><span class="font19">| &nbsp;&nbsp;o- mapped_lun0 ...................... [lun0 block/target.disk1 (rw)]</span></p>
<p><span class="font19">| &nbsp;&nbsp;o- mapped_lun1 ...................... [lun1 block/target.disk2 (rw)]</span></p>
<p><span class="font19">| &nbsp;&nbsp;o- mapped_lun2 ...................... [lun2 block/target.disk3 (rw)]</span></p>
<p><a href="#bookmark4349"><span class="font19">o- luns ...................................................... [LUNs:</span></a></p>
<p><span class="font19">| o- lun0 .............................. [block/target.disk1 (/dev/sdb)]</span></p>
<p><span class="font19">| o- lun1 .............................. [block/target.disk2 (/dev/sdc)]</span></p>
<p><span class="font19">| o- lun2 .............................. [block/target.disk3 (/dev/sdd)]</span></p>
<p><a href="#bookmark4350"><span class="font19">o- portals ................................................ [Portals:</span></a></p>
<p><a href="#bookmark4351"><span class="font19">o- 0.0.0.0:3260 </span></a></p>
<p><span class="font19">o- loopback</span></p>
<div>
<p><span class="font19">[Targets: 0]</span></p>
</div><br clear="all">
<p><span class="font19">/&gt; </span><span class="font19" style="font-weight:bold;">exit</span></p>
<p><span class="font19">Global pref auto_save_on_exit=true</span></p>
<p><span class="font19">Last 10 configs saved in /etc/target/backup.</span></p>
<p><span class="font19">Configuration saved to /etc/target/saveconfig.json</span></p>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">systemctl enable target</span></p>
<p><span class="font19">ln -s '/usr/lib/systemd/system/target.service' '/etc/systemd/system/multi-user.target.wants/ta</span></p>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">systemctl start target</span></p>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">setenforce 0</span></p>
<h4><a name="bookmark4352"></a><span class="font25"><a name="bookmark4353"></a>On the Initiator:</span></h4>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">cat /etc/iscsi/initiatorname.iscsi</span></p>
<p><span class="font19">InitiatorName=iqn.2015-04.be.linux:initiator</span></p>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">vi /etc/iscsi/iscsid.conf</span></p>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">grep 'node.session.au /etc/iscsi/iscsid.conf</span></p>
<p><span class="font19">node.session.auth.authmethod = CHAP node.session.auth.username = paul node.session.auth.password = hunter2 [root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">fdisk -l 2&gt;/dev/null | grep sd</span></p>
<p><span class="font19">Disk /dev/sda: 22.0 GB, 22038806528 bytes, 43044544 sectors</span></p>
<p><span class="font19">/dev/sda1 * &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2048 &nbsp;&nbsp;&nbsp;&nbsp;1026047 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;512000 &nbsp;&nbsp;83 Linux</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/sda2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1026048</span></p></td><td style="vertical-align:top;">
<p><span class="font19">43042815</span></p></td><td style="vertical-align:top;">
<p><span class="font19">21008384</span></p></td><td style="vertical-align:top;">
<p><span class="font19">8e</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Linux LVM</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Disk /dev/sdb:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">8589 MB, 858</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">9934592 bytes,</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">16777216</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">sectors</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdb1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2048</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">821247</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">409600</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">83</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Linux</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdb2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">821248</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1640447</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">409600</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">83</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Linux</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/sdb3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1640448</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2459647</span></p></td><td style="vertical-align:top;">
<p><span class="font19">409600</span></p></td><td style="vertical-align:top;">
<p><span class="font19">83</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Linux</span></p></td></tr>
</table>
<p><span class="font19">Disk /dev/sdc: 8589 MB, 8589934592 bytes, 16777216 sectors</span></p>
<p><span class="font19">Disk /dev/sdd: 8589 MB, 8589934592 bytes, 16777216 sectors</span></p>
<p><span class="font19">Disk /dev/sde: 2147 MB, 2147483648 bytes, 4194304 sectors</span></p>
<p><span class="font19">Disk /dev/sdf: 2147 MB, 2147483648 bytes, 4194304 sectors</span></p>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">systemctl enable iscsid</span></p>
<p><span class="font19">ln -s '/usr/lib/systemd/system/iscsid.service' '/etc/systemd/system/multi-user.target.wants/is [root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">iscsiadm -m node -T iqn.2015-04.be.linux:target -p 192.168.1.143 -l</span></p>
<p><span class="font19">Logging in to [iface: default, target: iqn.2015-04.be.linux:target, portal: 192.168.1.143,3260</span></p>
<p><span class="font19">Login to [iface: default, target: iqn.2015-04.be.linux:target, portal: 192.168.1.143,3260] suc [root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">fdisk -l 2&gt;/dev/null | grep sd</span></p>
<p><span class="font19">Disk /dev/sda: 22.0 GB, 22038806528 bytes, 43044544 sectors</span></p>
<p><span class="font19">/dev/sda1 &nbsp;&nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2048 &nbsp;&nbsp;&nbsp;&nbsp;1026047 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;512000 &nbsp;&nbsp;83 &nbsp;Linux</span></p>
<p><span class="font19">/dev/sda2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1026048 &nbsp;&nbsp;&nbsp;43042815 &nbsp;&nbsp;&nbsp;21008384 &nbsp;&nbsp;8e &nbsp;Linux LVM</span></p>
<div>
<p><span class="font19">Disk /dev/sdb: 8589 MB, 8589934592 bytes, 16777216 sectors</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdb1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2048</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">821247</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">409600</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">83</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Linux</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdb2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">821248</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1640447</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">409600</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">83</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Linux</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/sdb3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1640448</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2459647</span></p></td><td style="vertical-align:top;">
<p><span class="font19">409600</span></p></td><td style="vertical-align:top;">
<p><span class="font19">83</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Linux</span></p></td></tr>
</table>
</div><br clear="all">
<div>
<p><span class="font19">Disk /dev/sdc: 8589 MB,</span></p>
<p><span class="font19">Disk /dev/sdd: 8589 MB,</span></p>
<p><span class="font19">Disk /dev/sde: 2147 MB,</span></p>
<p><span class="font19">Disk /dev/sdf: 2147 MB,</span></p>
<p><span class="font19">Disk /dev/sdg: 8589 MB,</span></p>
<p><span class="font19">Disk /dev/sdh: 8589 MB,</span></p>
<p><span class="font19">Disk /dev/sdi: 8589 MB,</span></p>
</div><br clear="all">
<div>
<p><span class="font19">8589934592 bytes, 8589934592 bytes, 2147483648 bytes, 2147483648 bytes, 8589934592 bytes, 8589934592 bytes, 8589934592 bytes,</span></p>
</div><br clear="all">
<div>
<p><span class="font19">16777216 sectors</span></p>
<p><span class="font19">16777216 sectors</span></p>
<p><span class="font19">4194304 sectors</span></p>
<p><span class="font19">4194304 sectors</span></p>
<p><span class="font19">16777216 sectors</span></p>
<p><span class="font19">16777216 sectors</span></p>
<p><span class="font19">16777216 sectors</span></p>
</div><br clear="all">
<p><span class="font19">[root@centos7 ~]#</span></p>
<ul style="list-style:none;"><li>
<p><a name="bookmark4354"></a><span class="font11" style="font-weight:bold;">Chapter 14. introduction to multipathing</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4355"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3098"></a><a name="bookmark4356"></a>14.1. install multipath</span></h2></li></ul>
<h4><a name="bookmark4357"></a><span class="font25"><a name="bookmark4358"></a><a name="bookmark4359"></a>RHEL and CentOS need the </span><span class="font25" style="font-weight:bold;">device-mapper-multipath </span><span class="font25">package.</span></h4>
<p><span class="font19">yum install device-mapper-multipath</span></p>
<p><span class="font25">This will create a sample multipath.conf in </span><span class="font25" style="font-weight:bold;">/usr/share/doc/device-mapper-multipath-0.4.9/multipath.conf</span><span class="font25">.</span></p>
<h4><a name="bookmark4360"></a><span class="font25"><a name="bookmark4361"></a>There is no </span><span class="font25" style="font-weight:bold;">/etc/multipath.conf </span><span class="font25">until you initialize it with </span><span class="font25" style="font-weight:bold;">mpathconf</span><span class="font25">.</span></h4>
<p><span class="font19">[root@server2 ~]# mpathconf --enable --with_multipathd y</span></p>
<p><span class="font19">Starting multipathd daemon: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p>
<p><span class="font19">[root@server2 ~]# wc -l /etc/multipath.conf 99 /etc/multipath.conf</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4362"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3099"></a><a name="bookmark4363"></a>14.2. configure multipath</span></h2></li></ul>
<h4><a name="bookmark4364"></a><span class="font25"><a name="bookmark4365"></a>You can now choose to either edit </span><span class="font25" style="font-weight:bold;">/etc/multipath.conf </span><span class="font25">or use </span><span class="font25" style="font-weight:bold;">mpathconf </span><span class="font25">to change this file for you.</span></h4>
<p><span class="font19">[root@server2 ~]# grep user_friendly_names /etc/multipath.conf user_friendly_names yes</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># user_friendly_names yes [root@server2 ~]# mpathconf --enable --user_friendly_names n [root@server2 ~]# grep user_friendly_names /etc/multipath.conf</span></p></li></ul>
<p><span class="font19">user_friendly_names no # user_friendly_names yes [root@server2 ~]# mpathconf --enable --user_friendly_names y [root@server2 ~]# grep user_friendly_names /etc/multipath.conf</span></p>
<p><span class="font19">user_friendly_names yes # user_friendly_names yes</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4366"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3100"></a><a name="bookmark4367"></a>14.3. network</span></h2></li></ul>
<h4><a name="bookmark4368"></a><span class="font25"><a name="bookmark4369"></a>This example uses three networks, make sure the iSCSI Target is connected to all three networks.</span></h4>
<p><span class="font19">[root@server1 tgt]# ifconfig | grep -B1 192.168</span></p>
<p><span class="font19">ethl Link encap:Ethernet HWaddr 08:00:27:4E:AB:8E</span></p>
<table border="1">
<tr><td rowspan="2" style="vertical-align:middle;">
<p><span class="font19">—</span></p>
<p><span class="font19">eth2</span></p>
<p><span class="font19">—</span></p>
<p><span class="font19">eth3</span></p></td><td rowspan="2" style="vertical-align:top;">
<p><span class="font19">inet</span></p>
<p><span class="font19">Link inet</span></p>
<p><span class="font19">Link inet</span></p></td><td rowspan="2" style="vertical-align:top;">
<p><span class="font19">addr:192.168.1.98 Bcast:192.168</span></p>
<p><span class="font19">encap:Ethernet HWaddr 08:00:27: addr:192.168.2.98 &nbsp;Bcast:192.168</span></p>
<p><span class="font19">encap:Ethernet HWaddr 08:00:27: addr:192.168.3.98 &nbsp;Bcast:192.168</span></p></td><td colspan="2" style="vertical-align:top;">
<p><span class="font19">.1.255</span></p>
<p><span class="font19">3F:A9:D1</span></p>
<p><span class="font19">.2.255</span></p></td><td rowspan="2" style="vertical-align:top;">
<p><span class="font19">Mask:255.255.255.0</span></p>
<p><span class="font19">Mask:255.255.255.0</span></p>
<p><span class="font19">Mask:255.255.255.0</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">94:52:</span></p>
<p><span class="font19">.3.255</span></p></td><td style="vertical-align:top;">
<p><span class="font19">26</span></p></td></tr>
<tr><td colspan="3" style="vertical-align:middle;">
<p><span class="font25">The same must be true for the multipath Initiator:</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td colspan="2" style="vertical-align:top;">
<p><span class="font19">[root@server2 -eth1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Link</span></p>
<p><span class="font19">inet</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-]# ifconfig | grep -B1 192.168 encap:Ethernet HWaddr 08:00:27: addr:192.168.1.99 Bcast:192.168</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">A1:43:</span></p>
<p><span class="font19">.1.255</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">41</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Mask:255.255.255.0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">—</span></p>
<p><span class="font19">eth2</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">Link inet</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">encap:Ethernet HWaddr 08:00:27:</span></p>
<p><span class="font19">addr:192.168.2.99 Bcast:192.168</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">12:A8:</span></p>
<p><span class="font19">.2.255</span></p></td><td style="vertical-align:top;">
<p><span class="font19">70</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Mask:255.255.255.0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">—</span></p>
<p><span class="font19">eth3</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">Link inet</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">encap:Ethernet HWaddr 08:00:27:</span></p>
<p><span class="font19">addr:192.168.3.99 Bcast:192.168</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">6E:99:</span></p>
<p><span class="font19">.3.255</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">9B</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Mask:255.255.255.0</span></p></td></tr>
</table>
<h4><a name="bookmark4370"></a><span class="font25"><a name="bookmark4371"></a>Test the triple discovery in three networks (screenshot newer than above).</span></h4>
<p><span class="font19">[root@centos7 ~]# iscsiadm -m discovery -t st -p 192.168.1.150 192.168.1.150:3260,1 iqn.2015-04.be.linux:target1 [root@centos7 ~]# iscsiadm -m discovery -t st -p 192.168.2.150</span></p>
<p><span class="font19">192.168.2.150:3260,1 iqn.2015-04.be.linux:target1 [root@centos7 ~]# iscsiadm -m discovery -t st -p 192.168.3.150 192.168.3.150:3260,1 iqn.2015-04.be.linux:target1</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4372"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3101"></a><a name="bookmark4373"></a>14.4. start multipathd and iscsi</span></h2></li></ul>
<h4><a name="bookmark4374"></a><span class="font25"><a name="bookmark4375"></a>Time to start (or restart) both the multipathd and iscsi services:</span></h4>
<p><span class="font19">[root@server2 ~]# </span><span class="font19" style="font-weight:bold;">service multipathd restart</span></p>
<p><a href="#bookmark4376"><span class="font19">Stopping multipathd daemon: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ &nbsp;OK</span></a></p>
<p><a href="#bookmark4377"><span class="font19">Starting multipathd daemon: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ &nbsp;OK</span></a></p>
<p><span class="font19">[root@server2 ~]# </span><span class="font19" style="font-weight:bold;">service iscsi restart</span></p>
<p><a href="#bookmark4378"><span class="font19">Stopping iscsi: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ &nbsp;OK</span></a></p>
<p><a href="#bookmark4379"><span class="font19">Starting iscsi: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ &nbsp;OK</span></a></p>
<h4><a name="bookmark4380"></a><span class="font25"><a name="bookmark4381"></a>This shows </span><span class="font25" style="font-weight:bold;">fdisk </span><span class="font25">output when leaving the default friendly_names option to yes. The bottom three are the multipath devices to use.</span></h4>
<p><span class="font19">[root@server2 ~]# </span><span class="font19" style="font-weight:bold;">fdisk -l | grep Disk</span></p>
<p><span class="font19">Disk /dev/sda: 42.9 GB, 42949672960 bytes</span></p>
<p><span class="font19">Disk identifier: 0x0004f229</span></p>
<p><span class="font19">Disk /dev/sdb: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdc: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdd: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sde: 2147 MB, 2147483648 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdf: 2147 MB, 2147483648 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdg: 2147 MB, 2147483648 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/mapper/VolGroup-lv_root: 41.4 GB, 41448112128 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/mapper/VolGroup-lv_swap: 973 MB, 973078528 bytes Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdh: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdi: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdj: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdl: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdn: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdk: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdm: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdp: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/sdo: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/mapper/mpathh: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/mapper/mpathi: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000</span></p>
<p><span class="font19">Disk /dev/mapper/mpathj: 1073 MB, 1073741824 bytes</span></p>
<p><span class="font19">Disk identifier: 0x00000000 [root@server2 ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4382"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3102"></a><a name="bookmark4383"></a>14.5. multipath list</span></h2></li></ul>
<h4><a name="bookmark4384"></a><span class="font25"><a name="bookmark4385"></a>You can list the multipath connections and devices with </span><span class="font25" style="font-weight:bold;">multipath -ll</span><span class="font25">.</span></h4>
<p><span class="font19">[root@server2 ~]# </span><span class="font19" style="font-weight:bold;">multipath -ll</span></p>
<p><span class="font19">mpathj (1IET 00010001) dm-4 Reddy,VBOX HARDDISK</span></p>
<p><span class="font19">size=1.0G features='0' hwhandler='0' wp=rw</span></p>
<p><span class="font19">|-+- policy='round-robin 0' prio=1 status=active</span></p>
<p><span class="font19">| '- 13:0:0:1 sdh 8:112 active ready running</span></p>
<p><span class="font19">|-+- policy='round-robin 0' prio=1 status=enabled</span></p>
<p><span class="font19">| '- 12:0:0:1 sdi 8:128 active ready running</span></p>
<p><span class="font19">'-+- policy='round-robin 0' prio=1 status=enabled '- 14:0:0:1 sdm 8:192 active ready running</span></p>
<p><span class="font19">mpathi (1IET 00010003) dm-3 Reddy,VBOX HARDDISK</span></p>
<p><span class="font19">size=1.0G features='0' hwhandler='0' wp=rw</span></p>
<p><span class="font19">|-+- policy='round-robin 0' prio=1 status=active</span></p>
<p><span class="font19">| '- 13:0:0:3 sdk 8:160 active ready running</span></p>
<p><span class="font19">|-+- policy='round-robin 0' prio=1 status=enabled</span></p>
<p><span class="font19">| '- 12:0:0:3 sdn 8:208 active ready running</span></p>
<p><span class="font19">'-+- policy='round-robin 0' prio=1 status=enabled '- 14:0:0:3 sdp 8:240 active ready running</span></p>
<p><span class="font19">mpathh (1IET 00010002) dm-2 Reddy,VBOX HARDDISK</span></p>
<p><span class="font19">size=1.0G features='0' hwhandler='0' wp=rw</span></p>
<p><span class="font19">|-+- policy='round-robin 0' prio=1 status=active</span></p>
<p><span class="font19">| '- 12:0:0:2 sdl 8:176 active ready running</span></p>
<p><span class="font19">|-+- policy='round-robin 0' prio=1 status=enabled</span></p>
<p><span class="font19">| '- 13:0:0:2 sdj 8:144 active ready running</span></p>
<p><span class="font19">'-+- policy='round-robin 0' prio=1 status=enabled</span></p>
<p><span class="font19">'- 14:0:0:2 sdo 8:224 active ready running</span></p>
<p><span class="font19">[root@server2 ~]#</span></p>
<h4><a name="bookmark4386"></a><span class="font25"><a name="bookmark4387"></a>The IET (iSCSI Enterprise Target) ID should match the ones you see on the Target server.</span></h4>
<p><span class="font19">[root@server1 ~]# tgt-admin -s | grep -e LUN -e IET -e dev LUN information:</span></p>
<p><span class="font19">LUN: 0</span></p>
<p><span class="font19">SCSI ID: IET &nbsp;&nbsp;&nbsp;&nbsp;00010000</span></p>
<p><span class="font19">LUN: 1</span></p>
<p><span class="font19">SCSI ID: IET &nbsp;&nbsp;&nbsp;&nbsp;00010001</span></p>
<p><span class="font19">Backing store path: /dev/sdb</span></p>
<p><span class="font19">LUN: 2</span></p>
<p><span class="font19">SCSI ID: IET 00010002</span></p>
<p><span class="font19">Backing store path: /dev/sdc</span></p>
<p><span class="font19">LUN: 3</span></p>
<p><span class="font19">SCSI ID: IET 00010003</span></p>
<p><span class="font19">Backing store path: /dev/sdd</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4388"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3103"></a><a name="bookmark4389"></a>14.6. using the device</span></h2></li></ul>
<h4><a name="bookmark4390"></a><span class="font25"><a name="bookmark4391"></a>The rest is standard mkfs, mkdir, mount:</span></h4>
<p><span class="font19">[root@server2 ~]# </span><span class="font19" style="font-weight:bold;">mkfs.ext4 /dev/mapper/mpathi </span><span class="font19">mke2fs 1.41.12 (17-May-2010) Filesystem label= OS type: Linux Block size=4096 (log=2) Fragment size=4096 (log=2)</span></p>
<p><span class="font19">Stride=0 blocks, Stripe width=0 blocks 65536 inodes, 262144 blocks 13107 blocks (5.00%) reserved for the super user First data block=0</span></p>
<p><span class="font19">Maximum filesystem blocks=268435456 8 block groups</span></p>
<p><span class="font19">32768 blocks per group, 32768 fragments per group</span></p>
<p><span class="font19">8192 inodes per group</span></p>
<p><span class="font19">Superblock backups stored on blocks: 32768, 98304, 163840, 229376</span></p>
<p><span class="font19">Writing inode tables: done</span></p>
<p><span class="font19">Creating journal (8192 blocks): done</span></p>
<p><span class="font19">Writing superblocks and filesystem accounting information: done</span></p>
<p><span class="font19">This filesystem will be automatically checked every 38 mounts or 180 days, whichever comes first. Use tune2fs -c or -i to override. [root@server2 ~]# </span><span class="font19" style="font-weight:bold;">mkdir /srv/multipath </span><span class="font19">[root@server2 ~]# </span><span class="font19" style="font-weight:bold;">mount /dev/mapper/mpathi /srv/multipath/ </span><span class="font19">[root@server2 ~]# </span><span class="font19" style="font-weight:bold;">df -h /srv/multipath/ </span><span class="font19">Filesystem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size Used Avail Use% Mounted on</span></p>
<p><span class="font19">/dev/mapper/mpathi 1008M &nbsp;&nbsp;34M 924M &nbsp;&nbsp;4% /srv/multipath</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4392"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3104"></a><a name="bookmark4393"></a>14.7. practice: multipathing</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Find a partner and decide who will be iSCSI Target and who will be iSCSI Initiator and Multipather. Set up Multipath as we did in the theory.</span></p></li>
<li>
<p><span class="font25">2. Uncomment the big 'defaults' section in /etc/multipath.conf and disable friendly names. Verify that multipath can work. You may need to check the manual for </span><span class="font25" style="font-weight:bold;">/lib/dev/scsi_id </span><span class="font25">and for </span><span class="font25" style="font-weight:bold;">multipath.conf</span><span class="font25">.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4394"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3097"></a><a name="bookmark4395"></a>14.8. solution: multipathing</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark4396"></a><span class="font25"><a name="bookmark4397"></a>1. Find a partner and decide who will be iSCSI Target and who will be iSCSI Initiator and Multipather. Set up Multipath as we did in the theory.</span></h4></li></ul>
<p><span class="font19">Look in the theory...</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark4398"></a><span class="font25"><a name="bookmark4399"></a>2. Uncomment the big 'defaults' section in /etc/multipath.conf and disable friendly names. Verify that multipath can work. You may need to check the manual for </span><span class="font25" style="font-weight:bold;">/lib/dev/scsi_id </span><span class="font25">and for </span><span class="font25" style="font-weight:bold;">multipath.conf</span><span class="font25">.</span></h4></li></ul>
<p><span class="font19">vi multipath.conf</span></p>
<table border="1">
<tr><td rowspan="2" style="vertical-align:top;">
<p><span class="font19">remove # for the big defaults add # for the very small one add the --replace-whitespace</span></p></td><td colspan="4" style="vertical-align:bottom;">
<p><span class="font19">section</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">with friendly_names option to scsi_id.</span></p></td><td colspan="3" style="vertical-align:top;">
<p><span class="font19">active</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">defaults {</span></p>
<p><span class="font19">udev_dir</span></p>
<p><span class="font19">polling_interval path_selector path_grouping_policy getuid_callout</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/dev</span></p>
<p><span class="font19">10</span></p>
<p><span class="font19">&quot;round-robin 0&quot; multibus &quot;/lib/udev/scsi_</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">id -</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">--whitelisted -</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">- -replace\</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-whitespace --device=/dev/%n&quot; prio</span></p>
<p><span class="font19">path_checker rr_min_io max_fds rr_weight failback</span></p>
<p><span class="font19">no_path_retry</span></p>
<p><span class="font19">user friendly names</span></p>
<p><span class="font19">}</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">const readsector0 100</span></p>
<p><span class="font19">8192 priorities immediate fail</span></p>
<p><span class="font19">no</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
</table>
<h4><a name="bookmark4400"></a><span class="font25"><a name="bookmark4401"></a>The names now (after service restart) look like:</span></h4>
<p><span class="font19">root@server2 etc]# multipath -ll</span></p>
<p><span class="font19">1IET_00010001 dm-8 Reddy,VBOX HARDDISK</span></p>
<p><span class="font19">size=1.0G features='0' hwhandler='0' wp=rw</span></p>
<p><span class="font19">'-+- policy='round-robin 0' prio=1 status=active |- 17:0:0:1 sdh 8:112 active ready running</span></p>
<p><span class="font19">|- 16:0:0:1 sdi 8:128 active ready running</span></p>
<p><span class="font19">'- 15:0:0:1 sdn 8:208 active ready running</span></p>
<p><span class="font19">1IET_00010003 dm-10 Reddy,VBOX HARDDISK</span></p>
<p><span class="font19">size=1.0G features='0' hwhandler='0' wp=rw</span></p>
<p><span class="font19">'-+- policy='round-robin 0' prio=1 status=active</span></p>
<p><span class="font19">|- 17:0:0:3 sdl 8:176 active ready running</span></p>
<p><span class="font19">|- 16:0:0:3 sdm 8:192 active ready running</span></p>
<p><span class="font19">'- 15:0:0:3 sdp 8:240 active ready running</span></p>
<p><span class="font19">1IET_00010002 dm-9 Reddy,VBOX HARDDISK size=1.0G features='0' hwhandler='0' wp=rw</span></p>
<div>
<p><span class="font19">'- + -</span></p>
<p><span class="font19">|</span><span class="font3"><sup>-</sup></span></p>
<p><span class="font19">|</span><span class="font3"><sup>-</sup></span></p>
</div><br clear="all">
<p><span class="font19">policy='round-robin 0' prio=1 status=active 17:0:0:2 sdj 8:144 active ready running 16:0:0:2 sdk 8:160 active ready running 15:0:0:2 sdo 8:224 active ready running</span></p>
<h4><a name="bookmark4402"></a><span class="font25"><a name="bookmark4403"></a>Did you blacklist your own devices</span></h4>
<p><span class="font19">vi multipath.conf</span></p>
<p><span class="font19">--&gt; search for blacklist:</span></p>
<p><span class="font19">add</span></p>
<p><span class="font19">devnode &quot;</span><span class="font3"><sup>A</sup></span><span class="font19">sd[a-g]&quot;</span></p>
<p><a name="bookmark4404"></a><span class="font11" style="font-weight:bold;">Part VI. Appendix</span></p>
<h3><a name="bookmark4405"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4406"></a>Table of Contents</span></h3>
<p><a href="#bookmark4407"><span class="font24" style="font-weight:bold;">A. License</span></a></p>
<div>
<p><a href="#bookmark4407"><span class="font24" style="font-weight:bold;">260</span></a></p>
</div><br clear="all">
<h1><a name="bookmark4407"></a><span class="font11" style="font-weight:bold;"><a name="bookmark4408"></a><a name="bookmark4409"></a>Appendix A. License</span></h1>
<p><span class="font19">GNU Free Documentation License</span></p>
<p><span class="font19">Version 1.3, 3 November 2008</span></p>
<p><span class="font19">Copyright © 2000, 2001, 2002, 2007, 2008 Free Software Foundation, Inc.</span></p>
<p><span class="font19">Everyone is permitted to copy and distribute verbatim copies of this license document, but changing it is not allowed.</span></p>
<p><span class="font19">0. PREAMBLE</span></p>
<p><span class="font19">The purpose of this License is to make a manual, textbook, or other functional and useful document &quot;free&quot; in the sense of freedom: to assure everyone the effective freedom to copy and redistribute it, with or without modifying it, either commercially or noncommercially. Secondarily, this License preserves for the author and publisher a way to get credit for their work, while not being considered responsible for modifications made by others.</span></p>
<p><span class="font19">This License is a kind of &quot;copyleft&quot;, which means that derivative works of the document must themselves be free in the same sense. It complements the GNU General Public License, which is a copyleft license designed for free software.</span></p>
<p><span class="font19">We have designed this License in order to use it for manuals for free software, because free software needs free documentation: a free program should come with manuals providing the same freedoms that the software does. But this License is not limited to software manuals; it can be used for any textual work, regardless of subject matter or whether it is published as a printed book. We recommend this License principally for works whose purpose is instruction or reference.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">1. APPLICABILITY AND DEFINITIONS</span></p></li></ul>
<p><span class="font19">This License applies to any manual or other work, in any medium, that contains a notice placed by the copyright holder saying it can be distributed under the terms of this License. Such a notice grants a world-wide, royalty-free license, unlimited in duration, to use that work under the conditions stated herein. The &quot;Document&quot;, below, refers to any such manual or work. Any member of the public is a licensee, and is addressed as &quot;you&quot;. You accept the license if you copy, modify or distribute the work in a way requiring permission under copyright law.</span></p>
<p><span class="font19">A &quot;Modified Version&quot; of the Document means any work containing the Document or a portion of it, either copied verbatim, or with modifications and/or translated into another language.</span></p>
<p><span class="font19">A &quot;Secondary Section&quot; is a named appendix or a front-matter section of the Document that deals exclusively with the relationship of the publishers or authors of the Document to the Document's overall subject (or to related matters) and contains nothing that could fall directly within that overall subject. (Thus, if the Document is in part a textbook of mathematics, a Secondary Section may not explain any mathematics.) The relationship could be a matter of historical connection with the subject or with related matters, or of legal, commercial, philosophical, ethical or political position regarding them.</span></p>
<p><span class="font19">The &quot;Invariant Sections&quot; are certain Secondary Sections whose titles are designated, as being those of Invariant Sections, in the notice that says that the Document is released under this License. If a section does not fit the above definition of Secondary then it is not allowed to be designated as Invariant. The Document may contain zero Invariant Sections. If the Document does not identify any Invariant Sections then there are none.</span></p>
<p><span class="font19">The &quot;Cover Texts&quot; are certain short passages of text that are listed, as Front-Cover Texts or Back-Cover Texts, in the notice that says that the Document is released under this License. A Front-Cover Text may be at most 5 words, and a Back-Cover Text may be at most 25 words.</span></p>
<p><span class="font19">A &quot;Transparent&quot; copy of the Document means a machine-readable copy, represented in a format whose specification is available to the general public, that is suitable for revising the document straightforwardly with generic text editors or (for images composed of pixels) generic paint programs or (for drawings) some widely available drawing editor, and that is suitable for input to text formatters or for automatic translation to a variety of formats suitable for input to text formatters. A copy made in an otherwise Transparent file format whose markup, or absence of markup, has been arranged to thwart or discourage subsequent modification by readers is not Transparent. An image format is not Transparent if used for any substantial amount of text. A copy that is not &quot;Transparent&quot; is called &quot;Opaque&quot;.</span></p>
<p><span class="font19">Examples of suitable formats for Transparent copies include plain ASCII without markup, Texinfo input format, LaTeX input format, SGML or XML using a publicly available DTD, and standard-conforming simple HTML, PostScript or PDF designed for human modification. Examples of transparent image formats include PNG, XCF and JPG. Opaque formats include proprietary formats that can be read and edited only by proprietary word processors, SGML or XML for which the DTD and/or processing tools are not generally available, and the machine-generated HTML, PostScript or PDF produced by some word processors for output purposes only.</span></p>
<p><span class="font19">The &quot;Title Page&quot; means, for a printed book, the title page itself, plus such following pages as are needed to hold, legibly, the material this License requires to appear in the title page. For works in formats which do not have any title page as such, &quot;Title Page&quot; means the text near the most prominent appearance of the work's title, preceding the beginning of the body of the text.</span></p>
<p><span class="font19">The &quot;publisher&quot; means any person or entity that distributes copies of the Document to the public.</span></p>
<p><span class="font19">A section &quot;Entitled XYZ&quot; means a named subunit of the Document whose title either is precisely XYZ or contains XYZ in parentheses following text that translates XYZ in another language. (Here XYZ stands for a specific section name mentioned below, such as &quot;Acknowledgements&quot;, &quot;Dedications&quot;, &quot;Endorsements&quot;, or &quot;History&quot;.) To &quot;Preserve the Title&quot; of such a section when you modify the Document means that it remains a section &quot;Entitled XYZ&quot; according to this definition.</span></p>
<p><span class="font19">The Document may include Warranty Disclaimers next to the notice which states that this License applies to the Document. These Warranty Disclaimers are considered to be included by reference in this License, but only as regards disclaiming warranties: any other implication that these Warranty Disclaimers may have is void and has no effect on the meaning of this License.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">2. VERBATIM COPYING</span></p></li></ul>
<p><span class="font19">You may copy and distribute the Document in any medium, either commercially or noncommercially, provided that this License, the copyright notices, and the license notice saying this License applies to the Document are reproduced in all copies, and that you add no other conditions whatsoever to those of this License. You may not use technical measures to obstruct or control the reading or further copying of the copies you make or distribute. However, you may accept compensation in exchange for copies. If you distribute a large enough number of copies you must also follow the conditions in section 3.</span></p>
<p><span class="font19">You may also lend copies, under the same conditions stated above, and you may publicly display copies.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">3. COPYING IN QUANTITY</span></p></li></ul>
<p><span class="font19">If you publish printed copies (or copies in media that commonly have printed covers) of the Document, numbering more than 100, and the Document's license notice requires Cover Texts, you must enclose the copies in covers that carry, clearly and legibly, all these Cover Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on the back cover. Both covers must also clearly and legibly identify you as the publisher of these copies. The front cover must present the full title with all words of the title equally prominent and visible. You may add other material on the covers in addition. Copying with changes limited to the covers, as long as they preserve the title of the Document and satisfy these conditions, can be treated as verbatim copying in other respects.</span></p>
<p><span class="font19">If the required texts for either cover are too voluminous to fit legibly, you should put the first ones listed (as many as fit reasonably) on the actual cover, and continue the rest onto adjacent pages.</span></p>
<p><span class="font19">If you publish or distribute Opaque copies of the Document numbering more than 100, you must either include a machine-readable Transparent copy along with each Opaque copy, or state in or with each Opaque copy a computer-network location from which the general network-using public has access to download using public-standard network protocols a complete Transparent copy of the Document, free of added material. If you use the latter option, you must take reasonably prudent steps, when you begin distribution of Opaque copies in quantity, to ensure that this Transparent copy will remain thus accessible at the stated location until at least one year after the last time you distribute an Opaque copy (directly or through your agents or retailers) of that edition to the public.</span></p>
<p><span class="font19">It is requested, but not required, that you contact the authors of the Document well before redistributing any large number of copies, to give them a chance to provide you with an updated version of the Document.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">4. MODIFICATIONS</span></p></li></ul>
<p><span class="font19">You may copy and distribute a Modified Version of the Document under the conditions of sections 2 and 3 above, provided that you release the Modified Version under precisely this License, with the Modified Version filling the role of the Document, thus licensing distribution and modification of the Modified Version to whoever possesses a copy of it. In addition, you must do these things in the Modified Version:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">* A. Use in the Title Page (and on the covers, if any) a title distinct from that of the Document, and from those of previous versions (which should, if there were any, be listed in the History section of the Document). You may use the same title as a previous version if the original publisher of that version gives permission.</span></p></li>
<li>
<p><span class="font19">* B. List on the Title Page, as authors, one or more persons or entities responsible for authorship of the modifications in the Modified Version, together with at least five of the principal authors of the Document (all of its principal authors, if it has fewer than five), unless they release you from this requirement.</span></p></li>
<li>
<p><span class="font19">* C. State on the Title page the name of the publisher of the Modified Version, as the publisher.</span></p></li>
<li>
<p><span class="font19">* D. Preserve all the copyright notices of the Document.</span></p></li>
<li>
<p><span class="font19">* E. Add an appropriate copyright notice for your modifications adjacent to the other copyright notices.</span></p></li>
<li>
<p><span class="font19">* F. Include, immediately after the copyright notices, a license notice giving the public permission to use the Modified Version under the terms of this License, in the form shown in the Addendum below.</span></p></li>
<li>
<p><span class="font19">* G. Preserve in that license notice the full lists of Invariant Sections and required Cover Texts given in the Document's license notice.</span></p></li>
<li>
<p><span class="font19">* H. Include an unaltered copy of this License.</span></p></li>
<li>
<p><span class="font19">* I. Preserve the section Entitled &quot;History&quot;, Preserve its Title, and add to it an item stating at least the title, year, new authors, and publisher of the Modified Version as given on the Title Page. If there is no section Entitled &quot;History&quot; in the Document, create one stating the title, year, authors, and publisher of the Document as given on its Title Page, then add an item describing the Modified Version as stated in the previous sentence.</span></p></li>
<li>
<p><span class="font19">* J. Preserve the network location, if any, given in the Document for public access to a Transparent copy of the Document, and likewise the network locations given in the Document for previous versions it was based on. These may be placed in the &quot;History&quot; section. You may omit a network location for a work that was published at least four years before the Document itself, or if the original publisher of the version it refers to gives permission.</span></p></li>
<li>
<p><span class="font19">* K. For any section Entitled &quot;Acknowledgements&quot; or &quot;Dedications&quot;, Preserve the Title of the section, and preserve in the section all the substance and tone of each of the contributor acknowledgements and/or dedications given therein.</span></p></li>
<li>
<p><span class="font19">* L. Preserve all the Invariant Sections of the Document, unaltered in their text and in their titles. Section numbers or the equivalent are not considered part of the section titles.</span></p></li>
<li>
<p><span class="font19">* M. Delete any section Entitled &quot;Endorsements&quot;. Such a section may not be included in the Modified Version.</span></p></li>
<li>
<p><span class="font19">* N. Do not retitle any existing section to be Entitled &quot;Endorsements&quot; or to conflict in title with any Invariant Section.</span></p></li>
<li>
<p><span class="font19">* O. Preserve any Warranty Disclaimers.</span></p></li></ul>
<p><span class="font19">If the Modified Version includes new front-matter sections or appendices that qualify as Secondary Sections and contain no material copied from the Document, you may at your option designate some or all of these sections as invariant. To do this, add their titles to the list of Invariant Sections in the Modified Version's license notice. These titles must be distinct from any other section titles.</span></p>
<p><span class="font19">You may add a section Entitled &quot;Endorsements&quot;, provided it contains nothing but endorsements of your Modified Version by various parties—for example, statements of peer review or that the text has been approved by an organization as the authoritative definition of a standard.</span></p>
<p><span class="font19">You may add a passage of up to five words as a Front-Cover Text, and a passage of up to 25 words as a Back-Cover Text, to the end of the list of Cover Texts in the Modified Version. Only one passage of Front-Cover Text and one of Back-Cover Text may be added by (or through arrangements made by) any one entity. If the Document already includes a cover text for the same cover, previously added by you or by arrangement made by the same entity you are acting on behalf of, you may not add another; but you may replace the old one, on explicit permission from the previous publisher that added the old one.</span></p>
<p><span class="font19">The author(s) and publisher(s) of the Document do not by this License give permission to use their names for publicity for or to assert or imply endorsement of any Modified Version.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">5. COMBINING DOCUMENTS</span></p></li></ul>
<p><span class="font19">You may combine the Document with other documents released under this License, under the terms defined in section 4 above for modified versions, provided that you include in the combination all of the Invariant Sections of all of the original documents, unmodified, and list them all as Invariant Sections of your combined work in its license notice, and that you preserve all their Warranty Disclaimers.</span></p>
<p><span class="font19">The combined work need only contain one copy of this License, and multiple identical Invariant Sections may be replaced with a single copy. If there are multiple Invariant Sections with the same name but different contents, make the title of each such section unique by adding at the end of it, in parentheses, the name of the original author or publisher of that section if known, or else a unique number. Make the same adjustment to the section titles in the list of Invariant Sections in the license notice of the combined work.</span></p>
<p><span class="font19">In the combination, you must combine any sections Entitled &quot;History&quot; in the various original documents, forming one section Entitled &quot;History&quot;; likewise combine any sections Entitled &quot;Acknowledgements&quot;, and any sections Entitled &quot;Dedications&quot;. You must delete all sections Entitled &quot;Endorsements&quot;.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">6. COLLECTIONS OF DOCUMENTS</span></p></li></ul>
<p><span class="font19">You may make a collection consisting of the Document and other documents released under this License, and replace the individual copies of this License in the various documents with a single copy that is included in the collection, provided that you follow the rules of this License for verbatim copying of each of the documents in all other respects.</span></p>
<p><span class="font19">You may extract a single document from such a collection, and distribute it individually under this License, provided you insert a copy of this License into the extracted document, and follow this License in all other respects regarding verbatim copying of that document.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">7. AGGREGATION WITH INDEPENDENT WORKS</span></p></li></ul>
<p><span class="font19">A compilation of the Document or its derivatives with other separate and independent documents or works, in or on a volume of a storage or distribution medium, is called an &quot;aggregate&quot; if the copyright resulting from the compilation is not used to limit the legal rights of the compilation's users beyond what the individual works permit. When the Document is included in an aggregate, this License does not apply to the other works in the aggregate which are not themselves derivative works of the Document.</span></p>
<p><span class="font19">If the Cover Text requirement of section 3 is applicable to these copies of the Document, then if the Document is less than one half of the entire aggregate, the Document's Cover Texts may be placed on covers that bracket the Document within the aggregate, or the electronic equivalent of covers if the Document is in electronic form. Otherwise they must appear on printed covers that bracket the whole aggregate.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">8. TRANSLATION</span></p></li></ul>
<p><span class="font19">Translation is considered a kind of modification, so you may distribute translations of the Document under the terms of section 4. Replacing Invariant Sections with translations requires special permission from their copyright holders, but you may include translations of some or all Invariant Sections in addition to the original versions of these Invariant Sections. You may include a translation of this License, and all the license notices in the Document, and any Warranty Disclaimers, provided that you also include the original English version of this License and the original versions of those notices and disclaimers. In case of a disagreement between the translation and the original version of this License or a notice or disclaimer, the original version will prevail.</span></p>
<p><span class="font19">If a section in the Document is Entitled &quot;Acknowledgements&quot;, &quot;Dedications&quot;, or &quot;History&quot;, the requirement (section 4) to Preserve its Title (section 1) will typically require changing the actual title.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">9. TERMINATION</span></p></li></ul>
<p><span class="font19">You may not copy, modify, sublicense, or distribute the Document except as expressly provided under this License. Any attempt otherwise to copy, modify, sublicense, or distribute it is void, and will automatically terminate your rights under this License.</span></p>
<p><span class="font19">However, if you cease all violation of this License, then your license from a particular copyright holder is reinstated (a) provisionally, unless and until the copyright holder explicitly and finally terminates your license, and (b) permanently, if the copyright holder fails to notify you of the violation by some reasonable means prior to 60 days after the cessation.</span></p>
<p><span class="font19">Moreover, your license from a particular copyright holder is reinstated permanently if the copyright holder notifies you of the violation by some reasonable means, this is the first time you have received notice of violation of this License (for any work) from that copyright holder, and you cure the violation prior to 30 days after your receipt of the notice.</span></p>
<p><span class="font19">Termination of your rights under this section does not terminate the licenses of parties who have received copies or rights from you under this License. If your rights have been terminated and not permanently reinstated, receipt of a copy of some or all of the same material does not give you any rights to use it.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">10. FUTURE REVISIONS OF THIS LICENSE</span></p></li></ul>
<p><span class="font19">The Free Software Foundation may publish new, revised versions of the GNU Free Documentation License from time to time. Such new versions will be similar in spirit to the present version, but may differ in detail to address new problems or concerns. See </span><a href="http://www.gnu.org/copyleft/"><span class="font19">http://www.gnu.org/copyleft/</span></a><span class="font19">.</span></p>
<p><span class="font19">Each version of the License is given a distinguishing version number. If the Document specifies that a particular numbered version of this License &quot;or any later version&quot; applies to it, you have the option of following the terms and conditions either of that specified version or of any later version that has been published (not as a draft) by the Free Software Foundation. If the Document does not specify a version number of this License, you may choose any version ever published (not as a draft) by the Free Software Foundation. If the Document specifies that a proxy can decide which future versions of this License can be used, that proxy's public statement of acceptance of a version permanently authorizes you to choose that version for the Document.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">11. RELICENSING</span></p></li></ul>
<p><span class="font19">&quot;Massive Multiauthor Collaboration Site&quot; (or &quot;MMC Site&quot;) means any World Wide Web server that publishes copyrightable works and also provides prominent facilities for anybody to edit those works. A public wiki that anybody can edit is an example of such a server. A &quot;Massive Multiauthor Collaboration&quot; (or &quot;MMC&quot;) contained in the site means any set of copyrightable works thus published on the MMC site.</span></p>
<p><span class="font19">&quot;CC-BY-SA&quot; means the Creative Commons Attribution-Share Alike 3.0 license published by Creative Commons Corporation, a not-for-profit corporation with a principal place of business in San Francisco, California, as well as future copyleft versions of that license published by that same organization.</span></p>
<p><span class="font19">&quot;Incorporate&quot; means to publish or republish a Document, in whole or in part, as part of another Document.</span></p>
<p><span class="font19">An MMC is &quot;eligible for relicensing&quot; if it is licensed under this License, and if all works that were first published under this License somewhere other than this MMC, and subsequently incorporated in whole or in part into the MMC, (1) had no cover texts or invariant sections, and (2) were thus incorporated prior to November 1, 2008.</span></p>
<p><span class="font19">The operator of an MMC Site may republish an MMC contained in the site under CC-BY-SA on the same site at any time before August 1, 2009, provided the MMC is eligible for relicensing.</span></p>
<h1><a name="bookmark4410"></a><span class="font11" style="font-weight:bold;"><a name="bookmark3214"></a><a name="bookmark4411"></a>Index</span></h1>
<p><span class="font7" style="font-weight:bold;">Symbols</span></p>
<p><span class="font24">/bin/dmesg, </span><a href="#bookmark3393"><span class="font24">40</span></a></p>
<p><span class="font24">/dev, </span><a href="#bookmark3485"><span class="font24">51</span></a></p>
<p><span class="font24">/dev/hdX,</span><a href="#bookmark3368"><span class="font24"> 38</span></a></p>
<p><span class="font24">/dev/ht, 161</span></p>
<p><span class="font24">/dev/nst, 161</span></p>
<p><span class="font24">/dev/sdb, </span><a href="#bookmark3876"><span class="font24">92</span></a></p>
<p><span class="font24">/dev/sdX,</span><a href="#bookmark3370"><span class="font24"> 38</span></a></p>
<p><span class="font24">/dev/st, 161</span></p>
<p><span class="font24">/etc/filesystems,</span><a href="#bookmark3642"><span class="font24"> 64</span></a><span class="font24">, </span><a href="#bookmark3706"><span class="font24">71</span></a></p>
<p><span class="font24">/etc/fstab, 22, </span><a href="#bookmark3666"><span class="font24">67</span></a><span class="font24">, </span><a href="#bookmark3741"><span class="font24">75</span></a><span class="font24">, </span><a href="#bookmark3875"><span class="font24">92</span></a></p>
<p><span class="font24">/etc/group, 4, 173</span></p>
<p><span class="font24">/etc/inetd.conf, 203</span></p>
<p><span class="font24">/etc/init.d/samba, 192</span></p>
<p><span class="font24">/etc/init.d/smb, 192</span></p>
<p><span class="font24">/etc/init.d/winbind, 193</span></p>
<p><span class="font24">/etc/lvm/.cache,</span><a href="#bookmark4051"><span class="font24"> 117</span></a></p>
<p><span class="font24">/etc/mtab, </span><a href="#bookmark3716"><span class="font24">72</span></a></p>
<p><span class="font24">/etc/nsswitch.conf, 241, 243</span></p>
<p><span class="font24">/etc/passwd, 4, 173, 250</span></p>
<p><span class="font24">/etc/raidtab,</span><a href="#bookmark3927"><span class="font24"> 100</span></a></p>
<p><span class="font24">/etc/samba/passdb.tdb, 249</span></p>
<p><span class="font24">/etc/samba/smb.conf, 197, 198, 199, 215, 239</span></p>
<p><span class="font24">/etc/samba/smbpasswd, 220, 247</span></p>
<p><span class="font24">/etc/shadow, 17</span></p>
<p><span class="font24">/etc/xinetd.d/swat, 203</span></p>
<p><span class="font24">/proc/devices, </span><a href="#bookmark3486"><span class="font24">51</span></a><span class="font24">, </span><a href="#bookmark3488"><span class="font24">51</span></a></p>
<p><span class="font24">/proc/filesystems, </span><a href="#bookmark3643"><span class="font24">64</span></a><span class="font24">, </span><a href="#bookmark3711"><span class="font24">71</span></a></p>
<p><span class="font24">/proc/mdstat,</span><a href="#bookmark3939"><span class="font24"> 100</span></a></p>
<p><span class="font24">/proc/mounts, </span><a href="#bookmark3717"><span class="font24">72</span></a></p>
<p><span class="font24">/proc/partitions,</span><a href="#bookmark3487"><span class="font24"> 51</span></a></p>
<p><span class="font24">/proc/scsi/scsi, </span><a href="#bookmark3418"><span class="font24">43</span></a></p>
<p><span class="font24">/tmp, 16</span></p>
<p><span class="font24">/usr/bin/getfacl, 22</span></p>
<p><span class="font24">/usr/bin/passwd, 17</span></p>
<p><span class="font24">/usr/bin/setfacl, 22</span></p>
<p><span class="font24">.. (directory), 27</span></p>
<p><span class="font24">. (directory), 27</span></p>
<p><span class="font24">.my.cnf, 174</span></p>
<p><span class="font24">777, 10</span></p>
<p><span class="font7" style="font-weight:bold;">A</span></p>
<p><span class="font24">access control list, 22</span></p>
<p><span class="font24">access time,</span><a href="#bookmark3337"><span class="font24"> 36</span></a></p>
<p><span class="font24">acl, 24</span></p>
<p><span class="font24">acls, 22</span></p>
<p><span class="font24">allow hosts (Samba), 232</span></p>
<p><span class="font24">aptitude, 189, 190</span></p>
<p><span class="font24">aptitude(8), 172</span></p>
<p><span class="font24">ata,</span><a href="#bookmark3341"><span class="font24"> 36</span></a></p>
<p><span class="font24">atapi,</span><a href="#bookmark3348"><span class="font24"> 36</span></a></p>
<p><span class="font7" style="font-weight:bold;">B</span></p>
<p><span class="font24">badblocks(8), </span><a href="#bookmark3430"><span class="font24">44</span></a></p>
<div>
<p><span class="font24">block device,</span><a href="#bookmark3356"><span class="font24"> 37</span></a></p>
<p><span class="font24">browsable (Samba), 233</span></p>
<p><span class="font24">browseable (Samba), 233</span></p>
<p><span class="font24">browser master, 247</span></p>
<p><span class="font24">btrfs,</span><a href="#bookmark3637"><span class="font24"> 63</span></a></p>
<p><span class="font24">bzip2(1), 162</span></p>
<p><span class="font7" style="font-weight:bold;">C</span></p>
<p><span class="font24">cable select,</span><a href="#bookmark3345"><span class="font24"> 36</span></a></p>
<p><span class="font24">char(mysql), 177</span></p>
<p><span class="font24">character device,</span><a href="#bookmark3357"><span class="font24"> 37</span></a></p>
<p><span class="font24">chattr(1), 165</span></p>
<p><span class="font24">chgrp(1), 5</span></p>
<p><span class="font24">chmod, 10</span></p>
<p><span class="font24">chmod(1), 9</span></p>
<p><span class="font24">chmod +x, 11</span></p>
<p><span class="font24">chown(1), 5</span></p>
<p><span class="font24">chroot,</span><a href="#bookmark3823"><span class="font24"> 84</span></a></p>
<p><span class="font24">CHS,</span><a href="#bookmark3358"><span class="font24"> 37</span></a></p>
<p><span class="font24">CIFS, 194</span></p>
<p><span class="font24">cpio(1), 165</span></p>
<p><span class="font24">create(mysql), 175, 177, 183</span></p>
<p><span class="font24">create mask (Samba), 233</span></p>
<p><span class="font24">cylinder, </span><a href="#bookmark3333"><span class="font24">36</span></a></p>
<p><span class="font7" style="font-weight:bold;">D</span></p>
<p><span class="font24">dd(1),</span><a href="#bookmark3534"><span class="font24"> 55</span></a><span class="font24">, 166</span></p>
<p><span class="font24">delete(mysql), 182</span></p>
<p><span class="font24">deny hosts (Samba), 233</span></p>
<p><span class="font24">describe(mysql), 178</span></p>
<p><span class="font24">device driver, </span><a href="#bookmark3489"><span class="font24">51</span></a></p>
<p><span class="font24">devices.txt,</span><a href="#bookmark3492"><span class="font24"> 51</span></a></p>
<p><span class="font24">df(1), </span><a href="#bookmark3726"><span class="font24">73</span></a><span class="font24">, </span><a href="#bookmark3729"><span class="font24">73</span></a></p>
<p><span class="font24">df -i, 26</span></p>
<p><span class="font24">directory, 27, </span><a href="#bookmark3592"><span class="font24">61</span></a></p>
<p><span class="font24">directory mask (Samba), 233</span></p>
<p><span class="font24">directory security mask(samba), 234</span></p>
<p><span class="font24">disk platters, </span><a href="#bookmark3331"><span class="font24">36</span></a></p>
<p><span class="font24">dmesg(1), </span><a href="#bookmark3390"><span class="font24">40</span></a></p>
<p><span class="font24">dpkg, 189</span></p>
<p><span class="font24">dpkg(1), 172</span></p>
<p><span class="font24">drop(mysql), 176, 178, 184</span></p>
<p><span class="font24">du(1), </span><a href="#bookmark3732"><span class="font24">73</span></a></p>
<p><span class="font24">dump(1), 165</span></p>
<p><span class="font7" style="font-weight:bold;">E</span></p>
<p><span class="font24">e2fsck(1),</span><a href="#bookmark3671"><span class="font24"> 67</span></a></p>
<p><span class="font24">eiciel, 24</span></p>
<p><span class="font24">el torito, </span><a href="#bookmark3623"><span class="font24">63</span></a></p>
<p><span class="font24">ext2, </span><a href="#bookmark3603"><span class="font24">62</span></a><span class="font24">,</span><a href="#bookmark3649"><span class="font24"> 65</span></a></p>
<p><span class="font24">ext3, </span><a href="#bookmark3604"><span class="font24">62</span></a></p>
<p><span class="font24">extended partition, </span><a href="#bookmark3473"><span class="font24">50</span></a></p>
<p><span class="font7" style="font-weight:bold;">F</span></p>
<p><span class="font24">fat16, </span><a href="#bookmark3618"><span class="font24">63</span></a></p>
<p><span class="font24">fat32, </span><a href="#bookmark3619"><span class="font24">63</span></a></p>
<p><span class="font24">fd (partition type), </span><a href="#bookmark3922"><span class="font24">99</span></a></p>
</div><br clear="all">
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24">fdisk,</span><a href="#bookmark4271"><span class="font24"> 139</span></a></p>
<p><span class="font24">fdisk(1), </span><a href="#bookmark3482"><span class="font24">51</span></a><span class="font24">,</span><a href="#bookmark3516"><span class="font24"> 53</span></a><span class="font24">, </span><a href="#bookmark3527"><span class="font24">54</span></a><span class="font24">,</span><a href="#bookmark3919"><span class="font24"> 99</span></a></p>
<p><span class="font24">fdisk(8),</span><a href="#bookmark3376"><span class="font24"> 39</span></a></p>
<p><span class="font24">fdisk limitations, </span><a href="#bookmark3552"><span class="font24">56</span></a></p>
<p><span class="font24">file ownership, 4</span></p>
<p><span class="font24">file system, </span><a href="#bookmark3589"><span class="font24">60</span></a></p>
<p><span class="font24">find(1), 16, 17, 28</span></p>
<p><span class="font24">force create mode(samba), 234</span></p>
<p><span class="font24">force directory mode(samba), 234</span></p>
<p><span class="font24">force directory security mode(samba), 234</span></p>
<p><span class="font24">force group(samba), 221</span></p>
<p><span class="font24">force security mode(samba), 234</span></p>
<p><span class="font24">force user(samba), 221</span></p>
<p><span class="font24">fsck(1), </span><a href="#bookmark3663"><span class="font24">67</span></a></p>
<p><span class="font24">fuser,</span><a href="#bookmark3805"><span class="font24"> 83</span></a><span class="font24">,</span><a href="#bookmark3808"><span class="font24"> 83</span></a></p></td><td style="vertical-align:top;">
<p><span class="font7" style="font-weight:bold;">L</span></p>
<p><span class="font24">LAMP, 171</span></p>
<p><span class="font24">LBA,</span><a href="#bookmark3359"><span class="font24"> 37</span></a></p>
<p><span class="font24">ln, 29</span></p>
<p><span class="font24">ln(1), 28</span></p>
<p><span class="font24">logical drive,</span><a href="#bookmark3474"><span class="font24"> 50</span></a></p>
<p><span class="font24">logical drives, </span><a href="#bookmark3543"><span class="font24">55</span></a></p>
<p><span class="font24">ls, 7, 26</span></p>
<p><span class="font24">ls(1), 26, 27</span></p>
<p><span class="font24">ls -l, 6</span></p>
<p><span class="font24">lsof,</span><a href="#bookmark3801"><span class="font24"> 82</span></a></p>
<p><span class="font24">lsscsi(1), </span><a href="#bookmark3408"><span class="font24">42</span></a></p>
<p><span class="font24">lvcreate(1),</span><a href="#bookmark3982"><span class="font24"> 107</span></a><span class="font24">,</span><a href="#bookmark3992"><span class="font24"> 109</span></a><span class="font24">,</span><a href="#bookmark4148"><span class="font24"> 123</span></a></p>
<p><span class="font24">lvdisplay(1),</span><a href="#bookmark4001"><span class="font24"> 110</span></a><span class="font24">,</span><a href="#bookmark4070"><span class="font24"> 118</span></a></p>
<p><span class="font24">lvextend(1),</span><a href="#bookmark3996"><span class="font24"> 110</span></a><span class="font24">,</span><a href="#bookmark4169"><span class="font24"> 124</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">G</span></p>
<p><span class="font24">getent(1), 242</span></p>
<p><span class="font24">getfacl, 22</span></p>
<p><span class="font24">gpt, </span><a href="#bookmark3554"><span class="font24">56</span></a></p>
<p><span class="font24">grant(mysql), 176</span></p>
<p><span class="font24">group by(mysql), 182</span></p>
<p><span class="font24">guest ok (Samba), 208</span></p>
<p><span class="font24">gzip(1), 162</span></p></td><td style="vertical-align:top;">
<p><span class="font24">lvm,</span><a href="#bookmark3824"><span class="font24"> 84</span></a></p>
<p><span class="font24">LVM,</span><a href="#bookmark3964"><span class="font24"> 104</span></a></p>
<p><span class="font24">lvmdiskscan(1),</span><a href="#bookmark4032"><span class="font24"> 115</span></a></p>
<p><span class="font24">lvol0,</span><a href="#bookmark4151"><span class="font24"> 123</span></a></p>
<p><span class="font24">lvremove(1),</span><a href="#bookmark4162"><span class="font24"> 123</span></a></p>
<p><span class="font24">lvrename(1),</span><a href="#bookmark4179"><span class="font24"> 124</span></a><span class="font24"> lvs(1),</span><a href="#bookmark4060"><span class="font24"> 118</span></a><span class="font24"> lvscan(1),</span><a href="#bookmark4065"><span class="font24"> 118</span></a></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font7" style="font-weight:bold;">H</span></p>
<p><span class="font24">hard link, 28</span></p>
<p><span class="font24">hdparm(8), </span><a href="#bookmark3435"><span class="font24">45</span></a></p>
<p><span class="font24">head (hard disk device),</span><a href="#bookmark3332"><span class="font24"> 36</span></a></p>
<p><span class="font24">hide unreadable (Samba), 233</span></p>
<p><span class="font24">hostname, 194</span></p>
<p><span class="font24">hosts allow (Samba), 232</span></p>
<p><span class="font24">hosts deny (Samba), 233</span></p></td><td style="vertical-align:top;">
<p><span class="font7" style="font-weight:bold;">M</span></p>
<p><span class="font24">major number, </span><a href="#bookmark3491"><span class="font24">51</span></a></p>
<p><span class="font24">master (hard disk device),</span><a href="#bookmark3346"><span class="font24"> 36</span></a></p>
<p><span class="font24">master boot record,</span><a href="#bookmark3535"><span class="font24"> 55</span></a></p>
<p><span class="font24">mbr, </span><a href="#bookmark3536"><span class="font24">55</span></a><span class="font24">, </span><a href="#bookmark3544"><span class="font24">55</span></a><span class="font24">, </span><a href="#bookmark3555"><span class="font24">56</span></a></p>
<p><span class="font24">MBR, 166</span></p>
<p><span class="font24">mdadm(1),</span><a href="#bookmark3928"><span class="font24"> 100</span></a></p>
<p><span class="font24">minor number,</span><a href="#bookmark3493"><span class="font24"> 51</span></a></p>
<p><span class="font24">mirror,</span><a href="#bookmark3898"><span class="font24"> 97</span></a></p>
<p><span class="font24">mkdir, </span><a href="#bookmark3701"><span class="font24">71</span></a></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font7" style="font-weight:bold;">I</span></p>
<p><span class="font24">IBM, 194</span></p>
<p><span class="font24">ide, </span><a href="#bookmark3490"><span class="font24">51</span></a></p>
<p><span class="font24">idmap gid(samba), 239</span></p>
<p><span class="font24">idmap uid(samba), 239</span></p>
<p><span class="font24">inetd(8), 203</span></p>
<p><span class="font24">initiator(iSCSI),</span><a href="#bookmark4209"><span class="font24"> 131</span></a></p>
<p><span class="font24">inode, 25, 28</span></p>
<p><span class="font24">inode table, 26</span></p>
<p><span class="font24">insert(mysql), 179</span></p>
<p><span class="font24">integer(mysql), 177</span></p>
<p><span class="font24">invalid users (Samba), 232</span></p>
<p><span class="font24">iostat,</span><a href="#bookmark3827"><span class="font24"> 85</span></a></p>
<p><span class="font24">iotop,</span><a href="#bookmark3836"><span class="font24"> 86</span></a></p>
<p><span class="font24">iSCSI,</span><a href="#bookmark4208"><span class="font24"> 131</span></a></p>
<p><span class="font24">iscsiadm,</span><a href="#bookmark4261"><span class="font24"> 138</span></a></p>
<p><span class="font24">iso9660, </span><a href="#bookmark3624"><span class="font24">63</span></a><span class="font24">, 166</span></p></td><td style="vertical-align:top;">
<p><span class="font24">mkdir(1), 11</span></p>
<p><span class="font24">mke2fs(1),</span><a href="#bookmark3608"><span class="font24"> 62</span></a><span class="font24">, </span><a href="#bookmark3650"><span class="font24">65</span></a><span class="font24">,</span><a href="#bookmark3993"><span class="font24"> 109</span></a></p>
<p><span class="font24">mkfs, 26</span></p>
<p><span class="font24">mkfs(1), </span><a href="#bookmark3609"><span class="font24">62</span></a><span class="font24">,</span><a href="#bookmark3651"><span class="font24"> 65</span></a></p>
<p><span class="font24">mkinitrd(1),</span><a href="#bookmark3610"><span class="font24"> 62</span></a></p>
<p><span class="font24">mknod(1), 161</span></p>
<p><span class="font24">mount, </span><a href="#bookmark3707"><span class="font24">71</span></a></p>
<p><span class="font24">mount(1), </span><a href="#bookmark3695"><span class="font24">70</span></a><span class="font24">, </span><a href="#bookmark3720"><span class="font24">72</span></a></p>
<p><span class="font24">mounting, </span><a href="#bookmark3696"><span class="font24">70</span></a></p>
<p><span class="font24">mount point, </span><a href="#bookmark3697"><span class="font24">70</span></a></p>
<p><span class="font24">mt(1), 161</span></p>
<p><span class="font24">multipath,</span><a href="#bookmark4357"><span class="font24"> 151</span></a></p>
<p><span class="font24">mysql, 171, 173, 174, 175</span></p>
<p><span class="font24">mysql(group), 173</span></p>
<p><span class="font24">mysql(user), 173</span></p>
<p><span class="font24">mysql-client, 172</span></p>
<p><span class="font24">mysqld, 173</span></p>
<p><span class="font24">mysql-server, 172</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">J</span></p>
<p><span class="font24">jbod, </span><a href="#bookmark3895"><span class="font24">97</span></a></p>
<p><span class="font24">joliet, </span><a href="#bookmark3625"><span class="font24">63</span></a></p>
<p><span class="font24">journaling,</span><a href="#bookmark3605"><span class="font24"> 62</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">N</span></p>
<p><span class="font24">NetBIOS names, 194</span></p>
<p><span class="font24">netcat, 211</span></p>
<p><span class="font24">net groupmap, 252</span></p></td></tr>
</table>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24">net rpc join(samba), 240</span></p></td><td style="vertical-align:top;">
<p><span class="font24">sata,</span><a href="#bookmark3350"><span class="font24"> 36</span></a></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">net use(microsoft), 210, 215, 226</span></p></td><td style="vertical-align:top;">
<p><span class="font24">scsi,</span><a href="#bookmark3342"><span class="font24"> 36</span></a></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">net view(microsoft), 197, 202</span></p></td><td style="vertical-align:top;">
<p><span class="font24">scsi id,</span><a href="#bookmark3353"><span class="font24"> 36</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">nmbd(8), 193</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">sector,</span><a href="#bookmark3334"><span class="font24"> 36</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">noacl(mount), </span><a href="#bookmark3768"><span class="font24">76</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">security(Samba), 208</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">nodev, </span><a href="#bookmark3644"><span class="font24">64</span></a><span class="font24">, </span><a href="#bookmark3708"><span class="font24">71</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">security mask(samba), 234</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">noexec(mount), </span><a href="#bookmark3754"><span class="font24">76</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">security mode(samba), 225</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">nosuid(mount), </span><a href="#bookmark3759"><span class="font24">76</span></a></p></td><td style="vertical-align:top;">
<p><span class="font24">seek time, </span><a href="#bookmark3335"><span class="font24">36</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">NT_STATUS_BAD_NETWORK_NAME, 227</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">select(mysql), 179, 180, 180</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">NT_STATUS_LOGON_FAILURE, 227</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">service(8), 192 setfacl, 22</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">O</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">setgid, 16, 16</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">octal permissions, 10</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">setuid, 17, 17, 17, </span><a href="#bookmark3760"><span class="font24">76</span></a></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">order by(mysql), 181 owner, 7</span></p></td><td style="vertical-align:top;">
<p><span class="font24">sfdisk(1), </span><a href="#bookmark3546"><span class="font24">55</span></a></p>
<p><span class="font24">show(mysql), 175, 177</span></p>
<p><span class="font24">slave (hard disk device),</span><a href="#bookmark3347"><span class="font24"> 36</span></a></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font7" style="font-weight:bold;">P</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">SMB, 194</span></p>
<p><span class="font24">smbclient, 200, 209</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">Parallel ATA,</span><a href="#bookmark3349"><span class="font24"> 36</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">smbclient(1), 199, 226</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">parity(raid), </span><a href="#bookmark3904"><span class="font24">97</span></a></p>
<p><span class="font24">parted, </span><a href="#bookmark3553"><span class="font24">56</span></a><span class="font24">,</span><a href="#bookmark3557"><span class="font24"> 57</span></a></p>
<p><span class="font24">parted(1), </span><a href="#bookmark3504"><span class="font24">53</span></a></p>
<p><span class="font24">partition, </span><a href="#bookmark3471"><span class="font24">50</span></a></p>
<p><span class="font24">partition table,</span><a href="#bookmark3537"><span class="font24"> 55</span></a><span class="font24">, </span><a href="#bookmark3545"><span class="font24">55</span></a></p>
<p><span class="font24">partprobe(1), </span><a href="#bookmark3540"><span class="font24">55</span></a></p>
<p><span class="font24">passdb backend (Samba), 221</span></p>
<p><span class="font24">passwd(1), 17</span></p>
<p><span class="font24">php, 171</span></p>
<p><span class="font24">primary partition,</span><a href="#bookmark3475"><span class="font24"> 50</span></a></p>
<p><span class="font24">pvchange(1),</span><a href="#bookmark4096"><span class="font24"> 120</span></a></p>
<p><span class="font24">pvcreate(1),</span><a href="#bookmark3980"><span class="font24"> 107</span></a><span class="font24">,</span><a href="#bookmark3989"><span class="font24"> 109</span></a><span class="font24">,</span><a href="#bookmark4077"><span class="font24"> 119</span></a></p>
<p><span class="font24">pvdisplay(1),</span><a href="#bookmark3991"><span class="font24"> 109</span></a><span class="font24">,</span><a href="#bookmark4041"><span class="font24"> 116</span></a></p>
<p><span class="font24">pvmove(1),</span><a href="#bookmark4103"><span class="font24"> 120</span></a></p>
<p><span class="font24">pvremove(1),</span><a href="#bookmark4086"><span class="font24"> 119</span></a></p>
<p><span class="font24">pvresize(1),</span><a href="#bookmark4091"><span class="font24"> 119</span></a></p></td><td style="vertical-align:top;">
<p><span class="font24">smbd(8), 193, 197, 220</span></p>
<p><span class="font24">smbpasswd(1), 252</span></p>
<p><span class="font24">smbpasswd(8), 220, 225</span></p>
<p><span class="font24">smbtree, 202</span></p>
<p><span class="font24">smbtree(1), 201</span></p>
<p><span class="font24">soft link, 29</span></p>
<p><span class="font24">solid state drive,</span><a href="#bookmark3362"><span class="font24"> 37</span></a></p>
<p><span class="font24">split(1), 167</span></p>
<p><span class="font24">SQL, 171, 179</span></p>
<p><span class="font24">ssd,</span><a href="#bookmark3363"><span class="font24"> 37</span></a></p>
<p><span class="font24">sticky bit, 16</span></p>
<p><span class="font24">striped disk,</span><a href="#bookmark3892"><span class="font24"> 97</span></a></p>
<p><span class="font24">swap partition,</span><a href="#bookmark3632"><span class="font24"> 63</span></a></p>
<p><span class="font24">swat(8), 203</span></p>
<p><span class="font24">symbolic link, 29</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">pvs(1),</span><a href="#bookmark4035"><span class="font24"> 115</span></a></p>
<p><span class="font24">pvscan(1),</span><a href="#bookmark4038"><span class="font24"> 115</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">T</span></p>
<p><span class="font24">tar(1), 162, 163</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">R</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">tdbsam, 221, 247, 249</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">RAID, </span><a href="#bookmark3887"><span class="font24">96</span></a></p>
<p><span class="font24">raid 1, </span><a href="#bookmark3899"><span class="font24">97</span></a></p>
<p><span class="font24">read list (Samba), 232</span></p>
<p><span class="font24">read only (Samba), 215</span></p>
<p><span class="font24">reiserfs,</span><a href="#bookmark3638"><span class="font24"> 63</span></a></p></td><td style="vertical-align:top;">
<p><span class="font24">testparm(1), 198, 198, 199</span></p>
<p><span class="font24">track,</span><a href="#bookmark3336"><span class="font24"> 36</span></a></p>
<p><span class="font24">trigger(mysql), 183</span></p>
<p><span class="font24">triggers(mysql), 172</span></p>
<p><span class="font24">tune2fs(1),</span><a href="#bookmark3611"><span class="font24"> 62</span></a><span class="font24">, </span><a href="#bookmark3656"><span class="font24">66</span></a><span class="font24">, </span><a href="#bookmark3870"><span class="font24">91</span></a></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">resize2fs(1),</span><a href="#bookmark4004"><span class="font24"> 110</span></a></p>
<p><span class="font24">restore(1), 165</span></p></td><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">U</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">rm(1), 29</span></p></td><td style="vertical-align:top;">
<p><span class="font24">udf, </span><a href="#bookmark3629"><span class="font24">63</span></a></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">roaming profiles(samba), 251</span></p></td><td style="vertical-align:top;">
<p><span class="font24">uefi, </span><a href="#bookmark3549"><span class="font24">56</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">rock ridge, </span><a href="#bookmark3626"><span class="font24">63</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">umask(1), 11</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">root(mysql), 172</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">universally unique identifier, </span><a href="#bookmark3863"><span class="font24">90</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">rotational latency,</span><a href="#bookmark3338"><span class="font24"> 36</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">update(mysql), 180</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">rpm, 189</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">use(mysql), 176</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">rpm(1), 172</span></p>
<p><span class="font24">rpm(8), 190</span></p></td><td style="vertical-align:top;">
<p><span class="font24">uuid, </span><a href="#bookmark3864"><span class="font24">90</span></a></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">rsyslog,</span><a href="#bookmark3802"><span class="font24"> 82</span></a></p></td><td style="vertical-align:top;">
<p><span class="font7" style="font-weight:bold;">V</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">S</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">valid users (Samba), 232 varchar(mysql), 177</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">samba, 189</span></p></td><td style="vertical-align:top;">
<p><span class="font24">vfat, </span><a href="#bookmark3620"><span class="font24">63</span></a></p></td></tr>
</table>
<p><span class="font24">vgchange(1),</span><a href="#bookmark4132"><span class="font24"> 122</span></a></p>
<p><span class="font24">vgcreate(1),</span><a href="#bookmark3981"><span class="font24"> 107</span></a><span class="font24">,</span><a href="#bookmark3990"><span class="font24"> 109</span></a><span class="font24">,</span><a href="#bookmark4110"><span class="font24"> 121</span></a></p>
<p><span class="font24">vgdisplay(1),</span><a href="#bookmark4055"><span class="font24"> 117</span></a></p>
<p><span class="font24">vgextend(1),</span><a href="#bookmark4115"><span class="font24"> 121</span></a></p>
<p><span class="font24">vgmerge(1),</span><a href="#bookmark4141"><span class="font24"> 122</span></a></p>
<p><span class="font24">vgreduce(1),</span><a href="#bookmark4125"><span class="font24"> 121</span></a></p>
<p><span class="font24">vgremove(1),</span><a href="#bookmark4120"><span class="font24"> 121</span></a></p>
<p><span class="font24">vgs(1),</span><a href="#bookmark4048"><span class="font24"> 117</span></a></p>
<p><span class="font24">vgscan(1),</span><a href="#bookmark4052"><span class="font24"> 117</span></a></p>
<p><span class="font24">vmstat,</span><a href="#bookmark3847"><span class="font24"> 87</span></a></p>
<p><span class="font24">vol_id(1), </span><a href="#bookmark3867"><span class="font24">91</span></a><span class="font24"> wbinfo(1), 241, 242</span></p>
<p><span class="font24">winbind(8), 241</span></p>
<p><span class="font24">winbind(samba), 239</span></p>
<p><span class="font24">winbindd(8), 193, 193, 241</span></p>
<p><span class="font24">workgroup, 208</span></p>
<p><span class="font24">writable (Samba), 215</span></p>
<p><span class="font24">write list (Samba), 232</span></p>
<p><span class="font7" style="font-weight:bold;">X</span></p>
<p><span class="font24">xinetd(8), 203</span></p>
<p><span class="font7" style="font-weight:bold;">Y</span></p>
<p><span class="font24">yum, 190</span></p>
<p><span class="font7" style="font-weight:bold;">Z</span></p>
<p><span class="font24">zfs,</span><a href="#bookmark3639"><span class="font24"> 63</span></a></p>
<p><span class="font11" style="font-weight:bold;">Linux Networking</span></p>
<p><span class="font9" style="font-weight:bold;">Paul Cobbaut</span></p>
<p><span class="font7" style="font-weight:bold;">Linux Networking</span></p>
<p><span class="font24">Paul Cobbaut</span></p>
<p><span class="font24">Paul Cobbaut</span></p>
<p><span class="font24">Publication date 2015-05-24 CEST</span></p>
<p><span class="font4" style="font-weight:bold;">Abstract</span></p>
<p><span class="font25">This book is meant to be used in an instructor-led training. For self-study, the intent is to read this book next to a working Linux computer so you can immediately do every subject, practicing each command.</span></p>
<p><span class="font25">This book is aimed at novice Linux system administrators (and might be interesting and useful for home users that want to know a bit more about their Linux system). However, this book is not meant as an introduction to Linux desktop applications like text editors, browsers, mail clients, multimedia or office applications.</span></p>
<p><span class="font25">More information and free .pdf available at </span><a href="http://linux-training.be"><span class="font25" style="font-weight:bold;">http://linux-training.be</span></a><span class="font25" style="font-weight:bold;"> </span><span class="font25">.</span></p>
<p><span class="font25">Feel free to contact the author:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">• Paul Cobbaut: </span><a href="mailto:paul.cobbaut@gmail.com"><span class="font25">paul.cobbaut@gmail.com</span></a><span class="font25">, </span><a href="http://www.linkedin.com/in/cobbaut"><span class="font25">http://www.linkedin.com/in/cobbaut</span></a></p></li></ul>
<p><span class="font25">Contributors to the Linux Training project are:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">• Serge van Ginderachter: </span><a href="mailto:serge@ginsys.be"><span class="font25">serge@ginsys.be</span></a><span class="font25">, build scripts; infrastructure setup; minor stuff</span></p></li>
<li>
<p><span class="font25">• Hendrik De Vloed: </span><a href="mailto:hendrik.devloed@ugent.be"><span class="font25">hendrik.devloed@ugent.be</span></a><span class="font25">, buildheader.pl script</span></p></li></ul>
<p><span class="font25">We'd also like to thank our reviewers:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">• Wouter Verhelst: </span><a href="mailto:wouter@grep.be"><span class="font25">wouter@grep.be</span></a><span class="font25">, </span><a href="http://grep.be"><span class="font25">http://grep.be</span></a></p></li>
<li>
<p><span class="font25">• Geert Goossens: </span><a href="mailto:mail.goossens.geert@gmail.com"><span class="font25">mail.goossens.geert@gmail.com</span></a><span class="font25">, </span><a href="http://www.linkedin.com/in/"><span class="font25">http://www.linkedin.com/in/</span></a><span class="font25"> geertgoossens</span></p></li>
<li>
<p><span class="font25">• Elie De Brauwer: </span><a href="mailto:elie@de-brauwer.be"><span class="font25">elie@de-brauwer.be</span></a><span class="font25">, </span><a href="http://www.de-brauwer.be"><span class="font25">http://www.de-brauwer.be</span></a></p></li>
<li>
<p><span class="font25">• Christophe Vandeplas: </span><a href="mailto:christophe@vandeplas.com"><span class="font25">christophe@vandeplas.com</span></a><span class="font25">, </span><a href="http://christophe.vandeplas.com"><span class="font25">http://christophe.vandeplas.com</span></a></p></li>
<li>
<p><span class="font25">• Bert Desmet: </span><a href="mailto:bert@devnox.be"><span class="font25">bert@devnox.be</span></a><span class="font25">, </span><a href="http://bdesmet.be"><span class="font25">http://bdesmet.be</span></a></p></li>
<li>
<p><span class="font25">• Rich Yonts: </span><a href="mailto:richyonts@gmail.com"><span class="font25">richyonts@gmail.com</span></a><span class="font25">,</span></p></li></ul>
<p><span class="font25">Copyright 2007-2015 Paul Cobbaut</span></p>
<p><span class="font25">Permission is granted to copy, distribute and/or modify this document under the terms of the </span><span class="font25" style="font-weight:bold;">GNU Free Documentation License</span><span class="font25">, Version 1.3 or any later version published by the Free Software Foundation; with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts. A copy of the license is included in the section entitled 'GNU Free Documentation License'.</span></p>
<h3><a name="bookmark4412"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4413"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4414"><span class="font24">I. network management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4415"><span class="font24" style="font-weight:bold;">1. general networking </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4416"><span class="font24">1.1. network layers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4417"><span class="font24">1.2. unicast, multicast, broadcast, anycast </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4418"><span class="font24">1.3. lan-wan-man </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4419"><span class="font24">1.4. internet - intranet - extranet </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4420"><span class="font24">1.5. tcp/ip </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4421"><span class="font24" style="font-weight:bold;">2. interface configuration </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4422"><span class="font24">2.1. to gui or not to gui </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4423"><span class="font24">2.2. Debian nic configuration </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4424"><span class="font24">2.3. RHEL nic configuration </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4425"><span class="font24">2.4. ifconfig </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4426"><span class="font24">2.5. ip </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4427"><span class="font24">2.6. dhclient </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4428"><span class="font24">2.7. hostname </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4429"><span class="font24">2.8. arp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4430"><span class="font24">2.9. route </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4431"><span class="font24">2.10. ping </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4432"><span class="font24">2.11. optional: ethtool </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4433"><span class="font24">2.12. practice: interface configuration </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4434"><span class="font24">2.13. solution: interface configuration </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4435"><span class="font24" style="font-weight:bold;">3. network sniffing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4436"><span class="font24">3.1. wireshark </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4437"><span class="font24">3.2. tcpdump </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4438"><span class="font24">3.3. practice: network sniffing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4439"><span class="font24">3.4. solution: network sniffing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4440"><span class="font24" style="font-weight:bold;">4. binding and bonding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4441"><span class="font24">4.1. binding on Redhat/Fedora </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4442"><span class="font24">4.2. binding on Debian/Ubuntu </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4443"><span class="font24">4.3. bonding on Redhat/Fedora </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4444"><span class="font24">4.4. bonding on Debian/Ubuntu </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4445"><span class="font24">4.5. practice: binding and bonding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4446"><span class="font24">4.6. solution: binding and bonding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4447"><span class="font24" style="font-weight:bold;">5. ssh client and server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4448"><span class="font24">5.1. about ssh </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4449"><span class="font24">5.2. log on to a remote server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4450"><span class="font24">5.3. executing a command in remote </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4451"><span class="font24">5.4. scp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4452"><span class="font24">5.5. setting up passwordless ssh </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4453"><span class="font24">5.6. X forwarding via ssh </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4454"><span class="font24">5.7. troubleshooting ssh </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4455"><span class="font24">5.8. sshd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4456"><span class="font24">5.9. sshd keys </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4457"><span class="font24">5.10. ssh-agent </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4458"><span class="font24">5.11. practice: ssh </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4459"><span class="font24">5.12. solution: ssh </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4460"><span class="font24" style="font-weight:bold;">6. introduction to nfs </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4461"><span class="font24">6.1. nfs protocol versions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4462"><span class="font24">6.2. rpcinfo </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4463"><span class="font24">6.3. server configuration </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4464"><span class="font24">6.4. /etc/exports </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4465"><span class="font24">6.5. exportfs </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4466"><span class="font24">6.6. client configuration </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4467"><span class="font24">6.7. practice: introduction to nfs </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4468"><span class="font24" style="font-weight:bold;">7. introduction to networking </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4469"><span class="font24">7.1. introduction to iptables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4470"><span class="font24">7.2. practice : iptables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4471"><span class="font24">7.3. solution : iptables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4472"><span class="font24">7.4. xinetd and inetd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4473"><span class="font24">7.5. practice : inetd and xinetd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4474"><span class="font24">7.6. network file system </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4475"><span class="font24">7.7. practice : network file system </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4476"><span class="font24" style="font-weight:bold;">II. apache and squid </span><span class="font24">[</span><span class="font24" style="font-weight:bold;">REMOVED - CHECK SECTION - 5</span><span class="font24">]</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4477"><span class="font24" style="font-weight:bold;">8. apache web server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4478"><span class="font24">8.1. introduction to apache </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4479"><span class="font24">8.2. port virtual hosts on Debian </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4480"><span class="font24">8.3. named virtual hosts on Debian </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4481"><span class="font24">8.4. password protected website on Debian </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4482"><span class="font24">8.5. port virtual hosts on CentOS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4483"><span class="font24">8.6. named virtual hosts on CentOS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4484"><span class="font24">8.7. password protected website on CentOS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4485"><span class="font24">8.8. troubleshooting apache </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4486"><span class="font24">8.9. virtual hosts example </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4487"><span class="font24">8.10. aliases and redirects </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4488"><span class="font24">8.11. more on .htaccess </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4489"><span class="font24">8.12. traffic </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4490"><span class="font24">8.13. self signed cert on Debian </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4491"><span class="font24">8.14. self signed cert on RHEL/CentOS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4492"><span class="font24">8.15. practice: apache </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4493"><span class="font24" style="font-weight:bold;">9. introduction to squid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4494"><span class="font24">9.1. about proxy servers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4495"><span class="font24">9.2. installing squid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4496"><span class="font24">9.3. port 3128 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4497"><span class="font24">9.4. starting and stopping </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4498"><span class="font24">9.5. client proxy settings </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4499"><span class="font24">9.6. upside down images </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4500"><span class="font24">9.7. /var/log/squid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4501"><span class="font24">9.8. access control </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4502"><span class="font24">9.9. testing squid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4503"><span class="font24">9.10. name resolution </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4504"><span class="font24">III. dns server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4505"><span class="font24" style="font-weight:bold;">10. introduction to DNS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4506"><span class="font24">10.1. about dns </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4507"><span class="font24">10.2. dns namespace </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4508"><span class="font24">10.3. caching only servers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4509"><span class="font24">10.4. authoritative dns servers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4510"><span class="font24">10.5. primary and secondary </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4511"><span class="font24">10.6. zone transfers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4512"><span class="font24">10.7. master and slave </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4513"><span class="font24">10.8. SOA record </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4514"><span class="font24">10.9. full or incremental zone transfers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4515"><span class="font24">10.10. DNS cache </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4516"><span class="font24">10.11. forward lookup zone example </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4517"><span class="font24">10.12. example: caching only DNS server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4518"><span class="font24">10.13. example: caching only with forwarder </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4519"><span class="font24">10.14. example: primary authoritative server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4520"><span class="font24">10.15. example: a DNS slave server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4521"><span class="font24">10.16. practice: dns </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4522"><span class="font24">10.17. solution: dns </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4523"><span class="font24" style="font-weight:bold;">11. advanced DNS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4524"><span class="font24">11.1. example: DNS round robin </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4525"><span class="font24">11.2. DNS delegation </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4526"><span class="font24">11.3. example: DNS delegation </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4527"><span class="font24">11.4. example: split-horizon dns </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4528"><span class="font24">11.5. old dns topics </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4529"><span class="font24">IV. dhcp server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4530"><span class="font24" style="font-weight:bold;">12. introduction to dhcp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4531"><span class="font24">12.1. four broadcasts </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4532"><span class="font24">12.2. picturing dhcp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4533"><span class="font24">12.3. installing a dhcp server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4534"><span class="font24">12.4. dhcp server for RHEL/CentOS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4535"><span class="font24">12.5. client reservations </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4536"><span class="font24">12.6. example config files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4537"><span class="font24">12.7. older example config files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4538"><span class="font24">12.8. advanced dhcp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4539"><span class="font24">12.9. Practice: dhcp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4540"><span class="font24">V. iptables firewall </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4541"><span class="font24" style="font-weight:bold;">13. introduction to routers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4542"><span class="font24">13.1. router or firewall </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4543"><span class="font24">13.2. packet forwarding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4544"><span class="font24">13.3. packet filtering </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4545"><span class="font24">13.4. stateful </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4546"><span class="font24">13.5. nat (network address translation) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4547"><span class="font24">13.6. pat (port address translation) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4548"><span class="font24">13.7. snat (source nat) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4549"><span class="font24">13.8. masquerading </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4550"><span class="font24">13.9. dnat (destination nat) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4551"><span class="font24">13.10. port forwarding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4552"><span class="font24">13.11. /proc/sys/net/ipv4/ip_forward </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4553"><span class="font24">13.12. /etc/sysctl.conf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4554"><span class="font24">13.13. sysctl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4555"><span class="font24">13.14. practice: packet forwarding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4556"><span class="font24">13.15. solution: packet forwarding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4557"><span class="font24" style="font-weight:bold;">14. iptables firewall </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4558"><span class="font24">14.1. iptables tables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4559"><span class="font24">14.2. starting and stopping iptables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4560"><span class="font24">14.3. the filter table </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4561"><span class="font24">14.4. practice: packet filtering </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4562"><span class="font24">14.5. solution: packet filtering </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4563"><span class="font24">14.6. network address translation </span></a></p></li></ul>
<p><a href="#bookmark4564"><span class="font24" style="font-weight:bold;">VI. Introduction to Samba </span><span class="font24">[</span><span class="font24" style="font-weight:bold;">REMOVED - CHECK SECTION - 5</span><span class="font24">]</span></a></p>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4565"><span class="font24" style="font-weight:bold;">15. introduction to samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4566"><span class="font24">15.1. verify installed version </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4567"><span class="font24">15.2. installing samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4568"><span class="font24">15.3. documentation </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4569"><span class="font24">15.4. starting and stopping samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4570"><span class="font24">15.5. samba daemons </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4571"><span class="font24">15.6. the SMB protocol </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4572"><span class="font24">15.7. practice: introduction to samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4573"><span class="font24" style="font-weight:bold;">16. getting started with samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4574"><span class="font24">16.1. /etc/samba/smb.conf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4575"><span class="font24">16.2. /usr/bin/testparm </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4576"><span class="font24">16.3. /usr/bin/smbclient </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4577"><span class="font24">16.4. /usr/bin/smbtree </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4578"><span class="font24">16.5. server string </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4579"><span class="font24">16.6. Samba Web Administration Tool (SWAT) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4580"><span class="font24">16.7. practice: getting started with samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4581"><span class="font24">16.8. solution: getting started with samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4582"><span class="font24" style="font-weight:bold;">17. a read only file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4583"><span class="font24">17.1. Setting up a directory to share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4584"><span class="font24">17.2. configure the share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4585"><span class="font24">17.3. restart the server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4586"><span class="font24">17.4. verify the share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4587"><span class="font24">17.5. a note on netcat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4588"><span class="font24">17.6. practice: read only file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4589"><span class="font24">17.7. solution: read only file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4590"><span class="font24" style="font-weight:bold;">18. a writable file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4591"><span class="font24">18.1. set up a directory to share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4592"><span class="font24">18.2. share section in smb.conf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4593"><span class="font24">18.3. configure the share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4594"><span class="font24">18.4. test connection with windows </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4595"><span class="font24">18.5. test writing with windows </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4596"><span class="font24">18.6. How is this possible ? </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4597"><span class="font24">18.7. practice: writable file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4598"><span class="font24">18.8. solution: writable file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4599"><span class="font24" style="font-weight:bold;">19. samba first user account </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4600"><span class="font24">19.1. creating a samba user </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4601"><span class="font24">19.2. ownership of files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4602"><span class="font24">19.3. /usr/bin/smbpasswd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4603"><span class="font24">19.4. /etc/samba/smbpasswd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4604"><span class="font24">19.5. passdb backend </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4605"><span class="font24">19.6. forcing this user </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4606"><span class="font24">19.7. practice: first samba user account </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4607"><span class="font24">19.8. solution: first samba user account </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4608"><span class="font24" style="font-weight:bold;">20. samba authentication </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4609"><span class="font24">20.1. creating the users on Linux </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4610"><span class="font24">20.2. creating the users on samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4611"><span class="font24">20.3. security = user </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4612"><span class="font24">20.4. configuring the share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4613"><span class="font24">20.5. testing access with net use </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4614"><span class="font24">20.6. testing access with smbclient </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4615"><span class="font24">20.7. verify ownership </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4616"><span class="font24">20.8. common problems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4617"><span class="font24">20.9. practice : samba authentication </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4618"><span class="font24">20.10. solution: samba authentication </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4619"><span class="font24" style="font-weight:bold;">21. samba securing shares </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4620"><span class="font24">21.1. security based on user name </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4621"><span class="font24">21.2. security based on ip-address </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4622"><span class="font24">21.3. security through obscurity </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4623"><span class="font24">21.4. file system security </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4624"><span class="font24">21.5. practice: securing shares </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4625"><span class="font24">21.6. solution: securing shares </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4626"><span class="font24" style="font-weight:bold;">22. samba domain member </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4627"><span class="font24">22.1. changes in smb.conf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4628"><span class="font24">22.2. joining an Active Directory domain </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4629"><span class="font24">22.3. winbind </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4630"><span class="font24">22.4. wbinfo </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4631"><span class="font24">22.5. getent </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4632"><span class="font24">22.6. file ownership </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4633"><span class="font24">22.7. practice : samba domain member </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4634"><span class="font24" style="font-weight:bold;">23. samba domain controller </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4635"><span class="font24">23.1. about Domain Controllers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4636"><span class="font24">23.2. About security modes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4637"><span class="font24">23.3. About password backends </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4638"><span class="font24">23.4. [global] section in smb.conf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4639"><span class="font24">23.5. netlogon share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4640"><span class="font24">23.6. other [share] sections </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4641"><span class="font24">23.7. Users and Groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4642"><span class="font24">23.8. tdbsam </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4643"><span class="font24">23.9. about computer accounts </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4644"><span class="font24">23.10. local or roaming profiles </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4645"><span class="font24">23.11. Groups in NTFS acls </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4646"><span class="font24">23.12. logon scripts </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4647"><span class="font24">23.13. practice: samba domain controller </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4648"><span class="font24" style="font-weight:bold;">24. a brief look at samba 4 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4649"><span class="font24">24.1. Samba 4 alpha 6 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4650"><span class="font24">VII. ipv6 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4651"><span class="font24" style="font-weight:bold;">25. Introduction to ipv6 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4652"><span class="font24">25.1. about ipv6 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4653"><span class="font24">25.2. network id and host id </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4654"><span class="font24">25.3. host part generation </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4655"><span class="font24">25.4. ipv4 mapped ipv6 address </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4656"><span class="font24">25.5. link local addresses </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4657"><span class="font24">25.6. unique local addresses </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4658"><span class="font24">25.7. globally unique unicast addresses </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4659"><span class="font24">25.8. 6to4 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4660"><span class="font24">25.9. ISP </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4661"><span class="font24">25.10. non routable addresses </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4662"><span class="font24">25.11. ping6 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4663"><span class="font24">25.12. Belgium and ipv6 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4664"><span class="font24">25.13. other websites </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4665"><span class="font24">25.14. 6to4 gateways </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4666"><span class="font24">25.15. ping6 and dns </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4667"><span class="font24">25.16. ipv6 and tcp/http </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4668"><span class="font24">25.17. ipv6 PTR record </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4669"><span class="font24">25.18. 6to4 setup on Linux </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4670"><span class="font24">VIII. Appendix </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4671"><span class="font24" style="font-weight:bold;">A. License </span></a></p></li></ul>
<p><a href="#bookmark4672"><span class="font24">Index </span></a></p>
<h3><a name="bookmark4673"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4674"></a>List of Tables</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4675"><span class="font24">10.1. the first top level domains </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4676"><span class="font24">10.2. new general purpose tld's </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4677"><span class="font24">13.1. Packet Forwarding Exercise </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4678"><span class="font24">13.2. Packet Forwarding Solution </span></a></p></li></ul>
<p><a name="bookmark4679"></a><span class="font11" style="font-weight:bold;">Part I. network management</span></p>
<h3><a name="bookmark4680"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4681"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4682"><span class="font24" style="font-weight:bold;">1. general networking </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4683"><span class="font24">1.1. network layers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4684"><span class="font24">1.2. unicast, multicast, broadcast, anycast </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4685"><span class="font24">1.3. lan-wan-man </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4686"><span class="font24">1.4. internet - intranet - extranet </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4687"><span class="font24">1.5. tcp/ip </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4688"><span class="font24" style="font-weight:bold;">2. interface configuration </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4689"><span class="font24">2.1. to gui or not to gui </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4690"><span class="font24">2.2. Debian nic configuration </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4691"><span class="font24">2.3. RHEL nic configuration </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4692"><span class="font24">2.4. ifconfig </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4693"><span class="font24">2.5. ip </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4694"><span class="font24">2.6. dhclient </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4695"><span class="font24">2.7. hostname </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4696"><span class="font24">2.8. arp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4697"><span class="font24">2.9. route </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4698"><span class="font24">2.10. ping </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4699"><span class="font24">2.11. optional: ethtool </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4700"><span class="font24">2.12. practice: interface configuration </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4701"><span class="font24">2.13. solution: interface configuration </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4702"><span class="font24" style="font-weight:bold;">3. network sniffing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4703"><span class="font24">3.1. wireshark </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4704"><span class="font24">3.2. tcpdump </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4705"><span class="font24">3.3. practice: network sniffing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4706"><span class="font24">3.4. solution: network sniffing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4707"><span class="font24" style="font-weight:bold;">4. binding and bonding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4708"><span class="font24">4.1. binding on Redhat/Fedora </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4709"><span class="font24">4.2. binding on Debian/Ubuntu </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4710"><span class="font24">4.3. bonding on Redhat/Fedora </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4711"><span class="font24">4.4. bonding on Debian/Ubuntu </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4712"><span class="font24">4.5. practice: binding and bonding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4713"><span class="font24">4.6. solution: binding and bonding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4714"><span class="font24" style="font-weight:bold;">5. ssh client and server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2909"><span class="font24">5.1. about ssh </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4715"><span class="font24">5.2. log on to a remote server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4716"><span class="font24">5.3. executing a command in remote </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4717"><span class="font24">5.4. scp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4718"><span class="font24">5.5. setting up passwordless ssh </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4719"><span class="font24">5.6. X forwarding via ssh </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4720"><span class="font24">5.7. troubleshooting ssh </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4721"><span class="font24">5.8. sshd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4722"><span class="font24">5.9. sshd keys </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4723"><span class="font24">5.10. ssh-agent </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4724"><span class="font24">5.11. practice: ssh </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4725"><span class="font24">5.12. solution: ssh </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4726"><span class="font24" style="font-weight:bold;">6. introduction to nfs </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4727"><span class="font24">6.1. nfs protocol versions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4728"><span class="font24">6.2. rpcinfo </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4729"><span class="font24">6.3. server configuration </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4730"><span class="font24">6.4. /etc/exports </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4731"><span class="font24">6.5. exportfs </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4732"><span class="font24">6.6. client configuration </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4733"><span class="font24">6.7. practice: introduction to nfs </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4734"><span class="font24" style="font-weight:bold;">7. introduction to networking </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4735"><span class="font24">7.1. introduction to iptables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4736"><span class="font24">7.2. practice:iptables</span></a></p></li></ul>
<p><a href="#bookmark4737"><span class="font24">7.3.solution:iptables</span></a></p>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4738"><span class="font24">7.4. xinetdandinetd</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4739"><span class="font24">7.5. practice:inetdandxinetd</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4740"><span class="font24">7.6. networkfilesystem</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4741"><span class="font24">7.7. practice:networkfilesystem</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark4742"></a><span class="font11" style="font-weight:bold;"><a name="bookmark4415"></a><a name="bookmark4743"></a>Chapter 1. general networking</span></h1></li></ul>
<p><span class="font25">While this chapter is not directly about </span><span class="font25" style="font-weight:bold;">Linux</span><span class="font25">, it does contain general networking concepts that will help you in troubleshooting networks on </span><span class="font25" style="font-weight:bold;">Linux</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4744"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4416"></a><a name="bookmark4745"></a>1.1. network layers</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark4746"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4747"></a>1.1.1. seven OSI layers</span></h3></li></ul></li></ul>
<p><span class="font25">When talking about protocol layers, people usually mention the seven layers of the </span><span class="font25" style="font-weight:bold;">osi </span><span class="font25">protocol (Application, Presentation, Session, Transport, Network, Data Link and Physical). We will discuss layers 2 and 3 in depth, and focus less on the other layers. The reason is that these layers are important for understanding networks. You will hear administrators use words like &quot;this is a layer 2 device&quot; or &quot;this is a layer 3 broadcast&quot;, and you should be able to understand what they are talking about.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4748"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4749"></a>1.1.2. four DoD layers</span></h3></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">DoD </span><span class="font25">(or tcp/ip) model has only four layers, roughly mapping its </span><span class="font25" style="font-weight:bold;">network access layer </span><span class="font25">to OSI layers 1 and 2 (Physical and Datalink), its </span><span class="font25" style="font-weight:bold;">internet </span><span class="font25">(IP) layer to the OSI </span><span class="font25" style="font-weight:bold;">network layer</span><span class="font25">, its </span><span class="font25" style="font-weight:bold;">host-to-host </span><span class="font25">(tcp, udp) layer to OSI layer 4 (transport) and its </span><span class="font25" style="font-weight:bold;">application layer </span><span class="font25">to OSI layers 5, 6 and 7.</span></p>
<p><span class="font25">Below an attempt to put OSI and DoD layers next to some protocols and devices.</span></p>
<p><span class="font21">OSI Model DoD Model &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protocols devices/apps</span></p>
<table border="1">
<tr><td style="vertical-align:middle;">
<p><span class="font21">layer 5, 6, 7</span></p></td><td style="vertical-align:middle;">
<p><span class="font21">application</span></p></td><td colspan="2" style="vertical-align:middle;">
<p><span class="font21">dns, dhcp, ntp, snmp, https, ftp, ssh, telnet, http, pop3... others</span></p></td><td style="vertical-align:middle;">
<p><span class="font21">web server, mail server, browser, mail client...</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font21">layer 4</span></p></td><td style="vertical-align:middle;">
<p><span class="font21">host-to-host</span></p></td><td style="vertical-align:middle;">
<p><span class="font21">tcp</span></p></td><td style="vertical-align:middle;">
<p><span class="font21">udp</span></p></td><td style="vertical-align:middle;">
<p><span class="font21">gateway</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font21">layer 3</span></p></td><td style="vertical-align:middle;">
<p><span class="font21">internet</span></p></td><td colspan="2" style="vertical-align:middle;">
<p><span class="font21">ip, icmp, igmp</span></p></td><td style="vertical-align:middle;">
<p><span class="font21">router, firewall layer 3 switch</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font21">layer 2</span></p></td><td rowspan="2" style="vertical-align:middle;">
<p><span class="font21">network access</span></p></td><td colspan="2" style="vertical-align:middle;">
<p><span class="font21">arp (mac), rarp</span></p></td><td style="vertical-align:middle;">
<p><span class="font21">bridge layer 2 switch</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font21">layer 1</span></p></td><td colspan="2" style="vertical-align:middle;">
<p><span class="font21">ethernet, token ring</span></p></td><td style="vertical-align:middle;">
<p><span class="font21">hub</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4750"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4751"></a>1.1.3. short introduction to the physical layer</span></h3></li></ul>
<p><span class="font25">The physical layer, or </span><span class="font25" style="font-weight:bold;">layer 1</span><span class="font25">, is all about voltage, electrical signals and mechanical connections. Some networks might still use </span><span class="font25" style="font-weight:bold;">coax </span><span class="font25">cables, but most will have migrated to </span><span class="font25" style="font-weight:bold;">utp </span><span class="font25">(cat 5 or better) with </span><span class="font25" style="font-weight:bold;">rj45 </span><span class="font25">connectors.</span></p>
<p><span class="font25">Devices like </span><span class="font25" style="font-weight:bold;">repeaters </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">hubs </span><span class="font25">are part of this layer. You cannot use software to 'see' a </span><span class="font25" style="font-weight:bold;">repeater </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">hub </span><span class="font25">on the network. The only thing these devices are doing is amplifying electrical signals on cables. </span><span class="font25" style="font-weight:bold;">Passive hubs </span><span class="font25">are multiport amplifiers that amplify an incoming electrical signal on all other connections. </span><span class="font25" style="font-weight:bold;">Active hubs </span><span class="font25">do this by reading and retransmitting bits, without interpreting any meaning in those bits.</span></p>
<p><span class="font25">Network technologies like </span><span class="font25" style="font-weight:bold;">csma/cd </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">token ring </span><span class="font25">are defined on this layer.</span></p>
<p><span class="font25">This is all we have to say about </span><span class="font25" style="font-weight:bold;">layer 1 </span><span class="font25">in this book.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4752"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4753"></a>1.1.4. short introduction to the data link layer</span></h3></li></ul>
<p><span class="font25">The data link layer, or </span><span class="font25" style="font-weight:bold;">layer 2 </span><span class="font25">is about frames. A frame has a </span><span class="font25" style="font-weight:bold;">crc </span><span class="font25">(cyclic redundancy check). In the case of ethernet (802.3), each network card is identifiable by a unique 48-bit </span><span class="font25" style="font-weight:bold;">mac </span><span class="font25">address (media access control address).</span></p>
<p><span class="font25">On this layer we find devices like bridges and switches. A bridge is more intelligent than a hub because a </span><span class="font25" style="font-weight:bold;">bridge </span><span class="font25">can make decisions based on the mac address of computers. A </span><span class="font25" style="font-weight:bold;">switch </span><span class="font25">also understands mac addresses.</span></p>
<p><span class="font25">In this book we will discuss commands like </span><span class="font25" style="font-weight:bold;">arp </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">ifconfig </span><span class="font25">to explore this layer.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4754"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4755"></a>1.1.5. short introduction to the network layer</span></h3></li></ul>
<p><span class="font25" style="font-weight:bold;">Layer 3 </span><span class="font25">is about ip packets. This layer gives every host a unique 32-bit ip address. But </span><span class="font25" style="font-weight:bold;">ip </span><span class="font25">is not the only protocol on this layer, there is also icmp, igmp, ipv6 and more. A complete list can be found in the </span><span class="font25" style="font-weight:bold;">/etc/protocols </span><span class="font25">file.</span></p>
<p><span class="font25">On this layer we find devices like </span><span class="font25" style="font-weight:bold;">routers </span><span class="font25">and layer 3 switches, devices that know (and have) an ip address.</span></p>
<p><span class="font25">In tcp/ip this layer is commonly referred to as the </span><span class="font25" style="font-weight:bold;">internet layer</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4756"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4757"></a>1.1.6. short introduction to the transport layer</span></h3></li></ul>
<p><span class="font25">We will discuss the </span><span class="font25" style="font-weight:bold;">tcp </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">udp </span><span class="font25">protocols in the context of layer 4. The DoD model calls this the host-to-host layer.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4758"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4759"></a>1.1.7. layers 5, 6 and 7</span></h3></li></ul>
<p><span class="font25">The tcp/ip application layer includes layers 5, 6 and 7. Details on the difference between these layers are out of scope of this course.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4760"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4761"></a>1.1.8. network layers in this book</span></h3></li></ul>
<p><span class="font25">Stacking of layers in this book is based on the </span><span class="font25" style="font-weight:bold;">Protocols in Frame </span><span class="font25">explanation in the </span><span class="font25" style="font-weight:bold;">wireshark </span><span class="font25">sniffer. When sniffing a dhcp packet, we notice the following in the sniffer.</span></p>
<p><span class="font19">[Protocols in Frame: eth:ip:udp:bootp]</span></p>
<p><span class="font25">Sniffing for ntp (Network Time Protocol) packets gives us this line, which makes us conclude to put </span><span class="font25" style="font-weight:bold;">ntp </span><span class="font25">next to </span><span class="font25" style="font-weight:bold;">bootp </span><span class="font25">in the protocol chart below.</span></p>
<p><span class="font19">[Protocols in Frame: eth:ip:udp:ntp]</span></p>
<p><span class="font25">Sniffing an </span><span class="font25" style="font-weight:bold;">arp </span><span class="font25">broadcast makes us put arp next to </span><span class="font25" style="font-weight:bold;">ip</span><span class="font25">. All these protocols are explained later in this chapter.</span></p>
<p><span class="font19">[Protocols in Frame: eth:arp]</span></p>
<p><span class="font25">Below is a protocol chart based on wireshark's knowledge. It contains some very common protocols that are discussed in this book. The chart does not contain all protocols.</span></p>
<table border="1">
<tr><td style="vertical-align:top;"></td><td style="vertical-align:middle;">
<p><span class="font3">SSH</span></p></td><td style="vertical-align:middle;">
<p><span class="font3">SMTP</span></p></td><td style="vertical-align:middle;">
<p><span class="font3">HTTP</span></p></td><td style="vertical-align:middle;">
<p><span class="font3">POP3</span></p></td><td style="vertical-align:middle;">
<p><span class="font3">DNS</span></p></td><td style="vertical-align:middle;">
<p><span class="font3">NTP</span></p></td><td style="vertical-align:middle;">
<p><span class="font3">DHCP</span></p>
<p><span class="font3">BOOTP</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font3">ICMP IGMP</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:middle;">
<p><span class="font3">TCP</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:middle;">
<p><span class="font3">UDP</span></p></td><td style="vertical-align:top;"></td></tr>
</table>
<p><span class="font3">ARP</span></p>
<p><span class="font3">RARP</span></p>
<p><span class="font3">Ethernet</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4762"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4417"></a><a name="bookmark4763"></a>1.2. unicast, multicast, broadcast, anycast</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark4764"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4765"></a>1.2.1. unicast</span></h3></li></ul></li></ul>
<p><span class="font25">A </span><span class="font25" style="font-weight:bold;">unicast </span><span class="font25">communication originates from one computer and is destined for exactly one other computer (or host). It is common for computers to have many </span><span class="font25" style="font-weight:bold;">unicast </span><span class="font25">communications.</span></p><img src="linux_guide_files/The Complete Linux Guide-91.jpg" alt="" style="width:284pt;height:187pt;">
<ul style="list-style:none;"><li>
<h3><a name="bookmark4766"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4767"></a>1.2.2. multicast</span></h3></li></ul>
<p><a name="bookmark4768"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">multicast </span><span class="font25">is destined for a group (of computers).</span></p><img src="linux_guide_files/The Complete Linux Guide-92.jpg" alt="" style="width:284pt;height:187pt;">
<p><span class="font25">Some examples of </span><span class="font25" style="font-weight:bold;">multicast </span><span class="font25">are Realplayer (.sdp files) and </span><span class="font25" style="font-weight:bold;">ripv2 </span><span class="font25">(a routing protocol).</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4769"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4770"></a>1.2.3. broadcast</span></h3></li></ul>
<p><a name="bookmark4771"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">broadcast </span><span class="font25">is meant for everyone.</span></p><img src="linux_guide_files/The Complete Linux Guide-93.jpg" alt="" style="width:284pt;height:187pt;">
<p><span class="font25">Typical example here is the BBC (British Broadcasting Corporation) broadcasting to everyone. In datacommunications a broadcast is most common confined to the </span><span class="font25" style="font-weight:bold;">lan</span><span class="font25">.</span></p>
<p><span class="font25">Careful, a </span><span class="font25" style="font-weight:bold;">layer 2 broadcast </span><span class="font25">is very different from a </span><span class="font25" style="font-weight:bold;">layer 3 broadcast</span><span class="font25">. A layer two broadcast is received by all network cards on the same segment (it does not pass any router), whereas a layer 3 broadcast is received by all hosts in the same ip subnet.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4772"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4773"></a>1.2.4. anycast</span></h3></li></ul>
<p><a name="bookmark4774"></a><span class="font25"><a name="bookmark4775"></a>The </span><span class="font25" style="font-weight:bold;">root name servers </span><span class="font25">of the internet use </span><span class="font25" style="font-weight:bold;">anycast</span><span class="font25">. An </span><span class="font25" style="font-weight:bold;">anycast </span><span class="font25">signal goes the the (geographically) nearest of a well defined group.</span></p><img src="linux_guide_files/The Complete Linux Guide-94.jpg" alt="" style="width:284pt;height:187pt;">
<p><span class="font25">With thanks to the nice anonymous wikipedia contributor to put these pictures in the public domain.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4776"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4418"></a><a name="bookmark4777"></a>1.3. lan-wan-man</span></h2></li></ul>
<p><span class="font25">The term </span><span class="font25" style="font-weight:bold;">lan </span><span class="font25">is used for local area networks, as opposed to a </span><span class="font25" style="font-weight:bold;">wan </span><span class="font25">for wide area networks. The difference between the two is determined by the </span><span class="font25" style="font-weight:bold;">distance </span><span class="font25">between the computers, and not by the number of computers in a network. Some protocols like </span><span class="font25" style="font-weight:bold;">atm </span><span class="font25">are designed for use in a </span><span class="font25" style="font-weight:bold;">wan</span><span class="font25">, others like </span><span class="font25" style="font-weight:bold;">ethernet </span><span class="font25">are designed for use in a </span><span class="font25" style="font-weight:bold;">lan</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4778"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4779"></a>1.3.1. lan</span></h3></li></ul>
<p><a name="bookmark4780"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">lan </span><span class="font25">(Local Area Network) is a local network. This can be one room, or one floor, or even one big building. We say </span><span class="font25" style="font-weight:bold;">lan </span><span class="font25">as long as computers are </span><span class="font25" style="font-weight:bold;">close </span><span class="font25">to each other. You can also define a </span><span class="font25" style="font-weight:bold;">lan </span><span class="font25">when all computers are </span><span class="font25" style="font-weight:bold;">ethernet </span><span class="font25">connected.</span></p>
<p><span class="font25">A </span><span class="font25" style="font-weight:bold;">lan </span><span class="font25">can contain multiple smaller </span><span class="font25" style="font-weight:bold;">lan</span><span class="font25">'s. The picture below shows three </span><span class="font25" style="font-weight:bold;">lan</span><span class="font25">'s that together make up one </span><span class="font25" style="font-weight:bold;">lan</span><span class="font25">.</span></p><img src="linux_guide_files/The Complete Linux Guide-95.jpg" alt="" style="width:397pt;height:214pt;">
<ul style="list-style:none;"><li>
<h3><a name="bookmark4781"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4782"></a>1.3.2. man</span></h3></li></ul>
<p><a name="bookmark4783"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">man </span><span class="font25">(Metropolitan Area Network) is something inbetween a </span><span class="font25" style="font-weight:bold;">lan </span><span class="font25">and a </span><span class="font25" style="font-weight:bold;">wan</span><span class="font25">, often comprising several buildings on the same campus or in the same city. A </span><span class="font25" style="font-weight:bold;">man </span><span class="font25">can use </span><span class="font25" style="font-weight:bold;">fddi </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">ethernet </span><span class="font25">or other protocols for connectivity.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4784"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4785"></a>1.3.3. wan</span></h3></li></ul>
<p><a name="bookmark4786"></a><span class="font25"><a name="bookmark4787"></a><a name="bookmark4788"></a><a name="bookmark4789"></a><a name="bookmark4790"></a>A </span><span class="font25" style="font-weight:bold;">wan </span><span class="font25">(Wide Area Network) is a network with a lot of distance between the computers (or hosts). These hosts are often connected by </span><span class="font25" style="font-weight:bold;">leased lines</span><span class="font25">. A </span><span class="font25" style="font-weight:bold;">wan </span><span class="font25">does not use </span><span class="font25" style="font-weight:bold;">ethernet</span><span class="font25">, but protocols like </span><span class="font25" style="font-weight:bold;">fddi</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">frame relay</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">ATM </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">X.25 </span><span class="font25">to connect computers (and networks).</span></p>
<p><span class="font25">The picture below shows a branch office that is connected through </span><span class="font25" style="font-weight:bold;">Frame Relay </span><span class="font25">with headquarters.</span></p><img src="linux_guide_files/The Complete Linux Guide-96.jpg" alt="" style="width:409pt;height:103pt;">
<p><span class="font25">The acronym </span><span class="font25" style="font-weight:bold;">wan </span><span class="font25">is also used for large surface area networks like the </span><span class="font25" style="font-weight:bold;">internet</span><span class="font25">.</span></p>
<p><a name="bookmark4791"></a><span class="font25" style="font-weight:bold;"><a name="bookmark4792"></a>Cisco </span><span class="font25">is known for their </span><span class="font25" style="font-weight:bold;">wan </span><span class="font25">technology. They make </span><span class="font25" style="font-weight:bold;">routers </span><span class="font25">that connect many </span><span class="font25" style="font-weight:bold;">lan </span><span class="font25">networks using </span><span class="font25" style="font-weight:bold;">wan </span><span class="font25">protocols.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4793"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4794"></a>1.3.4. pan-wpan</span></h3></li></ul>
<p><a name="bookmark4795"></a><span class="font25"><a name="bookmark4796"></a>Your home network is called a </span><span class="font25" style="font-weight:bold;">pan </span><span class="font25">(Personal Area Network). A wireless </span><span class="font25" style="font-weight:bold;">pan </span><span class="font25">is a </span><span class="font25" style="font-weight:bold;">wpan</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4797"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4419"></a><a name="bookmark4798"></a>1.4. internet - intranet - extranet</span></h2></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">internet </span><span class="font25">is a global network. It connects many networks using the </span><span class="font25" style="font-weight:bold;">tcp/ip </span><span class="font25">protocol stack.</span></p>
<p><span class="font25">The origin of the </span><span class="font25" style="font-weight:bold;">internet </span><span class="font25">is the </span><span class="font25" style="font-weight:bold;">arpanet</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">arpanet </span><span class="font25">was created in 1969, that year only four computers were connected in the network. In 1971 the first </span><span class="font25" style="font-weight:bold;">e-mail </span><span class="font25">was sent over the </span><span class="font25" style="font-weight:bold;">arpanet</span><span class="font25">. </span><span class="font25" style="font-weight:bold;">E-mail </span><span class="font25">took 75 percent of all </span><span class="font25" style="font-weight:bold;">arpanet </span><span class="font25">traffic in 1973. 1973 was also the year </span><span class="font25" style="font-weight:bold;">ftp </span><span class="font25">was introduced, and saw the connection of the first European countries (Norway and UK). In 2009 the internet was available to 25 percent of the world population. In 2011 it is estimated that only a quarter of internet webpages are in English.</span></p>
<p><span class="font25">An </span><span class="font25" style="font-weight:bold;">intranet </span><span class="font25">is a private </span><span class="font25" style="font-weight:bold;">tcp/ip </span><span class="font25">network. An </span><span class="font25" style="font-weight:bold;">intranet </span><span class="font25">uses the same protocols as the </span><span class="font25" style="font-weight:bold;">internet</span><span class="font25">, but is only accessible to people from within one organization.</span></p>
<p><span class="font25">An </span><span class="font25" style="font-weight:bold;">extranet </span><span class="font25">is similar to an </span><span class="font25" style="font-weight:bold;">intranet</span><span class="font25">, but some trusted organizations (partners/clients/ suppliers/...) also get access.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4799"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4420"></a><a name="bookmark4800"></a>1.5. tcp/ip</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark4801"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4802"></a>1.5.1. history of tcp/ip</span></h3></li></ul></li></ul>
<p><span class="font25">In the Sixties development of the </span><span class="font25" style="font-weight:bold;">tcp/ip </span><span class="font25">protocol stack was started by the US Department of Defense. In the Eighties a lot of commercial enterprises developed their own protocol stack: IBM created </span><span class="font25" style="font-weight:bold;">sna</span><span class="font25">, Novell had </span><span class="font25" style="font-weight:bold;">ipx/spx</span><span class="font25">, Microsoft completed </span><span class="font25" style="font-weight:bold;">netbeui </span><span class="font25">and Apple worked with </span><span class="font25" style="font-weight:bold;">appletalk</span><span class="font25">. All the efforts from the Eighties failed to survive the Nineties. By the end of the Nineties, almost all computers in the world were able to speak tcp/ip.</span></p>
<p><span class="font25">In my humble opinion, the main reason for the survival of </span><span class="font25" style="font-weight:bold;">tcp/ip </span><span class="font25">over all the other protocols is its openness. Everyone is free to develop and use the tcp/ip protocol suite.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4803"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4804"></a>1.5.2. rfc (request for comment)</span></h3></li></ul>
<p><span class="font25">The protocols that are used on the internet are defined in </span><span class="font25" style="font-weight:bold;">rfc's</span><span class="font25">. An rfc or </span><span class="font25" style="font-weight:bold;">request for comment </span><span class="font25">describes the inner working of all internet protocols. The </span><span class="font25" style="font-weight:bold;">IETF </span><span class="font25">(Internet Engineering Task Force) is the sole publisher of these protocols since 1986.</span></p>
<p><span class="font25">The official website for the rfc's is </span><a href="http://www.rfc-editor.org"><span class="font25" style="font-weight:bold;">http://www.rfc-editor.org</span></a><span class="font25">. This website contains all rfc's in plain text, for example rfc2132 (which defines dhcp and bootp) is accessible at http:// </span><a href="http://www.rfc-editor.org/rfc/rfc2132.txt"><span class="font25">www.rfc-editor.org/rfc/rfc2132.txt</span></a><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4805"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4806"></a>1.5.3. many protocols</span></h3></li></ul>
<p><a name="bookmark4807"></a><span class="font25"><a name="bookmark4808"></a><a name="bookmark4809"></a><a name="bookmark4810"></a><a name="bookmark4811"></a>For reliable connections, you use </span><span class="font25" style="font-weight:bold;">tcp</span><span class="font25">, whereas </span><span class="font25" style="font-weight:bold;">udp </span><span class="font25">is connectionless but faster. The </span><span class="font25" style="font-weight:bold;">icmp </span><span class="font25">error messages are used by </span><span class="font25" style="font-weight:bold;">ping</span><span class="font25">, multicast groups are managed by </span><span class="font25" style="font-weight:bold;">igmp</span><span class="font25">.</span></p>
<p><a name="bookmark4812"></a><span class="font25">These protocols are visible in the protocol field of the ip header, and are listed in the </span><span class="font25" style="font-weight:bold;">/etc/ protocols </span><span class="font25">file.</span></p>
<p><span class="font19">paul@debian5:~$ grep tcp /etc/protocols</span></p>
<p><span class="font19">tcp 6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TCP &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# transmission control protocol</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4813"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4814"></a>1.5.4. many services</span></h3></li></ul>
<p><span class="font25">Network cards are uniquely identified by their </span><span class="font25" style="font-weight:bold;">mac address</span><span class="font25">, hosts by their </span><span class="font25" style="font-weight:bold;">ip address </span><span class="font25">and applications by their </span><span class="font25" style="font-weight:bold;">port number</span><span class="font25">.</span></p>
<p><a name="bookmark4815"></a><span class="font25">Common application level protocols like smtp, http, ssh, telnet and ftp have fixed </span><span class="font25" style="font-weight:bold;">port numbers</span><span class="font25">. There is a list of </span><span class="font25" style="font-weight:bold;">port numbers </span><span class="font25">in </span><span class="font25" style="font-weight:bold;">/etc/services</span><span class="font25">.</span></p>
<p><span class="font19">paul@ubu1010:~$ grep ssh /etc/services</span></p>
<p><span class="font19">ssh &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;22/tcp &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# SSH Remote Login Protocol</span></p>
<p><span class="font19">ssh &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;22/udp</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark4816"></a><span class="font11" style="font-weight:bold;"><a name="bookmark4421"></a><a name="bookmark4817"></a>Chapter 2. interface configuration</span></h1></li></ul>
<p><span class="font25">This chapter explains how to configure </span><span class="font25" style="font-weight:bold;">network interface cards </span><span class="font25">to work with </span><span class="font25" style="font-weight:bold;">tcp/ip</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4818"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4422"></a><a name="bookmark4819"></a>2.1. to gui or not to gui</span></h2></li></ul>
<p><span class="font25">Recent Linux distributions often include a graphical application to configure the network. Some people complain that these applications mess networking configurations up when used simultaneously with command line configurations. Notably </span><span class="font25" style="font-weight:bold;">Network Manager </span><span class="font25">(often replaced by </span><span class="font25" style="font-weight:bold;">wicd</span><span class="font25">) and </span><span class="font25" style="font-weight:bold;">yast </span><span class="font25">are known to not care about configuration changes via the command line.</span></p>
<p><span class="font25">Since the goal of this course is </span><span class="font25" style="font-weight:bold;">server </span><span class="font25">administration, we will assume our Linux servers are always administered through the command line.</span></p>
<p><span class="font25">This chapter only focuses on using the command line for network interface configuration!</span></p>
<p><span class="font25">Unfortunately there is no single combination of Linux commands and </span><span class="font25" style="font-weight:bold;">/etc </span><span class="font25">files that works on all Linux distributions. We discuss networking on two (large but distinct) Linux distribution families.</span></p>
<p><span class="font25">We start with </span><span class="font25" style="font-weight:bold;">Debian </span><span class="font25">(this should also work on Ubuntu and Mint), then continue with </span><span class="font25" style="font-weight:bold;">RHEL </span><span class="font25">(which is identical to CentOS and Fedora).</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4820"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4423"></a><a name="bookmark4821"></a>2.2. Debian nic configuration</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark4822"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4823"></a>2.2.1. /etc/network/interfaces</span></h3></li></ul></li></ul>
<p><a name="bookmark4824"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">/etc/network/interfaces </span><span class="font25">file is a core network interface card configuration file on </span><span class="font25" style="font-weight:bold;">debian</span><span class="font25">.</span></p>
<p><span class="font7" style="font-weight:bold;">dhcp client</span></p>
<p><a name="bookmark4825"></a><span class="font25"><a name="bookmark4826"></a>The screenshot below shows that our computer is configured for </span><span class="font25" style="font-weight:bold;">dhcp </span><span class="font25">on </span><span class="font25" style="font-weight:bold;">eth0 </span><span class="font25">(the first network interface card or nic).</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">cat /etc/network/interfaces </span><span class="font19"># This file describes the network interfaces available on your system # and how to activate them. For more information, see interfaces(5).</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># The loopback network interface auto lo iface lo inet loopback auto eth0 iface eth0 inet dhcp</span></p></li></ul>
<p><span class="font25">Configuring network cards for </span><span class="font25" style="font-weight:bold;">dhcp </span><span class="font25">is good practice for clients, but servers usually require a </span><span class="font25" style="font-weight:bold;">fixed ip address</span><span class="font25">.</span></p>
<p><span class="font7" style="font-weight:bold;">fixed ip</span></p>
<p><a name="bookmark4827"></a><span class="font25">The screenshot below shows </span><span class="font25" style="font-weight:bold;">/etc/network/interfaces </span><span class="font25">configured with a </span><span class="font25" style="font-weight:bold;">fixed ip address</span><span class="font25">.</span></p>
<p><span class="font19">root@debian7~# </span><span class="font19" style="font-weight:bold;">cat /etc/network/interfaces </span><span class="font19">auto lo iface lo inet loopback auto eth0 iface eth0 inet static address 10.42.189.198 broadcast 10.42.189.207 netmask 255.255.255.240 gateway 10.42.189.193</span></p>
<p><span class="font25">The screenshot above also shows that you can provide more configuration than just the ip address. See </span><span class="font25" style="font-weight:bold;">interfaces(5) </span><span class="font25">for help on setting a </span><span class="font25" style="font-weight:bold;">gateway</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">netmask </span><span class="font25">or any of the other options.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4828"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4829"></a>2.2.2. /sbin/ifdown</span></h3></li></ul>
<h4><a name="bookmark4830"></a><span class="font25"><a name="bookmark4831"></a>It is adviced (but not mandatory)<a name="bookmark4832"></a> to down an interface before changing its configuration. This can be done with the </span><span class="font25" style="font-weight:bold;">ifdown </span><span class="font25">command.</span></h4>
<h4><a name="bookmark4833"></a><span class="font25"><a name="bookmark4834"></a>The command will not give any output when downing an interface with a fixed ip address. However </span><span class="font25" style="font-weight:bold;">ifconfig </span><span class="font25">will no longer show the interface.</span></h4>
<p><span class="font19">root@ubu1104srv:~# </span><span class="font19" style="font-weight:bold;">ifdown eth0 </span><span class="font19">root@ubu1104srv:~# </span><span class="font19" style="font-weight:bold;">ifconfig </span><span class="font19">lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host UP LOOPBACK RUNNING MTU:16436 Metric:1 RX packets:106 errors:0 dropped:0 overruns:0 frame:0 TX packets:106 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:11162 (11.1 KB) TX bytes:11162 (11.1 KB)</span></p>
<h4><a name="bookmark4835"></a><span class="font25"><a name="bookmark4836"></a>An interface that is down cannot be used to connect to the network.</span></h4>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4837"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4838"></a>2.2.3. /sbin/ifup</span></h3></li></ul>
<p><a name="bookmark4839"></a><span class="font25">Below a screenshot of </span><span class="font25" style="font-weight:bold;">ifup </span><span class="font25">bringing the </span><span class="font25" style="font-weight:bold;">eth0 </span><span class="font25">ethernet interface up using dhcp. (Note that this is a Ubuntu 10.10 screenshot, Ubuntu 11.04 omits </span><span class="font25" style="font-weight:bold;">ifup </span><span class="font25">output by default.) </span><span class="font19">root@ubu1010srv:/etc/network# ifup eth0 Internet Systems Consortium DHCP Client V3.1.3 Copyright 2004-2009 Internet Systems Consortium. All rights reserved. For info, please visit </span><a href="https://www.isc.org/software/dhcp/"><span class="font19">https://www.isc.org/software/dhcp/</span></a></p>
<p><span class="font19">Listening on LPF/eth0/08:00:27:cd:7f:fc Sending on &nbsp;&nbsp;LPF/eth0/08:00:27:cd:7f:fc</span></p>
<p><span class="font19">Sending on &nbsp;&nbsp;Socket/fallback</span></p>
<p><span class="font19">DHCPREQUEST of 192.168.1.34 on eth0 to 255.255.255.255 port 67 DHCPNAK from 192.168.33.100 DHCPDISCOVER on eth0 to 255.255.255.255 port 67 interval 3 DHCPOFFER of 192.168.33.77 from 192.168.33.100</span></p>
<p><span class="font19">DHCPREQUEST of 192.168.33.77 on eth0 to 255.255.255.255 port 67 DHCPACK of 192.168.33.77 from 192.168.33.100 bound to 192.168.33.77 -- renewal in 95 seconds. ssh stop/waiting ssh start/running, process 1301 root@ubu1010srv:/etc/network#</span></p>
<h4><a name="bookmark4840"></a><span class="font25"><a name="bookmark4841"></a>The details of </span><span class="font25" style="font-weight:bold;">dhcp </span><span class="font25">are covered in a separate chapter in the </span><span class="font25" style="font-weight:bold;">Linux Servers </span><span class="font25">course.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4842"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4424"></a><a name="bookmark4843"></a>2.3. RHEL nic configuration</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark4844"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4845"></a>2.3.1. /etc/sysconfig/network</span></h3></li></ul></li></ul>
<p><a name="bookmark4846"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">/etc/sysconfig/network </span><span class="font25">file is a global (across all network cards) configuration file. It allows us to define whether we want networking (NETWORKING=yes|no), what the hostname should be (HOSTNAME=) and which gateway to use (GATEWAY=).</span></p>
<p><span class="font19">[root@rhel6 ~]# </span><span class="font19" style="font-weight:bold;">cat /etc/sysconfig/network</span></p>
<p><span class="font19">NETWORKING=yes</span></p>
<p><span class="font19">HOSTNAME=rhel6</span></p>
<p><span class="font19">GATEWAY=192.168.1.1</span></p>
<p><a name="bookmark4847"></a><span class="font25">There are a dozen more options settable in this file, details can be found in </span><span class="font25" style="font-weight:bold;">/usr/share/doc/ initscripts-*/sysconfig.txt</span><span class="font25">.</span></p>
<p><span class="font25">Note that this file contains no settings at all in a default RHEL7 install (with networking enabled).</span></p>
<p><span class="font19">[root@rhel71 ~]# </span><span class="font19" style="font-weight:bold;">cat /etc/sysconfig/network</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Created by anaconda</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4848"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4849"></a>2.3.2. /etc/sysconfig/network-scripts/ifcfg-</span></h3></li></ul>
<p><a name="bookmark4850"></a><span class="font25">Each network card can be configured individually using the </span><span class="font25" style="font-weight:bold;">/etc/sysconfig/network-scripts/ ifcfg-* </span><span class="font25">files. When you have only one network card, then this will probably be </span><span class="font25" style="font-weight:bold;">/etc/ sysconfig/network-scripts/ifcfg-eth0</span><span class="font25">.</span></p>
<p><span class="font7" style="font-weight:bold;">dhcp client</span></p>
<p><span class="font25">Below a screenshot of </span><span class="font25" style="font-weight:bold;">/etc/sysconfig/network-scripts/ifcfg-eth0 </span><span class="font25">configured for dhcp (BOOTPROTO=&quot;dhcp&quot;). Note also the NM_CONTROLLED paramater to disable control of this nic by </span><span class="font25" style="font-weight:bold;">Network Manager</span><span class="font25">. This parameter is not explained (not even mentioned) in </span><span class="font25" style="font-weight:bold;">/usr/share/doc/initscripts-*/sysconfig.txt</span><span class="font25">, but many others are.</span></p>
<p><span class="font19">[root@rhel6 ~]# </span><span class="font19" style="font-weight:bold;">cat /etc/sysconfig/network-scripts/ifcfg-ethO</span></p>
<p><span class="font19">DEVICE=&quot;eth0&quot;</span></p>
<p><span class="font19">HWADDR=&quot;08:00:27:DD:0D:5C&quot;</span></p>
<p><span class="font19">NM_CONTROLLED=&quot;no&quot;</span></p>
<p><span class="font19">BOOTPROTO=&quot;dhcp&quot;</span></p>
<p><span class="font19">ONBOOT=&quot;yes&quot;</span></p>
<p><a name="bookmark4851"></a><span class="font25"><a name="bookmark4852"></a>The BOOTPROTO variable can be set to either </span><span class="font25" style="font-weight:bold;">dhcp </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">bootp</span><span class="font25">, anything else will be considered </span><span class="font25" style="font-weight:bold;">static </span><span class="font25">meaning there should be no protocol used at boot time to set the interface values.</span></p>
<p><span class="font25">RHEL7 adds </span><span class="font25" style="font-weight:bold;">ipv6 </span><span class="font25">variables to this file.</span></p>
<p><span class="font19">[root@rhel71 network-scripts]# </span><span class="font19" style="font-weight:bold;">cat ifcfg-enp0s3</span></p>
<p><span class="font19">TYPE=&quot;Ethernet&quot;</span></p>
<p><span class="font19">BOOTPROTO=&quot;dhcp&quot;</span></p>
<p><span class="font19">DEFROUTE=&quot;yes&quot;</span></p>
<p><span class="font19">PEERDNS=&quot;yes&quot;</span></p>
<p><span class="font19">PEERROUTES=&quot;yes&quot;</span></p>
<p><span class="font19">IPV4 FAILURE FATAL=&quot;no&quot;</span></p>
<p><span class="font19">IPV6INIT=&quot;yes&quot;</span></p>
<p><span class="font19">IPV6_AUTOCONF=&quot;yes&quot;</span></p>
<p><span class="font19">IPV6_DEFROUTE=&quot;yes&quot;</span></p>
<p><span class="font19">IPV6_PEERDNS=&quot;yes&quot;</span></p>
<p><span class="font19">IPV6_PEERROUTES=&quot;yes&quot;</span></p>
<p><span class="font19">IPV6_FAILURE_FATAL=&quot;no&quot;</span></p>
<p><span class="font19">NAME=&quot;enp0s3&quot;</span></p>
<p><span class="font19">UUID=&quot;9fa6a83a-2f8e-4ecc-962c-5f614605f4ee&quot;</span></p>
<p><span class="font19">DEVICE=&quot;enp0s3&quot;</span></p>
<p><span class="font19">ONBOOT=&quot;yes&quot;</span></p>
<p><span class="font19">[root@rhel71 network-scripts]#</span></p>
<p><span class="font7" style="font-weight:bold;">fixed ip</span></p>
<p><a name="bookmark4853"></a><span class="font25">Below a screenshot of a </span><span class="font25" style="font-weight:bold;">fixed ip </span><span class="font25">configuration in </span><span class="font25" style="font-weight:bold;">/etc/sysconfig/network-scripts/ifcfg-eth0</span><span class="font25">.</span></p>
<p><span class="font19">[root@rhel6 ~]# </span><span class="font19" style="font-weight:bold;">cat /etc/sysconfig/network-scripts/ifcfg-ethO</span></p>
<p><span class="font19">DEVICE=&quot;eth0&quot;</span></p>
<p><span class="font19">HWADDR=&quot;08:00:27:DD:0D:5C&quot;</span></p>
<p><span class="font19">NM_CONTROLLED=&quot;no&quot;</span></p>
<p><span class="font19">BOOTPROTO=&quot;none&quot;</span></p>
<p><span class="font19">IPADDR=&quot;192.168.1.99&quot;</span></p>
<p><span class="font19">NETMASK=&quot;255.255.255.0&quot;</span></p>
<p><span class="font19">GATEWAY=&quot;192.168.1.1&quot;</span></p>
<p><span class="font19">ONBOOT=&quot;yes&quot;</span></p>
<p><span class="font25">The HWADDR can be used to make sure that each network card gets the correct name when multiple network cards are present in the computer. It can not be used to assign a </span><span class="font25" style="font-weight:bold;">mac address </span><span class="font25">to a network card. For this, you need to specif<a name="bookmark4854"></a>y the MACADDR variable. Do not use HWADDR and MACADDR in the same </span><span class="font25" style="font-weight:bold;">ifcfg-ethx </span><span class="font25">file.</span></p>
<p><span class="font25">The BROADCAST= and NETWORK= parameters from previous RHEL/Fedora versions are obsoleted.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4855"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4856"></a>2.3.3. nmcli</span></h3></li></ul>
<p><span class="font25">On RHEL7 you should run </span><span class="font25" style="font-weight:bold;">nmcli connection reload </span><span class="font25">if you changed configuration files in </span><span class="font25" style="font-weight:bold;">/etc/sysconfig/ </span><span class="font25">to enable your changes.</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">nmcli </span><span class="font25">tool has many options to configure networking on the command line in RHEL7/</span></p>
<div>
<p><span class="font25">CentOS7</span></p>
<p><span class="font19">man nmcli</span></p>
<p><span class="font9" style="font-weight:bold;">3.4. nmtui</span></p>
</div><br clear="all">
<h3><a name="bookmark4857"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4858"></a>2.</span></h3>
<p><span class="font25">Another recommendation for RHEL7/CentOS7 is to use </span><span class="font25" style="font-weight:bold;">nmtui</span><span class="font25">. This tool will use a 'windowed' interface in command line to manage network interfaces.</span></p>
<p><span class="font19">nmtui</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4859"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4860"></a>2.3.5. /sbin/ifup and /sbin/ifdown</span></h3></li></ul>
<h4><a name="bookmark4861"></a><span class="font25"><a name="bookmark4862"></a><a name="bookmark4863"></a><a name="bookmark4864"></a>The </span><span class="font25" style="font-weight:bold;">ifup </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">ifdown </span><span class="font25">commands will set an interface up or down, using the configuration discussed above. This is identical to their behaviour in Debian and Ubuntu.</span></h4>
<p><span class="font19">[root@rhel6 ~]# ifdown eth0 &amp;&amp;&nbsp;ifup eth0</span></p>
<p><span class="font19">[root@rhel6 ~]# ifconfig eth0</span></p>
<p><span class="font19">eth0 Link encap:Ethernet HWaddr 08:00:27:DD:0D:5C</span></p>
<p><span class="font19">inet addr:192.168.1.99 Bcast:192.168.1.255 Mask:255.255.255.0 inet6 addr: fe80::a00:27ff:fedd:d5c/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:2452 errors:0 dropped:0 overruns:0 frame:0 TX packets:1881 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000</span></p>
<p><span class="font19">RX bytes:257036 (251.0 KiB) TX bytes:184767 (180.4 KiB)</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4865"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4425"></a><a name="bookmark4866"></a>2.4. ifconfig</span></h2></li></ul>
<h4><a name="bookmark4867"></a><span class="font25"><a name="bookmark4868"></a><a name="bookmark4869"></a>The use of </span><span class="font25" style="font-weight:bold;">/sbin/ifconfig </span><span class="font25">without any arguments will present you with a list of all active network interface cards, including wireless and the loopback interface. In the screenshot below </span><span class="font25" style="font-weight:bold;">eth0 </span><span class="font25">has no ip address.</span></h4>
<p><span class="font19">root@ubu1010:~# ifconfig</span></p>
<p><span class="font19">eth0 Link encap:Ethernet HWaddr 00:26:bb:5d:2e:52</span></p>
<p><span class="font19">UP BROADCAST MULTICAST MTU:1500 Metric:1</span></p>
<p><span class="font19">RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span></p>
<p><span class="font19">TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000</span></p>
<p><span class="font19">RX bytes:0 (0.0 B) TX bytes:0 (0.0 B) Interrupt:43 Base address:0xe000</span></p>
<p><span class="font19">eth1 Link encap:Ethernet HWaddr 00:26:bb:12:7a:5e inet addr:192.168.1.30 Bcast:192.168.1.255 Mask:255.255.255.0 inet6 addr: fe80::226:bbff:fe12:7a5e/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1</span></p>
<p><span class="font19">RX packets:11141791 errors:202 dropped:0 overruns:0 frame:11580126 TX packets:6473056 errors:3860 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:3476531617 (3.4 GB) TX bytes:2114919475 (2.1 GB) Interrupt:23</span></p>
<p><span class="font19">lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host UP LOOPBACK RUNNING MTU:16436 Metric:1 RX packets:2879 errors:0 dropped:0 overruns:0 frame:0 TX packets:2879 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:486510 (486.5 KB) TX bytes:486510 (486.5 KB)</span></p>
<h4><a name="bookmark4870"></a><span class="font25"><a name="bookmark4871"></a>You can also use </span><span class="font25" style="font-weight:bold;">ifconfig </span><span class="font25">to obtain information about just one network card.</span></h4>
<p><span class="font19">[root@rhel6 ~]# ifconfig eth0</span></p>
<p><span class="font19">eth0 Link encap:Ethernet HWaddr 08:00:27:DD:0D:5C</span></p>
<p><span class="font19">inet addr:192.168.1.99 Bcast:192.168.1.255 Mask:255.255.255.0 inet6 addr: fe80::a00:27ff:fedd:d5c/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:2969 errors:0 dropped:0 overruns:0 frame:0 TX packets:1918 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000</span></p>
<p><span class="font19">RX bytes:335942 (328.0 KiB) TX bytes:190157 (185.7 KiB)</span></p>
<p><a name="bookmark4872"></a><span class="font25">When </span><span class="font25" style="font-weight:bold;">/sbin </span><span class="font25">is not in the </span><span class="font25" style="font-weight:bold;">$PATH </span><span class="font25">of a normal user you will have to type the full path, as seen here on Debian.</span></p>
<p><span class="font19">paul@debian5:~$ /sbin/ifconfig eth3</span></p>
<p><span class="font19">eth3 Link encap:Ethernet HWaddr 08:00:27:ab:67:30</span></p>
<p><span class="font19">inet addr:192.168.1.29 Bcast:192.168.1.255 Mask:255.255.255.0 inet6 addr: fe80::a00:27ff:feab:6730/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:27155 errors:0 dropped:0 overruns:0 frame:0 TX packets:30527 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:13095386 (12.4 MiB) TX bytes:25767221 (24.5 MiB)</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4873"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4874"></a>2.4.1. up and down</span></h3></li></ul>
<p><a name="bookmark4875"></a><span class="font25"><a name="bookmark4876"></a>You can also use </span><span class="font25" style="font-weight:bold;">ifconfig </span><span class="font25">to bring an interface up or down. The difference with </span><span class="font25" style="font-weight:bold;">ifup </span><span class="font25">is that </span><span class="font25" style="font-weight:bold;">ifconfig eth0 up </span><span class="font25">will re-activate the nic keeping its existing (current) configuration, whereas </span><span class="font25" style="font-weight:bold;">ifup </span><span class="font25">will read the correct file that contains a (possibly new) configuration and use this config file to bring the interface up.</span></p>
<p><span class="font19">[root@rhel6 ~]# ifconfig eth0 down</span></p>
<p><span class="font19">[root@rhel6 ~]# ifconfig eth0 up</span></p>
<p><span class="font19">[root@rhel6 ~]# ifconfig eth0</span></p>
<p><span class="font19">eth0 Link encap:Ethernet HWaddr 08:00:27:DD:0D:5C</span></p>
<p><span class="font19">inet addr:192.168.1.99 Bcast:192.168.1.255 Mask:255.255.255.0 inet6 addr: fe80::a00:27ff:fedd:d5c/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:2995 errors:0 dropped:0 overruns:0 frame:0 TX packets:1927 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:339030 (331.0 KiB) TX bytes:191583 (187.0 KiB)</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4877"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4878"></a>2.4.2. setting ip address</span></h3></li></ul>
<p><a name="bookmark4879"></a><span class="font25">You can </span><span class="font25" style="font-weight:bold;">temporary </span><span class="font25">set an ip address with </span><span class="font25" style="font-weight:bold;">ifconfig</span><span class="font25">. This ip address is only valid until the next </span><span class="font25" style="font-weight:bold;">ifup/ifdown </span><span class="font25">cycle or until the next </span><span class="font25" style="font-weight:bold;">reboot</span><span class="font25">.</span></p>
<p><span class="font19">[root@rhel6 ~]# ifconfig eth0 | grep 192</span></p>
<p><span class="font19">inet addr:192.168.1.99 Bcast:192.168.1.255 Mask:255.255.255.0 [root@rhel6 ~]# ifconfig eth0 192.168.33.42 netmask 255.255.0.0 [root@rhel6 ~]# ifconfig eth0 | grep 192</span></p>
<p><span class="font19">inet addr:192.168.33.42 &nbsp;Bcast:192.168.255.255 Mask:255.255.0.0</span></p>
<p><span class="font19">[root@rhel6 ~]# ifdown eth0 &amp;&amp;&nbsp;ifup eth0 [root@rhel6 ~]# ifconfig eth0 | grep 192</span></p>
<p><span class="font19">inet addr:192.168.1.99 Bcast:192.168.1.255 Mask:255.255.255.0</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4880"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4881"></a>2.4.3. setting mac address</span></h3></li></ul>
<p><a name="bookmark4882"></a><span class="font25">You can also use </span><span class="font25" style="font-weight:bold;">ifconfig </span><span class="font25">to set another </span><span class="font25" style="font-weight:bold;">mac address </span><span class="font25">than the one hard coded in the network card. This screenshot shows you how.</span></p>
<p><span class="font19">[root@rhel6 ~]# ifconfig eth0 | grep HWaddr</span></p>
<p><span class="font19">eth0 Link encap:Ethernet HWaddr 08:00:27:DD:0D:5C</span></p>
<p><span class="font19">[root@rhel6 ~]# ifconfig eth0 hw ether 00:42:42:42:42:42</span></p>
<p><span class="font19">[root@rhel6 ~]# ifconfig eth0 | grep HWaddr</span></p>
<p><span class="font19">eth0 Link encap:Ethernet HWaddr 00:42:42:42:42:42</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4883"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4426"></a><a name="bookmark4884"></a>2.5. ip</span></h2></li></ul>
<h4><a name="bookmark4885"></a><span class="font25"><a name="bookmark4886"></a>The </span><span class="font25" style="font-weight:bold;">ifconfig </span><span class="font25">tool is deprecated on some systems. Use the </span><span class="font25" style="font-weight:bold;">ip </span><span class="font25">tool instead.</span><br><br><span class="font25"><a name="bookmark4887"></a>To see ip addresses on RHEL7 for example, use this command:</span></h4>
<p><span class="font19">[root@rhel71 ~]# </span><span class="font19" style="font-weight:bold;">ip a</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever</span></p></li>
<li>
<p><span class="font19">2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000 link/ether 08:00:27:89:22:33 brd ff:ff:ff:ff:ff:ff inet 192.168.1.135/24 brd 192.168.1.255 scope global dynamic enp0s3 valid_lft 6173sec preferred_lft 6173sec inet6 fe80::a00:27ff:fe89:2233/64 scope link valid_lft forever preferred_lft forever [root@rhel71 ~]#</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4888"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4427"></a><a name="bookmark4889"></a>2.6. dhclient</span></h2></li></ul>
<p><a name="bookmark4890"></a><span class="font25"><a name="bookmark4891"></a>Home and client Linux desktops often have </span><span class="font25" style="font-weight:bold;">/sbin/dhclient </span><span class="font25">running. This is a daemon that enables a network interface to lease an ip configuration from a </span><span class="font25" style="font-weight:bold;">dhcp server</span><span class="font25">. When your adapter is configured for </span><span class="font25" style="font-weight:bold;">dhcp </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">bootp</span><span class="font25">, then </span><span class="font25" style="font-weight:bold;">/sbin/ifup </span><span class="font25">will start the </span><span class="font25" style="font-weight:bold;">dhclient </span><span class="font25">daemon.</span></p>
<p><span class="font25">When a lease is renewed, </span><span class="font25" style="font-weight:bold;">dhclient </span><span class="font25">will override your </span><span class="font25" style="font-weight:bold;">ifconfig </span><span class="font25">set ip address!</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4892"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4428"></a><a name="bookmark4893"></a>2.7. hostname</span></h2></li></ul>
<p><a name="bookmark4894"></a><span class="font25"><a name="bookmark4895"></a>Every host receives a </span><span class="font25" style="font-weight:bold;">hostname</span><span class="font25">, often placed in a </span><span class="font25" style="font-weight:bold;">DNS name space </span><span class="font25">forming the </span><span class="font25" style="font-weight:bold;">fqdn </span><span class="font25">or Fully Qualified Domain Name.</span></p>
<p><span class="font25">This screenshot shows the </span><span class="font25" style="font-weight:bold;">hostname </span><span class="font25">command and the configuration of the hostname on Red Hat/Fedora.</span></p>
<p><span class="font19">[root@rhel6 ~]# </span><span class="font19" style="font-weight:bold;">grep HOSTNAME /etc/sysconfig/network</span></p>
<p><span class="font19">HOSTNAME=rhel6</span></p>
<p><span class="font19">[root@rhel6 ~]# </span><span class="font19" style="font-weight:bold;">hostname </span><span class="font19">rhel6</span></p>
<p><span class="font25">Starting with RHEL7/CentOS7 this file is empty. The hostname is configured in the standard </span><span class="font25" style="font-weight:bold;">/etc/hostname </span><span class="font25">file.</span></p>
<p><span class="font19">[root@rhel71 ~]# </span><span class="font19" style="font-weight:bold;">cat /etc/hostname</span></p>
<p><span class="font19">rhel71.linux-training.be [root@rhel71 ~]#</span></p>
<p><a name="bookmark4896"></a><span class="font25">Ubuntu/Debian uses the </span><span class="font25" style="font-weight:bold;">/etc/hostname </span><span class="font25">file to configure the </span><span class="font25" style="font-weight:bold;">hostname</span><span class="font25">.</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">cat /etc/hostname</span></p>
<p><span class="font19">server42</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">hostname </span><span class="font19">server42</span></p>
<p><a name="bookmark4897"></a><span class="font25">On all Linux distributions you can change the </span><span class="font25" style="font-weight:bold;">hostname </span><span class="font25">using the </span><span class="font25" style="font-weight:bold;">hostname $newname </span><span class="font25">command. This is not a permanent change.</span></p>
<p><span class="font19">[root@rhel6 ~]# hostname server42</span></p>
<p><span class="font19">[root@rhel6 ~]# hostname</span></p>
<p><span class="font19">server42</span></p>
<p><a name="bookmark4898"></a><span class="font25">On any Linux you can use </span><span class="font25" style="font-weight:bold;">sysctl </span><span class="font25">to display and set the hostname.</span></p>
<p><span class="font19">[root@rhel6 ~]# sysctl kernel.hostname kernel.hostname = server42</span></p>
<p><span class="font19">[root@rhel6 ~]# sysctl kernel.hostname=rhel6 kernel.hostname = rhel6</span></p>
<p><span class="font19">[root@rhel6 ~]# sysctl kernel.hostname kernel.hostname = rhel6</span></p>
<p><span class="font19">[root@rhel6 ~]# hostname</span></p>
<p><span class="font19">rhel6</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4899"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4429"></a><a name="bookmark4900"></a>2.8. arp</span></h2></li></ul>
<h4><a name="bookmark4901"></a><span class="font25"><a name="bookmark4902"></a><a name="bookmark4903"></a>The </span><span class="font25" style="font-weight:bold;">ip to mac </span><span class="font25">resolution is handled by the </span><span class="font25" style="font-weight:bold;">layer two broadcast </span><span class="font25">protocol </span><span class="font25" style="font-weight:bold;">arp</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">arp table </span><span class="font25">can be displayed with the </span><span class="font25" style="font-weight:bold;">arp tool</span><span class="font25">. The screenshot below shows the list of computers that this computer recently communicated with.</span></h4>
<p><span class="font19">root@barry:~# arp -a</span></p>
<p><span class="font19">? (192.168.1.191) at 00:0C:29:3B:15:80 [ether] on ethl agapi (192.168.1.73) at 00:03:BA:09:7F:D2 [ether] on eth1 anya (192.168.1.1) at 00:12:01:E2:87:FB [ether] on eth1 faith (192.168.1.41) at 00:0E:7F:41:0D:EB [ether] on eth1</span></p>
<p><span class="font19">kiss (192.168.1.49) at 00:D0:E0:91:79:95 [ether] on eth1 laika (192.168.1.40) at 00:90:F5:4E:AE:17 [ether] on eth1</span></p>
<p><span class="font19">pasha (192.168.1.71) at 00:03:BA:02:C3:82 [ether] on eth1</span></p>
<p><span class="font19">shaka (192.168.1.72) at 00:03:BA:09:7C:F9 [ether] on eth1</span></p>
<p><span class="font19">root@barry:~#</span></p>
<p><span class="font25" style="font-style:italic;">Anya is a Cisco Firewall, faith is a laser printer, kiss is a Kiss DP600, laika is a laptop and Agapi, Shaka and Pasha are SPARC servers. The question mark is a Red Hat Enterprise Linux server running on a virtual machine.</span></p>
<h4><a name="bookmark4904"></a><span class="font25"><a name="bookmark4905"></a><a name="bookmark4906"></a>You can use </span><span class="font25" style="font-weight:bold;">arp -d </span><span class="font25">to remove an entry from the </span><span class="font25" style="font-weight:bold;">arp table</span><span class="font25">.</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[root@rhel6 ~]#</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">arp</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Address</span></p></td><td style="vertical-align:top;">
<p><span class="font19">HWtype HWaddress &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Flags Mask &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Iface</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">ubu1010</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ether 00:26:bb:12:7a:5e C &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eth0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">anya</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ether 00:02:cf:aa:68:f0 C &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eth0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[root@rhel6 ~]#</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">arp -d anya</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[root@rhel6 ~]#</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">arp</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Address</span></p></td><td style="vertical-align:top;">
<p><span class="font19">HWtype HWaddress &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Flags Mask &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Iface</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">ubu1010</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ether 00:26:bb:12:7a:5e C &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eth0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">anya</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">(incomplete) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eth0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">[root@rhel6 ~]#</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ping anya</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">PING anya (192.</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">168.1.1) 56(84) bytes of data.</span></p></td></tr>
<tr><td colspan="2" style="vertical-align:top;">
<p><span class="font19">64 bytes from anya (192.168.1.1): icmp_seq=1 ttl=254 time=10.2 ms</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">...</span></p>
<p><span class="font19">[root@rhel6 ~]#</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">arp</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Address</span></p></td><td style="vertical-align:top;">
<p><span class="font19">HWtype HWaddress &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Flags Mask &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Iface</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">ubu1010</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ether 00:26:bb:12:7a:5e C &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eth0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">anya</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ether 00:02:cf:aa:68:f0 C &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eth0</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4907"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4430"></a><a name="bookmark4908"></a>2.9. route</span></h2></li></ul>
<h4><a name="bookmark4909"></a><span class="font25"><a name="bookmark4910"></a><a name="bookmark4911"></a><a name="bookmark4912"></a>You can see the computer's local routing table with the </span><span class="font25" style="font-weight:bold;">/sbin/route </span><span class="font25">command (and also with </span><span class="font25" style="font-weight:bold;">netstat -r </span><span class="font25">).</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">root@RHEL4b ~]# netstat</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">-r</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Kernel IP routing table</span></p>
<p><span class="font19">Destination &nbsp;&nbsp;&nbsp;&nbsp;Gateway</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Genmask</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Flags</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">MSS Window</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">irtt</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Iface</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">192.168.1.0 &nbsp;&nbsp;&nbsp;&nbsp;*</span></p></td><td style="vertical-align:top;">
<p><span class="font19">255.255.255.0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">U</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0 0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">eth0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">[root@RHEL4b ~]# route Kernel IP routing table Destination &nbsp;&nbsp;&nbsp;&nbsp;Gateway</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Genmask</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Flags</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Metric Ref</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Use</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Iface</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">192.168.1.0 &nbsp;&nbsp;&nbsp;&nbsp;*</span></p></td><td style="vertical-align:top;">
<p><span class="font19">255.255.255.0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">U</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">eth0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">[root@RHEL4b ~]#</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
</table>
<h4><a name="bookmark4913"></a><span class="font25"><a name="bookmark4914"></a><a name="bookmark4915"></a><a name="bookmark4916"></a><a name="bookmark4917"></a>It appears this computer does not have a </span><span class="font25" style="font-weight:bold;">gateway </span><span class="font25">configured, so we use </span><span class="font25" style="font-weight:bold;">route add default gw </span><span class="font25">to add a </span><span class="font25" style="font-weight:bold;">default gateway </span><span class="font25">on the fly.</span></h4>
<p><span class="font19">[root@RHEL4b ~]# route add default gw 192.168.1.1</span></p>
<p><span class="font19">[root@RHEL4b ~]# route</span></p>
<p><span class="font19">Kernel IP routing table</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Destination</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Gateway</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Genmask</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Flags</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Metric</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Ref</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Use</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Iface</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">192.168.1.0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">*</span></p></td><td style="vertical-align:top;">
<p><span class="font19">255.255.255.0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">U</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">eth0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">default</span></p></td><td style="vertical-align:top;">
<p><span class="font19">192.168.1.1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0.0.0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">UG</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">eth0</span></p></td></tr>
</table>
<p><span class="font19">[root@RHEL4b ~]#</span></p>
<h4><a name="bookmark4918"></a><span class="font25"><a name="bookmark4919"></a>Unless you configure the gateway in one of the </span><span class="font25" style="font-weight:bold;">/etc/ </span><span class="font25">file from the start of this chapter, your computer will forget this </span><span class="font25" style="font-weight:bold;">gateway </span><span class="font25">after a reboot.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4920"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4431"></a><a name="bookmark4921"></a>2.10. ping</span></h2></li></ul>
<h4><a name="bookmark4922"></a><span class="font25"><a name="bookmark4923"></a><a name="bookmark4924"></a>If you can </span><span class="font25" style="font-weight:bold;">ping </span><span class="font25">to another host, then </span><span class="font25" style="font-weight:bold;">tcp/ip </span><span class="font25">is configured.</span></h4>
<p><span class="font19">[root@RHEL4b ~]# ping 192.168.1.5</span></p>
<p><span class="font19">PING 192.168.1.5 (192.168.1.5) 56(84) bytes of data.</span></p>
<p><span class="font19">64 bytes from 192.168.1.5: icmp_seq=0 ttl=64 time=1004 ms</span></p>
<p><span class="font19">64 bytes from 192.168.1.5: icmp_seq=1 ttl=64 time=1.19 ms</span></p>
<p><span class="font19">64 bytes from 192.168.1.5: icmp_seq=2 ttl=64 time=0.494 ms</span></p>
<p><span class="font19">64 bytes from 192.168.1.5: icmp_seq=3 ttl=64 time=0.419 ms</span></p>
<p><span class="font19">--- 192.168.1.5 ping statistics ---</span></p>
<p><span class="font19">4 packets transmitted, 4 received, 0% packet loss, time 3009ms rtt min/avg/max/mdev = 0.419/251.574/1004.186/434.520 ms, pipe 2 [root@RHEL4b ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4925"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4432"></a><a name="bookmark4926"></a>2.11. optional: ethtool</span></h2></li></ul>
<h4><a name="bookmark4927"></a><span class="font25"><a name="bookmark4928"></a><a name="bookmark4929"></a>To display or change network card settings, use </span><span class="font25" style="font-weight:bold;">ethtool</span><span class="font25">. The results depend on the capabilities of your network card. The example shows a network that auto-negotiates it's bandwidth.</span></h4>
<p><span class="font19">root@laika:~# ethtool eth0</span></p>
<p><span class="font19">Settings for eth0:</span></p>
<p><span class="font19">Supported ports: [ TP ]</span></p>
<p><span class="font19">Supported link modes: &nbsp;&nbsp;10baseT/Half 10baseT/Full</span></p>
<p><span class="font19">100baseT/Half 100baseT/Full</span></p>
<p><span class="font19">1000baseT/Full</span></p>
<p><span class="font19">Supports auto-negotiation: Yes</span></p>
<p><span class="font19">Advertised link modes: 10baseT/Half 10baseT/Full</span></p>
<p><span class="font19">100baseT/Half 100baseT/Full</span></p>
<p><span class="font19">1000baseT/Full</span></p>
<p><span class="font19">Advertised auto-negotiation: Yes</span></p>
<p><span class="font19">Speed: 1000Mb/s</span></p>
<p><span class="font19">Duplex: Full</span></p>
<p><span class="font19">Port: Twisted Pair</span></p>
<p><span class="font19">PHYAD: 0</span></p>
<p><span class="font19">Transceiver: internal</span></p>
<p><span class="font19">Auto-negotiation: on</span></p>
<p><span class="font19">Supports Wake-on: pumbg</span></p>
<p><span class="font19">Wake-on: g</span></p>
<p><span class="font19">Current message level: 0x00000033 (51)</span></p>
<p><span class="font19">Link detected: yes</span></p>
<h4><a name="bookmark4930"></a><span class="font25"><a name="bookmark4931"></a>This example shows how to use ethtool to switch the bandwidth from 1000Mbit to 100Mbit and back. Note that some time passes before the nic is back to 1000Mbit.</span></h4>
<p><span class="font19">root@laika:~# ethtool eth0 | grep Speed</span></p>
<p><span class="font19">Speed: 1000Mb/s</span></p>
<p><span class="font19">root@laika:~# ethtool -s eth0 speed 100</span></p>
<p><span class="font19">root@laika:~# ethtool eth0 | grep Speed</span></p>
<p><span class="font19">Speed: 100Mb/s</span></p>
<p><span class="font19">root@laika:~# ethtool -s eth0 speed 1000</span></p>
<p><span class="font19">root@laika:~# ethtool eth0 | grep Speed</span></p>
<p><span class="font19">Speed: 1000Mb/s</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4932"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4433"></a><a name="bookmark4933"></a>2.12. practice: interface configuration</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Verify whether </span><span class="font25" style="font-weight:bold;">dhclient </span><span class="font25">is running.</span></p></li>
<li>
<p><span class="font25">2. Display your current ip address(es).</span></p></li>
<li>
<p><span class="font25">3. Display the configuration file where this </span><span class="font25" style="font-weight:bold;">ip address </span><span class="font25">is defined.</span></p></li>
<li>
<p><span class="font25">4. Follow the </span><span class="font25" style="font-weight:bold;">nic configuration </span><span class="font25">in the book to change your ip address from </span><span class="font25" style="font-weight:bold;">dhcp client </span><span class="font25">to </span><span class="font25" style="font-weight:bold;">fixed</span><span class="font25">. Keep the same </span><span class="font25" style="font-weight:bold;">ip address </span><span class="font25">to avoid conflicts!</span></p></li>
<li>
<p><span class="font25">5. Did you also configure the correct </span><span class="font25" style="font-weight:bold;">gateway </span><span class="font25">in the previous question ? If not, then do this now.</span></p></li>
<li>
<p><span class="font25">6. Verify that you have a gateway.</span></p></li>
<li>
<p><span class="font25">7. Verify that you can connect to the gateway, that it is alive.</span></p></li>
<li>
<p><span class="font25">8. Change the last two digits of your </span><span class="font25" style="font-weight:bold;">mac address</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">9. Which ports are used by http, pop3, ssh, telnet, nntp and ftp ?</span></p></li>
<li>
<p><span class="font25">10. Explain why e-mail and websites are sent over </span><span class="font25" style="font-weight:bold;">tcp </span><span class="font25">and not </span><span class="font25" style="font-weight:bold;">udp</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">11. Display the </span><span class="font25" style="font-weight:bold;">hostname </span><span class="font25">of your computer.</span></p></li>
<li>
<p><span class="font25">12. Which ip-addresses did your computer recently have contact with ?</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4934"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4434"></a><a name="bookmark4935"></a>2.13. solution: interface configuration</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark4936"></a><span class="font25"><a name="bookmark4937"></a>1. Verify whether </span><span class="font25" style="font-weight:bold;">dhclient </span><span class="font25">is running.</span></h4></li></ul>
<p><span class="font19">paul@debian5:~$ ps fax | grep dhclient</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark4938"></a><span class="font25"><a name="bookmark4939"></a>2. Display your current ip address(es).</span></h4></li></ul>
<p><span class="font19">paul@debian5:~$ /sbin/ifconfig | grep 'inet ' inet addr:192.168.1.31 Bcast:192.168.1.255 Mask:255.255.255.0 inet addr:127.0.0.1 Mask:255.0.0.0</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark4940"></a><span class="font25"><a name="bookmark4941"></a>3. Display the configuration file where this </span><span class="font25" style="font-weight:bold;">ip address </span><span class="font25">is defined.</span></h4></li></ul>
<p><span class="font19">Ubuntu/Debian: cat /etc/network/interfaces</span></p>
<p><span class="font19">Redhat/Fedora: cat /etc/sysconfig/network-scripts/ifcfg-eth*</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark4942"></a><span class="font25"><a name="bookmark4943"></a>4. Follow the </span><span class="font25" style="font-weight:bold;">nic configuration </span><span class="font25">in the book to change your ip address from </span><span class="font25" style="font-weight:bold;">dhcp client </span><span class="font25">to </span><span class="font25" style="font-weight:bold;">fixed</span><span class="font25">. Keep the same </span><span class="font25" style="font-weight:bold;">ip address </span><span class="font25">to avoid conflicts!</span></h4></li></ul>
<p><span class="font19">Ubuntu/Debian: ifdown eth0 vi /etc/network/interfaces ifup eth0</span></p>
<p><span class="font19">Redhat/Fedora: ifdown eth0 vi /etc/sysconfig/network-scripts/ifcfg-eth0 ifup eth0</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark4944"></a><span class="font25"><a name="bookmark4945"></a>5. Did you also configure the correct </span><span class="font25" style="font-weight:bold;">gateway </span><span class="font25">in the previous question ? If not, then do this now.</span></h4></li>
<li>
<h4><a name="bookmark4946"></a><span class="font25"><a name="bookmark4947"></a>6. Verify that you have a gateway.</span></h4></li></ul>
<p><span class="font19">paul@debian5:~$ /sbin/route Kernel IP routing table</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Destination</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Gateway</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Genmask</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Flags</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Metric</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Ref</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Use</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Iface</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">192.168.1.0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">*</span></p></td><td style="vertical-align:top;">
<p><span class="font19">255.255.255.0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">U</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">eth0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">default</span></p></td><td style="vertical-align:top;">
<p><span class="font19">192.168.1.1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0.0.0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">UG</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">eth0</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h4><a name="bookmark4948"></a><span class="font25"><a name="bookmark4949"></a>7. Verify that you can connect to the gateway, that it is alive.</span></h4></li></ul>
<p><span class="font19">paul@debian5:~$ ping -c3 192.168.1.1</span></p>
<p><span class="font19">PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data.</span></p>
<p><a href="#bookmark4950"><span class="font19">64 bytes from 192.168.1.1: icmp_seq=1 ttl=254 time=2.28</span></a></p>
<p><a href="#bookmark4951"><span class="font19">64 bytes from 192.168.1.1: icmp_seq=2 ttl=254 time=2.94</span></a></p>
<p><a href="#bookmark4952"><span class="font19">64 bytes from 192.168.1.1: icmp_seq=3 ttl=254 time=2.34</span></a></p>
<p><span class="font19">--- 192.168.1.1 ping statistics ---</span></p>
<p><span class="font19">3 packets transmitted, 3 received, 0% packet loss, time 2008ms rtt min/avg/max/mdev = 2.283/2.524/2.941/0.296 ms</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark4953"></a><span class="font25"><a name="bookmark4954"></a>8. Change the last two digits of your </span><span class="font25" style="font-weight:bold;">mac address</span><span class="font25">.</span></h4></li></ul>
<p><span class="font19">[root@rhel6 ~]# ifconfig eth0 hw ether 08:00:27:ab:67:XX</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark4955"></a><span class="font25"><a name="bookmark4956"></a>9. Which ports are used by http, pop3, ssh, telnet, nntp and ftp</span></h4></li></ul>
<p><span class="font19">root@rhel6 ~# grep </span><span class="font3"><sup>A</sup></span><span class="font19">'http ' /etc/services</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">http</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">80/tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">www www-http</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">#</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">WorldWideWeb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">HTTP</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">http</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">80/udp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">www www-http</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">#</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">HyperText Transfer Protocol</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">root@rhel6</span></p></td><td style="vertical-align:top;">
<p><span class="font19">~# grep ''smtp '</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/etc/services</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">smtp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">25/tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">mail</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">smtp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">25/udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mail</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">root@rhel6</span></p></td><td style="vertical-align:top;">
<p><span class="font19">~# grep </span><span class="font3"><sup>A</sup></span><span class="font19">'ssh '</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/etc/services</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">ssh</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">22/tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19"># The</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">Secure Shell</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">(SSH) Protocol</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">ssh</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">22/udp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19"># The</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">Secure Shell</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">(SSH) Protocol</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">root@rhel6</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~# grep ''telnet</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">; ' /etc/services</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">telnet</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">23/tcp</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">telnet</span></p></td><td style="vertical-align:top;">
<p><span class="font19">23/udp</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">root@rhel6</span></p></td><td style="vertical-align:top;">
<p><span class="font19">~# grep ''nntp '</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/etc/services</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">nntp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">119/tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">readnews untp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">#</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">USENET News</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Transfer Protocol</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">nntp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">119/udp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">readnews untp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">#</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">USENET News</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Transfer Protocol</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">root@rhel6</span></p></td><td style="vertical-align:top;">
<p><span class="font19">~# grep ''ftp '</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/etc/services</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">ftp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">21/tcp</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">ftp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">21/udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">fsp fspd</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
</table>
<ul style="list-style:none;"><li>
<h4><a name="bookmark4957"></a><span class="font25"><a name="bookmark4958"></a>10. Explain why e-mail and websites are sent over </span><span class="font25" style="font-weight:bold;">tcp </span><span class="font25">and not </span><span class="font25" style="font-weight:bold;">udp</span><span class="font25">.</span></h4></li></ul>
<p><span class="font19">Because tcp is reliable and udp is not.</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark4959"></a><span class="font25"><a name="bookmark4960"></a>11. Display the </span><span class="font25" style="font-weight:bold;">hostname </span><span class="font25">of your computer.</span></h4></li></ul>
<p><span class="font19">paul@debian5:~$ hostname</span></p>
<p><span class="font19">debian5</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark4961"></a><span class="font25"><a name="bookmark4962"></a>12. Which ip-addresses did your computer recently have contact with</span></h4></li></ul>
<p><span class="font19">root@rhel6 ~# arp -a</span></p>
<p><span class="font19">? (192.168.1.1) at 00:02:cf:aa:68:f0 [ether] on eth2</span></p>
<p><span class="font19">? (192.168.1.30) at 00:26:bb:12:7a:5e [ether] on eth2</span></p>
<p><span class="font19">? (192.168.1.31) at 08:00:27:8e:8a:a8 [ether] on eth2</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark4963"></a><span class="font11" style="font-weight:bold;"><a name="bookmark4435"></a><a name="bookmark4964"></a>Chapter 3. network sniffing</span></h1></li></ul>
<p><a name="bookmark4965"></a><span class="font25"><a name="bookmark4966"></a>A network administrator should be able to use a sniffer like </span><span class="font25" style="font-weight:bold;">wireshark </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">tcpdump </span><span class="font25">to troubleshoot network problems.</span></p>
<p><span class="font25">A student should often use a sniffer to learn about networking. This chapter introduces you to </span><span class="font25" style="font-weight:bold;">network sniffing</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark4967"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4436"></a><a name="bookmark4968"></a>3.1. wireshark</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark4969"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4970"></a>3.1.1. installing wireshark</span></h3></li></ul></li></ul>
<p><span class="font25">This example shows how to install </span><span class="font25" style="font-weight:bold;">wireshark </span><span class="font25">on </span><span class="font25" style="font-weight:bold;">.deb </span><span class="font25">based distributions (including Debian, Mint, Xubuntu, and others).</span></p>
<p><span class="font19">root@debian8:~# </span><span class="font19" style="font-weight:bold;">apt-get install wireshark</span></p>
<p><span class="font19">Reading package lists... Done</span></p>
<p><span class="font19">Building dependency tree</span></p>
<p><span class="font19">Reading state information... Done</span></p>
<p><span class="font19">... (output truncated)</span></p>
<p><span class="font25">On </span><span class="font25" style="font-weight:bold;">.rpm </span><span class="font25">based distributions like CentOS, RHEL and Fedora you can use </span><span class="font25" style="font-weight:bold;">yum </span><span class="font25">to install </span><span class="font25" style="font-weight:bold;">wireshark</span><span class="font25">.</span></p>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">yum install wireshark</span></p>
<p><span class="font19">Loaded plugins: fastestmirror</span></p>
<p><span class="font19">Loading mirror speeds from cached hostfile</span></p>
<p><span class="font19">... (output truncated)</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4971"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4972"></a>3.1.2. selecting interface</span></h3></li></ul>
<p><span class="font25">When you start </span><span class="font25" style="font-weight:bold;">wireshark </span><span class="font25">for the first time, you will need to select an interface. You will see a dialog box that looks similar to this one.</span></p><img src="linux_guide_files/The Complete Linux Guide-97.jpg" alt="" style="width:341pt;height:171pt;">
<p><span class="font25">It is possible that there are no interfaces available because some distributions only allow root to sniff the network. You may need to use </span><span class="font25" style="font-weight:bold;">sudo wireshark</span><span class="font25">.</span></p>
<p><span class="font25">Or you can follow the general advice to sniff using </span><span class="font25" style="font-weight:bold;">tcpdump </span><span class="font25">or any other tool, and save the capture to a file. Any saved capture can be analyzed using </span><span class="font25" style="font-weight:bold;">wireshark </span><span class="font25">at a later time.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4973"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4974"></a>3.1.3. minimize traffic</span></h3></li></ul>
<p><span class="font25">Sniffing a network can generate many thousands of packets in a very short time. This can be overwhelming. Try to mitigate by isolating your sniffer on the network. Preferably sniff an isolated virtual network interface over which you control all traffic.</span></p>
<p><span class="font25">If you are at home to learn sniffing, then it could help to close all network programs on your computer, and disconnect other computers and devices like smartphones and tablets to minimize the traffic.</span></p>
<p><span class="font25">Even more important than this is the use of </span><span class="font25" style="font-weight:bold;">filters </span><span class="font25">which will be discussed in this chapter.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4975"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4976"></a>3.1.4. sniffing ping</span></h3></li></ul>
<p><span class="font25">I started the sniffer and captured all packets while doing these three </span><span class="font25" style="font-weight:bold;">ping </span><span class="font25">commands (there is no need for root to do this):</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">ping -c2 nsl.paul.local</span></p>
<p><span class="font19">PING nsl.paul.local (10.104.33.30) 56(84) bytes of data.</span></p>
<p><span class="font19">64 bytes from 10.104.33.30: icmp_req=1 ttl=64 time=0.010 ms</span></p>
<p><span class="font19">64 bytes from 10.104.33.30: icmp_req=2 ttl=64 time=0.023 ms</span></p>
<p><span class="font19">--- ns1.paul.local ping statistics ---</span></p>
<p><span class="font19">2 packets transmitted, 2 received, 0% packet loss, time 1001ms</span></p>
<p><span class="font19">rtt min/avg/max/mdev = 0.010/0.016/0.023/0.007 ms</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">ping -c3 linux-training.be</span></p>
<p><span class="font19">PING linux-training.be (188.93.155.87) 56(84) bytes of data.</span></p>
<p><a href="#bookmark4977"><span class="font19">64 bytes from antares.ginsys.net (188.93.155.87): icmp_req=1 ttl=56 time=15.6</span></a></p>
<p><a href="#bookmark4978"><span class="font19">64 bytes from antares.ginsys.net (188.93.155.87): icmp_req=2 ttl=56 time=17.8</span></a></p>
<p><a href="#bookmark4979"><span class="font19">64 bytes from antares.ginsys.net (188.93.155.87): icmp_req=3 ttl=56 time=14.7</span></a></p>
<p><span class="font19">--- linux-training.be ping statistics ---</span></p>
<p><span class="font19">3 packets transmitted, 3 received, 0% packet loss, time 2003ms</span></p>
<p><span class="font19">rtt min/avg/max/mdev = 14.756/16.110/17.881/1.309 ms</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">ping -cl centos7.paul.local</span></p>
<p><span class="font19">PING centos7.paul.local (10.104.33.31) 56(84) bytes of data.</span></p>
<p><span class="font19">64 bytes from 10.104.33.31: icmp_req=1 ttl=64 time=0.590 ms</span></p>
<p><span class="font19">--- centos7.paul.local ping statistics ---</span></p>
<p><span class="font19">1 packets transmitted, 1 received, 0% packet loss, time 0ms</span></p>
<p><span class="font19">rtt min/avg/max/mdev = 0.590/0.590/0.590/0.000 ms</span></p>
<p><span class="font25">In total more than 200 packets were sniffed from the network. Things become clearer when you enter </span><span class="font25" style="font-weight:bold;">icmp </span><span class="font25">in the filter field and press the </span><span class="font25" style="font-weight:bold;">apply </span><span class="font25">button.</span></p>
<table border="1">
<tr><td colspan="4" style="vertical-align:bottom;">
<p><span class="font2">Alter: | icmp</span></p></td><td colspan="4" rowspan="2" style="vertical-align:middle;">
<p><span class="font2">▼ Expression... Clear Apply</span></p></td><td rowspan="2" style="vertical-align:middle;">
<p><span class="font2">Save</span></p></td></tr>
<tr><td colspan="4" style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font2">No.</span></p></td><td style="vertical-align:top;">
<p><span class="font2">Source</span></p></td><td style="vertical-align:top;">
<p><span class="font2">Destination</span></p></td><td style="vertical-align:top;">
<p><span class="font2">Protocol</span></p></td><td style="vertical-align:top;">
<p><span class="font2">Info</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font2">31</span></p></td><td style="vertical-align:top;">
<p><span class="font2">10.104.33.30</span></p></td><td style="vertical-align:top;">
<p><span class="font2">10.104.33.30</span></p></td><td style="vertical-align:top;">
<p><span class="font2">ICMP</span></p></td><td style="vertical-align:top;">
<p><span class="font2">Echo</span></p></td><td style="vertical-align:top;">
<p><span class="font2">(ping)</span></p></td><td style="vertical-align:top;">
<p><span class="font2">request</span></p></td><td style="vertical-align:top;">
<p><span class="font2">id=0x09f6,</span></p></td><td style="vertical-align:top;">
<p><span class="font2">seq=l/l</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font2">32</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">10.104.33.30</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">10.104.33.30</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">ICMP</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">Echo</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">(ping)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">reply</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">id=0x09f6.</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">seq=l/I</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font2">47</span></p></td><td style="vertical-align:top;">
<p><span class="font2">10.104.33.30</span></p></td><td style="vertical-align:top;">
<p><span class="font2">10.104.33.30</span></p></td><td style="vertical-align:top;">
<p><span class="font2">ICMP</span></p></td><td style="vertical-align:top;">
<p><span class="font2">Echo</span></p></td><td style="vertical-align:top;">
<p><span class="font2">(ping)</span></p></td><td style="vertical-align:top;">
<p><span class="font2">request</span></p></td><td style="vertical-align:top;">
<p><span class="font2">id=0x09f6,</span></p></td><td style="vertical-align:top;">
<p><span class="font2">seq=2/!</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font2">48</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">10.104.33.30</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">10.104.33.30</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">ICMP</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">Echo</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">(ping)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">reply</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">id=0x09f6,</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">seq=2/!</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font2">103</span></p></td><td style="vertical-align:top;">
<p><span class="font2">192.168.1.103</span></p></td><td style="vertical-align:top;">
<p><span class="font2">188.93.155.87</span></p></td><td style="vertical-align:top;">
<p><span class="font2">ICMP</span></p></td><td style="vertical-align:top;">
<p><span class="font2">Echo</span></p></td><td style="vertical-align:top;">
<p><span class="font2">(ping)</span></p></td><td style="vertical-align:top;">
<p><span class="font2">request</span></p></td><td style="vertical-align:top;">
<p><span class="font2">id=0x09f7,</span></p></td><td style="vertical-align:top;">
<p><span class="font2">seq=l/;</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font2">104</span></p></td><td style="vertical-align:top;">
<p><span class="font2">188.93.155.87</span></p></td><td style="vertical-align:top;">
<p><span class="font2">192.168.1.103</span></p></td><td style="vertical-align:top;">
<p><span class="font2">ICMP</span></p></td><td style="vertical-align:top;">
<p><span class="font2">Echo</span></p></td><td style="vertical-align:top;">
<p><span class="font2">(ping)</span></p></td><td style="vertical-align:top;">
<p><span class="font2">reply</span></p></td><td style="vertical-align:top;">
<p><span class="font2">id=0x09f7.</span></p></td><td style="vertical-align:top;">
<p><span class="font2">seq=l/I</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font2">115</span></p></td><td style="vertical-align:top;">
<p><span class="font2">192.168.1.103</span></p></td><td style="vertical-align:top;">
<p><span class="font2">188.93.155.87</span></p></td><td style="vertical-align:top;">
<p><span class="font2">ICMP</span></p></td><td style="vertical-align:top;">
<p><span class="font2">Echo</span></p></td><td style="vertical-align:top;">
<p><span class="font2">(ping)</span></p></td><td style="vertical-align:top;">
<p><span class="font2">request</span></p></td><td style="vertical-align:top;">
<p><span class="font2">id=0x09f7,</span></p></td><td style="vertical-align:top;">
<p><span class="font2">seq=2/!</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font2">116</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">188.93.155.87</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">192.168.1.103</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">ICMP</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">Echo</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">(ping)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">reply</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">id=0x09f7,</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">seq=2/!</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font2">123</span></p></td><td style="vertical-align:top;">
<p><span class="font2">192.168.1.103</span></p></td><td style="vertical-align:top;">
<p><span class="font2">188.93.155.87</span></p></td><td style="vertical-align:top;">
<p><span class="font2">ICMP</span></p></td><td style="vertical-align:top;">
<p><span class="font2">Echo</span></p></td><td style="vertical-align:top;">
<p><span class="font2">(ping)</span></p></td><td style="vertical-align:top;">
<p><span class="font2">request</span></p></td><td style="vertical-align:top;">
<p><span class="font2">id=0x09f7,</span></p></td><td style="vertical-align:top;">
<p><span class="font2">seq=3/(</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font2">124</span></p></td><td style="vertical-align:top;">
<p><span class="font2">188.93.155.87</span></p></td><td style="vertical-align:top;">
<p><span class="font2">192.168.1.103</span></p></td><td style="vertical-align:top;">
<p><span class="font2">ICMP</span></p></td><td style="vertical-align:top;">
<p><span class="font2">Echo</span></p></td><td style="vertical-align:top;">
<p><span class="font2">(ping)</span></p></td><td style="vertical-align:top;">
<p><span class="font2">reply</span></p></td><td style="vertical-align:top;">
<p><span class="font2">id=0x09f7.</span></p></td><td style="vertical-align:top;">
<p><span class="font2">seq=3/‘</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font2">170</span></p></td><td style="vertical-align:top;">
<p><span class="font2">10.104.33.30</span></p></td><td style="vertical-align:top;">
<p><span class="font2">10.104.33.31</span></p></td><td style="vertical-align:top;">
<p><span class="font2">ICMP</span></p></td><td style="vertical-align:top;">
<p><span class="font2">Echo</span></p></td><td style="vertical-align:top;">
<p><span class="font2">(ping)</span></p></td><td style="vertical-align:top;">
<p><span class="font2">request</span></p></td><td style="vertical-align:top;">
<p><span class="font2">id=0x09f8,</span></p></td><td style="vertical-align:top;">
<p><span class="font2">seq=l/:</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font2">171</span></p></td><td style="vertical-align:top;">
<p><span class="font2">10.104.33.31</span></p></td><td style="vertical-align:top;">
<p><span class="font2">10.104.33.30</span></p></td><td style="vertical-align:top;">
<p><span class="font2">ICMP</span></p></td><td style="vertical-align:top;">
<p><span class="font2">Echo</span></p></td><td style="vertical-align:top;">
<p><span class="font2">(ping)</span></p></td><td style="vertical-align:top;">
<p><span class="font2">reply</span></p></td><td style="vertical-align:top;">
<p><span class="font2">id=0x09f8,</span></p></td><td style="vertical-align:top;">
<p><span class="font2">seq=l/I</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4980"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4981"></a>3.1.5. sniffing ping and dns</span></h3></li></ul>
<p><span class="font25">Using the same capture as before, but now with a different </span><span class="font25" style="font-weight:bold;">filter</span><span class="font25">. We want to see both </span><span class="font25" style="font-weight:bold;">dns </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">icmp </span><span class="font25">traffic, so we enter both in the filter field.</span></p>
<p><span class="font25">We put </span><span class="font25" style="font-weight:bold;">dns or icmp </span><span class="font25">in the filter to achieve this. Putting </span><span class="font25" style="font-weight:bold;">dns and icmp </span><span class="font25">would render nothing because there is no packet that matches both protocols.</span></p><img src="linux_guide_files/The Complete Linux Guide-98.jpg" alt="" style="width:351pt;height:18pt;">
<p><span class="font2">No. Source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Destination &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Protocol Info</span></p>
<p><span class="font2">25 19.104.33.30 &nbsp;&nbsp;&nbsp;&nbsp;10.104.33.30 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DNS &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Standard query 0xa668 A nsl.paul.local</span></p>
<p><span class="font2">26 10.104.33.30 &nbsp;&nbsp;&nbsp;&nbsp;10.104.33.30 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DNS &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Standard query response 0xa668 &nbsp;A 10.10</span></p>
<p><span class="font2">31 10.104.33.30 &nbsp;&nbsp;&nbsp;&nbsp;10.104.33.30 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ICMP &nbsp;&nbsp;&nbsp;&nbsp;Echo (ping) request id=0x09f6, seq&gt;l/2!</span></p>
<p><span class="font2">32 10.104.33.30 &nbsp;&nbsp;&nbsp;&nbsp;10.104.33.30 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ICMP &nbsp;&nbsp;&nbsp;&nbsp;Echo (ping) reply id=0x09f6, seq«l/2!</span></p>
<p><span class="font25">In the screenshot above you can see that packets 25 and 26 both have 10.104.33.30 as </span><span class="font25" style="font-weight:bold;">source </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">destination </span><span class="font25">ip address. That is because the dns client is the same computer as the dns server.</span></p>
<p><span class="font25">The same is true for packets 31 and 32, since the machine is actually pinging itself.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4982"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4983"></a>3.1.6. specific ip address</span></h3></li></ul>
<p><span class="font25">This is a screenshot that filters for </span><span class="font25" style="font-weight:bold;">dns </span><span class="font25">packets that contain a certain </span><span class="font25" style="font-weight:bold;">ip address</span><span class="font25">. The filter in use is </span><span class="font25" style="font-weight:bold;">ip.addr==10.104.33.30 and dns</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">and </span><span class="font25">directive forces each displayed packet to match both conditions.</span></p><img src="linux_guide_files/The Complete Linux Guide-99.jpg" alt="" style="width:368pt;height:44pt;">
<p><span class="font25">Packet 93 is the </span><span class="font25" style="font-weight:bold;">dns query </span><span class="font25">for the A record of linux-training.be. Packet 98 is the response from the </span><span class="font25" style="font-weight:bold;">dns server</span><span class="font25">. What do you think happened in the packets between 93 and 98 ? Try to answer this before reading on (it always helps to try to predict what you will see, and then checking your prediction).</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4984"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4985"></a>3.1.7. filtering by frame</span></h3></li></ul>
<p><span class="font25">The correct technical term for a </span><span class="font25" style="font-weight:bold;">packet </span><span class="font25">as sniffed is a </span><span class="font25" style="font-weight:bold;">frame </span><span class="font25">(because we sniff on layer two). So to display packets with certain numbers, we use </span><span class="font25" style="font-weight:bold;">frame.number </span><span class="font25">in the filter.</span></p><img src="linux_guide_files/The Complete Linux Guide-100.jpg" alt="" style="width:368pt;height:78pt;">
<ul style="list-style:none;"><li>
<h3><a name="bookmark4986"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4987"></a>3.1.8. looking inside packets</span></h3></li></ul>
<h4><a name="bookmark4988"></a><span class="font25"><a name="bookmark4989"></a>The middle pane can be expanded. When selecting a line in this pane, you can see the corresponding bytes in the frame in the bottom panel.</span></h4>
<h4><a name="bookmark4990"></a><span class="font25"><a name="bookmark4991"></a>This screenshot shows the middle pane with the source address of my laptop selected.</span></h4>
<div><img src="linux_guide_files/The Complete Linux Guide-101.jpg" alt="" style="width:369pt;height:112pt;">
</div><br clear="all">
<h4><a name="bookmark4992"></a><span class="font25"><a name="bookmark4993"></a>Note that the above works fine when sniffing one interface. When sniffing with for example </span><span class="font25" style="font-weight:bold;">tcpdump -i any </span><span class="font25">you will end up with </span><span class="font25" style="font-weight:bold;">Linux cooked </span><span class="font25">at this level.</span></h4>
<p><span class="font2">| ► | Frame 25: 76 bytes on wire (608 bits), 76 bytes captured (608 bits) |^|Linux cooked capture</span></p>
<p><span class="font2">Packet type: Unicast to us (0)</span></p>
<p><span class="font2">Link-layer address type: 772</span></p>
<p><span class="font2">Link-layer address length: 6</span></p>
<p><span class="font2">Source: 00:06:00 00:00:00 (00:00:00:00:00:00)</span></p>
<p><span class="font2">Protocol: IP (0x0800)</span></p>
<p><span class="font2">[►J Internet Protocol Version 4, Src: 10.104.33.30 (10.104.33.30), Dst: 10.104.33.30 (10.104.33.30)</span></p>
<p><span class="font2">0000 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;04 00 06 00 06 60 60 60 00 00 00 08 00 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..............</span></p>
<p><span class="font2">0010 &nbsp;45 00 00 3c 38 d6 40 00 &nbsp;40 11 aa cf 0a 68 21 le &nbsp;&nbsp;E..&lt;8.@. @....h!.</span></p>
<p><span class="font2">0020 &nbsp;0a 68 21 le 82 bd 00 35 &nbsp;60 28 57 45 a6 68 01 00 &nbsp;&nbsp;&nbsp;.h!....5 .(WE.h..</span></p>
<p><span class="font2">0030 &nbsp;00 01 00 00 00 00 00 06 &nbsp;03 6e 73 31 04 70 61 75 &nbsp;&nbsp;.........nsl.pau</span></p>
<p><span class="font2">0040 6c 05 6c 6f 63 61 6c 00 00 01 00 01 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I.local.....</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4994"></a><span class="font9" style="font-weight:bold;"><a name="bookmark4995"></a>3.1.9. other filter examples</span></h3></li></ul>
<h4><a name="bookmark4996"></a><span class="font25"><a name="bookmark4997"></a><a name="bookmark4998"></a><a name="bookmark4999"></a>You can combine two protocols with a logical </span><span class="font25" style="font-weight:bold;">or </span><span class="font25">between them. The example below shows how to filter only </span><span class="font25" style="font-weight:bold;">arp </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">bootp </span><span class="font25">(or </span><span class="font25" style="font-weight:bold;">dhcp</span><span class="font25">) packets.</span></h4>
<div><img src="linux_guide_files/The Complete Linux Guide-102.jpg" alt="" style="width:408pt;height:20pt;">
</div><br clear="all">
<h4><a name="bookmark5000"></a><span class="font25"><a name="bookmark5001"></a><a name="bookmark5002"></a>This example shows how to filter for </span><span class="font25" style="font-weight:bold;">dns </span><span class="font25">traffic containing a certain </span><span class="font25" style="font-weight:bold;">ip address</span><span class="font25">.</span></h4>
<div><img src="linux_guide_files/The Complete Linux Guide-103.jpg" alt="" style="width:408pt;height:20pt;">
</div><br clear="all">
<ul style="list-style:none;"><li>
<h2><a name="bookmark5003"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4437"></a><a name="bookmark5004"></a>3.2. tcpdump</span></h2></li></ul>
<h4><a name="bookmark5005"></a><span class="font25"><a name="bookmark5006"></a><a name="bookmark5007"></a>Sniffing on the command line can be done with </span><span class="font25" style="font-weight:bold;">tcpdump</span><span class="font25">. Here are some examples.</span></h4>
<h4><a name="bookmark5008"></a><span class="font25"><a name="bookmark5009"></a>Using the </span><span class="font25" style="font-weight:bold;">tcpdump host $ip </span><span class="font25">command displays all traffic with one host (192.168.1.38 in this example).</span></h4>
<p><span class="font19">root@ubuntu910:~# tcpdump host 192.168.1.38</span></p>
<p><span class="font19">tcpdump: verbose output suppressed, use -v or -vv for full protocol decode listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes</span></p>
<h4><a name="bookmark5010"></a><span class="font25"><a name="bookmark5011"></a>Capturing only ssh (tcp port 22) traffic can be done with </span><span class="font25" style="font-weight:bold;">tcpdump tcp port $port</span><span class="font25">. This screenshot is cropped to 76 characters for readability in the pdf.</span></h4>
<p><span class="font19">root@deb503:~# tcpdump tcp port 22</span></p>
<p><span class="font19">tcpdump: verbose output suppressed, use -v or -vv for full protocol decode listening on eth1, link-type EN10MB (Ethernet), capture size 96 bytes 14:22:20.716313 IP deb503.local.37973 &gt;&nbsp;rhel53.local.ssh: P 666050963:66605 14:22:20.719936 IP rhel53.local.ssh &gt;&nbsp;deb503.local.37973: P 1:49(48) ack 48 14:22:20.720922 IP rhel53.local.ssh &gt;&nbsp;deb503.local.37973: P 49:113(64) ack 14:22:20.721321 IP rhel53.local.ssh &gt;&nbsp;deb503.local.37973: P 113:161(48) ack</span></p>
<p><span class="font19">14:22:20.721820 IP deb503.local.37973 &gt;&nbsp;rhel53.local.ssh: . ack 161 win 200</span></p>
<p><span class="font19">14:22:20.722492 IP rhel53.local.ssh &gt;&nbsp;deb503.local.37973: P 161:225(64) ack</span></p>
<p><span class="font19">14:22:20.760602 IP deb503.local.37973 &gt;&nbsp;rhel53.local.ssh: . ack 225 win 200</span></p>
<p><span class="font19">14:22:23.108106 IP deb503.local.54424 &gt;&nbsp;ubuntu910.local.ssh: P 467252637:46 14:22:23.116804 IP ubuntu910.local.ssh &gt;&nbsp;deb503.local.54424: P 1:81(80) ack 14:22:23.116844 IP deb503.local.54424 &gt;&nbsp;ubuntu910.local.ssh: . ack 81 win 2 </span><span class="font3"><sup>A</sup></span><span class="font19">C</span></p>
<p><span class="font19">10 packets captured</span></p>
<p><span class="font19">10 packets received by filter 0 packets dropped by kernel</span></p>
<h4><a name="bookmark5012"></a><span class="font25"><a name="bookmark5013"></a>Same as above, but write the output to a file with the </span><span class="font25" style="font-weight:bold;">tcpdump -w $filename </span><span class="font25">command.</span></h4>
<p><span class="font19">root@ubuntu910:~# tcpdump -w sshdump.tcpdump tcp port 22</span></p>
<p><span class="font19">tcpdump: listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes </span><span class="font3"><sup>A</sup></span><span class="font19">C</span></p>
<p><span class="font19">17 packets captured</span></p>
<p><span class="font19">17 packets received by filter</span></p>
<p><span class="font19">0 packets dropped by kernel</span></p>
<h4><a name="bookmark5014"></a><span class="font25"><a name="bookmark5015"></a><a name="bookmark5016"></a>With </span><span class="font25" style="font-weight:bold;">tcpdump -r $filename </span><span class="font25">the file created above can be displayed.</span></h4>
<p><span class="font19">root@ubuntu910:~# tcpdump -r sshdump.tcpdump</span></p>
<h4><a name="bookmark5017"></a><span class="font25"><a name="bookmark5018"></a>Many more examples can be found in the manual page of </span><span class="font25" style="font-weight:bold;">tcpdump</span><span class="font25">.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5019"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4438"></a><a name="bookmark5020"></a>3.3. practice: network sniffing</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Install wireshark on your computer (not inside a virtual machine).</span></p></li>
<li>
<p><span class="font25">2. Start a ping between your computer and another computer.</span></p></li>
<li>
<p><span class="font25">3. Start sniffing the network.</span></p></li>
<li>
<p><span class="font25">4. Display only the ping echo's in the top pane using a filter.</span></p></li>
<li>
<p><span class="font25">5. Now ping to a name (like </span><a href="http://www.linux-training.be"><span class="font25">www.linux-training.be</span></a><span class="font25">) and try to sniff the DNS query and response. Which DNS server was used ? Was it a tcp or udp query and response ?</span></p></li>
<li>
<p><span class="font25">6. Find an amateur/hobby/club website that features a login prompt. Attempt to login with user 'paul' and password 'hunter2' while your sniffer is running. Now find this information in the sniffer.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5021"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4439"></a><a name="bookmark5022"></a>3.4. solution: network sniffing</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5023"></a><span class="font25"><a name="bookmark5024"></a>1. Install wireshark on your computer (not inside a virtual machine).</span></h4></li></ul>
<p><span class="font19">Debian/Ubuntu: aptitude install wireshark</span></p>
<p><span class="font19">Red Hat/Mandriva/Fedora: yum install wireshark</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5025"></a><span class="font25"><a name="bookmark5026"></a>2. Start a ping between your computer and another computer.</span></h4></li></ul>
<p><span class="font19">ping $ip_address</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5027"></a><span class="font25"><a name="bookmark5028"></a>3. Start sniffing the network.</span></h4></li></ul>
<p><span class="font19">(sudo) wireshark</span></p>
<p><span class="font19">select an interface (probably eth0)</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5029"></a><span class="font25"><a name="bookmark5030"></a>4. Display only the ping echo's in the top pane using a filter.</span></h4></li></ul>
<p><span class="font19">type 'icmp' (without quotes) in the filter box, and then click 'apply'</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5031"></a><span class="font25"><a name="bookmark5032"></a>5. Now ping to a name (like </span><a href="http://www.linux-training.be"><span class="font25">www.linux-training.be</span></a><span class="font25">) and try to sniff the DNS query and response. Which DNS server was used ? Was it a tcp or udp query and response ?</span></h4></li></ul>
<p><span class="font19">First start the sniffer.</span></p>
<p><span class="font19">Enter 'dns' in the filter box and click apply.</span></p>
<p><span class="font19">root@ubuntu910:~# ping </span><a href="http://www.linux-training.be"><span class="font19">www.linux-training.be</span></a></p>
<p><span class="font19">PING </span><a href="http://www.linux-training.be"><span class="font19">www.linux-training.be</span></a><span class="font19"> (88.151.243.8) 56(84) bytes of data.</span></p>
<p><span class="font19">64 bytes from fosfor.openminds.be (88.151.243.8): icmp_seq=1 ttl=58 time=14.9 ms</span></p>
<p><span class="font19">64 bytes from fosfor.openminds.be (88.151.243.8): icmp_seq=2 ttl=58 time=16.0 ms </span><span class="font3"><sup>A</sup></span><span class="font19">C</span></p>
<p><span class="font19">--- </span><a href="http://www.linux-training.be"><span class="font19">www.linux-training.be</span></a><span class="font19"> ping statistics ---</span></p>
<p><span class="font19">2 packets transmitted, 2 received, 0% packet loss, time 1002ms rtt min/avg/max/mdev = 14.984/15.539/16.095/0.569 ms</span></p>
<h4><a name="bookmark5033"></a><span class="font25"><a name="bookmark5034"></a>The wireshark screen should look something like this.</span></h4><img src="linux_guide_files/The Complete Linux Guide-104.jpg" alt="" style="width:400pt;height:87pt;">
<h4><a name="bookmark5035"></a><span class="font25"><a name="bookmark5036"></a>The details in wireshark will say the DNS query was inside a udp packet.</span></h4>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5037"></a><span class="font25"><a name="bookmark5038"></a>6. Find an amateur/hobby/club website that features a login prompt. Attempt to login with user 'paul' and password 'hunter2' while your sniffer is running. Now find this information in the sniffer.</span></h4></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark5039"></a><span class="font11" style="font-weight:bold;"><a name="bookmark4440"></a><a name="bookmark5040"></a>Chapter 4. binding and bonding</span></h1></li></ul>
<p><a name="bookmark5041"></a><span class="font25">Sometimes a server needs more than one </span><span class="font25" style="font-weight:bold;">ip address </span><span class="font25">on the same network card, we call this </span><span class="font25" style="font-weight:bold;">binding </span><span class="font25">ip addresses.</span></p>
<p><a name="bookmark5042"></a><span class="font25">Linux can also activate multiple network cards behind the same </span><span class="font25" style="font-weight:bold;">ip address</span><span class="font25">, this is called </span><span class="font25" style="font-weight:bold;">bonding</span><span class="font25">.</span></p>
<p><span class="font25">This chapter will teach you how to configure </span><span class="font25" style="font-weight:bold;">binding </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">bonding </span><span class="font25">on the most common Linux distributions.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5043"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4441"></a><a name="bookmark5044"></a>4.1. binding on Redhat/Fedora</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark5045"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5046"></a>4.1.1. binding extra ip addresses</span></h3></li></ul></li></ul>
<h4><a name="bookmark5047"></a><span class="font25"><a name="bookmark5048"></a><a name="bookmark5049"></a><a name="bookmark5050"></a>To bind more than one </span><span class="font25" style="font-weight:bold;">ip address </span><span class="font25">to the same interface, use </span><span class="font25" style="font-weight:bold;">ifcfg-eth0:0</span><span class="font25">, where the last zero can be anything else. Only two directives are required in the files.</span></h4>
<p><span class="font19">[root@rhel6 ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth0:0</span></p>
<p><span class="font19">DEVICE=&quot;eth0:0&quot;</span></p>
<p><span class="font19">IPADDR=&quot;192.168.1.133&quot;</span></p>
<p><span class="font19">[root@rhel6 ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth0:1</span></p>
<p><span class="font19">DEVICE=&quot;eth0:0&quot;</span></p>
<p><span class="font19">IPADDR=&quot;192.168.1.142&quot;</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5051"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5052"></a>4.1.2. enabling extra ip-addresses</span></h3></li></ul>
<h4><a name="bookmark5053"></a><span class="font25"><a name="bookmark5054"></a><a name="bookmark5055"></a><a name="bookmark5056"></a>To activate a virtual network interface, use </span><span class="font25" style="font-weight:bold;">ifup</span><span class="font25">, to deactivate it, use </span><span class="font25" style="font-weight:bold;">ifdown</span><span class="font25">.</span></h4>
<p><span class="font19">[root@rhel6 ~]# ifup eth0:0</span></p>
<p><span class="font19">[root@rhel6 ~]# ifconfig | grep 'inet '</span></p>
<p><span class="font19">inet addr:192.168.1.99 Bcast:192.168.1.255 Mask:255.255.255.0 inet addr:192.168.1.133 &nbsp;Bcast:192.168.1.255 Mask:255.255.255.0</span></p>
<p><span class="font19">inet addr:127.0.0.1 Mask:255.0.0.0 [root@rhel6 ~]# ifup eth0:1 [root@rhel6 ~]# ifconfig | grep 'inet '</span></p>
<p><span class="font19">inet addr:192.168.1.99 Bcast:192.168.1.255 Mask:255.255.255.0</span></p>
<p><span class="font19">inet addr:192.168.1.133 &nbsp;Bcast:192.168.1.255 Mask:255.255.255.0</span></p>
<p><span class="font19">inet addr:192.168.1.142 &nbsp;Bcast:192.168.1.255 Mask:255.255.255.0</span></p>
<p><span class="font19">inet addr:127.0.0.1 Mask:255.0.0.0</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5057"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5058"></a>4.1.3. verifying extra ip-addresses</span></h3></li></ul>
<h4><a name="bookmark5059"></a><span class="font25"><a name="bookmark5060"></a><a name="bookmark5061"></a>Use </span><span class="font25" style="font-weight:bold;">ping </span><span class="font25">from another computer to check the activation, or use </span><span class="font25" style="font-weight:bold;">ifconfig </span><span class="font25">like in this screenshot.</span></h4>
<p><span class="font19">[root@rhel6 ~]# ifconfig</span></p>
<p><span class="font19">eth0 Link encap:Ethernet HWaddr 08:00:27:DD:0D:5C</span></p>
<p><span class="font19">inet addr:192.168.1.99 Bcast:192.168.1.255 Mask:255.255.255.0 inet6 addr: fe80::a00:27ff:fedd:d5c/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:1259 errors:0 dropped:0 overruns:0 frame:0 TX packets:545 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:115260 (112.5 KiB) TX bytes:84293 (82.3 KiB)</span></p>
<p><span class="font19">eth0:0 Link encap:Ethernet HWaddr 08:00:27:DD:0D:5C inet addr:192.168.1.133 &nbsp;Bcast:192.168.1.255 Mask:255.255.255.0</span></p>
<p><span class="font19">UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1</span></p>
<p><span class="font19">eth0:1 Link encap:Ethernet HWaddr 08:00:27:DD:0D:5C inet addr:192.168.1.142 &nbsp;Bcast:192.168.1.255 &nbsp;Mask:255.255.255.0</span></p>
<p><span class="font19">UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5062"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4442"></a><a name="bookmark5063"></a>4.2. binding on Debian/Ubuntu</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark5064"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5065"></a>4.2.1. binding extra ip addresses</span></h3></li></ul></li></ul>
<h4><a name="bookmark5066"></a><span class="font25"><a name="bookmark5067"></a>The confi<a name="bookmark5068"></a>guration of multiple ip addresses on the same network card is done in </span><span class="font25" style="font-weight:bold;">/etc/network/ interfaces </span><span class="font25">by adding </span><span class="font25" style="font-weight:bold;">eth0:x </span><span class="font25">devices. Adding the </span><span class="font25" style="font-weight:bold;">netmask </span><span class="font25">is mandatory.</span></h4>
<p><span class="font19">debian5:~# cat /etc/network/interfaces</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># This file describes the network interfaces available on your system # and how to activate them. For more information, see interfaces(5).</span></p></li>
<li>
<p><span class="font19"># The loopback network interface auto lo iface lo inet loopback</span></p></li>
<li>
<p><span class="font19"># The primary network interface iface eth0 inet static address 192.168.1.34 network 192.168.1.0 netmask 255.255.255.0 gateway 192.168.1.1 auto eth0 auto eth0:0 iface eth0:0 inet static address 192.168.1.233 netmask 255.255.255.0</span></p></li></ul>
<p><span class="font19">auto eth0:1</span></p>
<p><span class="font19">iface eth0:1 inet static</span></p>
<p><span class="font19">address 192.168.1.242</span></p>
<p><span class="font19">netmask 255.255.255.0</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5069"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5070"></a>4.2.2. enabling extra ip-addresses</span></h3></li></ul>
<h4><a name="bookmark5071"></a><span class="font25"><a name="bookmark5072"></a><a name="bookmark5073"></a>Use </span><span class="font25" style="font-weight:bold;">ifup </span><span class="font25">to enable the extra addresses.</span></h4>
<p><span class="font19">debian5:~# ifup eth0:0</span></p>
<p><span class="font19">debian5:~# ifup eth0:1</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5074"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5075"></a>4.2.3. verifying extra ip-addresses</span></h3></li></ul>
<h4><a name="bookmark5076"></a><span class="font25"><a name="bookmark5077"></a><a name="bookmark5078"></a>Use </span><span class="font25" style="font-weight:bold;">ping </span><span class="font25">from another computer to check the activation, or use </span><span class="font25" style="font-weight:bold;">ifconfig </span><span class="font25">like in this screenshot.</span></h4>
<p><span class="font19">debian5:~# ifconfig | grep 'inet '</span></p>
<p><span class="font19">inet addr:192.168.1.34 Bcast:192.168.1.255 Mask:255.255.255.0</span></p>
<p><span class="font19">inet addr:192.168.1.233 &nbsp;Bcast:192.168.1.255 Mask:255.255.255.0</span></p>
<p><span class="font19">inet addr:192.168.1.242 &nbsp;Bcast:192.168.1.255 Mask:255.255.255.0</span></p>
<p><span class="font19">inet addr:127.0.0.1 Mask:255.0.0.0</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5079"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4443"></a><a name="bookmark5080"></a>4.3. bonding on Redhat/Fedora</span></h2></li></ul>
<h4><a name="bookmark5081"></a><span class="font25"><a name="bookmark5082"></a><a name="bookmark5083"></a>We start with </span><span class="font25" style="font-weight:bold;">ifconfig -a </span><span class="font25">to get a list of all the network cards on our system.</span></h4>
<p><span class="font19">[root@rhel6 network-scripts]# ifconfig -a | grep Ethernet</span></p>
<p><span class="font19">eth0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Link encap:Ethernet &nbsp;HWaddr 08:00:27:DD:0D:5C</span></p>
<p><span class="font19">ethl &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Link encap:Ethernet &nbsp;HWaddr 08:00:27:DA:C1:49</span></p>
<p><span class="font19">eth2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Link encap:Ethernet &nbsp;HWaddr 08:00:27:40:03:3B</span></p>
<h4><a name="bookmark5084"></a><span class="font25"><a name="bookmark5085"></a>In this demo we decide to bond </span><span class="font25" style="font-weight:bold;">eth1 </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">eth2</span><span class="font25">.</span></h4>
<h4><a name="bookmark5086"></a><span class="font25"><a name="bookmark5087"></a>We will name our bond </span><span class="font25" style="font-weight:bold;">bond0 </span><span class="font25">and add this entry to </span><span class="font25" style="font-weight:bold;">modprobe </span><span class="font25">so the kernel can load the </span><span class="font25" style="font-weight:bold;">bonding module </span><span class="font25">when we bring the interface up.</span></h4>
<p><span class="font19">[root@rhel6 network-scripts]# cat /etc/modprobe.d/bonding.conf alias bond0 bonding</span></p>
<p><a name="bookmark5088"></a><span class="font25">Then we create </span><span class="font25" style="font-weight:bold;">/etc/sysconfig/network-scripts/ifcfg-bond0 </span><span class="font25">to configure our </span><span class="font25" style="font-weight:bold;">bond0 </span><span class="font25">interface.</span></p>
<p><span class="font19">[root@rhel6 network-scripts]# pwd</span></p>
<p><span class="font19">/etc/sysconfig/network-scripts</span></p>
<p><span class="font19">[root@rhel6 network-scripts]# cat ifcfg-bond0</span></p>
<p><span class="font19">DEVICE=bond0</span></p>
<p><span class="font19">IPADDR=192.168.1.199</span></p>
<p><span class="font19">NETMASK=255.255.255.0</span></p>
<p><span class="font19">ONBOOT=yes</span></p>
<p><span class="font19">BOOTPROTO=none</span></p>
<p><span class="font19">USERCTL=no</span></p>
<h4><a name="bookmark5089"></a><span class="font25"><a name="bookmark5090"></a>Next we create two files, one for each network card that we will use as slave in </span><span class="font25" style="font-weight:bold;">bond0</span><span class="font25">.</span></h4>
<p><span class="font19">[root@rhel6 network-scripts]# cat ifcfg-eth1</span></p>
<p><span class="font19">DEVICE=eth1</span></p>
<p><span class="font19">BOOTPROTO=none</span></p>
<p><span class="font19">ONBOOT=yes</span></p>
<p><span class="font19">MASTER=bond0</span></p>
<p><span class="font19">SLAVE=yes</span></p>
<p><span class="font19">USERCTL=no</span></p>
<p><span class="font19">[root@rhel6 network-scripts]# cat ifcfg-eth2</span></p>
<p><span class="font19">DEVICE=eth2</span></p>
<p><span class="font19">BOOTPROTO=none</span></p>
<p><span class="font19">ONBOOT=yes</span></p>
<p><span class="font19">MASTER=bond0</span></p>
<p><span class="font19">SLAVE=yes</span></p>
<p><span class="font19">USERCTL=no</span></p>
<h4><a name="bookmark5091"></a><span class="font25"><a name="bookmark5092"></a><a name="bookmark5093"></a>Finally we bring the interface up with </span><span class="font25" style="font-weight:bold;">ifup bond0</span><span class="font25">.</span></h4>
<p><span class="font19">[root@rhel6 network-scripts]# ifup bond0</span></p>
<p><span class="font19">[root@rhel6 network-scripts]# ifconfig bond0</span></p>
<p><span class="font19">bond0 Link encap:Ethernet HWaddr 08:00:27:DA:C1:49</span></p>
<p><span class="font19">inet addr:192.168.1.199 &nbsp;Bcast:192.168.1.255 Mask:255.255.255.0</span></p>
<p><span class="font19">inet6 addr: fe80::a00:27ff:feda:c149/64 Scope:Link UP BROADCAST RUNNING MASTER MULTICAST MTU:1500 Metric:1 RX packets:251 errors:0 dropped:0 overruns:0 frame:0 TX packets:21 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:39852 (38.9 KiB) TX bytes:1070 (1.0 KiB)</span></p>
<h4><a name="bookmark5094"></a><span class="font25"><a name="bookmark5095"></a><a name="bookmark5096"></a>The </span><span class="font25" style="font-weight:bold;">bond </span><span class="font25">should also be visible in </span><span class="font25" style="font-weight:bold;">/proc/net/bonding</span><span class="font25">.</span></h4>
<p><span class="font19">[root@rhel6 network-scripts]# cat /proc/net/bonding/bond0 Ethernet Channel Bonding Driver: v3.5.0 (November 4, 2008)</span></p>
<p><span class="font19">Bonding Mode: load balancing (round-robin)</span></p>
<p><span class="font19">MII Status: up</span></p>
<p><span class="font19">MII Polling Interval (ms): 0</span></p>
<p><span class="font19">Up Delay (ms): 0</span></p>
<p><span class="font19">Down Delay (ms): 0</span></p>
<p><span class="font19">Slave Interface: eth1</span></p>
<p><span class="font19">MII Status: up</span></p>
<p><span class="font19">Link Failure Count: 0</span></p>
<p><span class="font19">Permanent HW addr: 08:00:27:da:c1:49</span></p>
<p><span class="font19">Slave Interface: eth2</span></p>
<p><span class="font19">MII Status: up</span></p>
<p><span class="font19">Link Failure Count: 0</span></p>
<p><span class="font19">Permanent HW addr: 08:00:27:40:03:3b</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5097"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4444"></a><a name="bookmark5098"></a>4.4. bonding on Debian/Ubuntu</span></h2></li></ul>
<h4><a name="bookmark5099"></a><span class="font25"><a name="bookmark5100"></a><a name="bookmark5101"></a>We start with </span><span class="font25" style="font-weight:bold;">ifconfig -a </span><span class="font25">to get a list of all the network cards on our system.</span></h4>
<p><span class="font19">debian5:~# ifconfig -a | grep Ethernet</span></p>
<p><span class="font19">eth0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Link encap:Ethernet &nbsp;HWaddr 08:00:27:bb:18:a4</span></p>
<p><span class="font19">ethl &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Link encap:Ethernet &nbsp;HWaddr 08:00:27:63:9a:95</span></p>
<p><span class="font19">eth2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Link encap:Ethernet &nbsp;HWaddr 08:00:27:27:a4:92</span></p>
<h4><a name="bookmark5102"></a><span class="font25"><a name="bookmark5103"></a>In this demo we decide to bond </span><span class="font25" style="font-weight:bold;">eth1 </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">eth2</span><span class="font25">.</span><br><br><a name="bookmark5104"></a><span class="font25"><a name="bookmark5105"></a>We also need to install the </span><span class="font25" style="font-weight:bold;">ifenslave </span><span class="font25">package.</span></h4>
<p><span class="font19">debian5:~# aptitude search ifenslave</span></p>
<p><span class="font19">p ifenslave &nbsp;&nbsp;&nbsp;&nbsp;- Attach and detach slave interfaces to a bonding device</span></p>
<p><span class="font19">p ifenslave-2.6 - Attach and detach slave interfaces to a bonding device debian5:~# aptitude install ifenslave</span></p>
<p><span class="font19">Reading package lists... Done</span></p>
<h4><a name="bookmark5106"></a><span class="font25"><a name="bookmark5107"></a><a name="bookmark5108"></a>Next we update the </span><span class="font25" style="font-weight:bold;">/etc/network/interfaces </span><span class="font25">file with information about the </span><span class="font25" style="font-weight:bold;">bond0 </span><span class="font25">interface.</span></h4>
<p><span class="font19">debian5:~# tail -7 /etc/network/interfaces iface bond0 inet static</span></p>
<p><span class="font19">address 192.168.1.42</span></p>
<p><span class="font19">netmask 255.255.255.0</span></p>
<p><span class="font19">gateway 192.168.1.1 slaves eth1 eth2 bond-mode active-backup bond_primary eth1</span></p>
<h4><a name="bookmark5109"></a><span class="font25"><a name="bookmark5110"></a>On older version of Debian/Ubuntu you needed to </span><span class="font25" style="font-weight:bold;">modprobe bonding</span><span class="font25">, but this is no longer required. Use </span><span class="font25" style="font-weight:bold;">ifup </span><span class="font25">to bring the interface up, then test that it works.</span></h4>
<p><span class="font19">debian5:~# ifup bond0</span></p>
<p><span class="font19">debian5:~# ifconfig bond0</span></p>
<p><span class="font19">bond0 Link encap:Ethernet HWaddr 08:00:27:63:9a:95</span></p>
<p><span class="font19">inet addr:192.168.1.42 Bcast:192.168.1.255 Mask:255.255.255.0 inet6 addr: fe80::a00:27ff:fe63:9a95/64 Scope:Link UP BROADCAST RUNNING MASTER MULTICAST MTU:1500 Metric:1 RX packets:212 errors:0 dropped:0 overruns:0 frame:0 TX packets:39 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:31978 (31.2 KiB) TX bytes:6709 (6.5 KiB)</span></p>
<h4><a name="bookmark5111"></a><span class="font25"><a name="bookmark5112"></a><a name="bookmark5113"></a>The </span><span class="font25" style="font-weight:bold;">bond </span><span class="font25">should also be visible in </span><span class="font25" style="font-weight:bold;">/proc/net/bonding</span><span class="font25">.</span></h4>
<p><span class="font19">debian5:~# cat /proc/net/bonding/bond0</span></p>
<p><span class="font19">Ethernet Channel Bonding Driver: v3.2.5 (March 21, 2008)</span></p>
<p><span class="font19">Bonding Mode: fault-tolerance (active-backup)</span></p>
<p><span class="font19">Primary Slave: eth1</span></p>
<p><span class="font19">Currently Active Slave: eth1</span></p>
<p><span class="font19">MII Status: up</span></p>
<p><span class="font19">MII Polling Interval (ms): 0</span></p>
<p><span class="font19">Up Delay (ms): 0</span></p>
<p><span class="font19">Down Delay (ms): 0</span></p>
<p><span class="font19">Slave Interface: eth1 MII Status: up Link Failure Count: 0</span></p>
<p><span class="font19">Permanent HW addr: 08:00:27:63:9a:95</span></p>
<p><span class="font19">Slave Interface: eth2</span></p>
<p><span class="font19">MII Status: up</span></p>
<p><span class="font19">Link Failure Count: 0</span></p>
<p><span class="font19">Permanent HW addr: 08:00:27:27:a4:92</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5114"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4445"></a><a name="bookmark5115"></a>4.5. practice: binding and bonding</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Add an extra </span><span class="font25" style="font-weight:bold;">ip address </span><span class="font25">to one of your network cards. Test that it works (have your neighbour ssh to it)!</span></p></li>
<li>
<p><span class="font25">2. Use </span><span class="font25" style="font-weight:bold;">ifdown </span><span class="font25">to disable this extra </span><span class="font25" style="font-weight:bold;">ip address</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">3. Make sure your neighbour also succeeded in </span><span class="font25" style="font-weight:bold;">binding </span><span class="font25">an extra ip address before you continue.</span></p></li>
<li>
<p><span class="font25">4. Add an extra network card (or two) to your virtual machine and use the theory to </span><span class="font25" style="font-weight:bold;">bond </span><span class="font25">two network cards.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5116"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4446"></a><a name="bookmark5117"></a>4.6. solution: binding and bonding</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5118"></a><span class="font25"><a name="bookmark5119"></a>1. Add an extra </span><span class="font25" style="font-weight:bold;">ip address </span><span class="font25">to one of your network cards. Test that it works (have your neighbour ssh to it)!</span></h4></li></ul>
<p><span class="font19">Redhat/Fedora:</span></p>
<p><span class="font19">add an /etc/sysconfig/network-scripts/ifcfg-ethX:X file</span></p>
<p><span class="font19">as shown in the theory</span></p>
<p><span class="font19">Debian/Ubuntu:</span></p>
<p><span class="font19">expand the /etc/network/interfaces file as shown in the theory</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5120"></a><span class="font25"><a name="bookmark5121"></a>2. Use </span><span class="font25" style="font-weight:bold;">ifdown </span><span class="font25">to disable this extra </span><span class="font25" style="font-weight:bold;">ip address</span><span class="font25">.</span></h4></li></ul>
<p><span class="font19">ifdown eth0:0</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5122"></a><span class="font25"><a name="bookmark5123"></a>3. Make sure your neighbour also succeeded in </span><span class="font25" style="font-weight:bold;">binding </span><span class="font25">an extra ip address before you continue.</span></h4></li></ul>
<p><span class="font19">ping $extra_ip_neighbour or</span></p>
<p><span class="font19">ssh $extra_ip_neighbour</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5124"></a><span class="font25"><a name="bookmark5125"></a>4. Add an extra network card (or two) to your virtual machine and use the theory to </span><span class="font25" style="font-weight:bold;">bond </span><span class="font25">two network cards.</span></h4></li></ul>
<p><span class="font19">Redhat/Fedora:</span></p>
<p><span class="font19">add ifcfg-ethX and ifcfg-bondX files in /etc/sysconfig/network-scripts as shown in the theory and don't forget the modprobe.conf</span></p>
<p><span class="font19">Debian/Ubuntu:</span></p>
<p><span class="font19">expand the /etc/network/interfaces file</span></p>
<p><span class="font19">as shown in the theory</span></p>
<p><span class="font19">and don't forget to install the ifenslave package</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark5126"></a><span class="font11" style="font-weight:bold;"><a name="bookmark4447"></a><a name="bookmark5127"></a>Chapter 5. ssh client and server</span></h1></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">secure shell </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">ssh </span><span class="font25">is a collection of tools using a secure protocol for communications with remote Linux computers.</span></p>
<p><span class="font25">This chapter gives an overview of the most common commands related to the use of the </span><span class="font25" style="font-weight:bold;">sshd </span><span class="font25">server and the </span><span class="font25" style="font-weight:bold;">ssh </span><span class="font25">client.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5128"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4448"></a><a name="bookmark5129"></a>5.1. about ssh</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark5130"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5131"></a>5.1.1. secure shell</span></h3></li></ul></li></ul>
<p><a name="bookmark5132"></a><span class="font25"><a name="bookmark5133"></a><a name="bookmark5134"></a><a name="bookmark5135"></a><a name="bookmark5136"></a>Avoid using </span><span class="font25" style="font-weight:bold;">telnet</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">rlogin </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">rsh </span><span class="font25">to remotely connect to your servers. These older protocols do not encrypt the login session, which means your user id and password can be sniffed by tools like </span><span class="font25" style="font-weight:bold;">wireshark </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">tcpdump</span><span class="font25">. To securely connect to your servers, use </span><span class="font25" style="font-weight:bold;">ssh</span><span class="font25">.</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">ssh protocol </span><span class="font25">is secure in two ways. Firstly the connection is </span><span class="font25" style="font-weight:bold;">encrypted </span><span class="font25">and secondly the connection is </span><span class="font25" style="font-weight:bold;">authenticated </span><span class="font25">both ways.</span></p>
<p><span class="font25">An ssh connection always starts with a cryptographic handshake, followed by </span><span class="font25" style="font-weight:bold;">encryption </span><span class="font25">of the transport layer using a symmetric cypher. In other words, the tunnel is encrypted before you start typing anything.</span></p>
<p><span class="font25">Then </span><span class="font25" style="font-weight:bold;">authentication </span><span class="font25">takes place (using user id/password or public/private keys) and communication can begin over the encrypted connection.</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">ssh protocol </span><span class="font25">will remember the servers it connected to (and warn you in case something suspicious happened).</span></p>
<p><a name="bookmark5137"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">openssh </span><span class="font25">package is maintained by the </span><span class="font25" style="font-weight:bold;">OpenBSD </span><span class="font25">people and is distributed with a lot of operating systems (it may even be the most popular package in the world).</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5138"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5139"></a>5.1.2. /etc/ssh/</span></h3></li></ul>
<p><a name="bookmark5140"></a><span class="font25"><a name="bookmark5141"></a>Configuration of </span><span class="font25" style="font-weight:bold;">ssh </span><span class="font25">client and server is done in the </span><span class="font25" style="font-weight:bold;">/etc/ssh </span><span class="font25">directory. In the next sections we will discuss most of the files found in </span><span class="font25" style="font-weight:bold;">/etc/ssh/</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4727"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5142"></a>5.1.3. ssh protocol versions</span></h3></li></ul>
<p><a name="bookmark5143"></a><span class="font25"><a name="bookmark5144"></a>The </span><span class="font25" style="font-weight:bold;">ssh </span><span class="font25">protocol has two versions (1 and 2). Avoid using version 1 anywhere, since it contains some known vulnerabilities. You can control the protocol version via </span><span class="font25" style="font-weight:bold;">/etc/ssh/ ssh_config </span><span class="font25">for the client side and </span><span class="font25" style="font-weight:bold;">/etc/ssh/sshd_config </span><span class="font25">for the openssh-server daemon.</span></p>
<p><span class="font19">paul@ubu1204:/etc/ssh$ grep Protocol ssh_config</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Protocol 2,1</span></p></li></ul>
<p><span class="font19">paul@ubu1204:/etc/ssh$ grep Protocol sshd_config</span></p>
<p><span class="font19">Protocol 2</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5145"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5146"></a>5.1.4. public and private keys</span></h3></li></ul>
<p><a name="bookmark5147"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">ssh </span><span class="font25">protocol uses the well known system of </span><span class="font25" style="font-weight:bold;">public and private keys</span><span class="font25">. The below explanation is succinct, more information can be found on wikipedia.</span></p>
<p><a href="http://en.wikipedia.org/wiki/Public-key_cryptography"><span class="font19">http://en.wikipedia.org/wiki/Public-key_cryptography</span></a></p>
<p><a name="bookmark5148"></a><span class="font25">Imagine Alice and Bob, two people that like to communicate with each other. Using </span><span class="font25" style="font-weight:bold;">public and private keys </span><span class="font25">they can communicate with </span><span class="font25" style="font-weight:bold;">encryption </span><span class="font25">and with </span><span class="font25" style="font-weight:bold;">authentication</span><span class="font25">.</span></p>
<p><a name="bookmark5149"></a><span class="font25">When Alice wants to send an encrypted message to Bob, she uses the </span><span class="font25" style="font-weight:bold;">public key </span><span class="font25">of Bob. Bob shares his </span><span class="font25" style="font-weight:bold;">public key </span><span class="font25">with Alice, but keeps his </span><span class="font25" style="font-weight:bold;">private key </span><span class="font25">private! Since Bob is the only one to have Bob's </span><span class="font25" style="font-weight:bold;">private key</span><span class="font25">, Alice is sure that Bob is the only one that can read the encrypted message.</span></p>
<p><span class="font25">When Bob wants to verify that the message came from Alice, Bob uses the </span><span class="font25" style="font-weight:bold;">public key </span><span class="font25">of Alice to verify that Alice signed the message with her </span><span class="font25" style="font-weight:bold;">private key</span><span class="font25">. Since Alice is the only one to have Alice's </span><span class="font25" style="font-weight:bold;">private key</span><span class="font25">, Bob is sure the message came from Alice.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5150"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5151"></a>5.1.5. rsa and dsa algorithms</span></h3></li></ul>
<p><a name="bookmark5152"></a><span class="font25"><a name="bookmark5153"></a>This chapter does not explain the technical implementation of cryptographic algorithms, it only explains how to use the ssh tools with </span><span class="font25" style="font-weight:bold;">rsa </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">dsa</span><span class="font25">. More information about these algorithms can be found here:</span></p>
<p><a href="http://en.wikipedia.org/wiki/RSA_(algorithm"><span class="font19">http://en.wikipedia.org/wiki/RSA_(algorithm</span></a><span class="font19">)</span></p>
<p><a href="http://en.wikipedia.org/wiki/Digital_Signature_Algorithm"><span class="font19">http://en.wikipedia.org/wiki/Digital_Signature_Algorithm</span></a></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5154"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4449"></a><a name="bookmark5155"></a>5.2. log on to a remote server</span></h2></li></ul>
<p><span class="font25">The following screenshot shows how to use </span><span class="font25" style="font-weight:bold;">ssh </span><span class="font25">to log on to a remote computer running Linux. The local user is named </span><span class="font25" style="font-weight:bold;">paul </span><span class="font25">and he is logging on as user </span><span class="font25" style="font-weight:bold;">admin42 </span><span class="font25">on the remote system.</span></p>
<p><span class="font19">paul@ubu1204:~$ ssh </span><a href="mailto:admin42@192.168.1.30"><span class="font19">admin42@192.168.1.30</span></a></p>
<p><span class="font19">The authenticity of host '192.168.1.30 (192.168.1.30)' can't be established.</span></p>
<p><span class="font19">RSA key fingerprint is b5:fb:3c:53:50:b4:ab:81:f3:cd:2e:bb:ba:44:d3:75.</span></p>
<p><span class="font19">Are you sure you want to continue connecting (yes/no)?</span></p>
<p><span class="font25">As you can see, the user </span><span class="font25" style="font-weight:bold;">paul </span><span class="font25">is presented with an </span><span class="font25" style="font-weight:bold;">rsa </span><span class="font25">authentication fingerprint from the remote system. The user can accepts this bu typing </span><span class="font25" style="font-weight:bold;">yes</span><span class="font25">. We will see later that an entry will be added to the </span><span class="font25" style="font-weight:bold;">~/.ssh/known_hosts </span><span class="font25">file.</span></p>
<p><span class="font19">paul@ubu1204:~$ ssh </span><a href="mailto:admin42@192.168.1.30"><span class="font19">admin42@192.168.1.30</span></a></p>
<p><span class="font19">The authenticity of host '192.168.1.30 (192.168.1.30)' can't be established.</span></p>
<p><span class="font19">RSA key fingerprint is b5:fb:3c:53:50:b4:ab:81:f3:cd:2e:bb:ba:44:d3:75.</span></p>
<p><span class="font19">Are you sure you want to continue connecting (yes/no)? </span><span class="font19" style="font-weight:bold;">yes</span></p>
<p><span class="font19">Warning: Permanently added '192.168.1.30' (RSA) to the list of known hosts.</span></p>
<p><span class="font19">admin42@192.168.1.30's password:</span></p>
<p><span class="font19">Welcome to Ubuntu 12.04 LTS (GNU/Linux 3.2.0-26-generic-pae i686)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">* Documentation: </span><a href="https://help.ubuntu.com/"><span class="font19">https://help.ubuntu.com/</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font19">1 package can be updated.</span></p></li></ul>
<p><span class="font19">0 updates are security updates.</span></p>
<p><span class="font19">Last login: Wed Jun 6 19:25:57 2012 from 172.28.0.131 admin42@ubuserver:~$</span></p>
<p><span class="font25">The user can get log out of the remote server by typing </span><span class="font25" style="font-weight:bold;">exit </span><span class="font25">or by using </span><span class="font25" style="font-weight:bold;">Ctrl-d</span><span class="font25">.</span></p>
<p><span class="font19">admin42@ubuserver:~$ exit logout</span></p>
<p><span class="font19">Connection to 192.168.1.30 closed.</span></p>
<p><span class="font19">paul@ubu1204:~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5156"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4450"></a><a name="bookmark5157"></a>5.3. executing a command in remote</span></h2></li></ul>
<p><span class="font25">This screenshot shows how to execute the </span><span class="font25" style="font-weight:bold;">pwd </span><span class="font25">command on the remote server. There is no need to </span><span class="font25" style="font-weight:bold;">exit </span><span class="font25">the server manually.</span></p>
<p><span class="font19">paul@ubu1204:~$ ssh </span><a href="mailto:admin42@192.168.1.30"><span class="font19">admin42@192.168.1.30</span></a><span class="font19"> pwd</span></p>
<p><span class="font19">admin42@192.168.1.30's password:</span></p>
<p><span class="font19">/home/admin42</span></p>
<p><span class="font19">paul@ubu1204:~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5158"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4451"></a><a name="bookmark5159"></a>5.4. scp</span></h2></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">scp </span><span class="font25">command works just like </span><span class="font25" style="font-weight:bold;">cp</span><span class="font25">, but allows the source and destination of the copy to be behind </span><span class="font25" style="font-weight:bold;">ssh</span><span class="font25">. Here is an example where we copy the </span><span class="font25" style="font-weight:bold;">/etc/hosts </span><span class="font25">file from the remote server to the home directory of user paul.</span></p>
<p><span class="font19">paul@ubu1204:~$ scp admin42@192.168.1.30:/etc/hosts /home/paul/serverhosts admin42@192.168.1.30's password:</span></p>
<p><span class="font19">hosts &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;100% &nbsp;809 &nbsp;&nbsp;&nbsp;&nbsp;0.8KB/s &nbsp;&nbsp;00:00</span></p>
<p><span class="font25">Here is an example of the reverse, copying a local file to a remote server.</span></p>
<p><span class="font19">paul@ubu1204:~$ scp -/serverhosts admin42@192.168.1.30:/etc/hosts.new admin42@192.168.1.30's password:</span></p>
<p><span class="font19">serverhosts &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;100% &nbsp;809 &nbsp;&nbsp;&nbsp;&nbsp;0.8KB/s &nbsp;&nbsp;00:00</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5160"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4452"></a><a name="bookmark5161"></a>5.5. setting up passwordless ssh</span></h2></li></ul>
<p><span class="font25">To set up passwordless ssh authentication through public/private keys, use </span><span class="font25" style="font-weight:bold;">ssh-keygen </span><span class="font25">to generate a key pair without a passphrase, and then copy your public key to the destination server. Let's do this step by step.</span></p>
<p><span class="font25">In the example that follows, we will set up ssh without password between Alice and Bob. Alice has an account on a Red Hat Enterprise Linux server, Bob is using Ubuntu on his laptop. Bob wants to give Alice access using ssh and the public and private key system. This means that even if Bob changes his password on his laptop, Alice will still have access.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4723"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5162"></a>5.5.1. ssh-keygen</span></h3></li></ul>
<p><a name="bookmark5163"></a><span class="font25">The example below shows how Alice uses </span><span class="font25" style="font-weight:bold;">ssh-keygen </span><span class="font25">to generate a key pair. Alice does not enter a passphrase.</span></p>
<p><span class="font19">[alice@RHEL5 ~]$ ssh-keygen -t rsa Generating public/private rsa key pair.</span></p>
<p><span class="font19">Enter file in which to save the key (/home/alice/.ssh/id_rsa): Created directory '/home/alice/.ssh'.</span></p>
<p><span class="font19">Enter passphrase (empty for no passphrase):</span></p>
<p><span class="font19">Enter same passphrase again:</span></p>
<p><span class="font19">Your identification has been saved in /home/alice/.ssh/id_rsa.</span></p>
<p><span class="font19">Your public key has been saved in /home/alice/.ssh/id_rsa.pub.</span></p>
<p><span class="font19">The key fingerprint is:</span></p>
<p><span class="font19">9b:ac:ac:56:c2:98:e5:d9:18:c4:2a:51:72:bb:45:eb alice@RHEL5 [alice@RHEL5 ~]$</span></p>
<p><span class="font25">You can use </span><span class="font25" style="font-weight:bold;">ssh-keygen -t dsa </span><span class="font25">in the same way.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5164"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5165"></a>5.5.2. ~/.ssh</span></h3></li></ul>
<p><a name="bookmark5166"></a><span class="font25">While </span><span class="font25" style="font-weight:bold;">ssh-keygen </span><span class="font25">generates a public and a private key, it will also create a hidden </span><span class="font25" style="font-weight:bold;">.ssh </span><span class="font25">directory with proper permissions. If you create the </span><span class="font25" style="font-weight:bold;">.ssh </span><span class="font25">directory manually, then you need to chmod 700 it! Otherwise ssh will refuse to use the keys (world readable private keys are not secure!).</span></p>
<p><span class="font25">As you can see, the </span><span class="font25" style="font-weight:bold;">.ssh </span><span class="font25">directory is secure in Alice's home directory.</span></p>
<p><span class="font19">[alice@RHEL5 ~]$ ls -ld .ssh</span></p>
<p><span class="font19">drwx------ 2 alice alice 4096 May 1 07:38 .ssh</span></p>
<p><span class="font19">[alice@RHEL5 ~]$</span></p>
<p><span class="font25">Bob is using Ubuntu at home. He decides to manually create the </span><span class="font25" style="font-weight:bold;">.ssh </span><span class="font25">directory, so he needs to manually secure it.</span></p>
<p><span class="font19">bob@laika:~$ mkdir .ssh</span></p>
<p><span class="font19">bob@laika:~$ ls -ld .ssh</span></p>
<p><span class="font19">drwxr-xr-x 2 bob bob 4096 2008-05-14 16:53 .ssh</span></p>
<p><span class="font19">bob@laika:~$ chmod 700 .ssh/ bob@laika:~$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5167"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5168"></a>5.5.3. id_rsa and id_rsa.pub</span></h3></li></ul>
<p><a name="bookmark5169"></a><span class="font25"><a name="bookmark5170"></a><a name="bookmark5171"></a>The </span><span class="font25" style="font-weight:bold;">ssh-keygen </span><span class="font25">command generate two keys in .ssh. The public key is named </span><span class="font25" style="font-weight:bold;">~/.ssh/ id_rsa.pub</span><span class="font25">. The private key is named </span><span class="font25" style="font-weight:bold;">~/.ssh/id_rsa</span><span class="font25">.</span></p>
<p><span class="font19">[alice@RHEL5 ~]$ ls -l .ssh/</span></p>
<p><span class="font19">total 16</span></p>
<p><span class="font19">-rw------- 1 alice alice 1671 May 1 07:38 id_rsa</span></p>
<p><span class="font19">-rw-r--r-- 1 alice alice 393 May 1 07:38 id_rsa.pub</span></p>
<p><a name="bookmark5172"></a><span class="font25"><a name="bookmark5173"></a>The files will be named </span><span class="font25" style="font-weight:bold;">id_dsa </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">id_dsa.pub </span><span class="font25">when using </span><span class="font25" style="font-weight:bold;">dsa </span><span class="font25">instead of </span><span class="font25" style="font-weight:bold;">rsa</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5174"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5175"></a>5.5.4. copy the public key to the other computer</span></h3></li></ul>
<p><a name="bookmark5176"></a><span class="font25">To copy the public key from Alice's server tot Bob's laptop, Alice decides to use </span><span class="font25" style="font-weight:bold;">scp</span><span class="font25">.</span></p>
<p><span class="font19">[alice@RHEL5 .ssh]$ scp id_rsa.pub bob@192.168.48.92:~/.ssh/authorized_keys</span></p>
<p><span class="font19">bob@192.168.48.92's password:</span></p>
<p><span class="font19">id_rsa.pub &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;100% 393 &nbsp;&nbsp;&nbsp;&nbsp;0.4KB/s &nbsp;&nbsp;00:00</span></p>
<p><span class="font25">Be careful when copying a second key! Do not overwrite the first key, instead append the key to the same </span><span class="font25" style="font-weight:bold;">~/.ssh/authorized_keys </span><span class="font25">file!</span></p>
<p><span class="font19">cat id_rsa.pub &gt;&gt;&nbsp;~/.ssh/authorized_keys</span></p>
<p><span class="font25">Alice could also have used </span><span class="font25" style="font-weight:bold;">ssh-copy-id </span><span class="font25">like in this example.</span></p>
<p><span class="font19">ssh-copy-id -i .ssh/id_rsa.pub </span><a href="mailto:bob@192.168.48.92"><span class="font19">bob@192.168.48.92</span></a></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5177"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5178"></a>5.5.5. authorized_keys</span></h3></li></ul>
<p><a name="bookmark5179"></a><span class="font25">In your ~/.ssh directory, you can create a file called </span><span class="font25" style="font-weight:bold;">authorized_keys</span><span class="font25">. This file can contain one or more public keys from people you trust. Those trusted people can use their private keys to prove their identity and gain access to your account via ssh (without password). The example shows Bob's authorized_keys file containing the public key of Alice.</span></p>
<p><span class="font19">bob@laika:~$ cat .ssh/authorized_keys</span></p>
<p><span class="font19">ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEApCQ9xzyLzJes1sR+hPyqW2vyzt1D4zTLqk\ MDWBR4mMFuUZD/O583I3Lg/Q+JIq0RSksNzaL/BNLDou1jMpBe2Dmf/u22u4KmqlJBfDhe\ yTmGSBzeNYCYRSMq78CT9l9a+y6x/shucwhaILsy8A2XfJ9VCggkVtu7XlWFDL2cum08/0\ mRFwVrfc/uPsAn5XkkTscl4g21mQbnp9wJC40pGSJXXMuFOk8MgCb5ieSnpKFniAKM+tEo\ /vjDGSi3F/bxu691jscrU0VUdIoOSo98HUfEf7jKBRikxGAC7I4HLa+/zX73OIvRFAb2hv\ tUhn6RHrBtUJUjbSGiYeFTLDfcTQ== alice@RHEL5</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5180"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5181"></a>5.5.6. passwordless ssh</span></h3></li></ul>
<p><span class="font25">Alice can now use ssh to connect passwordless to Bob's laptop. In combination with </span><span class="font25" style="font-weight:bold;">ssh</span><span class="font25">'s capability to execute commands on the remote host, this can be useful in pipes across different machines.</span></p>
<p><span class="font19">[alice@RHEL5 ~]$ ssh </span><a href="mailto:bob@192.168.48.92"><span class="font19">bob@192.168.48.92</span></a><span class="font19"> &quot;ls -l .ssh&quot;</span></p>
<p><span class="font19">total 4</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-r--r-- 1 bob bob 393 2008-05-14 17:03 authorized_keys</span></p></li></ul>
<p><span class="font19">[alice@RHEL5 ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5182"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4453"></a><a name="bookmark5183"></a>5.6. X forwarding via ssh</span></h2></li></ul>
<p><a name="bookmark5184"></a><span class="font25">Another popular feature of </span><span class="font25" style="font-weight:bold;">ssh </span><span class="font25">is called </span><span class="font25" style="font-weight:bold;">X11 forwarding </span><span class="font25">and is implemented with </span><span class="font25" style="font-weight:bold;">ssh -X</span><span class="font25">.</span></p>
<p><span class="font25">Below an example of X forwarding: user paul logs in as user greet on her computer to start the graphical application mozilla-thunderbird. Although the application will run on the remote computer from greet, it will be displayed on the screen attached locally to paul's computer. </span><span class="font19">paul@debian5:~/PDF$ ssh -X </span><a href="mailto:greet@greet.dyndns.org"><span class="font19">greet@greet.dyndns.org</span></a><span class="font19"> -p 55555 Warning: Permanently added the RSA host key for IP address \ '81.240.174.161' to the list of known hosts.</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">Linux raika 2.6.8-2-686 #1 Tue Aug 16 13:22:48 UTC 2005 i686 GNU/Linux</span></p>
<p><span class="font19">Last login: Thu Jan 18 12:35:56 2007</span></p>
<p><span class="font19">greet@raika:~$ ps fax | grep thun</span></p>
<p><span class="font19">greet@raika:~$ mozilla-thunderbird &amp;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">[1] 30336</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5185"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4454"></a><a name="bookmark5186"></a>5.7. troubleshooting ssh</span></h2></li></ul>
<h4><a name="bookmark5187"></a><span class="font25"><a name="bookmark5188"></a>Use </span><span class="font25" style="font-weight:bold;">ssh -v </span><span class="font25">to get debug information about the ssh connection attempt.</span></h4>
<p><span class="font19">paul@debian5:~$ ssh -v </span><a href="mailto:bert@192.168.1.192"><span class="font19">bert@192.168.1.192</span></a></p>
<p><span class="font19">OpenSSH_4.3p2 Debian-8ubuntu1, OpenSSL 0.9.8c 05 Sep 2006</span></p>
<p><span class="font19">debug1: Reading configuration data /home/paul/.ssh/config</span></p>
<p><span class="font19">debug1: Reading configuration data /etc/ssh/ssh_config</span></p>
<p><span class="font19">debug1: Applying options for *</span></p>
<p><span class="font19">debug1: Connecting to 192.168.1.192 [192.168.1.192] port 22.</span></p>
<p><span class="font19">debug1: Connection established.</span></p>
<p><span class="font19">debug1: identity file /home/paul/.ssh/identity type -1</span></p>
<p><span class="font19">debug1: identity file /home/paul/.ssh/id_rsa type 1</span></p>
<p><span class="font19">debug1: identity file /home/paul/.ssh/id_dsa type -1</span></p>
<p><span class="font19">debug1: Remote protocol version 1.99, remote software version OpenSSH_3 debug1: match: OpenSSH_3.9p1 pat OpenSSH_3.*</span></p>
<p><span class="font19">debug1: Enabling compatibility mode for protocol 2.0</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5189"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4455"></a><a name="bookmark5190"></a>5.8. sshd</span></h2></li></ul>
<h4><a name="bookmark5191"></a><span class="font25"><a name="bookmark5192"></a><a name="bookmark5193"></a><a name="bookmark5194"></a>The ssh server is called </span><span class="font25" style="font-weight:bold;">sshd </span><span class="font25">and is provided by the </span><span class="font25" style="font-weight:bold;">openssh-server </span><span class="font25">package.</span></h4>
<p><span class="font19">root@ubu1204~# dpkg -l openssh-server | tail -1</span></p>
<p><span class="font19">ii openssh-server 1:5.9p1-5ubuntu1 secure shell (SSH) server,...</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5195"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4456"></a><a name="bookmark5196"></a>5.9. sshd keys</span></h2></li></ul>
<h4><a name="bookmark5197"></a><span class="font25"><a name="bookmark5198"></a><a name="bookmark5199"></a>The public keys used by the sshd server are located in </span><span class="font25" style="font-weight:bold;">/etc/ssh </span><span class="font25">and are world readable. The private keys are only readable by root.</span></h4>
<p><span class="font19">root@ubu1204~# ls -l /etc/ssh/ssh_host_*</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw------- 1 root root &nbsp;668 Jun &nbsp;7 &nbsp;2011 /etc/ssh/ssh_host_dsa_key</span></p></li></ul>
<p><span class="font19">-rw-r--r-- 1 root root &nbsp;598 Jun &nbsp;7 &nbsp;2011 /etc/ssh/ssh_host_dsa_key.pub</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw------- 1 root root 1679 Jun &nbsp;7 &nbsp;2011 /etc/ssh/ssh_host_rsa_key</span></p></li></ul>
<p><span class="font19">-rw-r--r-- 1 root root &nbsp;390 Jun &nbsp;7 &nbsp;2011 /etc/ssh/ssh_host_rsa_key.pub</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5200"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4457"></a><a name="bookmark5201"></a>5.10. ssh-agent</span></h2></li></ul>
<h4><a name="bookmark5202"></a><span class="font25"><a name="bookmark5203"></a>When generating keys with </span><span class="font25" style="font-weight:bold;">ssh-keygen</span><span class="font25">, you have the option to enter a passphrase to protect access to the keys. To avoid having to type this passphrase every time, you can add the key to </span><span class="font25" style="font-weight:bold;">ssh-agent </span><span class="font25">using </span><span class="font25" style="font-weight:bold;">ssh-add</span><span class="font25">.</span></h4>
<h4><a name="bookmark5204"></a><span class="font25"><a name="bookmark5205"></a>Most Linux distributions will start the </span><span class="font25" style="font-weight:bold;">ssh-agent </span><span class="font25">automatically when you log on.</span></h4>
<p><span class="font19">root@ubu1204~# ps -ef | grep ssh-agent</span></p>
<p><span class="font19">paul 2405 &nbsp;2365 &nbsp;0 08:13 ? &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;00:00:00 /usr/bin/ssh-agent...</span></p>
<h4><a name="bookmark5206"></a><span class="font25"><a name="bookmark5207"></a>This clipped screenshot shows how to use </span><span class="font25" style="font-weight:bold;">ssh-add </span><span class="font25">to list the keys that are currently added to the </span><span class="font25" style="font-weight:bold;">ssh-agent</span></h4>
<p><span class="font19">paul@debian5:~$ ssh-add -L</span></p>
<p><span class="font19">ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAvgI+Vx5UrIsusZPl8da8URHGsxG7yivv3/\</span></p>
<p><span class="font19">...</span></p>
<p><span class="font19">wMGqa48Kelwom8TGb4Sgcwpp/VO/ldA5m+BGCw== paul@deb503</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5208"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4458"></a><a name="bookmark5209"></a>5.11. practice: ssh</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">0. Make sure that you have access to </span><span class="font25" style="font-weight:bold;">two Linux computers</span><span class="font25">, or work together with a partner for this exercise. For this practice, we will name one of the machines the server.</span></p></li>
<li>
<p><span class="font25">1. Install </span><span class="font25" style="font-weight:bold;">sshd </span><span class="font25">on the server</span></p></li>
<li>
<p><span class="font25">2. Verify in the ssh configuration files that only protocol version 2 is allowed.</span></p></li>
<li>
<p><span class="font25">3. Use </span><span class="font25" style="font-weight:bold;">ssh </span><span class="font25">to log on to the server, show your current directory and then exit the server.</span></p></li>
<li>
<p><span class="font25">4. Use </span><span class="font25" style="font-weight:bold;">scp </span><span class="font25">to copy a file from your computer to the server.</span></p></li>
<li>
<p><span class="font25">5. Use </span><span class="font25" style="font-weight:bold;">scp </span><span class="font25">to copy a file from the server to your computer.</span></p></li>
<li>
<p><span class="font25">6. (optional, only works when you have a graphical install of Linux) Install the xeyes package on the server and use ssh to run xeyes on the server, but display it on your client.</span></p></li>
<li>
<p><span class="font25">7. (optional, same as previous) Create a bookmark in firefox, then quit firefox on client and server. Use </span><span class="font25" style="font-weight:bold;">ssh -X </span><span class="font25">to run firefox on your display, but on your neighbour's computer. Do you see your neighbour's bookmark ?</span></p></li>
<li>
<p><span class="font25">8. Use </span><span class="font25" style="font-weight:bold;">ssh-keygen </span><span class="font25">to create a key pair without passphrase. Setup passwordless ssh between you and your neighbour. (or between your client and your server)</span></p></li>
<li>
<p><span class="font25">9.V erify that the permissions on the server key files are correct; world readable for the public keys and only root access for the private keys.</span></p></li>
<li>
<p><span class="font25">10. Verify that the </span><span class="font25" style="font-weight:bold;">ssh-agent </span><span class="font25">is running.</span></p></li>
<li>
<p><span class="font25">11. (optional) Protect your keypair with a </span><span class="font25" style="font-weight:bold;">passphrase</span><span class="font25">, then add this key to the </span><span class="font25" style="font-weight:bold;">ssh-agent </span><span class="font25">and test your passwordless ssh to the server.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5210"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4459"></a><a name="bookmark5211"></a>5.12. solution: ssh</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">0. Make sure that you have access to </span><span class="font25" style="font-weight:bold;">two Linux computers</span><span class="font25">, or work together with a partner for this exercise. For this practice, we will name one of the machines the server.</span></p></li>
<li>
<p><span class="font25">1. Install </span><span class="font25" style="font-weight:bold;">sshd </span><span class="font25">on the server</span></p></li></ul>
<p><span class="font19">apt-get install openssh-server (on Ubuntu/Debian)</span></p>
<p><span class="font19">yum -y install openssh-server (on Centos/Fedora/Red Hat)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Verify in the ssh configuration files that only protocol version 2 is allowed.</span></p></li></ul>
<p><span class="font19">grep Protocol /etc/ssh/ssh*_config</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Use </span><span class="font25" style="font-weight:bold;">ssh </span><span class="font25">to log on to the server, show your current directory and then exit the server.</span></p></li></ul>
<p><span class="font19">user@client$ ssh user@server-ip-address user@server$ pwd /home/user user@server$ exit</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Use </span><span class="font25" style="font-weight:bold;">scp </span><span class="font25">to copy a file from your computer to the server.</span></p></li></ul>
<p><span class="font19">scp localfile user@server:~</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Use </span><span class="font25" style="font-weight:bold;">scp </span><span class="font25">to copy a file from the server to your computer.</span></p></li></ul>
<p><span class="font19">scp user@server:~/serverfile .</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. (optional, only works when you have a graphical install of Linux) Install the xeyes package on the server and use ssh to run xeyes on the server, but display it on your client.</span></p></li></ul>
<p><span class="font19">on the server: apt-get install xeyes on the client:</span></p>
<p><span class="font19">ssh -X user@server-ip xeyes</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. (optional, same as previous) Create a bookmark in firefox, then quit firefox on client and server. Use </span><span class="font25" style="font-weight:bold;">ssh -X </span><span class="font25">to run firefox on your display, but on your neighbour's computer. Do you see your neighbour's bookmark ?</span></p></li>
<li>
<p><span class="font25">8. Use </span><span class="font25" style="font-weight:bold;">ssh-keygen </span><span class="font25">to create a key pair without passphrase. Setup passwordless ssh between you and your neighbour. (or between your client and your server)</span></p></li></ul>
<p><span class="font19">See solution in book &quot;setting up passwordless ssh&quot;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">9. Verify that the permissions on the server key files are correct; world readable for the public keys and only root access for the private keys.</span></p></li></ul>
<p><span class="font19">ls -l /etc/ssh/ssh_host_*</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">10. Verify that the </span><span class="font25" style="font-weight:bold;">ssh-agent </span><span class="font25">is running.</span></p></li></ul>
<p><span class="font19">ps fax | grep ssh-agent</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">11. (optional) Protect your keypair with a </span><span class="font25" style="font-weight:bold;">passphrase</span><span class="font25">, then add this key to the </span><span class="font25" style="font-weight:bold;">ssh-agent </span><span class="font25">and test your passwordless ssh to the server.</span></p></li></ul>
<p><span class="font19">man ssh-keygen man ssh-agent man ssh-add</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark5212"></a><span class="font11" style="font-weight:bold;"><a name="bookmark4460"></a><a name="bookmark5213"></a>Chapter 6. introduction to nfs</span></h1></li></ul>
<p><a name="bookmark5214"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">network file system </span><span class="font25">(or simply </span><span class="font25" style="font-weight:bold;">nfs</span><span class="font25">) enables us since the Eighties to share a directory with other computers on the network.</span></p>
<p><a name="bookmark5215"></a><span class="font25">In this chapter we see how to setup an </span><span class="font25" style="font-weight:bold;">nfs </span><span class="font25">server and an </span><span class="font25" style="font-weight:bold;">nfs </span><span class="font25">client computer.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5216"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4461"></a><a name="bookmark5217"></a>6.1. nfs protocol versions</span></h2></li></ul>
<h4><a name="bookmark5218"></a><span class="font25"><a name="bookmark5219"></a><a name="bookmark5220"></a><a name="bookmark5221"></a><a name="bookmark5222"></a>The older </span><span class="font25" style="font-weight:bold;">nfs </span><span class="font25">versions 2 and 3 are stateless (</span><span class="font25" style="font-weight:bold;">udp</span><span class="font25">) by default (but they can use </span><span class="font25" style="font-weight:bold;">tcp</span><span class="font25">). The more recent </span><span class="font25" style="font-weight:bold;">nfs version 4 </span><span class="font25">brings a stateful protocol with better performance and stronger security.</span></h4>
<h4><a name="bookmark5223"></a><span class="font25"><a name="bookmark5224"></a><a name="bookmark5225"></a><a name="bookmark5226"></a><a name="bookmark5227"></a>NFS version 4 was defined in </span><span class="font25" style="font-weight:bold;">rfc 3010 </span><span class="font25">in 2000 and </span><span class="font25" style="font-weight:bold;">rfc 3530 </span><span class="font25">in 2003 and requires tcp (port 2049). It also supports </span><span class="font25" style="font-weight:bold;">Kerberos </span><span class="font25">user authentication as an option when mounting a share. NFS versions 2 and 3 authenticate only the host.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5228"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4462"></a><a name="bookmark5229"></a>6.2. rpcinfo</span></h2></li></ul>
<h4><a name="bookmark5230"></a><span class="font25"><a name="bookmark5231"></a><a name="bookmark5232"></a><a name="bookmark5233"></a><a name="bookmark5234"></a>Clients connect to the server using </span><span class="font25" style="font-weight:bold;">rpc </span><span class="font25">(on Linux this can be managed by the </span><span class="font25" style="font-weight:bold;">portmap </span><span class="font25">daemon). Look at </span><span class="font25" style="font-weight:bold;">rpcinfo </span><span class="font25">to verify that </span><span class="font25" style="font-weight:bold;">nfs </span><span class="font25">and its related services are running.</span></h4>
<p><span class="font19">root@RHELv4u2:~# /etc/init.d/portmap status</span></p>
<p><span class="font19">portmap (pid 1920) is running...</span></p>
<p><span class="font19">root@RHELv4u2:~# rpcinfo -p program vers proto port 100000 &nbsp;&nbsp;&nbsp;2 &nbsp;&nbsp;tcp &nbsp;&nbsp;&nbsp;111 &nbsp;portmapper</span></p>
<p><span class="font19">100000 &nbsp;&nbsp;&nbsp;2 &nbsp;&nbsp;udp &nbsp;&nbsp;&nbsp;111 &nbsp;portmapper</span></p>
<p><span class="font19">100024 &nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;udp &nbsp;32768 &nbsp;status</span></p>
<p><span class="font19">100024 &nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;tcp &nbsp;32769 &nbsp;status</span></p>
<p><span class="font19">root@RHELv4u2:~# service nfs start</span></p>
<p><a href="#bookmark5235"><span class="font19">Starting NFS services: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ &nbsp;OK</span></a></p>
<p><a href="#bookmark5236"><span class="font19">Starting NFS quotas: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ &nbsp;OK</span></a></p>
<p><a href="#bookmark5237"><span class="font19">Starting NFS daemon: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ &nbsp;OK</span></a></p>
<p><a href="#bookmark5238"><span class="font19">Starting NFS mountd: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ &nbsp;OK</span></a></p>
<h4><a name="bookmark5239"></a><span class="font25"><a name="bookmark5240"></a>The same </span><span class="font25" style="font-weight:bold;">rpcinfo </span><span class="font25">command when </span><span class="font25" style="font-weight:bold;">nfs </span><span class="font25">is started.</span></h4>
<table border="1">
<tr><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">root@RHELv4u2</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">:~# rpcinfo •</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">-p</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">program</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">vers</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">proto</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">port</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100000</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">111</span></p></td><td style="vertical-align:top;">
<p><span class="font19">portmapper</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100000</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">111</span></p></td><td style="vertical-align:top;">
<p><span class="font19">portmapper</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100024</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">32768</span></p></td><td style="vertical-align:top;">
<p><span class="font19">status</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">100024</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">32769</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">status</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">100011</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">985</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">rquotad</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100011</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">985</span></p></td><td style="vertical-align:top;">
<p><span class="font19">rquotad</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100011</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">988</span></p></td><td style="vertical-align:top;">
<p><span class="font19">rquotad</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100011</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">988</span></p></td><td style="vertical-align:top;">
<p><span class="font19">rquotad</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100003</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2049</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nfs</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100003</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2049</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nfs</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100003</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4</span></p></td><td style="vertical-align:top;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2049</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nfs</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100003</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2049</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nfs</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100003</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2049</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nfs</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">100003</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2049</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">nfs</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">100021</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">32770</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">nlockmgr</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100021</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">32770</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nlockmgr</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100021</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4</span></p></td><td style="vertical-align:top;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">32770</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nlockmgr</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100021</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">32789</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nlockmgr</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100021</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">32789</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nlockmgr</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100021</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">32789</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nlockmgr</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100005</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1004</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mountd</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">100005</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1007</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">mountd</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">100005</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1004</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">mountd</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">100005</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1007</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">mountd</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">100005</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1004</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">mountd</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100005</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1007</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mountd</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5241"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4463"></a><a name="bookmark5242"></a>6.3. server configuration</span></h2></li></ul>
<p><a name="bookmark5243"></a><span class="font25" style="font-weight:bold;"><a name="bookmark5244"></a>nfs </span><span class="font25">is configured in </span><span class="font25" style="font-weight:bold;">/etc/exports</span><span class="font25">. You might want some way (</span><span class="font25" style="font-weight:bold;">ldap</span><span class="font25">?) to synchronize userid's across computers when using </span><span class="font25" style="font-weight:bold;">nfs </span><span class="font25">a lot.</span></p>
<p><a name="bookmark5245"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">rootsquash </span><span class="font25">option will change UID 0 to the UID of a </span><span class="font25" style="font-weight:bold;">nobody </span><span class="font25">(or similar) user account. The </span><span class="font25" style="font-weight:bold;">sync </span><span class="font25">option will write writes to disk before completing the client request.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5246"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4464"></a><a name="bookmark5247"></a>6.4. /etc/exports</span></h2></li></ul>
<p><span class="font25">Here is a sample </span><span class="font25" style="font-weight:bold;">/etc/exports </span><span class="font25">to explain the syntax:</span></p>
<p><span class="font19">paul@laika:~$ cat /etc/exports # Everyone can read this share /mnt/data/iso *(ro)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Only the computers named pasha and barry can readwrite this one /var/www pasha(rw) barry(rw)</span></p></li>
<li>
<p><span class="font19"># same, but without root squashing for barry /var/ftp pasha(rw) barry(rw,no_root_squash)</span></p></li>
<li>
<p><span class="font19"># everyone from the netsec.local domain gets access</span></p></li></ul>
<p><span class="font19">/var/backup &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*.netsec.local(rw)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># ro for one network, rw for the other</span></p></li></ul>
<p><span class="font19">/var/upload 192.168.1.0/24(ro) 192.168.5.0/24(rw)</span></p>
<p><a name="bookmark5248"></a><span class="font25"><a name="bookmark5249"></a>More recent incarnations of </span><span class="font25" style="font-weight:bold;">nfs </span><span class="font25">require the </span><span class="font25" style="font-weight:bold;">subtree_check </span><span class="font25">option to be explicitly set (or unset with </span><span class="font25" style="font-weight:bold;">no_subtree_check)</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">/etc/exports </span><span class="font25">file then looks like this:</span></p>
<p><span class="font19">root@debian6 ~# cat /etc/exports # Everyone can read this share /srv/iso *(ro,no_subtree_check)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Only the computers named pasha and barry can readwrite this one /var/www pasha(rw,no_subtree_check) barry(rw,no_subtree_check)</span></p></li>
<li>
<p><span class="font19"># same, but without root squashing for barry</span></p></li></ul>
<p><span class="font19">/var/ftp pasha(rw,no_subtree_check) barry(rw,no_root_squash,no_subtree_check)</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5250"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4465"></a><a name="bookmark5251"></a>6.5. exportfs</span></h2></li></ul>
<p><a name="bookmark5252"></a><span class="font25"><a name="bookmark5253"></a>You don't need to restart the nfs server to start exporting your newly created exports. You can use the </span><span class="font25" style="font-weight:bold;">exportfs -va </span><span class="font25">command to do this. It will write the exported directories to </span><span class="font25" style="font-weight:bold;">/var/ lib/nfs/etab</span><span class="font25">, where they are immediately applied.</span></p>
<p><span class="font19">root@debian6 ~# exportfs -va</span></p>
<p><span class="font19">exporting pasha:/var/ftp</span></p>
<p><span class="font19">exporting barry:/var/ftp</span></p>
<p><span class="font19">exporting pasha:/var/www</span></p>
<p><span class="font19">exporting barry:/var/www exporting *:/srv/iso</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5254"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4466"></a><a name="bookmark5255"></a>6.6. client configuration</span></h2></li></ul>
<p><a name="bookmark5256"></a><span class="font25"><a name="bookmark5257"></a>We have seen the </span><span class="font25" style="font-weight:bold;">mount </span><span class="font25">command and the </span><span class="font25" style="font-weight:bold;">/etc/fstab </span><span class="font25">file before.</span></p>
<p><span class="font19">root@RHELv4u2:~# mount -t nfs barry:/mnt/data/iso /home/project55/</span></p>
<p><span class="font19">root@RHELv4u2:~# cat /etc/fstab | grep nfs</span></p>
<p><span class="font19">barry:/mnt/data/iso /home/iso &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nfs defaults 0 0</span></p>
<p><span class="font19">root@RHELv4u2:~#</span></p>
<p><span class="font25">Here is another simple example. Suppose the project55 people tell you they only need a couple of CD-ROM images, and you already have them available on an </span><span class="font25" style="font-weight:bold;">nfs </span><span class="font25">server. You could issue the following command to mount this storage on their </span><span class="font25" style="font-weight:bold;">/home/project55 </span><span class="font25">mount point.</span></p>
<p><span class="font19">root@RHELv4u2:~# mount -t nfs 192.168.1.40:/mnt/data/iso /home/project55/ root@RHELv4u2:~# ls -lh /home/project55/</span></p>
<p><span class="font19">total 3.6G</span></p>
<p><span class="font19">drwxr-xr-x &nbsp;2 1000 1000 4.0K Jan 16 17:55 RHELv4u1</span></p>
<p><span class="font19">drwxr-xr-x &nbsp;2 1000 1000 4.0K Jan 16 14:14 RHELv4u2</span></p>
<p><span class="font19">drwxr-xr-x &nbsp;2 1000 1000 4.0K Jan 16 14:54 RHELv4u3</span></p>
<p><span class="font19">drwxr-xr-x &nbsp;2 1000 1000 4.0K Jan 16 11:09 RHELv4u4</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-r--r-- &nbsp;1 root root 1.6G Oct 13 15:22 sled10-vmwarews5-vm.zip</span></p></li></ul>
<p><span class="font19">root@RHELv4u2:~#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5258"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4467"></a><a name="bookmark5259"></a>6.7. practice: introduction to nfs</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create two directories with some files. Use </span><span class="font25" style="font-weight:bold;">nfs </span><span class="font25">to share one of them as read only, the other must be writable. Have your neighbour connect to them to test.</span></p></li>
<li>
<p><span class="font25">2. Investigate the user owner of the files created by your neighbour.</span></p></li>
<li>
<p><span class="font25">3. Protect a share by ip-address or hostname, so only your neighbour can connect.</span></p></li></ul>
<ul style="list-style:none;"><li>
<p><a name="bookmark5260"></a><span class="font11" style="font-weight:bold;">Chapter 7. introduction to networking</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5261"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4469"></a><a name="bookmark5262"></a>7.1. introduction to iptables</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark4540"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5263"></a>7.1.1. iptables firewall</span></h3></li></ul></li></ul>
<p><a name="bookmark5264"></a><span class="font25">The Linux kernel has a built-in stateful firewall named </span><span class="font25" style="font-weight:bold;">iptables</span><span class="font25">. To stop the </span><span class="font25" style="font-weight:bold;">iptables </span><span class="font25">firewall on Red Hat, use the service command.</span></p>
<p><span class="font19">root@RHELv4u4:~# service iptables stop</span></p>
<p><a href="#bookmark5265"><span class="font19">Flushing firewall rules: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ &nbsp;OK</span></a></p>
<p><a href="#bookmark5266"><span class="font19">Setting chains to policy ACCEPT: filter &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ &nbsp;OK</span></a></p>
<p><a href="#bookmark5267"><span class="font19">Unloading iptables modules: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ &nbsp;OK</span></a></p>
<p><span class="font19">root@RHELv4u4:~#</span></p>
<p><a name="bookmark5268"></a><span class="font25"><a name="bookmark5269"></a><a name="bookmark5270"></a>The easy way to configure iptables, is to use a graphical tool like KDE's </span><span class="font25" style="font-weight:bold;">kmyfirewall </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">Security Level Configuration Tool</span><span class="font25">. You can find the latter in the graphical menu, somewhere in System Tools - Security, or you can start it by typing </span><span class="font25" style="font-weight:bold;">system-config-securitylevel </span><span class="font25">in bash. These tools allow for some basic firewall configuration. You can decide whether to enable or disable the firewall, and what typical standard ports are allowed when the firewall is active. You can even add some custom ports. When you are done, the configuration is written to </span><span class="font25" style="font-weight:bold;">/etc/sysconfig/iptables </span><span class="font25">on Red Hat.</span></p>
<p><span class="font19">root@RHELv4u4:~# cat /etc/sysconfig/iptables</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Firewall configuration written by system-config-securitylevel # Manual customization of this file is not recommended.</span></p></li></ul>
<p><span class="font19">*filter :INPUT ACCEPT [0:0] :FORWARD ACCEPT [0:0] :OUTPUT ACCEPT [0:0] :RH-Firewall-1-INPUT - [0:0] -A INPUT -j RH-Firewall-1-INPUT -A FORWARD -j RH-Firewall-1-INPUT -A RH-Firewall-1-INPUT -i lo -j ACCEPT -A RH-Firewall-1-INPUT -p icmp --icmp-type any -j ACCEPT -A RH-Firewall-1-INPUT -p 50 -j ACCEPT -A RH-Firewall-1-INPUT -p 51 -j ACCEPT</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- A RH-Firewall-1-INPUT -p udp --dport 5353 -d 224.0.0.251 -j ACCEPT</span></p></li>
<li>
<p><span class="font19">- A RH-Firewall-1-INPUT -p udp -m udp --dport 631 -j ACCEPT</span></p></li>
<li>
<p><span class="font19">- A RH-Firewall-1-INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT -A RH-F...NPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT</span></p></li>
<li>
<p><span class="font19">- A RH-F...NPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT</span></p></li>
<li>
<p><span class="font19">- A RH-F...NPUT -m state --state NEW -m tcp -p tcp --dport 21 -j ACCEPT</span></p></li>
<li>
<p><span class="font19">- A RH-F...NPUT -m state --state NEW -m tcp -p tcp --dport 25 -j ACCEPT</span></p></li>
<li>
<p><span class="font19">- A RH-Firewall-1-INPUT -j REJECT --reject-with icmp-host-prohibited COMMIT root@RHELv4u4:~#</span></p></li></ul>
<p><a name="bookmark5271"></a><span class="font25">To start the service, issue the </span><span class="font25" style="font-weight:bold;">service iptables start </span><span class="font25">command. You can configure iptables to start at boot time with chkconfig.</span></p>
<p><span class="font19">root@RHELv4u4:~# service iptables start Applying iptables firewall rules: root@RHELv4u4:~# chkconfig iptables on root@RHELv4u4:~#</span></p>
<div>
<p><span class="font19">[ OK ]</span></p>
</div><br clear="all">
<h4><a name="bookmark5272"></a><span class="font25"><a name="bookmark5273"></a>One of the nice features of iptables is that it displays extensive </span><span class="font25" style="font-weight:bold;">status </span><span class="font25">information when queried with the </span><span class="font25" style="font-weight:bold;">service iptables status </span><span class="font25">command.</span></h4>
<p><span class="font19">root@RHELv4u4:~# service iptables status</span></p>
<div>
<p><span class="font19">Table: filter</span></p>
<p><span class="font19">Chain INPUT (policy ACCEPT) target prot opt source RH-Firewall-1-INPUT all --</span></p>
</div><br clear="all">
<div>
<p><span class="font19">destination</span></p>
<p><span class="font19">0.0.0.0/0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0/0</span></p>
</div><br clear="all">
<p><span class="font19">Chain FORWARD (policy ACCEPT) target prot opt source</span></p>
<div>
<p><span class="font19">destination</span></p>
<p><span class="font19">0.0.0.0/0</span></p>
</div><br clear="all">
<p><span class="font19">RH-Firewall-1-INPUT all -- &nbsp;0.0.0.0/0</span></p>
<p><span class="font19">Chain OUTPUT (policy ACCEPT) target prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">Chain RH-Firewall-1-INPUT (2 references)</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">target</span></p></td><td style="vertical-align:top;">
<p><span class="font19">prot</span></p></td><td style="vertical-align:top;">
<p><span class="font19">opt</span></p></td><td style="vertical-align:top;">
<p><span class="font19">source</span></p></td><td style="vertical-align:top;">
<p><span class="font19">destination</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">ACCEPT</span></p></td><td style="vertical-align:top;">
<p><span class="font19">all</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">—</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0.0.0/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0.0.0/0</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">ACCEPT</span></p></td><td style="vertical-align:top;">
<p><span class="font19">icmp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">—</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0.0.0/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0.0.0/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">icmp type 255</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">ACCEPT</span></p></td><td style="vertical-align:top;">
<p><span class="font19">esp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">—</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0.0.0/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0.0.0/0</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">ACCEPT</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ah</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">—</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0.0.0/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0.0.0/0</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">ACCEPT</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">—</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.0.0.0/0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">224.0.0.251</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">udp dpt:5353</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">ACCEPT</span></p></td><td style="vertical-align:top;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">—</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0.0.0/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0.0.0/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">udp dpt:631</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">ACCEPT</span></p></td><td style="vertical-align:top;">
<p><span class="font19">all</span></p></td><td style="vertical-align:top;">
<p><span class="font19">—</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0.0.0/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0.0.0/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">state RELATED,</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ESTABLISHED</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">ACCEPT</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">—</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.0.0.0/0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.0.0.0/0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">state NEW tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">dpt:22</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">ACCEPT</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">—</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.0.0.0/0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.0.0.0/0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">state NEW tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">dpt:80</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">ACCEPT</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">—</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.0.0.0/0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.0.0.0/0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">state NEW tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">dpt:21</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">ACCEPT</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">—</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.0.0.0/0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.0.0.0/0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">state NEW tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">dpt:25</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">REJECT</span></p></td><td style="vertical-align:top;">
<p><span class="font19">all</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">—</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0.0.0/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0.0.0/0</span></p></td><td colspan="2" style="vertical-align:top;">
<p><span class="font19">reject-with icmp-host-prohibited</span></p></td></tr>
</table>
<p><span class="font19">root@RHELv4u4:~#</span></p>
<h4><a name="bookmark5274"></a><span class="font25"><a name="bookmark5275"></a>Mastering firewall configuration requires a decent knowledge of tcp/ip. Good iptables tutorials can be found online here </span><a href="http://iptables-tutorial.frozentux.net/iptables-tutorial.html"><span class="font25">http://iptables-tutorial.frozentux.net/iptables-tutorial.html</span></a><span class="font25"> and here </span><a href="http://tldp.org/HOWTO/IP-Masquerade-HOWTO/"><span class="font25">http://tldp.org/HOWTO/IP-Masquerade-HOWTO/</span></a><span class="font25">.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5276"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4470"></a><a name="bookmark5277"></a>7.2. practice : iptables</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5278"></a><span class="font25"><a name="bookmark5279"></a>1. Verify whether the firewall is running.</span><br><br><span class="font25"><a name="bookmark5280"></a>2. Stop the running firewall.</span></h4>
<h2><a name="bookmark5281"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4471"></a><a name="bookmark5282"></a>7.3. solution : iptables</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5283"></a><span class="font25"><a name="bookmark5284"></a>1. Verify whether the firewall is running.</span></h4></li></ul>
<p><span class="font19">root@rhel55 ~# service iptables status | head</span></p>
<p><span class="font19">Table: filter</span></p>
<p><span class="font19">Chain INPUT (policy ACCEPT) num target prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">1 RH-Firewall-1-INPUT all -- &nbsp;0.0.0.0/0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0/0</span></p></li></ul>
<p><span class="font19">Chain FORWARD (policy ACCEPT) num target prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">1 RH-Firewall-1-INPUT all -- &nbsp;0.0.0.0/0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0/0</span></p></li></ul>
<p><span class="font19">Chain OUTPUT (policy ACCEPT)</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5285"></a><span class="font25"><a name="bookmark5286"></a>2. Stop the running firewall.</span></h4></li></ul>
<p><span class="font19">root@rhel55 ~# service iptables stop</span></p>
<p><a href="#bookmark5287"><span class="font19">Flushing firewall rules: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ &nbsp;OK</span></a></p>
<p><a href="#bookmark5288"><span class="font19">Setting chains to policy ACCEPT: filter &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ &nbsp;OK</span></a></p>
<p><a href="#bookmark5289"><span class="font19">Unloading iptables modules: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ &nbsp;OK</span></a></p>
<p><span class="font19">root@rhel55 ~# service iptables status Firewall is stopped.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5290"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4472"></a><a name="bookmark5291"></a>7.4. xinetd and inetd</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark5292"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5293"></a>7.4.1. the superdaemon</span></h3></li></ul></li></ul>
<p><a name="bookmark5294"></a><span class="font25"><a name="bookmark5295"></a><a name="bookmark5296"></a><a name="bookmark5297"></a><a name="bookmark5298"></a>Back when resources like RAM memory were limited, a super-server was devised to listen to all sockets and start the appropriate daemon only when needed. Services like </span><span class="font25" style="font-weight:bold;">swat</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">telnet </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">ftp </span><span class="font25">are typically served by such a super-server. The </span><span class="font25" style="font-weight:bold;">xinetd </span><span class="font25">superdaemon is more recent than </span><span class="font25" style="font-weight:bold;">inetd</span><span class="font25">. We will discuss the configuration both daemons.</span></p>
<p><span class="font25">Recent Linux distributions like RHEL5 and Ubuntu10.04 do not activate </span><span class="font25" style="font-weight:bold;">inetd </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">xinetd </span><span class="font25">by default, unless an application requires it.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5299"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5300"></a>7.4.2. inetd or xinetd</span></h3></li></ul>
<p><span class="font25">First verify whether your computer is running </span><span class="font25" style="font-weight:bold;">inetd </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">xinetd</span><span class="font25">. This Debian 4.0 Etch is running </span><span class="font25" style="font-weight:bold;">inetd</span><span class="font25">.</span></p>
<p><span class="font19">root@barry:~# ps fax | grep inet</span></p>
<p><span class="font19">3870 ? &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ss 0:00 /usr/sbin/inetd</span></p>
<p><span class="font25">This Red Hat Enterprise Linux 4 update 4 is running </span><span class="font25" style="font-weight:bold;">xinetd</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL4b ~]# ps fax | grep inet</span></p>
<p><span class="font19">3003 ? &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ss 0:00 xinetd -stayalive -pidfile /var/run/xinetd.pid</span></p>
<p><span class="font25">Both daemons have the same functionality (listening to many ports, starting other daemons when they are needed), but they have different configuration files.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5301"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5302"></a>7.4.3. xinetd superdaemon</span></h3></li></ul>
<p><a name="bookmark5303"></a><span class="font25"><a name="bookmark5304"></a><a name="bookmark5305"></a>The </span><span class="font25" style="font-weight:bold;">xinetd </span><span class="font25">daemon is often called a superdaemon because it listens to a lot of incoming connections, and starts other daemons when they are needed. When a connection request is received, </span><span class="font25" style="font-weight:bold;">xinetd </span><span class="font25">will first check TCP wrappers (/etc/hosts.allow and /etc/hosts.deny) and then give control of the connection to the other daemon. This superdaemon is configured through </span><span class="font25" style="font-weight:bold;">/etc/xinetd.conf </span><span class="font25">and the files in the directory </span><span class="font25" style="font-weight:bold;">/etc/xinetd.d</span><span class="font25">. Let's first take a look at /etc/xinetd.conf.</span></p>
<p><span class="font19">paul@RHELv4u2:~$ cat /etc/xinetd.conf #</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Simple configuration file for xinetd</span></p></li></ul>
<p><span class="font19">#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Some defaults, and include /etc/xinetd.d/</span></p></li></ul>
<p><span class="font19">defaults</span></p>
<p><span class="font19">{</span></p>
<p><span class="font19">instances &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 60</span></p>
<p><span class="font19">log_type &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= SYSLOG authpriv</span></p>
<p><span class="font19">log_on_success &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= HOST PID</span></p>
<p><span class="font19">log_on_failure &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= HOST</span></p>
<p><span class="font19">cps &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 25 30</span></p>
<p><span class="font19">}</span></p>
<p><span class="font19">includedir /etc/xinetd.d</span></p>
<p><span class="font19">paul@RHELv4u2:~$</span></p>
<p><span class="font25">According to the settings in this file, xinetd can handle 60 client requests at once. It uses the </span><span class="font25" style="font-weight:bold;">authpriv </span><span class="font25">facility to log the host ip-address and pid of successful daemon spawns. When a service (aka protocol linked to daemon) gets more than 25 cps (connections per second), it holds subsequent requests for 30 seconds.</span></p>
<p><span class="font25">The directory </span><span class="font25" style="font-weight:bold;">/etc/xinetd.d </span><span class="font25">contains more specific configuration files. Let's also take a look at one of them.</span></p>
<p><span class="font19">paul@RHELv4u2:~$ ls /etc/xinetd.d</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">amanda</span></p></td><td style="vertical-align:top;">
<p><span class="font19">chargen-udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">echo</span></p></td><td style="vertical-align:top;">
<p><span class="font19">klogin</span></p></td><td style="vertical-align:top;">
<p><span class="font19">rexec</span></p></td><td style="vertical-align:top;">
<p><span class="font19">talk</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">amandaidx</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cups-lpd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">echo-udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">krb5-telnet</span></p></td><td style="vertical-align:top;">
<p><span class="font19">rlogin</span></p></td><td style="vertical-align:top;">
<p><span class="font19">telnet</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">amidxtape</span></p></td><td style="vertical-align:top;">
<p><span class="font19">daytime</span></p></td><td style="vertical-align:top;">
<p><span class="font19">eklogin</span></p></td><td style="vertical-align:top;">
<p><span class="font19">kshell</span></p></td><td style="vertical-align:top;">
<p><span class="font19">rsh</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tftp</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">auth</span></p></td><td style="vertical-align:top;">
<p><span class="font19">daytime-udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">finger</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ktalk</span></p></td><td style="vertical-align:top;">
<p><span class="font19">rsync</span></p></td><td style="vertical-align:top;">
<p><span class="font19">time</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">chargen</span></p></td><td style="vertical-align:top;">
<p><span class="font19">dbskkd-cdb</span></p></td><td style="vertical-align:top;">
<p><span class="font19">gssftp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ntalk</span></p></td><td style="vertical-align:top;">
<p><span class="font19">swat</span></p></td><td style="vertical-align:top;">
<p><span class="font19">time-udp</span></p></td></tr>
</table>
<p><span class="font19">paul@RHELv4u2:~$ cat /etc/xinetd.d/swat # default: off</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># description: SWAT is the Samba Web Admin Tool. Use swat \</span></p></li>
<li>
<p><span class="font19"># to configure your Samba server. To use SWAT, \</span></p></li>
<li>
<p><span class="font19"># connect to port 901 with your favorite web browser.</span></p></li></ul>
<p><span class="font19">service swat</span></p>
<p><span class="font19">{</span></p>
<p><span class="font19">port &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 901</span></p>
<p><span class="font19">socket_type &nbsp;&nbsp;&nbsp;&nbsp;= stream</span></p>
<p><span class="font19">wait &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= no</span></p>
<p><span class="font19">only_from &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 127.0.0.1</span></p>
<p><span class="font19">user &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= root</span></p>
<p><span class="font19">server &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= /usr/sbin/swat</span></p>
<p><span class="font19">log_on_failure += USERID disable &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= yes</span></p>
<p><span class="font19">} paul@RHELv4u2:~$</span></p>
<p><a name="bookmark5306"></a><span class="font25">The services should be listed in the </span><span class="font25" style="font-weight:bold;">/etc/services </span><span class="font25">file. Port determines the service port, and must be the same as the port specified in /etc/services. The </span><span class="font25" style="font-weight:bold;">socket_type </span><span class="font25">should be set to </span><span class="font25" style="font-weight:bold;">stream </span><span class="font25">for tcp services (and to dgram for udp). The </span><span class="font25" style="font-weight:bold;">log_on_failure += </span><span class="font25">concats the userid to the log message formatted in /etc/xinetd.conf. The last setting </span><span class="font25" style="font-weight:bold;">disable </span><span class="font25">can be set to yes or no. Setting this to </span><span class="font25" style="font-weight:bold;">no </span><span class="font25">means the service is enabled!</span></p>
<p><span class="font25">Check the xinetd and xinetd.conf manual pages for many more configuration options.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5307"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5308"></a>7.4.4. inetd superdaemon</span></h3></li></ul>
<p><a name="bookmark5309"></a><span class="font25">This superdaemon has only one configuration file </span><span class="font25" style="font-weight:bold;">/etc/inetd.conf</span><span class="font25">. Every protocol or daemon that it is listening for, gets one line in this file.</span></p>
<p><span class="font19">root@barry:~# grep ftp /etc/inetd.conf</span></p>
<p><span class="font19">tftp dgram udp wait nobody /usr/sbin/tcpd /usr/sbin/in.tftpd /boot/tftp root@barry:~#</span></p>
<p><span class="font25">You can disable a service in inetd.conf above by putting a # at the start of that line. Here an example of the disabled vmware web interface (listening on tcp port 902).</span></p>
<p><span class="font19">paul@laika:~$ grep vmware /etc/inetd.conf</span></p>
<p><span class="font19">#902 stream tcp nowait root /usr/sbin/vmware-authd vmware-authd</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5310"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4473"></a><a name="bookmark5311"></a>7.5. practice : inetd and xinetd</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Verify on all systems whether they are using xinetd or inetd.</span></p></li>
<li>
<p><span class="font25">2. Look at the configuration files.</span></p></li>
<li>
<p><span class="font25">3. (If telnet is installable, then replace swat in these questions with telnet) Is swat installed ? If not, then install swat and look at the changes in the (x)inetd configuration. Is swat enabled or disabled ?</span></p></li>
<li>
<p><span class="font25">4. Disable swat, test it. Enable swat, test it.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5312"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4474"></a><a name="bookmark5313"></a>7.6. network file system</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark5314"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5315"></a>7.6.1. protocol versions</span></h3></li></ul></li></ul>
<h4><a name="bookmark5316"></a><span class="font25"><a name="bookmark5317"></a><a name="bookmark5318"></a><a name="bookmark5319"></a><a name="bookmark5320"></a><a name="bookmark5321"></a>The older </span><span class="font25" style="font-weight:bold;">nfs </span><span class="font25">versions 2 and 3 are stateless (udp) by default, but they can use tcp. Clients connect to the server using </span><span class="font25" style="font-weight:bold;">rpc </span><span class="font25">(on Linux this is controlled by the </span><span class="font25" style="font-weight:bold;">portmap </span><span class="font25">daemon. Look at </span><span class="font25" style="font-weight:bold;">rpcinfo </span><span class="font25">to verify that </span><span class="font25" style="font-weight:bold;">nfs </span><span class="font25">and its related services are running.</span></h4>
<p><span class="font19">root@RHELv4u2:~# /etc/init.d/portmap status portmap (pid 1920) is running...</span></p>
<p><span class="font19">root@RHELv4u2:~# rpcinfo -p</span></p>
<p><span class="font19">program vers proto port</span></p>
<p><span class="font19">100000 &nbsp;&nbsp;&nbsp;2 &nbsp;&nbsp;tcp &nbsp;&nbsp;&nbsp;111 &nbsp;portmapper</span></p>
<p><span class="font19">100000 &nbsp;&nbsp;&nbsp;2 &nbsp;&nbsp;udp &nbsp;&nbsp;&nbsp;111 &nbsp;portmapper</span></p>
<p><span class="font19">100024 &nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;udp &nbsp;32768 &nbsp;status</span></p>
<p><span class="font19">100024 &nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;tcp &nbsp;32769 &nbsp;status</span></p>
<p><span class="font19">root@RHELv4u2:~# service nfs start Starting NFS services:</span></p>
<div>
<p><span class="font19">[ OK ]</span></p>
<p><span class="font19">[ OK ]</span></p>
<p><span class="font19">[ OK ]</span></p>
<p><span class="font19">[ OK ]</span></p>
</div><br clear="all">
<p><span class="font19">Starting NFS quotas:</span></p>
<p><span class="font19">Starting NFS daemon:</span></p>
<p><span class="font19">Starting NFS mountd:</span></p>
<h4><a name="bookmark5322"></a><span class="font25"><a name="bookmark5323"></a>The same </span><span class="font25" style="font-weight:bold;">rpcinfo </span><span class="font25">command when </span><span class="font25" style="font-weight:bold;">nfs </span><span class="font25">is started.</span></h4>
<p><span class="font19">root@RHELv4u2:~# rpcinfo -p</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">program</span></p></td><td style="vertical-align:top;">
<p><span class="font19">vers</span></p></td><td style="vertical-align:top;">
<p><span class="font19">proto</span></p></td><td colspan="2" style="vertical-align:top;">
<p><span class="font19">port</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100000</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">111</span></p></td><td style="vertical-align:top;">
<p><span class="font19">portmapper</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100000</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">111</span></p></td><td style="vertical-align:top;">
<p><span class="font19">portmapper</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100024</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">32768</span></p></td><td style="vertical-align:top;">
<p><span class="font19">status</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">100024</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">32769</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">status</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">100011</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">985</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">rquotad</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100011</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">985</span></p></td><td style="vertical-align:top;">
<p><span class="font19">rquotad</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100011</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">988</span></p></td><td style="vertical-align:top;">
<p><span class="font19">rquotad</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100011</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">988</span></p></td><td style="vertical-align:top;">
<p><span class="font19">rquotad</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100003</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2049</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nfs</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100003</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2049</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nfs</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100003</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4</span></p></td><td style="vertical-align:top;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2049</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nfs</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100003</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2049</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nfs</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100003</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2049</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nfs</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">100003</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2049</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">nfs</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">100021</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">32770</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">nlockmgr</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100021</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">32770</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nlockmgr</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100021</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4</span></p></td><td style="vertical-align:top;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">32770</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nlockmgr</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100021</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">32789</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nlockmgr</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100021</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">32789</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nlockmgr</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100021</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">32789</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nlockmgr</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100005</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1004</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mountd</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">100005</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1007</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">mountd</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">100005</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1004</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">mountd</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">100005</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1007</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">mountd</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">100005</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1004</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">mountd</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">100005</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1007</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mountd</span></p></td></tr>
</table>
<p><span class="font19">root@RHELv4u2:~#</span></p>
<h4><a name="bookmark5324"></a><span class="font25" style="font-weight:bold;"><a name="bookmark5325"></a><a name="bookmark5326"></a>nfs version 4 </span><span class="font25">requires tcp (port 2049) and supports </span><span class="font25" style="font-weight:bold;">Kerberos </span><span class="font25">user authentication as an option. </span><span class="font25" style="font-weight:bold;">nfs </span><span class="font25">authentication only takes place when mounting the share. </span><span class="font25" style="font-weight:bold;">nfs </span><span class="font25">versions 2 and 3 authenticate only the host.</span></h4>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4729"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5327"></a>7.6.2. server configuration</span></h3></li></ul>
<p><a name="bookmark5328"></a><span class="font25" style="font-weight:bold;"><a name="bookmark5329"></a>nfs </span><span class="font25">is configured in </span><span class="font25" style="font-weight:bold;">/etc/exports</span><span class="font25">. Here is a sample </span><span class="font25" style="font-weight:bold;">/etc/exports </span><span class="font25">to explain the syntax. You need some way (NIS domain or LDAP) to synchronize userid's across computers when using </span><span class="font25" style="font-weight:bold;">nfs </span><span class="font25">a lot. The </span><span class="font25" style="font-weight:bold;">rootsquash </span><span class="font25">option will change UID 0 to the UID of the nfsnobody user account. The </span><span class="font25" style="font-weight:bold;">sync </span><span class="font25">option will write writes to disk before completing the client request.</span></p>
<p><span class="font19">paul@laika:~$ cat /etc/exports # Everyone can read this share /mnt/data/iso *(ro)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Only the computers barry and pasha can readwrite this one /var/www pasha(rw) barry(rw)</span></p></li>
<li>
<p><span class="font19"># same, but without root squashing for barry /var/ftp pasha(rw) barry(rw,no_root_squash)</span></p></li>
<li>
<p><span class="font19"># everyone from the netsec.lan domain gets access /var/backup &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*.netsec.lan(rw)</span></p></li>
<li>
<p><span class="font19"># ro for one network, rw for the other /var/upload 192.168.1.0/24(ro) 192.168.5.0/24(rw)</span></p></li></ul>
<p><a name="bookmark5330"></a><span class="font25"><a name="bookmark5331"></a>You don't need to restart the nfs server to start exporting your newly created exports. You can use the </span><span class="font25" style="font-weight:bold;">exportfs -va </span><span class="font25">command to do this. It will write the exported directories to </span><span class="font25" style="font-weight:bold;">/var/ lib/nfs/etab</span><span class="font25">, where they are immediately applied.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4732"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5332"></a>7.6.3. client configuration</span></h3></li></ul>
<p><a name="bookmark5333"></a><span class="font25"><a name="bookmark5334"></a>We have seen the </span><span class="font25" style="font-weight:bold;">mount </span><span class="font25">command and the </span><span class="font25" style="font-weight:bold;">/etc/fstab </span><span class="font25">file before.</span></p>
<p><span class="font19">root@RHELv4u2:~# mount -t nfs barry:/mnt/data/iso /home/project55/</span></p>
<p><span class="font19">root@RHELv4u2:~# cat /etc/fstab | grep nfs</span></p>
<p><span class="font19">barry:/mnt/data/iso /home/iso &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nfs defaults 0 0</span></p>
<p><span class="font19">root@RHELv4u2:~#</span></p>
<p><span class="font25">Here is another simple example. Suppose the project55 people tell you they only need a couple of CD-ROM images, and you already have them available on an </span><span class="font25" style="font-weight:bold;">nfs </span><span class="font25">server. You could issue the following command to mount this storage on their </span><span class="font25" style="font-weight:bold;">/home/project55 </span><span class="font25">mount point.</span></p>
<p><span class="font19">root@RHELv4u2:~# mount -t nfs 192.168.1.40:/mnt/data/iso /home/project55/ root@RHELv4u2:~# ls -lh /home/project55/ total 3.6G</span></p>
<p><span class="font19">drwxr-xr-x &nbsp;2 1000 1000 4.0K Jan 16 17:55 RHELv4u1</span></p>
<p><span class="font19">drwxr-xr-x &nbsp;2 1000 1000 4.0K Jan 16 14:14 RHELv4u2</span></p>
<p><span class="font19">drwxr-xr-x &nbsp;2 1000 1000 4.0K Jan 16 14:54 RHELv4u3</span></p>
<p><span class="font19">drwxr-xr-x &nbsp;2 1000 1000 4.0K Jan 16 11:09 RHELv4u4</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-r--r-- &nbsp;1 root root 1.6G Oct 13 15:22 sled10-vmwarews5-vm.zip</span></p></li></ul>
<p><span class="font19">root@RHELv4u2:~#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5335"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3253"></a><a name="bookmark5336"></a>7.7. practice : network file system</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create two directories with some files. Use </span><span class="font25" style="font-weight:bold;">nfs </span><span class="font25">to share one of them as read only, the other must be writable. Have your neighbour connect to them to test.</span></p></li>
<li>
<p><span class="font25">2. Investigate the user owner of the files created by your neighbour.</span></p></li>
<li>
<p><span class="font25">3. Protect a share by ip-address or hostname, so only your neighbour can connect.</span></p></li></ul>
<p><a name="bookmark5337"></a><span class="font11" style="font-weight:bold;">Part III. dns server</span></p>
<h3><a name="bookmark5338"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5339"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5340"><span class="font24" style="font-weight:bold;">10. introduction to DNS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5341"><span class="font24">10.1. about dns </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5342"><span class="font24">10.2. dns namespace </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5343"><span class="font24">10.3. caching only servers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5344"><span class="font24">10.4. authoritative dns servers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5345"><span class="font24">10.5. primary and secondary </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5346"><span class="font24">10.6. zone transfers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5347"><span class="font24">10.7. master and slave </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5348"><span class="font24">10.8. SOA record </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5349"><span class="font24">10.9. full or incremental zone transfers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5350"><span class="font24">10.10. DNS cache </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5351"><span class="font24">10.11. forward lookup zone example </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5352"><span class="font24">10.12. example: caching only DNS server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5353"><span class="font24">10.13. example: caching only with forwarder </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5354"><span class="font24">10.14. example: primary authoritative server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5355"><span class="font24">10.15. example: a DNS slave server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5356"><span class="font24">10.16. practice: dns </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5357"><span class="font24">10.17. solution: dns </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5358"><span class="font24" style="font-weight:bold;">11. advanced DNS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5359"><span class="font24">11.1. example: DNS round robin </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5360"><span class="font24">11.2. DNS delegation </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5361"><span class="font24">11.3. example: DNS delegation </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5362"><span class="font24">11.4. example: split-horizon dns </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5363"><span class="font24">11.5. old dns topics </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark5364"></a><span class="font11" style="font-weight:bold;"><a name="bookmark3273"></a><a name="bookmark5365"></a>Chapter 10. introduction to DNS</span></h1></li></ul>
<p><span class="font25" style="font-weight:bold;">dns </span><span class="font25">is a fundamental part of every large computer network. </span><span class="font25" style="font-weight:bold;">dns </span><span class="font25">is used by many network services to translate names into network addresses and to locate services on the network (by name).</span></p>
<p><span class="font25">Whenever you visit a web site, send an e-mail, log on to Active Directory, play Minecraft, chat, or use VoIP, there will be one or (many) more queries to </span><span class="font25" style="font-weight:bold;">dns </span><span class="font25">services.</span></p>
<p><span class="font25">Should </span><span class="font25" style="font-weight:bold;">dns </span><span class="font25">fail at your organization, then the whole network will grind to a halt (unless you hardcoded the network addresses).</span></p>
<p><span class="font25">You will notice that even the largest of organizations benefit greatly from having one </span><span class="font25" style="font-weight:bold;">dns </span><span class="font25">infrastructure. Thus </span><span class="font25" style="font-weight:bold;">dns </span><span class="font25">requires all business units to work together.</span></p>
<p><span class="font25">Even at home, most home modems and routers have builtin </span><span class="font25" style="font-weight:bold;">dns </span><span class="font25">functionality.</span></p>
<p><span class="font25">This module will explain what </span><span class="font25" style="font-weight:bold;">dns </span><span class="font25">actually is and how to set it up using </span><span class="font25" style="font-weight:bold;">Linux </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">bind9</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5366"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4506"></a><a name="bookmark5367"></a>10.1. about dns</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark5368"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5369"></a>10.1.1. name to ip address resolution</span></h3></li></ul></li></ul>
<p><a name="bookmark5370"></a><span class="font25"><a name="bookmark5371"></a>The </span><span class="font25" style="font-weight:bold;">domain name system </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">dns </span><span class="font25">is a service on a tcp/ip network that enables clients to translate names into ip addresses. Actually </span><span class="font25" style="font-weight:bold;">dns </span><span class="font25">is much more than that, but let's keep it simple for now.</span></p>
<p><span class="font25">When you use a browser to go to a website, then you type the name of that website in the url bar. But for your computer to actually communicate with the web server hosting said website, your computer needs the ip address of that web server. That is where </span><span class="font25" style="font-weight:bold;">dns </span><span class="font25">comes in.</span></p>
<p><span class="font25">Where is google.com ?</span></p><img src="linux_guide_files/The Complete Linux Guide-105.jpg" alt="" style="width:377pt;height:138pt;">
<p><span class="font25">In wireshark you can use the </span><span class="font25" style="font-weight:bold;">dns </span><span class="font25">filter to see this traffic.</span></p><img src="linux_guide_files/The Complete Linux Guide-106.jpg" alt="" style="width:413pt;height:54pt;">
<ul style="list-style:none;"><li>
<h3><a name="bookmark1270"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5372"></a>10.1.2. history</span></h3></li></ul>
<p><a name="bookmark5373"></a><span class="font25">In the Seventies, only a few hundred computers were connected to the internet. To resolve names, computers had a flat file that contained a table to resolve hostnames to ip addresses.</span></p>
<p><span class="font25">This local file was downloaded from </span><span class="font25" style="font-weight:bold;">hosts.txt </span><span class="font25">on an ftp server in Stanford.</span></p>
<p><a name="bookmark5374"></a><span class="font25">In 1984 </span><span class="font25" style="font-weight:bold;">Paul Mockapetris </span><span class="font25">created </span><span class="font25" style="font-weight:bold;">dns</span><span class="font25">, a distributed treelike hierarchical database that will be explained in detail in these chapters.</span></p>
<p><a name="bookmark5375"></a><span class="font25"><a name="bookmark5376"></a>Today, </span><span class="font25" style="font-weight:bold;">dns </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">domain name system </span><span class="font25">is a worldwide distributed hierarchical database controlled by </span><span class="font25" style="font-weight:bold;">ICANN</span><span class="font25">. Its primary function is to resolve names to ip addresses, and to point to internet servers providing </span><span class="font25" style="font-weight:bold;">smtp </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">ldap </span><span class="font25">services.</span></p>
<p><span class="font25">The old </span><span class="font25" style="font-weight:bold;">hosts.txt </span><span class="font25">file is still active today on most computer systems under the name </span><span class="font25" style="font-weight:bold;">/etc/ hosts </span><span class="font25">(or C:/Windows/System32/Drivers/etc/hosts). We will discuss this file later, as it can influence name resolution.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5377"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5378"></a>10.1.3. forward and reverse lookup queries</span></h3></li></ul>
<h4><a name="bookmark5379"></a><span class="font25"><a name="bookmark5380"></a><a name="bookmark5381"></a><a name="bookmark5382"></a>The question a client asks a dns server is called a </span><span class="font25" style="font-weight:bold;">query</span><span class="font25">. When a client queries for an ip address, this is called a </span><span class="font25" style="font-weight:bold;">forward lookup query </span><span class="font25">(as seen in the previous drawing).</span></h4>
<h4><a name="bookmark5383"></a><span class="font25"><a name="bookmark5384"></a><a name="bookmark5385"></a>The reverse, a query for the name of a host, is called a </span><span class="font25" style="font-weight:bold;">reverse lookup query</span><span class="font25">.</span></h4>
<h4><a name="bookmark5386"></a><span class="font25"><a name="bookmark5387"></a>Below a picture of a </span><span class="font25" style="font-weight:bold;">reverse lookup query</span><span class="font25">.</span></h4><img src="linux_guide_files/The Complete Linux Guide-107.jpg" alt="" style="width:382pt;height:125pt;">
<h4><a name="bookmark5388"></a><span class="font25"><a name="bookmark5389"></a>212.71.8.10</span></h4>
<h4><a name="bookmark5390"></a><span class="font25"><a name="bookmark5391"></a><a name="bookmark5392"></a>Here is a screenshot of a </span><span class="font25" style="font-weight:bold;">reverse lookup query </span><span class="font25">in </span><span class="font25" style="font-weight:bold;">nslookup</span><span class="font25">.</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">nslookup</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">&gt; set type=PTR &gt;&nbsp;188.93.155.87 Server: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;192.168.1.42</span></p></li></ul>
<p><span class="font19">Address: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;192.168.1.42#53</span></p>
<p><span class="font19">Non-authoritative answer:</span></p>
<p><span class="font19">87.155.93.188.in-addr.arpa name = antares.ginsys.net.</span></p>
<h4><a name="bookmark5393"></a><span class="font25"><a name="bookmark5394"></a><a name="bookmark5395"></a>This is what a reverse lookup looks like when sniffing with </span><span class="font25" style="font-weight:bold;">tcpdump</span><span class="font25">.</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">tcpdump udp port 53</span></p>
<p><span class="font19">tcpdump: verbose output suppressed, use -v or -vv for full protocol decode listening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes 11:01:29.357685 IP 192.168.1.103.42041 &gt;&nbsp;192.168.1.42.domain: 14763+ PT\ R? 87.155.93.188.in-addr.arpa. (44) 11:01:29.640093 IP 192.168.1.42.domain &gt;&nbsp;192.168.1.103.42041: 14763 1/0\ /0 PTR antares.ginsys.net. (76)</span></p>
<h4><a name="bookmark5396"></a><span class="font25"><a name="bookmark5397"></a>And here is what it looks like in </span><span class="font25" style="font-weight:bold;">wireshark </span><span class="font25">(note this is an older screenshot).</span></h4><img src="linux_guide_files/The Complete Linux Guide-108.jpg" alt="" style="width:426pt;height:55pt;">
<ul style="list-style:none;"><li>
<h3><a name="bookmark5398"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5399"></a>10.1.4. /etc/resolv.conf</span></h3></li></ul>
<p><a name="bookmark5400"></a><span class="font25"><a name="bookmark5401"></a>A client computer needs to know the ip address of the </span><span class="font25" style="font-weight:bold;">dns server </span><span class="font25">to be able to send queries to it. This is either provided by a </span><span class="font25" style="font-weight:bold;">dhcp server </span><span class="font25">or manually entered.</span></p>
<p><a name="bookmark5402"></a><span class="font25">Linux clients keep this information in the </span><span class="font25" style="font-weight:bold;">/etc/resolv.conf </span><span class="font25">file.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">cat /etc/resolv.conf </span><span class="font19">domain linux-training.be search linux-training.be nameserver 192.168.1.42</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<p><span class="font25">You can manually change the ip address in this file to use another </span><span class="font25" style="font-weight:bold;">dns </span><span class="font25">server. For example Google provides a public name server at 8.8.8.8 and 8.8.4.4.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">cat /etc/resolv.conf </span><span class="font19">nameserver 8.8.8.8 root@debian7:~#</span></p>
<p><span class="font25">Please note that on </span><span class="font25" style="font-weight:bold;">dhcp clients </span><span class="font25">this value can be overwritten when the </span><span class="font25" style="font-weight:bold;">dhcp lease </span><span class="font25">is renewed.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5403"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4507"></a><a name="bookmark5404"></a>10.2. dns namespace</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark5405"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5406"></a>10.2.1. hierarchy</span></h3></li></ul></li></ul>
<p><a name="bookmark5407"></a><span class="font25"><a name="bookmark5408"></a>The </span><span class="font25" style="font-weight:bold;">dns namespace </span><span class="font25">is hierarchical tree structure, with the </span><span class="font25" style="font-weight:bold;">root servers </span><span class="font25">(aka dot-servers) at the top. The </span><span class="font25" style="font-weight:bold;">root servers </span><span class="font25">are usually represented by a dot.</span></p><img src="linux_guide_files/The Complete Linux Guide-109.jpg" alt="" style="width:284pt;height:260pt;">
<p><span class="font25">Below the </span><span class="font25" style="font-weight:bold;">root-servers </span><span class="font25">are the </span><span class="font25" style="font-weight:bold;">Top Level Domains </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">tld</span><span class="font25">'s.</span></p>
<p><span class="font25">There are more </span><span class="font25" style="font-weight:bold;">tld</span><span class="font25">'s than shown in the picture. Currently about 200 countries have a </span><span class="font25" style="font-weight:bold;">tld</span><span class="font25">. And there are several general </span><span class="font25" style="font-weight:bold;">tld</span><span class="font25">'s like .com, .edu, .org, .gov, .net, .mil, .int and more recently also .aero, .info, .museum, ...</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5409"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5410"></a>10.2.2. root servers</span></h3></li></ul>
<p><a name="bookmark5411"></a><span class="font25">There are thirteen </span><span class="font25" style="font-weight:bold;">root servers </span><span class="font25">on the internet, they are named </span><span class="font25" style="font-weight:bold;">A </span><span class="font25">to </span><span class="font25" style="font-weight:bold;">M</span><span class="font25">. Journalists often refer to these servers as </span><span class="font25" style="font-weight:bold;">the master servers of the internet</span><span class="font25">, because if these servers go down, then nobody can (use names to) connect to websites.</span></p>
<p><span class="font25">The root servers are not thirteen physical machines, they are many more. For example the </span><span class="font25" style="font-weight:bold;">F </span><span class="font25">root server consists of 46 physical machines that all behave as one (using anycast).</span></p>
<p><a href="http://root-servers.org"><span class="font19">http://root-servers.org</span></a></p>
<p><a href="http://f.root-servers.org"><span class="font19">http://f.root-servers.org</span></a></p>
<p><a href="http://en.wikipedia.org/wiki/Root_nameserver"><span class="font19">http://en.wikipedia.org/wiki/Root_nameserver</span></a><span class="font19">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5412"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5413"></a>10.2.3. root hints</span></h3></li></ul>
<h4><a name="bookmark5414"></a><span class="font25"><a name="bookmark5415"></a><a name="bookmark5416"></a>Every </span><span class="font25" style="font-weight:bold;">dns server software </span><span class="font25">will come with a list of </span><span class="font25" style="font-weight:bold;">root hints </span><span class="font25">to locate the </span><span class="font25" style="font-weight:bold;">root servers</span><span class="font25">.</span><br><br><a name="bookmark5417"></a><span class="font25"><a name="bookmark5418"></a>This screenshot shows a small portion of the root hints file that comes with </span><span class="font25" style="font-weight:bold;">bind 9.8.4</span><span class="font25">.</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19" style="font-weight:bold;">-w</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19" style="font-weight:bold;">'A ' /etc/bind/db.</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19" style="font-weight:bold;">. root</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">A.ROOT-SERVERS.NET.</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">3600000</span></p></td><td style="vertical-align:top;">
<p><span class="font19">A</span></p></td><td style="vertical-align:top;">
<p><span class="font19">198.41.0.4</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">B.ROOT-SERVERS.NET.</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">3600000</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">A</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">192.228.79.201</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">C.ROOT-SERVERS.NET.</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">3600000</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">A</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">192.33.4.12</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">D.ROOT-SERVERS.NET.</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">3600000</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">A</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">199.7.91.13</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">E.ROOT-SERVERS.NET.</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">3600000</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">A</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">192.203.230.10</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">F.ROOT-SERVERS.NET.</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">3600000</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">A</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">192.5.5.241</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">G.ROOT-SERVERS.NET.</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">3600000</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">A</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">192.112.36.4</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">H.ROOT-SERVERS.NET.</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">3600000</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">A</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">128.63.2.53</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">I.ROOT-SERVERS.NET.</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">3600000</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">A</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">192.36.148.17</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">J.ROOT-SERVERS.NET.</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">3600000</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">A</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">192.58.128.30</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">K.ROOT-SERVERS.NET.</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">3600000</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">A</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">193.0.14.129</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">L.ROOT-SERVERS.NET.</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">3600000</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">A</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">199.7.83.42</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">M.ROOT-SERVERS.NET. root@debian7:~#</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">3600000</span></p></td><td style="vertical-align:top;">
<p><span class="font19">A</span></p></td><td style="vertical-align:top;">
<p><span class="font19">202.12.27.33</span></p></td></tr>
</table>
<h3><a name="bookmark5419"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5420"></a>10.2.4. domains</span></h3>
<h4><a name="bookmark5421"></a><span class="font25"><a name="bookmark5422"></a><a name="bookmark5423"></a>One level below the </span><span class="font25" style="font-weight:bold;">top level domains </span><span class="font25">are the </span><span class="font25" style="font-weight:bold;">domains</span><span class="font25">. Domains can have subdomains (also called child domains).</span></h4>
<h4><a name="bookmark5424"></a><span class="font25"><a name="bookmark5425"></a>This picture shows </span><span class="font25" style="font-weight:bold;">dns domains </span><span class="font25">like google.com, chess.com, linux-training.be (there are millions more).</span></h4><img src="linux_guide_files/The Complete Linux Guide-110.jpg" alt="" style="width:384pt;height:220pt;">
<h4><a name="bookmark5426"></a><span class="font25"><a name="bookmark5427"></a>DNS domains are registered at the </span><span class="font25" style="font-weight:bold;">tld </span><span class="font25">servers, the </span><span class="font25" style="font-weight:bold;">tld </span><span class="font25">servers are registered at the </span><span class="font25" style="font-weight:bold;">dot servers</span><span class="font25">.</span></h4>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4675"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5428"></a>10.2.5. top level domains</span></h3></li></ul>
<p><a name="bookmark5429"></a><span class="font25"><a name="bookmark5430"></a><a name="bookmark5431"></a>Below the root level are the </span><span class="font25" style="font-weight:bold;">top level domains </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">tld's</span><span class="font25">. Originally there were only seven defined:</span></p>
<p><span class="font25" style="font-weight:bold;">Table 10.1. the first top level domains</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font24" style="font-weight:bold;">year</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24" style="font-weight:bold;">TLD</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24" style="font-weight:bold;">purpose</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">1985</span></p></td><td style="vertical-align:top;">
<p><span class="font24">.arpa</span></p></td><td style="vertical-align:top;">
<p><span class="font24">Reverse lookup via in-addr.arpa</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">1985</span></p></td><td style="vertical-align:top;">
<p><span class="font24">.com</span></p></td><td style="vertical-align:top;">
<p><span class="font24">Commercial Organizations</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">1985</span></p></td><td style="vertical-align:top;">
<p><span class="font24">.edu</span></p></td><td style="vertical-align:top;">
<p><span class="font24">US Educational Institutions</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">1985</span></p></td><td style="vertical-align:top;">
<p><span class="font24">.gov</span></p></td><td style="vertical-align:top;">
<p><span class="font24">US Government Institutions</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">1985</span></p></td><td style="vertical-align:top;">
<p><span class="font24">.mil</span></p></td><td style="vertical-align:top;">
<p><span class="font24">US Military</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">1985</span></p></td><td style="vertical-align:top;">
<p><span class="font24">.net</span></p></td><td style="vertical-align:top;">
<p><span class="font24">Internet Service Providers, Internet Infrastructure</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">1985</span></p></td><td style="vertical-align:top;">
<p><span class="font24">.org</span></p></td><td style="vertical-align:top;">
<p><span class="font24">Non profit Organizations</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">1988</span></p></td><td style="vertical-align:top;">
<p><span class="font24">.int</span></p></td><td style="vertical-align:top;">
<p><span class="font24">International Treaties like nato.int</span></p></td></tr>
</table>
<p><a name="bookmark5432"></a><span class="font25">Country </span><span class="font25" style="font-weight:bold;">tld</span><span class="font25">'s were defined for individual countries, like </span><span class="font25" style="font-weight:bold;">.uk </span><span class="font25">in 1985 for Great Britain (yes really), </span><span class="font25" style="font-weight:bold;">.be </span><span class="font25">for Belgium in 1988 and </span><span class="font25" style="font-weight:bold;">.fr </span><span class="font25">for France in 1986. See RFC 1591 for more info.</span></p>
<p><a name="bookmark5433"></a><span class="font25">In 1998 seven new general purpose </span><span class="font25" style="font-weight:bold;">tld</span><span class="font25">'s where chosen, they became active in the 21st century.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 10.2. new general purpose tld's</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font24" style="font-weight:bold;">year</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24" style="font-weight:bold;">TLD</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24" style="font-weight:bold;">purpose</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">2002</span></p></td><td style="vertical-align:top;">
<p><span class="font24">.aero</span></p></td><td style="vertical-align:top;">
<p><span class="font24">aviation related</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">2001</span></p></td><td style="vertical-align:top;">
<p><span class="font24">.biz</span></p></td><td style="vertical-align:top;">
<p><span class="font24">businesses</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">2001</span></p></td><td style="vertical-align:top;">
<p><span class="font24">.coop</span></p></td><td style="vertical-align:top;">
<p><span class="font24">for co-operatives</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">2001</span></p></td><td style="vertical-align:top;">
<p><span class="font24">.info</span></p></td><td style="vertical-align:top;">
<p><span class="font24">informative internet resources</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">2001</span></p></td><td style="vertical-align:top;">
<p><span class="font24">.museum</span></p></td><td style="vertical-align:top;">
<p><span class="font24">for museums</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">2001</span></p></td><td style="vertical-align:top;">
<p><span class="font24">.name</span></p></td><td style="vertical-align:top;">
<p><span class="font24">for all kinds of names, pseudonyms and labels...</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">2004</span></p></td><td style="vertical-align:top;">
<p><span class="font24">.pro</span></p></td><td style="vertical-align:top;">
<p><span class="font24">for professionals</span></p></td></tr>
</table>
<p><span class="font25">Many people were surprised by the choices, claiming not much use for them and wanting a separate </span><span class="font25" style="font-weight:bold;">.xxx </span><span class="font25">domain (introduced in 2011) for adult content, and </span><span class="font25" style="font-weight:bold;">.kidz </span><span class="font25">a save haven for children. In the meantime more useless </span><span class="font25" style="font-weight:bold;">tld</span><span class="font25">'s were create like </span><span class="font25" style="font-weight:bold;">.travel </span><span class="font25">(for travel agents) and </span><span class="font25" style="font-weight:bold;">.tel </span><span class="font25">(for internet communications) and </span><span class="font25" style="font-weight:bold;">.jobs </span><span class="font25">(for jobs sites).</span></p>
<p><span class="font25">In 2012 </span><span class="font25" style="font-weight:bold;">ICANN </span><span class="font25">released a list of 2000 new </span><span class="font25" style="font-weight:bold;">tld</span><span class="font25">'s that would gradually become available.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5434"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5435"></a>10.2.6. fully qualified domain name</span></h3></li></ul>
<p><a name="bookmark5436"></a><span class="font25"><a name="bookmark5437"></a>The </span><span class="font25" style="font-weight:bold;">fully qualified domain name </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">fqdn </span><span class="font25">is the combination of the </span><span class="font25" style="font-weight:bold;">hostname </span><span class="font25">of a machine appended with its </span><span class="font25" style="font-weight:bold;">domain name</span><span class="font25">.</span></p>
<p><span class="font25">If for example a system is called </span><span class="font25" style="font-weight:bold;">gwen </span><span class="font25">and it is in the domain </span><span class="font25" style="font-weight:bold;">linux-training.be</span><span class="font25">, then the fqdn of this system is </span><span class="font25" style="font-weight:bold;">gwen.linux-training.be</span><span class="font25">.</span></p>
<p><a name="bookmark5438"></a><span class="font25"><a name="bookmark5439"></a>On Linux systems you can use the </span><span class="font25" style="font-weight:bold;">hostname </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">dnsdomainname </span><span class="font25">commands to verify this information.</span></p>
<p><span class="font19">root@gwen:~# </span><span class="font19" style="font-weight:bold;">hostname</span></p>
<p><span class="font19">gwen</span></p>
<p><span class="font19">root@gwen:~# </span><span class="font19" style="font-weight:bold;">dnsdomainname</span></p>
<p><span class="font19">linux-training.be</span></p>
<p><span class="font19">root@gwen:~# </span><span class="font19" style="font-weight:bold;">hostname --fqdn</span></p>
<p><span class="font19">gwen.linux-training.be</span></p>
<p><span class="font19">root@gwen:~# </span><span class="font19" style="font-weight:bold;">cat /etc/debian_version</span></p>
<p><span class="font19">6.0.10</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5440"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5441"></a>10.2.7. dns zones</span></h3></li></ul>
<p><a name="bookmark5442"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">zone </span><span class="font25">(aka a </span><span class="font25" style="font-weight:bold;">zone of authority</span><span class="font25">) is a portion of the DNS tree that covers one domain name or child domain name. The picture below represents zones as blue ovals. Some zones will contain delegate authority over a child domain to another zone.</span></p><img src="linux_guide_files/The Complete Linux Guide-111.jpg" alt="" style="width:378pt;height:254pt;">
<p><span class="font26">&quot;chess.com&quot;</span></p>
<p><span class="font26">&quot;linux-training.be&quot;</span></p>
<p><span class="font26">&quot;test.linux-training.be&quot;</span></p>
<p><a name="bookmark5443"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">dns server </span><span class="font25">can be </span><span class="font25" style="font-weight:bold;">authoritative </span><span class="font25">over 0, 1 or more </span><span class="font25" style="font-weight:bold;">dns zones</span><span class="font25">. We will see more details later on the relation between a </span><span class="font25" style="font-weight:bold;">dns server </span><span class="font25">and a </span><span class="font25" style="font-weight:bold;">dns zone</span><span class="font25">.</span></p>
<p><span class="font25">A </span><span class="font25" style="font-weight:bold;">dns zone </span><span class="font25">consists of </span><span class="font25" style="font-weight:bold;">records</span><span class="font25">, also called </span><span class="font25" style="font-weight:bold;">resource records</span><span class="font25">. We will list some of those </span><span class="font25" style="font-weight:bold;">resource records </span><span class="font25">on the next page.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5348"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5444"></a>10.2.8. dns records</span></h3></li></ul>
<p><span class="font7" style="font-weight:bold;">A record</span></p>
<p><a name="bookmark5445"></a><span class="font25"><a name="bookmark5446"></a><a name="bookmark5447"></a>The </span><span class="font25" style="font-weight:bold;">A record</span><span class="font25">, which is also called a </span><span class="font25" style="font-weight:bold;">host record </span><span class="font25">contains the ipv4-address of a computer. When a DNS client queries a DNS server for an A record, then the DNS server will resolve the hostname in the query to an ip address. An </span><span class="font25" style="font-weight:bold;">AAAA record </span><span class="font25">is similar but contains an ipv6 address instead of ipv4.</span></p>
<p><span class="font7" style="font-weight:bold;">PTR record</span></p>
<p><a name="bookmark5448"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">PTR record </span><span class="font25">is the reverse of an A record. It contains the name of a computer and can be used to resolve an ip address to a hostname.</span></p>
<p><span class="font7" style="font-weight:bold;">NS record</span></p>
<p><a name="bookmark5449"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">NS record </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">nameserver record </span><span class="font25">is a record that points to a DNS name server (in this zone). You can list all your name servers for your DNS zone in distinct NS records.</span></p>
<p><span class="font7" style="font-weight:bold;">glue A record</span></p>
<p><a name="bookmark5450"></a><span class="font25">An A record that maps the name of an NS record to an ip address is said to be a </span><span class="font25" style="font-weight:bold;">glue record</span><span class="font25">.</span></p>
<p><span class="font7" style="font-weight:bold;">SOA record</span></p>
<p><span class="font25">The SOA record of a zone contains meta information about the zone itself. The contents of the SOA record is explained in detail in the section about zone transfers. There is exactly one SOA record for each zone.</span></p>
<p><span class="font7" style="font-weight:bold;">CNAME record</span></p>
<p><a name="bookmark5451"></a><span class="font25"><a name="bookmark5452"></a>A </span><span class="font25" style="font-weight:bold;">CNAME record </span><span class="font25">maps a hostname to a hostname, creating effectively an alias for an existing hostname. The name of the mail server is often aliased to </span><span class="font25" style="font-weight:bold;">mail </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">smtp</span><span class="font25">, and the name of a web server to </span><span class="font25" style="font-weight:bold;">www</span><span class="font25">.</span></p>
<p><span class="font7" style="font-weight:bold;">MX record</span></p>
<p><a name="bookmark5453"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">MX </span><span class="font25">record points to an </span><span class="font25" style="font-weight:bold;">smtp server</span><span class="font25">. When you send an email to another domain, then your mail server will need the MX record of the target domain's mail server.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5454"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4508"></a><a name="bookmark5455"></a>10.3. caching only servers</span></h2></li></ul>
<p><a name="bookmark5456"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">dns server </span><span class="font25">that is set up without </span><span class="font25" style="font-weight:bold;">authority </span><span class="font25">over a </span><span class="font25" style="font-weight:bold;">zone</span><span class="font25">, but that is connected to other name servers and caches the queries is called a </span><span class="font25" style="font-weight:bold;">caching only name server</span><span class="font25">. Caching only name servers do not have a </span><span class="font25" style="font-weight:bold;">zone database </span><span class="font25">with resource records. Instead they connect to other name servers and cache that information.</span></p>
<p><span class="font25">There are two kinds of caching only name servers. Those with a </span><span class="font25" style="font-weight:bold;">forwarder</span><span class="font25">, and those that use the </span><span class="font25" style="font-weight:bold;">root servers</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5457"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5458"></a>10.3.1. caching only server without forwarder</span></h3></li></ul>
<p><a name="bookmark5459"></a><span class="font25">A caching only server without forwarder will have to get information elsewhere. When it receives a query from a client, then it will consult one of the </span><span class="font25" style="font-weight:bold;">root servers</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">root server </span><span class="font25">will refer it to a </span><span class="font25" style="font-weight:bold;">tld </span><span class="font25">server, which will refer it to another </span><span class="font25" style="font-weight:bold;">dns </span><span class="font25">server. That last server might know the answer to the query, or may refer to yet another server. In the end, our hard working </span><span class="font25" style="font-weight:bold;">dns </span><span class="font25">server will find an answer and report this back to the client.</span></p>
<p><span class="font25">In the picture below, the clients asks for the ip address of linux-training.be. Our caching only server will contact the root server, and be refered to the .be server. It will then contact the .be server and be refered to one of the name servers of Openminds. One of these name servers (in this cas ns1.openminds.be) will answer the query with the ip address of linux-training.be. When our caching only server reports this to the client, then the client can connect to this website.</span></p><img src="linux_guide_files/The Complete Linux Guide-112.jpg" alt="" style="width:403pt;height:182pt;">
<p><span class="font25">Sniffing with </span><span class="font25" style="font-weight:bold;">tcpdump </span><span class="font25">will give you this (the first 20 characters of each line are cut).</span></p>
<p><span class="font19">192.168.1.103.41251 &gt;&nbsp;M.ROOT-SERVERS.NET.domain: 37279% [1au] A? linux-tr\ aining.be. (46)</span></p>
<p><span class="font19">M.ROOT-SERVERS.NET.domain &gt;&nbsp;192.168.1.103.41251: 37279- 0/11/13 (740)</span></p>
<p><span class="font19">192.168.1.103.65268 &gt;&nbsp;d.ns.dns.be.domain: 38555% [1au] A? linux-training.\ be. (46)</span></p>
<p><span class="font19">d.ns.dns.be.domain &gt;&nbsp;192.168.1.103.65268: 38555- 0/7/5 (737)</span></p>
<p><span class="font19">192.168.1.103.7514 &gt;&nbsp;ns2.openminds.be.domain: 60888% [1au] A? linux-train\ ing.be. (46)</span></p>
<p><span class="font19">ns2.openminds.be.domain &gt;&nbsp;192.168.1.103.7514: 60888*- 1/0/1 A 188.93.155.\ 87 (62)</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5460"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5461"></a>10.3.2. caching only server with forwarder</span></h3></li></ul>
<p><a name="bookmark5462"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">caching only server </span><span class="font25">with a </span><span class="font25" style="font-weight:bold;">forwarder </span><span class="font25">is a DNS server that will get all its information from the </span><span class="font25" style="font-weight:bold;">forwarder</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">forwarder </span><span class="font25">must be a </span><span class="font25" style="font-weight:bold;">dns server </span><span class="font25">for example the </span><span class="font25" style="font-weight:bold;">dns server </span><span class="font25">of an </span><span class="font25" style="font-weight:bold;">internet service provider</span><span class="font25">.</span></p><img src="linux_guide_files/The Complete Linux Guide-113.jpg" alt="" style="width:401pt;height:123pt;">
<p><span class="font25">This picture shows a </span><span class="font25" style="font-weight:bold;">dns server </span><span class="font25">on the company LAN that has set the </span><span class="font25" style="font-weight:bold;">dns server </span><span class="font25">from their </span><span class="font25" style="font-weight:bold;">isp </span><span class="font25">as a </span><span class="font25" style="font-weight:bold;">forwarder</span><span class="font25">. If the ip address of the </span><span class="font25" style="font-weight:bold;">isp dns server </span><span class="font25">is 212.71.8.10, then the following lines would occur in the </span><span class="font25" style="font-weight:bold;">named.conf </span><span class="font25">file of the company </span><span class="font25" style="font-weight:bold;">dns server</span><span class="font25">: </span><span class="font19">forwarders {</span></p>
<p><span class="font19">212.71.8.10;</span></p>
<p><span class="font19">};</span></p>
<p><span class="font25">You can also configure your </span><span class="font25" style="font-weight:bold;">dns server </span><span class="font25">to work with </span><span class="font25" style="font-weight:bold;">conditional forwarder(s)</span><span class="font25">. The definition of a conditional forwarder looks like this.</span></p>
<p><span class="font19">zone &quot;someotherdomain.local&quot; {</span></p>
<p><span class="font19">type forward;</span></p>
<p><span class="font19">forward only;</span></p>
<p><span class="font19">forwarders { 10.104.42.1; };</span></p>
<p><span class="font19">};</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5463"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5464"></a>10.3.3. iterative or recursive query</span></h3></li></ul>
<p><a name="bookmark5465"></a><span class="font25"><a name="bookmark5466"></a>A </span><span class="font25" style="font-weight:bold;">recursive query </span><span class="font25">is a DNS query where the client that is submitting the query expects a complete answer (Like the fat red arrow above going from the Macbook to the DNS server). An </span><span class="font25" style="font-weight:bold;">iterative query </span><span class="font25">is a DNS query where the client does not expect a complete answer (the three black arrows originating from the DNS server in the picture above). Iterative queries usually take place between name servers. The root name servers do not respond to recursive queries.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5467"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4509"></a><a name="bookmark5468"></a>10.4. authoritative dns servers</span></h2></li></ul>
<p><a name="bookmark5469"></a><span class="font25"><a name="bookmark5470"></a>A DNS server that is controlling a zone, is said to be the </span><span class="font25" style="font-weight:bold;">authoritative </span><span class="font25">DNS server for that zone. Remember that a </span><span class="font25" style="font-weight:bold;">zone </span><span class="font25">is a collection of </span><span class="font25" style="font-weight:bold;">resource records</span><span class="font25">.</span></p><img src="linux_guide_files/The Complete Linux Guide-114.jpg" alt="" style="width:223pt;height:118pt;">
<ul style="list-style:none;"><li>
<h2><a name="bookmark5471"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4510"></a><a name="bookmark5472"></a>10.5. primary and secondary</span></h2></li></ul>
<p><a name="bookmark5473"></a><span class="font25"><a name="bookmark5474"></a>When you set up the first </span><span class="font25" style="font-weight:bold;">authoritative </span><span class="font25">dns server for a zone, then this is called the </span><span class="font25" style="font-weight:bold;">primary dns server</span><span class="font25">. This server will have a readable and writable copy of the </span><span class="font25" style="font-weight:bold;">zone database</span><span class="font25">. For reasons of fault tolerance, performance or load balancing you may decide to set up another </span><span class="font25" style="font-weight:bold;">dns server </span><span class="font25">with authority over that zone. This is called a </span><span class="font25" style="font-weight:bold;">secondary </span><span class="font25">dns server.</span></p><img src="linux_guide_files/The Complete Linux Guide-115.jpg" alt="" style="width:403pt;height:97pt;">
<ul style="list-style:none;"><li>
<h2><a name="bookmark5475"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4511"></a><a name="bookmark5476"></a>10.6. zone transfers</span></h2></li></ul>
<p><a name="bookmark5477"></a><span class="font25"><a name="bookmark5478"></a>The slave server receives a copy of the zone database from the master server using a </span><span class="font25" style="font-weight:bold;">zone transfer</span><span class="font25">. Zone transfers are requested by the slave servers at regular intervals. Those intervals are defined in the </span><span class="font25" style="font-weight:bold;">soa record</span><span class="font25">.</span></p><img src="linux_guide_files/The Complete Linux Guide-116.jpg" alt="" style="width:298pt;height:104pt;">
<p><span class="font25">You can force a refresh from a zone with </span><span class="font25" style="font-weight:bold;">rndc</span><span class="font25">. The example below force a transfer of the </span><span class="font25" style="font-weight:bold;">fred.local </span><span class="font25">zone, and shows the log from </span><span class="font25" style="font-weight:bold;">/var/log/syslog</span><span class="font25">.</span></p>
<p><span class="font19">root@debian7:/etc/bind# </span><span class="font19" style="font-weight:bold;">rndc refresh fred.local</span></p>
<p><span class="font19">root@debian7:/etc/bind# </span><span class="font19" style="font-weight:bold;">grep fred /var/log/syslog | tail -7 | cut -c38-</span><span class="font19">zone fred.local/IN: sending notifies (serial 1) received control channel command 'refresh fred.local' zone fred.local/IN: Transfer started.</span></p>
<p><span class="font19">transfer of 'fred.local/IN' from 10.104.109.1#53: connected using 10.104.33.30#57367</span></p>
<p><span class="font19">zone fred.local/IN: transferred serial 2</span></p>
<p><span class="font19">transfer of 'fred.local/IN' from 10.104.109.1#53: Transfer completed: 1 messages, 10 records, zone fred.local/IN: sending notifies (serial 2) root@debian7:/etc/bind#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5479"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4512"></a><a name="bookmark5480"></a>10.7. master and slave</span></h2></li></ul>
<p><a name="bookmark5481"></a><span class="font25"><a name="bookmark5482"></a><a name="bookmark5483"></a>When addin<a name="bookmark5484"></a>g a </span><span class="font25" style="font-weight:bold;">secondary dns server </span><span class="font25">to a zone, then you will configure this server as a </span><span class="font25" style="font-weight:bold;">slave server </span><span class="font25">to the </span><span class="font25" style="font-weight:bold;">primary server</span><span class="font25">. The primary server then becomes the </span><span class="font25" style="font-weight:bold;">master server </span><span class="font25">of the slave server.</span></p>
<p><span class="font25">Often the </span><span class="font25" style="font-weight:bold;">primary dns server </span><span class="font25">is the </span><span class="font25" style="font-weight:bold;">master </span><span class="font25">server of all slaves. Sometimes a </span><span class="font25" style="font-weight:bold;">slave server </span><span class="font25">is </span><span class="font25" style="font-weight:bold;">master server </span><span class="font25">for a second line slave server. In the picture below ns1 is the primary dns server and ns2, ns3 and ns4 are secondaries. The master for slaves ns2 and ns3 is ns1, but the master for ns4 is ns2.</span></p><img src="linux_guide_files/The Complete Linux Guide-117.jpg" alt="" style="width:404pt;height:165pt;">
<ul style="list-style:none;"><li>
<h2><a name="bookmark5485"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4513"></a><a name="bookmark5486"></a>10.8. SOA record</span></h2></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">soa record </span><span class="font25">contains a </span><span class="font25" style="font-weight:bold;">refresh </span><span class="font25">value. If this is set to 30 minutes, then the slave server will request a copy of the zone file every 30 minutes. There is also a </span><span class="font25" style="font-weight:bold;">retry </span><span class="font25">value. The retry value is used when the master server did not reply to the last zone transfer request. The value for </span><span class="font25" style="font-weight:bold;">expiry time </span><span class="font25">says how long the slave server will answer to queries, without receiving a zone update.</span></p>
<p><span class="font25">Below an example of how to use nslookup to query the </span><span class="font25" style="font-weight:bold;">soa record </span><span class="font25">of a zone (linux-training.be).</span></p>
<p><span class="font19">root@debian6:~# </span><span class="font19" style="font-weight:bold;">nslookup</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">&gt;</span><span class="font19" style="font-weight:bold;"> set type=SOA</span></p></li>
<li>
<p><span class="font19">&gt;</span><span class="font19" style="font-weight:bold;"> server ns1.openminds.be</span></p></li>
<li>
<p><span class="font19">&gt;</span><span class="font19" style="font-weight:bold;"> linux-training.be</span></p></li></ul>
<p><span class="font19">Server: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ns1.openminds.be</span></p>
<p><span class="font19">Address: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;195.47.215.14#53</span></p>
<p><span class="font19">linux-training.be</span></p>
<p><span class="font19">origin = ns1.openminds.be</span></p>
<p><span class="font19">mail addr = hostmaster.openminds.be serial = 2321001133 refresh = 14400 retry = 3600 expire = 604800 minimum = 3600</span></p>
<p><span class="font25">Zone transfers only occur when the zone database was updated (meaning when one or more resource records were added, removed or changed on the master server). The slave server will compare the </span><span class="font25" style="font-weight:bold;">serial number </span><span class="font25">of its own copy of the SOA record with the serial number of its master's SOA record. When both serial numbers are the same, then no update is needed (because no records were added, removed or deleted). When the slave has a lower serial number than its master, then a zone transfer is requested.</span></p>
<p><span class="font25">Below a zone transfer captured in wireshark.</span></p><img src="linux_guide_files/The Complete Linux Guide-118.jpg" alt="" style="width:428pt;height:154pt;">
<ul style="list-style:none;"><li>
<h2><a name="bookmark5487"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4514"></a><a name="bookmark5488"></a>10.9. full or incremental zone transfers</span></h2></li></ul>
<p><a name="bookmark5489"></a><span class="font25"><a name="bookmark5490"></a>When a zone tranfer occurs, this can be either a full zone transfer or an incremental zone transfer. The decision depends on the size of the transfer that is needed to completely update the zone on the slave server. An incremental zone transfer is prefered when the total size of changes is smaller than the size of the zone database. Full zone transfers use the </span><span class="font25" style="font-weight:bold;">axfr </span><span class="font25">protocol, incremental zone transfer use the </span><span class="font25" style="font-weight:bold;">ixfr </span><span class="font25">protocol.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5491"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4515"></a><a name="bookmark5492"></a>10.10. DNS cache</span></h2></li></ul>
<p><span class="font25">DNS is a caching protocol.</span></p>
<p><span class="font25">When a client queries its local DNS server, and the local DNS server is not authoritative for the query, then this server will go looking for an authoritative name server in the DNS tree. The local name server will first query a root server, then a </span><span class="font25" style="font-weight:bold;">tld </span><span class="font25">server and then a domain server. When the local name server resolves the query, then it will relay this information to the client that submitted the query, and it will also keep a copy of these queries in its cache. So when a(nother) client submits the same query to this name server, then it will retrieve this information form its cache.</span></p>
<p><span class="font25">For example, a client queries for the A record on </span><a href="http://www.linux-training.be"><span class="font25">www.linux-training.be</span></a><span class="font25"> to its local server. This is the first query ever received by this local server. The local server checks that it is not authoritative for the linux-training.be domain, nor for the </span><span class="font25" style="font-weight:bold;">.be tld</span><span class="font25">, and it is also not a root server. So the local server will use the root hints to send an </span><span class="font25" style="font-weight:bold;">iterative </span><span class="font25">query to a root server.</span></p>
<p><span class="font25">The root server will reply with a reference to the server that is authoritative for the .be domain (root DNS servers do not resolve fqdn's, and root servers do not respond to recursive queries).</span></p>
<p><span class="font25">The local server will then sent an iterative query to the authoritative server for the </span><span class="font25" style="font-weight:bold;">.be tld</span><span class="font25">. This server will respond with a reference to the name server that is authoritative for the linux-training.be domain.</span></p>
<p><span class="font25">The local server will then sent the query for </span><a href="http://www.linux-training.be"><span class="font25">www.linux-training.be</span></a><span class="font25"> to the authoritative server (or one of its slave servers) for the linux-training.be domain. When the local server receives the ip address for </span><a href="http://www.linux-training.be"><span class="font25">www.linux-training.be</span></a><span class="font25">, then it will provide this information to the client that submitted this query.</span></p>
<p><span class="font25">Besides caching the A record for </span><a href="http://www.linux-training.be"><span class="font25">www.linux-training.be</span></a><span class="font25">, the local server will also cache the NS and A record for the linux-training.be name server and the .be name server.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5493"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4516"></a><a name="bookmark5494"></a>10.11. forward lookup zone example</span></h2></li></ul>
<h4><a name="bookmark5495"></a><span class="font25"><a name="bookmark5496"></a><a name="bookmark5497"></a>The way to set up zones in </span><span class="font25" style="font-weight:bold;">/etc/bind/named.conf.local </span><span class="font25">is to create a zone entry with a reference to another file (this other file contains the </span><span class="font25" style="font-weight:bold;">zone database</span><span class="font25">).</span></h4>
<h4><a name="bookmark5498"></a><span class="font25"><a name="bookmark5499"></a>Here is an example of such an entry in </span><span class="font25" style="font-weight:bold;">/etc/bind/named.conf.local</span><span class="font25">:</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">cat /etc/bind/named.conf.local </span><span class="font19">//</span></p>
<p><span class="font19">// Do any local configuration here</span></p>
<p><span class="font19">//</span></p>
<p><span class="font19">// Consider adding the 1918 zones here, if they are not used in your</span></p>
<p><span class="font19">// organization //include &quot;/etc/bind/zones.rfc1918&quot;;</span></p>
<p><span class="font19">zone &quot;paul.local&quot; IN { type master; file &quot;/etc/bind/db.paul.local&quot;; allow-update { none; };</span></p>
<p><span class="font19">};</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<h4><a name="bookmark5500"></a><span class="font25"><a name="bookmark5501"></a>To create the zone file, the easy method is to copy an existing zone file (this is easier than writing from scratch).</span></h4>
<p><span class="font19">root@debian7:/etc/bind# </span><span class="font19" style="font-weight:bold;">cp db.empty db.paul.local</span></p>
<p><span class="font19">root@debian7:/etc/bind# </span><span class="font19" style="font-weight:bold;">vi db.paul.local</span></p>
<table border="1">
<tr><td colspan="5" style="vertical-align:top;">
<p><span class="font25">Here is an example of a zone file.</span></p>
<p><span class="font19">root@debian7:/etc/bind# </span><span class="font19" style="font-weight:bold;">cat db.paul.local </span><span class="font19">; zone for classroom teaching $TTL &nbsp;&nbsp;&nbsp;86400</span></p>
<p><span class="font19">@ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IN &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SOA &nbsp;&nbsp;&nbsp;&nbsp;debianpaul.paul.local. root</span></p>
<p><span class="font19">2014100100 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; Serial</span></p>
<p><span class="font19">1h &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; Refresh</span></p>
<p><span class="font19">1h &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; Retry</span></p>
<p><span class="font19">2h &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; Expire</span></p>
<p><span class="font19">86400 ) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; Negative</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">.paul.local (</span></p>
<p><span class="font19">Cache TTL</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">;</span></p>
<p><span class="font19">; name</span></p></td><td colspan="2" style="vertical-align:middle;">
<p><span class="font19">servers</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">;</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">IN</span></p>
<p><span class="font19">IN</span></p>
<p><span class="font19">IN</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">NS</span></p>
<p><span class="font19">NS</span></p>
<p><span class="font19">NS</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">ns1 debianpaul debian7</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td colspan="2" style="vertical-align:top;">
<p><span class="font23" style="font-style:italic;">;</span></p>
<p><span class="font19">; servers</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td colspan="2" style="vertical-align:top;">
<p><span class="font19">;</span></p>
<p><span class="font19">debianpaul debian7</span></p>
<p><span class="font19">ns1</span></p>
<p><span class="font19">;WWW</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">IN</span></p>
<p><span class="font19">IN</span></p>
<p><span class="font19">IN</span></p>
<p><span class="font19">IN</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">A &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.104.</span></p>
<p><span class="font19">A &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.104.</span></p>
<p><span class="font19">A &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.104.</span></p>
<p><span class="font19">A &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.104.</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">33.30</span></p>
<p><span class="font19">33.30</span></p>
<p><span class="font19">33.30</span></p>
<p><span class="font19">33.30</span></p></td><td style="vertical-align:top;"></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5502"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4517"></a><a name="bookmark5503"></a>10.12. example: caching only DNS server</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. installing DNS software on Debian</span></p></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">aptitude update &amp;&amp;&nbsp;aptitude upgrade</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">aptitude install bind9</span></p>
<p><span class="font19">...</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">dpkg -l | grep bind9 | tr -s ' '</span></p>
<p><span class="font19">ii bind9 1:9.8.4.dfsg.P1-6+nmu2+deb7u2 amd64 Internet Domain Name Server</span></p>
<p><span class="font19">ii bind9-host 1:9.8.4.dfsg.P1-6+nmu2+deb7u2 amd64 Version of 'host' bundled...</span></p>
<p><span class="font19">ii bind9utils 1:9.8.4.dfsg.P1-6+nmu2+deb7u2 amd64 Utilities for BIND</span></p>
<p><span class="font19">ii libbind9-80 1:9.8.4.dfsg.P1-6+nmu2+deb7u2 amd64 BIND9 Shared Library use... root@debian7:~#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Discover the default configuration files. Can you define the purpose of each file</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">root@debian7:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">:~# </span><span class="font19" style="font-weight:bold;">ls -l ,</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19" style="font-weight:bold;">/etc/bind</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">total 52</span></p>
<p><span class="font19">-rw-r--r-- 1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2389 Sep 5 20:25 bind.keys</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">-rw-r--r-- 1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">237 Sep 5 20:25 db.0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">-rw-r--r-- 1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">271 Sep 5 20:25 db.127</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">-rw-r--r-- 1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">237 Sep 5 20:25 db.255</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">-rw-r--r-- 1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">353 Sep 5 20:25 db.empty</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">-rw-r--r-- 1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">270 Sep 5 20:25 db.local</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">-rw-r--r-- 1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3048 Sep 5 20:25 db.root</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">-rw-r--r-- 1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root bind</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">463 Sep 5 20:25 named.conf</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">-rw-r--r-- 1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root bind</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">490 Sep 5 20:25 named.conf.default-zones</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-rw-r--r-- 1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root bind</span></p></td><td style="vertical-align:top;">
<p><span class="font19">374 Oct 1 20:01 named.conf.local</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">-rw-r--r-- 1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root bind</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">913 Oct 1 13:24 named.conf.options</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">-rw-r-----1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">bind bind</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">77 Oct 1 11:14 rndc.key</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-rw-r--r-- 1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1317 Sep 5 20:25 zones.rfc191</span></p></td></tr>
</table></li>
<li>
<p><span class="font25">3. Setup caching only dns server. This is normally the default setup. A caching-only name server will look up names for you and cache them. Many tutorials will tell you to add a </span><span class="font25" style="font-weight:bold;">forwarder</span><span class="font25">, but we first try without this!</span></p></li></ul>
<p><span class="font25">Hey this seems to work without a </span><span class="font25" style="font-weight:bold;">forwarder</span><span class="font25">. Using a sniffer you can find out what really happens. Your freshly install dns server is not using a cache, and it is not using your local dns server (from /etc/resolv.conf). So where is this information coming from ? And what can you learn from sniffing this dns traffic ?</span></p>
<p><span class="font25">4. Explain in detail what happens when you enable a caching only dns server without forwarder. This wireshark screenshot can help, but you learn more by sniffing the traffic yourself.</span></p><img src="linux_guide_files/The Complete Linux Guide-119.jpg" alt="" style="width:426pt;height:435pt;">
<p><span class="font25">You should see traffic to a </span><span class="font25" style="font-weight:bold;">root name server </span><span class="font25">whenever you try a new </span><span class="font25" style="font-weight:bold;">tld </span><span class="font25">for the first time. Remember that </span><span class="font25" style="font-weight:bold;">dns </span><span class="font25">is a caching protocol, which means that repeating a query will generate a lot less traffic since your </span><span class="font25" style="font-weight:bold;">dns server </span><span class="font25">will still have the answer in its memory.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5504"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4518"></a><a name="bookmark5505"></a>10.13. example: caching only with forwarder</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5506"></a><span class="font25"><a name="bookmark5507"></a>5. Add the public Google </span><span class="font25" style="font-weight:bold;">dns server </span><span class="font25">as a </span><span class="font25" style="font-weight:bold;">forwarder</span><span class="font25">. The ip address of this server is 8.8.8.8 .</span><br><br><span class="font25"><a name="bookmark5508"></a>Before the change:</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep -A2 'forwarders {' /etc/bind/named.conf.options</span></p></li></ul>
<p><span class="font19">// forwarders {</span></p>
<p><span class="font19">// &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0;</span></p>
<p><span class="font19">// };</span></p>
<h4><a name="bookmark5509"></a><span class="font25"><a name="bookmark5510"></a>changing:</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">vi /etc/bind/named.conf.options</span></p>
<h4><a name="bookmark5511"></a><span class="font25"><a name="bookmark5512"></a>After the change:</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep -A2 'forwarders {' /etc/bind/named.conf.options </span><span class="font19">forwarders {</span></p>
<p><span class="font19">8.8.8.8;</span></p>
<h4><a name="bookmark3147"></a><span class="font25"><a name="bookmark5513"></a>Restart the server:</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">service bind9 restart </span><span class="font19">Stopping domain name service...: bind9. Starting domain name service...: bind9.</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5514"></a><span class="font25"><a name="bookmark5515"></a>6. Explain the purpose of adding the </span><span class="font25" style="font-weight:bold;">forwarder</span><span class="font25">. What is our </span><span class="font25" style="font-weight:bold;">dns server </span><span class="font25">doing when it receives a query ?</span></h4></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">nslookup </span><span class="font19">&gt;&nbsp;server</span></p>
<p><span class="font19">Default server: 10.104.33.30</span></p>
<p><span class="font19">Address: 10.104.33.30#53</span></p>
<p><span class="font19">&gt; linux-training.be</span></p>
<p><span class="font19">Server: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.104.33.30</span></p>
<p><span class="font19">Address: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.104.33.30#53</span></p>
<p><span class="font19">Non-authoritative answer:</span></p>
<p><span class="font19">Name: &nbsp;&nbsp;linux-training.be</span></p>
<p><span class="font19">Address: 188.93.155.87</span></p>
<h4><a name="bookmark5516"></a><span class="font25"><a name="bookmark5517"></a>This is the output of </span><span class="font25" style="font-weight:bold;">tcpdump udp port 53 </span><span class="font25">while executing the above query for </span><span class="font25" style="font-weight:bold;">linux-training.be </span><span class="font25">in </span><span class="font25" style="font-weight:bold;">nslookup</span><span class="font25">.</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">tcpdump udp port 53</span></p>
<p><span class="font19">tcpdump: verbose output suppressed, use -v or -vv for full protocol decode listening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes</span></p>
<h4><a name="bookmark5518"></a><span class="font25"><a name="bookmark5519"></a>You should find the following two lines in the output of </span><span class="font25" style="font-weight:bold;">tcpdump</span><span class="font25">:</span></h4>
<p><span class="font19">10.104.33.30.19381 &gt;&nbsp;google-public-dns-a.google.com.domain: 18237+% [1au] A? \ linux-training.be. (46)</span></p>
<p><span class="font19">google-public-dns-a.google.com.domain &gt;&nbsp;10.104.33.30.19381: 18237 1/0/1 A 188\ .93.155.87 (62)</span></p>
<p><span class="font25">Below is an (old) wireshark screenshot that can help, you should see something similar (but with different ip addresses).</span></p>
<p><span class="font3">| Filter: [dns &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v Expression... Clear Apply</span></p>
<table border="1">
<tr><td style="vertical-align:middle;">
<p><span class="font13">No.. Time</span></p></td><td style="vertical-align:middle;">
<p><span class="font13">Source</span></p></td><td style="vertical-align:middle;">
<p><span class="font13">Destination</span></p></td><td colspan="3" style="vertical-align:middle;">
<p><span class="font13">Protocol Info</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font3">278 13.741725</span></p></td><td style="vertical-align:top;">
<p><span class="font3">192.168.1.37</span></p></td><td style="vertical-align:top;">
<p><span class="font3">192.168.1.1</span></p></td><td style="vertical-align:top;">
<p><span class="font3">DNS</span></p></td><td style="vertical-align:top;">
<p><span class="font3">Standard</span></p></td><td style="vertical-align:top;">
<p><span class="font3">query A cobbaut.be</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font3">285 13.759925</span></p></td><td style="vertical-align:top;">
<p><span class="font3">192.168.1.1</span></p></td><td style="vertical-align:top;">
<p><span class="font3">192.168.1.37</span></p></td><td style="vertical-align:top;">
<p><span class="font3">DNS</span></p></td><td style="vertical-align:top;">
<p><span class="font3">Standard</span></p></td><td style="vertical-align:top;">
<p><span class="font3">query response A 88.151.243.8</span></p></td></tr>
</table>
<p><span class="font3">Frame 278 (81 bytes on wire, 81 bytes captured)</span></p>
<p><span class="font3">&gt; Ethernet II, Src: 8c:7b:9d:d6:df:f2 (8c:7b:9d:d6:df:f2), Dst: ZygateCoaa:68:f0 (00:02:cf:aa:6E &gt;&nbsp;Internet Protocol, Src: 192.168.1.37 (192.168.1.37), Dst: 192.168.1.1 (192.168.1.1)</span></p>
<p><span class="font3">&gt; User Datagram Protocol, Src Port: 44677 (44677), Dst Port: domain (53)</span></p>
<p><span class="font3">Domain Name System (query) Transaction ID: 0xf488 &gt;&nbsp;Flags: 0x0100 (Standard query) Questions: 1 Answer RRs: 0 Authority RRs: 0 Additional RRs: 1</span></p>
<p><span class="font3">■v Queries</span></p>
<p><span class="font3">&gt; cobbaut.be: type A, class IN &gt;&nbsp;Additional records</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. What happens when you query for the same domain name more than once ?</span></p></li>
<li>
<p><span class="font25">8. Why does it say &quot;non-authoritative answer&quot; ? When is a dns server authoritative ?</span></p></li>
<li>
<p><span class="font25">9. You can also use </span><span class="font25" style="font-weight:bold;">dig </span><span class="font25">instead of </span><span class="font25" style="font-weight:bold;">nslookup</span><span class="font25">.</span></p></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">dig @10.104.33.30 linux-training.be +short</span></p>
<p><span class="font19">188.93.155.87</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">10. How can we avoid having to set the server in dig or nslookup ?</span></p></li></ul>
<p><span class="font25">Change this:</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">cat /etc/resolv.conf</span></p>
<p><span class="font19">nameserver 10.46.101.1</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<p><span class="font25">into this:</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">cat /etc/resolv.conf</span></p>
<p><span class="font19">nameserver 10.104.33.30</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">11. When you use </span><span class="font25" style="font-weight:bold;">dig </span><span class="font25">for the first time for a domain, where is the answer coming from And the second time ? How can you tell ?</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5520"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4519"></a><a name="bookmark5521"></a>10.14. example: primary authoritative server</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5522"></a><span class="font25"><a name="bookmark5523"></a>1. Instead of only cachng the information from other servers, we will now make our server authoritative for our own domain.</span></h4></li>
<li>
<h4><a name="bookmark5524"></a><span class="font25"><a name="bookmark5525"></a>2. I choose the top level domain </span><span class="font25" style="font-weight:bold;">.local </span><span class="font25">and the domain </span><span class="font25" style="font-weight:bold;">paul.local </span><span class="font25">and put the information in </span><span class="font25" style="font-weight:bold;">/etc/bind/named.conf.local</span><span class="font25">.</span></h4></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">cat /etc/bind/named.conf.local</span></p>
<p><span class="font19">//</span></p>
<p><span class="font19">// Do any local configuration here</span></p>
<p><span class="font19">//</span></p>
<p><span class="font19">// Consider adding the 1918 zones here, if they are not used in your // organization //include &quot;/etc/bind/zones.rfc1918&quot;;</span></p>
<p><span class="font19">zone &quot;paul.local&quot; IN { type master; file &quot;/etc/bind/db.paul.local&quot;; allow-update { none; };</span></p>
<p><span class="font19">};</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5526"></a><span class="font25"><a name="bookmark5527"></a>3. Also add a </span><span class="font25" style="font-weight:bold;">zone database file</span><span class="font25">, similar to this one (add some A records for testing). Set the </span><span class="font25" style="font-weight:bold;">Refresh </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">Retry </span><span class="font25">values not too high so you can sniff this traffic (this example makes the slave server contact the master every hour).</span></h4>
<table border="1">
<tr><td colspan="3" style="vertical-align:bottom;">
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">cat</span></p></td><td colspan="4" rowspan="3" style="vertical-align:top;">
<p><span class="font19" style="font-weight:bold;">/etc/bind/db.paul.local</span></p>
<p><span class="font19">teaching</span></p></td></tr>
<tr><td rowspan="3" style="vertical-align:top;">
<p><span class="font19">; zone $TTL @</span></p></td><td colspan="2" style="vertical-align:top;">
<p><span class="font19">for classroom</span></p></td></tr>
<tr><td rowspan="2" style="vertical-align:top;">
<p><span class="font19">86400</span></p>
<p><span class="font19">IN</span></p></td><td rowspan="2" style="vertical-align:top;">
<p><span class="font19">SOA</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">debianpaul.paul</span></p>
<p><span class="font19">2014100101</span></p>
<p><span class="font19">1h</span></p>
<p><span class="font19">1h</span></p>
<p><span class="font19">2h</span></p>
<p><span class="font19">900 )</span></p></td><td style="vertical-align:top;">
<p><span class="font19">.local. root</span></p>
<p><span class="font19">; Serial</span></p>
<p><span class="font19">; Refresh</span></p>
<p><span class="font19">; Retry</span></p>
<p><span class="font19">; Expire</span></p>
<p><span class="font19">; Negative</span></p></td><td style="vertical-align:top;">
<p><span class="font19">.paul</span></p>
<p><span class="font19">Cache</span></p></td><td style="vertical-align:top;">
<p><span class="font19">local (</span></p>
<p><span class="font19">TTL</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">;</span></p>
<p><span class="font19">; name</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">servers</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">;</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">IN</span></p>
<p><span class="font19">IN</span></p>
<p><span class="font19">IN</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">NS</span></p>
<p><span class="font19">NS</span></p>
<p><span class="font19">NS</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">ns1 debianpaul debian7</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td colspan="2" style="vertical-align:top;">
<p><span class="font23" style="font-style:italic;">;</span></p>
<p><span class="font19">; servers</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td colspan="2" style="vertical-align:top;">
<p><span class="font19">;</span></p>
<p><span class="font19">debianpaul</span></p>
<p><span class="font19">debian7</span></p>
<p><span class="font19">ns1</span></p>
<p><span class="font19">; WWW</span></p>
<p><span class="font19">root@debian7:~#</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">IN</span></p>
<p><span class="font19">IN</span></p>
<p><span class="font19">IN</span></p>
<p><span class="font19">IN</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">A &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.104.</span></p>
<p><span class="font19">A &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.104.</span></p>
<p><span class="font19">A &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.104.</span></p>
<p><span class="font19">A &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.104.</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">33.30</span></p>
<p><span class="font19">33.30</span></p>
<p><span class="font19">33.30</span></p>
<p><span class="font19">33.30</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
</table></li></ul>
<h4><a name="bookmark5528"></a><span class="font25"><a name="bookmark5529"></a>Note that the </span><span class="font25" style="font-weight:bold;">www </span><span class="font25">record is commented out, so it will not resolve.</span></h4>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5530"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5531"></a>10.14.1. using your own DNS server</span></h3></li></ul>
<h4><a name="bookmark5532"></a><span class="font25"><a name="bookmark5533"></a>If you are confident that your </span><span class="font25" style="font-weight:bold;">dns server </span><span class="font25">works, then set it as default and only dns server in </span><span class="font25" style="font-weight:bold;">/etc/resolv.conf</span><span class="font25">.</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">cat /etc/resolv.conf</span></p>
<p><span class="font19">nameserver 10.104.33.30</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<h4><a name="bookmark5534"></a><span class="font25"><a name="bookmark5535"></a>In case you also use </span><span class="font25" style="font-weight:bold;">dhclient</span><span class="font25">, you will need to add your dns server to </span><span class="font25" style="font-weight:bold;">/etc/dhcp/ dhclient.conf</span><span class="font25">.</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">diff /etc/dhcp/dhclient.conf /etc/dhcp/dhclient.conf.original </span><span class="font19">21c21</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">&lt; prepend domain-name-servers 10.104.33.30;</span></p></li></ul>
<p><span class="font19">—</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">&gt; #prepend domain-name-servers 127.0.0.1;</span></p></li></ul>
<p><span class="font19">23,24c23</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">&lt; # &nbsp;&nbsp;&nbsp;&nbsp;domain-name, domain-name-servers, domain-search, host-name,</span></p></li>
<li>
<p><span class="font19">&lt; domain-name, domain-search, host-name,</span></p></li></ul>
<p><span class="font19">—</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">&gt; domain-name, domain-name-servers, domain-search, host-name,</span></p></li></ul>
<p><span class="font19">root@debian7:~#</span></p>
<h4><a name="bookmark5536"></a><span class="font25"><a name="bookmark5537"></a>The above screenshot shows that 10.104.33.30 is now a default option that the </span><span class="font25" style="font-weight:bold;">dhcp client </span><span class="font25">should no longer request from the </span><span class="font25" style="font-weight:bold;">dhcp server</span><span class="font25">.</span></h4>
<p><span class="font25">Adjust </span><span class="font25" style="font-weight:bold;">/etc/hosts </span><span class="font25">to reflect your </span><span class="font25" style="font-weight:bold;">domain name </span><span class="font25">and verify with </span><span class="font25" style="font-weight:bold;">hostname </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">dnsdomainname</span><span class="font25">.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep debian7 /etc/hosts</span></p>
<p><span class="font19">127.0.1.1 debian7.paul.local debian7</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">hostname</span></p>
<p><span class="font19">debian7</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">hostname --fqdn</span></p>
<p><span class="font19">debian7.paul.local</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">dnsdomainname</span></p>
<p><span class="font19">paul.local</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5538"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5539"></a>10.14.2. using your own domain</span></h3></li></ul>
<h4><a name="bookmark5540"></a><span class="font25"><a name="bookmark5541"></a>Consider the following screenshot:</span></h4>
<p><span class="font19">root@debian7b:~# </span><span class="font19" style="font-weight:bold;">cat /etc/resolv.conf</span></p>
<p><span class="font19">nameserver 10.104.33.30</span></p>
<p><span class="font19">root@debian7b:~# </span><span class="font19" style="font-weight:bold;">ping -cl www </span><span class="font19">ping: unknown host www</span></p>
<p><span class="font19">root@debian7b:~# </span><span class="font19" style="font-weight:bold;">vi /etc/resolv.conf</span></p>
<p><span class="font19">root@debian7b:~# </span><span class="font19" style="font-weight:bold;">cat /etc/resolv.conf</span></p>
<p><span class="font19">nameserver 10.104.33.30</span></p>
<p><span class="font19">domain paul.local</span></p>
<p><span class="font19">root@debian7b:~# </span><span class="font19" style="font-weight:bold;">ping -cl www </span><span class="font19">PING </span><a href="http://www.paul.local"><span class="font19">www.paul.local</span></a><span class="font19"> (10.104.33.31) 56(84) bytes of data. 64 bytes from 10.104.33.31: icmp_req=1 ttl=64 time=0.021 ms</span></p>
<p><span class="font19">--- </span><a href="http://www.paul.local"><span class="font19">www.paul.local</span></a><span class="font19"> ping statistics ---</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.021/0.021/0.021/0.000 ms root@debian7b:~#</span></p></li></ul>
<h4><a name="bookmark5542"></a><span class="font25"><a name="bookmark5543"></a>Adding the </span><span class="font25" style="font-weight:bold;">domain paul.local </span><span class="font25">directive to </span><span class="font25" style="font-weight:bold;">/etc/resolv.conf </span><span class="font25">allows omitting the domain when using hostnames.</span></h4>
<h4><a name="bookmark5544"></a><span class="font25"><a name="bookmark5545"></a>You can accomplish this feature automatically by adjusting </span><span class="font25" style="font-weight:bold;">dhclient.conf</span><span class="font25">.</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep paul.local /etc/dhcp/dhclient.conf</span></p>
<p><span class="font19">prepend domain-name &quot;paul.local&quot;;</span></p>
<p><span class="font19">prepend domain-search &quot;paul.local&quot;;</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5546"></a><span class="font25"><a name="bookmark5547"></a>4. Restart the DNS server and check your zone in the error log.</span></h4></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">service bind9 restart</span></p>
<p><span class="font19">Stopping domain name service...: bind9.</span></p>
<p><span class="font19">Starting domain name service...: bind9.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep paul.local /var/log/syslog</span></p>
<p><span class="font19">Oct 6 09:22:18 debian7 named[2707]: zone paul.local/IN: loaded seria\ l 2014100101</span></p>
<p><span class="font19">Oct 6 09:22:18 debian7 named[2707]: zone paul.local/IN: sending noti\ fies (serial 2014100101)</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5548"></a><span class="font25"><a name="bookmark5549"></a>5. Use </span><span class="font25" style="font-weight:bold;">dig </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">nslookup </span><span class="font25">(or even </span><span class="font25" style="font-weight:bold;">ping</span><span class="font25">) to test your A records.</span></h4></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">ping -cl nsl.paul.local</span></p>
<p><span class="font19">PING ns1.paul.local (10.104.33.30) 56(84) bytes of data. 64 bytes from 10.104.33.30: icmp_req=1 ttl=64 time=0.006 ms</span></p>
<p><span class="font19">--- ns1.paul.local ping statistics ---</span></p>
<p><span class="font19">1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.006/0.006/0.006/0.000 ms</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">ping -cl </span><a href="http://www.paul.local"><span class="font19" style="font-weight:bold;">www.paul.local</span></a></p>
<p><span class="font19">ping: unknown host </span><a href="http://www.paul.local"><span class="font19">www.paul.local</span></a></p>
<h4><a name="bookmark5550"></a><span class="font25"><a name="bookmark5551"></a>Note that the </span><span class="font25" style="font-weight:bold;">www </span><span class="font25">record was commented out, so it should fail.</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">dig debian7.paul.local</span></p>
<p><span class="font19">; &lt;&lt;&gt;&gt;&nbsp;DiG 9.8.4-rpz2+rl005.12-P1 &lt;&lt;&gt;&gt;&nbsp;debian7.paul.local ; ; global options: +cmd ;; Got answer:</span></p>
<p><span class="font19">; ; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 50491</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">;; flags: qr aa rd ra;</span></p></td><td style="vertical-align:top;">
<p><span class="font19">QUERY:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1, ANSWER:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1,</span></p></td><td style="vertical-align:top;">
<p><span class="font19">AUTHORITY: 3, ADDITIONAL: 2</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">;; QUESTION SECTION:</span></p>
<p><span class="font19">;debian7.paul.local.</span></p>
<p><span class="font19">;; ANSWER SECTION:</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:middle;">
<p><span class="font19">IN</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">A</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">debian7.paul.local.</span></p>
<p><span class="font19">;; AUTHORITY SECTION:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">86400</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IN</span></p></td><td style="vertical-align:top;">
<p><span class="font19">A</span></p></td><td style="vertical-align:top;">
<p><span class="font19">10.104.33.30</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">paul.local.</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">86400</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IN</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">NS</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ns1.paul.local.</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">paul.local.</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">86400</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IN</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">NS</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">debian7.paul.local.</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">paul.local.</span></p>
<p><span class="font19">;; ADDITIONAL SECTION:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">86400</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IN</span></p></td><td style="vertical-align:top;">
<p><span class="font19">NS</span></p></td><td style="vertical-align:top;">
<p><span class="font19">debianpaul.paul.local.</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">ns1.paul.local.</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">86400</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IN</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">A</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10.104.33.30</span></p></td></tr>
<tr><td colspan="2" style="vertical-align:top;">
<p><span class="font19">debianpaul.paul.local. 86400</span></p>
<p><span class="font19">;; Query time: 4 msec</span></p>
<p><span class="font19">;; SERVER: 10.104.33.30#53(10</span></p>
<p><span class="font19">;; WHEN: Mon Oct 6 09:35:25</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IN</span></p>
<p><span class="font19">.104.33.30)</span></p>
<p><span class="font19">2014</span></p></td><td style="vertical-align:top;">
<p><span class="font19">A</span></p></td><td style="vertical-align:top;">
<p><span class="font19">10.104.33.30</span></p></td></tr>
</table>
<p><span class="font19">; ; MSG SIZE rcvd: 141</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5552"></a><span class="font25"><a name="bookmark5553"></a>6. Our primary server appears to be up and running. Note the information here:</span></h4></li></ul>
<p><span class="font19">server os : Debian 7 ip address : 10.104.33.30 domain name: paul.local server name: ns1.paul.local</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5554"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4520"></a><a name="bookmark5555"></a>10.15. example: a DNS slave server</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. A slave server transfers zone information over the network from a master server (a slave can also be a master). A primary server maintains zone records in its local file system. As an exercise, and to verify the work of all students, set up a slave server of all the master servers in the classroom.</span></p></li>
<li>
<p><span class="font25">2. Before configuring the slave server, we may have to allow transfers from our zone to this server. Remember that this is not very secure since transfers are in clear text and limited to an ip address. This example follows our demo from above.</span></p></li></ul>
<p><span class="font25">Imagine a student named </span><span class="font25" style="font-weight:bold;">Jesse </span><span class="font25">having completed the setup as shown before, with the domain name </span><span class="font25" style="font-weight:bold;">jesse.local </span><span class="font25">and the ip address 10.104.15.20. The goal is to have a slave server of paul.local on Jesse's computer and a slave zone of jesse.local on my computer.</span></p>
<p><span class="font25">Below is an example of an </span><span class="font25" style="font-weight:bold;">allow-transfer </span><span class="font25">statement. Careful, maybe the default allows transfer to any.</span></p>
<p><span class="font19">root@debian7:/etc/bind# </span><span class="font19" style="font-weight:bold;">cat named.conf.local</span></p>
<p><span class="font19">//</span></p>
<p><span class="font19">// Do any local configuration here</span></p>
<p><span class="font19">//</span></p>
<p><span class="font19">// Consider adding the 1918 zones here, if they are not used in your</span></p>
<p><span class="font19">// organization</span></p>
<p><span class="font19">//include &quot;/etc/bind/zones.rfc1918&quot;;</span></p>
<p><span class="font19">zone &quot;paul.local&quot; IN {</span></p>
<p><span class="font19">type master;</span></p>
<p><span class="font19">file &quot;/etc/bind/db.paul.local&quot;;</span></p>
<p><span class="font19">allow-update { none; };</span></p>
<p><span class="font19">allow-transfer { 10.104.15.20; };</span></p>
<p><span class="font19">};</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5556"></a><span class="font25"><a name="bookmark5557"></a>3. With the configuration below I can make my server a slave for the </span><span class="font25" style="font-weight:bold;">jesse.local </span><span class="font25">zone.</span></h4></li></ul>
<p><span class="font19">root@debian7:/etc/bind# </span><span class="font19" style="font-weight:bold;">tail -6 named.conf.local</span></p>
<p><span class="font19">zone &quot;jesse.local&quot; IN { type slave; file &quot;/var/cache/named/db.jesse.local&quot;; masters { 10.104.15.20; };</span></p>
<p><span class="font19">};</span></p>
<p><span class="font19">root@debian7:/etc/bind# </span><span class="font19" style="font-weight:bold;">mkdir /var/cache/named/</span></p>
<p><span class="font19">root@debian7:/etc/bind# </span><span class="font19" style="font-weight:bold;">chown bind:bind /var/cache/named/</span></p>
<p><span class="font19">root@debian7:/etc/bind# </span><span class="font19" style="font-weight:bold;">ls -ld /var/cache/named/</span></p>
<p><span class="font19">drwxr-xr-x 2 bind bind 4096 Oct 1 20:01 /var/cache/named/</span></p>
<p><span class="font25">Note that we put the </span><span class="font25" style="font-weight:bold;">slave zones </span><span class="font25">in </span><span class="font25" style="font-weight:bold;">/var/cache/named </span><span class="font25">and not in </span><span class="font25" style="font-weight:bold;">/etc/bind</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5558"></a><span class="font25"><a name="bookmark5559"></a>4. Restarting bind on the slave server should transfer the zone database file. Verify this in </span><span class="font25" style="font-weight:bold;">/ var/log/syslog</span><span class="font25">. (time and date are truncated from the screenshot, and Jesse did not use the current date in the serial number...)</span></h4></li></ul>
<p><span class="font19">root@debian7:/etc/bind# </span><span class="font19" style="font-weight:bold;">grep jesse /var/log/syslog</span></p>
<p><span class="font19">named[2731]: zone jesse.local/IN: Transfer started.</span></p>
<p><span class="font19">named[2731]: transfer of 'jesse.local/IN' from 10.104.15.20#53: connected u\</span></p>
<p><span class="font19">sing 10.104.33.30#44719</span></p>
<p><span class="font19">named[2731]: zone jesse.local/IN: transferred serial 20110516</span></p>
<p><span class="font19">named[2731]: transfer of 'jesse.local/IN' from 10.104.15.20#53: Transfer co\</span></p>
<p><span class="font19">mpleted: 1 messages, 8 records, 239 bytes, 0.001 secs (239000 bytes/sec)</span></p>
<h4><a name="bookmark5560"></a><span class="font25"><a name="bookmark5561"></a>And the contents of the </span><span class="font25" style="font-weight:bold;">slave zone</span><span class="font25">:</span></h4>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">root@debian7:/etc $ORIGIN .</span></p>
<p><span class="font19">$TTL 604800 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</span></p>
<p><span class="font19">jesse.local</span></p></td><td colspan="2" style="vertical-align:top;">
<p><span class="font19">/bind# </span><span class="font19" style="font-weight:bold;">cat</span></p>
<p><span class="font19">1 week IN</span></p></td><td colspan="2" style="vertical-align:top;">
<p><span class="font19" style="font-weight:bold;">/var/cache/named/db.jesse.local</span></p>
<p><span class="font19">SOA ns.jesse.local. root.jesse.local.jesse.local. (</span></p>
<p><span class="font19">20110516 &nbsp;&nbsp;; serial</span></p>
<p><span class="font19">300 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; refresh (5 minutes)</span></p>
<p><span class="font19">200 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; retry (3 minutes 20 seconds)</span></p>
<p><span class="font19">2419200 &nbsp;&nbsp;&nbsp;; expire (4 weeks)</span></p>
<p><span class="font19">604800 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; minimum (1 week)</span></p></td></tr>
<tr><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">$ORIGIN jesse.local.</span></p>
<p><span class="font19">anya</span></p>
<p><span class="font19">mac</span></p>
<p><span class="font19">ns</span></p>
<p><span class="font19">ubu1010srv</span></p>
<p><span class="font19">www</span></p>
<p><span class="font19">root@debian7:/etc/bind#</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">NS</span></p>
<p><span class="font19">A A</span></p>
<p><span class="font19">A A</span></p>
<p><span class="font19">A</span></p></td><td style="vertical-align:top;">
<p><span class="font19">) ns.jesse.</span></p>
<p><span class="font19">10.104.15</span></p>
<p><span class="font19">10.104.15</span></p>
<p><span class="font19">10.104.15</span></p>
<p><span class="font19">10.104.15</span></p>
<p><span class="font19">10.104.15</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">local.</span></p>
<p><span class="font19">.1</span></p>
<p><span class="font19">.30</span></p>
<p><span class="font19">.20</span></p>
<p><span class="font19">.20</span></p>
<p><span class="font19">.25</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5562"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4521"></a><a name="bookmark5563"></a>10.16. practice: dns</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Install </span><span class="font25" style="font-weight:bold;">bind9 </span><span class="font25">and verify with a sniffer how it works.</span></p></li>
<li>
<p><span class="font25">2. Add a </span><span class="font25" style="font-weight:bold;">forwarder </span><span class="font25">and verify that it works.</span></p></li>
<li>
<p><span class="font25">3. Create a </span><span class="font25" style="font-weight:bold;">primary forward lookup zone </span><span class="font25">named yourname.local with at least two NS records and four A records.</span></p></li>
<li>
<p><span class="font25">4. Use </span><span class="font25" style="font-weight:bold;">dig </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">nslookup </span><span class="font25">to verify your NS and A records.</span></p></li>
<li>
<p><span class="font25">5. Create a </span><span class="font25" style="font-weight:bold;">slave </span><span class="font25">of your primary zone (on another server) and verify the </span><span class="font25" style="font-weight:bold;">zone transfer</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">6. Set up two primary zones on two servers and implement a </span><span class="font25" style="font-weight:bold;">conditional forwarder </span><span class="font25">(you can use the two servers from before).</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5564"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4522"></a><a name="bookmark5565"></a>10.17. solution: dns</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Install </span><span class="font25" style="font-weight:bold;">bind9 </span><span class="font25">and verify with a sniffer how it works.</span></p></li></ul>
<p><span class="font19">You should see queries to the root name servers with </span><span class="font19" style="font-weight:bold;">tcpdump </span><span class="font19">or </span><span class="font19" style="font-weight:bold;">wireshark</span><span class="font19">.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Add a </span><span class="font25" style="font-weight:bold;">forwarder </span><span class="font25">and verify that it works.</span></p></li></ul>
<p><span class="font19">The forwarder van be added in named.conf.options as seen in the theory.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Create a </span><span class="font25" style="font-weight:bold;">primary forward lookup zone </span><span class="font25">named yourname.local with at least two NS records and four A records.</span></p></li></ul>
<p><span class="font19">This is literally explained in the theory.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Use </span><span class="font25" style="font-weight:bold;">dig </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">nslookup </span><span class="font25">to verify your NS and A records.</span></p></li></ul>
<p><span class="font19">This is literally explained in the theory.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Create a </span><span class="font25" style="font-weight:bold;">slave </span><span class="font25">of your primary zone (on another server) and verify the </span><span class="font25" style="font-weight:bold;">zone transfer</span><span class="font25">.</span></p></li></ul>
<p><span class="font19">This is literally explained in the theory.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Set up two primary zones on two servers and implement a </span><span class="font25" style="font-weight:bold;">conditional forwarder </span><span class="font25">(you can use the two servers from before).</span></p></li></ul>
<p><span class="font19">A conditional forwarder is set in named.conf.local as a zone.</span></p>
<p><span class="font19">(see the theory on forwarder)</span></p>
<h1><a name="bookmark5566"></a><span class="font11" style="font-weight:bold;"><a name="bookmark5567"></a><a name="bookmark5568"></a>Chapter 11. advanced DNS</span></h1>
<p><span class="font25">This chapter expands your DNS server with topics like </span><span class="font25" style="font-weight:bold;">round robin dns </span><span class="font25">for load balancing servers, </span><span class="font25" style="font-weight:bold;">dns delegation </span><span class="font25">to delegate child domains to another team and </span><span class="font25" style="font-weight:bold;">split horizon dns </span><span class="font25">so you can provide local service locations to clients.</span></p>
<p><span class="font25">There is more to </span><span class="font25" style="font-weight:bold;">dns</span><span class="font25">, content will be added </span><span class="font25" style="font-weight:bold;">rsn</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5569"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4524"></a><a name="bookmark5570"></a>11.1. example: DNS round robin</span></h2></li></ul>
<p><a name="bookmark5571"></a><span class="font25">When you create multiple A records for the same name, then </span><span class="font25" style="font-weight:bold;">bind </span><span class="font25">will do a </span><span class="font25" style="font-weight:bold;">round robin </span><span class="font25">of the order in which the records are returned. This allows the use of DNS as a load balancer between hosts, since clients will usually take the first ip-address offered.</span></p>
<p><span class="font25">Consider this example from the </span><span class="font25" style="font-weight:bold;">/etc/bind/db.paul.local </span><span class="font25">zone configuration file. There are two A records for </span><span class="font25" style="font-weight:bold;">www </span><span class="font25">pointing to two distinct ip addresses.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep www /etc/bind/db.paul.local</span></p>
<p><span class="font19">www &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IN &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.104.33.30</span></p>
<p><span class="font19">www &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IN &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.104.33.31</span></p>
<p><span class="font25">Below a screenshot of </span><span class="font25" style="font-weight:bold;">nslookup </span><span class="font25">querying a load balanced A record. Notice the order of ip addresses returned.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">nslookup </span><a href="http://www.paul.local"><span class="font19" style="font-weight:bold;">www.paul.local</span></a><span class="font19" style="font-weight:bold;"> 10.104.33.30</span></p>
<p><span class="font19">Server: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.104.33.30</span></p>
<p><span class="font19">Address: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.104.33.30#53</span></p>
<p><span class="font19">Name: &nbsp;&nbsp;</span><a href="http://www.paul.local"><span class="font19">www.paul.local</span></a></p>
<p><span class="font19">Address: 10.104.33.31</span></p>
<p><span class="font19">Name: &nbsp;&nbsp;</span><a href="http://www.paul.local"><span class="font19">www.paul.local</span></a></p>
<p><span class="font19">Address: 10.104.33.30</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">nslookup </span><a href="http://www.paul.local"><span class="font19" style="font-weight:bold;">www.paul.local</span></a><span class="font19" style="font-weight:bold;"> 10.104.33.30</span></p>
<p><span class="font19">Server: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.104.33.30</span></p>
<p><span class="font19">Address: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.104.33.30#53</span></p>
<p><span class="font19">Name: &nbsp;&nbsp;</span><a href="http://www.paul.local"><span class="font19">www.paul.local</span></a></p>
<p><span class="font19">Address: 10.104.33.30</span></p>
<p><span class="font19">Name: &nbsp;&nbsp;</span><a href="http://www.paul.local"><span class="font19">www.paul.local</span></a></p>
<p><span class="font19">Address: 10.104.33.31</span></p>
<p><span class="font25">Try to set up a website on two web servers (with a small difference so you can distinguish the websites) and test the </span><span class="font25" style="font-weight:bold;">round robin</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5572"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4525"></a><a name="bookmark5573"></a>11.2. DNS delegation</span></h2></li></ul>
<p><span class="font25">You can </span><span class="font25" style="font-weight:bold;">delegate </span><span class="font25">a child domain to another DNS server. The child domain then becomes a new zone, with authority at the new dns server.</span></p><img src="linux_guide_files/The Complete Linux Guide-120.jpg" alt="" style="width:361pt;height:254pt;">
<p><span class="font25">When </span><span class="font25" style="font-weight:bold;">delegation </span><span class="font25">is properly set up, then clients that query your parent zone will also be able to resolve the delegated child zones.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5574"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4526"></a><a name="bookmark5575"></a>11.3. example: DNS delegation</span></h2></li></ul>
<h4><a name="bookmark5576"></a><span class="font25"><a name="bookmark5577"></a>We have another </span><span class="font25" style="font-weight:bold;">Linux server </span><span class="font25">named </span><span class="font25" style="font-weight:bold;">debian7b </span><span class="font25">and we want to make it responsible for the child domain </span><span class="font25" style="font-weight:bold;">test42.paul.local</span><span class="font25">.</span></h4>
<p><span class="font25" style="font-style:italic;">Note the name of the servers in the screenshots are either </span><span class="font25" style="font-weight:bold;font-style:italic;">debian7 </span><span class="font25" style="font-style:italic;">(hosting the parent domain) or </span><span class="font25" style="font-weight:bold;font-style:italic;">debian7b </span><span class="font25" style="font-style:italic;">(hosting the child domain).</span></p>
<h4><a name="bookmark5578"></a><span class="font25"><a name="bookmark5579"></a>We start by adjusting the </span><span class="font25" style="font-weight:bold;">/etc/bind/named.comf.local </span><span class="font25">file (on the server hosting the parent domain) to make sure that no forwarder will be used when resolving authoritative names.</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep -A4 paul.local /etc/bind/named.conf.local</span></p>
<p><span class="font19">zone &quot;paul.local&quot; IN { type master; file &quot;/etc/bind/db.paul.local&quot;; allow-update { none; };</span></p>
<p><span class="font19">allow-transfer { 10.104.15.20; }; forwarders { };</span></p>
<p><span class="font19">};</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<h4><a name="bookmark5580"></a><span class="font25"><a name="bookmark5581"></a>Technically, you could also set </span><span class="font25" style="font-weight:bold;">allow-transfer </span><span class="font25">to </span><span class="font25" style="font-weight:bold;">{ any; }; </span><span class="font25">while troubleshooting and then refine it later, but this is not needed for delegation.</span></h4>
<h4><a name="bookmark5582"></a><span class="font25"><a name="bookmark5583"></a>Then we add the delegation to our zone database:</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">tail -3 /etc/bind/db.paul.local</span></p>
<p><span class="font19">$ORIGIN test42.paul.local.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">@ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IN NS ns2.test42.paul.local.</span></p></li></ul>
<p><span class="font19">ns2 IN A &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.104.33.31 &nbsp;&nbsp;&nbsp;; the glue record</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<h4><a name="bookmark5584"></a><span class="font25"><a name="bookmark5585"></a>Don't forget to restart </span><span class="font25" style="font-weight:bold;">bind </span><span class="font25">and verify </span><span class="font25" style="font-weight:bold;">/var/log/syslog</span><span class="font25">.</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">service bind9 restart</span></p>
<p><span class="font19">Stopping domain name service...: bind9.</span></p>
<p><span class="font19">Starting domain name service...: bind9.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep paul.local /var/log/syslog | cut -c28- | tail -2</span></p>
<p><span class="font19">named[3202]: zone paul.local/IN: loaded serial 2014100801</span></p>
<p><span class="font19">named[3202]: zone paul.local/IN: sending notifies (serial 2014100801) root@debian7:~#</span></p>
<p><span class="font25" style="font-style:italic;">Note that on your terminal you can type </span><span class="font25" style="font-weight:bold;font-style:italic;">tail -40 /var/log/syslog </span><span class="font25" style="font-style:italic;">because the only reason I use </span><span class="font25" style="font-weight:bold;font-style:italic;">grep</span><span class="font25" style="font-style:italic;">, </span><span class="font25" style="font-weight:bold;font-style:italic;">cut </span><span class="font25" style="font-style:italic;">and </span><span class="font25" style="font-weight:bold;font-style:italic;">tail -2 </span><span class="font25" style="font-style:italic;">is to limit the size of the screenshots in this book.</span></p>
<h4><a name="bookmark5586"></a><span class="font25"><a name="bookmark5587"></a>Next we create a zone database file on the second server, as seen in this screenshot:</span></h4>
<table border="1">
<tr><td colspan="4" style="vertical-align:bottom;">
<p><span class="font19">root@debian7b:~# </span><span class="font19" style="font-weight:bold;">cat /etc/bind/db.test42.paul.local </span><span class="font19">; child zone for classroom teaching</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">$TTL &nbsp;&nbsp;&nbsp;86400</span></p>
<p><span class="font19">$ORIGIN test42</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">.paul.</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">local.</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">@ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IN</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SOA</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ns2.test42.paul 2014100802</span></p>
<p><span class="font19">1h</span></p>
<p><span class="font19">1h</span></p>
<p><span class="font19">2h</span></p>
<p><span class="font19">900 )</span></p></td><td style="vertical-align:top;">
<p><span class="font19">.local. root.test42.paul.local. (</span></p>
<p><span class="font19">; Serial</span></p>
<p><span class="font19">; Refresh</span></p>
<p><span class="font19">; Retry</span></p>
<p><span class="font19">; Expire</span></p>
<p><span class="font19">; Negative Cache TTL</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">;</span></p>
<p><span class="font19">; name servers</span></p></td><td colspan="3" style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">;</span></p>
<p><span class="font19">IN</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">NS</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ns2.test42.paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">.local.</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">IN</span></p></td><td style="vertical-align:top;">
<p><span class="font19">NS</span></p></td><td style="vertical-align:top;">
<p><span class="font19">debian7b.test42</span></p></td><td style="vertical-align:top;">
<p><span class="font19">.paul.local.</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">;</span></p>
<p><span class="font19">; servers</span></p></td><td colspan="3" style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">;</span></p>
<p><span class="font19">ns2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IN</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">A &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.104.</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">33.31</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">debian7b</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IN</span></p></td><td style="vertical-align:top;">
<p><span class="font19">A &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.104.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">33.31</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">testsrv</span></p>
<p><span class="font19">root@debian7b:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IN ~#</span></p></td><td style="vertical-align:top;">
<p><span class="font19">A &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.104.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">33.31</span></p></td></tr>
</table>
<h4><a name="bookmark5588"></a><span class="font25"><a name="bookmark5589"></a>The second server also needs a zone definition in </span><span class="font25" style="font-weight:bold;">named.conf.local</span><span class="font25">, followed by a restart of </span><span class="font25" style="font-weight:bold;">bind</span><span class="font25">.</span></h4>
<p><span class="font19">root@debian7b:~# </span><span class="font19" style="font-weight:bold;">cat /etc/bind/named.conf.local</span></p>
<p><span class="font19">//</span></p>
<p><span class="font19">// Do any local configuration here</span></p>
<p><span class="font19">//</span></p>
<p><span class="font19">// Consider adding the 1918 zones here, if they are not used in your</span></p>
<p><span class="font19">// organization</span></p>
<p><span class="font19">//include &quot;/etc/bind/zones.rfc1918&quot;;</span></p>
<p><span class="font19">zone &quot;test42.paul.local&quot; IN {</span></p>
<p><span class="font19">type master;</span></p>
<p><span class="font19">file &quot;/etc/bind/db.test42.paul.local&quot;;</span></p>
<p><span class="font19">allow-update { none; };</span></p>
<p><span class="font19">allow-transfer { any; };</span></p>
<p><span class="font19">};</span></p>
<p><span class="font19">root@debian7b:~#</span></p>
<h4><a name="bookmark5590"></a><span class="font25"><a name="bookmark5591"></a>Testing on the parent server:</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">dig nsl.paul.local +short</span></p>
<p><span class="font19">10.104.33.30</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">dig ns2.test42.paul.local +short</span></p>
<p><span class="font19">10.104.33.31</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">dig debian7b.test42.paul.local +short</span></p>
<p><span class="font19">10.104.33.31</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5592"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4527"></a><a name="bookmark5593"></a>11.4. example: split-horizon dns</span></h2></li></ul>
<p><span class="font25">Suppose you want to answer dns queries depending on who is asking. For example when someone from the 10.104.15.0/24 network (managed by Jesse) asks for the A record </span><a href="http://www.paul.local"><span class="font25">www.paul.local</span></a><span class="font25">, then dns answers with 10.104.33.30. But when someone from the 10.104.42.0/24 network (managed by Keith) asks for the same A record of </span><a href="http://www.paul.local"><span class="font25">www.paul.local</span></a><span class="font25">, he will get 10.104.33.31 as an answer.</span></p>
<p><span class="font25">A </span><span class="font25" style="font-weight:bold;">split-horizon </span><span class="font25">setup can be used to redirect people to </span><span class="font25" style="font-weight:bold;">local </span><span class="font25">copies of certain services.</span></p>
<p><span class="font25">In this example we want to decide on specific answers for two networks (Jesse's and Keith's) and prevent them from using our dns server for </span><span class="font25" style="font-weight:bold;">recursion</span><span class="font25">, while maintaining the capability to resolve the internet and our paul.local zone from our own network.</span></p>
<p><span class="font25">We start by creating three </span><span class="font25" style="font-weight:bold;">view </span><span class="font25">clauses in </span><span class="font25" style="font-weight:bold;">named.conf.local</span><span class="font25">.</span></p>
<p><span class="font19">root@debian7:/etc/bind# </span><span class="font19" style="font-weight:bold;">cat named.conf.local</span></p>
<p><span class="font19">view &quot;paul&quot; {</span></p>
<p><span class="font19">match-clients { 10.104.33.0; localhost; };</span></p>
<p><span class="font19">include &quot;/etc/bind/named.conf.default-zones&quot;;</span></p>
<p><span class="font19">zone &quot;paul.local&quot; IN {</span></p>
<p><span class="font19">type master;</span></p>
<p><span class="font19">file &quot;/etc/bind/db.paul.local&quot;; allow-update { none; };</span></p>
<p><span class="font19">};</span></p>
<p><span class="font19">}; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// end view internal</span></p>
<p><span class="font19">view &quot;jesse&quot; {</span></p>
<p><span class="font19">match-clients { 10.104.15/24; };</span></p>
<p><span class="font19">zone &quot;paul.local&quot; IN {</span></p>
<p><span class="font19">type master;</span></p>
<p><span class="font19">file &quot;/etc/bind/db.paul.local.jesse&quot;; allow-update { none; };</span></p>
<p><span class="font19">};</span></p>
<p><span class="font19">}; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// end view jesse</span></p>
<p><span class="font19">view &quot;keith&quot; {</span></p>
<p><span class="font19">match-clients { 10.104.42/24; };</span></p>
<p><span class="font19">zone &quot;paul.local&quot; IN {</span></p>
<p><span class="font19">type master;</span></p>
<p><span class="font19">file &quot;/etc/bind/db.paul.local.keith&quot;; allow-update { none; };</span></p>
<p><span class="font19">};</span></p>
<p><span class="font19">}; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// end view keith</span></p>
<p><span class="font25">Note that we included the </span><span class="font25" style="font-weight:bold;">default-zones </span><span class="font25">in the internal zone. It is mandatory to put all zones inside views when using a view.</span></p>
<p><span class="font25">The zone files are identical copies, except for the </span><span class="font25" style="font-weight:bold;">www </span><span class="font25">record. You can see that the </span><span class="font25" style="font-weight:bold;">round robin </span><span class="font25">is still active for internal users, computers from 10.104.15.0/24 (Jesse) will always receive 10.104.33.30 while computers from 10.104.42.0/24 (Keith) will receive 10.104.33.31.</span></p>
<p><span class="font19">root@debian7:/etc/bind# </span><span class="font19" style="font-weight:bold;">grep www db.paul.local db.paul.local.[jk]*</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">db.paul.local:www</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IN</span></p></td><td style="vertical-align:top;">
<p><span class="font19">A</span></p></td><td style="vertical-align:top;">
<p><span class="font19">10.104.33.30</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">db.paul.local:www</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IN</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">A</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10.104.33.31</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">db.paul.local.jesse:www</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IN</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">A</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10.104.33.30</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">db.paul.local.keith:www</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IN</span></p></td><td style="vertical-align:top;">
<p><span class="font19">A</span></p></td><td style="vertical-align:top;">
<p><span class="font19">10.104.33.31</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5594"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4528"></a><a name="bookmark5595"></a>11.5. old dns topics</span></h2></li></ul>
<h4><a name="bookmark5596"></a><span class="font25"><a name="bookmark5597"></a>All the dns things below this paragraph are old and in urgent need of review.</span></h4>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5598"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5599"></a>11.5.1. old example: reverse DNS</span></h3></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5600"></a><span class="font25"><a name="bookmark5601"></a>1. We can add ip to name resolution to our dns-server using a reverse dns zone.</span></h4></li>
<li>
<h4><a name="bookmark5602"></a><span class="font25"><a name="bookmark5603"></a>2. Start by adding a .arpa zone to /etc/bind/named.conf.local like this (we set notify to no to avoid sending of notify messages to other name servers):</span></h4></li></ul>
<p><span class="font19">root@ubu1010srv:/etc/bind# grep -A4 arpa named.conf.local zone &quot;1.168.192.in-addr.arpa&quot; { type master;</span></p>
<p><span class="font19">notify no;</span></p>
<p><span class="font19">file &quot;/etc/bind/db.192&quot;;</span></p>
<p><span class="font19">};</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark5604"></a><span class="font25"><a name="bookmark5605"></a>3. Also create a zone database file for this reverse lookup zone.</span></h4></li></ul>
<p><span class="font19">root@ubu1010srv:/etc/bind# cat db.192 ;</span></p>
<p><span class="font19">; BIND reverse data file for 192.168.1.0/24 network ; $TTL 604800 @ IN SOA ns.cobbaut.paul root.cobbaut.paul. ( 20110516 ; Serial 604800 &nbsp;; Refresh</span></p>
<p><span class="font19">86400 &nbsp;; Retry</span></p>
<p><span class="font19">2419200 &nbsp;; Expire</span></p>
<p><span class="font19">604800 ) ; Negative Cache TTL ; @ IN NS ns.</span></p>
<p><span class="font19">37 IN PTR ns.cobbaut.paul.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">1 IN PTR anya.cobbaut.paul.</span></p></li>
<li>
<p><span class="font19">30 IN PTR mac.cobbaut.paul. root@ubu1010srv:/etc/bind#</span></p></li></ul>
<h4><a name="bookmark5606"></a><span class="font25"><a name="bookmark5607"></a>4. Test with nslookup or dig:</span></h4>
<p><span class="font19">root@ubu1010srv:/etc/bind# dig 1.168.192.in-addr.arpa AXFR</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5608"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5609"></a>11.5.2. old DNS load balancing</span></h3></li></ul>
<p><span class="font25">Not as above. When you have more than one DNS server authoritative for a zone, you can spread queries amongst all server. One way to do this is by creating NS records for all servers that participate in the load balancing of external queries.</span></p>
<p><span class="font25">You could also configure different name servers on internal clients.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5363"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5610"></a>11.5.3. old DNS notify</span></h3></li></ul>
<p><span class="font25">The original design of DNS in rfc 1034 and rfc 1035 implemented a </span><span class="font25" style="font-weight:bold;">refresh </span><span class="font25">time in the </span><span class="font25" style="font-weight:bold;">SOA </span><span class="font25">record to configure a time loop for slaves to query their master server. This can result in a lot of useless pull requests, or in a significant lag between updates.</span></p>
<p><span class="font25">For this reason </span><span class="font25" style="font-weight:bold;">dns notify (rfc 1996) </span><span class="font25">was designed. The server will now notify slaves whenever there is an update. By default this feature is activated in </span><span class="font25" style="font-weight:bold;">bind</span><span class="font25">.</span></p>
<p><span class="font25">Notify can be disabled as in this screenshot.</span></p>
<p><span class="font19">zone &quot;1.168.192.in-addr.arpa&quot; {</span></p>
<p><span class="font19">type master;</span></p>
<p><span class="font19">notify no;</span></p>
<p><span class="font19">file &quot;/etc/bind/db.192&quot;;</span></p>
<p><span class="font19">};</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5611"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5612"></a>11.5.4. old testing IXFR and AXFR</span></h3></li></ul>
<p><span class="font25">Full zone transfers (AXFR) are initiated when you restart the bind server, or when you manually update the zone database file directly. With </span><span class="font25" style="font-weight:bold;">nsupdate </span><span class="font25">you can update a zone database and initiate an incremental zone transfer.</span></p>
<p><span class="font25">You need DDNS allowed for </span><span class="font25" style="font-weight:bold;">nsupdate </span><span class="font25">to work.</span></p>
<p><span class="font19">root@ubu1010srv:/etc/bind# nsupdate</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">&gt; server 127.0.0.1</span></p></li>
<li>
<p><span class="font19">&gt; update add mac14.linux-training.be 86400 A 192.168.1.23</span></p></li>
<li>
<p><span class="font19">&gt; send</span></p></li></ul>
<p><span class="font19">update failed: REFUSED</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5613"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5614"></a>11.5.5. old DDNS integration with DHCP</span></h3></li></ul>
<p><span class="font25">Some organizations like to have all their client computers in DNS. This can be cumbersome to maintain. Luckily </span><span class="font25" style="font-weight:bold;">rfc 2136 </span><span class="font25">describes integration of DHCP servers with a DNS server. Whenever DHCP acknowledges a client ip configuration, it can notify DNS with this clients ip-address and name. This is called </span><span class="font25" style="font-weight:bold;">dynamic updates </span><span class="font25">or DDNS.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5615"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5616"></a>11.5.6. old reverse is forward in-addr.arpa</span></h3></li></ul>
<p><span class="font25">Reverse lookup is actually iomplemented as a forward lookup in the </span><span class="font25" style="font-weight:bold;">in-addr.arpa </span><span class="font25">domain. This domain has 256 child domains (from 0.in-addr.arpa to 255.in-addr.arpa), with each child domain having again 256 child domains. And this twice more to a structure of over four billion (2 to the power 32) domains.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5617"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5618"></a>11.5.7. old ipv6</span></h3></li></ul>
<p><span class="font25">With rfc 3596 came ipv6 extensions for DNS. There is the AAAA record for ipv6 hosts on the network, and there is the </span><span class="font25" style="font-weight:bold;">ip6.int </span><span class="font25">domain for reverse lookup (having 16 child domains from 0.ip6.int to f.ip6.int, each of those having again 16 child domains...and this 16 times.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5619"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5620"></a>11.5.8. old DNS security: file corruption</span></h3></li></ul>
<p><span class="font25">To mitigate file corruption on the </span><span class="font25" style="font-weight:bold;">zone files </span><span class="font25">and the </span><span class="font25" style="font-weight:bold;">bind configuration </span><span class="font25">files protect them with Unix permissions and take regular backups.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5621"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5622"></a>11.5.9. old DNS security: zone transfers</span></h3></li></ul>
<p><span class="font25">Limit zone transfers to certain ip addresses instead of to </span><span class="font25" style="font-weight:bold;">any</span><span class="font25">. Nevermind that ip-addresses can be spoofed, still use this.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5623"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5624"></a>11.5.10. old DNS security: zone transfers, ip spoofing</span></h3></li></ul>
<p><span class="font25">You could setup DNSSEC (which is not the easiest to maintain) and with rfc 2845(tsig?) and with rfc 2930(tkey, but this is open to brute force), or you could disable all zone transfers and use a script with ssh to copy them manually.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5625"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5626"></a>11.5.11. old DNS security: queries</span></h3></li></ul>
<p><span class="font25">Allow recursion only from the local network, and iterative queries from outside only when necessary. This can be configured on master and slave servers.</span></p>
<p><span class="font19">view &quot;internal&quot; {</span></p>
<p><span class="font19">match-clients { 192.168.42/24; };</span></p>
<p><span class="font19">recursion yes; ...</span></p>
<p><span class="font19">};</span></p>
<p><span class="font19">view &quot;external&quot; {</span></p>
<p><span class="font19">match-clients { any; };</span></p>
<p><span class="font19">recursion no;</span></p>
<p><span class="font19">};</span></p>
<p><span class="font25">Or allow only queries from the local network.</span></p>
<p><span class="font19">options { allow-query { 192.168.42.0/24; localhost; };</span></p>
<p><span class="font19">};</span></p>
<p><span class="font19">zone &quot;cobbaut.paul&quot; { allow-query { any; };</span></p>
<p><span class="font19">};</span></p>
<p><span class="font25">Or only allow recursive queries from internal clients.</span></p>
<p><span class="font19">options {</span></p>
<p><span class="font19">allow-recursion { 192.168.42.0/24; localhost; };</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5627"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5628"></a>11.5.12. old DNS security: chrooted bind</span></h3></li></ul>
<p><span class="font25">Most Linux distributions allow an easy setup of bind in a </span><span class="font25" style="font-weight:bold;">chrooted </span><span class="font25">environment.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5629"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5630"></a>11.5.13. old DNS security: DNSSEC</span></h3></li></ul>
<p><span class="font25">DNSSEC uses public/private keys to secure communications, this is described in rfc's 4033, 4034 and 4035.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5631"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5632"></a>11.5.14. old DNS security: root</span></h3></li></ul>
<p><span class="font25">Do not run bind as root. Do not run any application daemon as root.</span></p>
<p><a name="bookmark5633"></a><span class="font11" style="font-weight:bold;">Part IV. dhcp server</span></p>
<h3><a name="bookmark5634"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5635"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5636"><span class="font24" style="font-weight:bold;">12. introduction to dhcp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark4769"><span class="font24">12.1. four broadcasts </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5637"><span class="font24">12.2. picturing dhcp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5638"><span class="font24">12.3. installing a dhcp server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5639"><span class="font24">12.4. dhcp server for RHEL/CentOS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5640"><span class="font24">12.5. client reservations </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5641"><span class="font24">12.6. example config files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5642"><span class="font24">12.7. older example config files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5643"><span class="font24">12.8. advanced dhcp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5644"><span class="font24">12.9. Practice: dhcp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark5645"></a><span class="font11" style="font-weight:bold;"><a name="bookmark4530"></a><a name="bookmark5646"></a>Chapter 12. introduction to dhcp</span></h1></li></ul>
<p><span class="font25">Dynamic Host Configuration Protocol (or short </span><span class="font25" style="font-weight:bold;">dhcp</span><span class="font25">) is a standard tcp/ip protocol that distributes ip configurations to clients. </span><span class="font25" style="font-weight:bold;">dhcp </span><span class="font25">is defined in </span><span class="font25" style="font-weight:bold;">rfc 2131 </span><span class="font25">(before that it was defined as an update to </span><span class="font25" style="font-weight:bold;">bootp </span><span class="font25">in rfc 1531/1541.</span></p>
<p><span class="font25">The alternative to </span><span class="font25" style="font-weight:bold;">dhcp </span><span class="font25">is manually entering the ip configuration on each client computer.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5647"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4531"></a><a name="bookmark5648"></a>12.1. four broadcasts</span></h2></li></ul>
<p><span class="font25" style="font-weight:bold;">dhcp </span><span class="font25">works with layer 2 broadcasts. A dhcp client that starts, will send a </span><span class="font25" style="font-weight:bold;">dhcp discover </span><span class="font25">on the network. All </span><span class="font25" style="font-weight:bold;">dhcp servers </span><span class="font25">(that have a lease available) will respond with a </span><span class="font25" style="font-weight:bold;">dhcp offer</span><span class="font25">. The client will choose one of those offers and will send a </span><span class="font25" style="font-weight:bold;">dhcp request </span><span class="font25">containing the chosen offer. The </span><span class="font25" style="font-weight:bold;">dhcp server </span><span class="font25">usually responds with a </span><span class="font25" style="font-weight:bold;">dhcp ack</span><span class="font25">(knowledge).</span></p>
<p><span class="font25">In wireshark it looks like this.</span></p><img src="linux_guide_files/The Complete Linux Guide-121.jpg" alt="" style="width:403pt;height:305pt;">
<p><span class="font25">When this procedure is finished, then the client is allowed to use that ip-configuration until the end of its lease time.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5649"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4532"></a><a name="bookmark5650"></a>12.2. picturing dhcp</span></h2></li></ul>
<p><span class="font25">Here we have a small network with two </span><span class="font25" style="font-weight:bold;">dhcp servers </span><span class="font25">named DHCP-SRV1 and DHCP-SRV2 and two clients (SunWS1 and Mac42). All computers are connected by a hub or switch (pictured in the middle). All four computers have a cable to the hub (cables not pictured).</span></p>
<p><span class="font2">DHCP-SRV1</span></p><img src="linux_guide_files/The Complete Linux Guide-122.jpg" alt="" style="width:396pt;height:272pt;">
<p><span class="font2">Mac42</span></p>
<p><span class="font2">192.168.1.21</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">1. The client SunWS1 sends a </span><span class="font25" style="font-weight:bold;">dhcp discover </span><span class="font25">on the network. All computers receive this broadcast.</span></p></li>
<li>
<p><span class="font25">2. Both </span><span class="font25" style="font-weight:bold;">dhcp servers </span><span class="font25">answer with a </span><span class="font25" style="font-weight:bold;">dhcp offer</span><span class="font25">. DHCP-SRV1 is a </span><span class="font25" style="font-weight:bold;">dedicated dhcp server </span><span class="font25">and is faster in sending a </span><span class="font25" style="font-weight:bold;">dhcp offer </span><span class="font25">than DHCP-SRV2 (who happens to also be a file server).</span></p></li>
<li>
<p><span class="font25">3. The client chooses the offer from DHCP-SRV1 and sends a </span><span class="font25" style="font-weight:bold;">dhcp request </span><span class="font25">on the network.</span></p></li>
<li>
<p><span class="font25">4. DHCP-SRV1 answers with a </span><span class="font25" style="font-weight:bold;">dhcp ack </span><span class="font25">(short for acknowledge).</span></p></li></ul>
<p><span class="font25">All four broadcasts (or five when you count both offers) can be layer 2 ethernet broadcast to mac address </span><span class="font25" style="font-weight:bold;">ff:ff:ff:ff:ff:ff </span><span class="font25">and a layer 3 ip broadcast to 255.255.255.255.</span></p>
<p><span class="font25">The same story can be read in </span><span class="font25" style="font-weight:bold;">rfc 2131</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5651"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4533"></a><a name="bookmark5652"></a>12.3. installing a dhcp server</span></h2></li></ul>
<h4><a name="bookmark5653"></a><span class="font25"><a name="bookmark5654"></a>dhcp server for Debian/Mint</span></h4>
<p><span class="font19">debian5:~# aptitude install dhcp3-server Reading package lists... Done Building dependency tree Reading state information... Done Reading extended state information Initializing package states... Done Reading task descriptions... Done The following NEW packages will be installed: dhcp3-server</span></p>
<h4><a name="bookmark5655"></a><span class="font25"><a name="bookmark5656"></a>You get a configuration file with many examples.</span></h4>
<p><span class="font19">debian5:~# ls -l /etc/dhcp3/dhcpd.conf</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-r--r-- 1 root root 3551 2011-04-10 21:23 /etc/dhcp3/dhcpd.conf</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5657"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4534"></a><a name="bookmark5658"></a>12.4. dhcp server for RHEL/CentOS</span></h2></li></ul>
<h4><a name="bookmark5659"></a><span class="font25"><a name="bookmark5660"></a>Installing is easy with </span><span class="font25" style="font-weight:bold;">yum</span><span class="font25">.</span></h4>
<p><span class="font19">[root@rhel71 ~]# </span><span class="font19" style="font-weight:bold;">yum install dhcp </span><span class="font19">Loaded plugins: product-id, subscription-manager Resolving Dependencies</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- -&gt; Running transaction check ---&gt; Package dhcp.x86_64 12:4.2.5-36.el7 will be installed --&gt; Finished Dependency Resolution</span></p></li></ul>
<p><span class="font19">Dependencies Resolved</span></p>
<p><span class="font19">Package Arch &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Version &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Repository &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size</span></p>
<p><span class="font19">Installing: dhcp &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x86_64 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;12:4.2.5-36.el7 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rhel-7-server-rpms &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;510 k</span></p>
<p><span class="font19">Transaction Summary</span></p>
<p><span class="font19">Install 1 Package</span></p>
<p><span class="font19">Total download size: 510 k Installed size: 1.4 M Is this ok [y/d/N]: y Downloading packages: dhcp-4.2.5-36.el7.x86_64.rpm &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 510 kB 00:01</span></p>
<p><span class="font19">Running transaction check Running transaction test Transaction test succeeded Running transaction</span></p>
<p><span class="font19">Installing : 12:dhcp-4.2.5-36.el7.x86_64 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1/1</span></p>
<p><span class="font19">Verifying : 12:dhcp-4.2.5-36.el7.x86_64 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1/1</span></p>
<p><span class="font19">Installed: dhcp.x86_64 12:4.2.5-36.el7</span></p>
<p><span class="font19">Complete! [root@rhel71 ~]#</span></p>
<h4><a name="bookmark5661"></a><span class="font25"><a name="bookmark5662"></a>After installing we get a </span><span class="font25" style="font-weight:bold;">/etc/dhcp/dhcpd.conf </span><span class="font25">that points us to an example file named </span><span class="font25" style="font-weight:bold;">dhcpd.conf.sample</span><span class="font25">.</span></h4>
<p><span class="font19">[root@rhel71 ~]# </span><span class="font19" style="font-weight:bold;">cat /etc/dhcp/dhcpd.conf </span><span class="font19">#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># DHCP Server Configuration file.</span></p></li>
<li>
<p><span class="font19"># see /usr/share/doc/dhcp*/dhcpd.conf.example</span></p></li>
<li>
<p><span class="font19"># see dhcpd.conf(5) man page</span></p></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font19">#</span></p></li></ul>
<p><span class="font19">[root@rhel71 ~]#</span></p>
<h4><a name="bookmark5663"></a><span class="font25"><a name="bookmark5664"></a>So we copy the sample and adjust it for our real situation. We name the copy </span><span class="font25" style="font-weight:bold;">/etc/dhcp/ dhcpd.conf</span><span class="font25">.</span></h4>
<p><span class="font19">[root@rhel71 ~]# </span><span class="font19" style="font-weight:bold;">cp /usr/share/doc/dhcp-4.2.5/dhcpd.conf.example /etc/dhcp/dhcp\ d.conf</span></p>
<p><span class="font19">[root@rhel71 ~]# </span><span class="font19" style="font-weight:bold;">vi /etc/dhcp/dhcpd.conf</span></p>
<p><span class="font19">[root@rhel71 ~]# </span><span class="font19" style="font-weight:bold;">cat /etc/dhcp/dhcpd.conf</span></p>
<p><span class="font19">option domain-name &quot;linux-training.be&quot;;</span></p>
<p><span class="font19">option domain-name-servers 10.42.42.42;</span></p>
<p><span class="font19">default-lease-time 600;</span></p>
<p><span class="font19">max-lease-time 7200;</span></p>
<p><span class="font19">log-facility local7;</span></p>
<p><span class="font19">subnet 10.42.0.0 netmask 255.255.0.0 {</span></p>
<p><span class="font19">range 10.42.200.11 10.42.200.120;</span></p>
<p><span class="font19">option routers 10.42.200.1;</span></p>
<p><span class="font19">} [root@rhel71 ~]#</span></p>
<h4><a name="bookmark5665"></a><span class="font25"><a name="bookmark5666"></a>The 'routers' option is valid for the subnet alone, whereas the 'domain-name' option is global (for all subnets).</span></h4>
<h4><a name="bookmark5667"></a><span class="font25"><a name="bookmark5668"></a>Time to start the server. Remember to use </span><span class="font25" style="font-weight:bold;">systemctl start dhcpd </span><span class="font25">on RHEL7/CentOS7 and </span><span class="font25" style="font-weight:bold;">service dhcpd start </span><span class="font25">on previous versions of RHEL/CentOS.</span></h4>
<p><span class="font19">[root@rhel71 ~]# </span><span class="font19" style="font-weight:bold;">systemctl start dhcpd</span></p>
<p><span class="font19">[root@rhel71 ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5669"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4535"></a><a name="bookmark5670"></a>12.5. client reservations</span></h2></li></ul>
<h4><a name="bookmark5671"></a><span class="font25"><a name="bookmark5672"></a>You can reserve an ip configuration for a client using the mac address.</span></h4>
<p><span class="font19">host pc42 {</span></p>
<p><span class="font19">hardware ethernet 11:22:33:44:55:66;</span></p>
<p><span class="font19">fixed-address 192.168.42.42;</span></p>
<p><span class="font19">}</span></p>
<h4><a name="bookmark5673"></a><span class="font25"><a name="bookmark5674"></a>You can add individual options to this reservation.</span></h4>
<p><span class="font19">host pc42 {</span></p>
<p><span class="font19">hardware ethernet 11:22:33:44:55:66;</span></p>
<p><span class="font19">fixed-address 192.168.42.42;</span></p>
<p><span class="font19">option domain-name &quot;linux-training.be&quot;;</span></p>
<p><span class="font19">option routers 192.168.42.1;</span></p>
<p><span class="font19">}</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5675"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4536"></a><a name="bookmark5676"></a>12.6. example config files</span></h2></li></ul>
<h4><a name="bookmark5677"></a><span class="font25"><a name="bookmark5678"></a>Below you see several sections of </span><span class="font25" style="font-weight:bold;">/etc/dhcp/dhcpd.conf </span><span class="font25">on a </span><span class="font25" style="font-weight:bold;">Debian 6 </span><span class="font25">server.</span></h4>
<ul style="list-style:none;"><li>
<p><span class="font19"># NetSec Antwerp Network</span></p></li></ul>
<p><span class="font19">subnet 192.168.1.0 netmask 255.255.255.0 {</span></p>
<p><span class="font19">range 192.168.1.20 192.168.1.199;</span></p>
<p><span class="font19">option domain-name-servers ns1.netsec.local;</span></p>
<p><span class="font19">option domain-name &quot;netsec.local&quot;;</span></p>
<p><span class="font19">option routers 192.168.1.1;</span></p>
<p><span class="font19">option broadcast-address 192.168.1.255;</span></p>
<p><span class="font19">default-lease-time 7200; max-lease-time 7200;</span></p>
<p><span class="font19">}</span></p>
<h4><a name="bookmark5679"></a><span class="font25"><a name="bookmark5680"></a>Above the general configuration for the network, with a pool of 180 addresses.</span><br><br><span class="font25"><a name="bookmark5681"></a>Below two client reservations:</span></h4>
<p><span class="font19">#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># laptops</span></p></li>
<li>
<p><span class="font19">#</span></p></li></ul>
<p><span class="font19">host mac {</span></p>
<p><span class="font19">hardware ethernet 00:26:bb:xx:xx:xx; fixed-address mac.netsec.local;</span></p>
<p><span class="font19">}</span></p>
<p><span class="font19">host vmac { hardware ethernet 8c:7b:9d:xx:xx:xx; fixed-address vmac.netsec.local;</span></p>
<p><span class="font19">}</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5682"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4537"></a><a name="bookmark5683"></a>12.7. older example config files</span></h2></li></ul>
<h4><a name="bookmark5684"></a><span class="font25"><a name="bookmark5685"></a>For dhcpd.conf on Fedora with dynamic updates for a DNS domain.</span></h4>
<ul style="list-style:none;"><li>
<p><span class="font19">[root@fedora14 ~]# cat /etc/dhcp/dhcpd.conf authoritative;</span></p></li></ul>
<p><span class="font19">include &quot;/etc/rndc.key&quot;;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">log-facility local6;</span></p></li></ul>
<p><span class="font19">server-identifier fedora14;</span></p>
<p><span class="font19">ddns-domainname &quot;office.linux-training.be&quot;;</span></p>
<p><span class="font19">ddns-update-style interim;</span></p>
<p><span class="font19">ddns-updates on;</span></p>
<p><span class="font19">update-static-leases on;</span></p>
<p><span class="font19">option domain-name &quot;office.linux-training.be&quot;;</span></p>
<p><span class="font19">option domain-name-servers 192.168.42.100;</span></p>
<p><span class="font19">option ip-forwarding off;</span></p>
<p><span class="font19">default-lease-time 1800;</span></p>
<p><span class="font19">max-lease-time 3600;</span></p>
<p><span class="font19">zone office.linux-training.be { primary 192.168.42.100;</span></p>
<p><span class="font19">}</span></p>
<p><span class="font19">subnet 192.168.4.0 netmask 255.255.255.0 { range 192.168.4.24 192.168.4.40;</span></p>
<p><span class="font19">}</span></p>
<h4><a name="bookmark5686"></a><span class="font25"><a name="bookmark5687"></a>Allowing any updates in the zone database (part of the named.conf configuration)</span></h4>
<p><span class="font19">zone &quot;office.linux-training.be&quot; {</span></p>
<p><span class="font19">type master;</span></p>
<p><span class="font19">file &quot;/var/named/db.office.linux-training.be&quot;;</span></p>
<p><span class="font19">allow-transfer { any; };</span></p>
<p><span class="font19">allow-update { any; };</span></p>
<p><span class="font19">};</span></p>
<h4><a name="bookmark5688"></a><span class="font25"><a name="bookmark5689"></a>Allowing secure key updates in the zone database (part of the named.conf configuration)</span></h4>
<p><span class="font19">zone &quot;office.linux-training.be&quot; {</span></p>
<p><span class="font19">type master;</span></p>
<p><span class="font19">file &quot;/var/named/db.office.linux-training.be&quot;;</span></p>
<p><span class="font19">allow-transfer { any; };</span></p>
<p><span class="font19">allow-update { key mykey; };</span></p>
<p><span class="font19">};</span></p>
<h4><a name="bookmark5690"></a><span class="font25"><a name="bookmark5691"></a>Sample key file contents:</span></h4>
<p><span class="font19">[root@fedora14 ~]# cat /etc/rndc.key</span></p>
<p><span class="font19">key &quot;rndc-key&quot; {</span></p>
<p><span class="font19">algorithm hmac-md5;</span></p>
<p><span class="font19">secret &quot;4Ykd58uIeUr3Ve6ad1qTfQ==&quot;;</span></p>
<p><span class="font19">};</span></p>
<h4><a name="bookmark5692"></a><span class="font25"><a name="bookmark5693"></a>Generate your own keys with </span><span class="font25" style="font-weight:bold;">dnssec-keygen</span><span class="font25">.</span><br><br><span class="font25"><a name="bookmark5694"></a>How to include a key in a config file:</span></h4>
<p><span class="font19">include &quot;/etc/bind/rndc.key&quot;;</span></p>
<h4><a name="bookmark5695"></a><span class="font25"><a name="bookmark5696"></a>Also make sure that </span><span class="font25" style="font-weight:bold;">bind </span><span class="font25">can write to your db.zone file (using chmod/chown). For Ubuntu this can be in /etc/bind, for Fedora in /var/named.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5697"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4538"></a><a name="bookmark5698"></a>12.8. advanced dhcp</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark5699"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5700"></a>12.8.1. 80/20 rule</span></h3></li></ul></li></ul>
<p><span class="font25">DHCP servers should not be a single point of failure. Let us discuss redundant dhcp server setups.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5701"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5702"></a>12.8.2. relay agent</span></h3></li></ul>
<p><span class="font25">To avoid having to place a dhcp server on every segment, we can use </span><span class="font25" style="font-weight:bold;">dhcp relay agents</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5703"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5704"></a>12.8.3. rogue dhcp servers</span></h3></li></ul>
<p><span class="font25">Rogue dhcp servers are a problem without a solution. For example accidental connection of a (believed to be simple) hub/switch to a network with an internal dhcp server.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5705"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5706"></a>12.8.4. dhcp and ddns</span></h3></li></ul>
<p><span class="font25">DHCP can dynamically update DNS when it configures a client computer. DDNS can be used with or without secure keys.</span></p>
<p><span class="font25">When set up properly records can be added automaticall to the zone file:</span></p>
<p><span class="font19">root@fedora14~# tail -2 /var/named/db.office.linux-training.be</span></p>
<p><span class="font19">ubu1010srv &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A 192.168.42.151</span></p>
<p><span class="font19">TXT &quot;00dfbb15e144a273c3cf2d6ae933885782&quot;</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5707"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3116"></a><a name="bookmark5708"></a>12.9. Practice: dhcp</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Make sure you have a unique fixed ip address for your DNS and DHCP server (easier on the same machine).</span></p></li>
<li>
<p><span class="font25">2. Install DHCP and browse the explanation in the default configuration file /etc/dhcp/ dhcpd.conf or /etc/dhcp3/dhcpd.conf.</span></p></li>
<li>
<p><span class="font25">3. Decide on a valid scope and activate it.</span></p></li>
<li>
<p><span class="font25">4. Test with a client that your DHCP server works.</span></p></li>
<li>
<p><span class="font25">5. Use wireshark to capture the four broadcasts when a client receives an ip (for the first time).</span></p></li>
<li>
<p><span class="font25">6. Use wireshark to capture a DHCPNAK and a DHCPrelease.</span></p></li>
<li>
<p><span class="font25">7. Reserve a configuration for a particular client (using mac address).</span></p></li>
<li>
<p><span class="font25">8. Configure your DHCP/DNS server(s) with a proper hostname and domainname (/etc/ hosts, /etc/hostname, /etc/sysconfig/network on Fedora/RHEL, /etc/resolv.conf ...). You may need to disable NetworkManager on *buntu-desktops.</span></p></li>
<li>
<p><span class="font25">9. Make sure your DNS server still works, and is master over (at least) one domain.</span></p></li></ul>
<p><span class="font25">There are several ways to do steps 10-11-12. Google is your friend in exploring DDNS with keys, with key-files or without keys.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">10. Configure your DNS server to allow dynamic updates from your DHCP server.</span></p></li>
<li>
<p><span class="font25">11. Configure your DHCP server to send dynamic updates to your DNS server.</span></p></li>
<li>
<p><span class="font25">12. Test the working of Dynamic DNS.</span></p></li></ul>
<p><a name="bookmark5709"></a><span class="font11" style="font-weight:bold;">Part V. iptables firewall</span></p>
<h3><a name="bookmark5710"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5711"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5712"><span class="font24" style="font-weight:bold;">13. introduction to routers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5713"><span class="font24">13.1. router or firewall </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5714"><span class="font24">13.2. packet forwarding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5715"><span class="font24">13.3. packet filtering </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5716"><span class="font24">13.4. stateful </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5717"><span class="font24">13.5. nat (network address translation) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5718"><span class="font24">13.6. pat (port address translation) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5719"><span class="font24">13.7. snat (source nat) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5720"><span class="font24">13.8. masquerading </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5721"><span class="font24">13.9. dnat (destination nat) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5722"><span class="font24">13.10. port forwarding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5723"><span class="font24">13.11. /proc/sys/net/ipv4/ip_forward </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5724"><span class="font24">13.12. /etc/sysctl.conf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5725"><span class="font24">13.13. sysctl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5726"><span class="font24">13.14. practice: packet forwarding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5727"><span class="font24">13.15. solution: packet forwarding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5728"><span class="font24" style="font-weight:bold;">14. iptables firewall </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5729"><span class="font24">14.1. iptables tables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5730"><span class="font24">14.2. starting and stopping iptables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5731"><span class="font24">14.3. the filter table </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5732"><span class="font24">14.4. practice: packet filtering </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5733"><span class="font24">14.5. solution: packet filtering </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5734"><span class="font24">14.6. network address translation </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark5735"></a><span class="font11" style="font-weight:bold;"><a name="bookmark4541"></a><a name="bookmark5736"></a>Chapter 13. introduction to routers</span></h1></li></ul>
<p><span class="font25">What follows is a very brief introduction to using Linux as a router.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5737"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4542"></a><a name="bookmark5738"></a>13.1. router or firewall</span></h2></li></ul>
<p><a name="bookmark5739"></a><span class="font25"><a name="bookmark5740"></a>A </span><span class="font25" style="font-weight:bold;">router </span><span class="font25">is a device that connects two networks. A </span><span class="font25" style="font-weight:bold;">firewall </span><span class="font25">is a device that besides acting as a </span><span class="font25" style="font-weight:bold;">router</span><span class="font25">, also contains (and implements) rules to determine whether packets are allowed to travel from one network to another. A firewall can be configured to block access based on networks, hosts, protocols and ports. Firewalls can also change the contents of packets while forwarding them.</span></p><img src="linux_guide_files/The Complete Linux Guide-123.jpg" alt="" style="width:397pt;height:120pt;">
<ul style="list-style:none;"><li>
<h2><a name="bookmark5741"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4543"></a><a name="bookmark5742"></a>13.2. packet forwarding</span></h2></li></ul>
<p><a name="bookmark5743"></a><span class="font25" style="font-weight:bold;">Packet forwarding </span><span class="font25">means allowing packets to go from one network to another. When a multihomed host is connected to two different networks, and it allows packets to travel from one network to another through its two network interfaces, it is said to have enabled </span><span class="font25" style="font-weight:bold;">packet forwarding</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5744"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4544"></a><a name="bookmark5745"></a>13.3. packet filtering</span></h2></li></ul>
<p><a name="bookmark5746"></a><span class="font25" style="font-weight:bold;">Packet filtering </span><span class="font25">is very similar to packet forwarding, but every packet is individually tested against rules that decide on allowing or dropping the packet. The rules are stored by iptables.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5747"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4545"></a><a name="bookmark5748"></a>13.4. stateful</span></h2></li></ul>
<p><a name="bookmark5749"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">stateful </span><span class="font25">firewall is an advancement over stateless firewalls that inspect every individual packet. A stateful firewall will keep a table of active connections, and is knowledgeable enough to recognise when new connections are part of an active session. Linux iptables is a stateful firewall.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5750"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4546"></a><a name="bookmark5751"></a>13.5. nat (network address translation)</span></h2></li></ul>
<p><a name="bookmark5752"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">nat </span><span class="font25">device is a router that is also changing the source and/or target ip-address in packets. It is typically used to connect multiple computers in a private address range (rfc 1918) with the (public) internet. A </span><span class="font25" style="font-weight:bold;">nat </span><span class="font25">can hide private addresses from the internet.</span></p>
<p><span class="font25">It is important to understand that people and vendors do not always use the right term when referring to a certain type of </span><span class="font25" style="font-weight:bold;">nat</span><span class="font25">. Be sure you talk about the same thing. We can distuinguish several types of </span><span class="font25" style="font-weight:bold;">nat</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5753"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4547"></a><a name="bookmark5754"></a>13.6. pat (port address translation)</span></h2></li></ul>
<p><a name="bookmark5755"></a><span class="font25" style="font-weight:bold;"><a name="bookmark5756"></a>nat </span><span class="font25">often includes </span><span class="font25" style="font-weight:bold;">pat</span><span class="font25">. A </span><span class="font25" style="font-weight:bold;">pat </span><span class="font25">device is a router that is also changing the source and/or target tcp/udp port in packets. </span><span class="font25" style="font-weight:bold;">pat </span><span class="font25">is Cisco terminology and is used by </span><span class="font25" style="font-weight:bold;">snat</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">dnat</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">masquerading </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">port forwarding </span><span class="font25">in Linux. RFC 3022 calls it </span><span class="font25" style="font-weight:bold;">NAPT </span><span class="font25">and defines the </span><span class="font25" style="font-weight:bold;">nat/pat </span><span class="font25">combo as &quot;traditional nat&quot;. A device sold to you as a nat-device will probably do </span><span class="font25" style="font-weight:bold;">nat </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">pat</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5757"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4548"></a><a name="bookmark5758"></a>13.7. snat (source nat)</span></h2></li></ul>
<p><a name="bookmark5759"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">snat </span><span class="font25">device is changing the source ip-address when a packet passes our </span><span class="font25" style="font-weight:bold;">nat</span><span class="font25">. </span><span class="font25" style="font-weight:bold;">snat </span><span class="font25">configuration with iptables includes a fixed target source address.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5760"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4549"></a><a name="bookmark5761"></a>13.8. masquerading</span></h2></li></ul>
<p><a name="bookmark5762"></a><span class="font25" style="font-weight:bold;">Masquerading </span><span class="font25">is a form of </span><span class="font25" style="font-weight:bold;">snat </span><span class="font25">that will hide the (private) source ip-addresses of your private network using a public ip-address. Masquerading is common on dynamic internet interfaces (broadband modem/routers). Masquerade configuration with iptables uses a dynamic target source address.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5763"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4550"></a><a name="bookmark5764"></a>13.9. dnat (destination nat)</span></h2></li></ul>
<p><a name="bookmark5765"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">dnat </span><span class="font25">device is changing the destination ip-address when a packet passes our </span><span class="font25" style="font-weight:bold;">nat</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5766"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4551"></a><a name="bookmark5767"></a>13.10. port forwarding</span></h2></li></ul>
<p><a name="bookmark5768"></a><span class="font25">When static </span><span class="font25" style="font-weight:bold;">dnat </span><span class="font25">is set up in a way that allows outside connections to enter our private network, then we call it </span><span class="font25" style="font-weight:bold;">port forwarding</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5769"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4552"></a><a name="bookmark5770"></a>13.11. /proc/sys/net/ipv4/ip_forward</span></h2></li></ul>
<p><a name="bookmark5771"></a><span class="font25">Whether a host is forwarding packets is defined in </span><span class="font25" style="font-weight:bold;">/proc/sys/net/ipv4/ip_forward</span><span class="font25">. The following screenshot shows how to enable packet forwarding on Linux.</span></p>
<p><span class="font19">root@router~# echo 1 &gt;&nbsp;/proc/sys/net/ipv4/ip_forward</span></p>
<p><span class="font25">The next command shows how to disable packet forwarding.</span></p>
<p><span class="font19">root@router~# echo 0 &gt;&nbsp;/proc/sys/net/ipv4/ip_forward</span></p>
<p><span class="font25">Use cat to check if packet forwarding is enabled.</span></p>
<p><span class="font19">root@router~# cat /proc/sys/net/ipv4/ip_forward</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5772"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4553"></a><a name="bookmark5773"></a>13.12. /etc/sysctl.conf</span></h2></li></ul>
<p><a name="bookmark5774"></a><span class="font25">By default, most Linux computers are not configured for automatic packet forwarding. To enable packet forwarding whenever the system starts, change the </span><span class="font25" style="font-weight:bold;">net.ipv4.ip_forward </span><span class="font25">variable in </span><span class="font25" style="font-weight:bold;">/etc/sysctl.conf </span><span class="font25">to the value 1.</span></p>
<p><span class="font19">root@router~# grep ip_forward /etc/sysctl.conf net.ipv4.ip_forward = 0</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5775"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4554"></a><a name="bookmark5776"></a>13.13. sysctl</span></h2></li></ul>
<p><a name="bookmark5777"></a><span class="font25">For more information, take a look at the man page of </span><span class="font25" style="font-weight:bold;">sysctl</span><span class="font25">.</span></p>
<p><span class="font19">root@debian6~# man sysctl</span></p>
<p><span class="font19">root@debian6~# sysctl -a 2&gt;/dev/null | grep ip_forward</span></p>
<p><span class="font19">net.ipv4.ip_forward = 0</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5778"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4555"></a><a name="bookmark5779"></a>13.14. practice: packet forwarding</span></h2></li></ul>
<p><a name="bookmark5780"></a><span class="font25"><a name="bookmark5781"></a>0. You have the option to select (or create) an internal network when adding a network card in </span><span class="font25" style="font-weight:bold;">VirtualBox </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">VMWare</span><span class="font25">. Use this option to create two internal networks. I named them </span><span class="font25" style="font-weight:bold;">leftnet </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">rightnet</span><span class="font25">, but you can choose any other name.</span></p>
<p><span class="font25" style="font-weight:bold;">IsP Network</span></p>
<p><span class="font5">Adapter 1. Intel PRO/1000 MT Desktop (Bridged Adapter, enl: AirPort)</span></p>
<p><span class="font5">Adapter 2: &nbsp;Intel PRO/1000 MT Desktop (Internal Network, 'Ie ft net<sup>1</sup>)</span></p>
<p><span class="font5">Adapter 3: Intel PRO/1000 MT Desktop (Internal Network, 'rightnet')</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Set up two Linux machines, one on </span><span class="font25" style="font-weight:bold;">leftnet</span><span class="font25">, the other on </span><span class="font25" style="font-weight:bold;">rightnet</span><span class="font25">. Make sure they both get an ip-address in the correct subnet. These two machines will be 'left' and 'right' from the 'router'.</span></p><img src="linux_guide_files/The Complete Linux Guide-124.jpg" alt="" style="width:403pt;height:143pt;"></li>
<li>
<p><a name="bookmark5782"></a><span class="font25"><a name="bookmark5783"></a>2. Set up a third Linux computer with three network cards, one on </span><span class="font25" style="font-weight:bold;">leftnet</span><span class="font25">, the other on </span><span class="font25" style="font-weight:bold;">rightnet</span><span class="font25">. This computer will be the 'router'. Complete the table below with the relevant names, ip-addresses and </span><span class="font25" style="font-weight:bold;">mac-addresses</span><span class="font25">.</span></p></li></ul>
<p><span class="font25" style="font-weight:bold;">Table 13.1. Packet Forwarding Exercise</span></p>
<table border="1">
<tr><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">leftnet computer</span></p></td><td colspan="2" style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">the router</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">rightnet computer</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">MAC</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">IP</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
</table>
<ul style="list-style:none;"><li>
<p><a name="bookmark5784"></a><span class="font25">3. How can you verify whether the </span><span class="font25" style="font-weight:bold;">router </span><span class="font25">will allow packet forwarding by default or not ? Test that you can </span><span class="font25" style="font-weight:bold;">ping </span><span class="font25">from the </span><span class="font25" style="font-weight:bold;">router </span><span class="font25">to the two other machines, and from those two machines to the </span><span class="font25" style="font-weight:bold;">router</span><span class="font25">. Use </span><span class="font25" style="font-weight:bold;">arp -a </span><span class="font25">to make sure you are connected with the correct </span><span class="font25" style="font-weight:bold;">mac addresses</span><span class="font25">.</span></p></li>
<li>
<p><a name="bookmark5785"></a><span class="font25">4.</span><span class="font25" style="font-weight:bold;"> Ping </span><span class="font25">from the leftnet computer to the rightnet computer. Enable and/or disable packet forwarding on the </span><span class="font25" style="font-weight:bold;">router </span><span class="font25">and verify what happens to the ping between the two networks. If you do not succeed in pinging between the two networks (on different subnets), then use a sniffer like </span><span class="font25" style="font-weight:bold;">wireshark </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">tcpdump </span><span class="font25">to discover the problem.</span></p></li>
<li>
<p><a name="bookmark5786"></a><span class="font25"><a name="bookmark5787"></a>5. Use </span><span class="font25" style="font-weight:bold;">wireshark </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">tcpdump </span><span class="font25">-xx to answer the following questions. Does the source MAC change when a packet passes through the filter ? And the destination MAC ? What about source and destination IP-addresses ?</span></p></li>
<li>
<p><a name="bookmark5788"></a><span class="font25">6. Remember the third network card on the router ? Connect this card to a LAN with internet connection. On many LAN's the command </span><span class="font25" style="font-weight:bold;">dhclient eth0 </span><span class="font25">just works (replace </span><span class="font25" style="font-weight:bold;">eth0 </span><span class="font25">with the correct interface).</span></p></li></ul>
<p><span class="font19">root@router~# dhclient eth0</span></p>
<p><span class="font25">You now have a setup similar to this picture. What needs to be done to give internet access to </span><span class="font25" style="font-weight:bold;">leftnet </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">rightnet</span><span class="font25">.</span></p><img src="linux_guide_files/The Complete Linux Guide-125.jpg" alt="" style="width:403pt;height:219pt;">
<ul style="list-style:none;"><li>
<h2><a name="bookmark5789"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4556"></a><a name="bookmark5790"></a>13.15. solution: packet forwarding</span></h2></li></ul>
<p><span class="font25" style="font-weight:bold;">Is? Network</span></p>
<p><span class="font5">Adapter 1. Intel PRO/1000 MT Desktop (Bridged Adapter, enl: AirPort)</span></p>
<p><span class="font5">Adapter 2: Intel PRO/1000 MT Desktop (Internal Network, 'leftnet<sup>1</sup>)</span></p>
<p><span class="font5">Adapter 3: Intel PRO/1000 MT Desktop (Internal Network, 'rightnet’)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Set up two Linux machines, one on </span><span class="font25" style="font-weight:bold;">leftnet</span><span class="font25">, the other on </span><span class="font25" style="font-weight:bold;">rightnet</span><span class="font25">. Make sure they both get an ip-address in the correct subnet. These two machines will be 'left' and 'right' from the 'router'.</span></p><img src="linux_guide_files/The Complete Linux Guide-126.jpg" alt="" style="width:403pt;height:143pt;"></li></ul>
<p><span class="font25">The ip configuration on your computers should be similar to the following two screenshots. Both machines must be in a different subnet (here 192.168.60.0/24 and 192.168.70.0/24). I created a little script on both machines to configure the interfaces.</span></p>
<p><span class="font19">root@left~# cat leftnet.sh pkill dhclient</span></p>
<p><span class="font19">ifconfig eth0 192.168.60.8 netmask 255.255.255.0</span></p>
<p><span class="font19">root@right~# cat rightnet.sh pkill dhclient</span></p>
<p><span class="font19">ifconfig eth0 192.168.70.9 netmask 255.255.255.0</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Set up a third Linux computer with three network cards, one on </span><span class="font25" style="font-weight:bold;">leftnet</span><span class="font25">, the other on </span><span class="font25" style="font-weight:bold;">rightnet</span><span class="font25">. This computer will be the 'router'. Complete the table below with the relevant names, ip-addresses and mac-addresses.</span></p></li></ul>
<p><span class="font19">root@router~# cat router.sh</span></p>
<p><span class="font19">ifconfig eth1 192.168.60.1 netmask 255.255.255.0</span></p>
<p><span class="font19">ifconfig eth2 192.168.70.1 netmask 255.255.255.0</span></p>
<p><span class="font19">#echo 1 &gt;&nbsp;/proc/sys/net/ipv4/ip_forward</span></p>
<p><a name="bookmark5791"></a><span class="font25">Your setup may use different ip and mac addresses than the ones in the table below.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 13.2. Packet Forwarding Solution</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">leftnet computer</span></p></td><td colspan="2" style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">the router</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">rightnet computer</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">08:00:27:f6:ab:b9</span></p></td><td style="vertical-align:top;">
<p><span class="font24">08:00:27:43:1f:5a</span></p></td><td style="vertical-align:top;">
<p><span class="font24">08:00:27:be:4a:6b</span></p></td><td style="vertical-align:top;">
<p><span class="font24">08:00:27:14:8b:17</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">192.168.60.8</span></p></td><td style="vertical-align:top;">
<p><span class="font24">192.168.60.1</span></p></td><td style="vertical-align:top;">
<p><span class="font24">192.168.70.1</span></p></td><td style="vertical-align:top;">
<p><span class="font24">192.168.70.9</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<p><span class="font25">3. How can you verify whether the </span><span class="font25" style="font-weight:bold;">router </span><span class="font25">will allow packet forwarding by default or not ? Test that you can ping from the </span><span class="font25" style="font-weight:bold;">router </span><span class="font25">to the two other machines, and from those two machines to the </span><span class="font25" style="font-weight:bold;">router</span><span class="font25">. Use </span><span class="font25" style="font-weight:bold;">arp -a </span><span class="font25">to make sure you are connected with the correct </span><span class="font25" style="font-weight:bold;">mac addresses</span><span class="font25">.</span></p></li></ul>
<p><span class="font25">This can be done with &quot;</span><span class="font25" style="font-weight:bold;">grep ip_forward /etc/sysctl.conf</span><span class="font25">&quot; (1 is enabled, 0 is disabled) or with </span><span class="font25" style="font-weight:bold;">sysctl -a | grep ip_for</span><span class="font25">.</span></p>
<p><span class="font19">root@router~# grep ip_for /etc/sysctl.conf net.ipv4.ip_forward = 0</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Ping from the leftnet computer to the rightnet computer. Enable and/or disable packet forwarding on the </span><span class="font25" style="font-weight:bold;">router </span><span class="font25">and verify what happens to the ping between the two networks. If you do not succeed in pinging between the two networks (on different subnets), then use a sniffer like wireshark or tcpdump to discover the problem.</span></p></li></ul>
<p><span class="font25">Did you forget to add a </span><span class="font25" style="font-weight:bold;">default gateway </span><span class="font25">to the LAN machines ? Use </span><span class="font25" style="font-weight:bold;">route add default gw 'ip-address'</span><span class="font25">.</span></p>
<p><span class="font19">root@left~# route add default gw 192.168.60.1</span></p>
<p><span class="font19">root@right~# route add default gw 192.168.70.1</span></p>
<p><span class="font25">You should be able to ping when packet forwarding is enabled (and both default gateways are properly configured). The ping will not work when packet forwarding is disabled or when gateways are not configured correctly.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Use wireshark or tcpdump -xx to answer the following questions. Does the source MAC change when a packet passes through the filter ? And the destination MAC ? What about source and destination IP-addresses ?</span></p></li></ul>
<p><span class="font25">Both MAC addresses are changed when passing the router. Use </span><span class="font25" style="font-weight:bold;">tcpdump -xx </span><span class="font25">like this:</span></p>
<p><span class="font19">root@router~# tcpdump -xx -i eth1</span></p>
<p><span class="font19">root@router~# tcpdump -xx -i eth2</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Remember the third network card on the router ? Connect this card to a LAN with internet connection. On many LAN's the command </span><span class="font25" style="font-weight:bold;">dhclient eth0 </span><span class="font25">just works (replace </span><span class="font25" style="font-weight:bold;">eth0 </span><span class="font25">with the correct interface.</span></p></li></ul>
<p><span class="font19">root@router~# dhclient eth0</span></p>
<p><span class="font25">You now have a setup similar to this picture. What needs to be done to give internet access to </span><span class="font25" style="font-weight:bold;">leftnet </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">rightnet</span><span class="font25">.</span></p><img src="linux_guide_files/The Complete Linux Guide-127.jpg" alt="" style="width:403pt;height:219pt;">
<p><span class="font25">The clients on </span><span class="font25" style="font-weight:bold;">leftnet </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">rightnet </span><span class="font25">need a working </span><span class="font25" style="font-weight:bold;">dns server</span><span class="font25">. We use one of Google's dns servers here.</span></p>
<p><span class="font19">echo nameserver 8.8.8.8 &gt;&nbsp;/etc/resolv.conf</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark5792"></a><span class="font11" style="font-weight:bold;"><a name="bookmark4557"></a><a name="bookmark5793"></a>Chapter 14. iptables firewall</span></h1></li></ul>
<p><span class="font25">This chapter introduces some simple firewall rules and how to configure them with </span><span class="font25" style="font-weight:bold;">iptables</span><span class="font25">.</span></p>
<p><a name="bookmark5794"></a><span class="font25" style="font-weight:bold;">iptables </span><span class="font25">is an application that allows a user to configure the firewall functionality built into the </span><span class="font25" style="font-weight:bold;">Linux </span><span class="font25">kernel.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5795"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4558"></a><a name="bookmark5796"></a>14.1. iptables tables</span></h2></li></ul>
<h4><a name="bookmark5797"></a><span class="font25"><a name="bookmark5798"></a><a name="bookmark5799"></a>By default there are three </span><span class="font25" style="font-weight:bold;">tables </span><span class="font25">in the kernel that contain sets of rules.</span><br><br><a name="bookmark5800"></a><span class="font25"><a name="bookmark5801"></a>The </span><span class="font25" style="font-weight:bold;">filter table </span><span class="font25">is used for packet filtering.</span></h4>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">root@debian6~# iptables -t filter Chain INPUT (policy ACCEPT) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-L</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">destination</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">Chain FORWARD (policy ACCEPT) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">destination</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Chain OUTPUT (policy ACCEPT) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">destination</span></p></td></tr>
</table>
<h4><a name="bookmark5802"></a><span class="font25"><a name="bookmark5803"></a><a name="bookmark5804"></a>The </span><span class="font25" style="font-weight:bold;">nat table </span><span class="font25">is used for address translation.</span></h4>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">root@debian6~# iptables -t nat -L Chain PREROUTING (policy ACCEPT) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">destination</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">Chain POSTROUTING (policy ACCEPT) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">destination</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">Chain OUTPUT (policy ACCEPT) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">destination</span></p></td></tr>
</table>
<h4><a name="bookmark5805"></a><span class="font25"><a name="bookmark5806"></a><a name="bookmark5807"></a>The </span><span class="font25" style="font-weight:bold;">mangle table </span><span class="font25">can be used for special-purpose processing of packets.</span></h4>
<h4><a name="bookmark5808"></a><span class="font25"><a name="bookmark5809"></a><a name="bookmark5810"></a>Series of rules in each table are called a </span><span class="font25" style="font-weight:bold;">chain</span><span class="font25">. We will discuss chains and the nat table later in this chapter.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5811"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4559"></a><a name="bookmark5812"></a>14.2. starting and stopping iptables</span></h2></li></ul>
<h4><a name="bookmark5813"></a><span class="font25"><a name="bookmark5814"></a>The following screenshot shows how to stop and start </span><span class="font25" style="font-weight:bold;">iptables </span><span class="font25">on Red Hat/Fedora/CentOS and compatible distributions.</span></h4>
<p><span class="font19">[root@centos6 ~]# service iptables stop</span></p>
<p><span class="font19">[root@centos6 ~]# service iptables start</span></p>
<p><span class="font19">iptables: Applying firewall rules &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ ok ]</span></p>
<p><span class="font19">[root@centos6 ~]#</span></p>
<h4><a name="bookmark5815"></a><span class="font25"><a name="bookmark5816"></a>Debian and *buntu distributions do not have this script, but allow for an uninstall.</span></h4>
<p><span class="font19">root@debian6~# aptitude purge iptables</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5817"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4560"></a><a name="bookmark5818"></a>14.3. the filter table</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark5715"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5819"></a>14.3.1. about packet filtering</span></h3></li></ul></li></ul>
<p><a name="bookmark5820"></a><span class="font25" style="font-weight:bold;">Packet filtering </span><span class="font25">is a bit more than </span><span class="font25" style="font-weight:bold;">packet forwarding</span><span class="font25">. While </span><span class="font25" style="font-weight:bold;">packet forwarding </span><span class="font25">uses only a routing table to make decisions, </span><span class="font25" style="font-weight:bold;">packet filtering </span><span class="font25">also uses a list of rules. The kernel will inspect packets and decide based on these rules what to do with each packet.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5731"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5821"></a>14.3.2. filter table</span></h3></li></ul>
<p><span class="font25">The filter table in </span><span class="font25" style="font-weight:bold;">iptables </span><span class="font25">has three chains (sets of rules). The INPUT chain is used for any packet coming into the system. The OUTPUT chain is for any packet leaving the system. And the FORWARD chain is for packets that are forwarded (routed) through the system.</span></p><img src="linux_guide_files/The Complete Linux Guide-128.jpg" alt="" style="width:397pt;height:163pt;">
<p><span class="font25">The screenshot below shows how to list the filter table and all its rules.</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -t filter -nL</span></p>
<p><span class="font19">Chain INPUT (policy ACCEPT) target prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">Chain FORWARD (policy ACCEPT) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">Chain OUTPUT (policy ACCEPT) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<p><span class="font25">As you can see, all three chains in the filter table are set to ACCEPT everything. ACCEPT is the default behaviour.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5822"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5823"></a>14.3.3. setting default rules</span></h3></li></ul>
<p><span class="font25">The default for the default rule is indeed to ACCEPT everything. This is not the most secure firewall.</span></p>
<p><span class="font25">A more secure setup would be to DROP everything. A package that is </span><span class="font25" style="font-weight:bold;">dropped </span><span class="font25">will not continue in any chain, and no warning or error will be sent anywhere.</span></p>
<p><span class="font25">The below commands lock down a computer. Do not execute these commands inside a remote ssh shell.</span></p>
<p><span class="font19">root@debianpaul~# iptables -P INPUT DROP</span></p>
<p><span class="font19">root@debianpaul~# iptables -P OUTPUT DROP</span></p>
<p><span class="font19">root@debianpaul~# iptables -P FORWARD DROP</span></p>
<p><span class="font19">root@debianpaul~# iptables -L</span></p>
<p><span class="font19">Chain INPUT (policy DROP)</span></p>
<p><span class="font19">target prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">Chain FORWARD (policy DROP)</span></p>
<p><span class="font19">target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">Chain OUTPUT (policy DROP)</span></p>
<p><span class="font19">target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5824"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5825"></a>14.3.4. changing policy rules</span></h3></li></ul>
<p><span class="font25">To start, let's set the default policy for all three chains to drop everything. Note that you might lose your connection when typing this over ssh ;-).</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -P INPUT DROP</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -P FORWARD DROP</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -P OUTPUT DROP</span></p>
<p><span class="font25">Next, we allow the server to use its own loopback device (this allows the server to access its services running on localhost). We first append a rule to the INPUT chain to allow (ACCEPT) traffic from the lo (loopback) interface, then we do the same to allow packets to leave the system through the loopback interface.</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -A INPUT -i lo -j ACCEPT</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -A OUTPUT -o lo -j ACCEPT</span></p>
<p><span class="font25">Looking at the filter table again (omitting -t filter because it is the default table).</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -nL Chain INPUT (policy DROP) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source</span></p>
<div>
<p><span class="font19">destination 0.0.0.0/0</span></p>
</div><br clear="all">
<p><span class="font19">ACCEPT &nbsp;&nbsp;&nbsp;&nbsp;all -- 0.0.0.0/0</span></p>
<p><span class="font19">Chain FORWARD (policy DROP) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">Chain OUTPUT (policy DROP) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">ACCEPT &nbsp;&nbsp;&nbsp;&nbsp;all &nbsp;-- &nbsp;0.0.0.0/0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0/0</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5826"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5827"></a>14.3.5. Allowing ssh over eth0</span></h3></li></ul>
<h4><a name="bookmark5828"></a><span class="font25"><a name="bookmark5829"></a>This example show how to add two rules to allow ssh access to your system from outside.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# iptables -A INPUT -i eth0 -p tcp --dport 22 -j ACCEPT</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -A OUTPUT -o eth0 -p tcp --sport 22 -j ACCEPT</span></p>
<h4><a name="bookmark5830"></a><span class="font25"><a name="bookmark5831"></a>The filter table will look something like this screenshot (note that -v is added for more verbose output).</span></h4>
<p><span class="font19">[root@RHEL5 ~]# iptables -nvL</span></p>
<p><span class="font19">Chain INPUT (policy DROP 7 packets, 609 bytes) pkts bytes target prot opt in &nbsp;&nbsp;&nbsp;out &nbsp;&nbsp;source &nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;0 ACCEPT all &nbsp;-- &nbsp;lo &nbsp;&nbsp;&nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0/0 &nbsp;0.0.0.0/0</span></p>
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;0 ACCEPT tcp &nbsp;-- &nbsp;eth0 &nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0/0 &nbsp;0.0.0.0/0 tcp dpt:22</span></p>
<p><span class="font19">Chain FORWARD (policy DROP 0 packets, 0 bytes) pkts bytes target prot opt in &nbsp;&nbsp;&nbsp;out &nbsp;&nbsp;source &nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">Chain OUTPUT (policy DROP 3 packets, 228 bytes) pkts bytes target prot opt in &nbsp;&nbsp;&nbsp;out &nbsp;&nbsp;source &nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;0 ACCEPT all &nbsp;-- &nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;lo &nbsp;&nbsp;&nbsp;0.0.0.0/0 &nbsp;0.0.0.0/0</span></p>
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;0 ACCEPT tcp &nbsp;-- &nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;eth0 &nbsp;0.0.0.0/0 &nbsp;0.0.0.0/0 tcp spt:22</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5832"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5833"></a>14.3.6. Allowing access from a subnet</span></h3></li></ul>
<h4><a name="bookmark5834"></a><span class="font25"><a name="bookmark5835"></a>This example shows how to allow access from any computer in the 10.1.1.0/24 network, but only through eth1. There is no port (application) limitation here.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# iptables -A INPUT -i eth1 -s 10.1.1.0/24 -p tcp -j ACCEPT</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -A OUTPUT -o eth1 -d 10.1.1.0/24 -p tcp -j ACCEPT</span></p>
<h4><a name="bookmark5836"></a><span class="font25"><a name="bookmark5837"></a>Together with the previous examples, the policy is expanding.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# iptables -nvL</span></p>
<p><span class="font19">Chain INPUT (policy DROP 7 packets, 609 bytes)</span></p>
<p><span class="font19">pkts bytes target prot opt in &nbsp;&nbsp;&nbsp;out &nbsp;&nbsp;source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;0 ACCEPT all &nbsp;-- &nbsp;lo &nbsp;&nbsp;&nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0/0 &nbsp;&nbsp;0.0.0.0/0</span></p>
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;0 ACCEPT tcp &nbsp;-- &nbsp;eth0 &nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0/0 &nbsp;&nbsp;0.0.0.0/0 &nbsp;tcp dpt:22</span></p>
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;0 ACCEPT tcp &nbsp;-- &nbsp;eth1 &nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;10.1.1.0/24 0.0.0.0/0</span></p>
<p><span class="font19">Chain FORWARD (policy DROP 0 packets, 0 bytes) pkts bytes target prot opt in out source destination</span></p>
<p><span class="font19">Chain OUTPUT (policy DROP 3 packets, 228 bytes) pkts bytes target prot opt in &nbsp;&nbsp;&nbsp;out &nbsp;&nbsp;source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;0 ACCEPT all &nbsp;-- &nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;lo &nbsp;&nbsp;&nbsp;0.0.0.0/0 &nbsp;&nbsp;0.0.0.0/0</span></p>
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;0 ACCEPT tcp &nbsp;-- &nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;eth0 &nbsp;0.0.0.0/0 &nbsp;&nbsp;0.0.0.0/0 tcp spt:22</span></p>
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;0 ACCEPT tcp &nbsp;-- &nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;eth1 &nbsp;0.0.0.0/0 &nbsp;&nbsp;10.1.1.0/24</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5838"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5839"></a>14.3.7. iptables save</span></h3></li></ul>
<h4><a name="bookmark5840"></a><span class="font25"><a name="bookmark5841"></a><a name="bookmark5842"></a>Use </span><span class="font25" style="font-weight:bold;">iptables save </span><span class="font25">to automatically implement these rules when the firewall is (re)started.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# /etc/init.d/iptables save</span></p>
<p><span class="font19">Saving firewall rules to /etc/sysconfig/iptables: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5843"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5844"></a>14.3.8. scripting example</span></h3></li></ul>
<h4><a name="bookmark5845"></a><span class="font25"><a name="bookmark5846"></a>You can write a simple script for these rules. Below is an example script that implements the firewall rules that you saw before in this chapter.</span></h4>
<p><span class="font19">#!/bin/bash</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># first cleanup everything iptables -t filter -F iptables -t filter -X iptables -t nat -F iptables -t nat -X</span></p></li>
<li>
<p><span class="font19"># default drop</span></p></li></ul>
<p><span class="font19">iptables -P INPUT DROP</span></p>
<p><span class="font19">iptables -P FORWARD DROP iptables -P OUTPUT DROP</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># allow loopback device</span></p></li></ul>
<p><span class="font19">iptables -A INPUT -i lo -j ACCEPT iptables -A OUTPUT -o lo -j ACCEPT</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># allow ssh over eth0 from outside to system</span></p></li></ul>
<p><span class="font19">iptables -A INPUT -i eth0 -p tcp --dport 22 -j ACCEPT</span></p>
<p><span class="font19">iptables -A OUTPUT -o eth0 -p tcp --sport 22 -j ACCEPT</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># allow any traffic from 10.1.1.0/24 to system</span></p></li></ul>
<p><span class="font19">iptables -A INPUT -i eth1 -s 10.1.1.0/24 -p tcp -j ACCEPT</span></p>
<p><span class="font19">iptables -A OUTPUT -o eth1 -d 10.1.1.0/24 -p tcp -j ACCEPT</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5847"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5848"></a>14.3.9. Allowing ICMP(ping)</span></h3></li></ul>
<p><span class="font25">When you enable iptables, you will get an </span><span class="font25" style="font-weight:bold;">'Operation not permitted' </span><span class="font25">message when trying to ping other hosts.</span></p>
<p><span class="font19">[root@RHEL5 ~# ping 192.168.187.130</span></p>
<p><span class="font19">PING 192.168.187.130 (192.168.187.130) 56(84) bytes of data.</span></p>
<p><span class="font19">ping: sendmsg: Operation not permitted</span></p>
<p><span class="font19">ping: sendmsg: Operation not permitted</span></p>
<p><span class="font25">The screenshot below shows you how to setup iptables to allow a ping from or to your machine.</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -A INPUT -p icmp --icmp-type any -j ACCEPT [root@RHEL5 ~]# iptables -A OUTPUT -p icmp --icmp-type any -j ACCEPT</span></p>
<p><span class="font25">The previous two lines do not allow other computers to route ping messages through your router, because it only handles INPUT and OUTPUT. For routing of ping, you will need to enable it on the FORWARD chain. The following command enables routing of icmp messages between networks.</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -A FORWARD -p icmp --icmp-type any -j ACCEPT</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5849"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4561"></a><a name="bookmark5850"></a>14.4. practice: packet filtering</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Make sure you can ssh to your router-system when iptables is active.</span></p></li>
<li>
<p><span class="font25">2. Make sure you can ping to your router-system when iptables is active.</span></p></li>
<li>
<p><span class="font25">3. Define one of your networks as 'internal' and the other as 'external'. Configure the router to allow visits to a website (http) to go from the internal network to the external network (but not in the other direction).</span></p></li>
<li>
<p><span class="font25">4. Make sure the internal network can ssh to the external, but not the other way around.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5851"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4562"></a><a name="bookmark5852"></a>14.5. solution: packet filtering</span></h2></li></ul>
<h4><a name="bookmark5853"></a><span class="font25"><a name="bookmark5854"></a>A possible solution, where leftnet is the internal and rightnet is the external network.</span></h4>
<p><span class="font19">#!/bin/bash</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># first cleanup everything iptables -t filter -F iptables -t filter -X iptables -t nat -F iptables -t nat -X</span></p></li>
<li>
<p><span class="font19"># default drop</span></p></li></ul>
<p><span class="font19">iptables -P INPUT DROP</span></p>
<p><span class="font19">iptables -P FORWARD DROP iptables -P OUTPUT DROP</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># allow loopback device</span></p></li></ul>
<p><span class="font19">iptables -A INPUT -i lo -j ACCEPT iptables -A OUTPUT -o lo -j ACCEPT</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># question 1: allow ssh over eth0</span></p></li></ul>
<p><span class="font19">iptables -A INPUT -i eth0 -p tcp --dport 22 -j ACCEPT iptables -A OUTPUT -o eth0 -p tcp --sport 22 -j ACCEPT</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># question 2: Allow icmp(ping) anywhere</span></p></li></ul>
<p><span class="font19">iptables -A INPUT -p icmp --icmp-type any -j ACCEPT</span></p>
<p><span class="font19">iptables -A FORWARD -p icmp --icmp-type any -j ACCEPT iptables -A OUTPUT -p icmp --icmp-type any -j ACCEPT</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># question 3: allow http from internal(leftnet) to external(rightnet) iptables -A FORWARD -i eth1 -o eth2 -p tcp --dport 80 -j ACCEPT</span></p></li></ul>
<p><span class="font19">iptables -A FORWARD -i eth2 -o eth1 -p tcp --sport 80 -j ACCEPT</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># question 4: allow ssh from internal(leftnet) to external(rightnet) iptables -A FORWARD -i eth1 -o eth2 -p tcp --dport 22 -j ACCEPT</span></p></li></ul>
<p><span class="font19">iptables -A FORWARD -i eth2 -o eth1 -p tcp --sport 22 -j ACCEPT</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># allow http from external(rightnet) to internal(leftnet)</span></p></li>
<li>
<p><span class="font19"># iptables -A FORWARD -i eth2 -o eth1 -p tcp --dport 80 -j ACCEPT</span></p></li>
<li>
<p><span class="font19"># iptables -A FORWARD -i eth1 -o eth2 -p tcp --sport 80 -j ACCEPT</span></p></li>
<li>
<p><span class="font19"># allow rpcinfo over eth0 from outside to system</span></p></li>
<li>
<p><span class="font19"># iptables -A INPUT -i eth2 -p tcp --dport 111 -j ACCEPT</span></p></li>
<li>
<p><span class="font19"># iptables -A OUTPUT -o eth2 -p tcp --sport 111 -j ACCEPT</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5855"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4563"></a><a name="bookmark5856"></a>14.6. network address translation</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark5341"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5857"></a>14.6.1. about NAT</span></h3></li></ul></li></ul>
<p><span class="font25">A NAT device is a router that is also changing the source and/or target ip-address in packets. It is typically used to connect multiple computers in a private address range with the (public) internet. A NAT can hide private addresses from the internet.</span></p>
<p><span class="font25">NAT was developed to mitigate the use of real ip addresses, to allow private address ranges to reach the internet and back, and to not disclose details about internal networks to the outside.</span></p>
<p><span class="font25">The nat table in iptables adds two new chains. PREROUTING allows altering of packets before they reach the INPUT chain. POSTROUTING allows altering packets after they exit the OUTPUT chain.</span></p><img src="linux_guide_files/The Complete Linux Guide-129.jpg" alt="" style="width:409pt;height:81pt;">
<p><span class="font25">Use </span><span class="font25" style="font-weight:bold;">iptables -t nat -nvL </span><span class="font25">to look at the NAT table. The screenshot below shows an empty NAT table.</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -t nat -nL Chain PREROUTING (policy ACCEPT) target prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">Chain POSTROUTING (policy ACCEPT) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">Chain OUTPUT (policy ACCEPT) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5719"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5858"></a>14.6.2. SNAT (Source NAT)</span></h3></li></ul>
<p><span class="font25">The goal of source nat is to change the source address inside a packet before it leaves the system (e.g. to the internet). The destination will return the packet to the NAT-device. This means our NAT-device will need to keep a table in memory of all the packets it changed, so it can deliver the packet to the original source (e.g. in the private network).</span></p>
<p><span class="font25">Because SNAT is about packets leaving the system, it uses the POSTROUTING chain.</span></p>
<p><span class="font25">Here is an example SNAT rule. The rule says that packets coming from 10.1.1.0/24 network and exiting via eth1 will get the source ip-address set to 11.12.13.14. (Note that this is a one line command!)</span></p>
<p><span class="font19">iptables -t nat -A POSTROUTING -o ethl -s 10.1.1.0/24 -j SNAT \</span></p>
<p><span class="font19">--to-source 11.12.13.14</span></p>
<p><span class="font25">Of course there must exist a proper iptables filter setup to allow the packet to traverse from one network to the other.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5859"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5860"></a>14.6.3. SNAT example setup</span></h3></li></ul>
<p><span class="font25">This example script uses a typical nat setup. The internal (eth0) network has access via SNAT to external (eth1) webservers (port 80).</span></p>
<p><span class="font19">#!/bin/bash #</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># iptables script for simple classic nat websurfing</span></p></li>
<li>
<p><span class="font19"># eth0 is internal network, eth1 is internet #</span></p></li></ul>
<p><span class="font19">echo 0 &gt;&nbsp;/proc/sys/net/ipv4/ip_forward</span></p>
<p><span class="font19">iptables -P INPUT ACCEPT</span></p>
<p><span class="font19">iptables -P OUTPUT ACCEPT</span></p>
<p><span class="font19">iptables -P FORWARD DROP</span></p>
<p><span class="font19">iptables -A FORWARD -i eth0 -o eth1 -s 10.1.1.0/24 -p tcp \</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- -dport 80 -j ACCEPT</span></p></li></ul>
<p><span class="font19">iptables -A FORWARD -i eth1 -o eth0 -d 10.1.1.0/24 -p tcp \</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- -sport 80 -j ACCEPT</span></p></li></ul>
<p><span class="font19">iptables -t nat -A POSTROUTING -o eth1 -s 10.1.1.0/24 -j SNAT \ --to-source 11.12.13.14 echo 1 &gt;&nbsp;/proc/sys/net/ipv4/ip_forward</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5720"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5861"></a>14.6.4. IP masquerading</span></h3></li></ul>
<p><span class="font25">IP masquerading is very similar to SNAT, but is meant for dynamic interfaces. Typical example are broadband 'router/modems' connected to the internet and receiving a different ip-address from the isp, each time they are cold-booted.</span></p>
<p><span class="font25">The only change needed to convert the SNAT script to a masquerading is one line.</span></p>
<p><span class="font19">iptables -t nat -A POSTROUTING -o ethl -s 10.1.1.0/24 -j MASQUERADE</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark5721"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5862"></a>14.6.5. DNAT (Destination NAT)</span></h3></li></ul>
<p><span class="font25">DNAT is typically used to allow packets from the internet to be redirected to an internal server (in your DMZ) and in a private address range that is inaccessible directly form the internet.</span></p>
<p><span class="font25">This example script allows internet users to reach your internal (192.168.1.99) server via ssh (port 22).</span></p>
<p><span class="font19">#!/bin/bash</span></p>
<p><span class="font19">#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># iptables script for DNAT</span></p></li>
<li>
<p><span class="font19"># eth0 is internal network, eth1 is internet</span></p></li></ul>
<p><span class="font19">#</span></p>
<p><span class="font19">echo 0 &gt;&nbsp;/proc/sys/net/ipv4/ip_forward</span></p>
<p><span class="font19">iptables -P INPUT ACCEPT</span></p>
<p><span class="font19">iptables -P OUTPUT ACCEPT</span></p>
<p><span class="font19">iptables -P FORWARD DROP</span></p>
<p><span class="font19">iptables -A FORWARD -i eth0 -o eth1 -s 10.1.1.0/24 -j ACCEPT</span></p>
<p><span class="font19">iptables -A FORWARD -i eth1 -o eth0 -p tcp --dport 22 -j ACCEPT</span></p>
<p><span class="font19">iptables -t nat -A PREROUTING -i eth1 -p tcp --dport 22 \</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- j DNAT --to-destination 10.1.1.99</span></p></li></ul>
<p><span class="font19">echo 1 &gt;&nbsp;/proc/sys/net/ipv4/ip_forward</span></p>
<p><a name="bookmark5863"></a><span class="font11" style="font-weight:bold;">Part VII. ipv6</span></p>
<h3><a name="bookmark5864"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5865"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5866"><span class="font24" style="font-weight:bold;">25. Introduction to ipv6 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5867"><span class="font24">25.1. about ipv6 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5868"><span class="font24">25.2. network id and host id </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5869"><span class="font24">25.3. host part generation </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5870"><span class="font24">25.4. ipv4 mapped ipv6 address </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5871"><span class="font24">25.5. link local addresses </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5872"><span class="font24">25.6. unique local addresses </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5873"><span class="font24">25.7. globally unique unicast addresses </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5874"><span class="font24">25.8. 6to4 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5875"><span class="font24">25.9. ISP </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5876"><span class="font24">25.10. non routable addresses </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5877"><span class="font24">25.11. ping6 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5878"><span class="font24">25.12. Belgium and ipv6 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5879"><span class="font24">25.13. other websites </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5880"><span class="font24">25.14. 6to4 gateways </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5881"><span class="font24">25.15. ping6 and dns </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5882"><span class="font24">25.16. ipv6 and tcp/http </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5883"><span class="font24">25.17. ipv6 PTR record </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5884"><span class="font24">25.18. 6to4 setup on Linux </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a name="bookmark5885"></a><span class="font11" style="font-weight:bold;">Chapter 25. Introduction to ipv6</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5886"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4652"></a><a name="bookmark5887"></a>25.1. about ipv6</span></h2></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">ipv6 </span><span class="font25">protocol is designed to replace </span><span class="font25" style="font-weight:bold;">ipv4</span><span class="font25">. Where </span><span class="font25" style="font-weight:bold;">ip version 4 </span><span class="font25">supports a maximum of four billion unique addresses, </span><span class="font25" style="font-weight:bold;">ip version 6 </span><span class="font25">expands this to </span><span class="font25" style="font-weight:bold;">four billion times four billion times four billion times four billion </span><span class="font25">unique addresses. This is more than 100.000.000.000.000.000.000 ipv6 addresses per square cm on our planet. That should be enough, even if every cell phone, every coffee machine and every pair of socks gets an address.</span></p>
<p><span class="font25">Technically speaking ipv6 uses 128-bit addresses (instead of the 32-bit from ipv4). 128-bit addresses are </span><span class="font25" style="font-weight:bold;">huge </span><span class="font25">numbers. In decimal it would amount up to 39 digits, in hexadecimal it looks like this:</span></p>
<p><span class="font19">fe80:0000:0000:0000:0a00:27ff:fe8e:8aa8</span></p>
<p><span class="font25">Luckily ipv6 allows us to omit leading zeroes. Our address from above then becomes:</span></p>
<p><span class="font19">fe80:0:0:0:a00:27ff:fe8e:8aa8</span></p>
<p><span class="font25">When a 16-bit block is zero, it can be written as </span><span class="font25" style="font-weight:bold;">::</span><span class="font25">. Consecutive 16-bit blocks that are zero can also be written as </span><span class="font25" style="font-weight:bold;">::</span><span class="font25">. So our address can from above can be shortened to:</span></p>
<p><span class="font19">fe80::a00:27ff:fe8e:8aa8</span></p>
<p><span class="font25">This </span><span class="font25" style="font-weight:bold;">:: </span><span class="font25">can only occur once! The following is not a valid ipv6 address: </span><span class="font19">fe80::20:2e4f::39ac</span></p>
<p><span class="font25">The ipv6 </span><span class="font25" style="font-weight:bold;">localhost </span><span class="font25">address is </span><span class="font25" style="font-weight:bold;">0000:0000:0000:0000:0000:0000:0000:0001</span><span class="font25">, which can be abbreviated to </span><span class="font25" style="font-weight:bold;">::1</span><span class="font25">.</span></p>
<p><span class="font19">paul@debian5:~/github/lt/images$ /sbin/ifconfig lo | grep inet6 inet6 addr: ::1/128 Scope:Host</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5888"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4653"></a><a name="bookmark5889"></a>25.2. network id and host id</span></h2></li></ul>
<p><span class="font25">One of the few similarities between ipv4 and ipv6 is that addresses have a host part and a network part determined by a subnet mask. Using the </span><span class="font25" style="font-weight:bold;">cidr </span><span class="font25">notation this looks like this: </span><span class="font19">fe80::a00:27ff:fe8e:8aa8/64</span></p>
<p><span class="font25">The above address has 64 bits for the host id, theoretically allowing for 4 billion times four billion hosts.</span></p>
<p><span class="font25">The localhost address looks like this with cidr:</span></p>
<p><span class="font19">::1/128</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5890"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4654"></a><a name="bookmark5891"></a>25.3. host part generation</span></h2></li></ul>
<p><span class="font25">The host part of an automatically generated (stateless) ipv6 address contains part of the hosts mac address:</span></p>
<p><span class="font19">paul@debian5:~$ /sbin/ifconfig | head -3</span></p>
<p><span class="font19">eth3 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Link encap:Ethernet HWaddr 08:00:27:ab:67:30</span></p>
<p><span class="font19">inet addr:192.168.1.29 Bcast:192.168.1.255 Mask:255.255.255.0 inet6 addr: fe80::a00:27ff:feab:6730/64 Scope:Link</span></p>
<p><span class="font25">Some people are concerned about privacy here...</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5892"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4655"></a><a name="bookmark5893"></a>25.4. ipv4 mapped ipv6 address</span></h2></li></ul>
<p><span class="font25">Some applications use ipv4 addresses embedded in an ipv6 address. (Yes there will be an era of migration with both ipv4 and ipv6 in use.) The ipv6 address then looks like this:</span></p>
<p><span class="font19">::ffff:192.168.1.42/96</span></p>
<p><span class="font25">Indeed a mix of decimal and hexadecimal characters...</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5894"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4656"></a><a name="bookmark5895"></a>25.5. link local addresses</span></h2></li></ul>
<p><span class="font25" style="font-weight:bold;">ipv6 </span><span class="font25">addresses starting with </span><span class="font25" style="font-weight:bold;">fe8. </span><span class="font25">can only be used on the local segment (replace the dot with an hexadecimal digit). This is the reason you see </span><span class="font25" style="font-weight:bold;">Scope:Link </span><span class="font25">behind the address in this screenshot. This address serves only the </span><span class="font25" style="font-weight:bold;">local link</span><span class="font25">.</span></p>
<p><span class="font19">paul@deb503:~$ /sbin/ifconfig | grep inet6</span></p>
<p><span class="font19">inet6 addr: fe80::a00:27ff:fe8e:8aa8/64 Scope:Link</span></p>
<p><span class="font19">inet6 addr: ::1/128 Scope:Host</span></p>
<p><span class="font25">These </span><span class="font25" style="font-weight:bold;">link local </span><span class="font25">addresses all begin with </span><span class="font25" style="font-weight:bold;">fe8.</span><span class="font25">.</span></p>
<p><span class="font25">Every ipv6 enabled nic will get an address in this range.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5896"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4657"></a><a name="bookmark5897"></a>25.6. unique local addresses</span></h2></li></ul>
<p><span class="font25">The now obsolete system of </span><span class="font25" style="font-weight:bold;">site local addresses </span><span class="font25">similar to ipv4 private ranges is replaced with a system of globally unique local ipv6 addresses. This to prevent duplicates when joining of networks within </span><span class="font25" style="font-weight:bold;">site local </span><span class="font25">ranges.</span></p>
<p><span class="font25">All </span><span class="font25" style="font-weight:bold;">unique local </span><span class="font25">addresses strat with </span><span class="font25" style="font-weight:bold;">fd..</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5898"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4658"></a><a name="bookmark5899"></a>25.7. globally unique unicast addresses</span></h2></li></ul>
<p><span class="font25">Since </span><span class="font25" style="font-weight:bold;">ipv6 </span><span class="font25">was designed to have multiple ip addresses per interface, the </span><span class="font25" style="font-weight:bold;">global ipv6 address </span><span class="font25">can be used next to the </span><span class="font25" style="font-weight:bold;">link local address</span><span class="font25">.</span></p>
<p><span class="font25">These </span><span class="font25" style="font-weight:bold;">globally unique </span><span class="font25">addresses all begin with </span><span class="font25" style="font-weight:bold;">2... </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">3... </span><span class="font25">as the first 16-bits.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5900"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4659"></a><a name="bookmark5901"></a>25.8. 6to4</span></h2></li></ul>
<p><span class="font25" style="font-weight:bold;">6to4 </span><span class="font25">is defined in rfc's 2893 and 3056 as one possible way to transition between ipv4 and ipv6 by creating an ipv6 tunnel.</span></p>
<p><span class="font25">It encodes an ipv4 address in an ipv6 address that starts with </span><span class="font25" style="font-weight:bold;">2002</span><span class="font25">. For example 192.168.1.42/24 will be encoded as:</span></p>
<p><span class="font19">2002:c0a8:12a:18::1</span></p>
<h4><a name="bookmark5902"></a><span class="font25"><a name="bookmark5903"></a>You can use the command below to convert any ipv4 address to this range.</span></h4>
<p><span class="font19">paul@ubu1010:~$ printf &quot;2002:%02x%02x:%02x%02x:%04x::1\n&quot; 'echo 192.168.1.42/24 \ |tr &quot;./&quot; &quot;&nbsp;&nbsp;&nbsp;&quot;'</span></p>
<p><span class="font19">2002:c0a8:012a:0018::1</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5904"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4660"></a><a name="bookmark5905"></a>25.9. ISP</span></h2></li></ul>
<h4><a name="bookmark5906"></a><span class="font25"><a name="bookmark5907"></a>Should you be so lucky to get an ipv6 address from an </span><span class="font25" style="font-weight:bold;">isp</span><span class="font25">, then it will start with </span><span class="font25" style="font-weight:bold;">2001:</span><span class="font25">.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5908"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4661"></a><a name="bookmark5909"></a>25.10. non routable addresses</span></h2></li></ul>
<h4><a name="bookmark5910"></a><span class="font25"><a name="bookmark5911"></a>Comparable to </span><span class="font25" style="font-weight:bold;">example.com </span><span class="font25">for DNS, the following ipv6 address ranges are reserved for examples, and not routable on the internet.</span></h4>
<p><span class="font19">3fff:ffff::/32</span></p>
<p><span class="font19">2001:0db8::/32</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5912"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4662"></a><a name="bookmark5913"></a>25.11. ping6</span></h2></li></ul>
<h4><a name="bookmark5914"></a><span class="font25"><a name="bookmark5915"></a>Use </span><span class="font25" style="font-weight:bold;">ping6 </span><span class="font25">to test connectivity between ipv6 hosts. You need to specify the interface (there</span><br><br><span class="font25"><a name="bookmark5916"></a>is no routing table for 'random' generated ipv6 link local addresses).</span></h4>
<p><span class="font19">[root@fedora14 ~]# ping6 -I eth0 fe80::a00:27ff:fecd:7ffc</span></p>
<p><span class="font19">PING fe80::a00:27ff:fecd:7ffc(fe80::a00:27ff:fecd:7ffc) from fe80::a00:27ff:fe3c:4346 eth0: 56</span></p>
<p><span class="font19">64 bytes from fe80::a00:27ff:fecd:7ffc: icmp_seq=1 ttl=64 time=0.586 ms</span></p>
<p><span class="font19">64 bytes from fe80::a00:27ff:fecd:7ffc: icmp_seq=2 ttl=64 time=3.95 ms</span></p>
<p><span class="font19">64 bytes from fe80::a00:27ff:fecd:7ffc: icmp_seq=3 ttl=64 time=1.53 ms</span></p>
<h4><a name="bookmark5917"></a><span class="font25"><a name="bookmark5918"></a>Below a multicast ping6 that recieves replies from three ip6 hosts on the same network.</span></h4>
<p><span class="font19">[root@fedora14 ~]# ping6 -I eth0 ff02::1</span></p>
<p><span class="font19">PING ff02::1(ff02::1) from fe80::a00:27ff:fe3c:4346 eth0: 56 data bytes 64 bytes from fe80::a00:27ff:fe3c:4346: icmp_seq=1 ttl=64 time=0.598 ms 64 bytes from fe80::a00:27ff:fecd:7ffc: icmp_seq=1 ttl=64 time=1.87 ms (DUP!) 64 bytes from fe80::8e7b:9dff:fed6:dff2: icmp_seq=1 ttl=64 time=535 ms (DUP!) 64 bytes from fe80::a00:27ff:fe3c:4346: icmp_seq=2 ttl=64 time=0.106 ms 64 bytes from fe80::8e7b:9dff:fed6:dff2: icmp_seq=2 ttl=64 time=1.79 ms (DUP!) 64 bytes from fe80::a00:27ff:fecd:7ffc: icmp_seq=2 ttl=64 time=2.48 ms (DUP!)</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5919"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4663"></a><a name="bookmark5920"></a>25.12. Belgium and ipv6</span></h2></li></ul>
<p><span class="font25">A lot of information on ipv6 in Belgium can be found at </span><a href="http://www.ipv6council.be"><span class="font25">www.ipv6council.be</span></a><span class="font25">.</span></p>
<p><span class="font25">Sites like ipv6.belgium.be, </span><a href="http://www.bipt.be"><span class="font25">www.bipt.be</span></a><span class="font25"> and </span><a href="http://www.bricozone.be"><span class="font25">www.bricozone.be</span></a><span class="font25"> are enabled for ipv6. Some Universities also: fundp.ac.be (Namur) and ulg.ac.be (Liege).</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5921"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4664"></a><a name="bookmark5922"></a>25.13. other websites</span></h2></li></ul>
<p><span class="font25">Other useful websites for testing ipv6 are:</span></p>
<p><span class="font19">test-ipv6.com</span></p>
<p><span class="font19">ipv6-test.com</span></p>
<p><span class="font25">Going to the ipv6-test.com website will test whether you have a valid accessible ipv6 address.</span></p>
<p><span class="font25" style="font-variant:small-caps;">Yolk</span><span class="font4"> internet connection is IPvS capable</span></p>
<p><span class="font27" style="font-weight:bold;">2002:51a5:657d::l</span></p>
<p><span class="font7" style="font-weight:bold;">Telenet</span></p>
<p><span class="font27" style="font-weight:bold;">If</span></p>
<p><span class="font4">Address type is</span></p>
<h3><a name="bookmark5923"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5924"></a>6to4</span></h3>
<p><span class="font4">6to4 mappin $ to ] P \<sup>r</sup>4 address H .165J01.125</span></p>
<p><span class="font4">Your in ternet connection is IPv4 capable</span></p>
<p><span class="font27" style="font-weight:bold;">81.165.101.125</span></p>
<p><span class="font4">d5 LA 5657D .acres s .telenet, be</span></p>
<p><span class="font25">Going to the test-ipv6.com website will also test whether you have a valid accessible ipv6 address.</span></p>
<p><span class="font22" style="font-weight:bold;">Test your IPv6 connectivity.</span></p>
<div>
<p><span class="font0" style="font-weight:bold;">Summary </span><span class="font0" style="font-weight:bold;text-decoration:underline;">| Tests Run | Technical Info | Share R</span></p>
</div><br clear="all">
<div>
<p><span class="font1">Take Screenshot</span></p>
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-130.jpg" alt="" style="width:15pt;height:15pt;">
<p><span class="font1">Your IPv4 address on the public</span></p>
</div><br clear="all">
<div>
<p><span class="font0" style="font-weight:bold;">Take Screenshot</span></p>
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-131.jpg" alt="" style="width:15pt;height:15pt;">
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-132.jpg" alt="" style="width:15pt;height:15pt;">
</div><br clear="all">
<div>
<p><span class="font1">Your IPv6 address on the public</span></p>
<p><span class="font1">Your IPv6 service appears to be: </span><span class="font1" style="text-decoration:underline;">World IPv6 day</span><span class="font1"> is June 8th, 2011</span></p>
</div><br clear="all">
<div>
<p><span class="font1">BaH o</span></p>
<p><span class="font1">6to4 <sub>o</sub></span></p>
</div><br clear="all">
<div>
<p><span class="font1">Grab the whole desktop</span></p>
<p><span class="font1">Grab the current window</span></p>
</div><br clear="all">
<div>
<p><span class="font1">Select area to grab</span></p>
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-133.jpg" alt="" style="width:15pt;height:15pt;">
</div><br clear="all">
<div>
<p><span class="font1">No problems are anticipatedjor you with this brawser, at this location, </span><span class="font23" style="font-style:italic;text-decoration:underline;">[more infol </span><span class="font1">Grab after a delay of 10___G seconds</span></p>
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-134.jpg" alt="" style="width:15pt;height:15pt;">
</div><br clear="all">
<div>
<p><span class="font1">Congratulations! You appear to have both IPv4 and IPv6 Internet working, If a publisher publishes to IPv6, your browser will connect using IPv6. Note: Your browser appears to prefer IPv4 over IPv6 when given the choice. This may in the future affect the accuracy of sites who guess at your location.</span></p>
<p><span class="font1">You appear to be using a public 6to4 gateway; your router may be providing this to you automatically. Such public gateways have no service level agreements; you may see performance problems using such. Better would be to get a native IPv6 address from your ISP. </span><span class="font23" style="font-style:italic;text-decoration:underline;">fmore infol</span></p>
</div><br clear="all">
<div>
<p><span class="font7">©</span><span class="font1">Your DNS server (possibly run by your ISP) appears to have no access to the IPv6 Internet, or is not configured to use it. This may in the future restrict your ability to reach IPv6-only sites, </span><span class="font23" style="font-style:italic;text-decoration:underline;">fmore infol</span><span class="font23" style="font-style:italic;"> \</span></p>
</div><br clear="all">
<div>
<p><span class="font2" style="font-weight:bold;">Your readiness scores</span></p>
</div><br clear="all">
<div>
<p><span class="font21">7/10</span></p>
<p><span class="font21">7/10</span></p>
</div><br clear="all">
<div>
<p><span class="font1">for your IPv4 stability and readiness, when publishers offer both IPv4 and IPv6</span></p>
<p><span class="font1">for your IPv6 stability and readiness, when publishers are forced to go IPv6 only</span></p>
</div><br clear="all">
<div>
<p><span class="font1">Click to see </span><span class="font1" style="text-decoration:underline;">test data</span></p>
</div><br clear="all">
<div>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5925"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4665"></a><a name="bookmark5926"></a>25.14. 6to4 gateways</span></h2></li></ul>
<h4><a name="bookmark5927"></a><span class="font25"><a name="bookmark5928"></a>To access ipv4 only websites when on ipv6 you can use sixxs.net (more specifically http:// </span><a href="http://www.sixxs.net/tools/gateway/"><span class="font25">www.sixxs.net/tools/gateway/</span></a><span class="font25">) as a gatway.</span></h4>
<h4><a name="bookmark5929"></a><span class="font25"><a name="bookmark5930"></a>For example use </span><a href="http://www.slashdot.org.sixxs.org/"><span class="font25">http://www.slashdot.org.sixxs.org/</span></a><span class="font25"> instead of </span><a href="http://slashdot.org"><span class="font25">http://slashdot.org</span></a></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5931"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4666"></a><a name="bookmark5932"></a>25.15. ping6 and dns</span></h2></li></ul>
<h4><a name="bookmark5933"></a><span class="font25"><a name="bookmark5934"></a>Below a screenshot of a </span><span class="font25" style="font-weight:bold;">ping6 </span><span class="font25">from behind a 6to4 connection.</span></h4>
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-135.jpg" alt="" style="width:427pt;height:52pt;">
</div><br clear="all">
<div>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5935"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4667"></a><a name="bookmark5936"></a>25.16. ipv6 and tcp/http</span></h2></li></ul>
</div><br clear="all">
<div>
<h4><a name="bookmark5937"></a><span class="font25"><a name="bookmark5938"></a>Below a screenshot of a tcp handshake and http connection over ipv6.</span></h4>
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-136.jpg" alt="" style="width:428pt;height:78pt;">
</div><br clear="all">
<ul style="list-style:none;"><li>
<h2><a name="bookmark5939"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4668"></a><a name="bookmark5940"></a>25.17. ipv6 PTR record</span></h2></li></ul>
<h4><a name="bookmark5941"></a><span class="font25"><a name="bookmark5942"></a>As seen in the DNS chapter, ipv6 PTR records are in the ip6.net domain, and have 32 generations of child domains.</span></h4>
<p><span class="font3">Frame 46 (132 bytes on wire, 132 bytes captured)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font3">&gt; Ethernet II, Src: Apple 5d:2e:52 (00:26:bb:5d:2e:52), Dst: Riverdel cf:6a:10 (00:30:b8:cf:6a:10) &gt;&nbsp;Internet Protocol, Src: 81.165.101.125 (81.165.101.125), Dst: 195.130.131.4 (195.130.131.4)</span></p></li>
<li>
<p><span class="font3">&gt; User Datagram Protocol, Src Port: 34361 (34361), Dst Port: domain (53)</span></p></li>
<li>
<p><span class="font3">• w Domain Name System (query)</span></p></li></ul>
<p><span class="font3" style="text-decoration:underline;">(Response In: 471</span></p>
<p><span class="font3">Transaction ID: 0xcfe3</span></p>
<ul style="list-style:none;"><li>
<p><span class="font3">&gt; Flags: 0x0100 (Standard query)</span></p></li></ul>
<p><span class="font3">Questions: 1 Answer RRs: 0 Authority RRs: 0 Additional RRs: 0 Queries</span></p>
<ul style="list-style:none;"><li>
<p><span class="font3">&gt; 1.0.0.0.7.5.e.7.0.9.0.0.0.0.0.0.l.d.7.6.2.0.0.0.0.d.1.4.1.O.0.2.ip6.arpa: type PTR, class IN</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark5943"></a><span class="font10" style="font-weight:bold;"><a name="bookmark4669"></a><a name="bookmark5944"></a>25.18. 6to4 setup on Linux</span></h2></li></ul>
<h4><a name="bookmark5945"></a><span class="font25"><a name="bookmark5946"></a>Below a transcript of a 6to4 setup on Linux.</span></h4>
<h4><a name="bookmark5947"></a><span class="font25"><a name="bookmark5948"></a>Thanks to </span><a href="http://www.anyweb.co.nz/tutorial/v6Linux6to4"><span class="font25">http://www.anyweb.co.nz/tutorial/v6Linux6to4</span></a><span class="font25"> and </span><a href="http://mirrors.bieringer.de/"><span class="font25">http://mirrors.bieringer.de/</span></a><span class="font25"> Linux+IPv6-HOWTO/ and tldp.org!</span></h4>
<p><span class="font19">root@mac:~# ifconfig</span></p>
<p><span class="font19">eth0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Link encap:Ethernet HWaddr 00:26:bb:5d:2e:52</span></p>
<p><span class="font19">inet addr:81.165.101.125 &nbsp;Bcast:255.255.255.255 Mask:255.255.248.0 inet6 addr: fe80::226:bbff:fe5d:2e52/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:5926044 errors:0 dropped:0 overruns:0 frame:0 TX packets:2985892 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:4274849823 (4.2 GB) TX bytes:237002019 (237.0 MB) Interrupt:43 Base address:0x8000</span></p>
<p><span class="font19">lo &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Link encap:Local Loopback</span></p>
<p><span class="font19">inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host UP LOOPBACK RUNNING MTU:16436 Metric:1 RX packets:598 errors:0 dropped:0 overruns:0 frame:0 TX packets:598 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:61737 (61.7 KB) TX bytes:61737 (61.7 KB)</span></p>
<p><span class="font19">root@mac:~# sysctl -w net.ipv6.conf.default.forwarding=1 net.ipv6.conf.default.forwarding = 1</span></p>
<p><span class="font19">root@mac:~# ip tunnel add tun6to4 mode sit remote any local 81.165.101.125 root@mac:~# ip link set dev tun6to4 mtu 1472 up root@mac:~# ip link show dev tun6to4 10: tun6to4: &lt;NOARP,UP,LOWER_UP&gt; mtu 1472 qdisc noqueue state UNKNOWN link/sit 81.165.101.125 brd 0.0.0.0</span></p>
<p><span class="font19">root@mac:~# ip -6 addr add dev tun6to4 2002:51a5:657d:0::1/64</span></p>
<p><span class="font19">root@mac:~# ip -6 addr add dev eth0 2002:51a5:657d:1::1/64</span></p>
<p><span class="font19">root@mac:~# ip -6 addr add dev eth0 fdcb:43c1:9c18:1::1/64</span></p>
<p><span class="font19">root@mac:~# ifconfig eth0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Link encap:Ethernet HWaddr 00:26:bb:5d:2e:52</span></p>
<p><span class="font19">inet addr:81.165.101.125 &nbsp;Bcast:255.255.255.255 &nbsp;Mask:255.255.248.0</span></p>
<p><span class="font19">inet6 addr: fe80::226:bbff:fe5d:2e52/64 Scope:Link inet6 addr: fdcb:43c1:9c18:1::1/64 Scope:Global inet6 addr: 2002:51a5:657d:1::1/64 Scope:Global UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:5927436 errors:0 dropped:0 overruns:0 frame:0 TX packets:2986025 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:4274948430 (4.2 GB) TX bytes:237014619 (237.0 MB) Interrupt:43 Base address:0x8000</span></p>
<p><span class="font19">lo &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Link encap:Local Loopback</span></p>
<p><span class="font19">inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host UP LOOPBACK RUNNING MTU:16436 Metric:1 RX packets:598 errors:0 dropped:0 overruns:0 frame:0 TX packets:598 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:61737 (61.7 KB) TX bytes:61737 (61.7 KB)</span></p>
<p><span class="font19">tun6to4 Link encap:IPv6-in-IPv4</span></p>
<p><span class="font19">inet6 addr: ::81.165.101.125/128 Scope:Compat inet6 addr: 2002:51a5:657d::1/64 Scope:Global UP RUNNING NOARP MTU:1472 Metric:1</span></p>
<p><span class="font19">RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B)</span></p>
<p><span class="font19">root@mac:~# ip -6 route add 2002::/16 dev tun6to4</span></p>
<p><span class="font19">root@mac:~# ip -6 route add ::/0 via ::192.88.99.1 dev tun6to4 metric 1 root@mac:~# ip -6 route show ::/96 via :: dev tun6to4 metric 256 mtu 1472 advmss 1412 hoplimit 0 2002:51a5:657d::/64 dev tun6to4 proto kernel metric 256 mtu 1472 advmss 1412 hoplimit 0 2002:51a5:657d:1::/64 dev eth0 proto kernel metric 256 mtu 1500 advmss 1440 hoplimit 0</span></p>
<p><span class="font19">2002::/16 dev tun6to4 metric 1024 mtu 1472 advmss 1412 hoplimit 0 fdcb:43c1:9c18:1::/64 dev eth0 proto kernel metric 256 mtu 1500 advmss 1440 hoplimit 0 fe80::/64 dev eth0 proto kernel metric 256 mtu 1500 advmss 1440 hoplimit 0 fe80::/64 dev tun6to4 proto kernel metric 256 mtu 1472 advmss 1412 hoplimit 0 default via ::192.88.99.1 dev tun6to4 metric 1 mtu 1472 advmss 1412 hoplimit 0 root@mac:~# ping6 ipv6-test.com PING ipv6-test.com(ipv6-test.com) 56 data bytes 64 bytes from ipv6-test.com: icmp_seq=1 ttl=57 time=42.4 ms</span></p>
<p><a href="#bookmark5949"><span class="font19">64 bytes from ipv6-test.com: icmp_seq=2 ttl=57 time=43.0</span></a></p>
<p><a href="#bookmark5950"><span class="font19">64 bytes from ipv6-test.com: icmp_seq=3 ttl=57 time=43.5</span></a></p>
<p><a href="#bookmark5951"><span class="font19">64 bytes from ipv6-test.com: icmp_seq=4 ttl=57 time=43.9</span></a></p>
<p><a href="#bookmark5952"><span class="font19">64 bytes from ipv6-test.com: icmp_seq=5 ttl=57 time=45.6</span></a></p>
<p><span class="font18"><sup>A</sup></span><span class="font19">C --- ipv6-test.com ping statistics --- 5 packets transmitted, 5 received, 0% packet loss, time 4006ms rtt min/avg/max/mdev = 42.485/43.717/45.632/1.091 ms</span></p>
<p><a name="bookmark5953"></a><span class="font11" style="font-weight:bold;">Part VIII. Appendix</span></p>
<h3><a name="bookmark5954"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5955"></a>Table of Contents</span></h3>
<p><a href="#bookmark5956"><span class="font24" style="font-weight:bold;">A. License</span></a></p>
<div>
<p><a href="#bookmark5956"><span class="font24" style="font-weight:bold;">277</span></a></p>
</div><br clear="all">
<h1><a name="bookmark5956"></a><span class="font11" style="font-weight:bold;"><a name="bookmark5957"></a><a name="bookmark5958"></a>Appendix A. License</span></h1>
<p><span class="font19">GNU Free Documentation License</span></p>
<p><span class="font19">Version 1.3, 3 November 2008</span></p>
<p><span class="font19">Copyright © 2000, 2001, 2002, 2007, 2008 Free Software Foundation, Inc.</span></p>
<p><span class="font19">Everyone is permitted to copy and distribute verbatim copies of this license document, but changing it is not allowed.</span></p>
<p><span class="font19">0. PREAMBLE</span></p>
<p><span class="font19">The purpose of this License is to make a manual, textbook, or other functional and useful document &quot;free&quot; in the sense of freedom: to assure everyone the effective freedom to copy and redistribute it, with or without modifying it, either commercially or noncommercially. Secondarily, this License preserves for the author and publisher a way to get credit for their work, while not being considered responsible for modifications made by others.</span></p>
<p><span class="font19">This License is a kind of &quot;copyleft&quot;, which means that derivative works of the document must themselves be free in the same sense. It complements the GNU General Public License, which is a copyleft license designed for free software.</span></p>
<p><span class="font19">We have designed this License in order to use it for manuals for free software, because free software needs free documentation: a free program should come with manuals providing the same freedoms that the software does. But this License is not limited to software manuals; it can be used for any textual work, regardless of subject matter or whether it is published as a printed book. We recommend this License principally for works whose purpose is instruction or reference.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">1. APPLICABILITY AND DEFINITIONS</span></p></li></ul>
<p><span class="font19">This License applies to any manual or other work, in any medium, that contains a notice placed by the copyright holder saying it can be distributed under the terms of this License. Such a notice grants a world-wide, royalty-free license, unlimited in duration, to use that work under the conditions stated herein. The &quot;Document&quot;, below, refers to any such manual or work. Any member of the public is a licensee, and is addressed as &quot;you&quot;. You accept the license if you copy, modify or distribute the work in a way requiring permission under copyright law.</span></p>
<p><span class="font19">A &quot;Modified Version&quot; of the Document means any work containing the Document or a portion of it, either copied verbatim, or with modifications and/or translated into another language.</span></p>
<p><span class="font19">A &quot;Secondary Section&quot; is a named appendix or a front-matter section of the Document that deals exclusively with the relationship of the publishers or authors of the Document to the Document's overall subject (or to related matters) and contains nothing that could fall directly within that overall subject. (Thus, if the Document is in part a textbook of mathematics, a Secondary Section may not explain any mathematics.) The relationship could be a matter of historical connection with the subject or with related matters, or of legal, commercial, philosophical, ethical or political position regarding them.</span></p>
<p><span class="font19">The &quot;Invariant Sections&quot; are certain Secondary Sections whose titles are designated, as being those of Invariant Sections, in the notice that says that the Document is released under this License. If a section does not fit the above definition of Secondary then it is not allowed to be designated as Invariant. The Document may contain zero Invariant Sections. If the Document does not identify any Invariant Sections then there are none.</span></p>
<p><span class="font19">The &quot;Cover Texts&quot; are certain short passages of text that are listed, as Front-Cover Texts or Back-Cover Texts, in the notice that says that the Document is released under this License. A Front-Cover Text may be at most 5 words, and a Back-Cover Text may be at most 25 words.</span></p>
<p><span class="font19">A &quot;Transparent&quot; copy of the Document means a machine-readable copy, represented in a format whose specification is available to the general public, that is suitable for revising the document straightforwardly with generic text editors or (for images composed of pixels) generic paint programs or (for drawings) some widely available drawing editor, and that is suitable for input to text formatters or for automatic translation to a variety of formats suitable for input to text formatters. A copy made in an otherwise Transparent file format whose markup, or absence of markup, has been arranged to thwart or discourage subsequent modification by readers is not Transparent. An image format is not Transparent if used for any substantial amount of text. A copy that is not &quot;Transparent&quot; is called &quot;Opaque&quot;.</span></p>
<p><span class="font19">Examples of suitable formats for Transparent copies include plain ASCII without markup, Texinfo input format, LaTeX input format, SGML or XML using a publicly available DTD, and standard-conforming simple HTML, PostScript or PDF designed for human modification. Examples of transparent image formats include PNG, XCF and JPG. Opaque formats include proprietary formats that can be read and edited only by proprietary word processors, SGML or XML for which the DTD and/or processing tools are not generally available, and the machine-generated HTML, PostScript or PDF produced by some word processors for output purposes only.</span></p>
<p><span class="font19">The &quot;Title Page&quot; means, for a printed book, the title page itself, plus such following pages as are needed to hold, legibly, the material this License requires to appear in the title page. For works in formats which do not have any title page as such, &quot;Title Page&quot; means the text near the most prominent appearance of the work's title, preceding the beginning of the body of the text.</span></p>
<p><span class="font19">The &quot;publisher&quot; means any person or entity that distributes copies of the Document to the public.</span></p>
<p><span class="font19">A section &quot;Entitled XYZ&quot; means a named subunit of the Document whose title either is precisely XYZ or contains XYZ in parentheses following text that translates XYZ in another language. (Here XYZ stands for a specific section name mentioned below, such as &quot;Acknowledgements&quot;, &quot;Dedications&quot;, &quot;Endorsements&quot;, or &quot;History&quot;.) To &quot;Preserve the Title&quot; of such a section when you modify the Document means that it remains a section &quot;Entitled XYZ&quot; according to this definition.</span></p>
<p><span class="font19">The Document may include Warranty Disclaimers next to the notice which states that this License applies to the Document. These Warranty Disclaimers are considered to be included by reference in this License, but only as regards disclaiming warranties: any other implication that these Warranty Disclaimers may have is void and has no effect on the meaning of this License.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">2. VERBATIM COPYING</span></p></li></ul>
<p><span class="font19">You may copy and distribute the Document in any medium, either commercially or noncommercially, provided that this License, the copyright notices, and the license notice saying this License applies to the Document are reproduced in all copies, and that you add no other conditions whatsoever to those of this License. You may not use technical measures to obstruct or control the reading or further copying of the copies you make or distribute. However, you may accept compensation in exchange for copies. If you distribute a large enough number of copies you must also follow the conditions in section 3.</span></p>
<p><span class="font19">You may also lend copies, under the same conditions stated above, and you may publicly display copies.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">3. COPYING IN QUANTITY</span></p></li></ul>
<p><span class="font19">If you publish printed copies (or copies in media that commonly have printed covers) of the Document, numbering more than 100, and the Document's license notice requires Cover Texts, you must enclose the copies in covers that carry, clearly and legibly, all these Cover Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on the back cover. Both covers must also clearly and legibly identify you as the publisher of these copies. The front cover must present the full title with all words of the title equally prominent and visible. You may add other material on the covers in addition. Copying with changes limited to the covers, as long as they preserve the title of the Document and satisfy these conditions, can be treated as verbatim copying in other respects.</span></p>
<p><span class="font19">If the required texts for either cover are too voluminous to fit legibly, you should put the first ones listed (as many as fit reasonably) on the actual cover, and continue the rest onto adjacent pages.</span></p>
<p><span class="font19">If you publish or distribute Opaque copies of the Document numbering more than 100, you must either include a machine-readable Transparent copy along with each Opaque copy, or state in or with each Opaque copy a computer-network location from which the general network-using public has access to download using public-standard network protocols a complete Transparent copy of the Document, free of added material. If you use the latter option, you must take reasonably prudent steps, when you begin distribution of Opaque copies in quantity, to ensure that this Transparent copy will remain thus accessible at the stated location until at least one year after the last time you distribute an Opaque copy (directly or through your agents or retailers) of that edition to the public.</span></p>
<p><span class="font19">It is requested, but not required, that you contact the authors of the Document well before redistributing any large number of copies, to give them a chance to provide you with an updated version of the Document.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">4. MODIFICATIONS</span></p></li></ul>
<p><span class="font19">You may copy and distribute a Modified Version of the Document under the conditions of sections 2 and 3 above, provided that you release the Modified Version under precisely this License, with the Modified Version filling the role of the Document, thus licensing distribution and modification of the Modified Version to whoever possesses a copy of it. In addition, you must do these things in the Modified Version:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">* A. Use in the Title Page (and on the covers, if any) a title distinct from that of the Document, and from those of previous versions (which should, if there were any, be listed in the History section of the Document). You may use the same title as a previous version if the original publisher of that version gives permission.</span></p></li>
<li>
<p><span class="font19">* B. List on the Title Page, as authors, one or more persons or entities responsible for authorship of the modifications in the Modified Version, together with at least five of the principal authors of the Document (all of its principal authors, if it has fewer than five), unless they release you from this requirement.</span></p></li>
<li>
<p><span class="font19">* C. State on the Title page the name of the publisher of the Modified Version, as the publisher.</span></p></li>
<li>
<p><span class="font19">* D. Preserve all the copyright notices of the Document.</span></p></li>
<li>
<p><span class="font19">* E. Add an appropriate copyright notice for your modifications adjacent to the other copyright notices.</span></p></li>
<li>
<p><span class="font19">* F. Include, immediately after the copyright notices, a license notice giving the public permission to use the Modified Version under the terms of this License, in the form shown in the Addendum below.</span></p></li>
<li>
<p><span class="font19">* G. Preserve in that license notice the full lists of Invariant Sections and required Cover Texts given in the Document's license notice.</span></p></li>
<li>
<p><span class="font19">* H. Include an unaltered copy of this License.</span></p></li>
<li>
<p><span class="font19">* I. Preserve the section Entitled &quot;History&quot;, Preserve its Title, and add to it an item stating at least the title, year, new authors, and publisher of the Modified Version as given on the Title Page. If there is no section Entitled &quot;History&quot; in the Document, create one stating the title, year, authors, and publisher of the Document as given on its Title Page, then add an item describing the Modified Version as stated in the previous sentence.</span></p></li>
<li>
<p><span class="font19">* J. Preserve the network location, if any, given in the Document for public access to a Transparent copy of the Document, and likewise the network locations given in the Document for previous versions it was based on. These may be placed in the &quot;History&quot; section. You may omit a network location for a work that was published at least four years before the Document itself, or if the original publisher of the version it refers to gives permission.</span></p></li>
<li>
<p><span class="font19">* K. For any section Entitled &quot;Acknowledgements&quot; or &quot;Dedications&quot;, Preserve the Title of the section, and preserve in the section all the substance and tone of each of the contributor acknowledgements and/or dedications given therein.</span></p></li>
<li>
<p><span class="font19">* L. Preserve all the Invariant Sections of the Document, unaltered in their text and in their titles. Section numbers or the equivalent are not considered part of the section titles.</span></p></li>
<li>
<p><span class="font19">* M. Delete any section Entitled &quot;Endorsements&quot;. Such a section may not be included in the Modified Version.</span></p></li>
<li>
<p><span class="font19">* N. Do not retitle any existing section to be Entitled &quot;Endorsements&quot; or to conflict in title with any Invariant Section.</span></p></li>
<li>
<p><span class="font19">* O. Preserve any Warranty Disclaimers.</span></p></li></ul>
<p><span class="font19">If the Modified Version includes new front-matter sections or appendices that qualify as Secondary Sections and contain no material copied from the Document, you may at your option designate some or all of these sections as invariant. To do this, add their titles to the list of Invariant Sections in the Modified Version's license notice. These titles must be distinct from any other section titles.</span></p>
<p><span class="font19">You may add a section Entitled &quot;Endorsements&quot;, provided it contains nothing but endorsements of your Modified Version by various parties—for example, statements of peer review or that the text has been approved by an organization as the authoritative definition of a standard.</span></p>
<p><span class="font19">You may add a passage of up to five words as a Front-Cover Text, and a passage of up to 25 words as a Back-Cover Text, to the end of the list of Cover Texts in the Modified Version. Only one passage of Front-Cover Text and one of Back-Cover Text may be added by (or through arrangements made by) any one entity. If the Document already includes a cover text for the same cover, previously added by you or by arrangement made by the same entity you are acting on behalf of, you may not add another; but you may replace the old one, on explicit permission from the previous publisher that added the old one.</span></p>
<p><span class="font19">The author(s) and publisher(s) of the Document do not by this License give permission to use their names for publicity for or to assert or imply endorsement of any Modified Version.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">5. COMBINING DOCUMENTS</span></p></li></ul>
<p><span class="font19">You may combine the Document with other documents released under this License, under the terms defined in section 4 above for modified versions, provided that you include in the combination all of the Invariant Sections of all of the original documents, unmodified, and list them all as Invariant Sections of your combined work in its license notice, and that you preserve all their Warranty Disclaimers.</span></p>
<p><span class="font19">The combined work need only contain one copy of this License, and multiple identical Invariant Sections may be replaced with a single copy. If there are multiple Invariant Sections with the same name but different contents, make the title of each such section unique by adding at the end of it, in parentheses, the name of the original author or publisher of that section if known, or else a unique number. Make the same adjustment to the section titles in the list of Invariant Sections in the license notice of the combined work.</span></p>
<p><span class="font19">In the combination, you must combine any sections Entitled &quot;History&quot; in the various original documents, forming one section Entitled &quot;History&quot;; likewise combine any sections Entitled &quot;Acknowledgements&quot;, and any sections Entitled &quot;Dedications&quot;. You must delete all sections Entitled &quot;Endorsements&quot;.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">6. COLLECTIONS OF DOCUMENTS</span></p></li></ul>
<p><span class="font19">You may make a collection consisting of the Document and other documents released under this License, and replace the individual copies of this License in the various documents with a single copy that is included in the collection, provided that you follow the rules of this License for verbatim copying of each of the documents in all other respects.</span></p>
<p><span class="font19">You may extract a single document from such a collection, and distribute it individually under this License, provided you insert a copy of this License into the extracted document, and follow this License in all other respects regarding verbatim copying of that document.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">7. AGGREGATION WITH INDEPENDENT WORKS</span></p></li></ul>
<p><span class="font19">A compilation of the Document or its derivatives with other separate and independent documents or works, in or on a volume of a storage or distribution medium, is called an &quot;aggregate&quot; if the copyright resulting from the compilation is not used to limit the legal rights of the compilation's users beyond what the individual works permit. When the Document is included in an aggregate, this License does not apply to the other works in the aggregate which are not themselves derivative works of the Document.</span></p>
<p><span class="font19">If the Cover Text requirement of section 3 is applicable to these copies of the Document, then if the Document is less than one half of the entire aggregate, the Document's Cover Texts may be placed on covers that bracket the Document within the aggregate, or the electronic equivalent of covers if the Document is in electronic form. Otherwise they must appear on printed covers that bracket the whole aggregate.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">8. TRANSLATION</span></p></li></ul>
<p><span class="font19">Translation is considered a kind of modification, so you may distribute translations of the Document under the terms of section 4. Replacing Invariant Sections with translations requires special permission from their copyright holders, but you may include translations of some or all Invariant Sections in addition to the original versions of these Invariant Sections. You may include a translation of this License, and all the license notices in the Document, and any Warranty Disclaimers, provided that you also include the original English version of this License and the original versions of those notices and disclaimers. In case of a disagreement between the translation and the original version of this License or a notice or disclaimer, the original version will prevail.</span></p>
<p><span class="font19">If a section in the Document is Entitled &quot;Acknowledgements&quot;, &quot;Dedications&quot;, or &quot;History&quot;, the requirement (section 4) to Preserve its Title (section 1) will typically require changing the actual title.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">9. TERMINATION</span></p></li></ul>
<p><span class="font19">You may not copy, modify, sublicense, or distribute the Document except as expressly provided under this License. Any attempt otherwise to copy, modify, sublicense, or distribute it is void, and will automatically terminate your rights under this License.</span></p>
<p><span class="font19">However, if you cease all violation of this License, then your license from a particular copyright holder is reinstated (a) provisionally, unless and until the copyright holder explicitly and finally terminates your license, and (b) permanently, if the copyright holder fails to notify you of the violation by some reasonable means prior to 60 days after the cessation.</span></p>
<p><span class="font19">Moreover, your license from a particular copyright holder is reinstated permanently if the copyright holder notifies you of the violation by some reasonable means, this is the first time you have received notice of violation of this License (for any work) from that copyright holder, and you cure the violation prior to 30 days after your receipt of the notice.</span></p>
<p><span class="font19">Termination of your rights under this section does not terminate the licenses of parties who have received copies or rights from you under this License. If your rights have been terminated and not permanently reinstated, receipt of a copy of some or all of the same material does not give you any rights to use it.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">10. FUTURE REVISIONS OF THIS LICENSE</span></p></li></ul>
<p><span class="font19">The Free Software Foundation may publish new, revised versions of the GNU Free Documentation License from time to time. Such new versions will be similar in spirit to the present version, but may differ in detail to address new problems or concerns. See </span><a href="http://www.gnu.org/copyleft/"><span class="font19">http://www.gnu.org/copyleft/</span></a><span class="font19">.</span></p>
<p><span class="font19">Each version of the License is given a distinguishing version number. If the Document specifies that a particular numbered version of this License &quot;or any later version&quot; applies to it, you have the option of following the terms and conditions either of that specified version or of any later version that has been published (not as a draft) by the Free Software Foundation. If the Document does not specify a version number of this License, you may choose any version ever published (not as a draft) by the Free Software Foundation. If the Document specifies that a proxy can decide which future versions of this License can be used, that proxy's public statement of acceptance of a version permanently authorizes you to choose that version for the Document.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">11. RELICENSING</span></p></li></ul>
<p><span class="font19">&quot;Massive Multiauthor Collaboration Site&quot; (or &quot;MMC Site&quot;) means any World Wide Web server that publishes copyrightable works and also provides prominent facilities for anybody to edit those works. A public wiki that anybody can edit is an example of such a server. A &quot;Massive Multiauthor Collaboration&quot; (or &quot;MMC&quot;) contained in the site means any set of copyrightable works thus published on the MMC site.</span></p>
<p><span class="font19">&quot;CC-BY-SA&quot; means the Creative Commons Attribution-Share Alike 3.0 license published by Creative Commons Corporation, a not-for-profit corporation with a principal place of business in San Francisco, California, as well as future copyleft versions of that license published by that same organization.</span></p>
<p><span class="font19">&quot;Incorporate&quot; means to publish or republish a Document, in whole or in part, as part of another Document.</span></p>
<p><span class="font19">An MMC is &quot;eligible for relicensing&quot; if it is licensed under this License, and if all works that were first published under this License somewhere other than this MMC, and subsequently incorporated in whole or in part into the MMC, (1) had no cover texts or invariant sections, and (2) were thus incorporated prior to November 1, 2008.</span></p>
<p><span class="font19">The operator of an MMC Site may republish an MMC contained in the site under CC-BY-SA on the same site at any time before August 1, 2009, provided the MMC is eligible for relicensing.</span></p>
<h1><a name="bookmark5959"></a><span class="font11" style="font-weight:bold;"><a name="bookmark4672"></a><a name="bookmark5960"></a>Index</span></h1>
<p><span class="font7" style="font-weight:bold;">Symbols</span></p>
<p><span class="font24">/etc/apache2, 83</span></p>
<p><span class="font24">/etc/bind/named.conf.local,</span><a href="#bookmark5495"><span class="font24"> 133</span></a></p>
<p><span class="font24">/etc/exports,</span><a href="#bookmark5243"><span class="font24"> 61</span></a><span class="font24">, </span><a href="#bookmark5328"><span class="font24">72</span></a></p>
<p><span class="font24">/etc/fstab, </span><a href="#bookmark5256"><span class="font24">62</span></a><span class="font24">, </span><a href="#bookmark5333"><span class="font24">72</span></a></p>
<p><span class="font24">/etc/hostname,</span><a href="#bookmark4896"><span class="font24"> 23</span></a></p>
<p><span class="font24">/etc/httpd, 83</span></p>
<p><span class="font24">/etc/inetd.conf,</span><a href="#bookmark5309"><span class="font24"> 69</span></a><span class="font24">, 209</span></p>
<p><span class="font24">/etc/init.d/samba, 198</span></p>
<p><span class="font24">/etc/init.d/smb, 198</span></p>
<p><span class="font24">/etc/init.d/winbind, 199</span></p>
<p><span class="font24">/etc/network/interfaces,</span><a href="#bookmark4824"><span class="font24"> 16</span></a><span class="font24">, </span><a href="#bookmark5068"><span class="font24">40</span></a><span class="font24">, </span><a href="#bookmark5106"><span class="font24">43</span></a></p>
<p><span class="font24">/etc/nsswitch.conf, 247, 249</span></p>
<p><span class="font24">/etc/passwd, 256</span></p>
<p><span class="font24">/etc/protocols,</span><a href="#bookmark4812"><span class="font24"> 13</span></a></p>
<p><span class="font24">/etc/resolv.conf,</span><a href="#bookmark5402"><span class="font24"> 119</span></a></p>
<p><span class="font24">/etc/samba/passdb.tdb, 255</span></p>
<p><span class="font24">/etc/samba/smb.conf, 203, 204, 205, 221, 245</span></p>
<p><span class="font24">/etc/samba/smbpasswd, 226, 253</span></p>
<p><span class="font24">/etc/services,</span><a href="#bookmark4815"><span class="font24"> 13</span></a><span class="font24">,</span><a href="#bookmark5306"><span class="font24"> 69</span></a></p>
<p><span class="font24">/etc/squid/squid.conf, 107</span></p>
<p><span class="font24">/etc/ssh, </span><a href="#bookmark5140"><span class="font24">48</span></a></p>
<p><span class="font24">/etc/ssh/ssh_config, </span><a href="#bookmark5143"><span class="font24">48</span></a></p>
<p><span class="font24">/etc/ssh/sshd_config, </span><a href="#bookmark5144"><span class="font24">48</span></a></p>
<p><span class="font24">/etc/sysconfig/iptables, </span><a href="#bookmark5268"><span class="font24">65</span></a></p>
<p><span class="font24">/etc/sysconfig/network,</span><a href="#bookmark4846"><span class="font24"> 18</span></a></p>
<p><span class="font24">/etc/sysconfig/network-scripts/,</span><a href="#bookmark4850"><span class="font24"> 18</span></a></p>
<p><span class="font24">/etc/sysconfig/network-scripts/ifcfg-bond0, </span><a href="#bookmark5088"><span class="font24">41</span></a></p>
<p><span class="font24">/etc/sysctl.conf,</span><a href="#bookmark5774"><span class="font24"> 173</span></a></p>
<p><span class="font24">/etc/xinetd.conf,</span><a href="#bookmark5303"><span class="font24"> 68</span></a></p>
<p><span class="font24">/etc/xinetd.d, </span><a href="#bookmark5304"><span class="font24">68</span></a></p>
<p><span class="font24">/etc/xinetd.d/swat, 209</span></p>
<p><span class="font24">/proc/net/bonding, </span><a href="#bookmark5094"><span class="font24">41</span></a><span class="font24">, </span><a href="#bookmark5111"><span class="font24">43</span></a></p>
<p><span class="font24">/proc/sys/net/ipv4/ip_forward,</span><a href="#bookmark5771"><span class="font24"> 173</span></a></p>
<p><span class="font24">/sbin, </span><a href="#bookmark4872"><span class="font24">21</span></a></p>
<p><span class="font24">/usr/share/doc,</span><a href="#bookmark4847"><span class="font24"> 18</span></a></p>
<p><span class="font24">/var/lib/nfs/etab, </span><a href="#bookmark5252"><span class="font24">61</span></a><span class="font24">, </span><a href="#bookmark5330"><span class="font24">72</span></a></p>
<p><span class="font24">/var/log/squid, 112</span></p>
<p><span class="font24">.htaccess, 100</span></p>
<p><span class="font24">.htpasswd, 90, 97</span></p>
<p><span class="font24">.ssh,</span><a href="#bookmark5166"><span class="font24"> 52</span></a></p>
<p><span class="font24">~/.ssh/authorized_keys,</span><a href="#bookmark5179"><span class="font24"> 53</span></a></p>
<p><span class="font7" style="font-weight:bold;">A</span></p>
<p><span class="font24">A (DNS record),</span><a href="#bookmark5445"><span class="font24"> 124</span></a></p>
<p><span class="font24">AAAA (DNS record),</span><a href="#bookmark5446"><span class="font24"> 124</span></a></p>
<p><span class="font24">Alica and Bob, </span><a href="#bookmark5148"><span class="font24">49</span></a></p>
<p><span class="font24">allow hosts (Samba), 238</span></p>
<p><span class="font24">anycast, </span><a href="#bookmark4774"><span class="font24">9</span></a></p>
<p><span class="font24">apache2, 79</span></p>
<p><span class="font24">aptitude, 195, 196</span></p>
<p><span class="font24">arp(1), </span><a href="#bookmark4901"><span class="font24">24</span></a></p>
<p><span class="font24">arp table,</span><a href="#bookmark4904"><span class="font24"> 24</span></a></p>
<p><span class="font24">atm,</span><a href="#bookmark4786"><span class="font24"> 11</span></a></p>
<div>
<p><span class="font24">authoritative (dns),</span><a href="#bookmark5469"><span class="font24"> 128</span></a></p>
<p><span class="font24">authoritative zone,</span><a href="#bookmark5443"><span class="font24"> 123</span></a></p>
<p><span class="font24">axfr,</span><a href="#bookmark5489"><span class="font24"> 131</span></a></p>
<p><span class="font7" style="font-weight:bold;">B</span></p>
<p><span class="font24">bind,</span><a href="#bookmark5417"><span class="font24"> 121</span></a></p>
<p><span class="font24">bind(DNS),</span><a href="#bookmark5571"><span class="font24"> 147</span></a></p>
<p><span class="font24">binding,</span><a href="#bookmark5047"><span class="font24"> 39</span></a></p>
<p><span class="font24">binding(ip),</span><a href="#bookmark5041"><span class="font24"> 38</span></a></p>
<p><span class="font24">bonding(ip),</span><a href="#bookmark5042"><span class="font24"> 38</span></a></p>
<p><span class="font24">bootp,</span><a href="#bookmark4851"><span class="font24"> 18</span></a><span class="font24">,</span><a href="#bookmark4996"><span class="font24"> 34</span></a></p>
<p><span class="font24">broadcast, </span><a href="#bookmark4771"><span class="font24">9</span></a></p>
<p><span class="font24">browsable (Samba), 239</span></p>
<p><span class="font24">browseable (Samba), 239</span></p>
<p><span class="font24">browser master, 253</span></p>
<p><span class="font7" style="font-weight:bold;">C</span></p>
<p><span class="font24">cahing only name server,</span><a href="#bookmark5456"><span class="font24"> 125</span></a></p>
<p><span class="font24">chain (iptables),</span><a href="#bookmark5808"><span class="font24"> 180</span></a></p>
<p><span class="font24">CIFS, 200</span></p>
<p><span class="font24">Cisco,</span><a href="#bookmark4791"><span class="font24"> 11</span></a></p>
<p><span class="font24">CNAME (DNS record),</span><a href="#bookmark5451"><span class="font24"> 124</span></a></p>
<p><span class="font24">create mask (Samba), 239</span></p>
<p><span class="font7" style="font-weight:bold;">D</span></p>
<p><span class="font24">default gateway, </span><a href="#bookmark4913"><span class="font24">25</span></a></p>
<p><span class="font24">deny hosts (Samba), 239</span></p>
<p><span class="font24">dhclient,</span><a href="#bookmark5788"><span class="font24"> 175</span></a></p>
<p><span class="font24">dhclient(1), </span><a href="#bookmark4890"><span class="font24">23</span></a></p>
<p><span class="font24">dhcp,</span><a href="#bookmark4852"><span class="font24"> 18</span></a><span class="font24">,</span><a href="#bookmark4997"><span class="font24"> 34</span></a></p>
<p><span class="font24">dhcp client,</span><a href="#bookmark4825"><span class="font24"> 16</span></a><span class="font24">,</span><a href="#bookmark4891"><span class="font24"> 23</span></a></p>
<p><span class="font24">dhcp server,</span><a href="#bookmark5400"><span class="font24"> 119</span></a></p>
<p><span class="font24">directory mask (Samba), 239</span></p>
<p><span class="font24">directory security mask(samba), 240</span></p>
<p><span class="font24">DNAT,</span><a href="#bookmark5765"><span class="font24"> 172</span></a></p>
<p><span class="font24">dns,</span><a href="#bookmark5000"><span class="font24"> 34</span></a><span class="font24">,</span><a href="#bookmark5370"><span class="font24"> 117</span></a><span class="font24">,</span><a href="#bookmark5375"><span class="font24"> 117</span></a></p>
<p><span class="font24">dnsdomainname,</span><a href="#bookmark5438"><span class="font24"> 123</span></a></p>
<p><span class="font24">dns namespace,</span><a href="#bookmark5407"><span class="font24"> 120</span></a></p>
<p><span class="font24">dns server,</span><a href="#bookmark5401"><span class="font24"> 119</span></a></p>
<p><span class="font24">domain (dns),</span><a href="#bookmark5421"><span class="font24"> 121</span></a></p>
<p><span class="font24">domain name system,</span><a href="#bookmark5371"><span class="font24"> 117</span></a><span class="font24">,</span><a href="#bookmark5376"><span class="font24"> 117</span></a></p>
<p><span class="font24">dpkg, 195</span></p>
<p><span class="font24">dsa, </span><a href="#bookmark5152"><span class="font24">49</span></a></p>
<p><span class="font7" style="font-weight:bold;">E</span></p>
<p><span class="font24">eth0,</span><a href="#bookmark4826"><span class="font24"> 16</span></a></p>
<p><span class="font24">ethtool(1),</span><a href="#bookmark4927"><span class="font24"> 26</span></a></p>
<p><span class="font24">exportfs(1),</span><a href="#bookmark5253"><span class="font24"> 61</span></a><span class="font24">, </span><a href="#bookmark5331"><span class="font24">72</span></a></p>
<p><span class="font7" style="font-weight:bold;">F</span></p>
<p><span class="font24">fddi,</span><a href="#bookmark4787"><span class="font24"> 11</span></a></p>
<p><span class="font24">filter table (iptables),</span><a href="#bookmark5800"><span class="font24"> 180</span></a></p>
<p><span class="font24">firewall,</span><a href="#bookmark5739"><span class="font24"> 171</span></a></p>
<p><span class="font24">fixed ip,</span><a href="#bookmark4853"><span class="font24"> 19</span></a></p>
<p><span class="font24">fixed ip address,</span><a href="#bookmark4827"><span class="font24"> 16</span></a></p>
<p><span class="font24">force create mode(samba), 240</span></p>
</div><br clear="all">
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24">force directory mode(samba), 240</span></p>
<p><span class="font24">force directory security mode(samba), 240</span></p>
<p><span class="font24">force group(samba), 227</span></p>
<p><span class="font24">force security mode(samba), 240</span></p>
<p><span class="font24">force user(samba), 227</span></p>
<p><span class="font24">forwarder (dns),</span><a href="#bookmark5462"><span class="font24"> 127</span></a></p>
<p><span class="font24">forward lookup query,</span><a href="#bookmark5379"><span class="font24"> 118</span></a></p>
<p><span class="font24">FQDN,</span><a href="#bookmark4894"><span class="font24"> 23</span></a></p>
<p><span class="font24">fqdn,</span><a href="#bookmark5436"><span class="font24"> 123</span></a></p>
<p><span class="font24">frame relay,</span><a href="#bookmark4788"><span class="font24"> 11</span></a></p>
<p><span class="font24">ftp,</span><a href="#bookmark5294"><span class="font24"> 68</span></a></p>
<p><span class="font24">fully qualified domain name,</span><a href="#bookmark5437"><span class="font24"> 123</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">L</span></p>
<p><span class="font24">LAN,</span><a href="#bookmark4780"><span class="font24"> 10</span></a></p>
<p><span class="font24">ldap, </span><a href="#bookmark5244"><span class="font24">61</span></a></p>
<p><span class="font7" style="font-weight:bold;">M</span></p>
<p><span class="font24">mac address, </span><a href="#bookmark4882"><span class="font24">21</span></a><span class="font24">,</span><a href="#bookmark5783"><span class="font24"> 174</span></a></p>
<p><span class="font24">MAN,</span><a href="#bookmark4783"><span class="font24"> 10</span></a></p>
<p><span class="font24">mangle table (iptables),</span><a href="#bookmark5805"><span class="font24"> 180</span></a></p>
<p><span class="font24">masquerading,</span><a href="#bookmark5762"><span class="font24"> 172</span></a></p>
<p><span class="font24">master server (DNS),</span><a href="#bookmark5481"><span class="font24"> 130</span></a></p>
<p><span class="font24">mount(1), </span><a href="#bookmark5257"><span class="font24">62</span></a><span class="font24">, </span><a href="#bookmark5334"><span class="font24">72</span></a></p>
<p><span class="font24">multicast,</span><a href="#bookmark4768"><span class="font24"> 8</span></a></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font7" style="font-weight:bold;">G</span></p>
<p><span class="font24">gateway, </span><a href="#bookmark4914"><span class="font24">25</span></a></p>
<p><span class="font24">getent(1), 248</span></p>
<p><span class="font24">glue record (dns),</span><a href="#bookmark5450"><span class="font24"> 124</span></a></p>
<p><span class="font24">guest ok (Samba), 214</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">MX (DNS record),</span><a href="#bookmark5453"><span class="font24"> 124</span></a></p>
<p><span class="font7" style="font-weight:bold;">N</span></p>
<p><span class="font24">NAPT,</span><a href="#bookmark5755"><span class="font24"> 172</span></a></p>
<p><span class="font24">NAT,</span><a href="#bookmark5752"><span class="font24"> 172</span></a></p>
<p><span class="font24">nat table (iptables),</span><a href="#bookmark5802"><span class="font24"> 180</span></a></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font7" style="font-weight:bold;">H</span></p>
<p><span class="font24">hide unreadable (Samba), 239</span></p>
<p><span class="font24">host (DNS record),</span><a href="#bookmark5447"><span class="font24"> 124</span></a></p>
<p><span class="font24">hostname, </span><a href="#bookmark4895"><span class="font24">23</span></a><span class="font24">,</span><a href="#bookmark5439"><span class="font24"> 123</span></a><span class="font24">, 200</span></p>
<p><span class="font24">hostname(1), </span><a href="#bookmark4897"><span class="font24">23</span></a></p>
<p><span class="font24">hosts.txt,</span><a href="#bookmark5373"><span class="font24"> 117</span></a></p>
<p><span class="font24">hosts allow (Samba), 238</span></p>
<p><span class="font24">hosts deny (Samba), 239</span></p>
<p><span class="font24">htpasswd(1), 90, 97</span></p>
<p><span class="font24">httpd, 80</span></p></td><td style="vertical-align:top;">
<p><span class="font24">NetBIOS names, 200</span></p>
<p><span class="font24">netcat, 217</span></p>
<p><span class="font24">net groupmap, 258</span></p>
<p><span class="font24">net rpc join(samba), 246</span></p>
<p><span class="font24">netstat(1),</span><a href="#bookmark4909"><span class="font24"> 25</span></a></p>
<p><span class="font24">net use(microsoft), 216, 221, 232</span></p>
<p><span class="font24">net view(microsoft), 203, 208</span></p>
<p><span class="font24">network file system, </span><a href="#bookmark5214"><span class="font24">59</span></a></p>
<p><span class="font24">nfs, </span><a href="#bookmark5215"><span class="font24">59</span></a><span class="font24">,</span><a href="#bookmark5218"><span class="font24"> 60</span></a></p>
<p><span class="font24">NFS, </span><a href="#bookmark5316"><span class="font24">71</span></a></p>
<p><span class="font24">nmbd(8), 199</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font7" style="font-weight:bold;">I</span></p>
<p><span class="font24">IBM, 200</span></p>
<p><span class="font24">icmp,</span><a href="#bookmark4807"><span class="font24"> 13</span></a></p>
<p><span class="font24">id_dsa, </span><a href="#bookmark5172"><span class="font24">53</span></a></p>
<p><span class="font24">id_dsa.pub, </span><a href="#bookmark5173"><span class="font24">53</span></a></p>
<p><span class="font24">id_rsa, </span><a href="#bookmark5169"><span class="font24">52</span></a></p>
<p><span class="font24">id_rsa.pub, </span><a href="#bookmark5170"><span class="font24">52</span></a></p>
<p><span class="font24">idmap gid(samba), 245</span></p>
<p><span class="font24">idmap uid(samba), 245</span></p>
<p><span class="font24">ifcfg(1),</span><a href="#bookmark5048"><span class="font24"> 39</span></a></p>
<p><span class="font24">ifcfg-eth0,</span><a href="#bookmark4854"><span class="font24"> 19</span></a></p>
<p><span class="font24">ifconfig(1),</span><a href="#bookmark4867"><span class="font24"> 20</span></a><span class="font24">, </span><a href="#bookmark4875"><span class="font24">21</span></a><span class="font24">,</span><a href="#bookmark5059"><span class="font24"> 39</span></a><span class="font24">, </span><a href="#bookmark5076"><span class="font24">40</span></a><span class="font24">, </span><a href="#bookmark5081"><span class="font24">41</span></a><span class="font24">, </span><a href="#bookmark5099"><span class="font24">43</span></a></p>
<p><span class="font24">ifdown(1),</span><a href="#bookmark4832"><span class="font24"> 17</span></a><span class="font24">, </span><a href="#bookmark4861"><span class="font24">20</span></a><span class="font24">,</span><a href="#bookmark4879"><span class="font24"> 21</span></a><span class="font24">,</span><a href="#bookmark5053"><span class="font24"> 39</span></a></p>
<p><span class="font24">ifenslave, </span><a href="#bookmark5104"><span class="font24">43</span></a></p>
<p><span class="font24">ifup(1),</span><a href="#bookmark4839"><span class="font24"> 17</span></a><span class="font24">, </span><a href="#bookmark4862"><span class="font24">20</span></a><span class="font24">, </span><a href="#bookmark4876"><span class="font24">21</span></a><span class="font24">,</span><a href="#bookmark5054"><span class="font24"> 39</span></a><span class="font24">, </span><a href="#bookmark5071"><span class="font24">40</span></a><span class="font24">, </span><a href="#bookmark5091"><span class="font24">41</span></a></p>
<p><span class="font24">igmp,</span><a href="#bookmark4808"><span class="font24"> 13</span></a></p>
<p><span class="font24">inetd,</span><a href="#bookmark5295"><span class="font24"> 68</span></a></p>
<p><span class="font24">inetd(8), 209</span></p>
<p><span class="font24">invalid users (Samba), 238</span></p>
<p><span class="font24">iptables,</span><a href="#bookmark5264"><span class="font24"> 65</span></a><span class="font24">,</span><a href="#bookmark5794"><span class="font24"> 179</span></a><span class="font24">,</span><a href="#bookmark5797"><span class="font24"> 180</span></a></p>
<p><span class="font24">iptables save,</span><a href="#bookmark5840"><span class="font24"> 184</span></a></p>
<p><span class="font24">iterative query,</span><a href="#bookmark5465"><span class="font24"> 127</span></a></p>
<p><span class="font24">ixfr,</span><a href="#bookmark5490"><span class="font24"> 131</span></a></p></td><td style="vertical-align:top;">
<p><span class="font24">no_subtree_check(nfs),</span><a href="#bookmark5248"><span class="font24"> 61</span></a></p>
<p><span class="font24">NS (DNS record),</span><a href="#bookmark5449"><span class="font24"> 124</span></a></p>
<p><span class="font24">nslookup,</span><a href="#bookmark5390"><span class="font24"> 118</span></a></p>
<p><span class="font24">NT_STATUS_BAD_NETWORK_NAME, 233</span></p>
<p><span class="font24">NT_STATUS_LOGON_FAILURE, 233</span></p>
<p><span class="font7" style="font-weight:bold;">O</span></p>
<p><span class="font24">OpenBSD, </span><a href="#bookmark5137"><span class="font24">48</span></a></p>
<p><span class="font24">openssh, </span><a href="#bookmark5132"><span class="font24">48</span></a></p>
<p><span class="font24">openssh-server, </span><a href="#bookmark5191"><span class="font24">55</span></a></p>
<p><span class="font7" style="font-weight:bold;">P</span></p>
<p><span class="font24">packet filtering,</span><a href="#bookmark5746"><span class="font24"> 171</span></a><span class="font24">,</span><a href="#bookmark5820"><span class="font24"> 181</span></a></p>
<p><span class="font24">packet forwarding,</span><a href="#bookmark5743"><span class="font24"> 171</span></a></p>
<p><span class="font24">PAN,</span><a href="#bookmark4795"><span class="font24"> 11</span></a></p>
<p><span class="font24">passdb backend (Samba), 227</span></p>
<p><span class="font24">PAT,</span><a href="#bookmark5756"><span class="font24"> 172</span></a></p>
<p><span class="font24">Paul Mockapetris,</span><a href="#bookmark5374"><span class="font24"> 117</span></a></p>
<p><span class="font24">ping,</span><a href="#bookmark4809"><span class="font24"> 13</span></a><span class="font24">, </span><a href="#bookmark4922"><span class="font24">25</span></a><span class="font24">,</span><a href="#bookmark5784"><span class="font24"> 174</span></a><span class="font24">,</span><a href="#bookmark5785"><span class="font24"> 175</span></a></p>
<p><span class="font24">port forwarding,</span><a href="#bookmark5768"><span class="font24"> 172</span></a></p>
<p><span class="font24">portmap, </span><a href="#bookmark5230"><span class="font24">60</span></a><span class="font24">, </span><a href="#bookmark5317"><span class="font24">71</span></a></p>
<p><span class="font24">primary dns server,</span><a href="#bookmark5473"><span class="font24"> 128</span></a></p>
<p><span class="font24">primary server (DNS),</span><a href="#bookmark5482"><span class="font24"> 130</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">K</span></p>
<p><span class="font24">Kerberos, </span><a href="#bookmark5223"><span class="font24">60</span></a><span class="font24">, </span><a href="#bookmark5324"><span class="font24">71</span></a></p>
<p><span class="font24">kmyfirewall,</span><a href="#bookmark5269"><span class="font24"> 65</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">private key, </span><a href="#bookmark5149"><span class="font24">49</span></a></p>
<p><span class="font24">proxy server, 106</span></p>
<p><span class="font24">PTR (DNS record),</span><a href="#bookmark5448"><span class="font24"> 124</span></a></p>
<p><span class="font24">public key, </span><a href="#bookmark5147"><span class="font24">49</span></a></p></td></tr>
</table>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">Q</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">ssh-keygen,</span><a href="#bookmark5171"><span class="font24"> 52</span></a></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font24">query (dns),</span><a href="#bookmark5380"><span class="font24"> 118</span></a></p></td><td style="vertical-align:top;">
<p><span class="font24">ssh-keygen(1), </span><a href="#bookmark5163"><span class="font24">52</span></a></p>
<p><span class="font24">ssh -X, </span><a href="#bookmark5184"><span class="font24">53</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">R</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">stateful firewall,</span><a href="#bookmark5749"><span class="font24"> 171</span></a></p>
<p><span class="font24">subtree_check(nfs), </span><a href="#bookmark5249"><span class="font24">61</span></a></p></td></tr>
<tr><td rowspan="2" style="vertical-align:bottom;">
<p><span class="font24">read list (Samba), 238</span></p>
<p><span class="font24">read only (Samba), 221</span></p>
<p><span class="font24">recursive query,</span><a href="#bookmark5466"><span class="font24"> 127</span></a></p>
<p><span class="font24">reverse lookup query,</span><a href="#bookmark5383"><span class="font24"> 118</span></a></p>
<p><span class="font24">rfc 3010, </span><a href="#bookmark5224"><span class="font24">60</span></a></p>
<p><span class="font24">rfc 3530, </span><a href="#bookmark5225"><span class="font24">60</span></a></p>
<p><span class="font24">rlogin, </span><a href="#bookmark5133"><span class="font24">48</span></a></p>
<p><span class="font24">roaming profiles(samba), 257</span></p>
<p><span class="font24">root(DNS),</span><a href="#bookmark5408"><span class="font24"> 120</span></a></p>
<p><span class="font24">root hints,</span><a href="#bookmark5414"><span class="font24"> 121</span></a></p>
<p><span class="font24">root server (dns),</span><a href="#bookmark5459"><span class="font24"> 126</span></a></p>
<p><span class="font24">root servers(DNS),</span><a href="#bookmark4775"><span class="font24"> 9</span></a></p>
<p><span class="font24">root servers (dns),</span><a href="#bookmark5411"><span class="font24"> 120</span></a></p>
<p><span class="font24">rootsquash,</span><a href="#bookmark5245"><span class="font24"> 61</span></a><span class="font24">, </span><a href="#bookmark5329"><span class="font24">72</span></a></p>
<p><span class="font24">route(1), </span><a href="#bookmark4910"><span class="font24">25</span></a><span class="font24">, </span><a href="#bookmark4915"><span class="font24">25</span></a></p>
<p><span class="font24">router,</span><a href="#bookmark4792"><span class="font24"> 11</span></a><span class="font24">,</span><a href="#bookmark5740"><span class="font24"> 171</span></a></p>
<p><span class="font24">rpc, </span><a href="#bookmark5231"><span class="font24">60</span></a></p>
<p><span class="font24">RPC, </span><a href="#bookmark5318"><span class="font24">71</span></a></p></td><td style="vertical-align:top;">
<p><span class="font24">swat,</span><a href="#bookmark5296"><span class="font24"> 68</span></a></p>
<p><span class="font24">swat(8), 209</span></p>
<p><span class="font24">sysctl,</span><a href="#bookmark5777"><span class="font24"> 173</span></a></p>
<p><span class="font24">sysctl(1),</span><a href="#bookmark4898"><span class="font24"> 23</span></a></p>
<p><span class="font24">system-config-securitylevel, </span><a href="#bookmark5270"><span class="font24">65</span></a></p>
<p><span class="font7" style="font-weight:bold;">T</span></p>
<p><span class="font24">tcp,</span><a href="#bookmark4810"><span class="font24"> 13</span></a><span class="font24">,</span><a href="#bookmark5219"><span class="font24"> 60</span></a></p>
<p><span class="font24">tcpdump,</span><a href="#bookmark4965"><span class="font24"> 30</span></a><span class="font24">,</span><a href="#bookmark5005"><span class="font24"> 35</span></a><span class="font24">,</span><a href="#bookmark5014"><span class="font24"> 35</span></a><span class="font24">,</span><a href="#bookmark5393"><span class="font24"> 118</span></a><span class="font24">,</span><a href="#bookmark5786"><span class="font24"> 175</span></a></p>
<p><span class="font24">tdbsam, 227, 253, 255</span></p>
<p><span class="font24">telnet, </span><a href="#bookmark5135"><span class="font24">48</span></a><span class="font24">, </span><a href="#bookmark5297"><span class="font24">68</span></a></p>
<p><span class="font24">testparm(1), 204, 204, 205</span></p>
<p><span class="font24">tld,</span><a href="#bookmark5430"><span class="font24"> 122</span></a></p>
<p><span class="font24">TLD (dns),</span><a href="#bookmark5432"><span class="font24"> 122</span></a></p>
<p><span class="font24">top level domain,</span><a href="#bookmark5431"><span class="font24"> 122</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">U</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">rpcinfo(1), </span><a href="#bookmark5232"><span class="font24">60</span></a><span class="font24">, </span><a href="#bookmark5319"><span class="font24">71</span></a></p>
<p><span class="font24">rpm, 195</span></p>
<p><span class="font24">rpm(8), 196</span></p></td><td style="vertical-align:top;">
<p><span class="font24">udp,</span><a href="#bookmark4811"><span class="font24"> 13</span></a><span class="font24">, </span><a href="#bookmark5220"><span class="font24">60</span></a></p>
<p><span class="font7" style="font-weight:bold;">V</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">rsa, </span><a href="#bookmark5153"><span class="font24">49</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">valid users (Samba), 238</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">rsh, </span><a href="#bookmark5134"><span class="font24">48</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">virtualbox,</span><a href="#bookmark5780"><span class="font24"> 174</span></a><span class="font24"> vmware,</span><a href="#bookmark5781"><span class="font24"> 174</span></a></p></td></tr>
<tr><td rowspan="2" style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">S</span></p>
<p><span class="font24">samba, 195</span></p>
<p><span class="font24">scp(1), </span><a href="#bookmark5176"><span class="font24">53</span></a></p>
<p><span class="font24">secondary dns server,</span><a href="#bookmark5474"><span class="font24"> 128</span></a></p>
<p><span class="font24">secondary server (DNS),</span><a href="#bookmark5483"><span class="font24"> 130</span></a></p>
<p><span class="font24">security(Samba), 214</span></p>
<p><span class="font24">security mask(samba), 240</span></p>
<p><span class="font24">security mode(samba), 231</span></p>
<p><span class="font24">service(1),</span><a href="#bookmark5271"><span class="font24"> 65</span></a></p>
<p><span class="font24">service(8), 198</span></p>
<p><span class="font24">slave server (DNS),</span><a href="#bookmark5484"><span class="font24"> 130</span></a></p>
<p><span class="font24">SMB, 200</span></p>
<p><span class="font24">smbclient, 206, 215</span></p>
<p><span class="font24">smbclient(1), 205, 232</span></p>
<p><span class="font24">smbd(8), 199, 203, 226</span></p>
<p><span class="font24">smbpasswd(1), 258</span></p>
<p><span class="font24">smbpasswd(8), 226, 231</span></p>
<p><span class="font24">smbtree, 208</span></p>
<p><span class="font24">smbtree(1), 207</span></p>
<p><span class="font24">smtp,</span><a href="#bookmark5452"><span class="font24"> 124</span></a></p>
<p><span class="font24">SNAT,</span><a href="#bookmark5759"><span class="font24"> 172</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">W</span></p>
<p><span class="font24">WAN,</span><a href="#bookmark4789"><span class="font24"> 11</span></a></p>
<p><span class="font24">wbinfo(1), 247, 248</span></p>
<p><span class="font24">webalizer, 100</span></p>
<p><span class="font24">winbind(8), 247</span></p>
<p><span class="font24">winbind(samba), 245</span></p>
<p><span class="font24">winbindd(8), 199, 199, 247</span></p>
<p><span class="font24">wireshark,</span><a href="#bookmark4966"><span class="font24"> 30</span></a><span class="font24">, </span><a href="#bookmark5136"><span class="font24">48</span></a><span class="font24">,</span><a href="#bookmark5787"><span class="font24"> 175</span></a></p>
<p><span class="font24">workgroup, 214</span></p>
<p><span class="font24">WPAN,</span><a href="#bookmark4796"><span class="font24"> 11</span></a></p>
<p><span class="font24">writable (Samba), 221</span></p>
<p><span class="font24">write list (Samba), 238</span></p>
<p><span class="font7" style="font-weight:bold;">X</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">X.25,</span><a href="#bookmark4790"><span class="font24"> 11</span></a></p>
<p><span class="font24">xinetd,</span><a href="#bookmark5298"><span class="font24"> 68</span></a><span class="font24">, </span><a href="#bookmark5305"><span class="font24">68</span></a></p>
<p><span class="font24">xinetd(8), 209</span></p>
<p><span class="font7" style="font-weight:bold;">Y</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">soa (dns record),</span><a href="#bookmark5477"><span class="font24"> 128</span></a></p>
<p><span class="font24">squid, 106</span></p>
<p><span class="font24">ssh, </span><a href="#bookmark5141"><span class="font24">48</span></a></p></td><td style="vertical-align:top;">
<p><span class="font24">yum, 196</span></p>
<p><span class="font7" style="font-weight:bold;">Z</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">ssh_host_dsa_key, </span><a href="#bookmark5197"><span class="font24">55</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">zone (dns),</span><a href="#bookmark5442"><span class="font24"> 123</span></a><span class="font24">,</span><a href="#bookmark5470"><span class="font24"> 128</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">ssh_host_dsa_key.pub, </span><a href="#bookmark5197"><span class="font24">55</span></a></p>
<p><span class="font24">ssh_host_rsa_key, </span><a href="#bookmark5197"><span class="font24">55</span></a></p>
<p><span class="font24">ssh_host_rsa_key.pub, </span><a href="#bookmark5197"><span class="font24">55</span></a><span class="font24"> sshd, </span><a href="#bookmark5192"><span class="font24">55</span></a></p></td><td style="vertical-align:top;">
<p><span class="font24">zone transfer (dns),</span><a href="#bookmark5478"><span class="font24"> 128</span></a></p></td></tr>
</table>
<p><span class="font11" style="font-weight:bold;">Linux System Administration</span></p>
<p><span class="font9" style="font-weight:bold;">Paul Cobbaut</span></p>
<p><span class="font7" style="font-weight:bold;">Linux System Administration</span></p>
<p><span class="font24">Paul Cobbaut</span></p>
<p><span class="font24">Publication date 2015-05-24 CEST</span></p>
<p><span class="font4" style="font-weight:bold;">Abstract</span></p>
<p><span class="font25">This book is meant to be used in an instructor-led training. For self-study, the intent is to read this book next to a working Linux computer so you can immediately do every subject, practicing each command.</span></p>
<p><span class="font25">This book is aimed at novice Linux system administrators (and might be interesting and useful for home users that want to know a bit more about their Linux system). However, this book is not meant as an introduction to Linux desktop applications like text editors, browsers, mail clients, multimedia or office applications.</span></p>
<p><span class="font25">More information and free .pdf available at </span><a href="http://linux-training.be"><span class="font25" style="font-weight:bold;">http://linux-training.be</span></a><span class="font25" style="font-weight:bold;"> </span><span class="font25">.</span></p>
<p><span class="font25">Feel free to contact the author:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">• Paul Cobbaut: </span><a href="mailto:paul.cobbaut@gmail.com"><span class="font25">paul.cobbaut@gmail.com</span></a><span class="font25">, </span><a href="http://www.linkedin.com/in/cobbaut"><span class="font25">http://www.linkedin.com/in/cobbaut</span></a></p></li></ul>
<p><span class="font25">Contributors to the Linux Training project are:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">• Serge van Ginderachter: </span><a href="mailto:serge@ginsys.eu"><span class="font25">serge@ginsys.eu</span></a><span class="font25">, build scripts and infrastructure setup</span></p></li>
<li>
<p><span class="font25">• Ywein Van den Brande: </span><a href="mailto:ywein@crealaw.eu"><span class="font25">ywein@crealaw.eu</span></a><span class="font25">, license and legal sections</span></p></li>
<li>
<p><span class="font25">• Hendrik De Vloed: </span><a href="mailto:hendrik.devloed@ugent.be"><span class="font25">hendrik.devloed@ugent.be</span></a><span class="font25">, buildheader.pl script</span></p></li></ul>
<p><span class="font25">We'd also like to thank our reviewers:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">• Wouter Verhelst: </span><a href="mailto:wo@uter.be"><span class="font25">wo@uter.be</span></a><span class="font25">, </span><a href="http://grep.be"><span class="font25">http://grep.be</span></a></p></li>
<li>
<p><span class="font25">• Geert Goossens: </span><a href="mailto:mail.goossens.geert@gmail.com"><span class="font25">mail.goossens.geert@gmail.com</span></a><span class="font25">, </span><a href="http://www.linkedin.com/in/"><span class="font25">http://www.linkedin.com/in/</span></a><span class="font25"> geertgoossens</span></p></li>
<li>
<p><span class="font25">• Elie De Brauwer: </span><a href="mailto:elie@de-brauwer.be"><span class="font25">elie@de-brauwer.be</span></a><span class="font25">, </span><a href="http://www.de-brauwer.be"><span class="font25">http://www.de-brauwer.be</span></a></p></li>
<li>
<p><span class="font25">• Christophe Vandeplas: </span><a href="mailto:christophe@vandeplas.com"><span class="font25">christophe@vandeplas.com</span></a><span class="font25">, </span><a href="http://christophe.vandeplas.com"><span class="font25">http://christophe.vandeplas.com</span></a></p></li>
<li>
<p><span class="font25">• Bert Desmet: </span><a href="mailto:bert@devnox.be"><span class="font25">bert@devnox.be</span></a><span class="font25">, </span><a href="http://blog.bdesmet.be"><span class="font25">http://blog.bdesmet.be</span></a></p></li>
<li>
<p><span class="font25">• Rich Yonts: </span><a href="mailto:richyonts@gmail.com"><span class="font25">richyonts@gmail.com</span></a><span class="font25">,</span></p></li></ul>
<p><span class="font25">Copyright 2007-2015 Paul Cobbaut</span></p>
<p><span class="font25">Permission is granted to copy, distribute and/or modify this document under the terms of the </span><span class="font25" style="font-weight:bold;">GNU Free Documentation License</span><span class="font25">, Version 1.3 or any later version published by the Free Software Foundation; with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts. A copy of the license is included in the section entitled 'GNU Free Documentation License'.</span></p>
<h3><a name="bookmark5961"></a><span class="font9" style="font-weight:bold;"><a name="bookmark5962"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5963"><span class="font24">I. process management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5964"><span class="font24" style="font-weight:bold;">1. introduction to processes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5965"><span class="font24">1.1. terminology </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5966"><span class="font24">1.2. basic process management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5967"><span class="font24">1.3. signalling processes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5968"><span class="font24">1.4. practice : basic process management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5969"><span class="font24">1.5. solution : basic process management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5970"><span class="font24" style="font-weight:bold;">2. process priorities </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5971"><span class="font24">2.1. priority and nice values </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5972"><span class="font24">2.2. practice : process priorities </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5973"><span class="font24">2.3. solution : process priorities </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5974"><span class="font24" style="font-weight:bold;">3. background jobs </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5975"><span class="font24">3.1. background processes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5976"><span class="font24">3.2. practice : background processes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5977"><span class="font24">3.3. solution : background processes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5978"><span class="font24" style="font-weight:bold;">II. disk management </span><span class="font24">[</span><span class="font24" style="font-weight:bold;">REMOVED - CHECK SECTION - 2</span><span class="font24">]</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5979"><span class="font24" style="font-weight:bold;">4. disk devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5980"><span class="font24">4.1. terminology </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5981"><span class="font24">4.2. device naming </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5982"><span class="font24">4.3. discovering disk devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5983"><span class="font24">4.4. erasing a hard disk </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5984"><span class="font24">4.5. advanced hard disk settings </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5985"><span class="font24">4.6. practice: hard disk devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5986"><span class="font24">4.7. solution: hard disk devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5987"><span class="font24" style="font-weight:bold;">5. disk partitions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5988"><span class="font24">5.1. about partitions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5989"><span class="font24">5.2. discovering partitions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5990"><span class="font24">5.3. partitioning new disks </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5991"><span class="font24">5.4. about the partition table </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5992"><span class="font24">5.5. GUID partition table </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5993"><span class="font24">5.6. labeling with parted </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5994"><span class="font24">5.7. practice: partitions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5995"><span class="font24">5.8. solution: partitions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5996"><span class="font24" style="font-weight:bold;">6. file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5997"><span class="font24">6.1. about file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5998"><span class="font24">6.2. common file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5999"><span class="font24">6.3. putting a file system on a partition </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6000"><span class="font24">6.4. tuning a file system </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6001"><span class="font24">6.5. checking a file system </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6002"><span class="font24">6.6. practice: file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6003"><span class="font24">6.7. solution: file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6004"><span class="font24" style="font-weight:bold;">7. mounting </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6005"><span class="font24">7.1. mounting local file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6006"><span class="font24">7.2. displaying mounted file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6007"><span class="font24">7.3. from start to finish </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6008"><span class="font24">7.4. permanent mounts </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6009"><span class="font24">7.5. securing mounts </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6010"><span class="font24">7.6. mounting remote file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6011"><span class="font24">7.7. practice: mounting file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6012"><span class="font24">7.8. solution: mounting file systems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6013"><span class="font24" style="font-weight:bold;">8. troubleshooting tools </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6014"><span class="font24">8.1. lsof </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6015"><span class="font24">8.2. fuser </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6016"><span class="font24">8.3. chroot </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6017"><span class="font24">8.4. iostat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6018"><span class="font24">8.5. iotop </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6019"><span class="font24">8.6. vmstat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6020"><span class="font24">8.7. practice: troubleshooting tools </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6021"><span class="font24">8.8. solution: troubleshooting tools </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6022"><span class="font24" style="font-weight:bold;">9. introduction to uuid's </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6023"><span class="font24">9.1. about unique objects </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6024"><span class="font24">9.2. tune2fs </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6025"><span class="font24">9.3. uuid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6026"><span class="font24">9.4. uuid in /etc/fstab </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6027"><span class="font24">9.5. uuid as a boot device </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6028"><span class="font24">9.6. practice: uuid and filesystems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6029"><span class="font24">9.7. solution: uuid and filesystems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6030"><span class="font24" style="font-weight:bold;">10. introduction to raid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6031"><span class="font24">10.1. hardware or software </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6032"><span class="font24">10.2. raid levels </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6033"><span class="font24">10.3. building a software raid5 array </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6034"><span class="font24">10.4. practice: raid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6035"><span class="font24">10.5. solution: raid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6036"><span class="font24" style="font-weight:bold;">11. logical volume management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6037"><span class="font24">11.1. introduction to lvm </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6038"><span class="font24">11.2. lvm terminology </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6039"><span class="font24">11.3. example: using lvm </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6040"><span class="font24">11.4. example: extend a logical volume </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6041"><span class="font24">11.5. example: resize a physical Volume </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6042"><span class="font24">11.6. example: mirror a logical volume </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6043"><span class="font24">11.7. example: snapshot a logical volume </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6044"><span class="font24">11.8. verifying existing physical volumes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6045"><span class="font24">11.9. verifying existing volume groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6046"><span class="font24">11.10. verifying existing logical volumes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6047"><span class="font24">11.11. manage physical volumes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6048"><span class="font24">11.12. manage volume groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6049"><span class="font24">11.13. manage logical volumes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6050"><span class="font24">11.14. practice : lvm </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6051"><span class="font24">11.15. solution : lvm </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6052"><span class="font24" style="font-weight:bold;">12. iSCSI devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6053"><span class="font24">12.1. iSCSI terminology </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6054"><span class="font24">12.2. iSCSI Target in RHEL/CentOS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6055"><span class="font24">12.3. iSCSI Initiator in RHEL/CentOS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6056"><span class="font24">12.4. iSCSI target on Debian </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6057"><span class="font24">12.5. iSCSI target setup with dd files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6058"><span class="font24">12.6. ISCSI initiator on ubuntu </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6059"><span class="font24">12.7. using iSCSI devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6060"><span class="font24">12.8. iSCSI Target RHEL7/CentOS7 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6061"><span class="font24">12.9. iSCSI Initiator RHEL7/CentOS7 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6062"><span class="font24">12.10. practice: iSCSI devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6063"><span class="font24">12.11. solution: iSCSI devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6064"><span class="font24" style="font-weight:bold;">13. introduction to multipathing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6065"><span class="font24">13.1. install multipath </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6066"><span class="font24">13.2. configure multipath </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6067"><span class="font24">13.3. network </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6068"><span class="font24">13.4. start multipathd and iscsi </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6069"><span class="font24">13.5. multipath list </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6070"><span class="font24">13.6. using the device </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6071"><span class="font24">13.7. practice: multipathing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6072"><span class="font24">13.8. solution: multipathing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6073"><span class="font24">III. boot management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6074"><span class="font24" style="font-weight:bold;">14. bootloader </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6075"><span class="font24">14.1. boot terminology </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6076"><span class="font24">14.2. grub </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6077"><span class="font24">14.3. grub2 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6078"><span class="font24">14.4. lilo </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6079"><span class="font24">14.5. practice: bootloader </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6080"><span class="font24">14.6. solution: bootloader </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6081"><span class="font24" style="font-weight:bold;">15. init and runlevels </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6082"><span class="font24">15.1. system init(ialization) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6083"><span class="font24">15.2. daemon or demon ? </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6084"><span class="font24">15.3. starting and stopping daemons </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6085"><span class="font24">15.4. chkconfig </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6086"><span class="font24">15.5. update-rc.d </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6087"><span class="font24">15.6. bum </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6088"><span class="font24">15.7. runlevels </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6089"><span class="font24">15.8. systemd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6090"><span class="font24">15.9. practice: init </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6091"><span class="font24">15.10. solution : init </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6092"><span class="font24">IV. system management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6093"><span class="font24" style="font-weight:bold;">16. scheduling </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6094"><span class="font24">16.1. one time jobs with at </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6095"><span class="font24">16.2. cron </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6096"><span class="font24">16.3. practice : scheduling </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6097"><span class="font24">16.4. solution : scheduling </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6098"><span class="font24" style="font-weight:bold;">17. logging </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6099"><span class="font24">17.1. login logging </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6100"><span class="font24">17.2. syslogd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6101"><span class="font24">17.3. logger </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6102"><span class="font24">17.4. watching logs </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6103"><span class="font24">17.5. rotating logs </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6104"><span class="font24">17.6. practice : logging </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6105"><span class="font24">17.7. solution : logging </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6106"><span class="font24" style="font-weight:bold;">18. memory management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6107"><span class="font24">18.1. displaying memory and cache </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6108"><span class="font24">18.2. managing swap space </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6109"><span class="font24">18.3. monitoring memory with vmstat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6110"><span class="font24">18.4. practice : memory </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6111"><span class="font24">18.5. solution : memory </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6112"><span class="font24" style="font-weight:bold;">19. resource monitoring </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6113"><span class="font24">19.1. four basic resources </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6114"><span class="font24">19.2. top </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6115"><span class="font24">19.3. free </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6116"><span class="font24">19.4. watch </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6117"><span class="font24">19.5. vmstat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6118"><span class="font24">19.6. iostat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6119"><span class="font24">19.7. mpstat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6120"><span class="font24">19.8. sadc and sar </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6121"><span class="font24">19.9. ntop </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6122"><span class="font24">19.10. iftop </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6123"><span class="font24">19.11. iptraf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6124"><span class="font24">19.12. nmon </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6125"><span class="font24">19.13. htop </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6126"><span class="font24" style="font-weight:bold;">20. package management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6127"><span class="font24">20.1. package terminology </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6128"><span class="font24">20.2. deb package management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6129"><span class="font24">20.3. apt-get </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6130"><span class="font24">20.4. aptitude </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6131"><span class="font24">20.5. apt </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6132"><span class="font24">20.6. rpm </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6133"><span class="font24">20.7. yum </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6134"><span class="font24">20.8. alien </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6135"><span class="font24">20.9. downloading software outside the repository </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6136"><span class="font24">20.10. compiling software </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6137"><span class="font24">20.11. practice: package management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6138"><span class="font24">20.12. solution: package management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6139"><span class="font24" style="font-weight:bold;">V. network management </span><span class="font24">[</span><span class="font24" style="font-weight:bold;">REMOVED - CHECK SECTION - 3</span><span class="font24">]</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6140"><span class="font24" style="font-weight:bold;">21. general networking </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6141"><span class="font24">21.1. network layers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6142"><span class="font24">21.2. unicast, multicast, broadcast, anycast </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6143"><span class="font24">21.3. lan-wan-man </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6144"><span class="font24">21.4. internet - intranet - extranet </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6145"><span class="font24">21.5. tcp/ip </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6146"><span class="font24" style="font-weight:bold;">22. interface configuration </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6147"><span class="font24">22.1. to gui or not to gui </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6148"><span class="font24">22.2. Debian nic configuration </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6149"><span class="font24">22.3. RHEL nic configuration </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6150"><span class="font24">22.4. ifconfig </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6151"><span class="font24">22.5. ip </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6152"><span class="font24">22.6. dhclient </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6153"><span class="font24">22.7. hostname </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6154"><span class="font24">22.8. arp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6155"><span class="font24">22.9. route </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6156"><span class="font24">22.10. ping </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6157"><span class="font24">22.11. optional: ethtool </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6158"><span class="font24">22.12. practice: interface configuration </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6159"><span class="font24">22.13. solution: interface configuration </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6160"><span class="font24" style="font-weight:bold;">23. network sniffing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6161"><span class="font24">23.1. wireshark </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6162"><span class="font24">23.2. tcpdump </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6163"><span class="font24">23.3. practice: network sniffing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6164"><span class="font24">23.4. solution: network sniffing </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6165"><span class="font24" style="font-weight:bold;">24. binding and bonding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6166"><span class="font24">24.1. binding on Redhat/Fedora </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6167"><span class="font24">24.2. binding on Debian/Ubuntu </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6168"><span class="font24">24.3. bonding on Redhat/Fedora </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6169"><span class="font24">24.4. bonding on Debian/Ubuntu </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6170"><span class="font24">24.5. practice: binding and bonding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6171"><span class="font24">24.6. solution: binding and bonding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6172"><span class="font24" style="font-weight:bold;">25. ssh client and server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6173"><span class="font24">25.1. about ssh </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6174"><span class="font24">25.2. log on to a remote server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6175"><span class="font24">25.3. executing a command in remote </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6176"><span class="font24">25.4. scp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6177"><span class="font24">25.5. setting up passwordless ssh </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6178"><span class="font24">25.6. X forwarding via ssh </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6179"><span class="font24">25.7. troubleshooting ssh </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6180"><span class="font24">25.8. sshd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6181"><span class="font24">25.9. sshd keys </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6182"><span class="font24">25.10. ssh-agent </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6183"><span class="font24">25.11. practice: ssh </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6184"><span class="font24">25.12. solution: ssh </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6185"><span class="font24" style="font-weight:bold;">26. introduction to nfs </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark5314"><span class="font24">26.1. nfs protocol versions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6186"><span class="font24">26.2. rpcinfo </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6187"><span class="font24">26.3. server configuration </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6188"><span class="font24">26.4. /etc/exports </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6189"><span class="font24">26.5. exportfs </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6190"><span class="font24">26.6. client configuration </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6191"><span class="font24">26.7. practice: introduction to nfs </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6192"><span class="font24" style="font-weight:bold;">27. introduction to networking </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6193"><span class="font24">27.1. introduction to iptables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6194"><span class="font24">27.2. practice : iptables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6195"><span class="font24">27.3. solution : iptables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6196"><span class="font24">27.4. xinetd and inetd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6197"><span class="font24">27.5. practice : inetd and xinetd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6198"><span class="font24">27.6. network file system </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6199"><span class="font24">27.7. practice : network file system </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6200"><span class="font24">VI. kernel management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6201"><span class="font24" style="font-weight:bold;">28. the Linux kernel </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6202"><span class="font24">28.1. about the Linux kernel </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6203"><span class="font24">28.2. Linux kernel source </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6204"><span class="font24">28.3. kernel boot files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6205"><span class="font24">28.4. Linux kernel modules </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6206"><span class="font24">28.5. compiling a kernel </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6207"><span class="font24">28.6. compiling one module </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6208"><span class="font24" style="font-weight:bold;">29. library management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6209"><span class="font24">29.1. introduction </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6210"><span class="font24">29.2. /lib and /usr/lib </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6211"><span class="font24">29.3. ldd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6212"><span class="font24">29.4. ltrace </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6213"><span class="font24">29.5. dpkg -S and debsums </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6214"><span class="font24">29.6. rpm -qf and rpm -V </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6215"><span class="font24">29.7. tracing with strace </span></a></p></li></ul>
<p><a href="#bookmark6216"><span class="font24">VII. backup management </span></a></p>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6217"><span class="font24" style="font-weight:bold;">30. backup </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6218"><span class="font24">30.1. About tape devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6219"><span class="font24">30.2. Compression </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6220"><span class="font24">30.3. tar </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6221"><span class="font24">30.4. Backup Types </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6222"><span class="font24">30.5. dump and restore </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6223"><span class="font24">30.6. cpio </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6224"><span class="font24">30.7. dd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6225"><span class="font24">30.8. split </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6226"><span class="font24">30.9. practice: backup </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6227"><span class="font24">VIII. Appendices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6228"><span class="font24" style="font-weight:bold;">A. disk quotas </span></a></p></li></ul>
<p><a href="#bookmark6229"><span class="font24">A.1. About Disk Quotas </span></a></p>
<p><a href="#bookmark6230"><span class="font24">A.2. Practice Disk quotas </span></a></p>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6231"><span class="font24" style="font-weight:bold;">B. introduction to vnc </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6232"><span class="font24">B.1. About VNC </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6233"><span class="font24">B.2. VNC Server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6234"><span class="font24">B.3. VNC Client </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6235"><span class="font24">B.4. Practice VNC </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6236"><span class="font24" style="font-weight:bold;">C. License </span></a></p></li></ul>
<p><a href="#bookmark6237"><span class="font24">Index </span></a></p>
<h3><a name="bookmark6238"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6239"></a>List of Tables</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6240"><span class="font24">4.1. ide device naming </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6241"><span class="font24">4.2. scsi device naming </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6242"><span class="font24">5.1. primary, extended and logical partitions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6243"><span class="font24">5.2. Partition naming </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6244"><span class="font24">12.1. iSCSI Target and Initiator practice </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6245"><span class="font24">12.2. iSCSI Target and Initiator practice </span></a></p></li></ul>
<p><a href="#bookmark6246"><span class="font24">15.1. systemd power management </span></a></p>
<p><a name="bookmark6247"></a><span class="font11" style="font-weight:bold;">Part I. process management</span></p>
<h3><a name="bookmark6248"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6249"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6250"><span class="font24" style="font-weight:bold;">1. introduction to processes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6251"><span class="font24">1.1. terminology </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6252"><span class="font24">1.2. basic process management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6253"><span class="font24">1.3. signalling processes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6254"><span class="font24">1.4. practice : basic process management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6255"><span class="font24">1.5. solution : basic process management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6256"><span class="font24" style="font-weight:bold;">2. process priorities </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6257"><span class="font24">2.1. priority and nice values </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6258"><span class="font24">2.2. practice : process priorities </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6259"><span class="font24">2.3. solution : process priorities </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6260"><span class="font24" style="font-weight:bold;">3. background jobs </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6261"><span class="font24">3.1. background processes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6262"><span class="font24">3.2. practice : background processes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6263"><span class="font24">3.3. solution : background processes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a name="bookmark6264"></a><span class="font11" style="font-weight:bold;">Chapter 1. introduction to processes</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6265"></a><span class="font10" style="font-weight:bold;"><a name="bookmark5965"></a><a name="bookmark6266"></a>1.1. terminology</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark6267"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6268"></a>1.1.1. process</span></h3></li></ul></li></ul>
<p><a name="bookmark6269"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">process </span><span class="font25">is compiled source code that is currently running on the system.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6270"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6271"></a>1.1.2. PID</span></h3></li></ul>
<p><a name="bookmark6272"></a><span class="font25"><a name="bookmark6273"></a>All processes have a </span><span class="font25" style="font-weight:bold;">process id </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">PID</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6274"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6275"></a>1.1.3. PPID</span></h3></li></ul>
<p><a name="bookmark6276"></a><span class="font25">Every process has a parent process (with a </span><span class="font25" style="font-weight:bold;">PPID</span><span class="font25">). The </span><span class="font25" style="font-weight:bold;">child </span><span class="font25">process is often started by the </span><span class="font25" style="font-weight:bold;">parent </span><span class="font25">process.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6277"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6278"></a>1.1.4. init</span></h3></li></ul>
<p><a name="bookmark6279"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">process always has process ID 1. The </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">process is started by the </span><span class="font25" style="font-weight:bold;">kernel </span><span class="font25">itself so technically it does not have a parent process. </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">serves as a </span><span class="font25" style="font-weight:bold;">foster parent </span><span class="font25">for </span><span class="font25" style="font-weight:bold;">orphaned </span><span class="font25">processes.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6280"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6281"></a>1.1.5. kill</span></h3></li></ul>
<p><a name="bookmark6282"></a><span class="font25">When a process stops running, the process dies, when you want a process to die, you </span><span class="font25" style="font-weight:bold;">kill </span><span class="font25">it.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6283"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6284"></a>1.1.6. daemon</span></h3></li></ul>
<p><a name="bookmark6285"></a><span class="font25">Processes that start at system startup and keep running forever are called </span><span class="font25" style="font-weight:bold;">daemon </span><span class="font25">processes or </span><span class="font25" style="font-weight:bold;">daemons</span><span class="font25">. These </span><span class="font25" style="font-weight:bold;">daemons </span><span class="font25">never die.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6286"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6287"></a>1.1.7. zombie</span></h3></li></ul>
<p><a name="bookmark6288"></a><span class="font25">When a process is killed, but it still shows up on the system, then the process is referred to as </span><span class="font25" style="font-weight:bold;">zombie</span><span class="font25">. You cannot kill zombies, because they are already dead.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6289"></a><span class="font10" style="font-weight:bold;"><a name="bookmark5963"></a><a name="bookmark6290"></a>1.2. basic process management</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark6291"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6292"></a>1.2.1. $$ and $PPID</span></h3></li></ul></li></ul>
<p><a name="bookmark6293"></a><span class="font25"><a name="bookmark6294"></a>Some shell environment variables contain information about processes. The </span><span class="font25" style="font-weight:bold;">$$ </span><span class="font25">variable will hold your current </span><span class="font25" style="font-weight:bold;">process ID</span><span class="font25">, and </span><span class="font25" style="font-weight:bold;">$PPID </span><span class="font25">contains the </span><span class="font25" style="font-weight:bold;">parent PID</span><span class="font25">. Actually </span><span class="font25" style="font-weight:bold;">$$ </span><span class="font25">is a shell parameter and not a variable, you cannot assign a value to it.</span></p>
<p><a name="bookmark6295"></a><span class="font25">Below we use </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">to display the values of </span><span class="font25" style="font-weight:bold;">$$ </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">$PPID</span><span class="font25">.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo $$ $PPID</span></p>
<p><span class="font19">4224 4223</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6296"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6297"></a>1.2.2. pidof</span></h3></li></ul>
<p><a name="bookmark6298"></a><span class="font25">You can find all process id's by name using the </span><span class="font25" style="font-weight:bold;">pidof </span><span class="font25">command.</span></p>
<p><span class="font19">root@rhel53 ~# pidof mingetty 2819 2798 2797 2796 2795 2794</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6299"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6300"></a>1.2.3. parent and child</span></h3></li></ul>
<p><span class="font25">Processes have a </span><span class="font25" style="font-weight:bold;">parent-child </span><span class="font25">relationship. Every process has a parent process.</span></p>
<p><span class="font25">When starting a new </span><span class="font25" style="font-weight:bold;">bash </span><span class="font25">you can use </span><span class="font25" style="font-weight:bold;">echo </span><span class="font25">to verify that the </span><span class="font25" style="font-weight:bold;">pid </span><span class="font25">from before is the </span><span class="font25" style="font-weight:bold;">ppid </span><span class="font25">of the new shell. The </span><span class="font25" style="font-weight:bold;">child </span><span class="font25">process from above is now the </span><span class="font25" style="font-weight:bold;">parent </span><span class="font25">process.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ bash</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo $$ $PPID 4812 4224</span></p>
<p><span class="font25">Typing </span><span class="font25" style="font-weight:bold;">exit </span><span class="font25">will end the current process and brings us back to our original values for </span><span class="font25" style="font-weight:bold;">$$ </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">$PPID</span><span class="font25">.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo $$ $PPID 4812 4224</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ exit</span></p>
<p><span class="font19">exit</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo $$ $PPID</span></p>
<p><span class="font19">4224 4223</span></p>
<p><span class="font19">[paul@RHEL4b ~]$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6301"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6302"></a>1.2.4. fork and exec</span></h3></li></ul>
<p><a name="bookmark6303"></a><span class="font25">A process starts another process in two phases. First the<a name="bookmark6304"></a> process creates a </span><span class="font25" style="font-weight:bold;">fork </span><span class="font25">of itself, an identical copy. Then the forked process executes an </span><span class="font25" style="font-weight:bold;">exec </span><span class="font25">to replace the forked process with the target child process.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo $$ 4224</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ bash</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo $$ $PPID 5310 4224</span></p>
<p><span class="font19">[paul@RHEL4b ~]$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6305"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6306"></a>1.2.5. exec</span></h3></li></ul>
<p><span class="font25">With the </span><span class="font25" style="font-weight:bold;">exec </span><span class="font25">command, you can execute a process without forking a new process. In the following screenshot a </span><span class="font25" style="font-weight:bold;">Korn shell </span><span class="font25">(ksh) is started and is being replaced with a </span><span class="font25" style="font-weight:bold;">bash shell </span><span class="font25">using the </span><span class="font25" style="font-weight:bold;">exec </span><span class="font25">command. The </span><span class="font25" style="font-weight:bold;">pid </span><span class="font25">of the </span><span class="font25" style="font-weight:bold;">bash shell </span><span class="font25">is the same as the </span><span class="font25" style="font-weight:bold;">pid </span><span class="font25">of the </span><span class="font25" style="font-weight:bold;">Korn shell</span><span class="font25">. Exiting the child </span><span class="font25" style="font-weight:bold;">bash shell </span><span class="font25">will get me back to the parent </span><span class="font25" style="font-weight:bold;">bash</span><span class="font25">, not to the </span><span class="font25" style="font-weight:bold;">Korn shell </span><span class="font25">(which does not exist anymore).</span></p>
<div>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">[paul@RHEL4b 4224</span></p></td><td style="vertical-align:top;">
<p><span class="font19">~]$</span></p></td><td style="vertical-align:top;">
<p><span class="font19">echo</span></p></td><td style="vertical-align:top;">
<p><span class="font19">$$</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[paul@RHEL4b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~]$</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ksh</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td colspan="2" style="vertical-align:top;">
<p><span class="font19">$ echo $$ $PPID</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">5343 4224</span></p>
<p><span class="font19">$ exec bash [paul@RHEL4b</span></p>
<p><span class="font19">5343 4224</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">~]$</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">echo</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">$$ $PPID</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">[paul@RHEL4b exit</span></p></td><td style="vertical-align:top;">
<p><span class="font19">~]$</span></p></td><td style="vertical-align:top;">
<p><span class="font19">exit</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[paul@RHEL4b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~]$</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">echo</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">$$</span></p></td></tr>
</table>
<p><span class="font19">4224</span></p>
</div><br clear="all">
<div>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19"># PID of</span></p></td><td style="vertical-align:top;">
<p><span class="font19">bash</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19"># PID of</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">ksh and bash</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19"># PID of</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">bash and bash</span></p></td></tr>
</table>
</div><br clear="all">
<ul style="list-style:none;"><li>
<h3><a name="bookmark6307"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6308"></a>1.2.6. ps</span></h3></li></ul>
<h4><a name="bookmark6309"></a><span class="font25"><a name="bookmark6310"></a><a name="bookmark6311"></a>One of the most common tools on Linux to look at processes is </span><span class="font25" style="font-weight:bold;">ps</span><span class="font25">. The following screenshot shows the parent child relationship between three bash processes.</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[paul@RHEL4b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~]$ echo</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">$$ $PPID</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">4224 4223</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[paul@RHEL4b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~]$ bash</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">[paul@RHEL4b</span></p></td><td style="vertical-align:top;">
<p><span class="font19">~]$ echo</span></p></td><td style="vertical-align:top;">
<p><span class="font19">$$ $PPID</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">4866 4224</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[paul@RHEL4b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~]$ bash</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">[paul@RHEL4b</span></p></td><td style="vertical-align:top;">
<p><span class="font19">~]$ echo</span></p></td><td style="vertical-align:top;">
<p><span class="font19">$$ $PPID</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">4884 4866</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[paul@RHEL4b</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">~]$ ps fx</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">PID TTY</span></p></td><td style="vertical-align:top;">
<p><span class="font19">STAT</span></p></td><td style="vertical-align:top;">
<p><span class="font19">TIME COMMAND</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">4223 ?</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">S</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0:01 sshd: paul@pts/0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">4224 pts/0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Ss</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0:00 \_ -bash</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">4866 pts/0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">S</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0:00 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\_ bash</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">4884 pts/0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">S</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0:00 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\_ bash</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">4902 pts/0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">R+</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0:00 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\_ ps fx</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[paul@RHEL4b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~]$ exit</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">exit</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[paul@RHEL4b</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">~]$ ps fx</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">PID TTY</span></p></td><td style="vertical-align:top;">
<p><span class="font19">STAT</span></p></td><td style="vertical-align:top;">
<p><span class="font19">TIME COMMAND</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">4223 ?</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">S</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0:01 sshd: paul@pts/0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">4224 pts/0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Ss</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0:00 \_ -bash</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">4866 pts/0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">S</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0:00 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\_ bash</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">4903 pts/0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">R+</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0:00 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\_ ps fx</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[paul@RHEL4b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~]$ exit</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">exit</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[paul@RHEL4b</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">~]$ ps fx</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">PID TTY</span></p></td><td style="vertical-align:top;">
<p><span class="font19">STAT</span></p></td><td style="vertical-align:top;">
<p><span class="font19">TIME COMMAND</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">4223 ?</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">S</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0:01 sshd: paul@pts/0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">4224 pts/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Ss</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00 \_ -bash</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">4904 pts/0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">R+</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0:00 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\_ ps fx</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">[paul@RHEL4b</span></p></td><td style="vertical-align:top;">
<p><span class="font19">~]$</span></p></td><td style="vertical-align:top;"></td></tr>
</table>
<h4><a name="bookmark6312"></a><span class="font25"><a name="bookmark6313"></a><a name="bookmark6314"></a><a name="bookmark6315"></a>On Linux, </span><span class="font25" style="font-weight:bold;">ps fax </span><span class="font25">is often used. On Solaris </span><span class="font25" style="font-weight:bold;">ps -ef </span><span class="font25">(which also works on Linux) is common.</span><br><br><span class="font25"><a name="bookmark6316"></a>Here is a partial output from </span><span class="font25" style="font-weight:bold;">ps fax</span><span class="font25">.</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[paul@RHEL4a</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~]$ ps</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">fax</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">PID TTY</span></p></td><td style="vertical-align:top;">
<p><span class="font19">STAT</span></p></td><td style="vertical-align:top;">
<p><span class="font19">TIME</span></p></td><td style="vertical-align:top;">
<p><span class="font19">COMMAND</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">1 ? &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td colspan="2" style="vertical-align:top;">
<p><span class="font19">:00 init [5]</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">...</span></p>
<p><span class="font19">3713 ?</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Ss</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/usr/sbin/sshd</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">5042 ?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Ss</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">\_ sshd: paul [priv]</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">5044 ?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">S</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">\_ sshd: paul@pts/1</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">5045 pts/1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Ss</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">\_ -bash</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">5077 pts/1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">R+</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">\_ ps fax</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1566"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6317"></a>1.2.7. pgrep</span></h3></li></ul>
<p><a name="bookmark6318"></a><span class="font25">Similar to the </span><span class="font25" style="font-weight:bold;">ps -C</span><span class="font25">, you can also use </span><span class="font25" style="font-weight:bold;">pgrep </span><span class="font25">to search for a process by its command name.</span></p>
<p><span class="font19">[paul@RHEL5 ~]$ sleep 1000 &amp;</span></p>
<p><span class="font19">[1] 32558</span></p>
<p><span class="font19">[paul@RHEL5 ~]$ pgrep sleep</span></p>
<p><span class="font19">32558</span></p>
<p><span class="font19">[paul@RHEL5 ~]$ ps -C sleep</span></p>
<p><span class="font19">PID TTY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TIME CMD</span></p>
<p><span class="font19">32558 pts/3 &nbsp;&nbsp;&nbsp;00:00:00 sleep</span></p>
<p><span class="font25">You can also list the command name of the process with pgrep.</span></p>
<p><span class="font19">paul@laika:~$ pgrep -l sleep 9661 sleep</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6319"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6320"></a>1.2.8. top</span></h3></li></ul>
<p><a name="bookmark6321"></a><span class="font25">Another popular tool on Linux is </span><span class="font25" style="font-weight:bold;">top</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">top </span><span class="font25">tool can order processes according to </span><span class="font25" style="font-weight:bold;">cpu usage </span><span class="font25">or other properties. You can also </span><span class="font25" style="font-weight:bold;">kill </span><span class="font25">processes from within top. Press </span><span class="font25" style="font-weight:bold;">h </span><span class="font25">inside </span><span class="font25" style="font-weight:bold;">top </span><span class="font25">for help.</span></p>
<p><span class="font25">In case of trouble, top is often the first tool to fire up, since it also provides you memory and swap space information.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6322"></a><span class="font10" style="font-weight:bold;"><a name="bookmark5967"></a><a name="bookmark6323"></a>1.3. signalling processes</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark6324"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6325"></a>1.3.1. kill</span></h3></li></ul></li></ul>
<p><a name="bookmark6326"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">kill </span><span class="font25">command will kill (or stop) a process. The screenshot shows how to use a standard </span><span class="font25" style="font-weight:bold;">kill </span><span class="font25">to stop the process with </span><span class="font25" style="font-weight:bold;">pid </span><span class="font25">1942.</span></p>
<p><span class="font19">paul@ubuntu910:~$ kill 1942 paul@ubuntu910:~$</span></p>
<p><span class="font25">By using the </span><span class="font25" style="font-weight:bold;">kill </span><span class="font25">we are sending a </span><span class="font25" style="font-weight:bold;">signal </span><span class="font25">to the process.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6327"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6328"></a>1.3.2. list signals</span></h3></li></ul>
<p><a name="bookmark6329"></a><span class="font25">Running processes can receive signals from each other or from the users. You can have a list of signals by typing </span><span class="font25" style="font-weight:bold;">kill -l</span><span class="font25">, that is a letter </span><span class="font25" style="font-weight:bold;">l</span><span class="font25">, not the number 1.</span></p>
<p><span class="font19">[paul@RHEL4a ~]$ kill -l</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGHUP</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGINT</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGQUIT</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGILL</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">5)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGTRAP</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGABRT</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGBUS</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">8)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGFPE</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">9)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGKILL</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGUSR1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">11)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGSEGV</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">12)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGUSR2</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">13)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGPIPE</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGALRM</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGTERM</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">17)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGCHLD</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">18)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGCONT</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">19)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGSTOP</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">20)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGTSTP</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">21)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGTTIN</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">22)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGTTOU</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">23)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGURG</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">24)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGXCPU</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">25)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGXFSZ</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">26)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGVTALRM</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">27)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGPROF</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">28)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGWINCH</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">29)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGIO</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">30)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGPWR</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">31)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGSYS</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">34)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMIN</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">35)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMIN+1</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">36)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMIN+2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">37)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMIN+3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">38)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMIN+4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">39)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMIN+5</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">40)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMIN+6</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">41)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMIN+7</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">42)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMIN+8</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">43)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMIN+9</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">44)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMIN+10</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">45)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMIN+11</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">46)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMIN+12</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">47)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMIN+13</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">48)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMIN+14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">49)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMIN+15</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">50)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMAX-14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">51)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMAX-13</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">52)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMAX-12</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">53)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMAX-11</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">54)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMAX-10</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">55)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMAX-9</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">56)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMAX-8</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">57)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMAX-7</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">58)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMAX-6</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">59)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SIGRTMAX-5</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">60)</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SIGRTMAX-4</span></p></td><td style="vertical-align:top;">
<p><span class="font19">61)</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SIGRTMAX-3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">62)</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SIGRTMAX-2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">63)</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SIGRTMAX-1</span></p></td></tr>
</table>
<p><span class="font19">64) SIGRTMAX [paul@RHEL4a ~]$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6330"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6331"></a>1.3.3. kill -1 (SIGHUP)</span></h3></li></ul>
<p><a name="bookmark6332"></a><span class="font25">It is common on Linux to use the first signal </span><span class="font25" style="font-weight:bold;">SIGHUP </span><span class="font25">(or HUP or 1) to tell a process that it should re-read its configuration file. Thus, the </span><span class="font25" style="font-weight:bold;">kill -1 1 </span><span class="font25">command forces the </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">process (</span><span class="font25" style="font-weight:bold;">init </span><span class="font25">always runs with </span><span class="font25" style="font-weight:bold;">pid 1</span><span class="font25">) to re-read its configuration file.</span></p>
<p><span class="font19">root@deb503:~# kill -1 1 root@deb503:~#</span></p>
<p><span class="font25">It is up to the developer of the process to decide whether the process can do this running, or whether it needs to stop and start. It is up to the user to read the documentation of the program.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6333"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6334"></a>1.3.4. kill -15 (SIGTERM)</span></h3></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">SIGTERM </span><span class="font25">signal is also called a </span><span class="font25" style="font-weight:bold;">standard kill</span><span class="font25">. Whenever </span><span class="font25" style="font-weight:bold;">kill </span><span class="font25">is executed without specifying the signal, a </span><span class="font25" style="font-weight:bold;">kill -15 </span><span class="font25">is assumed.</span></p>
<p><span class="font25">Both commands in the screenshot below are identical.</span></p>
<p><span class="font19">paul@ubuntu910:~$ kill 1942 paul@ubuntu910:~$ kill -15 1942</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6335"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6336"></a>1.3.5. kill -9 (SIGKILL)</span></h3></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">SIGKILL </span><span class="font25">is different from most other signals in that it is not being sent to the process, but to the </span><span class="font25" style="font-weight:bold;">Linux kernel</span><span class="font25">. A </span><span class="font25" style="font-weight:bold;">kill -9 </span><span class="font25">is also called a </span><span class="font25" style="font-weight:bold;">sure kill</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">kernel </span><span class="font25">will shoot down the process. As a developer you have no means to intercept a </span><span class="font25" style="font-weight:bold;">kill -9 </span><span class="font25">signal.</span></p>
<p><span class="font19">root@rhel53 ~# kill -9 3342</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6337"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6338"></a>1.3.6. SIGSTOP and SIGCONT</span></h3></li></ul>
<p><span class="font25">A running process can be </span><span class="font25" style="font-weight:bold;">suspended </span><span class="font25">when it receives a </span><span class="font25" style="font-weight:bold;">SIGSTOP </span><span class="font25">signal. This is the same as </span><span class="font25" style="font-weight:bold;">kill -19 </span><span class="font25">on Linux, but might have a different number in other Unix systems.</span></p>
<p><span class="font25">A </span><span class="font25" style="font-weight:bold;">suspended </span><span class="font25">process does not use any </span><span class="font25" style="font-weight:bold;">cpu cycles</span><span class="font25">, but it stays in memory and can be reanimated with a </span><span class="font25" style="font-weight:bold;">SIGCONT </span><span class="font25">signal (</span><span class="font25" style="font-weight:bold;">kill -18 </span><span class="font25">on Linux).</span></p>
<p><span class="font25">Both signals will be used in the section about </span><span class="font25" style="font-weight:bold;">background </span><span class="font25">processes.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6339"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6340"></a>1.3.7. pkill</span></h3></li></ul>
<h4><a name="bookmark6341"></a><span class="font25"><a name="bookmark6342"></a><a name="bookmark6343"></a>You can use the </span><span class="font25" style="font-weight:bold;">pkill </span><span class="font25">command to kill a process by its command name.</span></h4>
<p><span class="font19">[paul@RHEL5 ~]$ sleep 1000 &amp;</span></p>
<p><span class="font19">[1] 30203</span></p>
<p><span class="font19">[paul@RHEL5 ~]$ pkill sleep</span></p>
<p><span class="font19">[1]+ Terminated &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep 1000</span></p>
<p><span class="font19">[paul@RHEL5 ~]$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6344"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6345"></a>1.3.8. killall</span></h3></li></ul>
<h4><a name="bookmark6346"></a><span class="font25"><a name="bookmark6347"></a><a name="bookmark6348"></a><a name="bookmark6349"></a>The </span><span class="font25" style="font-weight:bold;">killall </span><span class="font25">command will send a </span><span class="font25" style="font-weight:bold;">signal 15 </span><span class="font25">to all processes with a certain name.</span></h4>
<p><span class="font19">paul@rhel65:~$ sleep 8472 &amp;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">[1] 18780</span></p></li></ul>
<p><span class="font19">paul@rhel65:~$ sleep 1201 &amp;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">[2] 18781</span></p></li></ul>
<p><span class="font19">paul@rhel65:~$ jobs</span></p>
<p><a href="#bookmark6350"><span class="font19">[1]- &nbsp;Running &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep 8472</span></a></p>
<p><a href="#bookmark6351"><span class="font19">[2]+ &nbsp;Running &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep 1201</span></a></p>
<p><span class="font19">paul@rhel65:~$ killall sleep</span></p>
<p><a href="#bookmark6352"><span class="font19">[1]- &nbsp;Terminated &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep</span></a></p>
<p><a href="#bookmark6353"><span class="font19">[2]+ &nbsp;Terminated &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep</span></a></p>
<p><span class="font19">paul@rhel65:~$ jobs</span></p>
<p><span class="font19">paul@rhel65:~$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6354"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6355"></a>1.3.9. killall5</span></h3></li></ul>
<h4><a name="bookmark6356"></a><span class="font25"><a name="bookmark6357"></a>Its SysV counterpart </span><span class="font25" style="font-weight:bold;">killall5 </span><span class="font25">can by used when shutting down the system. This screenshot shows how Red Hat Enterprise Linux 5.3 uses </span><span class="font25" style="font-weight:bold;">killall5 </span><span class="font25">when halting the system.</span></h4>
<p><span class="font19">root@rhel53 ~# grep killall /etc/init.d/halt</span></p>
<p><span class="font19">action $&quot;Sending all processes the TERM signal...&quot; /sbin/killall5 -15</span></p>
<p><span class="font19">action $&quot;Sending all processes the KILL signal...&quot; /sbin/killall5 -9</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6358"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6359"></a>1.3.10. top</span></h3></li></ul>
<h4><a name="bookmark6360"></a><span class="font25"><a name="bookmark6361"></a><a name="bookmark6362"></a>Inside </span><span class="font25" style="font-weight:bold;">top </span><span class="font25">the </span><span class="font25" style="font-weight:bold;">k </span><span class="font25">key allows you to select a </span><span class="font25" style="font-weight:bold;">signal </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">pid </span><span class="font25">to kill. Below is a partial screenshot of the line just below the summary in </span><span class="font25" style="font-weight:bold;">top </span><span class="font25">after pressing </span><span class="font25" style="font-weight:bold;">k</span><span class="font25">.</span></h4>
<p><span class="font19">PID to kill: 1932</span></p>
<p><span class="font19">Kill PID 1932 with signal [15]: 9</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6363"></a><span class="font10" style="font-weight:bold;"><a name="bookmark5966"></a><a name="bookmark6364"></a>1.4. practice : basic process management</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Use </span><span class="font25" style="font-weight:bold;">ps </span><span class="font25">to search for the </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">process by name.</span></p></li>
<li>
<p><span class="font25">2. What is the </span><span class="font25" style="font-weight:bold;">process id </span><span class="font25">of the </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">process ?</span></p></li>
<li>
<p><span class="font25">3. Use the </span><span class="font25" style="font-weight:bold;">who am i </span><span class="font25">command to determine your terminal name.</span></p></li>
<li>
<p><span class="font25">4. Using your terminal name from above, use </span><span class="font25" style="font-weight:bold;">ps </span><span class="font25">to find all processes associated with your terminal.</span></p></li>
<li>
<p><span class="font25">5. What is the </span><span class="font25" style="font-weight:bold;">process id </span><span class="font25">of your shell ?</span></p></li>
<li>
<p><span class="font25">6. What is the </span><span class="font25" style="font-weight:bold;">parent process id </span><span class="font25">of your shell ?</span></p></li>
<li>
<p><span class="font25">7. Start two instances of the </span><span class="font25" style="font-weight:bold;">sleep 3342 </span><span class="font25">in background.</span></p></li>
<li>
<p><span class="font25">8. Locate the </span><span class="font25" style="font-weight:bold;">process id </span><span class="font25">of all </span><span class="font25" style="font-weight:bold;">sleep </span><span class="font25">commands.</span></p></li>
<li>
<p><span class="font25">9. Display only those two </span><span class="font25" style="font-weight:bold;">sleep </span><span class="font25">processes in </span><span class="font25" style="font-weight:bold;">top</span><span class="font25">. Then quit top.</span></p></li>
<li>
<p><span class="font25">10. Use a </span><span class="font25" style="font-weight:bold;">standard kill </span><span class="font25">to kill one of the </span><span class="font25" style="font-weight:bold;">sleep </span><span class="font25">processes.</span></p></li>
<li>
<p><span class="font25">11. Use one command to kill all </span><span class="font25" style="font-weight:bold;">sleep </span><span class="font25">processes.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6365"></a><span class="font10" style="font-weight:bold;"><a name="bookmark5968"></a><a name="bookmark6366"></a>1.5. solution : basic process management</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark6367"></a><span class="font25"><a name="bookmark6368"></a>1. Use </span><span class="font25" style="font-weight:bold;">ps </span><span class="font25">to search for the </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">process by name.</span></h4></li></ul>
<p><span class="font19">root@rhel53 ~# ps -C init PID TTY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TIME CMD</span></p>
<p><span class="font19">1 ? &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;00:00:04 init</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark6369"></a><span class="font25"><a name="bookmark6370"></a>2. What is the </span><span class="font25" style="font-weight:bold;">process id </span><span class="font25">of the </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">process</span></h4></li>
<li>
<h4><a name="bookmark6371"></a><span class="font25"><a name="bookmark6372"></a>3. Use the </span><span class="font25" style="font-weight:bold;">who am i </span><span class="font25">command to determine your terminal name.</span></h4></li></ul>
<p><span class="font19">root@rhel53 ~# who am i</span></p>
<p><span class="font19">paul pts/0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2010-04-12 17:44 (192.168.1.38)</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark6373"></a><span class="font25"><a name="bookmark6374"></a>4. Using your terminal name from above, use </span><span class="font25" style="font-weight:bold;">ps </span><span class="font25">to find all processes associated with your terminal.</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">oot@rhel53 ~#</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ps fax</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">| grep</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pts/0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2941 ?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">S</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">\_ sshd: paul@pts/0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2942 pts/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Ss</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">\_ -bash</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2972 pts/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">S</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">\_ su -</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2973 pts/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">S</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">\_ -bash</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">3808 pts/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">R+</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">\_ ps fax</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">3809 pts/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">R+</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">\_ grep pts/0</span></p></td></tr>
</table></li></ul>
<h4><a name="bookmark6375"></a><span class="font25"><a name="bookmark6376"></a>or also</span></h4>
<table border="1">
<tr><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">root@rhel53 ~#</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ps -ef</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">grep ;</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pts/0</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2941</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2939</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">17:44</span></p></td><td style="vertical-align:top;">
<p><span class="font19">?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sshd: paul@pts/0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2942</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2941</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">17:44</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-bash</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2972</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2942</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">17:45</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">su -</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2973</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2972</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">17:45</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-bash</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3816</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2973</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">21:25</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ps -ef</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3817</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2973</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">21:25</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">grep pts/0</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h4><a name="bookmark6377"></a><span class="font25"><a name="bookmark6378"></a>5. What is the </span><span class="font25" style="font-weight:bold;">process id </span><span class="font25">of your shell ?</span></h4></li></ul>
<p><span class="font19">2973 in the screenshot above, probably different for you</span></p>
<h4><a name="bookmark6379"></a><span class="font25" style="font-weight:bold;"><a name="bookmark6380"></a>echo $$ </span><span class="font25">should display same number as the one you found</span><br><br><span class="font25"><a name="bookmark6381"></a>6. What is the </span><span class="font25" style="font-weight:bold;">parent process id </span><span class="font25">of your shell ?</span></h4>
<p><span class="font19">2972 in the screenshot above, probably different for you</span></p>
<h4><a name="bookmark6382"></a><span class="font25"><a name="bookmark6383"></a>in this example the PPID is from the </span><span class="font25" style="font-weight:bold;">su - </span><span class="font25">command, but when inside gnome then for example gnome-terminal can be the parent process</span></h4>
<ul style="list-style:none;"><li>
<h4><a name="bookmark6384"></a><span class="font25"><a name="bookmark6385"></a>7. Start two instances of the </span><span class="font25" style="font-weight:bold;">sleep 3342 </span><span class="font25">in background.</span></h4></li></ul>
<p><span class="font19">sleep 3342 &amp;</span></p>
<p><span class="font19">sleep 3342 &amp;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. Locate the </span><span class="font25" style="font-weight:bold;">process id </span><span class="font25">of all </span><span class="font25" style="font-weight:bold;">sleep </span><span class="font25">commands.</span></p></li></ul>
<p><span class="font19">pidof sleep</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">9. Display only those two </span><span class="font25" style="font-weight:bold;">sleep </span><span class="font25">processes in </span><span class="font25" style="font-weight:bold;">top</span><span class="font25">. Then quit top.</span></p></li></ul>
<p><span class="font19">top -p pidx,pidy (replace pidx pidy with the actual numbers)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">10. Use a </span><span class="font25" style="font-weight:bold;">standard kill </span><span class="font25">to kill one of the </span><span class="font25" style="font-weight:bold;">sleep </span><span class="font25">processes.</span></p></li></ul>
<p><span class="font19">kill pidx</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">11. Use one command to kill all </span><span class="font25" style="font-weight:bold;">sleep </span><span class="font25">processes.</span></p></li></ul>
<p><span class="font19">pkill sleep</span></p>
<ul style="list-style:none;"><li>
<p><a name="bookmark6386"></a><span class="font11" style="font-weight:bold;">Chapter 2. process priorities</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6387"></a><span class="font10" style="font-weight:bold;"><a name="bookmark5971"></a><a name="bookmark6388"></a>2.1. priority and nice values</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark3281"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6389"></a>2.1.1. introduction</span></h3></li></ul></li></ul>
<p><a name="bookmark6390"></a><span class="font25"><a name="bookmark6391"></a>All processes have a </span><span class="font25" style="font-weight:bold;">priority </span><span class="font25">and a </span><span class="font25" style="font-weight:bold;">nice </span><span class="font25">value. Higher priority processes will get more </span><span class="font25" style="font-weight:bold;">cpu time </span><span class="font25">than lower priority processes. You can influence this with the </span><span class="font25" style="font-weight:bold;">nice </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">renice </span><span class="font25">commands.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6392"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6393"></a>2.1.2. pipes (mkfifo)</span></h3></li></ul>
<p><a name="bookmark6394"></a><span class="font25"><a name="bookmark6395"></a>Processes can communicate with each other via </span><span class="font25" style="font-weight:bold;">pipes</span><span class="font25">. These </span><span class="font25" style="font-weight:bold;">pipes </span><span class="font25">can be created with the </span><span class="font25" style="font-weight:bold;">mkfifo </span><span class="font25">command.</span></p>
<p><span class="font25">The screenshots shows the creation of four distinct pipes (in a new directory).</span></p>
<p><span class="font19">paul@ubuntu910:~$ mkdir procs</span></p>
<p><span class="font19">paul@ubuntu910:~$ cd procs/</span></p>
<p><span class="font19">paul@ubuntu910:~/procs$ mkfifo pipe33a pipe33b pipe42a pipe42b</span></p>
<p><span class="font19">paul@ubuntu910:~/procs$ ls -l</span></p>
<p><span class="font19">total 0</span></p>
<p><span class="font19">prw-r--r-- 1 paul paul 0 2010-04-12 13:21 pipe33a</span></p>
<p><span class="font19">prw-r--r-- 1 paul paul 0 2010-04-12 13:21 pipe33b</span></p>
<p><span class="font19">prw-r--r-- 1 paul paul 0 2010-04-12 13:21 pipe42a</span></p>
<p><span class="font19">prw-r--r-- 1 paul paul 0 2010-04-12 13:21 pipe42b</span></p>
<p><span class="font19">paul@ubuntu910:~/procs$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6396"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6397"></a>2.1.3. some fun with cat</span></h3></li></ul>
<p><span class="font25">To demonstrate the use of the </span><span class="font25" style="font-weight:bold;">top </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">renice </span><span class="font25">commands we will make the </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">command use the previously created </span><span class="font25" style="font-weight:bold;">pipes </span><span class="font25">to generate a full load on the </span><span class="font25" style="font-weight:bold;">cpu</span><span class="font25">.</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">is copied with a distinct name to the current directory. (This enables us to easily recognize the processes within </span><span class="font25" style="font-weight:bold;">top</span><span class="font25">. You could do the same exercise without copying the cat command, but using different users. Or you could just look at the </span><span class="font25" style="font-weight:bold;">pid </span><span class="font25">of each process.)</span></p>
<p><span class="font19">paul@ubuntu910:~/procs$ cp /bin/cat proj33</span></p>
<p><span class="font19">paul@ubuntu910:~/procs$ cp /bin/cat proj42</span></p>
<p><span class="font19">paul@ubuntu910:~/procs$ echo -n x | ./proj33 - pipe33a &gt;&nbsp;pipe33b &amp;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">[1] 1670</span></p></li></ul>
<p><span class="font19">paul@ubuntu910:~/procs$ ./proj33 &lt;pipe33b &gt;pipe33a &amp;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">[2] 1671</span></p></li></ul>
<p><span class="font19">paul@ubuntu910:~/procs$ echo -n z | ./proj42 - pipe42a &gt;&nbsp;pipe42b &amp;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">[3] 1673</span></p></li></ul>
<p><span class="font19">paul@ubuntu910:~/procs$ ./proj42 &lt;pipe42b &gt;pipe42a &amp;&nbsp;[4] 1674</span></p>
<p><span class="font25">The commands you see above will create two </span><span class="font25" style="font-weight:bold;">proj33 </span><span class="font25">processes that use </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">to bounce the x character between </span><span class="font25" style="font-weight:bold;">pipe33a </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">pipe33b</span><span class="font25">. And ditto for the z character and </span><span class="font25" style="font-weight:bold;">proj42</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6398"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6399"></a>2.1.4. top</span></h3></li></ul>
<p><span class="font25">Just running </span><span class="font25" style="font-weight:bold;">top </span><span class="font25">without options or arguments will display all processes and an overview of innformation. The top of the </span><span class="font25" style="font-weight:bold;">top </span><span class="font25">screen might look something like this.</span></p>
<p><span class="font19">top - 13:59:29 up 48 min, 4 users, load average: 1.06, 0.25, 0.14 Tasks: 139 total, 3 running, 136 sleeping, 0 stopped, 0 zombie</span></p>
<p><span class="font19">Cpu(s): 0.3%us, 99.7%sy, 0.0%ni, 0.0%id, 0.0%wa, 0.0%hi, 0.0%si, 0.0%st</span></p>
<p><span class="font19">Mem: &nbsp;&nbsp;&nbsp;509352k total, &nbsp;&nbsp;460040k used, &nbsp;&nbsp;&nbsp;49312k free, &nbsp;&nbsp;&nbsp;66752k buffers</span></p>
<p><span class="font19">Swap: &nbsp;&nbsp;746980k total, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0k used, &nbsp;&nbsp;746980k free, &nbsp;&nbsp;247324k cached</span></p>
<p><span class="font25">Notice the </span><span class="font25" style="font-weight:bold;">cpu idle time (0.0%id) </span><span class="font25">is zero. This is because our </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">processes are consuming the whole </span><span class="font25" style="font-weight:bold;">cpu</span><span class="font25">. Results can vary on systems with four or more </span><span class="font25" style="font-weight:bold;">cpu cores</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6400"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6401"></a>2.1.5. top -p</span></h3></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">top -p 1670,1671,1673,1674 </span><span class="font25">screenshot below shows four processes, all of then using approximately 25 percent of the </span><span class="font25" style="font-weight:bold;">cpu</span><span class="font25">.</span></p>
<p><span class="font19">paul@ubuntu910:~$ top -p 1670,1671,1673,1674</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">PID</span></p></td><td style="vertical-align:top;">
<p><span class="font19">USER</span></p></td><td style="vertical-align:top;">
<p><span class="font19">PR</span></p></td><td style="vertical-align:top;">
<p><span class="font19">NI</span></p></td><td style="vertical-align:top;">
<p><span class="font19">VIRT</span></p></td><td style="vertical-align:top;">
<p><span class="font19">RES</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SHR</span></p></td><td style="vertical-align:top;">
<p><span class="font19">S</span></p></td><td style="vertical-align:top;">
<p><span class="font19">%CPU</span></p></td><td style="vertical-align:top;">
<p><span class="font19">%MEM</span></p></td><td style="vertical-align:top;">
<p><span class="font19">TIME+</span></p></td><td style="vertical-align:top;">
<p><span class="font19">COMMAND</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1674</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">20</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2972</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">616</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">524</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">S</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">26.6</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0:11.92</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">proj42</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1670</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">20</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2972</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">616</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">524</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">R</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">25.0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0:23.16</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">proj33</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1671</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">20</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2972</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">616</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">524</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">S</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">24.6</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0:23.07</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">proj33</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">1673</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">20</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2972</span></p></td><td style="vertical-align:top;">
<p><span class="font19">620</span></p></td><td style="vertical-align:top;">
<p><span class="font19">524</span></p></td><td style="vertical-align:top;">
<p><span class="font19">R</span></p></td><td style="vertical-align:top;">
<p><span class="font19">23.0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:11.48</span></p></td><td style="vertical-align:top;">
<p><span class="font19">proj42</span></p></td></tr>
</table>
<p><span class="font25">All four processes have an equal </span><span class="font25" style="font-weight:bold;">priority (PR)</span><span class="font25">, and are battling for </span><span class="font25" style="font-weight:bold;">cpu time</span><span class="font25">. On some systems the </span><span class="font25" style="font-weight:bold;">Linux kernel </span><span class="font25">might attribute slightly varying </span><span class="font25" style="font-weight:bold;">priority values</span><span class="font25">, but the result will still be four processes fighting for </span><span class="font25" style="font-weight:bold;">cpu time</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6402"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6403"></a>2.1.6. renice</span></h3></li></ul>
<p><a name="bookmark6404"></a><span class="font25">Since the processes are already running, we need to use the </span><span class="font25" style="font-weight:bold;">renice </span><span class="font25">command to change their </span><span class="font25" style="font-weight:bold;">nice value (NI)</span><span class="font25">.</span></p>
<p><span class="font25">The screenshot shows how to use </span><span class="font25" style="font-weight:bold;">renice </span><span class="font25">on both the </span><span class="font25" style="font-weight:bold;">proj33 </span><span class="font25">processes.</span></p>
<p><span class="font19">paul@ubuntu910:~$ renice +8 1670</span></p>
<p><span class="font19">1670: old priority 0, new priority 8</span></p>
<p><span class="font19">paul@ubuntu910:~$ renice +8 1671</span></p>
<p><span class="font19">1671: old priority 0, new priority 8</span></p>
<p><span class="font25">Normal users can attribute a </span><span class="font25" style="font-weight:bold;">nice value </span><span class="font25">from zero to 20 to processes they own. Only the </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">user can use negative nice values. Be very careful with negative nice values, since they can make it impossible to use the keyboard or ssh to a system.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6405"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6406"></a>2.1.7. impact of nice values</span></h3></li></ul>
<p><span class="font25">The impact of a nice value on running processes can vary. The screenshot below shows the result of our </span><span class="font25" style="font-weight:bold;">renice +8 </span><span class="font25">command. Look at the </span><span class="font25" style="font-weight:bold;">%CPU </span><span class="font25">values.</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">PID</span></p></td><td style="vertical-align:top;">
<p><span class="font19">USER</span></p></td><td style="vertical-align:top;">
<p><span class="font19">PR</span></p></td><td style="vertical-align:top;">
<p><span class="font19">NI</span></p></td><td style="vertical-align:top;">
<p><span class="font19">VIRT</span></p></td><td style="vertical-align:top;">
<p><span class="font19">RES</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SHR</span></p></td><td style="vertical-align:top;">
<p><span class="font19">S</span></p></td><td style="vertical-align:top;">
<p><span class="font19">%CPU</span></p></td><td style="vertical-align:top;">
<p><span class="font19">%MEM</span></p></td><td style="vertical-align:top;">
<p><span class="font19">TIME+</span></p></td><td style="vertical-align:top;">
<p><span class="font19">COMMAND</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1674</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">20</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2972</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">616</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">524</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">S</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">46.6</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0:22.37</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">proj42</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">1673</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">20</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2972</span></p></td><td style="vertical-align:top;">
<p><span class="font19">620</span></p></td><td style="vertical-align:top;">
<p><span class="font19">524</span></p></td><td style="vertical-align:top;">
<p><span class="font19">R</span></p></td><td style="vertical-align:top;">
<p><span class="font19">42.6</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:21.65</span></p></td><td style="vertical-align:top;">
<p><span class="font19">proj42</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">1671</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">28</span></p></td><td style="vertical-align:top;">
<p><span class="font19">8</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2972</span></p></td><td style="vertical-align:top;">
<p><span class="font19">616</span></p></td><td style="vertical-align:top;">
<p><span class="font19">524</span></p></td><td style="vertical-align:top;">
<p><span class="font19">S</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5.7</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:29.65</span></p></td><td style="vertical-align:top;">
<p><span class="font19">proj33</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">1670</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">28</span></p></td><td style="vertical-align:top;">
<p><span class="font19">8</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2972</span></p></td><td style="vertical-align:top;">
<p><span class="font19">616</span></p></td><td style="vertical-align:top;">
<p><span class="font19">524</span></p></td><td style="vertical-align:top;">
<p><span class="font19">R</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4.7</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:29.82</span></p></td><td style="vertical-align:top;">
<p><span class="font19">proj33</span></p></td></tr>
</table>
<p><span class="font25">Important to remember is to always make less important processes nice to more important processes. Using </span><span class="font25" style="font-weight:bold;">negative nice values </span><span class="font25">can have a severe impact on a system's usability.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6407"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6408"></a>2.1.8. nice</span></h3></li></ul>
<p><a name="bookmark6409"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">nice </span><span class="font25">works identical to the </span><span class="font25" style="font-weight:bold;">renice </span><span class="font25">but it is used when starting a command.</span></p>
<p><span class="font25">The screenshot shows how to start a script with a </span><span class="font25" style="font-weight:bold;">nice </span><span class="font25">value of five.</span></p>
<p><span class="font19">paul@ubuntu910:~$ nice -5 ./backup.sh</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6410"></a><span class="font10" style="font-weight:bold;"><a name="bookmark5972"></a><a name="bookmark6411"></a>2.2. practice : process priorities</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create a new directory and create six </span><span class="font25" style="font-weight:bold;">pipes </span><span class="font25">in that directory.</span></p></li>
<li>
<p><span class="font25">2. Bounce a character between two </span><span class="font25" style="font-weight:bold;">pipes</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">3. Use </span><span class="font25" style="font-weight:bold;">top </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">ps </span><span class="font25">to display information (pid, ppid, priority, nice value, ...) about these two cat processes.</span></p></li>
<li>
<p><span class="font25">4. Bounce another character between two other pipes, but this time start the commands </span><span class="font25" style="font-weight:bold;">nice</span><span class="font25">. Verify that all </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">processes are battling for the cpu. (Feel free to fire up two more cats with the remaining pipes).</span></p></li>
<li>
<p><span class="font25">5. Use </span><span class="font25" style="font-weight:bold;">ps </span><span class="font25">to verify that the two new </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">processes have a </span><span class="font25" style="font-weight:bold;">nice </span><span class="font25">value. Use the -o and -C options of </span><span class="font25" style="font-weight:bold;">ps </span><span class="font25">for this.</span></p></li>
<li>
<p><span class="font25">6. Use </span><span class="font25" style="font-weight:bold;">renice </span><span class="font25">te increase the nice value from 10 to 15. Notice the difference with the usual commands.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6412"></a><span class="font10" style="font-weight:bold;"><a name="bookmark5973"></a><a name="bookmark6413"></a>2.3. solution : process priorities</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create a new directory and create six </span><span class="font25" style="font-weight:bold;">pipes </span><span class="font25">in that directory.</span></p></li></ul>
<p><span class="font19">[paul@rhel53 ~]$ mkdir pipes </span><span class="font23" style="font-style:italic;">;</span><span class="font19"> cd pipes</span></p>
<p><span class="font19">[paul@rhel53 pipes]$ mkfifo pl p2 p3 p4 p5 p6 [paul@rhel53 pipes]$ ls -l total 0</span></p>
<p><a href="#bookmark6414"><span class="font19">prw-rw-r-- 1 paul paul 0 Apr 12 22:15</span></a></p>
<p><a href="#bookmark6415"><span class="font19">prw-rw-r-- 1 paul paul 0 Apr 12 22:15</span></a></p>
<p><a href="#bookmark6416"><span class="font19">prw-rw-r-- 1 paul paul 0 Apr 12 22:15</span></a></p>
<p><a href="#bookmark6417"><span class="font19">prw-rw-r-- 1 paul paul 0 Apr 12 22:15</span></a></p>
<p><a href="#bookmark6418"><span class="font19">prw-rw-r-- 1 paul paul 0 Apr 12 22:15</span></a></p>
<p><a href="#bookmark6419"><span class="font19">prw-rw-r-- 1 paul paul 0 Apr 12 22:15</span></a></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Bounce a character between two </span><span class="font25" style="font-weight:bold;">pipes</span><span class="font25">.</span></p></li></ul>
<p><span class="font19">[paul@rhel53 pipes]$ echo -n x | cat - p1 &gt;&nbsp;p2 &amp;&nbsp;[1] 4013</span></p>
<p><span class="font19">[paul@rhel53 pipes]$ cat &lt;p2 &gt;p1 &amp;</span></p>
<p><span class="font19">[2] 4016</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Use </span><span class="font25" style="font-weight:bold;">top </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">ps </span><span class="font25">to display information (pid, ppid, priority, nice value, ...) about these two cat processes.</span></p></li></ul>
<p><span class="font19">top (probably the top two lines)</span></p>
<p><span class="font19">[paul@rhel53 pipes]$ ps -C cat</span></p>
<p><span class="font19">PID TTY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TIME CMD</span></p>
<p><span class="font19">4013 pts/0 &nbsp;&nbsp;&nbsp;00:03:38 cat</span></p>
<p><span class="font19">4016 pts/0 &nbsp;&nbsp;&nbsp;00:01:07 cat</span></p>
<table border="1">
<tr><td colspan="2" style="vertical-align:top;">
<p><span class="font19">[paul@rhel53 pipes]$</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ps fax</span></p></td><td colspan="2" style="vertical-align:top;">
<p><span class="font19">| grep cat</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">4013 pts/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">R</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\_</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cat - p1</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">4016 pts/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">S</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1:13</span></p></td><td style="vertical-align:top;">
<p><span class="font19">| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\_</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cat</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">4044 pts/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">S+</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\_</span></p></td><td style="vertical-align:top;">
<p><span class="font19">grep cat</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Bounce another character between two other pipes, but this time start the commands </span><span class="font25" style="font-weight:bold;">nice</span><span class="font25">. Verify that all </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">processes are battling for the cpu. (Feel free to fire up two more cats with the remaining pipes).</span></p></li></ul>
<p><span class="font19">echo -n y | nice cat - p3 &gt;&nbsp;p4 &amp;&nbsp;nice cat &lt;p4 &gt;p3 &amp;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Use </span><span class="font25" style="font-weight:bold;">ps </span><span class="font25">to verify that the two new </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">processes have a </span><span class="font25" style="font-weight:bold;">nice </span><span class="font25">value. Use the -o and -C options of </span><span class="font25" style="font-weight:bold;">ps </span><span class="font25">for this.</span></p></li></ul>
<p><span class="font19">[paul@rhel53 pipes]$ ps -C cat -o pid,ppid,pri,ni,comm</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">PID</span></p></td><td style="vertical-align:top;">
<p><span class="font19">PPID</span></p></td><td style="vertical-align:top;">
<p><span class="font19">PRI</span></p></td><td style="vertical-align:top;">
<p><span class="font19">NI</span></p></td><td style="vertical-align:top;">
<p><span class="font19">COMMAND</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">4013</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3947</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">cat</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">4016</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3947</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">21</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">cat</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">4025</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3947</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">13</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">cat</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">4026</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3947</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">13</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">cat</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Use </span><span class="font25" style="font-weight:bold;">renice </span><span class="font25">te increase the nice value from 10 to 15. Notice the difference with the usual commands.</span></p></li></ul>
<p><span class="font19">[paul@rhel53 pipes]$ renice +15 4025</span></p>
<p><span class="font19">4025: old priority 10, new priority 15</span></p>
<p><span class="font19">[paul@rhel53 pipes]$ renice +15 4026</span></p>
<p><span class="font19">4026: old priority 10, new priority 15</span></p>
<p><span class="font19">[paul@rhel53 pipes]$ ps -C cat -o pid,ppid,pri,ni,comm</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">PID</span></p></td><td style="vertical-align:top;">
<p><span class="font19">PPID</span></p></td><td style="vertical-align:top;">
<p><span class="font19">PRI</span></p></td><td style="vertical-align:top;">
<p><span class="font19">NI</span></p></td><td style="vertical-align:top;">
<p><span class="font19">COMMAND</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">4013</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3947</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">cat</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">4016</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3947</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">21</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">cat</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">4025</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3947</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">9</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">cat</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">4026</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3947</span></p></td><td style="vertical-align:top;">
<p><span class="font19">8</span></p></td><td style="vertical-align:top;">
<p><span class="font19">15</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cat</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<p><a name="bookmark6420"></a><span class="font11" style="font-weight:bold;">Chapter 3. background jobs</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6421"></a><span class="font10" style="font-weight:bold;"><a name="bookmark5975"></a><a name="bookmark6422"></a>3.1. background processes</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark6423"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6424"></a>3.1.1. jobs</span></h3></li></ul></li></ul>
<p><a name="bookmark6425"></a><span class="font25">Stuff that runs in background of your current shell can be displayed with the </span><span class="font25" style="font-weight:bold;">jobs </span><span class="font25">command.</span></p>
<p><span class="font25">By default you will not have any </span><span class="font25" style="font-weight:bold;">jobs </span><span class="font25">running in background.</span></p>
<p><span class="font19">root@rhel53 ~# jobs root@rhel53 ~#</span></p>
<p><span class="font25">This </span><span class="font25" style="font-weight:bold;">jobs </span><span class="font25">command will be used several times in this section.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6426"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6427"></a>3.1.2. control-Z</span></h3></li></ul>
<p><a name="bookmark6428"></a><span class="font25">Some processes can be </span><span class="font25" style="font-weight:bold;">suspended </span><span class="font25">with the </span><span class="font25" style="font-weight:bold;">Ctrl-Z </span><span class="font25">key combination. This sends a </span><span class="font25" style="font-weight:bold;">SIGSTOP </span><span class="font25">signal to the </span><span class="font25" style="font-weight:bold;">Linux kernel</span><span class="font25">, effectively freezing the operation of the process.</span></p>
<p><span class="font25">When doing this in </span><span class="font25" style="font-weight:bold;">vi(m)</span><span class="font25">, then </span><span class="font25" style="font-weight:bold;">vi(m) </span><span class="font25">goes to the background. The background </span><span class="font25" style="font-weight:bold;">vi(m) </span><span class="font25">can be seen with the </span><span class="font25" style="font-weight:bold;">jobs </span><span class="font25">command.</span></p>
<p><span class="font19">[paul@RHEL4a ~]$ vi procdemo.txt</span></p>
<p><span class="font19">[5]+ Stopped &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim procdemo.txt</span></p>
<p><span class="font19">[paul@RHEL4a ~]$ jobs</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">[5] + Stopped &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim procdemo.txt</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark1238"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6429"></a>3.1.3. &amp;&nbsp;ampersand</span></h3></li></ul>
<p><span class="font25">Processes that are started in background using the </span><span class="font25" style="font-weight:bold;">&amp;&nbsp;</span><span class="font25">character at the end of the command line are also visible with the </span><span class="font25" style="font-weight:bold;">jobs </span><span class="font25">command.</span></p>
<p><span class="font19">[paul@RHEL4a ~]$ find / &gt;&nbsp;allfiles.txt 2&gt; /dev/null &amp;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">[6] 5230</span></p></li></ul>
<p><span class="font19">[paul@RHEL4a ~]$ jobs</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">[5] + Stopped &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim procdemo.txt</span></p></li></ul>
<p><span class="font19">[6]- Running &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;find / &gt;allfiles.txt 2&gt;/dev/null &amp;</span></p>
<p><span class="font19">[paul@RHEL4a ~]$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6430"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6431"></a>3.1.4. jobs -p</span></h3></li></ul>
<p><span class="font25">An interesting option is </span><span class="font25" style="font-weight:bold;">jobs -p </span><span class="font25">to see the </span><span class="font25" style="font-weight:bold;">process id </span><span class="font25">of background processes.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ sleep 500 &amp;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">[1] 4902</span></p></li></ul>
<p><span class="font19">[paul@RHEL4b ~]$ sleep 400 &amp;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">[2] 4903</span></p></li></ul>
<p><span class="font19">[paul@RHEL4b ~]$ jobs -p 4902 4903</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ ps 'jobs -p'</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">PID</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">TTY</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">STAT</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">TIME</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">COMMAND</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">4902</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">S</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sleep 500</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">4903</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">S</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sleep 400</span></p></td></tr>
<tr><td colspan="2" style="vertical-align:top;">
<p><span class="font19">[paul@RHEL4b</span></p></td><td style="vertical-align:top;">
<p><span class="font19">~]$</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6432"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6433"></a>3.1.5. fg</span></h3></li></ul>
<h4><a name="bookmark6434"></a><span class="font25"><a name="bookmark6435"></a><a name="bookmark6436"></a>Running the </span><span class="font25" style="font-weight:bold;">fg </span><span class="font25">command will bring a background job to the foreground. The number of the background job to bring forward is the parameter of </span><span class="font25" style="font-weight:bold;">fg</span><span class="font25">.</span></h4>
<p><span class="font19">[paul@RHEL5 ~]$ jobs</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">[1] Running</span></p>
<div>
<p><span class="font19">sleep 1000 &amp;</span></p>
<p><span class="font19">sleep 1000 &amp;</span></p>
<p><span class="font19">sleep 2000 &amp;</span></p>
</div><br clear="all"></li></ul>
<p><span class="font19">[2]- Running</span></p>
<p><span class="font19">[3]+ Running</span></p>
<p><span class="font19">[paul@RHEL5 ~]$ fg 3 sleep 2000</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6437"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6438"></a>3.1.6. bg</span></h3></li></ul>
<h4><a name="bookmark6439"></a><span class="font25"><a name="bookmark6440"></a><a name="bookmark6441"></a>Jobs that are </span><span class="font25" style="font-weight:bold;">suspended </span><span class="font25">in background can be started in background with </span><span class="font25" style="font-weight:bold;">bg</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">bg </span><span class="font25">will send a </span><span class="font25" style="font-weight:bold;">SIGCONT </span><span class="font25">signal.</span></h4>
<h4><a name="bookmark6442"></a><span class="font25"><a name="bookmark6443"></a>Below an example of the sleep command (suspended with </span><span class="font25" style="font-weight:bold;">Ctrl-Z</span><span class="font25">) being reactivated in background with </span><span class="font25" style="font-weight:bold;">bg</span><span class="font25">.</span></h4>
<p><span class="font19">[paul@RHEL5 ~]$ jobs</span></p>
<p><span class="font19">[paul@RHEL5 ~]$ sleep 5000 &amp;&nbsp;[1] 6702</span></p>
<p><span class="font19">[paul@RHEL5 ~]$ sleep 3000</span></p>
<table border="1">
<tr><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">[2]+ Stopped</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sleep</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">3000</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">[paul@RHEL5 ~]$</span></p>
<p><span class="font19">[1]- Running</span></p></td><td style="vertical-align:top;">
<p><span class="font19">jobs</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sleep</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5000</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">&amp;</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[2]+ Stopped</span></p>
<p><span class="font19">[paul@RHEL5 ~]$</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">bg 2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sleep</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3000</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">[2]+ sleep 3000</span></p></td><td style="vertical-align:top;">
<p><span class="font19">&amp;</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">[paul@RHEL5 ~]$</span></p>
<p><span class="font19">[1]- Running</span></p></td><td style="vertical-align:top;">
<p><span class="font19">jobs</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sleep</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5000</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">&amp;</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[2]+ Running</span></p>
<p><span class="font19">[paul@RHEL5 ~]$</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">sleep</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3000</span></p></td><td style="vertical-align:top;">
<p><span class="font19">&amp;</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6444"></a><span class="font10" style="font-weight:bold;"><a name="bookmark5976"></a><a name="bookmark6445"></a>3.2. practice : background processes</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Use the </span><span class="font25" style="font-weight:bold;">jobs </span><span class="font25">command to verify whether you have any processes running in background.</span></p></li>
<li>
<p><span class="font25">2. Use </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">to create a little text file. Suspend </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">in background.</span></p></li>
<li>
<p><span class="font25">3. Verify with </span><span class="font25" style="font-weight:bold;">jobs </span><span class="font25">that </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">is suspended in background.</span></p></li>
<li>
<p><span class="font25">4. Start </span><span class="font25" style="font-weight:bold;">find / &gt;&nbsp;allfiles.txt 2&gt;/dev/null </span><span class="font25">in foreground. Suspend it in background before it finishes.</span></p></li>
<li>
<p><span class="font25">5. Start two long </span><span class="font25" style="font-weight:bold;">sleep </span><span class="font25">processes in background.</span></p></li>
<li>
<p><span class="font25">6. Display all </span><span class="font25" style="font-weight:bold;">jobs </span><span class="font25">in background.</span></p></li>
<li>
<p><span class="font25">7. Use the </span><span class="font25" style="font-weight:bold;">kill </span><span class="font25">command to suspend the last </span><span class="font25" style="font-weight:bold;">sleep </span><span class="font25">process.</span></p></li>
<li>
<p><span class="font25">8. Continue the </span><span class="font25" style="font-weight:bold;">find </span><span class="font25">process in background (make sure it runs again).</span></p></li>
<li>
<p><span class="font25">9. Put one of the </span><span class="font25" style="font-weight:bold;">sleep </span><span class="font25">commands back in foreground.</span></p></li>
<li>
<p><span class="font25">10. (if time permits, a general review question...) Explain in detail where the numbers come from in the next screenshot. When are the variables replaced by their value ? By which shell ?</span></p></li></ul>
<p><span class="font19">[paul@RHEL4b ~]$ echo $$ $PPID 4224 4223</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ bash -c &quot;echo $$ $PPID&quot; 4224 4223</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ bash -c 'echo $$ $PPID' 5059 4224</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ bash -c 'echo $$ $PPID' 4223: 4224: command not found</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6446"></a><span class="font10" style="font-weight:bold;"><a name="bookmark5977"></a><a name="bookmark6447"></a>3.3. solution : background processes</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Use the </span><span class="font25" style="font-weight:bold;">jobs </span><span class="font25">command to verify whether you have any processes running in background.</span></p></li></ul>
<p><span class="font19">jobs (maybe the catfun is still running?)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Use </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">to create a little text file. Suspend </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">in background.</span></p></li></ul>
<p><span class="font19">vi text.txt</span></p>
<p><span class="font19">(inside vi press ctrl-z)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Verify with </span><span class="font25" style="font-weight:bold;">jobs </span><span class="font25">that </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">is suspended in background.</span></p></li></ul>
<p><span class="font19">[paul@rhel53 ~]$ jobs</span></p>
<p><span class="font19">[1]+ Stopped</span></p>
<div>
<p><span class="font19">vim text.txt</span></p>
</div><br clear="all">
<ul style="list-style:none;"><li>
<p><span class="font25">4. Start </span><span class="font25" style="font-weight:bold;">find / &gt;&nbsp;allfiles.txt 2&gt;/dev/null </span><span class="font25">in foreground. Suspend it in background before it finishes.</span></p></li></ul>
<p><span class="font19">[paul@rhel53 ~]$ find / &gt;&nbsp;allfiles.txt 2&gt;/dev/null</span></p>
<p><span class="font19">(press ctrl-z)</span></p>
<p><span class="font19">[2]+ Stopped &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;find / &gt;&nbsp;allfiles.txt 2&gt; /dev/null</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Start two long </span><span class="font25" style="font-weight:bold;">sleep </span><span class="font25">processes in background.</span></p></li></ul>
<p><span class="font19">sleep 4000 &amp;&nbsp;; sleep 5000 &amp;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Display all </span><span class="font25" style="font-weight:bold;">jobs </span><span class="font25">in background.</span></p>
<div>
<p><span class="font19">[paul@rhel53 ~]$ jobs</span></p>
<p><span class="font19">[1]- Stopped</span></p>
<p><span class="font19">[2]+ Stopped</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">[3] Running</span></p></li>
<li>
<p><span class="font19">[4] Running</span></p></li></ul>
</div><br clear="all"></li></ul>
<p><span class="font19">vim text.txt</span></p>
<p><span class="font19">find / &gt;&nbsp;allfiles.txt 2&gt; /dev/null sleep 4000 &amp;</span></p>
<p><span class="font19">sleep 5000 &amp;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. Use the </span><span class="font25" style="font-weight:bold;">kill </span><span class="font25">command to suspend the last </span><span class="font25" style="font-weight:bold;">sleep </span><span class="font25">process.</span></p></li></ul>
<p><span class="font19">[paul@rhel53 ~]$ kill -SIGSTOP 4519</span></p>
<p><span class="font19">[paul@rhel53 ~]$ jobs</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">[1] Stopped &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim text.txt</span></p></li></ul>
<p><span class="font19">[2]- &nbsp;Stopped &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;find / &gt;&nbsp;allfiles.txt 2&gt; /dev/null</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">[3] Running &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep 4000 &amp;</span></p></li>
<li>
<p><span class="font19">[4] + &nbsp;Stopped &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep 5000</span></p></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">8. Continue the </span><span class="font25" style="font-weight:bold;">find </span><span class="font25">process in background (make sure it runs again).</span></p></li></ul>
<p><span class="font19">bg 2 (verify the job-id in your jobs list)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">9. Put one of the </span><span class="font25" style="font-weight:bold;">sleep </span><span class="font25">commands back in foreground.</span></p></li></ul>
<p><span class="font19">fg 3 (again verify your job-id)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">10. (if time permits, a general review question...) Explain in detail where the numbers come from in the next screenshot. When are the variables replaced by their value ? By which shell ?</span></p></li></ul>
<p><span class="font19">[paul@RHEL4b ~]$ echo $$ $PPID</span></p>
<p><span class="font19">4224 4223</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ bash -c &quot;echo $$ $PPID&quot;</span></p>
<p><span class="font19">4224 4223</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ bash -c 'echo $$ $PPID'</span></p>
<p><span class="font19">5059 4224</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ bash -c 'echo $$ $PPID' 4223: 4224: command not found</span></p>
<p><span class="font25">The current bash shell will replace the $$ and $PPID while scanning the line, and before executing the echo command.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ echo $$ $PPID 4224 4223</span></p>
<p><span class="font25">The variables are now double quoted, but the current bash shell will replace $$ and $PPID while scanning the line, and before executing the bach -c command.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ bash -c &quot;echo $$ $PPID&quot; 4224 4223</span></p>
<p><span class="font25">The variables are now single quoted. The current bash shell will </span><span class="font25" style="font-weight:bold;">not </span><span class="font25">replace the $$ and the $PPID. The bash -c command will be executed before the variables replaced with their value. This latter bash is the one replacing the $$ and $PPID with their value.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ bash -c 'echo $$ $PPID' 5059 4224</span></p>
<p><span class="font25">With backticks the shell will still replace both variable before the embedded echo is executed. The result of this echo is the two process id's. These are given as commands to bash -c. But two numbers are not commands!</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ bash -c 'echo $$ $PPID'</span></p>
<p><span class="font19">4223: 4224: command not found</span></p>
<p><a name="bookmark6448"></a><span class="font11" style="font-weight:bold;">Part III. boot management</span></p>
<h3><a name="bookmark6449"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6450"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6451"><span class="font24" style="font-weight:bold;">14. bootloader </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6452"><span class="font24">14.1. boot terminology </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6453"><span class="font24">14.2. grub </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6454"><span class="font24">14.3. grub2 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark1047"><span class="font24">14.4. lilo </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6455"><span class="font24">14.5. practice: bootloader </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6456"><span class="font24">14.6. solution: bootloader </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6457"><span class="font24" style="font-weight:bold;">15. init and runlevels </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6458"><span class="font24">15.1. system init(ialization) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6459"><span class="font24">15.2. daemon or demon ? </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6460"><span class="font24">15.3. starting and stopping daemons </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6461"><span class="font24">15.4. chkconfig </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6462"><span class="font24">15.5. update-rc.d </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6463"><span class="font24">15.6. bum </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6464"><span class="font24">15.7. runlevels </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6465"><span class="font24">15.8. systemd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6466"><span class="font24">15.9. practice: init </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6467"><span class="font24">15.10. solution : init </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark6468"></a><span class="font11" style="font-weight:bold;"><a name="bookmark6469"></a><a name="bookmark6470"></a>Chapter 14. bootloader</span></h1></li></ul>
<p><span class="font25">This chapter briefly discusses the boot sequence of an (Intel 32-bit or 64-bit) Linux computer.</span></p>
<p><span class="font25">Systems booting with </span><span class="font25" style="font-weight:bold;">lilo </span><span class="font25">are rare nowadays, so this section is brief.</span></p>
<p><a name="bookmark6471"></a><span class="font25">The most common bootloader on Linux systems today is </span><span class="font25" style="font-weight:bold;">grub</span><span class="font25">, yet this is not a Linux project.</span></p>
<p><span class="font25">Distributions like </span><span class="font25" style="font-weight:bold;">FreeBSD </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">Solaris </span><span class="font25">also use </span><span class="font25" style="font-weight:bold;">grub</span><span class="font25">.</span></p>
<p><span class="font25">Likewise, </span><span class="font25" style="font-weight:bold;">grub </span><span class="font25">is not limited to Intel architecture. It can also load kernels on PowerPC.</span></p>
<p><span class="font25">Note that </span><span class="font25" style="font-weight:bold;">grub</span><span class="font25">, while still the default in Debian, is slowly being replaced in most distributions with </span><span class="font25" style="font-weight:bold;">grub2</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6472"></a><span class="font10" style="font-weight:bold;"><a name="bookmark5980"></a><a name="bookmark6473"></a>14.1. boot terminology</span></h2></li></ul>
<p><a name="bookmark6474"></a><span class="font25"><a name="bookmark6475"></a><a name="bookmark6476"></a><a name="bookmark6477"></a><a name="bookmark6478"></a>The exact order of things that happen when starting a computer system, depends on the hardware architecture (</span><span class="font25" style="font-weight:bold;">Intel x86 </span><span class="font25">is different from </span><span class="font25" style="font-weight:bold;">Sun Sparc </span><span class="font25">etc), on the boot loader (</span><span class="font25" style="font-weight:bold;">grub </span><span class="font25">is different from </span><span class="font25" style="font-weight:bold;">lilo</span><span class="font25">) and on the operating system (</span><span class="font25" style="font-weight:bold;">Linux</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">Solaris</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">BSD </span><span class="font25">etc). Most of this chapter is focused on booting </span><span class="font25" style="font-weight:bold;">Linux </span><span class="font25">on </span><span class="font25" style="font-weight:bold;">Intel x86 </span><span class="font25">with </span><span class="font25" style="font-weight:bold;">grub</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6479"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6480"></a>14.1.1. post</span></h3></li></ul>
<p><a name="bookmark6481"></a><span class="font25"><a name="bookmark6482"></a>A computer starts booting the moment you turn on the power (no kidding). This first process is called </span><span class="font25" style="font-weight:bold;">post </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">power on self test</span><span class="font25">. If all goes well then this leads to the </span><span class="font25" style="font-weight:bold;">bios</span><span class="font25">. If all goes not so well, then you might hear nothing, or hear beeping, or see an error message on the screen, or maybe see smoke coming out of the computer (burning hardware smells bad!).</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6483"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6484"></a>14.1.2. bios</span></h3></li></ul>
<p><a name="bookmark6485"></a><span class="font25">All </span><span class="font25" style="font-weight:bold;">Intel x86 </span><span class="font25">computers will have a </span><span class="font25" style="font-weight:bold;">basic input/output system </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">bios </span><span class="font25">to detect, identify and initialize hardware. The </span><span class="font25" style="font-weight:bold;">bios </span><span class="font25">then goes looking for a </span><span class="font25" style="font-weight:bold;">boot device</span><span class="font25">. This can be a floppy, hard disk, cdrom, network card or usb drive.</span></p>
<p><span class="font25">During the </span><span class="font25" style="font-weight:bold;">bios </span><span class="font25">you can see a message on the screen telling you which key (often </span><span class="font25" style="font-weight:bold;">Del </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">F2</span><span class="font25">) to press to enter the </span><span class="font25" style="font-weight:bold;">bios </span><span class="font25">setup.</span></p><img src="linux_guide_files/The Complete Linux Guide-137.jpg" alt="" style="width:398pt;height:294pt;">
<ul style="list-style:none;"><li>
<h3><a name="bookmark6486"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6487"></a>14.1.3. openboot</span></h3></li></ul>
<p><a name="bookmark6488"></a><span class="font25"><a name="bookmark6489"></a><a name="bookmark6490"></a>Sun </span><span class="font25" style="font-weight:bold;">sparc </span><span class="font25">systems start with </span><span class="font25" style="font-weight:bold;">openboot </span><span class="font25">to test the hardware and to boot the operating system. </span><span class="font25" style="font-weight:bold;">Bill Callkins </span><span class="font25">explains </span><span class="font25" style="font-weight:bold;">openboot </span><span class="font25">in his Solaris System Administration books. The details of </span><span class="font25" style="font-weight:bold;">openboot </span><span class="font25">are not the focus of this course.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6491"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6492"></a>14.1.4. boot password</span></h3></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">bios </span><span class="font25">allows you to set a password. Do not forget this password, or you will have to open up the hardware to reset it. You can sometimes set a password to boot the system, and another password to protect the </span><span class="font25" style="font-weight:bold;">bios </span><span class="font25">from being modified.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6493"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6494"></a>14.1.5. boot device</span></h3></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">bios </span><span class="font25">will look for a </span><span class="font25" style="font-weight:bold;">boot device </span><span class="font25">in the order configured in the bios setup. Usually an operating system on a production server boots of a hard disk.</span></p><img src="linux_guide_files/The Complete Linux Guide-138.jpg" alt="" style="width:385pt;height:286pt;">
<ul style="list-style:none;"><li>
<h3><a name="bookmark6495"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6496"></a>14.1.6. master boot record</span></h3></li></ul>
<p><a name="bookmark6497"></a><span class="font25"><a name="bookmark6498"></a><a name="bookmark6499"></a>The </span><span class="font25" style="font-weight:bold;">master boot record </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">mbr </span><span class="font25">is the first sector of a hard disk. The partitioning of a disk in </span><span class="font25" style="font-weight:bold;">primary </span><span class="font25">partitions, and the active partition are defined in the </span><span class="font25" style="font-weight:bold;">mbr</span><span class="font25">.</span></p>
<p><a name="bookmark6500"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">mbr </span><span class="font25">is 512 bytes long and can be copied with </span><span class="font25" style="font-weight:bold;">dd</span><span class="font25">.</span></p>
<p><span class="font19">dd if=/dev/sda of=bootsect.mbr count=1 bs=512</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6074"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6501"></a>14.1.7. bootloader</span></h3></li></ul>
<p><a name="bookmark6502"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">mbr </span><span class="font25">is executed by the </span><span class="font25" style="font-weight:bold;">bios </span><span class="font25">and contains either (a small) </span><span class="font25" style="font-weight:bold;">bootloader </span><span class="font25">or code to load a </span><span class="font25" style="font-weight:bold;">bootloader</span><span class="font25">.</span></p>
<p><a name="bookmark6503"></a><span class="font25">Looking at the </span><span class="font25" style="font-weight:bold;">mbr </span><span class="font25">with </span><span class="font25" style="font-weight:bold;">od </span><span class="font25">can reveal information about the </span><span class="font25" style="font-weight:bold;">bootloader</span><span class="font25">.</span></p>
<p><span class="font19">paul@laika:~$ sudo dd if=/dev/sda count=1 bs=16 skip=24 2&gt;/dev/null|od -c 0000000 376 G R U B &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\0 G e o m \0 H a r d</span></p>
<p><span class="font19">0000020</span></p>
<p><a name="bookmark6504"></a><span class="font25"><a name="bookmark6505"></a><a name="bookmark6506"></a><a name="bookmark6507"></a><a name="bookmark6508"></a><a name="bookmark6509"></a>There are a variety of bootloaders available, most common on </span><span class="font25" style="font-weight:bold;">Intel </span><span class="font25">architecture is </span><span class="font25" style="font-weight:bold;">grub</span><span class="font25">, which is replacing </span><span class="font25" style="font-weight:bold;">lilo </span><span class="font25">in many places. When installing </span><span class="font25" style="font-weight:bold;">Linux </span><span class="font25">on </span><span class="font25" style="font-weight:bold;">sparc </span><span class="font25">architecture, you can choose </span><span class="font25" style="font-weight:bold;">silo</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">Itanium </span><span class="font25">systems can use </span><span class="font25" style="font-weight:bold;">elilo</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">IBM S/390 </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">zSeries </span><span class="font25">use </span><span class="font25" style="font-weight:bold;">z/IPL</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">Alpha </span><span class="font25">uses </span><span class="font25" style="font-weight:bold;">milo </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">PowerPC </span><span class="font25">architectures use </span><span class="font25" style="font-weight:bold;">yaboot </span><span class="font25">(yet another boot loader).</span></p>
<p><span class="font25">Bootable cd's and dvd's often use </span><span class="font25" style="font-weight:bold;">syslinux</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6510"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6511"></a>14.1.8. kernel</span></h3></li></ul>
<p><span class="font25">The goal of all this is to load an operating system, or rather the </span><span class="font25" style="font-weight:bold;">kernel </span><span class="font25">of an operating system. A typical bootloader like </span><span class="font25" style="font-weight:bold;">grub </span><span class="font25">will copy a kernel from hard disk to memory, and will then hand control of the computer to the kernel (execute the kernel).</span></p>
<p><span class="font25">Once the Linux kernel is loaded, the bootloader turns control over to it. From that moment on, the kernel is in control of the system. After discussing bootloaders, we continue with the </span><span class="font25" style="font-weight:bold;">init system </span><span class="font25">that starts all the daemons.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6512"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6076"></a><a name="bookmark6513"></a>14.2. grub</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark6514"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6515"></a>14.2.1. /boot/grub/grub.cfg</span></h3></li></ul></li></ul>
<h4><a name="bookmark6516"></a><span class="font25"><a name="bookmark6517"></a><a name="bookmark6518"></a>Debian switched to </span><span class="font25" style="font-weight:bold;">grub2</span><span class="font25">, which will be discussed in the next section. The main boot menu configuration file for </span><span class="font25" style="font-weight:bold;">grub2 </span><span class="font25">is </span><span class="font25" style="font-weight:bold;">grub.cfg</span><span class="font25">.</span></h4>
<p><span class="font19">root@debian7:~# ls -l /boot/grub/grub.cfg</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-r--r--r-- 1 root root 2453 May 13 17:22 /boot/grub/grub.cfg root@debian7:~#</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6519"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6520"></a>14.2.2. /boot/grub/grub.conf</span></h3></li></ul>
<h4><a name="bookmark6521"></a><span class="font25"><a name="bookmark6522"></a><a name="bookmark6523"></a><a name="bookmark6524"></a>Distributions like Red Hat Enterprise Linux 6 use <a name="bookmark6525"></a></span><span class="font25" style="font-weight:bold;">grub.conf </span><span class="font25">and provide a symbolic link from </span><span class="font25" style="font-weight:bold;">/boot/grub/menu.lst </span><span class="font25">and from </span><span class="font25" style="font-weight:bold;">/etc/grub.conf </span><span class="font25">to this file.</span></h4>
<p><span class="font19">[root@centos65 ~]# ls -l /boot/grub/menu.lst</span></p>
<p><span class="font19">lrwxrwxrwx. 1 root root 11 Mar 7 11:53 /boot/grub/menu.lst -&gt; ./grub.conf [root@centos65 ~]# ls -l /boot/grub/grub.conf</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-------. 1 root root 1189 May 5 11:47 /boot/grub/grub.conf</span></p></li></ul>
<p><span class="font19">[root@centos65 ~]#</span></p>
<h4><a name="bookmark6526"></a><span class="font25"><a name="bookmark6527"></a>The file currently (RHEL 6.5) looks like this:</span></h4>
<p><span class="font19">[root@centos65 ~]# more /boot/grub/grub.conf</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># grub.conf generated by anaconda #</span></p></li>
<li>
<p><span class="font19"># Note that you do not have to rerun grub after making changes to this file</span></p></li>
<li>
<p><span class="font19"># NOTICE: You have a /boot partition. This means that</span></p></li>
<li>
<p><span class="font19"># all kernel and initrd paths are relative to /boot/, eg.</span></p></li>
<li>
<p><span class="font19"># root (hd0,0)</span></p></li>
<li>
<p><span class="font19"># kernel /vmlinuz-version ro root=/dev/mapper/VolGroup-lv_root</span></p></li>
<li>
<p><span class="font19"># initrd /initrd-[generic-]version.img</span></p></li></ul>
<p><span class="font19">#boot=/dev/sda</span></p>
<p><span class="font19">default=0</span></p>
<p><span class="font19">timeout=5</span></p>
<p><span class="font19">splashimage=(hd0,0)/grub/splash.xpm.gz</span></p>
<p><span class="font19">hiddenmenu</span></p>
<p><span class="font19">title CentOS (2.6.32-431.11.2.el6.x86_64)</span></p>
<p><span class="font19">root (hd0,0)</span></p>
<p><span class="font19">kernel /vmlinuz-2.6.32-431.11.2.el6.x86_64 ro root=/dev/mapper/VolGr\ oup-lv_root rd_NO_LUKS LANG=en_US.UTF-8 rd_NO_MD rd_LVM_LV=VolGroup/lv_swap \ SYSFONT=latarcyrheb-sun16 crashkernel=auto rd_LVM_LV=VolGroup/lv_root KEYBO\ ARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet</span></p>
<p><span class="font19">initrd /initramfs-2.6.32-431.11.2.el6.x86_64.img</span></p>
<p><span class="font19">title CentOS (2.6.32-431.el6.x86_64)</span></p>
<p><span class="font19">root (hd0,0)</span></p>
<p><span class="font19">kernel /vmlinuz-2.6.32-431.el6.x86_64 ro root=/dev/mapper/VolGroup-l\ v_root rd_NO_LUKS LANG=en_US.UTF-8 rd_NO_MD rd_LVM_LV=VolGroup/lv_swap SYSFO\ NT=latarcyrheb-sun16 crashkernel=auto rd_LVM_LV=VolGroup/lv_root KEYBOARDTY\ PE=pc KEYTABLE=us rd_NO_DM rhgb quiet</span></p>
<p><span class="font19">initrd /initramfs-2.6.32-431.el6.x86_64.img</span></p>
<p><span class="font19">[root@centos65 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6528"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6529"></a>14.2.3. menu commands</span></h3></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">menu commands </span><span class="font25">must be at the top of </span><span class="font25" style="font-weight:bold;">grub</span><span class="font25">'s configuration file.</span></p>
<p><span class="font7" style="font-weight:bold;">default</span></p>
<p><a name="bookmark6530"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">default </span><span class="font25">command sets a default </span><span class="font25" style="font-weight:bold;">entry </span><span class="font25">to start. The first </span><span class="font25" style="font-weight:bold;">entry </span><span class="font25">has number 0.</span></p>
<p><span class="font19">default=0</span></p>
<p><span class="font25">Each entry or </span><span class="font25" style="font-weight:bold;">stanza </span><span class="font25">starts with a </span><span class="font25" style="font-weight:bold;">title </span><span class="font25">directive.</span></p>
<p><span class="font7" style="font-weight:bold;">fallback</span></p>
<p><a name="bookmark6531"></a><span class="font25">In case the </span><span class="font25" style="font-weight:bold;">default </span><span class="font25">does not boot, use the </span><span class="font25" style="font-weight:bold;">fallback </span><span class="font25">entry instead.</span></p>
<p><span class="font19">fallback=1</span></p>
<p><span class="font7" style="font-weight:bold;">timeout</span></p>
<p><a name="bookmark6532"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">timeout </span><span class="font25">will wait a number of seconds before booting the </span><span class="font25" style="font-weight:bold;">default </span><span class="font25">entry.</span></p>
<p><span class="font19">timeout=5</span></p>
<p><span class="font7" style="font-weight:bold;">hiddenmenu</span></p>
<p><a name="bookmark6533"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">hiddenmenu </span><span class="font25">will hide the </span><span class="font25" style="font-weight:bold;">grub </span><span class="font25">menu unless the user presses </span><span class="font25" style="font-weight:bold;">Esc </span><span class="font25">before the </span><span class="font25" style="font-weight:bold;">timeout </span><span class="font25">expires.</span></p>
<p><span class="font19">hiddenmenu</span></p>
<p><span class="font7" style="font-weight:bold;">title</span></p>
<p><a name="bookmark6534"></a><span class="font25">With </span><span class="font25" style="font-weight:bold;">title </span><span class="font25">we can start a new </span><span class="font25" style="font-weight:bold;">entry </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">stanza</span><span class="font25">.</span></p>
<p><span class="font19">title CentOS (2.6.32-431.11.2.el6.x86_64)</span></p>
<p><span class="font7" style="font-weight:bold;">password</span></p>
<p><a name="bookmark6535"></a><span class="font25">You can add a </span><span class="font25" style="font-weight:bold;">password </span><span class="font25">to prevent interactive selection of a boot environment while </span><span class="font25" style="font-weight:bold;">grub </span><span class="font25">is running.</span></p>
<p><span class="font19">password --md5 $1$Ec.id/$T2C2ahI/EG3WRRsmmu/HN/</span></p>
<p><span class="font25">Use the </span><span class="font25" style="font-weight:bold;">grub </span><span class="font25">interactive shell to create the password hash.</span></p>
<p><span class="font19">grub&gt; md5crypt</span></p>
<p><span class="font19">Password: ********</span></p>
<p><span class="font19">Encrypted: $1$Ec.id/$T2C2ahI/EG3WRRsmmu/HN/</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6536"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6537"></a>14.2.4. stanza commands</span></h3></li></ul>
<p><a name="bookmark6538"></a><span class="font25">Every </span><span class="font25" style="font-weight:bold;">operating system </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">kernel </span><span class="font25">that you want to boot with </span><span class="font25" style="font-weight:bold;">grub </span><span class="font25">will have a </span><span class="font25" style="font-weight:bold;">stanza </span><span class="font25">aka an </span><span class="font25" style="font-weight:bold;">entry </span><span class="font25">of a couple of lines. Listed here are some of the common </span><span class="font25" style="font-weight:bold;">stanza </span><span class="font25">commands.</span></p>
<p><span class="font7" style="font-weight:bold;">boot</span></p>
<p><a name="bookmark6539"></a><span class="font25">Technically the </span><span class="font25" style="font-weight:bold;">boot </span><span class="font25">command is only mandatory when running the </span><span class="font25" style="font-weight:bold;">grub command line</span><span class="font25">. This command does not have any parameters and can only be set as the last command of a stanza.</span></p>
<p><span class="font19">boot</span></p>
<p><span class="font7" style="font-weight:bold;">kernel</span></p>
<p><a name="bookmark6540"></a><span class="font25"><a name="bookmark6541"></a><a name="bookmark6542"></a><a name="bookmark6543"></a><a name="bookmark6544"></a>The </span><span class="font25" style="font-weight:bold;">kernel </span><span class="font25">command points to the location of the kernel. To boot Linux this means booting a </span><span class="font25" style="font-weight:bold;">gzip </span><span class="font25">compressed </span><span class="font25" style="font-weight:bold;">zImage </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">bzip2 </span><span class="font25">compressed </span><span class="font25" style="font-weight:bold;">bzImage</span><span class="font25">.</span></p>
<p><span class="font25">This screenshot shows a </span><span class="font25" style="font-weight:bold;">kernel </span><span class="font25">command used to load a Debian kernel.</span></p>
<p><span class="font19">kernel /boot/vmlinuz-2.6.17-2-686 root=/dev/hda1 ro</span></p>
<p><span class="font25">And this is how RHEL 5 uses the </span><span class="font25" style="font-weight:bold;">kernel </span><span class="font25">command.</span></p>
<p><span class="font19">kernel /vmlinuz-2.6.18-128.el5 ro root=/dev/VolGroup00/LogVol00 rhgb quiet</span></p>
<p><a name="bookmark6545"></a><span class="font25">All parameters in the kernel line can be read by the kernel itself or by any other program (which are started later) by reading </span><span class="font25" style="font-weight:bold;">/proc/cmdline</span></p>
<p><span class="font7" style="font-weight:bold;">initrd</span></p>
<p><a name="bookmark6546"></a><span class="font25">Many </span><span class="font25" style="font-weight:bold;">Linux </span><span class="font25">installations will need an </span><span class="font25" style="font-weight:bold;">initial ramdisk </span><span class="font25">at boot time. This can be set in </span><span class="font25" style="font-weight:bold;">grub </span><span class="font25">with the </span><span class="font25" style="font-weight:bold;">initrd </span><span class="font25">command.</span></p>
<p><span class="font25">Here a screenshot of Debian 4.0</span></p>
<p><span class="font19">initrd /boot/initrd.img-2.6.17-2-686</span></p>
<p><span class="font25">And the same for Red Hat Enterprise Linux 5</span></p>
<p><span class="font19">initrd /initrd-2.6.18-128.el5.img</span></p>
<p><span class="font7" style="font-weight:bold;">root</span></p>
<p><a name="bookmark6547"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">command accepts the root device as a parameter.</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">command will point to the hard disk and partition to use, with </span><span class="font25" style="font-weight:bold;">hd0 </span><span class="font25">as the first hard disk device and </span><span class="font25" style="font-weight:bold;">hd1 </span><span class="font25">as the second hard disk device. The same numbering is used for partitions, so </span><span class="font25" style="font-weight:bold;">hd0,0 </span><span class="font25">is the first partition on the first disk and </span><span class="font25" style="font-weight:bold;">hd0,1 </span><span class="font25">is the second partition on that disk.</span></p>
<p><span class="font19">root (hd0,0)</span></p>
<p><span class="font7" style="font-weight:bold;">savedefault</span></p>
<p><a name="bookmark6548"></a><span class="font25"><a name="bookmark6549"></a>The </span><span class="font25" style="font-weight:bold;">savedefault </span><span class="font25">command can be used together with </span><span class="font25" style="font-weight:bold;">default saved </span><span class="font25">as a menu command. This combination will set the currently booted stanza as the next default stanza to boot. </span><span class="font19">default saved timeout 10 title Linux root (hd0,0) kernel /boot/vmlinuz savedefault title DOS root (hd0,1) makeactive chainloader +1 savedefault</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6550"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6551"></a>14.2.5. chainloading</span></h3></li></ul>
<p><a name="bookmark6552"></a><span class="font25">With </span><span class="font25" style="font-weight:bold;">grub </span><span class="font25">booting, there are two choices: loading an operating system or </span><span class="font25" style="font-weight:bold;">chainloading </span><span class="font25">another bootloader. The </span><span class="font25" style="font-weight:bold;">chainloading </span><span class="font25">feature of grub loads the bootsector of a partition (that contains an operating system).</span></p>
<p><a name="bookmark6553"></a><span class="font25"><a name="bookmark6554"></a><a name="bookmark6555"></a>Some older operating systems require a </span><span class="font25" style="font-weight:bold;">primary partition </span><span class="font25">that is set as </span><span class="font25" style="font-weight:bold;">active</span><span class="font25">. Only one partition can be set </span><span class="font25" style="font-weight:bold;">active </span><span class="font25">so </span><span class="font25" style="font-weight:bold;">grub </span><span class="font25">can do this on the fly just before </span><span class="font25" style="font-weight:bold;">chainloading</span><span class="font25">.</span></p>
<p><span class="font25">This screenshot shows how to set the first primary partition </span><span class="font25" style="font-weight:bold;">active </span><span class="font25">with </span><span class="font25" style="font-weight:bold;">grub</span><span class="font25">. </span><span class="font19">root (hd0,0) makeactive</span></p>
<p><a name="bookmark6556"></a><span class="font25"><a name="bookmark6557"></a><a name="bookmark6558"></a>Chainloading refers to grub loading another operating system's bootloader. The </span><span class="font25" style="font-weight:bold;">chainloader </span><span class="font25">switch receives one option: the number of sectors to read and boot. For </span><span class="font25" style="font-weight:bold;">DOS </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">OS/2 </span><span class="font25">one sector is enough. Note that </span><span class="font25" style="font-weight:bold;">DOS </span><span class="font25">requires the boot/root partition to be active!</span></p>
<p><span class="font25">Here is a complete example to </span><span class="font25" style="font-weight:bold;">chainload </span><span class="font25">an old operating system.</span></p>
<p><span class="font19">title MS-DOS 6.22 root (hd0,1) makeactive chainloader +1</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6559"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6560"></a>14.2.6. simple stanza examples</span></h3></li></ul>
<p><span class="font25">This is a screenshot of a </span><span class="font25" style="font-weight:bold;">Debian 4 </span><span class="font25">stanza.</span></p>
<p><span class="font19">title Debian GNU/Linux, kernel 2.6.17-2-686</span></p>
<p><span class="font19">root (hd0,0)</span></p>
<p><span class="font19">kernel /boot/vmlinuz-2.6.17-2-686 root=/dev/hda1 ro</span></p>
<p><span class="font19">initrd /boot/initrd.img-2.6.17-2-686</span></p>
<p><span class="font25">Here a screenshot of a </span><span class="font25" style="font-weight:bold;">Red Hat Enterprise Linux 5 </span><span class="font25">stanza.</span></p>
<p><span class="font19">title Red Hat Enterprise Linux Server (2.6.18-128.el5)</span></p>
<p><span class="font19">root (hd0,0)</span></p>
<p><span class="font19">kernel /vmlinuz-2.6.18-98.el5 ro root=/dev/VolGroup00/LogVol00 rhgb quiet</span></p>
<p><span class="font19">initrd /initrd-2.6.18-98.el5.img</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6561"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6562"></a>14.2.7. editing grub at boot time</span></h3></li></ul>
<p><span class="font25">At boot time, when the </span><span class="font25" style="font-weight:bold;">grub </span><span class="font25">menu is displayed, you can type </span><span class="font25" style="font-weight:bold;">e </span><span class="font25">to edit the current stanza. This enables you to add parameters to the kernel.</span></p>
<p><span class="font25">One such parameter, useful when you lost the root password, is </span><span class="font25" style="font-weight:bold;">single</span><span class="font25">. This will boot the kernel in single user mode (although some distributions will still require you to type the root password.</span></p>
<p><span class="font19">kernel /boot/vmlinuz-2.6.17-2-686 root=/dev/hda1 ro single</span></p>
<p><span class="font25">Another option to reset a root password is to use an </span><span class="font25" style="font-weight:bold;">init=/bin/bash </span><span class="font25">parameter.</span></p>
<p><span class="font19">kernel /boot/vmlinuz-2.6.17-2-686 root=/dev/hda1 ro init=/bin/bash</span></p>
<p><span class="font25">Note that some distributions will disable this option at kernel compile time.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6563"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6564"></a>14.2.8. installing grub</span></h3></li></ul>
<p><a name="bookmark6565"></a><span class="font25">Run the </span><span class="font25" style="font-weight:bold;">grub-install </span><span class="font25">command to install </span><span class="font25" style="font-weight:bold;">grub</span><span class="font25">. The command requires a destination for overwriting the </span><span class="font25" style="font-weight:bold;">boot sector </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">mbr</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># grub-install /dev/hda</span></p></li></ul>
<p><span class="font25">You will rarely have to do this manually, since grub is installed when installing the operating system and does not need any re-install when changing configuration (as is the case for </span><span class="font25" style="font-weight:bold;">lilo</span><span class="font25">).</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6566"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6077"></a><a name="bookmark6567"></a>14.3. grub2</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark6568"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6569"></a>14.3.1. grub 2.0 ?</span></h3></li></ul></li></ul>
<h4><a name="bookmark6570"></a><span class="font25"><a name="bookmark6571"></a>The main configuration file is now </span><span class="font25" style="font-weight:bold;">/boot/grub/grub.cfg</span><span class="font25">. And while this file may look familiar, one should never edit this file directly (because it is generated!).</span></h4>
<p><span class="font19">root@debian7:~# ls -l /boot/grub/grub.cfg</span></p>
<p><span class="font19">-r--r--r-- 1 root root 2453 May 13 17:22 /boot/grub/grub.cfg</span></p>
<p><span class="font19">root@debian7:~# head -3 /boot/grub/grub.cfg #</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># DO NOT EDIT THIS FILE</span></p></li></ul>
<p><span class="font19">#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6572"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6573"></a>14.3.2. /etc/grub.d/40_custom</span></h3></li></ul>
<h4><a name="bookmark6574"></a><span class="font25"><a name="bookmark6575"></a><a name="bookmark6576"></a>The </span><span class="font25" style="font-weight:bold;">/etc/grub.d/40_custom </span><span class="font25">file can be changed to include custom entries. These entries are automatically added to grub.</span></h4>
<p><span class="font19">root@debian7:~# ls -l /etc/grub.d/40_custom</span></p>
<p><span class="font19">-rwxr-xr-x 1 root root 214 Jul 3 &nbsp;2013 /etc/grub.d/40_custom</span></p>
<p><span class="font19">root@debian7:~# cat /etc/grub.d/40_custom</span></p>
<p><span class="font19">#!/bin/sh</span></p>
<p><span class="font19">exec tail -n +3 $0</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># This file provides an easy way to add custom menu entries. Simply type the</span></p></li>
<li>
<p><span class="font19"># menu entries you want to add after this comment. Be careful not to change # the 'exec tail' line above.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6577"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6578"></a>14.3.3. /etc/default/grub</span></h3></li></ul>
<h4><a name="bookmark6579"></a><span class="font25"><a name="bookmark6580"></a><a name="bookmark6581"></a>The new configuration file for changing grub is now </span><span class="font25" style="font-weight:bold;">/etc/default/grub</span><span class="font25">.</span></h4>
<p><span class="font19">root@debian7:~# head /etc/default/grub</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># If you change this file, run 'update-grub' afterwards to update</span></p></li>
<li>
<p><span class="font19"># /boot/grub/grub.cfg.</span></p></li>
<li>
<p><span class="font19"># For full documentation of the options in this file, see:</span></p></li>
<li>
<p><span class="font19"># info -f grub -n 'Simple configuration'</span></p></li></ul>
<p><span class="font19">GRUB_DEFAULT=0</span></p>
<p><span class="font19">GRUB_TIMEOUT=5</span></p>
<p><span class="font19">GRUB_DISTRIBUTOR='lsb_release -i -s 2&gt; /dev/null || echo Debian'</span></p>
<p><span class="font19">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet&quot;</span></p>
<p><span class="font19">GRUB_CMDLINE_LINUX=&quot;debian-installer=en_US&quot;</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6582"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6583"></a>14.3.4. update-grub</span></h3></li></ul>
<h4><a name="bookmark6584"></a><span class="font25"><a name="bookmark6585"></a><a name="bookmark6586"></a>Whenever the </span><span class="font25" style="font-weight:bold;">/etc/default/grub </span><span class="font25">file is changed, you will need to run </span><span class="font25" style="font-weight:bold;">update-grub </span><span class="font25">to apply the changes.</span></h4>
<p><span class="font19">root@debian7:~# vi /etc/default/grub</span></p>
<p><span class="font19">root@debian7:~# update-grub</span></p>
<p><span class="font19">Generating grub.cfg ...</span></p>
<p><span class="font19">Found linux image: /boot/vmlinuz-3.2.0-4-amd64</span></p>
<p><span class="font19">Found initrd image: /boot/initrd.img-3.2.0-4-amd64 done</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6587"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6078"></a><a name="bookmark6588"></a>14.4. lilo</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark6589"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6590"></a>14.4.1. Linux loader</span></h3></li></ul></li></ul>
<p><a name="bookmark6591"></a><span class="font25" style="font-weight:bold;">lilo </span><span class="font25">used to be the most used Linux bootloader, but is steadily being replaced with </span><span class="font25" style="font-weight:bold;">grub </span><span class="font25">and recently </span><span class="font25" style="font-weight:bold;">grub2</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6592"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6593"></a>14.4.2. lilo.conf</span></h3></li></ul>
<p><a name="bookmark6594"></a><span class="font25">Here is an example of a </span><span class="font25" style="font-weight:bold;">lilo.conf </span><span class="font25">file. The </span><span class="font25" style="font-weight:bold;">delay </span><span class="font25">switch receives a number in tenths of a second. So the delay below is three seconds, not thirty!</span></p>
<p><span class="font19">boot = /dev/hda delay = 30</span></p>
<p><span class="font19">image = /boot/vmlinuz root = /dev/hdal label = Red Hat 5.2</span></p>
<p><span class="font19">image = /boot/vmlinuz root = /dev/hda2 label = S.U.S.E. 8.0</span></p>
<p><span class="font19">other = /dev/hda4 table = /dev/hda label = MS-DOS 6.22</span></p>
<p><span class="font25">The configration file shows three example stanzas. The first one boots Red Hat from the first partition on the first disk (hda1). The second stanza boots Suse 8.0 from the next partition. The last one loads MS-DOS.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6595"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6079"></a><a name="bookmark6596"></a>14.5. practice: bootloader</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">0. Find out whether your system is using lilo, grub or grub2. Only do the practices that are appropriate for your system.</span></p></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Make a copy of the kernel, initrd and System.map files in /boot. Put the copies also in / boot but replace 2.x or 3.x with 4.0 (just imagine that Linux 4.0 is out.).</span></p></li>
<li>
<p><span class="font25">2. Add a stanza in grub for the 4.0 files. Make sure the title is different.</span></p></li>
<li>
<p><span class="font25">3. Set the boot menu timeout to 30 seconds.</span></p></li>
<li>
<p><span class="font25">4. Reboot and test the new stanza.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6597"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6080"></a><a name="bookmark6598"></a>14.6. solution: bootloader</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark6599"></a><span class="font25"><a name="bookmark6600"></a>0. Find out whether your system is using lilo, grub or grub2. Only do the practices that are appropriate for your system.</span></h4></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark6601"></a><span class="font25"><a name="bookmark6602"></a>1. Make a copy of the kernel, initrd and System.map files in /boot. Put the copies also in / boot but replace 2.x or 3.x with 4.0 (just imagine that Linux 4.0 is out.).</span></h4></li></ul>
<p><span class="font19">[root@centos65 boot] # uname -r</span></p>
<p><span class="font19">2.6.32-431.11.2.el6.x86_64</span></p>
<p><span class="font19">[root@centos65 boot]# cp System.map-2.6.32-431.11.2.el6.x86_64 System.map-4.0</span></p>
<p><span class="font19">[root@centos65 boot]# cp vmlinuz-2.6.32-431.11.2.el6.x86_64 vmlinuz-4.0</span></p>
<p><span class="font19">[root@centos65 boot]# cp initramfs-2.6.32-431.11.2.el6.x86_64.img initramfs-4.0\ . img</span></p>
<h4><a name="bookmark6603"></a><span class="font25"><a name="bookmark6604"></a>Do not forget that the initrd (or initramfs) file ends in </span><span class="font25" style="font-weight:bold;">.img </span><span class="font25">.</span><br><br><span class="font25"><a name="bookmark6605"></a>2. Add a stanza in grub for the 4.0 files. Make sure the title is different.</span></h4>
<p><span class="font19">[root@centos65 grub]# cut -c1-70 menu.lst | tail -12</span></p>
<p><span class="font19">title CentOS (4.0) root (hd0,0) kernel /vmlinuz-4.0 ro root=/dev/mapper/VolGroup-lv_root rd_NO_LUKS L initrd /initramfs-4.0.img</span></p>
<p><span class="font19">title CentOS (2.6.32-431.11.2.el6.x86_64) root (hd0,0)</span></p>
<p><span class="font19">kernel /vmlinuz-2.6.32-431.11.2.el6.x86_64 ro root=/dev/mapper/VolGro initrd /initramfs-2.6.32-431.11.2.el6.x86_64.img</span></p>
<p><span class="font19">title CentOS (2.6.32-431.el6.x86_64) root (hd0,0)</span></p>
<p><span class="font19">kernel /vmlinuz-2.6.32-431.el6.x86_64 ro root=/dev/mapper/VolGroup-lv initrd /initramfs-2.6.32-431.el6.x86_64.img</span></p>
<p><span class="font19">[root@centos65 grub]#</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark6606"></a><span class="font25"><a name="bookmark6607"></a>3. Set the boot menu timeout to 30 seconds.</span></h4></li></ul>
<p><span class="font19">[root@centos65 grub]# vi menu.lst</span></p>
<p><span class="font19">[root@centos65 grub]# grep timeout /boot/grub/grub.conf</span></p>
<p><span class="font19">timeout=30</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark6608"></a><span class="font25"><a name="bookmark6609"></a>4. Reboot and test the new stanza.</span></h4><img src="linux_guide_files/The Complete Linux Guide-139.jpg" alt="" style="width:437pt;height:88pt;"></li></ul>
<h4><a name="bookmark6610"></a><span class="font25"><a name="bookmark6611"></a>Select your stanza and if it boots then you did it correct.</span></h4>
<ul style="list-style:none;"><li>
<h1><a name="bookmark6612"></a><span class="font11" style="font-weight:bold;"><a name="bookmark6081"></a><a name="bookmark6613"></a>Chapter 15. init and runlevels</span></h1></li></ul>
<p><a name="bookmark6614"></a><span class="font25">Many Unix and Linux distributions use </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">scripts to start daemons in the same way that </span><span class="font25" style="font-weight:bold;">Unix System V </span><span class="font25">did. This chapter will explain in detail how that works.</span></p>
<p><span class="font25">Init starts daemons by using scripts, where each script starts one daemon, and where each script waits for the previous script to finish. This serial process of starting daemons is slow, and although slow booting is not a problem on servers where uptime is measured in years, the recent uptake of Linux on the desktop results in user complaints.</span></p>
<p><a name="bookmark6615"></a><span class="font25"><a name="bookmark6616"></a><a name="bookmark6617"></a><a name="bookmark6618"></a>To improve Linux startup speed, </span><span class="font25" style="font-weight:bold;">Canonical </span><span class="font25">has developed </span><span class="font25" style="font-weight:bold;">upstart</span><span class="font25">, which was first used in Ubuntu. Solaris also used </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">up to Solaris 9, for Solaris 10 </span><span class="font25" style="font-weight:bold;">Sun </span><span class="font25">developed </span><span class="font25" style="font-weight:bold;">Service Management Facility</span><span class="font25">. Both systems start daemons in <a name="bookmark6619"></a>parallel and can replace the SysV init scripts. There is also an ongoing effort to create </span><span class="font25" style="font-weight:bold;">initng </span><span class="font25">(init next generation).</span></p>
<p><span class="font25">In 2014 the </span><span class="font25" style="font-weight:bold;">systemd </span><span class="font25">initiative has taken a lead when after Fedora, RHEL7 and CentOS7 also Debian has chosen this to be the prefered replacement for init. The end of this module contains an introduction to </span><span class="font25" style="font-weight:bold;">systemd</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6620"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6082"></a><a name="bookmark6621"></a>15.1. system init(ialization)</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark6622"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6623"></a>15.1.1. process id 1</span></h3></li></ul></li></ul>
<p><a name="bookmark6624"></a><span class="font25">The kernel receives system control from the bootloader. After a while the kernel starts the </span><span class="font25" style="font-weight:bold;">init daemon</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">daemon (</span><span class="font25" style="font-weight:bold;">/sbin/init</span><span class="font25">) is the first daemon that is started and receives </span><span class="font25" style="font-weight:bold;">process id 1 </span><span class="font25">(PID 1). </span><span class="font25" style="font-weight:bold;">Init </span><span class="font25">never dies.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6625"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6626"></a>15.1.2. configuration in /etc/inittab</span></h3></li></ul>
<p><a name="bookmark6627"></a><span class="font25"><a name="bookmark6628"></a>When </span><span class="font25" style="font-weight:bold;">/sbin/init </span><span class="font25">is started, it will first read its configuration file </span><span class="font25" style="font-weight:bold;">/etc/inittab</span><span class="font25">. In that file, it will look for the value of initdefault (3 in the screenshot below).</span></p>
<p><span class="font19">[paul@rhel4 ~]$ grep </span><span class="font18"><sup>A</sup></span><span class="font19">id /etc/inittab</span></p>
<p><span class="font19">id:3:initdefault:</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6629"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6630"></a>15.1.3. initdefault</span></h3></li></ul>
<p><a name="bookmark6631"></a><span class="font25">The value found in </span><span class="font25" style="font-weight:bold;">initdefault </span><span class="font25">indicates the default </span><span class="font25" style="font-weight:bold;">runlevel</span><span class="font25">. Some Linux distributions have a brief description of runlevels in /etc/inittab, like here on Red Hat Enterprise Linux 4.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Default runlevel. The runlevels used by RHS are:</span></p></li>
<li>
<p><span class="font19"># 0 - halt (Do NOT set initdefault to this)</span></p></li>
<li>
<p><span class="font19"># 1 - Single user mode</span></p></li>
<li>
<p><span class="font19"># 2 - Multiuser, without NFS (The same as 3, if you don't have network)</span></p></li>
<li>
<p><span class="font19"># 3 - Full multiuser mode</span></p></li>
<li>
<p><span class="font19"># 4 - unused</span></p></li>
<li>
<p><span class="font19"># 5 - X11</span></p></li>
<li>
<p><span class="font19"># 6 - reboot (Do NOT set initdefault to this)</span></p></li></ul>
<p><span class="font25" style="font-weight:bold;">Runlevel 0 </span><span class="font25">means the system is shutting down. </span><span class="font25" style="font-weight:bold;">Runlevel 1 </span><span class="font25">is used for troubleshooting, only the root user can log on, and only at the console. </span><span class="font25" style="font-weight:bold;">Runlevel 3 </span><span class="font25">is typical for servers, whereas </span><span class="font25" style="font-weight:bold;">runlevel 5 </span><span class="font25">is typical for desktops (graphical logon). Besides runlevels 0, 1 and 6, the use may vary depending on the distribution. Debian and derived Linux systems have full network and GUI logon on runlevels 2 to 5. So always verify the proper meaning of runlevels on your system.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6632"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6633"></a>15.1.4. sysinit script</span></h3></li></ul>
<p><span class="font7" style="font-weight:bold;">/etc/rc.d/rc.sysinit</span></p>
<h4><a name="bookmark6634"></a><span class="font25"><a name="bookmark6635"></a>The next line in </span><span class="font25" style="font-weight:bold;">/etc/inittab </span><span class="font25">in Red Hat and derivatives is the following.</span></h4>
<p><span class="font19">si::sysinit:/etc/rc.d/rc.sysinit</span></p>
<h4><a name="bookmark6636"></a><span class="font25"><a name="bookmark6637"></a><a name="bookmark6638"></a><a name="bookmark6639"></a>This means that independent of the selected runlevel, </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">will run the </span><span class="font25" style="font-weight:bold;">/etc/rc.d/rc.sysinit </span><span class="font25">script. This script initializes hardware, sets some basic environment, populates </span><span class="font25" style="font-weight:bold;">/etc/mtab </span><span class="font25">while mounting file systems, starts swap and more.</span></h4>
<p><span class="font19">[paul@rhel ~]$ egrep -e&quot;</span><span class="font18"><sup>A</sup></span><span class="font19"># Ini&quot; -e&quot;</span><span class="font18"><sup>A</sup></span><span class="font19"># Sta&quot; -e&quot;</span><span class="font18"><sup>A</sup></span><span class="font19"># Che&quot; /etc/rc.d/rc.sysinit # Check SELinux status</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Initialize hardware</span></p></li>
<li>
<p><span class="font19"># Start the graphical boot, if necessary; /usr may not be mounted yet...</span></p></li>
<li>
<p><span class="font19"># Initialiaze ACPI bits</span></p></li>
<li>
<p><span class="font19"># Check filesystems</span></p></li>
<li>
<p><span class="font19"># Start the graphical boot, if necessary and not done yet.</span></p></li>
<li>
<p><span class="font19"># Check to see if SELinux requires a relabel</span></p></li>
<li>
<p><span class="font19"># Initialize pseudo-random number generator</span></p></li>
<li>
<p><span class="font19"># Start up swapping.</span></p></li>
<li>
<p><span class="font19"># Initialize the serial ports.</span></p></li></ul>
<p><a name="bookmark6640"></a><span class="font25" style="font-style:italic;"><a name="bookmark6641"></a>That </span><span class="font25" style="font-weight:bold;font-style:italic;">egrep </span><span class="font25" style="font-style:italic;">command could also have been written with </span><span class="font25" style="font-weight:bold;font-style:italic;">grep </span><span class="font25" style="font-style:italic;">like this :</span></p>
<p><span class="font19">grep &quot;*# \(Ini\|Sta\|Che\)&quot;.</span></p>
<p><span class="font7" style="font-weight:bold;">/etc/init.d/rcS</span></p>
<h4><a name="bookmark6642"></a><span class="font25"><a name="bookmark6643"></a>Debian has the following line after </span><span class="font25" style="font-weight:bold;">initdefault</span><span class="font25">.</span></h4>
<p><span class="font19">si::sysinit:/etc/init.d/rcS</span></p>
<h4><a name="bookmark6644"></a><span class="font25"><a name="bookmark6645"></a><a name="bookmark6646"></a><a name="bookmark6647"></a>The </span><span class="font25" style="font-weight:bold;">/etc/init.d/rcS </span><span class="font25">script will always run on Debian (independent of the selected runlevel).</span><br><br><span class="font25"><a name="bookmark6648"></a>The script is actually running all scripts in the </span><span class="font25" style="font-weight:bold;">/etc/rcS.d/ </span><span class="font25">directory in alphabetical order.</span></h4>
<p><span class="font19">root@barry:~# cat /etc/init.d/rcS</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># ! /bin/sh</span></p></li></ul>
<p><span class="font19">#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># rcS</span></p></li></ul>
<p><span class="font19">#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Call all S??* scripts in /etc/rcS.d/ in numerical/alphabetical order</span></p></li></ul>
<p><span class="font19">#</span></p>
<p><span class="font19">exec /etc/init.d/rc S</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6649"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6650"></a>15.1.5. rc scripts</span></h3></li></ul>
<p><span class="font25">Init will continue to read </span><span class="font25" style="font-weight:bold;">/etc/inittab </span><span class="font25">and meets this section on Debian Linux.</span></p>
<p><span class="font19">l0:0:wait:/etc/init.d/rc 0 l1:1:wait:/etc/init.d/rc 1 l2:2:wait:/etc/init.d/rc 2 l3:3:wait:/etc/init.d/rc 3 l4:4:wait:/etc/init.d/rc 4 l5:5:wait:/etc/init.d/rc 5 l6:6:wait:/etc/init.d/rc 6</span></p>
<p><span class="font25">On Red Hat Enterprise Linux it is identical except </span><span class="font25" style="font-weight:bold;">init.d </span><span class="font25">is </span><span class="font25" style="font-weight:bold;">rc.d</span><span class="font25">.</span></p>
<p><span class="font19">l0:0:wait:/etc/rc.d/rc 0 l1:1:wait:/etc/rc.d/rc 1 l2:2:wait:/etc/rc.d/rc 2 l3:3:wait:/etc/rc.d/rc 3 l4:4:wait:/etc/rc.d/rc 4 l5:5:wait:/etc/rc.d/rc 5 l6:6:wait:/etc/rc.d/rc 6</span></p>
<p><a name="bookmark6651"></a><span class="font25">In both cases, this means that </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">will start the rc script with the runlevel as the only parameter. Actually </span><span class="font25" style="font-weight:bold;">/etc/inittab </span><span class="font25">has fields separated by colons. The second field determines the runlevel in which this line should be executed. So in both cases, only one line of the seven will be executed, depending on the runlevel set by </span><span class="font25" style="font-weight:bold;">initdefault</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark743"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6652"></a>15.1.6. rc directories</span></h3></li></ul>
<p><a name="bookmark6653"></a><span class="font25">When you take a look any of the </span><span class="font25" style="font-weight:bold;">/etc/rcX.d/ </span><span class="font25">directories, then you will see a lot of (links to) scripts who's name start with either uppercase K or uppercase S.</span></p>
<p><span class="font19">[root@RHEL52 rc3.d]# ls -l | tail -4</span></p>
<p><span class="font19">lrwxrwxrwx 1 root root 19 Oct 11 &nbsp;2008 S98haldaemon -&gt; ../init.d/haldaemon</span></p>
<p><span class="font19">lrwxrwxrwx 1 root root 19 Oct 11 &nbsp;2008 S99firstboot -&gt; ../init.d/firstboot</span></p>
<p><span class="font19">lrwxrwxrwx 1 root root 11 Jan 21 04:16 S99local -&gt; ../rc.local</span></p>
<p><span class="font19">lrwxrwxrwx 1 root root 16 Jan 21 04:17 S99smartd -&gt; ../init.d/smartd</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">/etc/rcX.d/ </span><span class="font25">directories only contain links to scripts in </span><span class="font25" style="font-weight:bold;">/etc/init.d/</span><span class="font25">. Links allow for the script to have a different name. When entering a runlevel, all scripts that start with uppercase K or uppercase S will be started in alphabetical order. Those that start with K will be started first, with </span><span class="font25" style="font-weight:bold;">stop </span><span class="font25">as the only parameter. The remaining scripts with S will be started with </span><span class="font25" style="font-weight:bold;">start </span><span class="font25">as the only parameter.</span></p>
<p><a name="bookmark6654"></a><span class="font25"><a name="bookmark6655"></a>All this is done by the </span><span class="font25" style="font-weight:bold;">/etc/rc.d/rc </span><span class="font25">script on Red Hat and by the </span><span class="font25" style="font-weight:bold;">/etc/init.d/rc </span><span class="font25">script on Debian.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6656"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6657"></a>15.1.7. mingetty</span></h3></li></ul>
<p><span class="font7" style="font-weight:bold;">mingetty in /etc/inittab</span></p>
<p><a name="bookmark6658"></a><span class="font25"><a name="bookmark6659"></a><a name="bookmark6660"></a>Almost at the end of </span><span class="font25" style="font-weight:bold;">/etc/inittab </span><span class="font25">there is a section to start and </span><span class="font25" style="font-weight:bold;">respawn </span><span class="font25">several </span><span class="font25" style="font-weight:bold;">mingetty </span><span class="font25">daemons.</span></p>
<p><span class="font19">[root@RHEL4b ~]# grep getty /etc/inittab # Run gettys in standard runlevels 1:2345:respawn:/sbin/mingetty tty1 2:2345:respawn:/sbin/mingetty tty2 3:2345:respawn:/sbin/mingetty tty3 4:2345:respawn:/sbin/mingetty tty4 5:2345:respawn:/sbin/mingetty tty5 6:2345:respawn:/sbin/mingetty tty6</span></p>
<p><span class="font7" style="font-weight:bold;">mingetty and /bin/login</span></p>
<p><a name="bookmark6661"></a><span class="font25"><a name="bookmark6662"></a><a name="bookmark6663"></a>This </span><span class="font25" style="font-weight:bold;">/sbin/mingetty </span><span class="font25">will display a message on a virtual console and allow you to type a userid. Then it executes the </span><span class="font25" style="font-weight:bold;">/bin/login </span><span class="font25">command with that userid. The </span><span class="font25" style="font-weight:bold;">/bin/login </span><span class="font25">program will verify whether that user exists in </span><span class="font25" style="font-weight:bold;">/etc/passwd </span><span class="font25">and prompt for (and verify) a password. If the password is correct, </span><span class="font25" style="font-weight:bold;">/bin/login </span><span class="font25">passes control to the shell listed in </span><span class="font25" style="font-weight:bold;">/etc/passwd</span><span class="font25">.</span></p>
<p><span class="font7" style="font-weight:bold;">respawning mingetty</span></p>
<p><a name="bookmark6664"></a><span class="font25">The mingetty daemons are started by </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">and watched until they die (user exits the shell and is logged out). When this happens, the </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">daemon will </span><span class="font25" style="font-weight:bold;">respawn </span><span class="font25">a new mingetty. So even if you </span><span class="font25" style="font-weight:bold;">kill </span><span class="font25">a mingetty daemon, it will be restarted automatically.</span></p>
<p><span class="font25">This example shows that init respawns mingetty daemons. Look at the PID's of the last two mingetty processes.</span></p>
<p><span class="font19">[root@RHEL52 ~]# ps -C mingetty</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">PID</span></p></td><td style="vertical-align:top;">
<p><span class="font19">TTY</span></p></td><td style="vertical-align:top;">
<p><span class="font19">TIME</span></p></td><td style="vertical-align:top;">
<p><span class="font19">CMD</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">2407</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tty1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">mingetty</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2408</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tty2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mingetty</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2409</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tty3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mingetty</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2410</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tty4</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mingetty</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2411</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tty5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mingetty</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2412</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tty6</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mingetty</span></p></td></tr>
</table>
<p><a name="bookmark6665"></a><span class="font25">When we </span><span class="font25" style="font-weight:bold;">kill </span><span class="font25">the last two mingettys, then </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">will notice this and start them again (with a different PID).</span></p>
<p><span class="font19">[root@RHEL52 ~]# kill 2411 2412</span></p>
<p><span class="font19">[root@RHEL52 ~]# ps -C mingetty</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">PID</span></p></td><td style="vertical-align:top;">
<p><span class="font19">TTY</span></p></td><td style="vertical-align:top;">
<p><span class="font19">TIME</span></p></td><td style="vertical-align:top;">
<p><span class="font19">CMD</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">2407</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tty1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">mingetty</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2408</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tty2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mingetty</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2409</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tty3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mingetty</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2410</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tty4</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mingetty</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2821</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tty5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mingetty</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2824</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tty6</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mingetty</span></p></td></tr>
</table>
<p><span class="font7" style="font-weight:bold;">disabling a mingetty</span></p>
<p><a name="bookmark6666"></a><span class="font25">You can disable a mingetty for a certain tty by removing the runlevel from the second field in its line in /etc/inittab. Don't forget to tell init about the change of its configuration file with </span><span class="font25" style="font-weight:bold;">kill -1 1</span><span class="font25">.</span></p>
<p><span class="font25">The example below shows how to disable mingetty on tty3 to tty6 in runlevels 4 and 5.</span></p>
<p><span class="font19">[root@RHEL52 ~]# grep getty /etc/inittab</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Run gettys in standard runlevels</span></p></li></ul>
<p><span class="font19">1:2345:respawn:/sbin/mingetty ttyl</span></p>
<p><span class="font19">2:2345:respawn:/sbin/mingetty tty2</span></p>
<p><span class="font19">3:23:respawn:/sbin/mingetty tty3</span></p>
<p><span class="font19">4:23:respawn:/sbin/mingetty tty4</span></p>
<p><span class="font19">5:23:respawn:/sbin/mingetty tty5</span></p>
<p><span class="font19">6:23:respawn:/sbin/mingetty tty6</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6667"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6083"></a><a name="bookmark6668"></a>15.2. daemon or demon</span></h2></li></ul>
<p><a name="bookmark6669"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">daemon </span><span class="font25">is a process that runs in background, without a link to a GUI or terminal. Daemons are usually started at system boot, and stay alive until the system shuts down. In more recent technical writings, daemons are often refered to as </span><span class="font25" style="font-weight:bold;">services</span><span class="font25">.</span></p>
<p><a name="bookmark6670"></a><span class="font25">Unix </span><span class="font25" style="font-weight:bold;">daemons </span><span class="font25">are not to be confused with demons. </span><span class="font25" style="font-weight:bold;">Evi Nemeth</span><span class="font25">, co-author of the UNIX System Administration Handbook has the following to say about daemons:</span></p>
<p><span class="font25" style="font-style:italic;">Many people equate the word &quot;daemon&quot; with the word &quot;demon&quot;, implying some kind of satanic connection between UNIX and the underworld. This is an egregious misunderstanding. &quot;Daemon&quot; is actually a much older form of &quot;demon&quot;; daemons have no particular bias towards good or evil, but rather serve to help define a person's character or personality. The ancient Greeks' concept of a &quot;personal daemon&quot; was similar to the modern concept of a &quot;guardian angel&quot; ....</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6671"></a><span class="font10" style="font-weight:bold;"><a name="bookmark5730"></a><a name="bookmark6672"></a>15.3. starting and stopping daemons</span></h2></li></ul>
<p><a name="bookmark6673"></a><span class="font25">The K and S scripts are links to the real scripts in </span><span class="font25" style="font-weight:bold;">/etc/init.d/</span><span class="font25">. These can also be used when the system is running to start and stop daemons (or services). Most of them accept the following parameters: start, stop, restart, status.</span></p>
<p><span class="font25">For example in this screenshot we restart the samba daemon.</span></p>
<p><span class="font19">root@laika:~# /etc/init.d/samba restart</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">* Stopping Samba daemons... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p></li>
<li>
<p><span class="font19">* Starting Samba daemons... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p></li></ul>
<p><a name="bookmark6674"></a><span class="font25">You can achieve the same result on RHEL/Fedora with the </span><span class="font25" style="font-weight:bold;">service </span><span class="font25">command.</span></p>
<table border="1">
<tr><td colspan="3" style="vertical-align:bottom;">
<p><span class="font19">[root@RHEL4b ~]# service smb restart</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Shutting</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">down SMB services:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">[ OK ]</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Shutting</span></p></td><td style="vertical-align:top;">
<p><span class="font19">down NMB services:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">[ OK ]</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Starting</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SMB services:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">[ OK ]</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Starting</span></p></td><td style="vertical-align:top;">
<p><span class="font19">NMB services:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">[ OK ]</span></p></td></tr>
</table>
<p><a name="bookmark6675"></a><span class="font25"><a name="bookmark6676"></a>You might also want to take a look at </span><span class="font25" style="font-weight:bold;">chkconfig</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">update-rc.d</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6677"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6085"></a><a name="bookmark6678"></a>15.4. chkconfig</span></h2></li></ul>
<p><a name="bookmark6679"></a><span class="font25">The purpose of </span><span class="font25" style="font-weight:bold;">chkconfig </span><span class="font25">is to relieve system administrators of manually managing all the links and scripts in </span><span class="font25" style="font-weight:bold;">/etc/init.d </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/etc/rcX.d/</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6680"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6681"></a>15.4.1. chkconfig --list</span></h3></li></ul>
<p><span class="font25">Here we use </span><span class="font25" style="font-weight:bold;">chkconfig </span><span class="font25">to list the status of a service in the different runlevels. You can see that the </span><span class="font25" style="font-weight:bold;">crond </span><span class="font25">daemon (or service) is only activated in runlevels 2 to 5.</span></p>
<p><span class="font19">[root@RHEL52 ~]# chkconfig --list crond</span></p>
<p><span class="font19">crond &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0:off 1:off 2:on 3:on 4:on 5:on 6:off</span></p>
<p><span class="font25">When you compare the screenshot above with the one below, you can see that </span><span class="font25" style="font-weight:bold;">off </span><span class="font25">equals to a K link to the script, whereas </span><span class="font25" style="font-weight:bold;">on </span><span class="font25">equals to an S link.</span></p>
<p><span class="font19">[root@RHEL52 etc]# find ./rc?.d/ -name</span></p>
<p><span class="font19">./rc0.d/K60crond -&gt; ../init.d/crond</span></p>
<p><span class="font19">./rc1.d/K60crond -&gt; ../init.d/crond</span></p>
<p><span class="font19">./rc2.d/S90crond -&gt; ../init.d/crond</span></p>
<p><span class="font19">./rc3.d/S90crond -&gt; ../init.d/crond</span></p>
<p><span class="font19">./rc4.d/S90crond -&gt; ../init.d/crond</span></p>
<p><span class="font19">./rc5.d/S90crond -&gt; ../init.d/crond</span></p>
<p><span class="font19">./rc6.d/K60crond -&gt; ../init.d/crond</span></p>
<p><span class="font19">\*crond -exec ls -l {} \;|cut -b40-</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6682"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6683"></a>15.4.2. runlevel configuration</span></h3></li></ul>
<p><span class="font25">Here you see how to use chkconfig to disable (or enable) a service in a certain runlevel.</span></p>
<p><span class="font25">This screenshot shows how to disable </span><span class="font25" style="font-weight:bold;">crond </span><span class="font25">in runlevel 3.</span></p>
<p><span class="font19">[root@RHEL52 ~]# chkconfig --level 3 crond off</span></p>
<p><span class="font19">[root@RHEL52 ~]# chkconfig --list crond</span></p>
<p><span class="font19">crond &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0:off 1:off 2:on 3:off 4:on 5:on 6:off</span></p>
<p><span class="font25">This screenshot shows how to enable </span><span class="font25" style="font-weight:bold;">crond </span><span class="font25">in runlevels 3 and 4.</span></p>
<p><span class="font19">[root@RHEL52 ~]# chkconfig --level 34 crond on [root@RHEL52 ~]# chkconfig --list crond</span></p>
<p><span class="font19">crond &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0:off 1:off 2:on 3:on 4:on 5:on 6:off</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6684"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6685"></a>15.4.3. chkconfig configuration</span></h3></li></ul>
<p><a name="bookmark6686"></a><span class="font25">Every script in </span><span class="font25" style="font-weight:bold;">/etc/init.d/ </span><span class="font25">can have (comment) lines to tell chkconfig what to do with the service. The line with </span><span class="font25" style="font-weight:bold;"># chkconfig: </span><span class="font25">contains the runlevels in which the service should be started (2345), followed by the priority for start (90) and stop (60).</span></p>
<p><span class="font19">[root@RHEL52 ~]# head -9 /etc/init.d/crond | tail -5 # chkconfig: 2345 90 60</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># description: cron is a standard UNIX program that runs user-specified</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19"># # #</span></p></td><td style="vertical-align:top;">
<p><span class="font19">programs at periodic scheduled times. vixie cron adds a number of features to the basic UNIX cron, including better security and more powerful configuration options.</span></p></td></tr>
</table></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6687"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6688"></a>15.4.4. enable and disable services</span></h3></li></ul>
<p><span class="font25">Services can be enabled or disabled in all runlevels with one command. Runlevels 0, 1 and 6 are always stopping services (or calling the scripts with </span><span class="font25" style="font-weight:bold;">stop</span><span class="font25">) even when their name starts with uppercase S.</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[root@RHEL52 [root@RHEL52 crond</span></p>
<p><span class="font19">[root@RHEL52 [root@RHEL52 crond</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~]# chkconfig crond off</span></p>
<p><span class="font19">~]# chkconfig --list crond</span></p>
<p><span class="font19">0:off 1:off 2:off 3:off 4:off 5:off 6:off</span></p>
<p><span class="font19">~]# chkconfig crond on</span></p>
<p><span class="font19">~]# chkconfig --list crond</span></p>
<p><span class="font19">0:off 1:off 2:on &nbsp;&nbsp;&nbsp;3:on &nbsp;&nbsp;&nbsp;4:on &nbsp;&nbsp;&nbsp;5:on &nbsp;&nbsp;&nbsp;6:off</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6689"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6086"></a><a name="bookmark6690"></a>15.5. update-rc.d</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark6462"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6691"></a>15.5.1. about update-rc.d</span></h3></li></ul></li></ul>
<p><a name="bookmark6692"></a><span class="font25">The Debian equivalent of </span><span class="font25" style="font-weight:bold;">chkconfig </span><span class="font25">is called </span><span class="font25" style="font-weight:bold;">update-rc.d</span><span class="font25">. This tool is designed for use in scripts, if you prefer a graphical tool then look at </span><span class="font25" style="font-weight:bold;">bum</span><span class="font25">.</span></p>
<p><span class="font25">When there are existing links in </span><span class="font25" style="font-weight:bold;">/etc/rcX.d/ </span><span class="font25">then </span><span class="font25" style="font-weight:bold;">update-rc.d </span><span class="font25">does not do anything. This is to avoid that post installation scripts using </span><span class="font25" style="font-weight:bold;">update-rc.d </span><span class="font25">are overwriting changes made by a system administrator.</span></p>
<p><span class="font19">root@barry:~# update-rc.d cron remove</span></p>
<p><span class="font19">update-rc.d: /etc/init.d/cron exists during rc.d purge (use -f to force)</span></p>
<p><span class="font25">As you can see in the next screenshot, nothing changed for the cron daemon.</span></p>
<p><span class="font19">root@barry:~# find /etc/rc0.d/K11cron /etc/rc1.d/K11cron /etc/rc2.d/S89cron /etc/rc3.d/S89cron /etc/rc4.d/S89cron /etc/rc5.d/S89cron /etc/rc6.d/K11cron</span></p>
<p><span class="font19">/etc/rc?.d/ -name</span></p>
<p><span class="font19">-&gt; ../init.d/cron</span></p>
<p><span class="font19">-&gt; ../init.d/cron</span></p>
<p><span class="font19">-&gt; ../init.d/cron</span></p>
<p><span class="font19">-&gt; ../init.d/cron</span></p>
<p><span class="font19">-&gt; ../init.d/cron</span></p>
<p><span class="font19">-&gt; ../init.d/cron</span></p>
<p><span class="font19">-&gt; ../init.d/cron</span></p>
<div>
<p><span class="font19">'*cron' -exec ls -l {} \;|cut -b44-</span></p>
</div><br clear="all">
<ul style="list-style:none;"><li>
<h3><a name="bookmark6693"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6694"></a>15.5.2. removing a service</span></h3></li></ul>
<p><span class="font25">Here we remove </span><span class="font25" style="font-weight:bold;">cron </span><span class="font25">from all runlevels. Remember that the proper way to disable a service is to put K scripts oin all runlevels!</span></p>
<p><span class="font19">root@barry:~# update-rc.d -f cron remove</span></p>
<p><span class="font19">Removing any system startup links for /etc/init.d/cron ...</span></p>
<p><span class="font19">/etc/rc0.d/K11cron</span></p>
<p><span class="font19">/etc/rc1.d/K11cron</span></p>
<p><span class="font19">/etc/rc2.d/S89cron</span></p>
<p><span class="font19">/etc/rc3.d/S89cron</span></p>
<p><span class="font19">/etc/rc4.d/S89cron</span></p>
<p><span class="font19">/etc/rc5.d/S89cron</span></p>
<p><span class="font19">/etc/rc6.d/K11cron</span></p>
<p><span class="font19">root@barry:~# find /etc/rc?.d/ -name '*cron' -exec ls -l {} \;|cut -b44-root@barry:~#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6695"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6696"></a>15.5.3. enable a service</span></h3></li></ul>
<p><span class="font25">This screenshot shows how to use </span><span class="font25" style="font-weight:bold;">update-rc.d </span><span class="font25">to enable a service in runlevels 2, 3, 4 and 5 and disable the service in runlevels 0, 1 and 6.</span></p>
<p><span class="font19">root@barry:~# update-rc.d cron defaults</span></p>
<p><span class="font19">Adding system startup /etc/rc0.d/K20cron /etc/rc1.d/K20cron /etc/rc6.d/K20cron /etc/rc2.d/S20cron /etc/rc3.d/S20cron /etc/rc4.d/S20cron /etc/rc5.d/S20cron</span></p>
<div>
<p><span class="font19">for /etc/init.d/cron</span></p>
<p><span class="font19">-&gt; ../init.d/cron</span></p>
<p><span class="font19">-&gt; ../init.d/cron</span></p>
<p><span class="font19">-&gt; ../init.d/cron</span></p>
<p><span class="font19">-&gt; ../init.d/cron</span></p>
<p><span class="font19">-&gt; ../init.d/cron</span></p>
<p><span class="font19">-&gt; ../init.d/cron</span></p>
<p><span class="font19">-&gt; ../init.d/cron</span></p>
</div><br clear="all">
<ul style="list-style:none;"><li>
<h3><a name="bookmark6697"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6698"></a>15.5.4. customize a service</span></h3></li></ul>
<h4><a name="bookmark6699"></a><span class="font25"><a name="bookmark6700"></a>And here is an example on how to set your custom configuration for the cron daemon.</span></h4>
<p><span class="font19">root@barry:~# update-rc.d -n cron start 11 2 3 4</span></p>
<div>
<p><span class="font19">stop 89 0 1 6 .</span></p>
</div><br clear="all">
<p><span class="font19">Adding system startup /etc/rc0.d/K89cron /etc/rc1.d/K89cron /etc/rc6.d/K89cron /etc/rc2.d/S11cron /etc/rc3.d/S11cron /etc/rc4.d/S11cron /etc/rc5.d/S11cron</span></p>
<div>
<p><span class="font19">for /etc/init.d/cron</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- &gt;&nbsp;../init.d/cron</span></p></li>
<li>
<p><span class="font19">- &gt;&nbsp;../init.d/cron</span></p></li>
<li>
<p><span class="font19">- &gt;&nbsp;../init.d/cron</span></p></li>
<li>
<p><span class="font19">- &gt;&nbsp;../init.d/cron</span></p></li>
<li>
<p><span class="font19">- &gt;&nbsp;../init.d/cron</span></p></li>
<li>
<p><span class="font19">- &gt;&nbsp;../init.d/cron</span></p></li>
<li>
<p><span class="font19">- &gt;&nbsp;../init.d/cron</span></p></li></ul>
</div><br clear="all">
<ul style="list-style:none;"><li>
<h2><a name="bookmark6701"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6087"></a><a name="bookmark6702"></a>15.6. bum</span></h2></li></ul>
<h4><a name="bookmark6703"></a><span class="font25"><a name="bookmark6704"></a><a name="bookmark6705"></a>This screenshot shows </span><span class="font25" style="font-weight:bold;">bum </span><span class="font25">in advanced mode.</span></h4>
<div><img src="linux_guide_files/The Complete Linux Guide-140.jpg" alt="" style="width:397pt;height:239pt;">
</div><br clear="all">
<ul style="list-style:none;"><li>
<h2><a name="bookmark6706"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6088"></a><a name="bookmark6707"></a>15.7. runlevels</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark6708"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6709"></a>15.7.1. display the runlevel</span></h3></li></ul></li></ul>
<p><a name="bookmark6710"></a><span class="font25"><a name="bookmark6711"></a>You can see your current runlevel with the </span><span class="font25" style="font-weight:bold;">runlevel </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">who -r </span><span class="font25">commands.</span></p>
<p><span class="font25">The runlevel command is typical Linux and will output the previous and the current runlevel. If there was no previous runlevel, then it will mark it with the letter N.</span></p>
<p><span class="font19">[root@RHEL4b ~]# runlevel</span></p>
<p><span class="font19">N 3</span></p>
<p><span class="font25">The history of </span><span class="font25" style="font-weight:bold;">who -r </span><span class="font25">dates back to Seventies Unix, it still works on Linux.</span></p>
<p><span class="font19">[root@RHEL4b ~]# who -r</span></p>
<p><span class="font19">run-level 3 Jul 28 09:15 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last=S</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6712"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6713"></a>15.7.2. changing the runlevel</span></h3></li></ul>
<p><a name="bookmark6714"></a><span class="font25"><a name="bookmark6715"></a>You can switch to another runlevel with the </span><span class="font25" style="font-weight:bold;">telinit </span><span class="font25">command. On Linux </span><span class="font25" style="font-weight:bold;">/sbin/telinit </span><span class="font25">is usually a (hard) link to </span><span class="font25" style="font-weight:bold;">/sbin/init</span><span class="font25">.</span></p>
<p><span class="font25">This screenshot shows how to switch from runlevel 2 to runlevel 3 without reboot.</span></p>
<p><span class="font19">root@barry:~# runlevel</span></p>
<p><span class="font19">N 2</span></p>
<p><span class="font19">root@barry:~# init 3 root@barry:~# runlevel 2 3</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6716"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6717"></a>15.7.3. /sbin/shutdown</span></h3></li></ul>
<p><a name="bookmark6718"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">shutdown </span><span class="font25">command is used to properly shut down a system.</span></p>
<p><span class="font25">Common switches used with </span><span class="font25" style="font-weight:bold;">shutdown </span><span class="font25">are </span><span class="font25" style="font-weight:bold;">-a</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">-t</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">-h </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">-r</span><span class="font25">.</span></p>
<p><a name="bookmark6719"></a><span class="font25"><a name="bookmark6720"></a>The </span><span class="font25" style="font-weight:bold;">-a </span><span class="font25">switch forces </span><span class="font25" style="font-weight:bold;">/sbin/shutdown </span><span class="font25">to use </span><span class="font25" style="font-weight:bold;">/etc/shutdown.allow</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">-t </span><span class="font25">switch is used to define the number of seconds between the sending of the </span><span class="font25" style="font-weight:bold;">TERM </span><span class="font25">signal and the </span><span class="font25" style="font-weight:bold;">KILL </span><span class="font25">signal. The </span><span class="font25" style="font-weight:bold;">-h </span><span class="font25">switch halts the system instead of changing to runlevel 1. The </span><span class="font25" style="font-weight:bold;">-r </span><span class="font25">switch tells </span><span class="font25" style="font-weight:bold;">/sbin/shutdown </span><span class="font25">to reboot after shutting down.</span></p>
<p><span class="font25">This screenshot shows how to use </span><span class="font25" style="font-weight:bold;">shutdown </span><span class="font25">with five seconds between TERM and KILL signals.</span></p>
<p><span class="font19">root@barry:~# shutdown -t5 -h now</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">now </span><span class="font25">is the time argument. This can be </span><span class="font25" style="font-weight:bold;">+m </span><span class="font25">for the number of minutes to wait before shutting down (with </span><span class="font25" style="font-weight:bold;">now </span><span class="font25">as an alias for </span><span class="font25" style="font-weight:bold;">+0</span><span class="font25">. The command will also accept hh:mm instead of </span><span class="font25" style="font-weight:bold;">+m</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6721"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6722"></a>15.7.4. halt, reboot and poweroff</span></h3></li></ul>
<p><span class="font25">The binary </span><span class="font25" style="font-weight:bold;">/sbin/reboot </span><span class="font25">is the same as </span><span class="font25" style="font-weight:bold;">/sbin/halt </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/sbin/poweroff</span><span class="font25">. Depending on the name we use to call the command, it can behave differently.</span></p>
<p><a name="bookmark6723"></a><span class="font25"><a name="bookmark6724"></a><a name="bookmark6725"></a>When in runlevel 0 or 6 </span><span class="font25" style="font-weight:bold;">halt</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">reboot </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">poweroff </span><span class="font25">will tell the kernel to </span><span class="font25" style="font-weight:bold;">halt</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">reboot </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">poweroff </span><span class="font25">the system.</span></p>
<p><span class="font25">When not in runlevel 0 or 6, typing </span><span class="font25" style="font-weight:bold;">reboot </span><span class="font25">as root actually calls the </span><span class="font25" style="font-weight:bold;">shutdown </span><span class="font25">command with the </span><span class="font25" style="font-weight:bold;">-r </span><span class="font25">switch and typing </span><span class="font25" style="font-weight:bold;">poweroff </span><span class="font25">will switch off the power when halting the system.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6726"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6727"></a>15.7.5. /var/log/wtmp</span></h3></li></ul>
<p><a name="bookmark6728"></a><span class="font25" style="font-weight:bold;"><a name="bookmark6729"></a>halt</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">reboot </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">poweroff </span><span class="font25">all write to </span><span class="font25" style="font-weight:bold;">/var/log/wtmp</span><span class="font25">. To look at </span><span class="font25" style="font-weight:bold;">/var/log/wtmp</span><span class="font25">, we need to use th </span><span class="font25" style="font-weight:bold;">last</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL52 ~]# last | grep reboot</span></p>
<p><span class="font19">reboot &nbsp;&nbsp;system boot &nbsp;2.6.18-128.el5 &nbsp;&nbsp;Fri May 29 11:44 &nbsp;&nbsp;(192+05:01)</span></p>
<p><span class="font19">reboot system boot 2.6.18-128.el5 Wed May 27 12:10 &nbsp;&nbsp;&nbsp;(06:49)</span></p>
<p><span class="font19">reboot &nbsp;&nbsp;system boot &nbsp;2.6.18-128.el5 &nbsp;&nbsp;Mon May 25 19:34 &nbsp;&nbsp;(1+15:59)</span></p>
<p><span class="font19">reboot &nbsp;&nbsp;system boot &nbsp;2.6.18-128.el5 &nbsp;&nbsp;Mon Feb &nbsp;9 13:20 &nbsp;&nbsp;(106+21:13)</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6730"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6731"></a>15.7.6. Ctrl-Alt-Del</span></h3></li></ul>
<p><a name="bookmark6732"></a><span class="font25"><a name="bookmark6733"></a>When </span><span class="font25" style="font-weight:bold;">rc </span><span class="font25">is finished starting all those scripts, </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">will continue to read /etc/inittab. The next line is about what to do when the user hits </span><span class="font25" style="font-weight:bold;">Ctrl-Alt-Delete </span><span class="font25">on the keyboard.</span></p>
<p><span class="font25">Here is what Debian 4.0 does.</span></p>
<p><span class="font19">root@barry:~# grep -i ctrl /etc/inittab</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># What to do when CTRL-ALT-DEL is pressed.</span></p></li></ul>
<p><span class="font19">ca:12345:ctrlaltdel:/sbin/shutdown -t1 -a -r now</span></p>
<p><span class="font25">Which is very similar to the default Red Hat Enterprise Linux 5.2 action.</span></p>
<p><span class="font19">[root@RHEL52 ~]# grep -i ctrl /etc/inittab</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Trap CTRL-ALT-DELETE</span></p></li></ul>
<p><span class="font19">ca::ctrlaltdel:/sbin/shutdown -t3 -r now</span></p>
<p><a name="bookmark6734"></a><span class="font25">One noticable difference is that Debian forces shutdown to use </span><span class="font25" style="font-weight:bold;">/etc/shutdown.allow</span><span class="font25">, where Red Hat allows everyone to invoke </span><span class="font25" style="font-weight:bold;">shutdown </span><span class="font25">pressing </span><span class="font25" style="font-weight:bold;">Ctrl-Alt-Delete</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6735"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6736"></a>15.7.7. UPS and loss of power</span></h3></li></ul>
<p><span class="font19">[root@RHEL52 ~]# grep *p /etc/inittab</span></p>
<p><span class="font19">pf::powerfail:/sbin/shutdown -f -h +2 &quot;Power Failure; System Shutting Down&quot; pr:12345:powerokwait:/sbin/shutdown -c &quot;Power Restored; Shutdown Cancelled&quot;</span></p>
<p><a name="bookmark6737"></a><span class="font25">It will read commands on what to execute in case of </span><span class="font25" style="font-weight:bold;">powerfailure</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">powerok </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">Ctrl-Alt-Delete</span><span class="font25">. The init process never stops keeping an eye on power failures and that triple key combo.</span></p>
<p><span class="font19">root@barry:~# grep *p /etc/inittab pf::powerwait:/etc/init.d/powerfail start pn::powerfailnow:/etc/init.d/powerfail now po::powerokwait:/etc/init.d/powerfail stop</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6738"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6089"></a><a name="bookmark6739"></a>15.8. systemd</span></h2></li></ul>
<h4><a name="bookmark6740"></a><span class="font25"><a name="bookmark6741"></a>It is likely that </span><span class="font25" style="font-weight:bold;">systemd </span><span class="font25">will replace all the standard init/runlevel/rc functionality. Both Red Hat and Debian have decided in 2014 that </span><span class="font25" style="font-weight:bold;">systemd </span><span class="font25">will be replacing </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">in future releases (RHEL7/CentOS7 and Debian 8).</span></h4>
<h4><a name="bookmark6742"></a><span class="font25"><a name="bookmark6743"></a>The screenshot below shows </span><span class="font25" style="font-weight:bold;">systemd </span><span class="font25">running as </span><span class="font25" style="font-weight:bold;">pid 1 </span><span class="font25">on RHEL7.</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[root@rhel7</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~]# ps</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">fax | grep systemd | cut -c1-76</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">1 ?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Ss</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:01</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/usr/lib/systemd/systemd --switched-root --system</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">505 ?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Ss</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/usr/lib/systemd/systemd-journald</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">545 ?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Ss</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/usr/lib/systemd/systemd-udevd</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">670 ?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Ss</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/usr/lib/systemd/systemd-logind</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">677 ?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Ssl</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/bin/dbus-daemon --system --address=systemd: --no</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2662 pts/1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">S+</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">\_ grep --color=auto systemd</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">[root@rhel7</span></p></td><td style="vertical-align:top;">
<p><span class="font19">~]#</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
</table>
<h4><a name="bookmark6744"></a><span class="font25"><a name="bookmark6745"></a>Debian 8 (not yet released in September 2014) uses parts of </span><span class="font25" style="font-weight:bold;">systemd</span><span class="font25">, but still has </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">as </span><span class="font25" style="font-weight:bold;">pid 1</span><span class="font25">.</span></h4>
<div>
<p><span class="font19">root@debian8:~# ps</span></p>
<p><a href="#bookmark6746"><span class="font19">2042 ?</span></a></p>
<p><a href="#bookmark6747"><span class="font19">10127 pts/4</span></a></p>
<p><a href="#bookmark6748"><span class="font19">2777 ?</span></a></p>
<p><span class="font19">root@debian8:~#</span></p>
</div><br clear="all">
<p><span class="font19">fax | grep systemd</span></p>
<p><span class="font19">0:00 /sbin/cgmanager --daemon -m name=systemd</span></p>
<p><span class="font19">0:00 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\_ grep systemd</span></p>
<p><span class="font19">0:00 /lib/systemd/systemd-logind</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6749"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6750"></a>15.8.1. systemd targets</span></h3></li></ul>
<p><span class="font25">The first command to learn is </span><span class="font25" style="font-weight:bold;">systemctl list-units --type=target </span><span class="font25">(or the shorter version </span><span class="font25" style="font-weight:bold;">systemctl -t target</span><span class="font25">). It will show you the different targets on the system.</span></p>
<table border="1">
<tr><td colspan="5" style="vertical-align:bottom;">
<p><span class="font19">[root@rhel7 ~]# systemctl list-units --type=target</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">UNIT</span></p></td><td style="vertical-align:top;">
<p><span class="font19">LOAD</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ACTIVE</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SUB</span></p></td><td style="vertical-align:top;">
<p><span class="font19">DESCRIPTION</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">basic.target</span></p></td><td style="vertical-align:top;">
<p><span class="font19">loaded</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Basic System</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">cryptsetup.target</span></p></td><td style="vertical-align:top;">
<p><span class="font19">loaded</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Encrypted Volumes</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">getty.target</span></p></td><td style="vertical-align:top;">
<p><span class="font19">loaded</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Login Prompts</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">graphical.target</span></p></td><td style="vertical-align:top;">
<p><span class="font19">loaded</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Graphical Interface</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">local-fs-pre.target</span></p></td><td style="vertical-align:top;">
<p><span class="font19">loaded</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Local File Systems (Pre)</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">local-fs.target</span></p></td><td style="vertical-align:top;">
<p><span class="font19">loaded</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Local File Systems</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">multi-user.target</span></p></td><td style="vertical-align:top;">
<p><span class="font19">loaded</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Multi-User System</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">network.target</span></p></td><td style="vertical-align:top;">
<p><span class="font19">loaded</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Network</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">nfs.target</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">loaded</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">active</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">active</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Network File System Server</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">paths.target</span></p></td><td style="vertical-align:top;">
<p><span class="font19">loaded</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Paths</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">remote-fs.target</span></p></td><td style="vertical-align:top;">
<p><span class="font19">loaded</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Remote File Systems</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">slices.target</span></p></td><td style="vertical-align:top;">
<p><span class="font19">loaded</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Slices</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">sockets.target</span></p></td><td style="vertical-align:top;">
<p><span class="font19">loaded</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Sockets</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">swap.target</span></p></td><td style="vertical-align:top;">
<p><span class="font19">loaded</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Swap</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">sysinit.target</span></p></td><td style="vertical-align:top;">
<p><span class="font19">loaded</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">System Initialization</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">timers.target</span></p></td><td style="vertical-align:top;">
<p><span class="font19">loaded</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Timers</span></p></td></tr>
</table>
<p><span class="font19">LOAD = Reflects whether the unit definition was properly loaded.</span></p>
<p><span class="font19">ACTIVE = The high-level unit activation state, i.e. generalization of SUB. SUB = The low-level unit activation state, values depend on unit type.</span></p>
<p><span class="font19">16 loaded units listed. Pass --all to see loaded but inactive units, too. To show all installed unit files use 'systemctl list-unit-files'.</span></p>
<p><span class="font19">[root@rhel7 ~]#</span></p>
<p><span class="font25">Targets are the replacement of runlevels and define specific points to reach when booting the system. For example the </span><span class="font25" style="font-weight:bold;">graphical.target </span><span class="font25">is reached when you get a graphical interface, and the </span><span class="font25" style="font-weight:bold;">nfs.target </span><span class="font25">requires a running nfs server.</span></p>
<p><span class="font25">To switch to a target (for example </span><span class="font25" style="font-weight:bold;">multi-user.target</span><span class="font25">), we now use </span><span class="font25" style="font-weight:bold;">systemctl isolate </span><span class="font25">(instead of the equivalent </span><span class="font25" style="font-weight:bold;">init 3 </span><span class="font25">to change the runlevel).</span></p>
<p><span class="font19">[root@rhel7 ~]# ps fax | wc -l 169</span></p>
<p><span class="font19">[root@rhel7 ~]# systemctl isolate multi-user.target</span></p>
<p><span class="font19">[root@rhel7 ~]# ps fax | wc -l 129</span></p>
<p><span class="font19">[root@rhel7 ~]#</span></p>
<p><span class="font25">To change the default target, we again use this </span><span class="font25" style="font-weight:bold;">systemctl </span><span class="font25">command (instead of editing the </span><span class="font25" style="font-weight:bold;">/etc/inittab </span><span class="font25">file).</span></p>
<p><span class="font19">[root@rhel7 ~]# systemctl enable multi-user.target --force</span></p>
<p><span class="font19">rm '/etc/systemd/system/default.target'</span></p>
<p><span class="font19">ln -s '/usr/lib/systemd/system/multi-user.target' '/etc/systemd/system/default\ .target'</span></p>
<p><span class="font19">[root@rhel7 ~]#</span></p>
<p><span class="font25">This command removed the file </span><span class="font25" style="font-weight:bold;">/etc/systemd/system/default.target </span><span class="font25">and replaced it with a symbolic link to the </span><span class="font25" style="font-weight:bold;">multi-user-.target </span><span class="font25">target.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6751"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6752"></a>15.8.2. systemd dependencies</span></h3></li></ul>
<h4><a name="bookmark6753"></a><span class="font25"><a name="bookmark6754"></a>Dependencies are no longer defined by alfabetical order of running scripts, but by configuration in </span><span class="font25" style="font-weight:bold;">/etc/systemd/system/</span><span class="font25">. For example here are the required services for the </span><span class="font25" style="font-weight:bold;">multi-user.target </span><span class="font25">on Red Hat Enterprise 7.</span></h4>
<table border="1">
<tr><td colspan="3" style="vertical-align:bottom;">
<p><span class="font19">[root@rhel7 ~]# ls /etc/systemd/system/multi-user.target.wants/</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">abrt-ccpp.service abrtd.service</span></p></td><td style="vertical-align:top;">
<p><span class="font19">hypervkvpd.service hypervvssd.service</span></p></td><td style="vertical-align:top;">
<p><span class="font19">postfix.service remote-fs.target</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">abrt-oops.service</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">irqbalance.service</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">rhsmcertd.service</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">abrt-vmcore.service</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ksm.service</span></p></td><td style="vertical-align:top;">
<p><span class="font19">rngd.service</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">abrt-xorg.service</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ksmtuned.service</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">rpcbind.service</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">atd.service</span></p></td><td style="vertical-align:top;">
<p><span class="font19">libstoragemgmt.service</span></p></td><td style="vertical-align:top;">
<p><span class="font19">rsyslog.service</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">auditd.service</span></p></td><td style="vertical-align:top;">
<p><span class="font19">libvirtd.service</span></p></td><td style="vertical-align:top;">
<p><span class="font19">smartd.service</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">avahi-daemon.service</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mdmonitor.service</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sshd.service</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">chronyd.service</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ModemManager.service</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sysstat.service</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">crond.service</span></p></td><td style="vertical-align:top;">
<p><span class="font19">NetworkManager.service</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tuned.service</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">cups.path [root@rhel7 ~]#</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nfs.target</span></p></td><td style="vertical-align:top;">
<p><span class="font19">vmtoolsd.service</span></p></td></tr>
</table>
<h4><a name="bookmark6755"></a><span class="font25"><a name="bookmark6756"></a>Debian8 is not fully migrated yet.</span></h4>
<p><span class="font19">root@debian8:~# ls /etc/systemd/system/multi-user.target.wants/ anacron.service &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;binfmt-support.service pppd-dns.service ssh.service</span></p>
<p><span class="font19">atd.service &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fancontrol.service &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remote-fs.target</span></p>
<p><span class="font19">avahi-daemon.service Im-sensors.service &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rsyslog.service</span></p>
<h4><a name="bookmark6757"></a><span class="font25"><a name="bookmark6758"></a>Typical </span><span class="font25" style="font-weight:bold;">rc scripts </span><span class="font25">are replaced with services. Issue the </span><span class="font25" style="font-weight:bold;">systemctl list-units -t service --all </span><span class="font25">(or </span><span class="font25" style="font-weight:bold;">systemctl -at service</span><span class="font25">) to get a list of all services on your system.</span></h4>
<p><span class="font19">[root@rhel7 ~]# systemctl -at service | head -5 | column -t | cut -c1-78</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">UNIT</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">LOAD</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ACTIVE</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SUB</span></p></td><td colspan="3" style="vertical-align:bottom;">
<p><span class="font19">DESCRIPTION</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">abrt-ccpp.service</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">loaded</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">active</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">exited</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Install</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ABRT</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">coredump</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">abrt-oops.service</span></p></td><td style="vertical-align:top;">
<p><span class="font19">loaded</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">running</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ABRT</span></p></td><td style="vertical-align:top;">
<p><span class="font19">kernel</span></p></td><td style="vertical-align:top;">
<p><span class="font19">log</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">abrt-vmcore.service</span></p></td><td style="vertical-align:top;">
<p><span class="font19">loaded</span></p></td><td style="vertical-align:top;">
<p><span class="font19">inactive</span></p></td><td style="vertical-align:top;">
<p><span class="font19">dead</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Harvest</span></p></td><td style="vertical-align:top;">
<p><span class="font19">vmcores</span></p></td><td style="vertical-align:top;">
<p><span class="font19">for</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">abrt-xorg.service</span></p></td><td style="vertical-align:top;">
<p><span class="font19">loaded</span></p></td><td style="vertical-align:top;">
<p><span class="font19">active</span></p></td><td style="vertical-align:top;">
<p><span class="font19">running</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ABRT</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Xorg</span></p></td><td style="vertical-align:top;">
<p><span class="font19">log</span></p></td></tr>
</table>
<p><span class="font19">[root@rhel7 ~]#</span></p>
<h4><a name="bookmark6759"></a><span class="font25"><a name="bookmark6760"></a>And here an example on how to see the status of the </span><span class="font25" style="font-weight:bold;">sshd </span><span class="font25">service.</span></h4>
<p><span class="font19">[root@rhel7 ~]# systemctl status sshd.service sshd.service - OpenSSH server daemon</span></p>
<p><span class="font19">Loaded: loaded (/usr/lib/systemd/system/sshd.service; enabled)</span></p>
<p><span class="font19">Active: active (running) since Wed 2014-09-10 13:42:21 CEST; 55min ago Main PID: 1400 (sshd)</span></p>
<p><span class="font19">CGroup: /system.slice/sshd.service</span></p>
<p><span class="font19">--1400 /usr/sbin/sshd -D</span></p>
<p><span class="font19">Sep 10 13:42:21 rhel7 systemd[1]: Started OpenSSH server daemon.</span></p>
<p><span class="font19">Sep 10 13:42:21 rhel7 sshd[1400]: Server listening on 0.0.0.0 port 22.</span></p>
<p><span class="font19">Sep 10 13:42:21 rhel7 sshd[1400]: Server listening on :: port 22. [root@rhel7 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6761"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6762"></a>15.8.3. systemd services</span></h3></li></ul>
<h4><a name="bookmark6763"></a><span class="font25"><a name="bookmark6764"></a>The </span><span class="font25" style="font-weight:bold;">chkconfig </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">service </span><span class="font25">commands are considered 'legacy'. They are replaced with </span><span class="font25" style="font-weight:bold;">systemctl</span><span class="font25">.</span></h4>
<h4><a name="bookmark6765"></a><span class="font25"><a name="bookmark6766"></a>This screenshot shows the new way to start and stop a service.</span></h4>
<p><span class="font19">[root@rhel7 ~]# systemctl start crond.service</span></p>
<p><span class="font19">[root@rhel7 ~]# systemctl show crond.service | grep State</span></p>
<p><span class="font19">LoadState=loaded</span></p>
<p><span class="font19">ActiveState=active</span></p>
<p><span class="font19">SubState=running</span></p>
<p><span class="font19">UnitFileState=enabled</span></p>
<p><span class="font19">[root@rhel7 ~]# systemctl stop crond.service</span></p>
<p><span class="font19">[root@rhel7 ~]# systemctl show crond.service | grep State</span></p>
<p><span class="font19">LoadState=loaded</span></p>
<p><span class="font19">ActiveState=inactive</span></p>
<p><span class="font19">SubState=dead</span></p>
<p><span class="font19">UnitFileState=enabled [root@rhel7 ~]#</span></p>
<h4><a name="bookmark6767"></a><span class="font25"><a name="bookmark6768"></a>And here is the new way to stop and disable a service.</span></h4>
<p><span class="font19">[root@rhel7 ~]# systemctl stop crond.service</span></p>
<p><span class="font19">[root@rhel7 ~]# systemctl disable crond.service</span></p>
<p><span class="font19">rm '/etc/systemd/system/multi-user.target.wants/crond.service'</span></p>
<p><span class="font19">[root@rhel7 ~]# systemctl show crond.service | grep State</span></p>
<p><span class="font19">LoadState=loaded</span></p>
<p><span class="font19">ActiveState=inactive</span></p>
<p><span class="font19">SubState=dead</span></p>
<p><span class="font19">UnitFileState=disabled [root@rhel7 ~]#</span></p>
<h4><a name="bookmark6769"></a><span class="font25"><a name="bookmark6770"></a>This screenshot shows how to enable and start the service again.</span></h4>
<p><span class="font19">[root@rhel7 ~]# systemctl enable crond.service</span></p>
<p><span class="font19">ln -s '/usr/lib/systemd/system/crond.service' '/etc/systemd/system/multi-user.\ target.wants/crond.service' [root@rhel7 ~]# systemctl start crond.service</span></p>
<p><span class="font19">[root@rhel7 ~]# systemctl show crond.service | grep State</span></p>
<p><span class="font19">LoadState=loaded</span></p>
<p><span class="font19">ActiveState=active</span></p>
<p><span class="font19">SubState=running</span></p>
<p><span class="font19">UnitFileState=enabled</span></p>
<p><span class="font19">[root@rhel7 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6771"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6772"></a>15.8.4. systemd signalling</span></h3></li></ul>
<h4><a name="bookmark6773"></a><span class="font25"><a name="bookmark6774"></a>You can also use </span><span class="font25" style="font-weight:bold;">systemd </span><span class="font25">to </span><span class="font25" style="font-weight:bold;">kill </span><span class="font25">problematic services.</span></h4>
<p><span class="font19">[root@rhel7 ~]# systemctl show crond.service | grep State</span></p>
<p><span class="font19">LoadState=loaded</span></p>
<p><span class="font19">ActiveState=active</span></p>
<p><span class="font19">SubState=running</span></p>
<p><span class="font19">UnitFileState=enabled</span></p>
<p><span class="font19">[root@rhel7 ~]# systemctl kill -s SIGKILL crond.service</span></p>
<p><span class="font19">[root@rhel7 ~]# systemctl show crond.service | grep State</span></p>
<p><span class="font19">LoadState=loaded</span></p>
<p><span class="font19">ActiveState=failed</span></p>
<p><span class="font19">SubState=failed</span></p>
<p><span class="font19">UnitFileState=enabled [root@rhel7 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6775"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6776"></a>15.8.5. systemd shutdown</span></h3></li></ul>
<h4><a name="bookmark6777"></a><span class="font25"><a name="bookmark6778"></a><a name="bookmark6779"></a>The </span><span class="font25" style="font-weight:bold;">poweroff</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">halt </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">reboot </span><span class="font25">commands are considered legacy now and are handeld by </span><span class="font25" style="font-weight:bold;">systemctl</span><span class="font25">. The table below shows the legacy commands on the left and their new </span><span class="font25" style="font-weight:bold;">systemd </span><span class="font25">equivalent on the right.</span></h4>
<p><span class="font25" style="font-weight:bold;">Table 15.1. systemd power management</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font24" style="font-weight:bold;">legacy command</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24" style="font-weight:bold;">systemd command</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">poweroff</span></p></td><td style="vertical-align:top;">
<p><span class="font24">systemctl poweroff</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">reboot</span></p></td><td style="vertical-align:top;">
<p><span class="font24">systemctl reboot</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">halt</span></p></td><td style="vertical-align:top;">
<p><span class="font24">systemctl halt</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">pm-suspend</span></p></td><td style="vertical-align:top;">
<p><span class="font24">systemctl suspend</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">pm-hibernate</span></p></td><td style="vertical-align:top;">
<p><span class="font24">systemctl hibernate</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6780"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6781"></a>15.8.6. remote systemd</span></h3></li></ul>
<h4><a name="bookmark6782"></a><span class="font25"><a name="bookmark6783"></a>The </span><span class="font25" style="font-weight:bold;">systemctl </span><span class="font25">utility has a buil-in remote control providing there is an </span><span class="font25" style="font-weight:bold;">ssh daemon </span><span class="font25">running on the remote system.</span></h4>
<h4><a name="bookmark6784"></a><span class="font25"><a name="bookmark6785"></a>This screenshot shows how to use </span><span class="font25" style="font-weight:bold;">systemctl </span><span class="font25">to verify a service on an other RHEL server.</span></h4>
<p><span class="font19">[root@rhel7 ~]# </span><span class="font19" style="font-weight:bold;">systemctl -H </span><a href="mailto:root@192.168.1.65"><span class="font19" style="font-weight:bold;">root@192.168.1.65</span></a><span class="font19" style="font-weight:bold;"> status sshd</span></p>
<p><span class="font19">root@192.168.1.65's password:</span></p>
<p><span class="font19">sshd.service - OpenSSH server daemon</span></p>
<p><span class="font19">Loaded: loaded (/usr/lib/systemd/system/sshd.service; enabled)</span></p>
<p><span class="font19">Active: active (running) since Thu 2014-09-11 13:04:10 CEST; 16min ago</span></p>
<p><span class="font19">Process: 1328 ExecStartPre=/usr/sbin/sshd-keygen (code=exited, status=0/SUCCE\ SS)</span></p>
<p><span class="font19">Main PID: 1363 (sshd) CGroup: /system.slice/sshd.service [root@rhel7 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6786"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6787"></a>15.8.7. there is more systemd</span></h3></li></ul>
<h4><a name="bookmark6788"></a><span class="font25"><a name="bookmark6789"></a>There are other tools...</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">systemd-analyze</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">systemd-loginctl</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">systemd-ask-password</span></p></td><td style="vertical-align:top;">
<p><span class="font19">systemd-machine-id-setup</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">systemd-cat</span></p></td><td style="vertical-align:top;">
<p><span class="font19">systemd-notify</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">systemd-cgls</span></p></td><td style="vertical-align:top;">
<p><span class="font19">systemd-nspawn</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">systemd-cgtop</span></p></td><td style="vertical-align:top;">
<p><span class="font19">systemd-run</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">systemd-coredumpctl</span></p></td><td style="vertical-align:top;">
<p><span class="font19">systemd-stdio-bridge</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">systemd-delta</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">systemd-sysv-convert</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">systemd-detect-virt</span></p></td><td style="vertical-align:top;">
<p><span class="font19">systemd-tmpfiles</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">systemd-inhibit</span></p></td><td style="vertical-align:top;">
<p><span class="font19">systemd-tty-ask-password-agent</span></p></td></tr>
</table>
<h4><a name="bookmark6790"></a><span class="font25"><a name="bookmark6791"></a>For example </span><span class="font25" style="font-weight:bold;">systemd-analyze blame </span><span class="font25">will give you an overview of the time it took for each service to boot.</span></h4>
<p><span class="font19">[root@rhel7 ~]# systemd-analyze blame | head</span></p>
<p><span class="font19">1.977s firewalld.service</span></p>
<p><span class="font19">1.096s tuned.service</span></p>
<p><span class="font19">993ms postfix.service</span></p>
<p><span class="font19">939ms iprinit.service</span></p>
<p><span class="font19">925ms vboxadd-x11.service</span></p>
<p><span class="font19">880ms firstboot-graphical.service</span></p>
<p><span class="font19">839ms accounts-daemon.service</span></p>
<p><span class="font19">829ms network.service</span></p>
<p><span class="font19">822ms iprupdate.service</span></p>
<p><span class="font19">795ms boot.mount</span></p>
<p><span class="font19">[root@rhel7 ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6792"></a><span class="font10" style="font-weight:bold;"><a name="bookmark1576"></a><a name="bookmark6793"></a>15.9. practice: init</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Change </span><span class="font25" style="font-weight:bold;">/etc/inittab </span><span class="font25">so that only two mingetty's are respawned. Kill the other </span><span class="font25" style="font-weight:bold;">mingetty's </span><span class="font25">and verify that they don't come back.</span></p></li>
<li>
<p><span class="font25">2. Use the Red Hat Enterprise Linux virtual machine. Go to runlevel 5, display the current and previous runlevel, then go back to runlevel 3.</span></p></li>
<li>
<p><span class="font25">3. Is the sysinit script on your computers setting or changing the PATH environment variable ?</span></p></li>
<li>
<p><span class="font25">4. List all init.d scripts that are started in runlevel 2.</span></p></li>
<li>
<p><span class="font25">5. Write a script that acts like a daemon script in </span><span class="font25" style="font-weight:bold;">/etc/init.d/</span><span class="font25">. It should have a case statement to act on start/stop/restart and status. Test the script!</span></p></li>
<li>
<p><span class="font25">6. Use </span><span class="font25" style="font-weight:bold;">chkconfig </span><span class="font25">to setup your script to start in runlevels 3,4 and 5, and to stop in any other runlevel.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6794"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6091"></a><a name="bookmark6795"></a>15.10. solution : init</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Change </span><span class="font25" style="font-weight:bold;">/etc/inittab </span><span class="font25">so that only two mingetty's are respawned. Kill the other </span><span class="font25" style="font-weight:bold;">mingetty's </span><span class="font25">and verify that they don't come back.</span></p></li></ul>
<p><span class="font25">Killing the mingetty's will result in init respawning them. You can edit </span><span class="font25" style="font-weight:bold;">/etc/inittab </span><span class="font25">so it looks like the screenshot below. Don't forget to also run </span><span class="font25" style="font-weight:bold;">kill -1 1</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL5 ~]# grep tty /etc/inittab</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Run gettys in standard runlevels</span></p></li></ul>
<p><span class="font19">1:2345:respawn:/sbin/mingetty tty1</span></p>
<p><span class="font19">2:2345:respawn:/sbin/mingetty tty2</span></p>
<p><span class="font19">3:2:respawn:/sbin/mingetty tty3</span></p>
<p><span class="font19">4:2:respawn:/sbin/mingetty tty4</span></p>
<p><span class="font19">5:2:respawn:/sbin/mingetty tty5</span></p>
<p><span class="font19">6:2:respawn:/sbin/mingetty tty6 [root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Use the Red Hat Enterprise Linux virtual machine. Go to runlevel 5, display the current and previous runlevel, then go back to runlevel 3.</span></p></li></ul>
<p><span class="font19">init 5 (watch the console for the change taking place) runlevel</span></p>
<p><span class="font19">init 3 (again you can follow this on the console)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Is the sysinit script on your computers setting or changing the PATH environment variable ?</span></p></li></ul>
<p><span class="font25">On Red Hat, grep for PATH in </span><span class="font25" style="font-weight:bold;">/etc/rc.sysinit</span><span class="font25">, on Debian/Ubuntu check </span><span class="font25" style="font-weight:bold;">/etc/rc.local </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/ etc/ini.t/rc.local</span><span class="font25">. The answer is probably no, but on RHEL5 the </span><span class="font25" style="font-weight:bold;">rc.sysinit </span><span class="font25">script does set the HOSTNAME variable.</span></p>
<p><span class="font19">[root@RHEL5 etc]# grep HOSTNAME rc.sysinit</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. List all init.d scripts that are started in runlevel 2.</span></p></li></ul>
<p><span class="font19">root@RHEL5 ~# chkconfig --list | grep '2:on'</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Write a script that acts like a daemon script in </span><span class="font25" style="font-weight:bold;">/etc/init.d/</span><span class="font25">. It should have a case statement to act on start/stop/restart and status. Test the script!</span></p></li></ul>
<p><span class="font25">The script could look something like this.</span></p>
<p><span class="font19">#!/bin/bash</span></p>
<p><span class="font19">#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># chkconfig: 345 99 01</span></p></li>
<li>
<p><span class="font19"># description: pold demo script</span></p></li></ul>
<p><span class="font19">#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># /etc/init.d/pold</span></p></li></ul>
<p><span class="font19">#</span></p>
<p><span class="font19">case &quot;$1&quot; in start)</span></p>
<p><span class="font19">echo -n &quot;Starting pold...&quot;</span></p>
<p><span class="font19">sleep 1;</span></p>
<p><span class="font19">touch /var/lock/subsys/pold echo &quot;done.&quot;</span></p>
<p><span class="font19">echo pold started &gt;&gt;&nbsp;/var/log/messages ;;</span></p>
<p><span class="font19">stop)</span></p>
<p><span class="font19">echo -n &quot;Stopping pold...&quot; sleep 1;</span></p>
<p><span class="font19">rm -rf /var/lock/subsys/pold echo &quot;done.&quot;</span></p>
<p><span class="font19">echo pold stopped &gt;&gt;&nbsp;/var/log/messages ;;</span></p>
<p><span class="font19">*)</span></p>
<p><span class="font19">echo &quot;Usage: /etc/init.d/pold {start|stop}&quot; exit 1 ;; esac exit 0</span></p>
<h4><a name="bookmark6796"></a><span class="font25"><a name="bookmark6797"></a>The </span><span class="font25" style="font-weight:bold;">touch /var/lock/subsys/pold </span><span class="font25">is mandatory and must be the same filename as the script name, if you want the stop sequence (the K01pold link) to be run.</span></h4>
<ul style="list-style:none;"><li>
<h4><a name="bookmark6798"></a><span class="font25"><a name="bookmark6799"></a>6. Use </span><span class="font25" style="font-weight:bold;">chkconfig </span><span class="font25">to setup your script to start in runlevels 3,4 and 5, and to stop in any other runlevel.</span></h4></li></ul>
<p><span class="font19">chkconfig --add pold</span></p>
<h4><a name="bookmark6800"></a><span class="font25"><a name="bookmark6801"></a>The command above will only work when the </span><span class="font25" style="font-weight:bold;"># chkconfig: </span><span class="font25">and </span><span class="font25" style="font-weight:bold;"># description: </span><span class="font25">lines in the pold script are there.</span></h4>
<p><a name="bookmark6802"></a><span class="font11" style="font-weight:bold;">Part IV. system management</span></p>
<h3><a name="bookmark6803"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6804"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6805"><span class="font24" style="font-weight:bold;">16. scheduling </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6806"><span class="font24">16.1. one time jobs with at </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6807"><span class="font24">16.2. cron </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6808"><span class="font24">16.3. practice : scheduling </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6809"><span class="font24">16.4. solution : scheduling </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6810"><span class="font24" style="font-weight:bold;">17. logging </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6811"><span class="font24">17.1. login logging </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6812"><span class="font24">17.2. syslogd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6813"><span class="font24">17.3. logger </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6814"><span class="font24">17.4. watching logs </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6815"><span class="font24">17.5. rotating logs </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6816"><span class="font24">17.6. practice : logging </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6817"><span class="font24">17.7. solution : logging </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6818"><span class="font24" style="font-weight:bold;">18. memory management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6819"><span class="font24">18.1. displaying memory and cache </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6820"><span class="font24">18.2. managing swap space </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6821"><span class="font24">18.3. monitoring memory with vmstat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6822"><span class="font24">18.4. practice : memory </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6823"><span class="font24">18.5. solution : memory </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6824"><span class="font24" style="font-weight:bold;">19. resource monitoring </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6825"><span class="font24">19.1. four basic resources </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6319"><span class="font24">19.2. top </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6826"><span class="font24">19.3. free </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6827"><span class="font24">19.4. watch </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6828"><span class="font24">19.5. vmstat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6829"><span class="font24">19.6. iostat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6830"><span class="font24">19.7. mpstat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6831"><span class="font24">19.8. sadc and sar </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6832"><span class="font24">19.9. ntop </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6358"><span class="font24">19.10. iftop </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6833"><span class="font24">19.11. iptraf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6834"><span class="font24">19.12. nmon </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6835"><span class="font24">19.13. htop </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6836"><span class="font24" style="font-weight:bold;">20. package management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6837"><span class="font24">20.1. package terminology </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6838"><span class="font24">20.2. deb package management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6839"><span class="font24">20.3. apt-get </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6840"><span class="font24">20.4. aptitude </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6841"><span class="font24">20.5. apt </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6842"><span class="font24">20.6. rpm </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6843"><span class="font24">20.7. yum </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6844"><span class="font24">20.8. alien </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6845"><span class="font24">20.9. downloading software outside the repository </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6846"><span class="font24">20.10. compiling software </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6847"><span class="font24">20.11. practice: package management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6848"><span class="font24">20.12. solution: package management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark6849"></a><span class="font11" style="font-weight:bold;"><a name="bookmark6850"></a><a name="bookmark6851"></a>Chapter 16. scheduling</span></h1></li></ul>
<p><a name="bookmark6852"></a><span class="font25"><a name="bookmark6853"></a>Linux administrators use the </span><span class="font25" style="font-weight:bold;">at </span><span class="font25">to schedule one time jobs. Recurring jobs are better scheduled with </span><span class="font25" style="font-weight:bold;">cron</span><span class="font25">. The next two sections will discuss both tools.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6854"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6094"></a><a name="bookmark6855"></a>16.1. one time jobs with at</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark6856"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6857"></a>16.1.1. at</span></h3></li></ul></li></ul>
<h4><a name="bookmark6858"></a><span class="font25"><a name="bookmark6859"></a><a name="bookmark6860"></a>Simple scheduling can be done with the </span><span class="font25" style="font-weight:bold;">at </span><span class="font25">command. This screenshot shows the scheduling of the date command at 22:01 and the sleep command at 22:03.</span></h4>
<p><span class="font19">root@laika:~# at 22:01</span></p>
<p><span class="font19">at&gt; date</span></p>
<p><span class="font19">at&gt; &lt;EOT&gt;</span></p>
<p><span class="font19">job 1 at Wed Aug 1 22:01:00 2007</span></p>
<p><span class="font19">root@laika:~# at 22:03</span></p>
<p><span class="font19">at&gt; sleep 10</span></p>
<p><span class="font19">at&gt; &lt;EOT&gt;</span></p>
<p><span class="font19">job 2 at Wed Aug 1 22:03:00 2007 root@laika:~#</span></p>
<p><span class="font25" style="font-style:italic;">In real life you will hopefully be scheduling more useful commands ;-)</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6861"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6862"></a>16.1.2. atq</span></h3></li></ul>
<h4><a name="bookmark6863"></a><span class="font25"><a name="bookmark6864"></a><a name="bookmark6865"></a>It is easy to check when jobs are scheduled with the </span><span class="font25" style="font-weight:bold;">atq </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">at -l </span><span class="font25">commands.</span></h4>
<p><span class="font19">root@laika:~# atq</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Wed</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Aug</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">22:01:00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2007</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">a</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Wed</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Aug</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">22:03:00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2007</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">a</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td></tr>
<tr><td colspan="2" style="vertical-align:top;">
<p><span class="font19">root@laika:-</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-# at</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-l</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Wed</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Aug</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">22:01:00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2007</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">a</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Wed</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Aug</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">22:03:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2007</span></p></td><td style="vertical-align:top;">
<p><span class="font19">a</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td></tr>
</table>
<p><span class="font19">root@laika:~#</span></p>
<h4><a name="bookmark6866"></a><span class="font25"><a name="bookmark6867"></a>The at command understands English words like tomorrow and teatime to schedule commands the next day and at four in the afternoon.</span></h4>
<p><span class="font19">root@laika:~# at 10:05 tomorrow</span></p>
<p><span class="font19">at&gt; sleep 100 at&gt; &lt;EOT&gt;</span></p>
<p><span class="font19">job 5 at Thu Aug 2 10:05:00 2007 root@laika:~# at teatime tomorrow at&gt; tea at&gt; &lt;EOT&gt;</span></p>
<p><span class="font19">job 6 at Thu Aug 2 16:00:00 2007 root@laika:~# atq</span></p>
<p><span class="font19">6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thu Aug 2 16:00:00 2007 a root</span></p>
<p><span class="font19">5 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thu Aug 2 10:05:00 2007 a root</span></p>
<p><span class="font19">root@laika:~#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6868"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6869"></a>16.1.3. atrm</span></h3></li></ul>
<p><a name="bookmark6870"></a><span class="font25">Jobs in the at queue can be removed with </span><span class="font25" style="font-weight:bold;">atrm</span><span class="font25">.</span></p>
<p><span class="font19">root@laika:~# atq</span></p>
<p><span class="font19">6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thu Aug 2 16:00:00 2007 a root</span></p>
<p><span class="font19">5 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thu Aug 2 10:05:00 2007 a root</span></p>
<p><span class="font19">root@laika:~# atrm 5 root@laika:~# atq</span></p>
<p><span class="font19">6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thu Aug 2 16:00:00 2007 a root</span></p>
<p><span class="font19">root@laika:~#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6871"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6872"></a>16.1.4. at.allow and at.deny</span></h3></li></ul>
<p><a name="bookmark6873"></a><span class="font25"><a name="bookmark6874"></a>You can also use the </span><span class="font25" style="font-weight:bold;">/etc/at.allow </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/etc/at.deny </span><span class="font25">files to manage who can schedule jobs with at.</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">/etc/at.allow </span><span class="font25">file can contain a list of users that are allowed to schedule </span><span class="font25" style="font-weight:bold;">at </span><span class="font25">jobs. When </span><span class="font25" style="font-weight:bold;">/etc/at.allow </span><span class="font25">does not exist, then everyone can use </span><span class="font25" style="font-weight:bold;">at </span><span class="font25">unless their username is listed in </span><span class="font25" style="font-weight:bold;">/ etc/at.deny</span><span class="font25">.</span></p>
<p><span class="font25">If none of these files exist, then everyone can use </span><span class="font25" style="font-weight:bold;">at</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6875"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6095"></a><a name="bookmark6876"></a>16.2. cron</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark6877"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6878"></a>16.2.1. crontab file</span></h3></li></ul></li></ul>
<p><a name="bookmark6879"></a><span class="font25"><a name="bookmark6880"></a>The </span><span class="font25" style="font-weight:bold;">crontab(1) </span><span class="font25">command can be used to maintain the </span><span class="font25" style="font-weight:bold;">crontab(5) </span><span class="font25">file. Each user can have their own crontab file to schedule jobs at a specific time. This time can be specified with five fields in this order: minute, hour, day of the month, month and day of the week. If a field contains an asterisk (*), then this means all values of that field.</span></p>
<p><span class="font25">The following example means : run script42 eight minutes after two, every day of the month, every month and every day of the week.</span></p>
<p><span class="font19">8 14 * * * script42</span></p>
<p><span class="font25">Run script8472 every month on the first of the month at 25 past midnight.</span></p>
<p><span class="font19">25 0 1 * * script8472</span></p>
<p><span class="font25">Run this script33 every two minutes on Sunday (both 0 and 7 refer to Sunday).</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">*/2 * * * o</span></p></li></ul>
<p><span class="font25">Instead of these five fields, you can also type one of these: @reboot, @yearly or @annually, @monthly, @weekly, @daily or @midnight, and @hourly.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6881"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6882"></a>16.2.2. crontab command</span></h3></li></ul>
<p><span class="font25">Users should not edit the crontab file directly, instead they should type </span><span class="font25" style="font-weight:bold;">crontab -e </span><span class="font25">which will use the editor defined in the EDITOR or VISUAL environment variable. Users can display their cron table with </span><span class="font25" style="font-weight:bold;">crontab -l</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6883"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6884"></a>16.2.3. cron.allow and cron.deny</span></h3></li></ul>
<p><a name="bookmark6885"></a><span class="font25"><a name="bookmark6886"></a>The </span><span class="font25" style="font-weight:bold;">cron daemon crond </span><span class="font25">is reading the cron tables, taking into account the </span><span class="font25" style="font-weight:bold;">/etc/cron.allow </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/etc/cron.deny </span><span class="font25">files.</span></p>
<p><span class="font25">These files work in the same way as </span><span class="font25" style="font-weight:bold;">at.allow </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">at.deny</span><span class="font25">. When the </span><span class="font25" style="font-weight:bold;">cron.allow </span><span class="font25">file exists, then your username has to be in it, otherwise you cannot use </span><span class="font25" style="font-weight:bold;">cron</span><span class="font25">. When the </span><span class="font25" style="font-weight:bold;">cron.allow </span><span class="font25">file does not exists, then your username cannot be in the </span><span class="font25" style="font-weight:bold;">cron.deny </span><span class="font25">file if you want to use </span><span class="font25" style="font-weight:bold;">cron</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6887"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6888"></a>16.2.4. /etc/crontab</span></h3></li></ul>
<h4><a name="bookmark6889"></a><span class="font25"><a name="bookmark6890"></a>The </span><span class="font25" style="font-weight:bold;">/etc/crontab </span><span class="font25">file contains entries for when to run hourly/daily/weekly/monthly tasks.</span><br><br><span class="font25"><a name="bookmark6891"></a>It will look similar to this output.</span></h4>
<p><span class="font19">SHELL=/bin/sh</span></p>
<p><span class="font19">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span></p>
<p><span class="font19">20 3 * * * &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root &nbsp;&nbsp;&nbsp;run-parts --report /etc/cron.daily</span></p>
<p><span class="font19">40 3 * * 7 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root &nbsp;&nbsp;&nbsp;run-parts --report /etc/cron.weekly</span></p>
<p><span class="font19">55 3 1 * * &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root &nbsp;&nbsp;&nbsp;run-parts --report /etc/cron.monthly</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6892"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6893"></a>16.2.5. /etc/cron.*</span></h3></li></ul>
<h4><a name="bookmark6894"></a><span class="font25"><a name="bookmark6895"></a><a name="bookmark6896"></a><a name="bookmark6897"></a>The directories shown in the next screenshot contain the tasks that are run at the times scheduled in </span><span class="font25" style="font-weight:bold;">/etc/crontab</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">/etc/cron.d </span><span class="font25">directory is for special cases, to schedule jobs that require finer control than hourly/daily/weekly/monthly.</span></h4>
<p><span class="font19">paul@laika:~$ ls -ld /etc/cron.*</span></p>
<p><span class="font19">drwxr-xr-x 2 root root 4096 2008-04-11 09:14 /etc/cron.d</span></p>
<p><span class="font19">drwxr-xr-x 2 root root 4096 2008-04-19 15:04 /etc/cron.daily</span></p>
<p><span class="font19">drwxr-xr-x 2 root root 4096 2008-04-11 09:14 /etc/cron.hourly</span></p>
<p><span class="font19">drwxr-xr-x 2 root root 4096 2008-04-11 09:14 /etc/cron.monthly</span></p>
<p><span class="font19">drwxr-xr-x 2 root root 4096 2008-04-11 09:14 /etc/cron.weekly</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6898"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6899"></a>16.2.6. /etc/cron.*</span></h3></li></ul>
<p><span class="font25">Note that Red Hat uses </span><span class="font25" style="font-weight:bold;">anacron </span><span class="font25">to schedule daily, weekly and monthly cron jobs. </span><span class="font19">root@rhel65:/etc# cat anacrontab # /etc/anacrontab: configuration file for anacron</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># See anacron(8) and anacrontab(5) for details.</span></p></li></ul>
<p><span class="font19">SHELL=/bin/sh</span></p>
<p><span class="font19">PATH=/sbin:/bin:/usr/sbin:/usr/bin</span></p>
<p><span class="font19">MAILTO=root</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># the maximal random delay added to the base delay of the jobs RANDOM_DELAY=45</span></p></li>
<li>
<p><span class="font19"># the jobs will be started during the following hours only START_HOURS_RANGE=3-22</span></p></li>
<li>
<p><span class="font19"># period in days delay in minutes job-identifier command</span></p></li></ul>
<p><span class="font19">1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cron.daily &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nice run-parts /etc/cron.daily</span></p>
<p><span class="font19">7 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;25 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cron.weekly &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nice run-parts /etc/cron.weekly</span></p>
<p><span class="font19">@monthly 45 cron.monthly &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nice run-parts /etc/cron.monthly</span></p>
<p><span class="font19">root@rhel65:/etc#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6900"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6096"></a><a name="bookmark6901"></a>16.3. practice : scheduling</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Schedule two jobs with </span><span class="font25" style="font-weight:bold;">at</span><span class="font25">, display the </span><span class="font25" style="font-weight:bold;">at queue </span><span class="font25">and remove a job.</span></p></li>
<li>
<p><span class="font25">2. As normal user, use </span><span class="font25" style="font-weight:bold;">crontab -e </span><span class="font25">to schedule a script to run every four minutes.</span></p></li>
<li>
<p><span class="font25">3. As root, display the </span><span class="font25" style="font-weight:bold;">crontab </span><span class="font25">file of your normal user.</span></p></li>
<li>
<p><span class="font25">4. As the normal user again, remove your </span><span class="font25" style="font-weight:bold;">crontab </span><span class="font25">file.</span></p></li>
<li>
<p><span class="font25">5. Take a look at the </span><span class="font25" style="font-weight:bold;">cron </span><span class="font25">files and directories in </span><span class="font25" style="font-weight:bold;">/etc </span><span class="font25">and understand them. What is the </span><span class="font25" style="font-weight:bold;">runparts </span><span class="font25">command doing ?</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6902"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6097"></a><a name="bookmark6903"></a>16.4. solution : scheduling</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark6904"></a><span class="font25"><a name="bookmark6905"></a>1. Schedule two jobs with </span><span class="font25" style="font-weight:bold;">at</span><span class="font25">, display the </span><span class="font25" style="font-weight:bold;">at queue </span><span class="font25">and remove a job.</span></h4></li></ul>
<p><span class="font19">root@rhel55 ~# at 9pm today</span></p>
<p><span class="font19">at&gt; echo go to bed &gt;&gt;&nbsp;/root/todo.txt at&gt; &lt;EOT&gt; job 1 at 2010-11-14 21:00 root@rhel55 ~# at 17h31 today at&gt; echo go to lunch &gt;&gt;&nbsp;/root/todo.txt at&gt; &lt;EOT&gt; job 2 at 2010-11-14 17:31 root@rhel55 ~# atq 2 2010-11-14 17:31 a root 1 2010-11-14 21:00 a root root@rhel55 ~# atrm 1 root@rhel55 ~# atq 2 2010-11-14 17:31 a root root@rhel55 ~# date Sun Nov 14 17:31:01 CET 2010 root@rhel55 ~# cat /root/todo.txt go to lunch</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. As normal user, use </span><span class="font25" style="font-weight:bold;">crontab -e </span><span class="font25">to schedule a script to run every four minutes. </span><span class="font19">paul@rhel55 ~$ crontab -e no crontab for paul - using an empty one crontab: installing new crontab</span></p></li>
<li>
<h4><a name="bookmark6906"></a><span class="font25"><a name="bookmark6907"></a>3. As root, display the </span><span class="font25" style="font-weight:bold;">crontab </span><span class="font25">file of your normal user.</span></h4></li></ul>
<p><span class="font19">root@rhel55 ~# crontab -l -u paul</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">*/4 * * * * echo 'date' &gt;&gt;&nbsp;/home/paul/crontest.txt</span></p></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark6908"></a><span class="font25"><a name="bookmark6909"></a>4. As the normal user again, remove your </span><span class="font25" style="font-weight:bold;">crontab </span><span class="font25">file.</span></h4></li></ul>
<p><span class="font19">paul@rhel55 ~$ crontab -r paul@rhel55 ~$ crontab -l no crontab for paul</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark6910"></a><span class="font25"><a name="bookmark6911"></a>5. Take a look at the </span><span class="font25" style="font-weight:bold;">cron </span><span class="font25">files and directories in </span><span class="font25" style="font-weight:bold;">/etc </span><span class="font25">and understand them. What is the </span><span class="font25" style="font-weight:bold;">runparts </span><span class="font25">command doing ?</span></h4></li></ul>
<p><span class="font19">run-parts runs a script in a directory</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark6912"></a><span class="font11" style="font-weight:bold;"><a name="bookmark6913"></a><a name="bookmark6914"></a>Chapter 17. logging</span></h1></li></ul>
<p><span class="font25">This chapter has three distinct subjects.</span></p>
<p><span class="font25">First we look at login logging ; how can we find out who is logging in to the system, when and from where. And who is not logging in, who fails at </span><span class="font25" style="font-weight:bold;">su </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">ssh</span><span class="font25">.</span></p>
<p><span class="font25">Second we discuss how to configure the syslog daemon, and how to test it with </span><span class="font25" style="font-weight:bold;">logger</span><span class="font25">.</span></p>
<p><span class="font25">The last part is mostly about </span><span class="font25" style="font-weight:bold;">rotating logs </span><span class="font25">and mentions the </span><span class="font25" style="font-weight:bold;">tail -f </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">watch </span><span class="font25">commands for </span><span class="font25" style="font-weight:bold;">watching logs</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6915"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6099"></a><a name="bookmark6916"></a>17.1. login logging</span></h2></li></ul>
<h4><a name="bookmark6917"></a><span class="font25"><a name="bookmark6918"></a><a name="bookmark6919"></a><a name="bookmark6920"></a><a name="bookmark6921"></a><a name="bookmark6922"></a>To keep track of who is logging into the system, Linux can maintain the </span><span class="font25" style="font-weight:bold;">/var/log/wtmp</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">/ var/log/btmp</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">/var/run/utmp </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/var/log/lastlog </span><span class="font25">files.</span></h4>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6923"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6924"></a>17.1.1. /var/run/utmp (who)</span></h3></li></ul>
<h4><a name="bookmark6925"></a><span class="font25"><a name="bookmark6926"></a><a name="bookmark6927"></a>Use the </span><span class="font25" style="font-weight:bold;">who </span><span class="font25">command to see the /var/run/utmp file. This command is showing you all the </span><span class="font25" style="font-weight:bold;">currently </span><span class="font25">logged in users. Notice that the utmp file is in /var/run and not in /var/log .</span></h4>
<p><span class="font19">[root@rhel4 ~]# who</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pts/1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">18:21</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">(192.168.1.45)</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">sandra</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:top;">
<p><span class="font19">14</span></p></td><td style="vertical-align:top;">
<p><span class="font19">18:11</span></p></td><td style="vertical-align:top;">
<p><span class="font19">(192.168.1.42)</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">inge</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:top;">
<p><span class="font19">14</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12:01</span></p></td><td style="vertical-align:top;">
<p><span class="font19">(192.168.1.33)</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">els</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/4</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:top;">
<p><span class="font19">14</span></p></td><td style="vertical-align:top;">
<p><span class="font19">14:33</span></p></td><td style="vertical-align:top;">
<p><span class="font19">(192.168.1.19)</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6928"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6929"></a>17.1.2. /var/log/wtmp (last)</span></h3></li></ul>
<h4><a name="bookmark6930"></a><span class="font25"><a name="bookmark6931"></a><a name="bookmark6932"></a><a name="bookmark6933"></a>The /var/log/wtmp file is updated by the </span><span class="font25" style="font-weight:bold;">login program</span><span class="font25">. Use </span><span class="font25" style="font-weight:bold;">last </span><span class="font25">to see the /var/run/wtmp file.</span></h4>
<p><span class="font19">[root@rhel4a ~]# last | head</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pts/1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">192.168.1.45</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Wed</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">18:39</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">still</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">logged in</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">reboot</span></p></td><td style="vertical-align:top;">
<p><span class="font19">system boot</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2.6.9-42.0.8.ELs</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Wed</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:top;">
<p><span class="font19">14</span></p></td><td style="vertical-align:top;">
<p><span class="font19">18:21</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">(01:15)</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">nicolas</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pts/5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pc-dss.telematic</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Wed</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">12:32</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">- 13:06</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">(00:33)</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">stefaan</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pts/3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pc-sde.telematic</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Wed</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">12:28</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">- 12:40</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">(00:12)</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">nicolas</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pts/3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pc-nae.telematic</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Wed</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">11:36</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">- 12:21</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">(00:45)</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">nicolas</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pts/3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pc-nae.telematic</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Wed</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">11:34</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">- 11:36</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">(00:01)</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">dirk</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pts/5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pc-dss.telematic</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Wed</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10:03</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">- 12:31</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">(02:28)</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">nicolas</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pts/3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pc-nae.telematic</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Wed</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">09:45</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">- 11:34</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">(01:48)</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">dimitri</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pts/5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">rhel4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Wed</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">07:57</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">- 08:38</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">(00:40)</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">stefaan</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/4</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pc-sde.telematic</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Wed</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:top;">
<p><span class="font19">14</span></p></td><td style="vertical-align:top;">
<p><span class="font19">07:16</span></p></td><td style="vertical-align:top;">
<p><span class="font19">- down</span></p></td><td style="vertical-align:top;">
<p><span class="font19">(05:50)</span></p></td></tr>
</table>
<p><span class="font19">[root@rhel4a ~]#</span></p>
<h4><a name="bookmark6934"></a><span class="font25"><a name="bookmark6935"></a>The last command can also be used to get a list of last reboots.</span></h4>
<p><span class="font19">[paul@rekkie ~]$ last reboot</span></p>
<p><span class="font19">reboot system boot 2.6.16-rekkie Mon Jul 30 05:13 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(370+08:42)</span></p>
<p><span class="font19">wtmp begins Tue May 30 23:11:45 2006</span></p>
<p><span class="font19">[paul@rekkie ~]</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6936"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6937"></a>17.1.3. /var/log/lastlog (lastlog)</span></h3></li></ul>
<h4><a name="bookmark6938"></a><span class="font25"><a name="bookmark6939"></a><a name="bookmark6940"></a>Use </span><span class="font25" style="font-weight:bold;">lastlog </span><span class="font25">to see the /var/log/lastlog file.</span></h4>
<p><span class="font19">[root@rhel4a ~]# lastlog | tail</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">tim</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pts/5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10.170.1.122</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Tue Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">13 09:36:54</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">+ 0100</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2007</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">rm</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pts/6</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">rhel4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Tue Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">13 10:06:56</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">+ 0100</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2007</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">henk stefaan</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pts/3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pc-sde.telematic</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">**Never</span></p>
<p><span class="font19">Wed Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">logged in**</span></p>
<p><span class="font19">14 12:28:38</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">+ 0100</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2007</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">dirk</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pc-dss.telematic</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Wed Feb</span></p></td><td style="vertical-align:top;">
<p><span class="font19">14 10:03:11</span></p></td><td style="vertical-align:top;">
<p><span class="font19">+ 0100</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2007</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">arsene nicolas</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pts/5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pc-dss.telematic</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">**Never</span></p>
<p><span class="font19">Wed Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">logged in** 14 12:32:18</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">+ 0100</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2007</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">dimitri</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">rhel4</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Wed Feb</span></p></td><td style="vertical-align:top;">
<p><span class="font19">14 07:57:19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">+ 0100</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2007</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">bashuserrm</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/7</span></p></td><td style="vertical-align:top;">
<p><span class="font19">rhel4</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Tue Feb</span></p></td><td style="vertical-align:top;">
<p><span class="font19">13 10:35:40</span></p></td><td style="vertical-align:top;">
<p><span class="font19">+ 0100</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2007</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">kornuserrm</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">rhel4</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Tue Feb</span></p></td><td style="vertical-align:top;">
<p><span class="font19">13 10:06:17</span></p></td><td style="vertical-align:top;">
<p><span class="font19">+ 0100</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2007</span></p></td></tr>
</table>
<p><span class="font19">[root@rhel4a ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6941"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6942"></a>17.1.4. /var/log/btmp (lastb)</span></h3></li></ul>
<h4><a name="bookmark6943"></a><span class="font25"><a name="bookmark6944"></a><a name="bookmark6945"></a><a name="bookmark6946"></a>There is also the </span><span class="font25" style="font-weight:bold;">lastb </span><span class="font25">command to display the </span><span class="font25" style="font-weight:bold;">/var/log/btmp </span><span class="font25">file. This file is updated by the login program when entering the wrong password, so it contains failed login attempts. Many computers will not have this file, resulting in no logging of failed login attempts.</span></h4>
<p><span class="font19">[root@RHEL4b ~]# lastb</span></p>
<p><span class="font19">lastb: /var/log/btmp: No such file or directory</span></p>
<p><span class="font19">Perhaps this file was removed by the operator to prevent logging lastb\ info.</span></p>
<p><span class="font19">[root@RHEL4b ~]#</span></p>
<h4><a name="bookmark6947"></a><span class="font25"><a name="bookmark6948"></a>The reason given for this is that users sometimes type their password by mistake instead of their login, so this world readable file poses a security risk. You can enable bad login logging by simply creating the file. Doing a chmod o-r /var/log/btmp improves security.</span></h4>
<p><span class="font19">[root@RHEL4b ~]# touch /var/log/btmp</span></p>
<p><span class="font19">[root@RHEL4b ~]# ll /var/log/btmp</span></p>
<p><span class="font19">-rw-r--r-- &nbsp;1 root root 0 Jul 30 06:12 /var/log/btmp</span></p>
<p><span class="font19">[root@RHEL4b ~]# chmod o-r /var/log/btmp</span></p>
<p><span class="font19">[root@RHEL4b ~]# lastb</span></p>
<p><span class="font19">btmp begins Mon Jul 30 06:12:19 2007</span></p>
<p><span class="font19">[root@RHEL4b ~]#</span></p>
<h4><a name="bookmark6949"></a><span class="font25"><a name="bookmark6950"></a>Failed logins via ssh, rlogin or su are not registered in /var/log/btmp. Failed logins via tty are.</span></h4>
<p><span class="font19">[root@RHEL4b ~]# lastb</span></p>
<p><span class="font19">HalvarFl tty3 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mon Jul 30 07:10 - 07:10 &nbsp;(00:00)</span></p>
<p><span class="font19">Maria tty1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mon Jul 30 07:09 - 07:09 &nbsp;(00:00)</span></p>
<p><span class="font19">Roberto tty1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mon Jul 30 07:09 - 07:09 &nbsp;(00:00)</span></p>
<p><span class="font19">btmp begins Mon Jul 30 07:09:32 2007</span></p>
<p><span class="font19">[root@RHEL4b ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6951"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6952"></a>17.1.5. su and ssh logins</span></h3></li></ul>
<p><a name="bookmark6953"></a><span class="font25"><a name="bookmark6954"></a>Depending on the distribution, you may also have the </span><span class="font25" style="font-weight:bold;">/var/log/secure </span><span class="font25">file being filled with messages from the auth and/or authpriv syslog facilities. This log will include su and/or ssh failed login attempts. Some distributions put this in </span><span class="font25" style="font-weight:bold;">/var/log/auth.log</span><span class="font25">, verify the syslog configuration.</span></p>
<p><span class="font19">[root@RHEL4b ~]# cat /var/log/secure</span></p>
<p><span class="font19">Jul 30 07:09:03 sshd[4387]: Accepted publickey for paul from ::ffff:19\ 2.168.1.52 port 33188 ssh2</span></p>
<p><span class="font19">Jul 30 05:09:03 sshd[4388]: Accepted publickey for paul from ::ffff:19\ 2.168.1.52 port 33188 ssh2</span></p>
<p><span class="font19">Jul 30 07:22:27 sshd[4655]: Failed password for Hermione from ::ffff:1\ 92.168.1.52 port 38752 ssh2</span></p>
<p><span class="font19">Jul 30 05:22:27 sshd[4656]: Failed password for Hermione from ::ffff:1\ 92.168.1.52 port 38752 ssh2</span></p>
<p><span class="font19">Jul 30 07:22:30 sshd[4655]: Failed password for Hermione from ::ffff:1\ 92.168.1.52 port 38752 ssh2</span></p>
<p><span class="font19">Jul 30 05:22:30 sshd[4656]: Failed password for Hermione from ::ffff:1\ 92.168.1.52 port 38752 ssh2</span></p>
<p><span class="font19">Jul 30 07:22:33 sshd[4655]: Failed password for Hermione from ::ffff:1\ 92.168.1.52 port 38752 ssh2</span></p>
<p><span class="font19">Jul 30 05:22:33 sshd[4656]: Failed password for Hermione from ::ffff:1\ 92.168.1.52 port 38752 ssh2</span></p>
<p><span class="font19">Jul 30 08:27:33 sshd[5018]: Invalid user roberto from ::ffff:192.168.1\ .52</span></p>
<p><span class="font19">Jul 30 06:27:33 sshd[5019]: input_userauth_request: invalid user rober\ to</span></p>
<p><span class="font19">Jul 30 06:27:33 sshd[5019]: Failed none for invalid user roberto from \ ::ffff:192.168.1.52 port 41064 ssh2</span></p>
<p><span class="font19">Jul 30 06:27:33 sshd[5019]: Failed publickey for invalid user roberto \ from ::ffff:192.168.1.52 port 41064 ssh2</span></p>
<p><span class="font19">Jul 30 08:27:36 sshd[5018]: Failed password for invalid user roberto f\ rom ::ffff:192.168.1.52 port 41064 ssh2</span></p>
<p><span class="font19">Jul 30 06:27:36 sshd[5019]: Failed password for invalid user roberto f\ rom ::ffff:192.168.1.52 port 41064 ssh2</span></p>
<p><span class="font19">[root@RHEL4b ~]#</span></p>
<p><span class="font25">You can enable this yourself, with a custom log file by adding the following line tot syslog.conf.</span></p>
<p><span class="font19">auth.*,authpriv.* &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/var/log/customsec.log</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6955"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6100"></a><a name="bookmark6956"></a>17.2. syslogd</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark6957"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6958"></a>17.2.1. about syslog</span></h3></li></ul></li></ul>
<p><a name="bookmark6959"></a><span class="font25"><a name="bookmark6960"></a><a name="bookmark6961"></a>The standard method of logging on Linux was through the </span><span class="font25" style="font-weight:bold;">syslogd </span><span class="font25">daemon. Syslog was developed by </span><span class="font25" style="font-weight:bold;">Eric Allman </span><span class="font25">for sendmail, but quickly became a standard among many Unix applications and was much later written as rfc 3164. The syslog daemon can receive messages on udp </span><span class="font25" style="font-weight:bold;">port 514 </span><span class="font25">from many applications (and appliances), and can append to log files, print, display messages on terminals and forward logs to other syslogd daemons on other machines. The syslogd daemon is configured in </span><span class="font25" style="font-weight:bold;">/etc/syslog.conf</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6962"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6963"></a>17.2.2. about rsyslog</span></h3></li></ul>
<p><a name="bookmark6964"></a><span class="font25">The new method is called </span><span class="font25" style="font-weight:bold;">reliable and extended syslogd </span><span class="font25">and uses the </span><span class="font25" style="font-weight:bold;">rsyslogd </span><span class="font25">daemon and the </span><span class="font25" style="font-weight:bold;">/etc/rsyslogd.conf </span><span class="font25">configuration file. The syntax is backwards compatible.</span></p>
<p><span class="font25">Each line in the configuration file uses a </span><span class="font25" style="font-weight:bold;">facility </span><span class="font25">to determine where the message is coming from. It also contains a </span><span class="font25" style="font-weight:bold;">priority </span><span class="font25">for the severity of the message, and an </span><span class="font25" style="font-weight:bold;">action </span><span class="font25">to decide on what to do with the message.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6965"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6966"></a>17.2.3. modules</span></h3></li></ul>
<p><span class="font25">The new </span><span class="font25" style="font-weight:bold;">rsyslog </span><span class="font25">has many more features that can be expanded by using modules. Modules allow for example exporting of syslog logging to a database.</span></p>
<p><span class="font25">Se the manuals for more information (when you are done with this chapter).</span></p>
<p><span class="font19">root@rhel65:/etc# man rsyslog.conf</span></p>
<p><span class="font19">root@rhel65:/etc# man rsyslogd</span></p>
<p><span class="font19">root@rhel65:/etc#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6967"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6968"></a>17.2.4. facilities</span></h3></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">man rsyslog.conf </span><span class="font25">command will explain the different default facilities for certain daemons, such as mail, lpr, news and kern(el) messages. The local0 to local7 facility can be used for appliances (or any networked device that supports syslog). Here is a list of all facilities for rsyslog.conf version 1.3. The security keyword is deprecated.</span></p>
<p><span class="font19">auth (security) authpriv cron daemon ftp kern lpr mail mark (internal use only) news syslog user</span></p>
<p><span class="font19">uucp local0-7</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6969"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6970"></a>17.2.5. priorities</span></h3></li></ul>
<p><span class="font25">The worst severity a message can have is </span><span class="font25" style="font-weight:bold;">emerg </span><span class="font25">followed by </span><span class="font25" style="font-weight:bold;">alert </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">crit</span><span class="font25">. Lowest priority should go to </span><span class="font25" style="font-weight:bold;">info </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">debug </span><span class="font25">messages. Specifying a severity will also log all messages with a higher severity. You can prefix the severity with = to obtain only messages that match that severity. You can also specify </span><span class="font25" style="font-weight:bold;">.none </span><span class="font25">to prevent a specific action from any message from a certain facility.</span></p>
<p><span class="font25">Here is a list of all priorities, in ascending order. The keywords warn, error and panic are deprecated.</span></p>
<p><span class="font19">debug info notice warning (warn) err (error) crit alert emerg (panic)</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6971"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6972"></a>17.2.6. actions</span></h3></li></ul>
<p><span class="font25">The default action is to send a message to the username listed as action. When the action is prefixed with a </span><span class="font25" style="font-weight:bold;">/ </span><span class="font25">then rsyslog will send the message to the file (which can be a regular file, but also a printer or terminal). The </span><span class="font25" style="font-weight:bold;">@ </span><span class="font25">sign prefix will send the message on to another syslog server. Here is a list of all possible actions.</span></p>
<div>
<p><span class="font19">root,user1 *</span></p>
<p><span class="font19">/</span></p>
<p><span class="font19">-/</span></p>
<p><span class="font19">I</span></p>
<p><span class="font19">@</span></p>
</div><br clear="all">
<p><span class="font19">list of users, separated by comma's</span></p>
<p><span class="font19">message to all logged on users</span></p>
<p><span class="font19">file (can be a printer, a console, a tty, ...) file, but don't sync after every write</span></p>
<p><span class="font19">named pipe</span></p>
<p><span class="font19">other syslog hostname</span></p>
<p><span class="font25">In addition, you can prefix actions with a - to omit syncing the file after every logging.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6973"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6974"></a>17.2.7. configuration</span></h3></li></ul>
<p><a name="bookmark6975"></a><span class="font25">Below a sample configuration of custom local4 messages in </span><span class="font25" style="font-weight:bold;">/etc/rsyslog.conf</span><span class="font25">.</span></p>
<p><span class="font19">local4.crit &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/var/log/critandabove</span></p>
<p><span class="font19">local4.=crit &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/var/log/onlycrit</span></p>
<p><span class="font19">local4.* &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/var/log/alllocal4</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6976"></a><span class="font9" style="font-weight:bold;"><a name="bookmark6977"></a>17.2.8. restarting rsyslogd</span></h3></li></ul>
<p><span class="font25">Don't forget to restart the server after changing its configuration.</span></p>
<p><span class="font19">root@rhel65:/etc# service rsyslog restart</span></p>
<p><span class="font19">Shutting down system logger: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p>
<p><span class="font19">Starting system logger: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p>
<p><span class="font19">root@rhel65:/etc#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6978"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6101"></a><a name="bookmark6979"></a>17.3. logger</span></h2></li></ul>
<h4><a name="bookmark6980"></a><span class="font25"><a name="bookmark6981"></a><a name="bookmark6982"></a>The logger command can be used to generate syslog test messages. You can aslo use it in scripts. An example of testing syslogd with the </span><span class="font25" style="font-weight:bold;">logger </span><span class="font25">tool.</span></h4>
<p><span class="font19">[root@rhel4a ~]# logger -p local4.debug &quot;14 debug&quot; [root@rhe14a ~]# logger -p 1oca14.crit &quot;14 crit&quot; [root@rhe14a ~]# logger -p 1oca14.emerg &quot;14 emerg&quot; [root@rhe14a ~]#</span></p>
<h4><a name="bookmark6983"></a><span class="font25"><a name="bookmark6984"></a>The results of the tests with logger.</span></h4>
<p><span class="font19">[root@rhe14a ~]# cat /var/1og/critandabove Feb 14 19:55:19 rhe14a paul: 14 crit Feb 14 19:55:28 rhe14a paul: 14 emerg [root@rhe14a ~]# cat /var/log/onlycrit Feb 14 19:55:19 rhe14a paul: 14 crit [root@rhe14a ~]# cat /var/1og/a111oca14 Feb 14 19:55:11 rhe14a paul: 14 debug Feb 14 19:55:19 rhe14a paul: 14 crit Feb 14 19:55:28 rhe14a paul: 14 emerg [root@rhe14a ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6985"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6102"></a><a name="bookmark6986"></a>17.4. watching logs</span></h2></li></ul>
<h4><a name="bookmark6987"></a><span class="font25"><a name="bookmark6988"></a><a name="bookmark6989"></a>You might want to use the </span><span class="font25" style="font-weight:bold;">tail -f </span><span class="font25">command to look at the last lines of a log file. The </span><span class="font25" style="font-weight:bold;">-f </span><span class="font25">option will dynamically display lines that are appended to the log.</span></h4>
<p><span class="font19">pau1@ubu1010:~$ tail -f /var/log/udev</span></p>
<p><span class="font19">SEQNUM=1741</span></p>
<p><span class="font19">SOUND_INITIALIZED=1</span></p>
<p><span class="font19">ID_VENDOR_FROM_DATABASE=nVidia Corporation</span></p>
<p><span class="font19">ID_MODEL_FROM_DATABASE=MCP79 High Definition Audio ID_BUS=pci</span></p>
<p><span class="font19">ID_VENDOR_ID=0x10de</span></p>
<p><span class="font19">ID_MODEL_ID=0x0ac0</span></p>
<p><span class="font19">ID_PATH=pci-0000:00:08.0</span></p>
<p><span class="font19">SOUND FORM FACTOR=interna1</span></p>
<h4><a name="bookmark6990"></a><span class="font25"><a name="bookmark6991"></a><a name="bookmark6992"></a>You can automatically repeat commands by preceding them with the </span><span class="font25" style="font-weight:bold;">watch </span><span class="font25">command. When executing the following:</span></h4>
<p><span class="font19">[root@rhe16 ~]# watch who</span></p>
<h4><a name="bookmark6993"></a><span class="font25"><a name="bookmark6994"></a>Something similar to this, repeating the output of the </span><span class="font25" style="font-weight:bold;">who </span><span class="font25">command every two seconds, will appear on the screen.</span></h4>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">Every 2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">.0s: who</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Sun Jul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">17 15:31:03 2011</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tty1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2011-07-17 13:28</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pts/0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2011-07-17 13:31</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">(192.168.1.30)</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2011-07-17 15:19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">(192.168.1.30)</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6995"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6103"></a><a name="bookmark6996"></a>17.5. rotating logs</span></h2></li></ul>
<p><a name="bookmark6997"></a><span class="font25">A lot of log files are always growing in size. To keep this within bounds, you may want to use </span><span class="font25" style="font-weight:bold;">logrotate </span><span class="font25">to rotate, compress, remove and mail log files. More info on the logrotate command in </span><span class="font25" style="font-weight:bold;">/etc/logrotate.conf.</span><span class="font25">. Individual configurations can be found in the </span><span class="font25" style="font-weight:bold;">/ etc/logrotate.d/ </span><span class="font25">directory.</span></p>
<p><span class="font25">Below a screenshot of the default Red Hat logrotate.conf file.</span></p>
<p><span class="font19">root@rhel65:/etc# cat logrotate.conf</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># see &quot;man logrotate&quot; for details</span></p></li>
<li>
<p><span class="font19"># rotate log files weekly weekly</span></p></li>
<li>
<p><span class="font19"># keep 4 weeks worth of backlogs rotate 4</span></p></li>
<li>
<p><span class="font19"># create new (empty) log files after rotating old ones create</span></p></li>
<li>
<p><span class="font19"># use date as a suffix of the rotated file dateext</span></p></li>
<li>
<p><span class="font19"># uncomment this if you want your log files compressed</span></p></li></ul>
<p><span class="font19">#compress</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># RPM packages drop log rotation information into this directory include /etc/logrotate.d</span></p></li>
<li>
<p><span class="font19"># no packages own wtmp and btmp -- we'll rotate them here /var/log/wtmp { monthly create 0664 root utmp minsize 1M</span></p></li></ul>
<p><span class="font19">rotate 1</span></p>
<p><span class="font19">}</span></p>
<p><span class="font19">/var/log/btmp {</span></p>
<p><span class="font19">missingok</span></p>
<p><span class="font19">monthly</span></p>
<p><span class="font19">create 0600 root utmp rotate 1</span></p>
<p><span class="font19">}</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># system-specific logs may be also be configured here.</span></p></li></ul>
<p><span class="font19">root@rhel65:/etc#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6998"></a><span class="font10" style="font-weight:bold;"><a name="bookmark3009"></a><a name="bookmark6999"></a>17.6. practice : logging</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Display the /var/run/utmp file with the proper command (not with cat or vi).</span></p></li>
<li>
<p><span class="font25">2. Display the /var/log/wtmp file.</span></p></li>
<li>
<p><span class="font25">3. Use the lastlog and lastb commands, understand the difference.</span></p></li>
<li>
<p><span class="font25">4. Examine syslog to find the location of the log file containing ssh failed logins.</span></p></li>
<li>
<p><span class="font25">5. Configure syslog to put local4.error and above messages in /var/log/l4e.log and local4.info only .info in /var/log/l4i.log. Test that it works with the logger tool!</span></p></li>
<li>
<p><span class="font25">6. Configure /var/log/Mysu.log, all the su to root messages should go in that log. Test that it works!</span></p></li>
<li>
<p><span class="font25">7. Send the local5 messages to the syslog server of your neighbour. Test that it works.</span></p></li>
<li>
<p><span class="font25">8. Write a script that executes logger to local4 every 15 seconds (different message). Use tail -f and watch on your local4 log files.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7000"></a><span class="font10" style="font-weight:bold;"><a name="bookmark2685"></a><a name="bookmark7001"></a>17.7. solution : logging</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark7002"></a><span class="font25"><a name="bookmark7003"></a>1. Display the /var/run/utmp file.</span></h4></li></ul>
<p><span class="font19">who</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark7004"></a><span class="font25"><a name="bookmark7005"></a>2. Display the /var/log/wtmp file.</span></h4></li></ul>
<p><span class="font19">last</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark7006"></a><span class="font25"><a name="bookmark7007"></a>3. Use the lastlog and lastb commands, understand the difference.</span></h4></li></ul>
<p><span class="font19">lastlog : when users last logged on lastb: failed (bad) login attempts</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark7008"></a><span class="font25"><a name="bookmark7009"></a>4. Examine syslog to find the location of the log file containing ssh failed logins.</span><br><br><span class="font25"><a name="bookmark7010"></a>Answer depends on whether you machine uses </span><span class="font25" style="font-weight:bold;">syslog </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">rsyslog </span><span class="font25">(newer).</span></h4>
<p><span class="font19">[root@rhel53 ~]# </span><span class="font19" style="font-weight:bold;">grep authpriv /etc/syslog.conf</span></p></li></ul>
<p><span class="font19">authpriv.* &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/var/log/secure</span></p>
<p><span class="font19">[root@rhel71 ~]# </span><span class="font19" style="font-weight:bold;">grep 'authpriv /etc/rsyslog.conf</span></p>
<p><span class="font19">authpriv.* &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/var/log/secure</span></p>
<p><span class="font19">paul@debian8:~$ </span><span class="font19" style="font-weight:bold;">grep 'auth /etc/rsyslog.conf</span></p>
<p><span class="font19">auth,authpriv.* &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/var/log/auth.log</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark7011"></a><span class="font25"><a name="bookmark7012"></a>5. Configure syslog to put local4.error and above messages in /var/log/l4e.log and local4.info only .info in /var/log/l4i.log. Test that it works with the logger tool!</span></h4></li></ul>
<p><span class="font25">With </span><span class="font25" style="font-weight:bold;">syslog:</span></p>
<p><span class="font19">echo local4.error /var/log/l4e.log &gt;&gt;&nbsp;/etc/syslog.conf</span></p>
<p><span class="font19">echo local4.=info /var/log/l4i.log &gt;&gt;&nbsp;/etc/syslog.conf service syslog restart</span></p>
<p><span class="font25">With </span><span class="font25" style="font-weight:bold;">rsyslog:</span></p>
<p><span class="font19">echo local4.error /var/log/l4e.log &gt;&gt;&nbsp;/etc/rsyslog.conf</span></p>
<p><span class="font19">echo local4.=info /var/log/l4i.log &gt;&gt;&nbsp;/etc/rsyslog.conf service rsyslog restart</span></p>
<h4><a name="bookmark7013"></a><span class="font25"><a name="bookmark7014"></a>On both:</span></h4>
<p><span class="font19">logger -p local4.error &quot;l4 error test&quot;</span></p>
<p><span class="font19">logger -p local4.alert &quot;l4 alert test&quot;</span></p>
<p><span class="font19">logger -p local4.info &quot;l4 info test&quot;</span></p>
<p><span class="font19">cat /var/log/l4e.log</span></p>
<p><span class="font19">cat /var/log/l4i.log</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark7015"></a><span class="font25"><a name="bookmark7016"></a>6. Configure /var/log/Mysu.log, all the su to root messages should go in that log. Test that it works!</span></h4></li></ul>
<p><span class="font19">echo authpriv.* /var/log/Mysu.log &gt;&gt;&nbsp;/etc/syslog.conf</span></p>
<h4><a name="bookmark7017"></a><span class="font25"><a name="bookmark7018"></a>This will log more than just the </span><span class="font25" style="font-weight:bold;">su </span><span class="font25">usage.</span><br><br><span class="font25"><a name="bookmark7019"></a>7. Send the local5 messages to the syslog server of your neighbour. Test that it works.</span></h4>
<h4><a name="bookmark7020"></a><span class="font25"><a name="bookmark7021"></a>On RHEL5, edit </span><span class="font25" style="font-weight:bold;">/etc/sysconfig/syslog </span><span class="font25">to enable remote listening on the server.</span></h4>
<h4><a name="bookmark7022"></a><span class="font25"><a name="bookmark7023"></a>On RHEL7, uncomment these two lines in </span><span class="font25" style="font-weight:bold;">/etc/rsyslog.conf </span><span class="font25">to enable 'UDP syslog reception'.</span></h4>
<p><span class="font23" style="font-style:italic;">#</span><span class="font19"> Provides UDP syslog reception $ModLoad imudp $UDPServerRun 514</span></p>
<p><span class="font25">On Debian/Ubuntu edit </span><span class="font25" style="font-weight:bold;">/etc/default/syslog </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">/etc/default/rsyslog</span><span class="font25">.</span></p>
<p><span class="font19">on the client: logger -p local5.info &quot;test local5 to neighbour&quot;</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark7024"></a><span class="font25"><a name="bookmark7025"></a>8. Write a script that executes logger to local4 every 15 seconds (different message). Use tail -f and watch on your local4 log files.</span></h4></li></ul>
<p><span class="font19">root@rhel53 scripts# cat logloop</span></p>
<p><span class="font19">#!/bin/bash</span></p>
<p><span class="font19">for i in 'seq 1 10' do</span></p>
<p><span class="font19">logger -p local4.info &quot;local4.info test number $i&quot;</span></p>
<p><span class="font19">sleep 15 done</span></p>
<p><span class="font19">root@rhel53 scripts# chmod +x logloop</span></p>
<p><span class="font19">root@rhel53 scripts# ./logloop &amp;</span></p>
<p><span class="font19">[1] 8264</span></p>
<p><span class="font19">root@rhel53 scripts# tail -f /var/log/local4.all.log</span></p>
<p><span class="font19">Mar 28 13:13:36 rhel53 root: local4.info test number 1</span></p>
<p><span class="font19">Mar 28 13:13:51 rhel53 root: local4.info test number 2</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark7026"></a><span class="font11" style="font-weight:bold;"><a name="bookmark6106"></a><a name="bookmark7027"></a>Chapter 18. memory management</span></h1></li></ul>
<p><span class="font25">This chapter will tell you how to manage RAM memory and cache.</span></p>
<p><a name="bookmark7028"></a><span class="font25"><a name="bookmark7029"></a><a name="bookmark7030"></a>We start with some simple tools to display information about memory: </span><span class="font25" style="font-weight:bold;">free -om</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">top </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">cat /proc/meminfo</span><span class="font25">.</span></p>
<p><a name="bookmark7031"></a><span class="font25"><a name="bookmark7032"></a><a name="bookmark7033"></a>We continue with managing swap space, using terms like </span><span class="font25" style="font-weight:bold;">swapping</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">paging </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">virtual memory</span><span class="font25">.</span></p>
<p><span class="font25">The last part is about using </span><span class="font25" style="font-weight:bold;">vmstat </span><span class="font25">to monitor swap usage.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7034"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6107"></a><a name="bookmark7035"></a>18.1. displaying memory and cache</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark7036"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7037"></a>18.1.1. /proc/meminfo</span></h3></li></ul></li></ul>
<p><a name="bookmark7038"></a><span class="font25">Displaying </span><span class="font25" style="font-weight:bold;">/proc/meminfo </span><span class="font25">will tell you a lot about the memory on your Linux computer.</span></p>
<p><span class="font19">paul@ubu1010:~$</span></p>
<p><span class="font19">MemTotal:</span></p>
<p><span class="font19">MemFree:</span></p>
<p><span class="font19">Buffers: Cached: SwapCached:</span></p>
<p><span class="font19">cat /proc/meminfo 3830176 kB 244060 kB 41020 kB 2035292 kB 9892 kB</span></p>
<p><span class="font25">The first line contains the total amount of physical RAM, the second line is the unused RAM. </span><span class="font25" style="font-weight:bold;">Buffers </span><span class="font25">is RAM used for buffering files, </span><span class="font25" style="font-weight:bold;">cached </span><span class="font25">is the amount of RAM used as cache and </span><span class="font25" style="font-weight:bold;">SwapCached </span><span class="font25">is the amount of swap used as cache. The file gives us much more information outside of the scope of this course.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6115"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7039"></a>18.1.2. free</span></h3></li></ul>
<p><a name="bookmark7040"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">free </span><span class="font25">tool can display the information provided by </span><span class="font25" style="font-weight:bold;">/proc/meminfo </span><span class="font25">in a more readable format. The example below displays brief memory information in megabytes.</span></p>
<table border="1">
<tr><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">paul@ubu1010:~$ free</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">-om</span></p></td><td rowspan="2" style="vertical-align:bottom;">
<p><span class="font19">shared</span></p></td><td rowspan="2" style="vertical-align:bottom;">
<p><span class="font19">buffers</span></p></td><td rowspan="2" style="vertical-align:bottom;">
<p><span class="font19">cached</span></p></td></tr>
<tr><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">total</span></p></td><td style="vertical-align:top;">
<p><span class="font19">used</span></p></td><td style="vertical-align:top;">
<p><span class="font19">free</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Mem:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3740</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3519</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">221</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">42</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1994</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Swap:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">6234</span></p></td><td style="vertical-align:top;">
<p><span class="font19">82</span></p></td><td style="vertical-align:top;">
<p><span class="font19">6152</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6835"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7041"></a>18.1.3. top</span></h3></li></ul>
<p><a name="bookmark7042"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">top </span><span class="font25">tool is often used to look at processes consuming most of the cpu, but it also displays memory information on line four and five (which can be toggled by pressing </span><span class="font25" style="font-weight:bold;">m</span><span class="font25">).</span></p>
<p><span class="font25">Below a screenshot of top on the same ubu1010 from above.</span></p>
<p><span class="font19">top - 10:44:34 up 16 days, 9:56, 6 users, load average: 0.13, 0.09, 0.12</span></p>
<p><span class="font19">Tasks: 166 total, 1 running, 165 sleeping, 0 stopped, 0 zombie</span></p>
<p><span class="font19">Cpu(s): 5.1%us, 4.6%sy, 0.6%ni, 88.7%id, 0.8%wa, 0.0%hi, 0.3%si, 0.0%st</span></p>
<p><span class="font19">Mem: &nbsp;&nbsp;3830176k total, 3613720k used, 216456k free, 45452k buffers</span></p>
<p><span class="font19">Swap: 6384636k total, 84988k used, 6299648k free, 2050948k cached</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7043"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6108"></a><a name="bookmark7044"></a>18.2. managing swap space</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark7045"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7046"></a>18.2.1. about swap space</span></h3></li></ul></li></ul>
<p><span class="font25">When the o<a name="bookmark7047"></a>perating system needs more memory than physically present in RAM, it can use </span><span class="font25" style="font-weight:bold;">swap space</span><span class="font25">. Swap space is located on slower but cheaper memory. Notice that, although hard disks are commonly used for swap space, their access times are one hundred thousand times slower.</span></p>
<p><a name="bookmark7048"></a><span class="font25">The swap space can be a file, a partition, or a combination of files and partitions. You can see the swap space with the </span><span class="font25" style="font-weight:bold;">free </span><span class="font25">command, or with </span><span class="font25" style="font-weight:bold;">cat /proc/swaps</span><span class="font25">.</span></p>
<p><span class="font19">paul@ubu1010:~$ free -o | grep -v Mem total &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;used &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free shared buffers cached</span></p>
<p><span class="font19">Swap: &nbsp;&nbsp;&nbsp;6384636 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;84988 &nbsp;&nbsp;&nbsp;6299648</span></p>
<p><span class="font19">paul@ubu1010:~$ cat /proc/swaps</span></p>
<p><span class="font19">Filename &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Type &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size &nbsp;&nbsp;&nbsp;&nbsp;Used &nbsp;&nbsp;Priority</span></p>
<p><span class="font19">/dev/sda3 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;partition &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6384636 84988 -1</span></p>
<p><span class="font25">The amount of swap space that you need depends heavily on the services that the computer provides.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7049"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7050"></a>18.2.2. creating a swap partition</span></h3></li></ul>
<p><a name="bookmark7051"></a><span class="font25"><a name="bookmark7052"></a><a name="bookmark7053"></a>You can activate or deactivate swap space with the </span><span class="font25" style="font-weight:bold;">swapon </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">swapoff </span><span class="font25">commands. New swap space can be created with the </span><span class="font25" style="font-weight:bold;">mkswap </span><span class="font25">command. The screenshot below shows the creation and activation of a swap partition.</span></p>
<p><span class="font19">root@RHELv4u4:~# fdisk -l 2&gt; /dev/null | grep hda</span></p>
<p><span class="font19">Disk /dev/hda: 536 MB, 536870912 bytes</span></p>
<p><span class="font19">/dev/hda1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1040 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;524128+ &nbsp;83 Linux</span></p>
<p><span class="font19">root@RHELv4u4:~# mkswap /dev/hda1</span></p>
<p><span class="font19">Setting up swapspace version 1, size = 536702 kB root@RHELv4u4:~# swapon /dev/hda1</span></p>
<p><span class="font25">Now you can see that </span><span class="font25" style="font-weight:bold;">/proc/swaps </span><span class="font25">displays all swap spaces separately, whereas the </span><span class="font25" style="font-weight:bold;">free -om </span><span class="font25">command only makes a human readable summary.</span></p>
<p><span class="font19">root@RHELv4u4:~# cat /proc/swaps</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Filename</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Type</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Size</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Used</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Priority</span></p></td></tr>
<tr><td colspan="2" style="vertical-align:top;">
<p><span class="font19">/dev/mapper/VolGroup00-LogVol01 partition</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1048568</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-1</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/hda1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">partition</span></p></td><td style="vertical-align:top;">
<p><span class="font19">524120</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-2</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">root@RHELv4u4:~# free -om</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">total &nbsp;&nbsp;&nbsp;&nbsp;used</span></p></td><td style="vertical-align:top;">
<p><span class="font19">free shared</span></p></td><td style="vertical-align:top;">
<p><span class="font19">buffers</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cached</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Mem: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;249 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;245</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">125</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">54</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Swap: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1535 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1535</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7054"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7055"></a>18.2.3. creating a swap file</span></h3></li></ul>
<h4><a name="bookmark7056"></a><span class="font25"><a name="bookmark7057"></a><a name="bookmark7058"></a><a name="bookmark7059"></a>Here is one more example showing you how to create a </span><span class="font25" style="font-weight:bold;">swap file</span><span class="font25">. On Solaris you can use </span><span class="font25" style="font-weight:bold;">mkfile </span><span class="font25">instead of </span><span class="font25" style="font-weight:bold;">dd</span><span class="font25">.</span></h4>
<p><span class="font19">root@RHELv4u4:~# dd if=/dev/zero of=/smallswapfile bs=1024 count=4096 4096+0 records in 4096+0 records out</span></p>
<p><span class="font19">root@RHELv4u4:~# mkswap /smallswapfile</span></p>
<p><span class="font19">Setting up swapspace version 1, size = 4190 kB</span></p>
<p><span class="font19">root@RHELv4u4:~# swapon /smallswapfile</span></p>
<p><span class="font19">root@RHELv4u4:~# cat /proc/swaps</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Filename</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Type</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Size</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Used</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Priority</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/mapper/VolGroup00-LogVol01</span></p></td><td style="vertical-align:top;">
<p><span class="font19">partition</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1048568</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-1</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/hda1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">partition</span></p></td><td style="vertical-align:top;">
<p><span class="font19">524120</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-2</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/smallswapfile</span></p></td><td style="vertical-align:top;">
<p><span class="font19">file</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4088</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-3</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7060"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7061"></a>18.2.4. swap space in /etc/fstab</span></h3></li></ul>
<h4><a name="bookmark7062"></a><span class="font25"><a name="bookmark7063"></a><a name="bookmark7064"></a>If you like these swaps to be permanent, then don't forget to add them to </span><span class="font25" style="font-weight:bold;">/etc/fstab</span><span class="font25">. The lines in /etc/fstab will be similar to the following.</span></h4>
<p><span class="font19">/dev/hda1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;swap &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;swap &nbsp;&nbsp;&nbsp;&nbsp;defaults &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 0</span></p>
<p><span class="font19">/smallswapfile &nbsp;&nbsp;&nbsp;swap &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;swap &nbsp;&nbsp;&nbsp;&nbsp;defaults &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 0</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7065"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6109"></a><a name="bookmark7066"></a>18.3. monitoring memory with vmstat</span></h2></li></ul>
<h4><a name="bookmark7067"></a><span class="font25"><a name="bookmark7068"></a><a name="bookmark7069"></a><a name="bookmark7070"></a>You can find information about </span><span class="font25" style="font-weight:bold;">swap usage </span><span class="font25">using </span><span class="font25" style="font-weight:bold;">vmstat</span><span class="font25">.</span><br><br><span class="font25"><a name="bookmark7071"></a>Below a simple </span><span class="font25" style="font-weight:bold;">vmstat </span><span class="font25">displaying information in megabytes.</span></h4>
<p><span class="font19">paul@ubu1010:~$ vmstat -S m</span></p>
<p><span class="font19">procs---------memory-----------swap-- -----io-----system-----cpu----</span></p>
<p><span class="font19">r &nbsp;b &nbsp;swpd &nbsp;free &nbsp;buff cache &nbsp;si &nbsp;&nbsp;so &nbsp;&nbsp;bi &nbsp;&nbsp;&nbsp;bo &nbsp;&nbsp;&nbsp;in &nbsp;&nbsp;cs us sy id wa</span></p>
<p><span class="font19">0 &nbsp;0 &nbsp;&nbsp;&nbsp;&nbsp;87 &nbsp;&nbsp;&nbsp;225 &nbsp;&nbsp;&nbsp;&nbsp;46 &nbsp;2097 &nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;&nbsp;2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5 &nbsp;&nbsp;&nbsp;&nbsp;14 &nbsp;&nbsp;&nbsp;&nbsp;8 &nbsp;6 &nbsp;5 89 &nbsp;1</span></p>
<h4><a name="bookmark7072"></a><span class="font25"><a name="bookmark7073"></a>Below a sample </span><span class="font25" style="font-weight:bold;">vmstat </span><span class="font25">when (in another terminal) root launches a </span><span class="font25" style="font-weight:bold;">find /</span><span class="font25">. It generates a lot of disk i/o (bi and bo are disk blocks in and out). There is no need for swapping here.</span></h4>
<p><span class="font19">paul@ubu1010:~$ vmstat 2 100</span></p>
<table border="1">
<tr><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">procs</span></p></td><td colspan="4" style="vertical-align:bottom;">
<p><span class="font19">----------memory---------- -</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">--swap--</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">-----io----</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">-system--</span></p></td><td colspan="4" style="vertical-align:bottom;">
<p><span class="font19">----cpu----</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">r</span></p></td><td style="vertical-align:top;">
<p><span class="font19">b</span></p></td><td style="vertical-align:top;">
<p><span class="font19">swpd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">free</span></p></td><td style="vertical-align:top;">
<p><span class="font19">buff</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cache</span></p></td><td style="vertical-align:top;">
<p><span class="font19">si</span></p></td><td style="vertical-align:top;">
<p><span class="font19">so</span></p></td><td style="vertical-align:top;">
<p><span class="font19">bi</span></p></td><td style="vertical-align:top;">
<p><span class="font19">bo</span></p></td><td style="vertical-align:top;">
<p><span class="font19">in</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cs</span></p></td><td style="vertical-align:top;">
<p><span class="font19">us</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sy</span></p></td><td style="vertical-align:top;">
<p><span class="font19">id</span></p></td><td style="vertical-align:top;">
<p><span class="font19">wa</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">84984</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1999436</span></p></td><td style="vertical-align:top;">
<p><span class="font19">53416</span></p></td><td style="vertical-align:top;">
<p><span class="font19">269536</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">10</span></p></td><td style="vertical-align:top;">
<p><span class="font19">6</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">89</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">84984</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1999428</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">53416</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">269564</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1713</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2748</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">92</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">84984</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1999552</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">53416</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">269564</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1672</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1838</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">90</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">84984</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1999552</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">53424</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">269560</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1587</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2526</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">87</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">84984</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1999180</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">53424</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">269580</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">100</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1748</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2193</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">6</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">91</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">84984</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1997800</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">54508</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">269760</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">610</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1836</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3890</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">17</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">68</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">84984</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1994620</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">55040</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">269748</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">250</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">168</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1724</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4365</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">19</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">17</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">56</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">9</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">84984</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1978508</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">55292</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">269704</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">126</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1957</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2897</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">19</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">18</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">58</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">84984</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1974608</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">58964</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">269784</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1826</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">478</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2605</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4355</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">44</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">41</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">84984</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1971260</span></p></td><td style="vertical-align:top;">
<p><span class="font19">62268</span></p></td><td style="vertical-align:top;">
<p><span class="font19">269728</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1634</span></p></td><td style="vertical-align:top;">
<p><span class="font19">756</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2257</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3865</span></p></td><td style="vertical-align:top;">
<p><span class="font19">7</span></p></td><td style="vertical-align:top;">
<p><span class="font19">7</span></p></td><td style="vertical-align:top;">
<p><span class="font19">47</span></p></td><td style="vertical-align:top;">
<p><span class="font19">39</span></p></td></tr>
</table>
<h4><a name="bookmark7074"></a><span class="font25"><a name="bookmark7075"></a>Below a sample </span><span class="font25" style="font-weight:bold;">vmstat </span><span class="font25">when executing (on RHEL6) a simple memory leaking program.</span><br><br><span class="font25"><a name="bookmark7076"></a>Now you see a lot of memory being swapped (si is 'swapped in').</span></h4>
<p><span class="font19">[paul@rhel6c ~]$ vmstat 2 100</span></p>
<table border="1">
<tr><td colspan="3" style="vertical-align:bottom;">
<p><span class="font19">procs -------</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">---memory---</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">---------swap</span></p></td><td colspan="3" style="vertical-align:bottom;">
<p><span class="font19">------io----</span></p></td><td colspan="7" style="vertical-align:bottom;">
<p><span class="font19">--system-- -----cpu-----</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">r</span></p></td><td style="vertical-align:top;">
<p><span class="font19">b</span></p></td><td style="vertical-align:top;">
<p><span class="font19">swpd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">free</span></p></td><td style="vertical-align:top;">
<p><span class="font19">buff</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cache</span></p></td><td style="vertical-align:top;">
<p><span class="font19">si</span></p></td><td style="vertical-align:top;">
<p><span class="font19">so</span></p></td><td style="vertical-align:top;">
<p><span class="font19">bi</span></p></td><td style="vertical-align:top;">
<p><span class="font19">bo</span></p></td><td style="vertical-align:top;">
<p><span class="font19">in</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cs</span></p></td><td style="vertical-align:top;">
<p><span class="font19">us</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sy</span></p></td><td style="vertical-align:top;">
<p><span class="font19">id</span></p></td><td style="vertical-align:top;">
<p><span class="font19">wa</span></p></td><td style="vertical-align:top;">
<p><span class="font19">st</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">245208</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5280</span></p></td><td style="vertical-align:top;">
<p><span class="font19">232</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1916</span></p></td><td style="vertical-align:top;">
<p><span class="font19">261</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">42</span></p></td><td style="vertical-align:top;">
<p><span class="font19">27</span></p></td><td style="vertical-align:top;">
<p><span class="font19">21</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">98</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">263372</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4800</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">72</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">908</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">143840</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">128</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1138</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">462</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">191</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">88</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">350672</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4792</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">56</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">992</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">169280</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">256</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1092</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">360</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">142</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">13</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">86</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">449584</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4788</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">56</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1024</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">95880</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">64</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">606</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">471</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">191</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">13</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">85</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">471968</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4828</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">56</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1140</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">44832</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">80</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">390</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">235</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">90</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">12</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">87</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">505960</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4764</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">56</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1136</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">68008</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">16</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">538</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">286</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">109</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">12</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">87</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
</table>
<h4><a name="bookmark7077"></a><span class="font25"><a name="bookmark7078"></a>The code below was used to simulate a memory leak (and force swapping). This code was found on wikipedia without author.</span></h4>
<p><span class="font19">paul@mac:~$ cat memleak.c</span></p>
<p><span class="font19">#include &lt;stdlib.h&gt;</span></p>
<p><span class="font19">int main(void)</span></p>
<p><span class="font19">{</span></p>
<p><span class="font19">while (malloc(50));</span></p>
<p><span class="font19">return 0;</span></p>
<p><span class="font19">}</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7079"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6110"></a><a name="bookmark7080"></a>18.4. practice : memory</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Use </span><span class="font25" style="font-weight:bold;">dmesg </span><span class="font25">to find the total amount of memory in your computer.</span></p></li>
<li>
<p><span class="font25">2. Use </span><span class="font25" style="font-weight:bold;">free </span><span class="font25">to display memory usage in kilobytes (then in megabytes).</span></p></li>
<li>
<p><span class="font25">3. On a virtual machine, create a swap partition (you might need an extra virtual disk for this).</span></p></li>
<li>
<p><span class="font25">4. Add a 20 megabyte swap file to the system.</span></p></li>
<li>
<p><span class="font25">5. Put all swap spaces in </span><span class="font25" style="font-weight:bold;">/etc/fstab </span><span class="font25">and activate them. Test with a reboot that they are mounted.</span></p></li>
<li>
<p><span class="font25">6. Use </span><span class="font25" style="font-weight:bold;">free </span><span class="font25">to verify usage of current swap.</span></p></li>
<li>
<p><span class="font25">7. (optional) Display the usage of swap with </span><span class="font25" style="font-weight:bold;">vmstat </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">free -s </span><span class="font25">during a memory leak.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7081"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6111"></a><a name="bookmark7082"></a>18.5. solution : memory</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Use </span><span class="font25" style="font-weight:bold;">dmesg </span><span class="font25">to find the total amount of memory in your computer.</span></p></li></ul>
<p><span class="font19">dmesg | grep Memory</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Use </span><span class="font25" style="font-weight:bold;">free </span><span class="font25">to display memory usage in kilobytes (then in megabytes). </span><span class="font19">free ; free -m</span></p></li>
<li>
<p><span class="font25">3. On a virtual machine, create a swap partition (you might need an extra virtual disk for this). </span><span class="font19">mkswap /dev/sddl ; swapon /dev/sddl</span></p></li>
<li>
<p><span class="font25">4. Add a 20 megabyte swap file to the system.</span></p></li></ul>
<p><span class="font19">dd if=/dev/zero of=/swapfile20mb bs=1024 count=20000</span></p>
<p><span class="font19">mkswap /swapfile20mb</span></p>
<p><span class="font19">swapon /swapfile20mb</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Put all swap spaces in </span><span class="font25" style="font-weight:bold;">/etc/fstab </span><span class="font25">and activate them. Test with a reboot that they are mounted.</span></p></li></ul>
<p><span class="font19">root@computer# tail -2 /etc/fstab /dev/sddl swap swap defaults 0 0</span></p>
<p><span class="font19">/swapfile20mb swap swap defaults 0 0</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Use </span><span class="font25" style="font-weight:bold;">free </span><span class="font25">to verify usage of current swap. </span><span class="font19">free -om</span></p></li>
<li>
<p><span class="font25">7. (optional) Display the usage of swap with </span><span class="font25" style="font-weight:bold;">vmstat </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">free -s </span><span class="font25">during a memory leak.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark7083"></a><span class="font11" style="font-weight:bold;"><a name="bookmark6112"></a><a name="bookmark7084"></a>Chapter 19. resource monitoring</span></h1></li></ul>
<p><span class="font25">Monitoring is the process of obtaining information about the utilization of memory, cpu, bandwidth and storage. You should start monitoring your system as soon as possible, to be able to create a </span><span class="font25" style="font-weight:bold;">baseline</span><span class="font25">. Make sure that you get to know your system! This baseline is important because it allows you to see a steady or sudden growth in </span><span class="font25" style="font-weight:bold;">resource utilization </span><span class="font25">and likewise steady (or sudden) decline in </span><span class="font25" style="font-weight:bold;">resource availability</span><span class="font25">. It will allow you to plan for scaling up or scaling out.</span></p>
<p><a name="bookmark7085"></a><span class="font25"><a name="bookmark7086"></a><a name="bookmark7087"></a><a name="bookmark7088"></a>Let us look at some tools that go beyond </span><span class="font25" style="font-weight:bold;">ps fax</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">df -h</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">free -om </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">du -sh</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7089"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6113"></a><a name="bookmark7090"></a>19.1. four basic resources</span></h2></li></ul>
<p><span class="font25">The four basic resources to monitor are:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font24">• cpu</span></p></li>
<li>
<p><span class="font24">• network</span></p></li>
<li>
<p><span class="font24">• ram memory</span></p></li>
<li>
<p><span class="font24">• storage</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7091"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6114"></a><a name="bookmark7092"></a>19.2. top</span></h2></li></ul>
<p><a name="bookmark7093"></a><span class="font25">To start monitoring, you can use </span><span class="font25" style="font-weight:bold;">top</span><span class="font25">. This tool will monitor ram memory, cpu and swap. Top will automatically refresh. Inside </span><span class="font25" style="font-weight:bold;">top </span><span class="font25">you can use many commands, like </span><span class="font25" style="font-weight:bold;">k </span><span class="font25">to kill processes, or </span><span class="font25" style="font-weight:bold;">t </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">m </span><span class="font25">to toggle displaying task and memory information, or the number </span><span class="font25" style="font-weight:bold;">1 </span><span class="font25">to have one line per cpu, or one summary line for all cpu's.</span></p>
<table border="1">
<tr><td colspan="5" style="vertical-align:top;">
<p><span class="font19">top - 12:23:16 up 2 days,</span></p></td><td rowspan="3" style="vertical-align:top;">
<p><span class="font19">4:01,</span></p>
<p><span class="font19">-ng, 0.0%</span></p>
<p><span class="font19">10952k</span></p>
<p><span class="font19">144k</span></p></td><td rowspan="3" style="vertical-align:top;">
<p><span class="font19">2</span></p>
<p><span class="font19">60 ni</span></p>
<p><span class="font19">us</span></p>
<p><span class="font19">us</span></p></td><td colspan="4" style="vertical-align:top;">
<p><span class="font19">users, load average: 0</span></p></td><td rowspan="3" style="vertical-align:top;">
<p><span class="font19">.00, 0.00, 0.00 0 zombie</span></p>
<p><span class="font19">.0% hi, 0.0% si 59024k buffers 112356k cached</span></p></td></tr>
<tr><td rowspan="2" style="vertical-align:top;">
<p><span class="font19">Tasks: Cpu(s): Mem: Swap:</span></p></td><td rowspan="2" style="vertical-align:top;">
<p><span class="font19">61</span></p>
<p><span class="font19">0.</span></p>
<p><span class="font19">255</span></p>
<p><span class="font19">524</span></p></td><td rowspan="2" style="vertical-align:top;">
<p><span class="font19">total 3% us 972k 280k</span></p></td><td rowspan="2" style="vertical-align:top;">
<p><span class="font19">, 1 , 0. total total</span></p></td><td rowspan="2" style="vertical-align:top;">
<p><span class="font19">runni 5% sy, , 24</span></p>
<p><span class="font19">,</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">sleeping</span></p></td><td rowspan="2" style="vertical-align:top;">
<p><span class="font19">, 0 id, 0. 5020k 4136k</span></p></td><td rowspan="2" style="vertical-align:top;">
<p><span class="font19">stopped, 2% wa, 0 free, free,</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">, 98 ed, ed,</span></p></td><td style="vertical-align:top;">
<p><span class="font19">.9%</span></p>
<p><span class="font19">1</span></p>
<p><span class="font19">52</span></p></td></tr>
<tr><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">PID USER</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">PR</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">NI</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">VIRT</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">RES</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">SHR S</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">%CPU</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">%MEM</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">TIME+</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">COMMAND</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1 root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">16</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2816</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">560</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">480</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">S</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0:00.91</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">init</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">2 root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">34</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">19</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">S</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0:00.01</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ksoftirqd/0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">3 root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">-10</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">S</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0:00.57</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">events/0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">4 root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-10</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">S</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00.00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">khelper</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">5 root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">15</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-10</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">S</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00.00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">kacpid</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">16 root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-10</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">S</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00.08</span></p></td><td style="vertical-align:top;">
<p><span class="font19">kblockd/0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">26 root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">15</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">S</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:02.86</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pdflush</span></p></td></tr>
</table>
<p><span class="font25">You can customize top to display the columns of your choice, or to display only the processes that you find interesting.</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ top p 3456 p 8732 p 9654</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7094"></a><span class="font10" style="font-weight:bold;"><a name="bookmark1594"></a><a name="bookmark7095"></a>19.3. free</span></h2></li></ul>
<p><a name="bookmark7096"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">free </span><span class="font25">command is common on Linux to monitor free memory. You can use free to display information every x seconds, but the output is not ideal.</span></p>
<table border="1">
<tr><td colspan="2" style="vertical-align:top;">
<p><span class="font19">[paul@RHELv4u3 gen]$</span></p></td><td style="vertical-align:top;">
<p><span class="font19">free -om</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-s 10</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">total</span></p></td><td style="vertical-align:top;">
<p><span class="font19">used</span></p></td><td style="vertical-align:top;">
<p><span class="font19">free</span></p></td><td style="vertical-align:top;">
<p><span class="font19">shared</span></p></td><td style="vertical-align:top;">
<p><span class="font19">buffers</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cached</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Mem:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">249</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">222</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">27</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">50</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">109</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Swap:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">511</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">511</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">total</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">used</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">free</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">shared</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">buffers</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">cached</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Mem:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">249</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">222</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">27</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">50</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">109</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Swap:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">511</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">511</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
</table>
<p><span class="font19">[paul@RHELv4u3 gen]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7097"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6116"></a><a name="bookmark7098"></a>19.4. watch</span></h2></li></ul>
<p><a name="bookmark7099"></a><span class="font25">It might be more interesting to combine free with the </span><span class="font25" style="font-weight:bold;">watch </span><span class="font25">program. This program can run commands with a delay, and can highlight changes (with the -d switch).</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ watch -d -n 3 free -om</span></p>
<p><span class="font19">...</span></p>
<p><span class="font19">Every 3.0s: free -om &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sat Jan 27 12:13:03 2007</span></p>
<p><span class="font19">total &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;used &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free shared buffers cached</span></p>
<p><span class="font19">Mem: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;249 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;230 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;19 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;56 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;109</span></p>
<p><span class="font19">Swap: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;511 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;511</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7100"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6117"></a><a name="bookmark7101"></a>19.5. vmstat</span></h2></li></ul>
<p><a name="bookmark7102"></a><span class="font25">To monitor CPU, disk and memory statistics in one line there is </span><span class="font25" style="font-weight:bold;">vmstat</span><span class="font25">. The screenshot below shows vmstat running every two seconds 100 times (or until the Ctrl-C). Below the r, you see the number of processes waiting for the CPU, sleeping processes go below b. Swap usage (swpd) stayed constant at 144 kilobytes, free memory dropped from 16.7MB to 12.9MB. See man vmstat for the rest.</span></p>
<p><span class="font19">[paul@RHELv4u3 ~]$ vmstat 2 100</span></p>
<table border="1">
<tr><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">procs</span></p></td><td style="vertical-align:middle;">
<p><span class="font4">—</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">-----memory—</span></p></td><td style="vertical-align:middle;">
<p><span class="font4">—</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">--swap--</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">----</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">-io—</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">- --system--</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">- --</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">- -cpu--</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">_ _</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">r</span></p></td><td style="vertical-align:top;">
<p><span class="font19">b</span></p></td><td style="vertical-align:top;">
<p><span class="font19">swpd</span></p></td><td style="vertical-align:top;">
<p><span class="font19">free</span></p></td><td style="vertical-align:top;">
<p><span class="font19">buff</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cache</span></p></td><td style="vertical-align:top;">
<p><span class="font19">si</span></p></td><td style="vertical-align:top;">
<p><span class="font19">so</span></p></td><td style="vertical-align:top;">
<p><span class="font19">bi</span></p></td><td style="vertical-align:top;">
<p><span class="font19">bo</span></p></td><td style="vertical-align:top;">
<p><span class="font19">in</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cs</span></p></td><td style="vertical-align:top;">
<p><span class="font19">us</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sy</span></p></td><td style="vertical-align:top;">
<p><span class="font19">id</span></p></td><td style="vertical-align:top;">
<p><span class="font19">wa</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">144</span></p></td><td style="vertical-align:top;">
<p><span class="font19">16708</span></p></td><td style="vertical-align:top;">
<p><span class="font19">58212</span></p></td><td style="vertical-align:top;">
<p><span class="font19">111612</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4</span></p></td><td style="vertical-align:top;">
<p><span class="font19">75</span></p></td><td style="vertical-align:top;">
<p><span class="font19">62</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">99</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">144</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">16708</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">58212</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">111612</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">976</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">22</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">100</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">144</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">16708</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">58212</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">111612</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">958</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">99</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">144</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">16528</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">58212</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">111612</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">18</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1432</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7417</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">32</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">66</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">144</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">16468</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">58212</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">111612</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2910</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">20048</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">95</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">144</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">16408</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">58212</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">111612</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3210</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">19509</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">97</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">144</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15568</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">58816</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">111612</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">300</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1632</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2423</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10189</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">62</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">36</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">144</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">13648</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">60324</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">111612</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">754</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1910</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2843</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">27</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">72</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">144</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">12928</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">60948</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">111612</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">312</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">418</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1346</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1258</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">57</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">29</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">144</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">12928</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">60948</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">111612</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">977</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">19</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">100</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">144</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">12988</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">60948</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">111612</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">977</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">100</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">144</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">12988</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">60948</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">111612</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">978</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">18</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">100</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
</table>
<p><span class="font19">[paul@RHELv4u3 ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7103"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6118"></a><a name="bookmark7104"></a>19.6. iostat</span></h2></li></ul>
<h4><a name="bookmark7105"></a><span class="font25"><a name="bookmark7106"></a><a name="bookmark7107"></a>The </span><span class="font25" style="font-weight:bold;">iostat </span><span class="font25">tool can display disk and cpu statistics. The -d switch below makes iostat only display disk information (500 times every two seconds). The first block displays statistics since the last reboot.</span></h4>
<p><span class="font19">[paul@RHELv4u3 ~]$ iostat -d 2 500</span></p>
<p><span class="font19">Linux 2.6.9-34.EL (RHELv4u3.localdomain) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;01/27/2007</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Device:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tps</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Blk_read/s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Blk_wrtn/s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Blk_read</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Blk_wrtn</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">hdc</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.01</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1080</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sda</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.52</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5.07</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7.78</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">941798</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1445148</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sda1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.01</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">968</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sda2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1.13</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5.06</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7.78</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">939862</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1445144</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">dm-0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1.13</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5.05</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7.77</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">939034</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1444856</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">dm-1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">360</span></p></td><td style="vertical-align:top;">
<p><span class="font19">288</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Device:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tps</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Blk_read/s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Blk_wrtn/s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Blk_read</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Blk_wrtn</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">hdc</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sda</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sda1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sda2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">dm-0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">dm-1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
</table>
<p><span class="font19">[paul@RHELv4u3 ~]$</span></p>
<h4><a name="bookmark7108"></a><span class="font25"><a name="bookmark7109"></a>You can have more statistics using </span><span class="font25" style="font-weight:bold;">iostat -d -x</span><span class="font25">, or display only cpu statistics with </span><span class="font25" style="font-weight:bold;">iostat -c</span><span class="font25">.</span></h4>
<p><span class="font19">[paul@RHELv4u3 ~]$ iostat -c 5 500</span></p>
<p><span class="font19">Linux 2.6.9-34.EL (RHELv4u3.localdomain) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;01/27/2007</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">avg-cpu:</span></p>
<p><span class="font19">0.31</span></p></td><td style="vertical-align:top;">
<p><span class="font19">: %user %nice &nbsp;&nbsp;&nbsp;%sys</span></p>
<p><span class="font19">0.02 &nbsp;&nbsp;&nbsp;0.52 &nbsp;&nbsp;&nbsp;0.23</span></p></td><td style="vertical-align:top;">
<p><span class="font19">%iowait</span></p>
<p><span class="font19">98.92</span></p></td><td style="vertical-align:top;">
<p><span class="font19">%idle</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">avg-cpu:</span></p>
<p><span class="font19">0.62</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">: %user %nice &nbsp;&nbsp;&nbsp;%sys</span></p>
<p><span class="font19">0.00 &nbsp;&nbsp;52.16 &nbsp;&nbsp;47.23</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">%iowait 0.00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">%idle</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">avg-cpu:</span></p>
<p><span class="font19">2.92</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">: %user %nice &nbsp;&nbsp;&nbsp;%sys</span></p>
<p><span class="font19">0.00 &nbsp;&nbsp;36.95 &nbsp;&nbsp;60.13</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">%iowait 0.00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">%idle</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">avg-cpu:</span></p>
<p><span class="font19">0.63</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">: %user %nice &nbsp;&nbsp;&nbsp;%sys</span></p>
<p><span class="font19">0.00 &nbsp;&nbsp;36.63 &nbsp;&nbsp;62.32</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">%iowait 0.42</span></p></td><td style="vertical-align:top;">
<p><span class="font19">%idle</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">avg-cpu:</span></p>
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">: %user %nice &nbsp;&nbsp;&nbsp;%sys</span></p>
<p><span class="font19">0.00 &nbsp;&nbsp;&nbsp;0.20 &nbsp;&nbsp;&nbsp;0.20</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">%iowait</span></p>
<p><span class="font19">99.59</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">%idle</span></p></td></tr>
</table>
<p><span class="font19">[paul@RHELv4u3 ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7110"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6119"></a><a name="bookmark7111"></a>19.7. mpstat</span></h2></li></ul>
<p><a name="bookmark7112"></a><span class="font25">On multi-processor machines, </span><span class="font25" style="font-weight:bold;">mpstat </span><span class="font25">can display statistics for all, or for a selected cpu.</span></p>
<p><span class="font19">paul@laika:~$ mpstat -P ALL</span></p>
<p><span class="font19">Linux 2.6.20-3-generic (laika) 02/09/2007</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">CPU</span></p></td><td style="vertical-align:top;">
<p><span class="font19">%user</span></p></td><td style="vertical-align:top;">
<p><span class="font19">%nice</span></p></td><td style="vertical-align:top;">
<p><span class="font19">%sys</span></p></td><td style="vertical-align:top;">
<p><span class="font19">%iowait</span></p></td><td style="vertical-align:top;">
<p><span class="font19">%irq</span></p></td><td style="vertical-align:top;">
<p><span class="font19">%soft</span></p></td><td style="vertical-align:top;">
<p><span class="font19">%steal</span></p></td><td style="vertical-align:top;">
<p><span class="font19">%idle</span></p></td><td style="vertical-align:top;">
<p><span class="font19">intr/s</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">all</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1.77</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.03</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1.37</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1.03</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.02</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.39</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">95.40</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1304.91</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1.73</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.02</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1.47</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1.93</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.04</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.77</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">94.04</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1304.91</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1.81</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.03</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1.27</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.13</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">96.76</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.00</span></p></td></tr>
</table>
<p><span class="font19">paul@laika:~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7113"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6120"></a><a name="bookmark7114"></a>19.8. sadc and sar</span></h2></li></ul>
<p><a name="bookmark7115"></a><span class="font25"><a name="bookmark7116"></a><a name="bookmark7117"></a><a name="bookmark7118"></a>The </span><span class="font25" style="font-weight:bold;">sadc </span><span class="font25">tool writes system utilization data to </span><span class="font25" style="font-weight:bold;">/var/log/sa/sa??</span><span class="font25">, where ?? is replaced with the current day of the month. By default, cron runs the </span><span class="font25" style="font-weight:bold;">sal </span><span class="font25">script every 10 minutes,<a name="bookmark7119"></a> the sal script runs sadc for one second. Just before midnight every day, cron runs the </span><span class="font25" style="font-weight:bold;">sa2 </span><span class="font25">script, which in turn invokes </span><span class="font25" style="font-weight:bold;">sar</span><span class="font25">. The sar tool will read the daily data generated by sadc and put it in /var/log/sa/sar??. These </span><span class="font25" style="font-weight:bold;">sar reports </span><span class="font25">contain a lot of statistics.</span></p>
<p><span class="font25">You can also use sar to display a portion of the statistics that were gathered. Like this example for cpu statistics.</span></p>
<table border="1">
<tr><td colspan="2" style="vertical-align:top;">
<p><span class="font19">[paul@RHELv4u3 Linux 2.6.9-34.</span></p></td><td colspan="3" style="vertical-align:top;">
<p><span class="font19">sa]$ sar -u | head</span></p>
<p><span class="font19">.EL (RHELv4u3.localdomain)</span></p></td><td colspan="3" style="vertical-align:middle;">
<p><span class="font19">01/27/2007</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">12:00:01</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">AM</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">CPU</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">%user</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">%nice</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">%system</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">%iowait</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">%idle</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">12:10:01</span></p></td><td style="vertical-align:top;">
<p><span class="font19">AM</span></p></td><td style="vertical-align:top;">
<p><span class="font19">all</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.48</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.01</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.60</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.04</span></p></td><td style="vertical-align:top;">
<p><span class="font19">98.87</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">12:20:01</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">AM</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">all</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.49</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.01</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.60</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.06</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">98.84</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">12:30:01</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">AM</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">all</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.49</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.01</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.64</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.25</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">98.62</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">12:40:02</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">AM</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">all</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.44</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.01</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.62</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.07</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">98.86</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">12:50:01</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">AM</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">all</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.42</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.01</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.60</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.10</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">98.87</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">01:00:01</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">AM</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">all</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.47</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.01</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.65</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.08</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">98.80</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">01:10:01</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">AM</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">all</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.45</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.01</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.68</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.08</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">98.78</span></p></td></tr>
<tr><td colspan="2" style="vertical-align:top;">
<p><span class="font19">[paul@RHELv4u3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sa]$</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
</table>
<p><a name="bookmark7120"></a><span class="font25">There are other useful sar options, like </span><span class="font25" style="font-weight:bold;">sar -I PROC </span><span class="font25">to display interrupt activity per interrupt and per CPU, or </span><span class="font25" style="font-weight:bold;">sar -r </span><span class="font25">for memory related statistics. Check the manual page of sar for more.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7121"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6121"></a><a name="bookmark7122"></a>19.9. ntop</span></h2></li></ul>
<h4><a name="bookmark7123"></a><span class="font25"><a name="bookmark7124"></a><a name="bookmark7125"></a>The </span><span class="font25" style="font-weight:bold;">ntop </span><span class="font25">tool is not present in default Red Hat installs. Once run, it will generate a very extensive analysis of network traffic in html on </span><a href="http://localhost:3000"><span class="font25">http://localhost:3000</span></a><span class="font25"> .</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7126"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6122"></a><a name="bookmark7127"></a>19.10. iftop</span></h2></li></ul>
<h4><a name="bookmark7128"></a><span class="font25"><a name="bookmark7129"></a><a name="bookmark7130"></a>The </span><span class="font25" style="font-weight:bold;">iftop </span><span class="font25">tool will display bandwidth by socket statistics for a specific network device. Not available on default Red Hat servers.</span></h4>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">1.91Mb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3.81Mb</span></p>
<p><span class="font19">I</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5.72Mb</span></p>
<p><span class="font19">I</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7.</span></p>
<p><span class="font19">I</span></p></td><td colspan="3" style="vertical-align:top;">
<p><span class="font19">.63Mb 9.54Mb</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">laika.local</span></p></td><td style="vertical-align:top;">
<p><span class="font19">—1------</span></p>
<p><span class="font19">= &gt;</span></p></td><td style="vertical-align:top;">
<p><span class="font19">------------------------------------------------------------------------------1------------------------------------------------------------------------------------------------------------------- barry</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-------|<sup>-</sup></span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4.94Kb</span></p></td><td style="vertical-align:top;">
<p><span class="font19">n----</span></p>
<p><span class="font19">6.65Kb</span></p></td><td style="vertical-align:top;">
<p><span class="font19">----------------1-------------------------------</span></p>
<p><span class="font19">69.9Kb</span></p></td></tr>
<tr><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">&lt; =</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">7.41Kb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">16.4Kb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">766Kb</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">laika.local</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">= &gt;</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ik-in-f19.google.</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">com</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1.58Kb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14.4Kb</span></p></td></tr>
<tr><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">&lt; =</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">0b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">292b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">41.0Kb</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">laika.local</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">= &gt;</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ik-in-f99.google.</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">com</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">83b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4.01Kb</span></p></td></tr>
<tr><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">&lt; =</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">0b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">83b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">39.8Kb</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">laika.local</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">= &gt;</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ug-in-f189.google</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">.com</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">42b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">664b</span></p></td></tr>
<tr><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">&lt; =</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">0b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">42b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">406b</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">laika.local</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">= &gt;</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10.0.0.138</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">0b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">149b</span></p></td></tr>
<tr><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">&lt; =</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">0b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">256b</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">laika.local</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">= &gt;</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">224.0.0.251</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">0b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">86b</span></p></td></tr>
<tr><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">&lt; =</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">0b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0b</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">laika.local</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">= &gt;</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ik-in-f83.google.</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">com</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0b</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">39b</span></p></td></tr>
<tr><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">&lt; =</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">0b</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0b</span></p></td><td style="vertical-align:top;">
<p><span class="font19">21b</span></p></td></tr>
</table>
<h2><a name="bookmark7131"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6123"></a><a name="bookmark7132"></a>19.11. iptraf</span></h2>
<h4><a name="bookmark7133"></a><span class="font25"><a name="bookmark7134"></a>Use </span><span class="font25" style="font-weight:bold;">iptraf </span><span class="font25">for a colourful display of ip traffic over the network cards.</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[root@centos65</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~]#</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">iptraf</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">[root@centos65</span></p></td><td style="vertical-align:top;">
<p><span class="font19">~]#</span></p></td><td style="vertical-align:top;">
<p><span class="font19">iptraf -i eth0</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7135"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6124"></a><a name="bookmark7136"></a>19.12. nmon</span></h2></li></ul>
<h4><a name="bookmark7137"></a><span class="font25"><a name="bookmark7138"></a>Another popular and all round tool is </span><span class="font25" style="font-weight:bold;">nmon</span><span class="font25">.</span></h4>
<div><img src="linux_guide_files/The Complete Linux Guide-141.jpg" alt="" style="width:401pt;height:238pt;">
</div><br clear="all">
<ul style="list-style:none;"><li>
<h2><a name="bookmark7139"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6125"></a><a name="bookmark7140"></a>19.13. htop</span></h2></li></ul>
<h4><a name="bookmark7141"></a><span class="font25"><a name="bookmark7142"></a>You can use </span><span class="font25" style="font-weight:bold;">htop </span><span class="font25">instead of top.</span></h4>
<div>
<p><span class="font3">4 [ MemllllllllllHI Swp[</span></p>
</div><br clear="all">
<div>
<p><span class="font3">2.B%]</span></p>
<p><span class="font3">51.6%]</span></p>
<p><span class="font3">51.3%]</span></p>
<p><span class="font3">1.3%]</span></p>
<p><span class="font3">723/7914MB]</span></p>
<p><span class="font3">0/ailB]</span></p>
</div><br clear="all">
<div>
<ul style="list-style:none;"><li>
<p><span class="font3">5 [ II I I I II I I I II I I I</span></p></li>
<li>
<p><span class="font19" style="font-weight:bold;">6 [</span></p></li></ul>
<p><span class="font3" style="font-style:italic;">1 [</span></p>
<p><span class="font3">e [ Illi</span></p>
<p><span class="font3">Tasks: 83, 167 thr; 1 running Load average: 8.66 8.34 6.26 Uptime: 65:13:63</span></p>
</div><br clear="all">
<div>
<p><span class="font17" style="font-weight:bold;">46.7%]</span></p>
<p><span class="font3">2.6%]</span></p>
<p><span class="font3">2.0%]</span></p>
<p><span class="font3">12. DM</span></p>
</div><br clear="all">
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font3">| PID</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">USER</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">PRI</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">NI</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">VIRT</span></p></td><td style="vertical-align:bottom;">
<p><span class="font2">RES</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">SHR</span></p></td><td style="vertical-align:bottom;">
<p><span class="font4">s</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font3">CPU% MEM%</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">TIME+</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">Command</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font3">19415</span></p></td><td style="vertical-align:bottom;">
<p><span class="font15" style="font-weight:bold;">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">20</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">2270M</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">423M</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">388M</span></p></td><td style="vertical-align:bottom;">
<p><span class="font4">s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">2.0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">5.4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">2:11.71</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">/usr/lib/virtualbox/Vir</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font3">26485</span></p></td><td style="vertical-align:top;">
<p><span class="font16">root</span></p></td><td style="vertical-align:top;">
<p><span class="font3">20</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0</span></p></td><td style="vertical-align:top;">
<p><span class="font3">24732</span></p></td><td style="vertical-align:top;">
<p><span class="font3">2496</span></p></td><td style="vertical-align:top;">
<p><span class="font3">1444</span></p></td><td style="vertical-align:top;">
<p><span class="font4">R</span></p></td><td style="vertical-align:top;">
<p><span class="font3">1.3</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0.0</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0:00.54</span></p></td><td style="vertical-align:top;">
<p><span class="font3">htop</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font3">3375</span></p></td><td style="vertical-align:bottom;">
<p><span class="font15" style="font-weight:bold;">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">20</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">543M</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">19156</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">12140</span></p></td><td style="vertical-align:bottom;">
<p><span class="font4">s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0.7</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0.2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0:35.59</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">xfce4-terminal</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font3">26495</span></p></td><td style="vertical-align:bottom;">
<p><span class="font15" style="font-weight:bold;">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">20</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">379M</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">13684</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">10676</span></p></td><td style="vertical-align:bottom;">
<p><span class="font4">s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0.7</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0.2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0:08.08</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">xfce4-screenshooter</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font3">19427</span></p></td><td style="vertical-align:top;">
<p><span class="font15" style="font-weight:bold;">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font3">20</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0</span></p></td><td style="vertical-align:top;">
<p><span class="font3">2270M</span></p></td><td style="vertical-align:top;">
<p><span class="font3">423M</span></p></td><td style="vertical-align:top;">
<p><span class="font3">388M</span></p></td><td style="vertical-align:top;">
<p><span class="font4">s</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0.7</span></p></td><td style="vertical-align:top;">
<p><span class="font3">5.4</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0:15.51</span></p></td><td style="vertical-align:top;">
<p><span class="font3">/usr/lib/virtualbox/Vir</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font3">19264</span></p></td><td style="vertical-align:top;">
<p><span class="font15" style="font-weight:bold;">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font3">20</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0</span></p></td><td style="vertical-align:top;">
<p><span class="font3">1005M</span></p></td><td style="vertical-align:top;">
<p><span class="font3">41668</span></p></td><td style="vertical-align:top;">
<p><span class="font3">30172</span></p></td><td style="vertical-align:top;">
<p><span class="font4">s</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0.7</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0.5</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0:11.68</span></p></td><td style="vertical-align:top;">
<p><span class="font3">/usr/lib/virtualbox/Vir</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font3">2714</span></p></td><td style="vertical-align:bottom;">
<p><span class="font16">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">20</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">196M</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">26704</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">13984</span></p></td><td style="vertical-align:bottom;">
<p><span class="font4">s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0.0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0.3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">3:46.55</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">/usr/bin/X :0 vt7 -noli</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font3">19448</span></p></td><td style="vertical-align:top;">
<p><span class="font15" style="font-weight:bold;">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font3">20</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0</span></p></td><td style="vertical-align:top;">
<p><span class="font3">2270M</span></p></td><td style="vertical-align:top;">
<p><span class="font3">423M</span></p></td><td style="vertical-align:top;">
<p><span class="font3">388M</span></p></td><td style="vertical-align:top;">
<p><span class="font4">s</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0.0</span></p></td><td style="vertical-align:top;">
<p><span class="font3">5.4</span></p></td><td style="vertical-align:top;">
<p><span class="font3">1:00.14</span></p></td><td style="vertical-align:top;">
<p><span class="font3">/usr/lib/virtualbox/Vir</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font3">19279</span></p></td><td style="vertical-align:top;">
<p><span class="font15" style="font-weight:bold;">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font3">20</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0</span></p></td><td style="vertical-align:top;">
<p><span class="font3">636M</span></p></td><td style="vertical-align:top;">
<p><span class="font3">12128</span></p></td><td style="vertical-align:top;">
<p><span class="font3">7624</span></p></td><td style="vertical-align:top;">
<p><span class="font4">s</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0.0</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0.1</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0:12.83</span></p></td><td style="vertical-align:top;">
<p><span class="font3">/usr/lib/virtualbox/VBo</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font3">19462</span></p></td><td style="vertical-align:top;">
<p><span class="font15" style="font-weight:bold;">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font3">20</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0</span></p></td><td style="vertical-align:top;">
<p><span class="font3">2270M</span></p></td><td style="vertical-align:top;">
<p><span class="font3">423M</span></p></td><td style="vertical-align:top;">
<p><span class="font3">388M</span></p></td><td style="vertical-align:top;">
<p><span class="font4">s</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0.0</span></p></td><td style="vertical-align:top;">
<p><span class="font3">5.4</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0:10.92</span></p></td><td style="vertical-align:top;">
<p><span class="font3">/usr/lib/virtualbox/Vir</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font3">3044</span></p></td><td style="vertical-align:top;">
<p><span class="font15" style="font-weight:bold;">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font3">20</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0</span></p></td><td style="vertical-align:top;">
<p><span class="font3">591M</span></p></td><td style="vertical-align:top;">
<p><span class="font3">30132</span></p></td><td style="vertical-align:top;">
<p><span class="font3">12868</span></p></td><td style="vertical-align:top;">
<p><span class="font4">s</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0.0</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0.4</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0:01.69</span></p></td><td style="vertical-align:top;">
<p><span class="font3">xfdesktop --display :0.</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font3">19274</span></p></td><td style="vertical-align:top;">
<p><span class="font15" style="font-weight:bold;">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font3">20</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0</span></p></td><td style="vertical-align:top;">
<p><span class="font3">103M</span></p></td><td style="vertical-align:top;">
<p><span class="font3">6048</span></p></td><td style="vertical-align:top;">
<p><span class="font3">3820</span></p></td><td style="vertical-align:top;">
<p><span class="font4">s</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0.0</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0.1</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0:06.19</span></p></td><td style="vertical-align:top;">
<p><span class="font3">/usr/lib/virtualbox/VBo</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font3">19281</span></p></td><td style="vertical-align:top;">
<p><span class="font3">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font3">20</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0</span></p></td><td style="vertical-align:top;">
<p><span class="font3">636M</span></p></td><td style="vertical-align:top;">
<p><span class="font3">12128</span></p></td><td style="vertical-align:top;">
<p><span class="font3">7624</span></p></td><td style="vertical-align:top;">
<p><span class="font4">s</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0.0</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0.1</span></p></td><td style="vertical-align:top;">
<p><span class="font3">8:05.49</span></p></td><td style="vertical-align:top;">
<p><span class="font3">/usr/lib/virtualbox/VBo</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font3">3481</span></p></td><td style="vertical-align:bottom;">
<p><span class="font15" style="font-weight:bold;">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">20</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">30356</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">6328</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">1208</span></p></td><td style="vertical-align:bottom;">
<p><span class="font4">s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0.0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0.1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0:13.10</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">tmux</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font3">3038</span></p></td><td style="vertical-align:bottom;">
<p><span class="font15" style="font-weight:bold;">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">20</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">193M</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">12924</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">9728</span></p></td><td style="vertical-align:bottom;">
<p><span class="font4">s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0.0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0.2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0:05.62</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">xfwm4 --display :0.0 --</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font3">19426</span></p></td><td style="vertical-align:top;">
<p><span class="font15" style="font-weight:bold;">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font3">20</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0</span></p></td><td style="vertical-align:top;">
<p><span class="font3">2270M</span></p></td><td style="vertical-align:top;">
<p><span class="font3">423M</span></p></td><td style="vertical-align:top;">
<p><span class="font3">388M</span></p></td><td style="vertical-align:top;">
<p><span class="font4">s</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0.0</span></p></td><td style="vertical-align:top;">
<p><span class="font3">5.4</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0:03.55</span></p></td><td style="vertical-align:top;">
<p><span class="font3">/usr/lib/virtualbox/Vir</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font3">3027</span></p></td><td style="vertical-align:top;">
<p><span class="font15" style="font-weight:bold;">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font3">20</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0</span></p></td><td style="vertical-align:top;">
<p><span class="font3">263M</span></p></td><td style="vertical-align:top;">
<p><span class="font3">8592</span></p></td><td style="vertical-align:top;">
<p><span class="font3">5812</span></p></td><td style="vertical-align:top;">
<p><span class="font4">s</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0.0</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0.1</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0:00.67</span></p></td><td style="vertical-align:top;">
<p><span class="font3">x-session-manager</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font3">19276</span></p></td><td style="vertical-align:bottom;">
<p><span class="font15" style="font-weight:bold;">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">20</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">1005M</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">41668</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">30172</span></p></td><td style="vertical-align:bottom;">
<p><span class="font4">s</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0.0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0.5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">0:02.75</span></p></td><td style="vertical-align:bottom;">
<p><span class="font3">/usr/lib/virtualbox/Vir</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font3">3042</span></p></td><td style="vertical-align:top;">
<p><span class="font15" style="font-weight:bold;">paul___</span></p></td><td style="vertical-align:top;">
<p><span class="font3">20</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0</span></p></td><td style="vertical-align:top;">
<p><span class="font3">491M</span></p></td><td style="vertical-align:top;">
<p><span class="font3">19132</span></p></td><td style="vertical-align:top;">
<p><span class="font3">12936</span></p></td><td style="vertical-align:top;">
<p><span class="font4">s</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0.0</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0.2</span></p></td><td style="vertical-align:top;">
<p><span class="font3">0:03.68</span></p></td><td style="vertical-align:top;">
<p><span class="font3">xfce4-panel --display :</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font3">iJlHel c</span></p></td><td colspan="5" style="vertical-align:top;">
<p><span class="font3">■F2EnWlF3ETTTWilF4|Jl TnF5|T</span></p></td><td style="vertical-align:top;">
<p><span class="font3">ree £</span></p></td><td colspan="2" style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font3">HNice</span></p></td><td colspan="2" style="vertical-align:top;">
<p><span class="font3">-[adNice +®Kill BEOuit</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h1><a name="bookmark7143"></a><span class="font11" style="font-weight:bold;"><a name="bookmark6126"></a><a name="bookmark7144"></a>Chapter 20. package management</span></h1></li></ul>
<p><a name="bookmark7145"></a><span class="font25"><a name="bookmark7146"></a>Most Linux distributions have a </span><span class="font25" style="font-weight:bold;">package management </span><span class="font25">system with online </span><span class="font25" style="font-weight:bold;">repositories </span><span class="font25">containing thousands of packages. This makes it very easy to install and remove applications, operating system components, documentation and much more.</span></p>
<p><a name="bookmark7147"></a><span class="font25">We first discuss the Debian package format </span><span class="font25" style="font-weight:bold;">.deb </span><span class="font25">and its tools </span><span class="font25" style="font-weight:bold;">dpkg</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">apt-get </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">aptitude</span><span class="font25">. This should be similar on Debian, Ubuntu, Mint and all derived distributions.</span></p>
<p><a name="bookmark7148"></a><span class="font25">Then we look at the Red Hat package format </span><span class="font25" style="font-weight:bold;">.rpm </span><span class="font25">and its tools </span><span class="font25" style="font-weight:bold;">rpm </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">yum</span><span class="font25">. This should be similar on Red Hat, Fedora, CentOS and all derived distributions.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7149"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6127"></a><a name="bookmark7150"></a>20.1. package terminology</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark7151"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7152"></a>20.1.1. repository</span></h3></li></ul></li></ul>
<p><a name="bookmark7153"></a><span class="font25">A lot of software and documentation for your Linux distribution is available as </span><span class="font25" style="font-weight:bold;">packages </span><span class="font25">in one or more centrally distributed </span><span class="font25" style="font-weight:bold;">repositories</span><span class="font25">. These </span><span class="font25" style="font-weight:bold;">packages </span><span class="font25">in such a </span><span class="font25" style="font-weight:bold;">repository </span><span class="font25">are tested and very easy to install (or remove) with a graphical or command line installer.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7154"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7155"></a>20.1.2. .deb packages</span></h3></li></ul>
<p><a name="bookmark7156"></a><span class="font25"><a name="bookmark7157"></a><a name="bookmark7158"></a><a name="bookmark7159"></a>Debian, Ubuntu, Mint and all derivatives from Debian and Ubuntu use </span><span class="font25" style="font-weight:bold;">.deb </span><span class="font25">packages. To manage software on these systems, you can use </span><span class="font25" style="font-weight:bold;">aptitude </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">apt-get</span><span class="font25">, both these tools are a front end for </span><span class="font25" style="font-weight:bold;">dpkg</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7160"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7161"></a>20.1.3. .rpm packages</span></h3></li></ul>
<p><a name="bookmark7162"></a><span class="font25">Red Hat, Fedora, CentOS, OpenSUSE, Mandriva, Red Flag and others use </span><span class="font25" style="font-weight:bold;">.rpm </span><span class="font25">packages.</span></p>
<p><span class="font25">The tools to manage software packages on these systems are </span><span class="font25" style="font-weight:bold;">yum </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">rpm</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7163"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7164"></a>20.1.4. dependency</span></h3></li></ul>
<p><span class="font25">Some packages need other packages to function. Tools like </span><span class="font25" style="font-weight:bold;">apt-get</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">aptitude </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">yum </span><span class="font25">will install all </span><span class="font25" style="font-weight:bold;">dependencies </span><span class="font25">you need. When using </span><span class="font25" style="font-weight:bold;">dpkg </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">rpm</span><span class="font25">, or when building from </span><span class="font25" style="font-weight:bold;">source</span><span class="font25">, you will need to install dependencies yourself.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7165"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7166"></a>20.1.5. open source</span></h3></li></ul>
<p><span class="font25">These repositories contain a lot of independent </span><span class="font25" style="font-weight:bold;">open source software</span><span class="font25">. Often the source code is customized to integrate better with your distribution. Most distributions also offer this modified source code as a </span><span class="font25" style="font-weight:bold;">package </span><span class="font25">in one or more </span><span class="font25" style="font-weight:bold;">source repositories</span><span class="font25">.</span></p>
<p><a name="bookmark7167"></a><span class="font25">You are free to go to the project website itself (samba.org, apache.org, github.com, ...) an download the </span><span class="font25" style="font-weight:bold;">vanilla </span><span class="font25">(= without the custom distribution changes) source code.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7168"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7169"></a>20.1.6. GUI software management</span></h3></li></ul>
<h4><a name="bookmark7170"></a><span class="font25"><a name="bookmark7171"></a>End users have several graphical applications available via the desktop (look for 'add/remove software' or something similar).</span></h4>
<h4><a name="bookmark7172"></a><span class="font25"><a name="bookmark7173"></a>Below a screenshot of Ubuntu Software Center running on Ubuntu 12.04. Graphical tools are not discussed in this book.</span></h4>
<div><img src="linux_guide_files/The Complete Linux Guide-142.jpg" alt="" style="width:244pt;height:308pt;">
<p><span class="font1">Astronomy</span></p>
<p><span class="font1">Accessories</span></p>
<p><span class="font1">Mathematics</span></p>
<p><span class="font1">GeoGebra</span></p>
<p><span class="font1">Mathematics </span><span class="font20">★</span><span class="font1"> </span><span class="font20">★★★★</span><span class="font1"> (40) Free</span></p>
</div><br clear="all">
<div>
<p><span class="font1">computer Science &amp;&nbsp;Robotics</span></p>
</div><br clear="all">
<div>
<p><span class="font1">Geography</span></p>
</div><br clear="all">
<div>
<p><span class="font1">Stella ri um</span></p>
</div><br clear="all">
<div>
<p><span class="font1">Astronomy </span><span class="font20">★★★★★</span><span class="font1">(278)</span></p>
<p><span class="font1">Free</span></p>
</div><br clear="all">
<div>
<p><span class="font1">A command-line driven i...</span></p>
</div><br clear="all">
<div>
<p><span class="font1">System </span><span class="font20">★</span><span class="font1"> </span><span class="font20">★★★★</span><span class="font1"> (12)</span></p>
</div><br clear="all">
<div>
<p><span class="font1">Free</span></p>
</div><br clear="all">
<div>
<p><span class="font1">Tux Math</span></p>
<p><span class="font1">Mathematics</span></p>
</div><br clear="all">
<div>
<p><span class="font0" style="font-weight:bold;">GNU Octave</span></p>
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-143.jpg" alt="" style="width:94pt;height:14pt;">
</div><br clear="all">
<div>
<p><span class="font1">Electronics</span></p>
</div><br clear="all">
<div>
<p><span class="font1">Engineering</span></p>
</div><br clear="all">
<div>
<p><span class="font1">AU 272</span></p>
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-144.jpg" alt="" style="width:23pt;height:25pt;">
</div><br clear="all">
<div>
<p><span class="font1">Periodic Table</span></p>
<p><span class="font1">Chemistry </span><span class="font20">★★★★★</span><span class="font1">™</span></p>
<p><span class="font1">Free</span></p>
</div><br clear="all">
<div>
<p><span class="font1">G num eric Spreadsheet</span></p>
<p><span class="font1">Mathematics </span><span class="font20">★</span><span class="font1"> </span><span class="font20">★★★★</span><span class="font1"> (49)</span></p>
</div><br clear="all">
<div>
<p><span class="font1">Mathematics </span><span class="font20">★</span><span class="font1"> </span><span class="font20">★★★★</span><span class="font1"> (4)</span></p>
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-145.jpg" alt="" style="width:23pt;height:21pt;">
</div><br clear="all">
<div><img src="linux_guide_files/The Complete Linux Guide-146.jpg" alt="" style="width:22pt;height:25pt;">
<p><span class="font0" style="font-weight:bold;">KStars</span></p>
<p><span class="font1">Astronomy</span></p>
</div><br clear="all">
<div>
<p><span class="font1">Celestia (GNOME)</span></p>
<p><span class="font1">Astronomy </span><span class="font20">★</span><span class="font1"> </span><span class="font20">★★★☆</span><span class="font1"> (49) Free</span></p>
</div><br clear="all">
<div>
<p><span class="font1">Free</span></p>
</div><br clear="all">
<ul style="list-style:none;"><li>
<h2><a name="bookmark7174"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6128"></a><a name="bookmark7175"></a>20.2. deb package management</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark7176"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7177"></a>20.2.1. about deb</span></h3></li></ul></li></ul>
<p><span class="font25">Most people use </span><span class="font25" style="font-weight:bold;">aptitude </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">apt-get </span><span class="font25">to manage their Debian/Ubuntu family of Linux distributions. Both are a front end for </span><span class="font25" style="font-weight:bold;">dpkg </span><span class="font25">and are themselves a back end for </span><span class="font25" style="font-weight:bold;">synaptic </span><span class="font25">and other graphical tools.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7178"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7179"></a>20.2.2. dpkg -l</span></h3></li></ul>
<p><a name="bookmark7180"></a><span class="font25">The low level tool to work with </span><span class="font25" style="font-weight:bold;">.deb </span><span class="font25">packages is </span><span class="font25" style="font-weight:bold;">dpkg</span><span class="font25">. Here you see how to obtain a list of all installed packages on a Debian server.</span></p>
<p><span class="font19">root@debian6:~# dpkg -l | wc -l 265</span></p>
<p><span class="font25">Compare this to the same list on a Ubuntu Desktop computer.</span></p>
<p><span class="font19">root@ubu1204~# dpkg -l | wc -l 2527</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7181"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7182"></a>20.2.3. dpkg -l $package</span></h3></li></ul>
<p><span class="font25">Here is an example on how to get information on an individual package. The ii at the beginning means the package is installed.</span></p>
<p><span class="font19">root@debian6:~# dpkg -l rsync | tail -1 | tr -s ' '</span></p>
<p><span class="font19">ii rsync 3.0.7-2 fast remote file copy program (like rcp)</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7183"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7184"></a>20.2.4. dpkg -S</span></h3></li></ul>
<p><span class="font25">You can find the package that installed a certain file on your computer with </span><span class="font25" style="font-weight:bold;">dpkg -S</span><span class="font25">. This example shows how to find the package for three files on a typical Debian server.</span></p>
<p><span class="font19">root@debian6:~# dpkg -S /usr/share/doc/tmux/ /etc/ssh/ssh_config /sbin/ifconfig tmux: /usr/share/doc/tmux/</span></p>
<p><span class="font19">openssh-client: /etc/ssh/ssh_config net-tools: /sbin/ifconfig</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7185"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7186"></a>20.2.5. dpkg -L</span></h3></li></ul>
<p><span class="font25">You can also get a list of all files that are installed by a certain program. Below is the list for the </span><span class="font25" style="font-weight:bold;">tmux </span><span class="font25">package.</span></p>
<p><span class="font19">root@debian6:~# dpkg -L tmux /.</span></p>
<p><span class="font19">/etc</span></p>
<p><span class="font19">/etc/init.d</span></p>
<p><span class="font19">/etc/init.d/tmux-cleanup</span></p>
<p><span class="font19">/usr</span></p>
<p><span class="font19">/usr/share</span></p>
<p><span class="font19">/usr/share/lintian</span></p>
<p><span class="font19">/usr/share/lintian/overrides</span></p>
<p><span class="font19">/usr/share/lintian/overrides/tmux</span></p>
<p><span class="font19">/usr/share/doc</span></p>
<p><span class="font19">/usr/share/doc/tmux</span></p>
<p><span class="font19">/usr/share/doc/tmux/TODO.gz</span></p>
<p><span class="font19">/usr/share/doc/tmux/FAQ.gz</span></p>
<p><span class="font19">/usr/share/doc/tmux/changelog.Debian.gz</span></p>
<p><span class="font19">/usr/share/doc/tmux/NEWS.Debian.gz</span></p>
<p><span class="font19">/usr/share/doc/tmux/changelog.gz</span></p>
<p><span class="font19">/usr/share/doc/tmux/copyright</span></p>
<p><span class="font19">/usr/share/doc/tmux/examples</span></p>
<p><span class="font19">/usr/share/doc/tmux/examples/tmux.vim.gz</span></p>
<p><span class="font19">/usr/share/doc/tmux/examples/h-boetes.conf</span></p>
<p><span class="font19">/usr/share/doc/tmux/examples/n-marriott.conf</span></p>
<p><span class="font19">/usr/share/doc/tmux/examples/screen-keys.conf</span></p>
<p><span class="font19">/usr/share/doc/tmux/examples/t-williams.conf</span></p>
<p><span class="font19">/usr/share/doc/tmux/examples/vim-keys.conf</span></p>
<p><span class="font19">/usr/share/doc/tmux/NOTES</span></p>
<p><span class="font19">/usr/share/man</span></p>
<p><span class="font19">/usr/share/man/manl</span></p>
<p><span class="font19">/usr/share/man/man1/tmux.1.gz</span></p>
<p><span class="font19">/usr/bin</span></p>
<p><span class="font19">/usr/bin/tmux</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7187"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7188"></a>20.2.6. dpkg</span></h3></li></ul>
<h4><a name="bookmark7189"></a><span class="font25"><a name="bookmark7190"></a>You could use </span><span class="font25" style="font-weight:bold;">dpkg -i </span><span class="font25">to install a package and </span><span class="font25" style="font-weight:bold;">dpkg -r </span><span class="font25">to remove a package, but you'd have to manually keep track of dependencies. Using </span><span class="font25" style="font-weight:bold;">apt-get </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">aptitude </span><span class="font25">is much easier.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7191"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6129"></a><a name="bookmark7192"></a>20.3. apt-get</span></h2></li></ul>
<p><a name="bookmark7193"></a><span class="font25" style="font-weight:bold;">Debian </span><span class="font25">has been using </span><span class="font25" style="font-weight:bold;">apt-get </span><span class="font25">to manage packages since 1998. Today Debian and many Debian-based distributions still actively support </span><span class="font25" style="font-weight:bold;">apt-get</span><span class="font25">, though some experts claim </span><span class="font25" style="font-weight:bold;">aptitude </span><span class="font25">is better at handling dependencies than </span><span class="font25" style="font-weight:bold;">apt-get</span><span class="font25">.</span></p>
<p><span class="font25">Both commands use the same configuration files and can be used alternately; whenever you see </span><span class="font25" style="font-weight:bold;">apt-get </span><span class="font25">in documentation, feel free to type </span><span class="font25" style="font-weight:bold;">aptitude</span><span class="font25">.</span></p>
<p><span class="font25">We will start with </span><span class="font25" style="font-weight:bold;">apt-get </span><span class="font25">and discuss </span><span class="font25" style="font-weight:bold;">aptitude </span><span class="font25">in the next section.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7194"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7195"></a>20.3.1. apt-get update</span></h3></li></ul>
<p><span class="font25">When typing </span><span class="font25" style="font-weight:bold;">apt-get update </span><span class="font25">you are downloading the names, versions and short description of all packages available on all configured repositories for your system.</span></p>
<p><span class="font25">In the example below you can see some repositories at the url </span><span class="font25" style="font-weight:bold;">be.archive.ubuntu.com </span><span class="font25">because this computer was installed in Belgium. This url can be different for you.</span></p>
<p><span class="font19">root@ubu1204~# apt-get update</span></p>
<p><span class="font19">Ign </span><a href="http://be.archive.ubuntu.com"><span class="font19">http://be.archive.ubuntu.com</span></a><span class="font19"> precise InRelease</span></p>
<p><span class="font19">Ign </span><a href="http://extras.ubuntu.com"><span class="font19">http://extras.ubuntu.com</span></a><span class="font19"> precise InRelease</span></p>
<p><span class="font19">Ign </span><a href="http://security.ubuntu.com"><span class="font19">http://security.ubuntu.com</span></a><span class="font19"> precise-security InRelease</span></p>
<p><span class="font19">Ign </span><a href="http://archive.canonical.com"><span class="font19">http://archive.canonical.com</span></a><span class="font19"> precise InRelease</span></p>
<p><span class="font19">Ign </span><a href="http://be.archive.ubuntu.com"><span class="font19">http://be.archive.ubuntu.com</span></a><span class="font19"> precise-updates InRelease ...</span></p>
<p><span class="font19">Hit </span><a href="http://be.archive.ubuntu.com"><span class="font19">http://be.archive.ubuntu.com</span></a><span class="font19"> precise-backports/main Translation-en</span></p>
<p><span class="font19">Hit </span><a href="http://be.archive.ubuntu.com"><span class="font19">http://be.archive.ubuntu.com</span></a><span class="font19"> precise-backports/multiverse Translation-en</span></p>
<p><span class="font19">Hit </span><a href="http://be.archive.ubuntu.com"><span class="font19">http://be.archive.ubuntu.com</span></a><span class="font19"> precise-backports/restricted Translation-en</span></p>
<p><span class="font19">Hit </span><a href="http://be.archive.ubuntu.com"><span class="font19">http://be.archive.ubuntu.com</span></a><span class="font19"> precise-backports/universe Translation-en Fetched 13.7 MB in 8s (1682 kB/s) Reading package lists... Done root@mac~#</span></p>
<p><span class="font25">Run </span><span class="font25" style="font-weight:bold;">apt-get update </span><span class="font25">every time before performing other package operations.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7196"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7197"></a>20.3.2. apt-get upgrade</span></h3></li></ul>
<p><span class="font25">One of the nicest features of </span><span class="font25" style="font-weight:bold;">apt-get </span><span class="font25">is that it allows for a secure update of </span><span class="font25" style="font-weight:bold;">all software currently installed </span><span class="font25">on your computer with just </span><span class="font25" style="font-weight:bold;">one </span><span class="font25">command.</span></p>
<p><span class="font19">root@debian6:~# apt-get upgrade</span></p>
<p><span class="font19">Reading package lists... Done</span></p>
<p><span class="font19">Building dependency tree</span></p>
<p><span class="font19">Reading state information... Done 0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded. root@debian6:~#</span></p>
<p><span class="font25">The above screenshot shows that all software is updated to the latest version available for my distribution.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7198"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7199"></a>20.3.3. apt-get clean</span></h3></li></ul>
<p><span class="font25" style="font-weight:bold;">apt-get </span><span class="font25">keeps a copy of downloaded packages in </span><span class="font25" style="font-weight:bold;">/var/cache/apt/archives</span><span class="font25">, as can be seen in this screenshot.</span></p>
<p><span class="font19">root@ubu1204~# ls /var/cache/apt/archives/ | head</span></p>
<p><span class="font19">accountsservice_0.6.15-2ubuntu9.4_i386.deb</span></p>
<p><span class="font19">apport_2.0.1-0ubuntu14_all.deb</span></p>
<p><span class="font19">apport-gtk_2.0.1-0ubuntu14_all.deb</span></p>
<p><span class="font19">apt_0.8.16~exp12ubuntu10.3_i386.deb</span></p>
<p><span class="font19">apt-transport-https_0.8.16~exp12ubuntu10.3_i386.deb</span></p>
<p><span class="font19">apt-utils_0.8.16~exp12ubuntu10.3_i386.deb</span></p>
<p><span class="font19">bind9-host_1%3a9.8.1.dfsg.P1-4ubuntu0.4_i386.deb</span></p>
<p><span class="font19">chromium-browser_20.0.1132.47~r144678-0ubuntu0.12.04.1_i386.deb</span></p>
<p><span class="font19">chromium-browser-l10n_20.0.1132.47~r144678-0ubuntu0.12.04.1_all.deb</span></p>
<p><span class="font19">chromium-codecs-ffmpeg_20.0.1132.47~r144678-0ubuntu0.12.04.1_i386.deb</span></p>
<h4><a name="bookmark7200"></a><span class="font25"><a name="bookmark7201"></a>Running </span><span class="font25" style="font-weight:bold;">apt-get clean </span><span class="font25">removes all .deb files from that directory.</span></h4>
<p><span class="font19">root@ubu1204~# apt-get clean</span></p>
<p><span class="font19">root@ubu1204~# ls /var/cache/apt/archives/*.deb</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">ls: cannot access /var/cache/apt/archives/*.deb: No such file or directory</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7202"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7203"></a>20.3.4. apt-cache search</span></h3></li></ul>
<h4><a name="bookmark7204"></a><span class="font25"><a name="bookmark7205"></a>Use </span><span class="font25" style="font-weight:bold;">apt-cache search </span><span class="font25">to search for availability of a package. Here we look for </span><span class="font25" style="font-weight:bold;">rsync</span><span class="font25">.</span></h4>
<p><span class="font19">root@ubu1204~# apt-cache search rsync | grep 'rsync</span></p>
<p><span class="font19">rsync - fast, versatile, remote (and local) file-copying tool rsyncrypto - rsync friendly encryption</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7206"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7207"></a>20.3.5. apt-get install</span></h3></li></ul>
<h4><a name="bookmark7208"></a><span class="font25"><a name="bookmark7209"></a>You can install one or more applications by appending their name behind </span><span class="font25" style="font-weight:bold;">apt-get install</span><span class="font25">.</span><br><br><span class="font25"><a name="bookmark7210"></a>The screenshot shows how to install the </span><span class="font25" style="font-weight:bold;">rsync </span><span class="font25">package.</span></h4>
<p><span class="font19">root@ubu1204~# apt-get install rsync</span></p>
<p><span class="font19">Reading package lists... Done</span></p>
<p><span class="font19">Building dependency tree</span></p>
<p><span class="font19">Reading state information... Done</span></p>
<p><span class="font19">The following NEW packages will be installed: rsync</span></p>
<p><span class="font19">0 upgraded, 1 newly installed, 0 to remove and 8 not upgraded.</span></p>
<p><span class="font19">Need to get 299 kB of archives.</span></p>
<p><span class="font19">After this operation, 634 kB of additional disk space will be used.</span></p>
<p><span class="font19">Get:1 </span><a href="http://be.archive.ubuntu.com/ubuntu/"><span class="font19">http://be.archive.ubuntu.com/ubuntu/</span></a><span class="font19"> precise/main rsync i386 3.0.9-1ubuntu1 [299 kB] Fetched 299 kB in 0s (740 kB/s)</span></p>
<p><span class="font19">Selecting previously unselected package rsync.</span></p>
<p><span class="font19">(Reading database ... 323649 files and directories currently installed.)</span></p>
<p><span class="font19">Unpacking rsync (from .../rsync_3.0.9-1ubuntu1_i386.deb) ...</span></p>
<p><span class="font19">Processing triggers for man-db ...</span></p>
<p><span class="font19">Processing triggers for ureadahead ...</span></p>
<p><span class="font19">Setting up rsync (3.0.9-1ubuntu1) ...</span></p>
<p><span class="font19">Removing any system startup links for /etc/init.d/rsync ... root@ubu1204~#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7211"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7212"></a>20.3.6. apt-get remove</span></h3></li></ul>
<h4><a name="bookmark7213"></a><span class="font25"><a name="bookmark7214"></a>You can remove one or more applications by appending their name behind </span><span class="font25" style="font-weight:bold;">apt-get remove</span><span class="font25">.</span><br><br><span class="font25"><a name="bookmark7215"></a>The screenshot shows how to remove the </span><span class="font25" style="font-weight:bold;">rsync </span><span class="font25">package.</span></h4>
<p><span class="font19">root@ubu1204~# apt-get remove rsync</span></p>
<p><span class="font19">Reading package lists... Done</span></p>
<p><span class="font19">Building dependency tree</span></p>
<p><span class="font19">Reading state information... Done</span></p>
<p><span class="font19">The following packages will be REMOVED: rsync ubuntu-standard</span></p>
<p><span class="font19">0 upgraded, 0 newly installed, 2 to remove and 8 not upgraded.</span></p>
<p><span class="font19">After this operation, 692 kB disk space will be freed.</span></p>
<p><span class="font19">Do you want to continue [Y/n]?</span></p>
<p><span class="font19">(Reading database ... 323681 files and directories currently installed.)</span></p>
<p><span class="font19">Removing ubuntu-standard ...</span></p>
<p><span class="font19">Removing rsync ...</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">* Stopping rsync daemon rsync</span></p></li></ul>
<p><span class="font19">Processing triggers for ureadahead ...</span></p>
<p><span class="font19">Processing triggers for man-db ...</span></p>
<p><span class="font19">root@ubu1204~#</span></p>
<h4><a name="bookmark7216"></a><span class="font25"><a name="bookmark7217"></a>Note however that some configuration information is not removed.</span></h4>
<p><span class="font19">root@ubu1204~# dpkg -l rsync | tail -1 | tr -s ' '</span></p>
<p><span class="font19">rc rsync 3.0.9-1ubuntu1 fast, versatile, remote (and local) file-copying tool</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7218"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7219"></a>20.3.7. apt-get purge</span></h3></li></ul>
<h4><a name="bookmark7220"></a><span class="font25"><a name="bookmark7221"></a>You can purge one or more applications by appending their name behind </span><span class="font25" style="font-weight:bold;">apt-get purge</span><span class="font25">. Purging will also remove all existing configuration files related to that application. The screenshot shows how to purge the </span><span class="font25" style="font-weight:bold;">rsync </span><span class="font25">package.</span></h4>
<p><span class="font19">root@ubu1204~# apt-get purge rsync</span></p>
<p><span class="font19">Reading package lists... Done</span></p>
<p><span class="font19">Building dependency tree</span></p>
<p><span class="font19">Reading state information... Done</span></p>
<p><span class="font19">The following packages will be REMOVED: rsync*</span></p>
<p><span class="font19">0 upgraded, 0 newly installed, 1 to remove and 8 not upgraded.</span></p>
<p><span class="font19">After this operation, 0 B of additional disk space will be used.</span></p>
<p><span class="font19">Do you want to continue [Y/n]?</span></p>
<p><span class="font19">(Reading database ... 323651 files and directories currently installed.)</span></p>
<p><span class="font19">Removing rsync ...</span></p>
<p><span class="font19">Purging configuration files for rsync ...</span></p>
<p><span class="font19">Processing triggers for ureadahead ...</span></p>
<p><span class="font19">root@ubu1204~#</span></p>
<h4><a name="bookmark7222"></a><span class="font25"><a name="bookmark7223"></a>Note that </span><span class="font25" style="font-weight:bold;">dpkg </span><span class="font25">has no information about a purged package, except that it is uninstalled and no configuration is left on the system.</span></h4>
<p><span class="font19">root@ubu1204~# dpkg -l rsync | tail -1 | tr -s ' ' un rsync &lt;none&gt; (no description available)</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7224"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6130"></a><a name="bookmark7225"></a>20.4. aptitude</span></h2></li></ul>
<p><a name="bookmark7226"></a><span class="font25">Most people use </span><span class="font25" style="font-weight:bold;">aptitude </span><span class="font25">for package management on Debian, Mint and Ubuntu systems.</span></p>
<p><span class="font25">To synchronize with the repositories. </span><span class="font19">aptitude update</span></p>
<p><span class="font25">To patch and upgrade all software to the latest version on Debian. </span><span class="font19">aptitude upgrade</span></p>
<p><span class="font25">To patch and upgrade all software to the latest version on Ubuntu and Mint. </span><span class="font19">aptitude safe-upgrade</span></p>
<p><span class="font25">To install an application with all dependencies.</span></p>
<p><span class="font19">aptitude install $package</span></p>
<p><span class="font25">To search the repositories for applications that contain a certain string in their name or description.</span></p>
<p><span class="font19">aptitude search $string</span></p>
<p><span class="font25">To remove an application.</span></p>
<p><span class="font19">aptitude remove $package</span></p>
<p><span class="font25">To remove an application and all configuration files.</span></p>
<p><span class="font19">aptitude purge $package</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7227"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6131"></a><a name="bookmark7228"></a>20.5. apt</span></h2></li></ul>
<p><span class="font25">Both </span><span class="font25" style="font-weight:bold;">apt-get </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">aptitude </span><span class="font25">use the same configuration information in </span><span class="font25" style="font-weight:bold;">/etc/apt/</span><span class="font25">. Thus adding a repository for one of them, will automatically add it for both.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7229"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7230"></a>20.5.1. /etc/apt/sources.list</span></h3></li></ul>
<p><a name="bookmark7231"></a><span class="font25">The resource list used by </span><span class="font25" style="font-weight:bold;">apt-get </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">aptitude </span><span class="font25">is located in </span><span class="font25" style="font-weight:bold;">/etc/apt/sources.list</span><span class="font25">. This file contains a list of http or ftp sources where packages for the distribution can be downloaded.</span></p>
<p><span class="font25">This is what that list looks like on my Debian server.</span></p>
<p><span class="font19">root@debian6:~# cat /etc/apt/sources.list</span></p>
<p><span class="font19">deb </span><a href="http://ftp.be.debian.org/debian/"><span class="font19">http://ftp.be.debian.org/debian/</span></a><span class="font19"> squeeze main</span></p>
<p><span class="font19">deb-src </span><a href="http://ftp.be.debian.org/debian/"><span class="font19">http://ftp.be.debian.org/debian/</span></a><span class="font19"> squeeze main</span></p>
<p><span class="font19">deb </span><a href="http://security.debian.org/"><span class="font19">http://security.debian.org/</span></a><span class="font19"> squeeze/updates main deb-src </span><a href="http://security.debian.org/"><span class="font19">http://security.debian.org/</span></a><span class="font19"> squeeze/updates main</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># squeeze-updates, previously known as 'volatile'</span></p></li></ul>
<p><span class="font19">deb </span><a href="http://ftp.be.debian.org/debian/"><span class="font19">http://ftp.be.debian.org/debian/</span></a><span class="font19"> squeeze-updates main</span></p>
<p><span class="font19">deb-src </span><a href="http://ftp.be.debian.org/debian/"><span class="font19">http://ftp.be.debian.org/debian/</span></a><span class="font19"> squeeze-updates main</span></p>
<p><span class="font25">On my Ubuntu there are four times as many online repositories in use.</span></p>
<p><span class="font19">root@ubu1204~# wc -l /etc/apt/sources.list</span></p>
<p><span class="font19">63 /etc/apt/sources.list</span></p>
<p><span class="font25">There is much more to learn about </span><span class="font25" style="font-weight:bold;">apt</span><span class="font25">, explore commands like </span><span class="font25" style="font-weight:bold;">add-apt-repository</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">apt-key </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">apropos apt</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7232"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6132"></a><a name="bookmark7233"></a>20.6. rpm</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark7234"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7235"></a>20.6.1. about rpm</span></h3></li></ul></li></ul>
<p><a name="bookmark7236"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">Red Hat package manager </span><span class="font25">can be used on the command line with </span><span class="font25" style="font-weight:bold;">rpm </span><span class="font25">or in a graphical way going to Applications--System Settings--Add/Remove Applications. Type </span><span class="font25" style="font-weight:bold;">rpm --help </span><span class="font25">to see some of the options.</span></p>
<p><span class="font25">Software distributed in the </span><span class="font25" style="font-weight:bold;">rpm </span><span class="font25">format will be named </span><span class="font25" style="font-weight:bold;">foo-version.platform.rpm </span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7237"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7238"></a>20.6.2. rpm -qa</span></h3></li></ul>
<p><span class="font25">To obtain a list of all installed software, use the </span><span class="font25" style="font-weight:bold;">rpm -qa </span><span class="font25">command.</span></p>
<p><span class="font19">[root@RHEL52 ~]# rpm -qa | grep samba</span></p>
<p><span class="font19">system-config-samba-1.2.39-1.el5</span></p>
<p><span class="font19">samba-3.0.28-1.el5_2.1</span></p>
<p><span class="font19">samba-client-3.0.28-1.el5_2.1</span></p>
<p><span class="font19">samba-common-3.0.28-1.el5_2.1</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7239"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7240"></a>20.6.3. rpm -q</span></h3></li></ul>
<p><span class="font25">To verify whether one package is installed, use </span><span class="font25" style="font-weight:bold;">rpm -q</span><span class="font25">.</span></p>
<p><span class="font19">root@RHELv4u4:~# rpm -q gcc</span></p>
<p><span class="font19">gcc-3.4.6-3</span></p>
<p><span class="font19">root@RHELv4u4:~# rpm -q laika package laika is not installed</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7241"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7242"></a>20.6.4. rpm -Uvh</span></h3></li></ul>
<p><span class="font25">To install or upgrade a package, use the -Uvh switches. The -U switch is the same as -i for install, except that older versions of the software are removed. The -vh switches are for nicer output.</span></p>
<p><span class="font19">root@RHELv4u4:~# rpm -Uvh gcc-3.4.6-3</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7243"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7244"></a>20.6.5. rpm -e</span></h3></li></ul>
<h4><a name="bookmark7245"></a><span class="font25"><a name="bookmark7246"></a>To remove a package, use the -e switch.</span></h4>
<p><span class="font19">root@RHELv4u4:~# rpm -e gcc-3.4.6-3</span></p>
<h4><a name="bookmark7247"></a><span class="font25" style="font-weight:bold;"><a name="bookmark7248"></a>rpm -e </span><span class="font25">verifies dependencies, and thus will prevent you from accidentailly erasing packages that are needed by other packages.</span></h4>
<p><span class="font19">[root@RHEL52 ~]# rpm -e gcc-4.1.2-42.el5</span></p>
<p><span class="font19">error: Failed dependencies:</span></p>
<p><span class="font19">gcc = 4.1.2-42.el5 is needed by (installed) gcc-c++-4.1.2-42.el5.i386</span></p>
<p><span class="font19">gcc = 4.1.2-42.el5 is needed by (installed) gcc-gfortran-4.1.2-42.el5.i386</span></p>
<p><span class="font19">gcc is needed by (installed) systemtap-0.6.2-1.el5_2.2.i386</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7249"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7250"></a>20.6.6. /var/lib/rpm</span></h3></li></ul>
<h4><a name="bookmark7251"></a><span class="font25"><a name="bookmark7252"></a><a name="bookmark7253"></a>The </span><span class="font25" style="font-weight:bold;">rpm </span><span class="font25">database is located at </span><span class="font25" style="font-weight:bold;">/var/lib/rpm</span><span class="font25">. This database contains all meta information about packages that are installed (via rpm). It keeps track of all files, which enables complete removes of software.</span></h4>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7254"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7255"></a>20.6.7. rpm2cpio</span></h3></li></ul>
<h4><a name="bookmark7256"></a><span class="font25"><a name="bookmark7257"></a><a name="bookmark7258"></a><a name="bookmark7259"></a>We can use </span><span class="font25" style="font-weight:bold;">rpm2cpio </span><span class="font25">to convert an </span><span class="font25" style="font-weight:bold;">rpm </span><span class="font25">to a </span><span class="font25" style="font-weight:bold;">cpio </span><span class="font25">archive.</span></h4>
<p><span class="font19">[root@RHEL53 ~]# file kernel.src.rpm</span></p>
<p><span class="font19">kernel.src.rpm: RPM v3 src PowerPC kernel-2.6.18-92.1.13.el5</span></p>
<p><span class="font19">[root@RHEL53 ~]# rpm2cpio kernel.src.rpm &gt;&nbsp;kernel.cpio</span></p>
<p><span class="font19">[root@RHEL53 ~]# file kernel.cpio</span></p>
<p><span class="font19">kernel.cpio: ASCII cpio archive (SVR4 with no CRC)</span></p>
<h4><a name="bookmark7260"></a><span class="font25"><a name="bookmark7261"></a>But why would you want to do this ?</span><br><br><span class="font25"><a name="bookmark7262"></a>Perhaps just to see of list of files in the </span><span class="font25" style="font-weight:bold;">rpm </span><span class="font25">file.</span></h4>
<p><span class="font19">[root@RHEL53 ~]# rpm2cpio kernel.src.rpm | cpio -t | head -5</span></p>
<p><span class="font19">COPYING.modules</span></p>
<p><span class="font19">Config.mk</span></p>
<p><span class="font19">Module.kabi_i686</span></p>
<p><span class="font19">Module.kabi_i686PAE</span></p>
<p><span class="font19">Module.kabi_i686xen</span></p>
<h4><a name="bookmark7263"></a><span class="font25"><a name="bookmark7264"></a>Or to extract one file from an </span><span class="font25" style="font-weight:bold;">rpm </span><span class="font25">package.</span></h4>
<p><span class="font19">[root@RHEL53 ~]# rpm2cpio kernel.src.rpm | cpio -iv Config.mk</span></p>
<p><span class="font19">Config.mk</span></p>
<p><span class="font19">246098 blocks</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7265"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6133"></a><a name="bookmark7266"></a>20.7. yum</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark7267"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7268"></a>20.7.1. about yum</span></h3></li></ul></li></ul>
<h4><a name="bookmark7269"></a><span class="font25"><a name="bookmark7270"></a><a name="bookmark7271"></a>The </span><span class="font25" style="font-weight:bold;">Yellowdog Updater, Modified (yum) </span><span class="font25">is an easier command to work with </span><span class="font25" style="font-weight:bold;">rpm </span><span class="font25">packages. It is installed by default on Fedora and Red Hat Enterprise Linux since version 5.2.</span></h4>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7272"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7273"></a>20.7.2. yum list</span></h3></li></ul>
<h4><a name="bookmark7274"></a><span class="font25"><a name="bookmark7275"></a>Issue </span><span class="font25" style="font-weight:bold;">yum list available </span><span class="font25">to see a list of available packages. The </span><span class="font25" style="font-weight:bold;">available </span><span class="font25">parameter is optional.</span></h4>
<p><span class="font19">root@rhel65:/etc# yum list | wc -l</span></p>
<p><span class="font19">This system is receiving updates from Red Hat Subscription Management. 3935 root@rhel65:/etc#</span></p>
<h4><a name="bookmark7276"></a><span class="font25"><a name="bookmark7277"></a>Issue </span><span class="font25" style="font-weight:bold;">yum list $package </span><span class="font25">to get all versions (in different repositories) of one package.</span></h4>
<p><span class="font19">[root@rhel55 ~]# yum list samba</span></p>
<p><span class="font19">Loaded plugins: rhnplugin, security</span></p>
<p><span class="font19">Installed Packages</span></p>
<p><span class="font19">samba.i386 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.0.33-3.28.el5 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;installed</span></p>
<p><span class="font19">Available Packages</span></p>
<p><span class="font19">samba.i386 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.0.33-3.29.el5_5 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rhel-i386-server-5</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7278"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7279"></a>20.7.3. yum search</span></h3></li></ul>
<h4><a name="bookmark7280"></a><span class="font25"><a name="bookmark7281"></a>To search for a package containing a certain string in the description or name use </span><span class="font25" style="font-weight:bold;">yum search $string</span><span class="font25">.</span></h4>
<p><span class="font19">[root@rhel55 ~]# yum search gcc44</span></p>
<p><span class="font19">Loaded plugins: rhnplugin, security ========================== Matched: gcc44 =========================== gcc44.i386 : Preview of GCC version 4.4 gcc44-c++.i386 : C++ support for GCC version 4.4 gcc44-gfortran.i386 : Fortran support for GCC 4.4 previe</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7282"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7283"></a>20.7.4. yum provides</span></h3></li></ul>
<h4><a name="bookmark7284"></a><span class="font25"><a name="bookmark7285"></a>To search for a package containing a certain file (you might need for compiling things) use </span><span class="font25" style="font-weight:bold;">yum provides $filename</span><span class="font25">.</span></h4>
<p><span class="font19">root@rhel65:/etc# yum provides /usr/share/man/man5/passwd.5.gz</span></p>
<p><span class="font19">Loaded plugins: product-id, subscription-manager</span></p>
<p><span class="font19">This system is receiving updates from Red Hat Subscription Management.</span></p>
<p><span class="font19">rhel-6-server-cf-tools-1-rpms &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 2.8 kB &nbsp;&nbsp;&nbsp;&nbsp;00:00</span></p>
<p><span class="font19">rhel-6-server-rpms &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 3.7 kB &nbsp;&nbsp;&nbsp;&nbsp;00:00</span></p>
<p><span class="font19">man-pages-3.22-12.el6.noarch : Man (manual) pages from the Linux Documenta...</span></p>
<p><span class="font19">Repo &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: rhel-6-server-rpms</span></p>
<p><span class="font19">Matched from:</span></p>
<p><span class="font19">Filename &nbsp;&nbsp;&nbsp;: /usr/share/man/man5/passwd.5.gz</span></p>
<p><span class="font19">man-pages-3.22-20.el6.noarch : Man (manual) pages from the Linux Documenta...</span></p>
<p><span class="font19">Repo &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: rhel-6-server-rpms</span></p>
<p><span class="font19">Matched from:</span></p>
<p><span class="font19">Filename &nbsp;&nbsp;&nbsp;: /usr/share/man/man5/passwd.5.gz</span></p>
<p><span class="font19">man-pages-3.22-17.el6.noarch : Man (manual) pages from the Linux Documenta...</span></p>
<p><span class="font19">Repo &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: rhel-6-server-rpms</span></p>
<p><span class="font19">Matched from:</span></p>
<p><span class="font19">Filename &nbsp;&nbsp;&nbsp;: /usr/share/man/man5/passwd.5.gz</span></p>
<p><span class="font19">man-pages-3.22-20.el6.noarch : Man (manual) pages from the Linux Documenta...</span></p>
<p><span class="font19">Repo &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: installed</span></p>
<p><span class="font19">Matched from:</span></p>
<p><span class="font19">Other &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: Provides-match: /usr/share/man/man5/passwd.5.gz</span></p>
<p><span class="font19">root@rhel65:/etc#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7286"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7287"></a>20.7.5. yum install</span></h3></li></ul>
<h4><a name="bookmark7288"></a><span class="font25"><a name="bookmark7289"></a>To install an application, use </span><span class="font25" style="font-weight:bold;">yum install $package</span><span class="font25">. Naturally </span><span class="font25" style="font-weight:bold;">yum </span><span class="font25">will install all the necessary dependencies.</span></h4>
<p><span class="font19">[root@rhel55 ~]# yum install sudo</span></p>
<p><span class="font19">Loaded plugins: rhnplugin, security</span></p>
<p><span class="font19">Setting up Install Process</span></p>
<p><span class="font19">Resolving Dependencies</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">--&gt; Running transaction check</span></p></li></ul>
<p><span class="font19">---&gt; Package sudo.i386 0:1.7.2p1-7.el5_5 set to be updated</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">--&gt; Finished Dependency Resolution</span></p></li></ul>
<p><span class="font19">Dependencies Resolved</span></p>
<p><span class="font19">Package Arch Version &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Repository &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size</span></p>
<p><span class="font19">Installing:</span></p>
<p><span class="font19">sudo &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i386 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.7.2p1-7.el5_5 rhel-i386-server-5 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;230 k</span></p>
<p><span class="font19">Transaction Summary</span></p>
<p><span class="font19">Install &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 Package(s)</span></p>
<p><span class="font19">Upgrade &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 Package(s)</span></p>
<p><span class="font19">Total download size: 230 k</span></p>
<p><span class="font19">Is this ok [y/N]: y</span></p>
<p><span class="font19">Downloading Packages:</span></p>
<p><span class="font19">sudo-1.7.2p1-7.el5_5.i386.rpm &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 230 kB 00:00</span></p>
<p><span class="font19">Running rpm_check_debug</span></p>
<p><span class="font19">Running Transaction Test Finished Transaction Test Transaction Test Succeeded Running Transaction</span></p>
<p><span class="font19">Installing : sudo &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1/1</span></p>
<p><span class="font19">Installed:</span></p>
<p><span class="font19">sudo.i386 0:1.7.2p1-7.el5_5</span></p>
<p><span class="font19">Complete!</span></p>
<h4><a name="bookmark7290"></a><span class="font25"><a name="bookmark7291"></a>You can add more than one parameter here.</span></h4>
<p><span class="font19">yum install $package1 $package2 $package3</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7292"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7293"></a>20.7.6. yum update</span></h3></li></ul>
<h4><a name="bookmark7294"></a><span class="font25"><a name="bookmark7295"></a>To bring all applications up to date, by downloading and installing them, issue </span><span class="font25" style="font-weight:bold;">yum update</span><span class="font25">. All software that was installed via </span><span class="font25" style="font-weight:bold;">yum </span><span class="font25">will be updated to the latest version that is available in the repository.</span></h4>
<p><span class="font19">yum update</span></p>
<h4><a name="bookmark7296"></a><span class="font25"><a name="bookmark7297"></a>If you only want to update one package, use </span><span class="font25" style="font-weight:bold;">yum update $package</span><span class="font25">.</span></h4>
<p><span class="font19">[root@rhel55 ~]# yum update sudo</span></p>
<p><span class="font19">Loaded plugins: rhnplugin, security</span></p>
<p><span class="font19">Skipping security plugin, no data</span></p>
<p><span class="font19">Setting up Update Process</span></p>
<p><span class="font19">Resolving Dependencies</span></p>
<p><span class="font19">Skipping security plugin, no data</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">--&gt; Running transaction check</span></p></li></ul>
<p><span class="font19">---&gt; Package sudo.i386 0:1.7.2p1-7.el5_5 set to be updated</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">--&gt; Finished Dependency Resolution</span></p></li></ul>
<p><span class="font19">Dependencies Resolved</span></p>
<p><span class="font19">Package Arch Version &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Repository &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size</span></p>
<p><span class="font19">Updating:</span></p>
<p><span class="font19">sudo &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i386 &nbsp;&nbsp;&nbsp;1.7.2p1-7.el5_5 rhel-i386-server-5 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;230 k</span></p>
<p><span class="font19">Transaction Summary</span></p>
<p><span class="font19">Install &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 Package(s)</span></p>
<p><span class="font19">Upgrade &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 Package(s)</span></p>
<p><span class="font19">Total download size: 230 k</span></p>
<p><span class="font19">Is this ok [y/N]: y</span></p>
<p><span class="font19">Downloading Packages:</span></p>
<p><span class="font19">sudo-1.7.2p1-7.el5_5.i386.rpm &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 230 kB 00:00</span></p>
<p><span class="font19">Running rpm_check_debug</span></p>
<p><span class="font19">Running Transaction Test Finished Transaction Test Transaction Test Succeeded Running Transaction</span></p>
<p><span class="font19">Updating &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: sudo &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1/2</span></p>
<p><span class="font19">Cleanup &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: sudo &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2/2</span></p>
<p><span class="font19">Updated:</span></p>
<p><span class="font19">sudo.i386 0:1.7.2p1-7.el5_5</span></p>
<p><span class="font19">Complete!</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7298"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7299"></a>20.7.7. yum software groups</span></h3></li></ul>
<h4><a name="bookmark7300"></a><span class="font25"><a name="bookmark7301"></a>Issue </span><span class="font25" style="font-weight:bold;">yum grouplist </span><span class="font25">to see a list of all available software groups.</span></h4>
<p><span class="font19">[root@rhel55 ~]# yum grouplist</span></p>
<p><span class="font19">Loaded plugins: rhnplugin, security</span></p>
<p><span class="font19">Setting up Group Process Installed Groups: Administration Tools Authoring and Publishing DNS Name Server Development Libraries Development Tools Editors</span></p>
<p><span class="font19">GNOME Desktop Environment</span></p>
<p><span class="font19">GNOME Software Development</span></p>
<p><span class="font19">Graphical Internet</span></p>
<p><span class="font19">Graphics</span></p>
<p><span class="font19">Legacy Network Server</span></p>
<p><span class="font19">Legacy Software Development</span></p>
<p><span class="font19">Legacy Software Support Mail Server Network Servers</span></p>
<p><span class="font19">Office/Productivity</span></p>
<p><span class="font19">Printing Support</span></p>
<p><span class="font19">Server Configuration Tools</span></p>
<p><span class="font19">System Tools Text-based Internet Web Server Windows File Server X Software Development X Window System Available Groups:</span></p>
<p><span class="font19">Engineering and Scientific FTP Server Games and Entertainment Java Development KDE (K Desktop Environment) KDE Software Development MySQL Database News Server</span></p>
<p><span class="font19">OpenFabrics Enterprise Distribution PostgreSQL Database Sound and Video</span></p>
<p><span class="font19">Done</span></p>
<h4><a name="bookmark7302"></a><span class="font25"><a name="bookmark7303"></a>To install a set of applications, brought together via a group, use </span><span class="font25" style="font-weight:bold;">yum groupinstall $groupname</span><span class="font25">.</span></h4>
<p><span class="font19">[root@rhel55 ~]# yum groupinstall 'Sound and video'</span></p>
<p><span class="font19">Loaded plugins: rhnplugin, security</span></p>
<p><span class="font19">Setting up Group Process</span></p>
<p><span class="font19">Package alsa-utils-1.0.17-1.el5.i386 already installed and latest version</span></p>
<p><span class="font19">Package sox-12.18.1-1.i386 already installed and latest version</span></p>
<p><span class="font19">Package 9:mkisofs-2.01-10.7.el5.i386 already installed and latest version</span></p>
<p><span class="font19">Package 9:cdrecord-2.01-10.7.el5.i386 already installed and latest version</span></p>
<p><span class="font19">Package cdrdao-1.2.1-2.i386 already installed and latest version Resolving Dependencies</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- -&gt; Running transaction check</span></p></li></ul>
<p><span class="font19">---&gt; Package cdda2wav.i386 9:2.01-10.7.el5 set to be updated</span></p>
<p><span class="font19">---&gt; Package cdparanoia.i386 0:alpha9.8-27.2 set to be updated</span></p>
<p><span class="font19">---&gt; Package sound-juicer.i386 0:2.16.0-3.el5 set to be updated</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- -&gt; Processing Dependency: libmusicbrainz &gt;= 2.1.0 for package: sound-juicer</span></p></li>
<li>
<p><span class="font19">- -&gt; Processing Dependency: libmusicbrainz.so.4 for package: sound-juicer</span></p></li></ul>
<p><span class="font19">---&gt; Package vorbis-tools.i386 1:1.1.1-3.el5 set to be updated</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- -&gt; Processing Dependency: libao &gt;= 0.8.4 for package: vorbis-tools</span></p></li>
<li>
<p><span class="font19">- -&gt; Processing Dependency: libao.so.2 for package: vorbis-tools</span></p></li>
<li>
<p><span class="font19">- -&gt; Running transaction check</span></p></li></ul>
<p><span class="font19">---&gt; Package libao.i386 0:0.8.6-7 set to be updated</span></p>
<p><span class="font19">---&gt; Package libmusicbrainz.i386 0:2.1.1-4.1 set to be updated</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- -&gt; Finished Dependency Resolution</span></p></li></ul>
<h4><a name="bookmark7304"></a><span class="font25"><a name="bookmark7305"></a>Read the manual page of </span><span class="font25" style="font-weight:bold;">yum </span><span class="font25">for more information about managing groups in </span><span class="font25" style="font-weight:bold;">yum</span><span class="font25">.</span></h4>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7306"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7307"></a>20.7.8. /etc/yum.conf and repositories</span></h3></li></ul>
<p><span class="font25">The configuration of </span><span class="font25" style="font-weight:bold;">yum </span><span class="font25">repositories is done in </span><span class="font25" style="font-weight:bold;">/etc/yum/yum.conf </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/etc/yum/repos.d/ </span><span class="font25">.</span></p>
<p><a name="bookmark7308"></a><span class="font25">Configurating </span><span class="font25" style="font-weight:bold;">yum </span><span class="font25">itself is done in </span><span class="font25" style="font-weight:bold;">/etc/yum.conf</span><span class="font25">. This file will contain the location of a log file and a cache directory for </span><span class="font25" style="font-weight:bold;">yum </span><span class="font25">and can also contain a list of repositories.</span></p>
<p><a name="bookmark7309"></a><span class="font25">Recently </span><span class="font25" style="font-weight:bold;">yum </span><span class="font25">started accepting several </span><span class="font25" style="font-weight:bold;">repo </span><span class="font25">files with each file containing a list of </span><span class="font25" style="font-weight:bold;">repositories</span><span class="font25">. These </span><span class="font25" style="font-weight:bold;">repo </span><span class="font25">files are located in the </span><span class="font25" style="font-weight:bold;">/etc/yum.repos.d/ </span><span class="font25">directory.</span></p>
<p><span class="font25">One important flag for yum is </span><span class="font25" style="font-weight:bold;">enablerepo</span><span class="font25">. Use this command if you want to use a repository that is not enabled by default.</span></p>
<p><span class="font19">yum $command $foo --enablerepo=$repo</span></p>
<p><span class="font25">An example of the contents of the repo file: MyRepo.repo</span></p>
<p><span class="font19">[$repo]</span></p>
<p><span class="font19">name=My Repository</span></p>
<p><span class="font19">baseurl=</span><a href="http://path/to/MyRepo"><span class="font19">http://path/to/MyRepo</span></a></p>
<p><span class="font19">gpgcheck=1</span></p>
<p><span class="font19">gpgkey=</span><a href="file:///etc/pki/rpm-gpg/RPM-GPG-KEY-MyRep"><span class="font19">file:///etc/pki/rpm-gpg/RPM-GPG-KEY-MyRep</span></a></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7310"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6134"></a><a name="bookmark7311"></a>20.8. alien</span></h2></li></ul>
<h4><a name="bookmark7312"></a><span class="font25" style="font-weight:bold;"><a name="bookmark7313"></a>alien </span><span class="font25">is experimental software that converts between </span><span class="font25" style="font-weight:bold;">rpm </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">deb </span><span class="font25">package formats (and others).</span></h4>
<h4><a name="bookmark7314"></a><span class="font25"><a name="bookmark7315"></a>Below an example of how to use </span><span class="font25" style="font-weight:bold;">alien </span><span class="font25">to convert an </span><span class="font25" style="font-weight:bold;">rpm </span><span class="font25">package to a </span><span class="font25" style="font-weight:bold;">deb </span><span class="font25">package.</span></h4>
<p><span class="font19">paul@barry:~$ ls -l netcat*</span></p>
<p><span class="font19">-rw-r--r-- 1 paul paul 123912 2009-06-04 14:58 netcat-0.7.1-1.i386.rpm</span></p>
<p><span class="font19">paul@barry:~$ alien --to-deb netcat-0.7.1-1.i386.rpm</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">netcat_0.7.1-2_i386.deb generated paul@barry:~$ ls -l netcat*</span></p>
<p><span class="font19">-rw-r--r-- 1 paul paul 123912 2009-06-04 14:58</span></p>
<p><span class="font19">-rw-r--r-- 1 root root 125236 2009-06-04 14:59</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">netcat-0.7.1-1.i386.rpm</span></p>
<p><span class="font19">netcat 0.7.1-2 i386.deb</span></p></td></tr>
</table>
<p><span class="font25" style="font-style:italic;">In real life, use the </span><span class="font25" style="font-weight:bold;font-style:italic;">netcat </span><span class="font25" style="font-style:italic;">tool provided by your distribution, or use the .deb file from their website.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7316"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6135"></a><a name="bookmark7317"></a>20.9. downloading software outside the repository</span></h2></li></ul>
<p><span class="font25">First and most important, whenever you download software, start by reading the README file!</span></p>
<p><span class="font25">Normally the readme will explain what to do after download. You will probably receive a .tar.gz or a .tgz file. Read the documentation, then put the compressed file in a directory. You can use the following to find out where the package wants to install.</span></p>
<p><span class="font19">tar tvzpf $downloadedFile.tgz</span></p>
<p><a name="bookmark7318"></a><span class="font25">You unpack them like with </span><span class="font25" style="font-weight:bold;">tar xzf</span><span class="font25">, it will create a directory called applicationName-1.2.3</span></p>
<p><span class="font19">tar xzf $applicationName.tgz</span></p>
<p><span class="font25">Replace the z with a j when the file ends in .tar.bz2. The </span><span class="font25" style="font-weight:bold;">tar</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">gzip </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">bzip2 </span><span class="font25">commands are explained in detail in the Linux Fundamentals course.</span></p>
<p><span class="font25">If you download a </span><span class="font25" style="font-weight:bold;">.deb </span><span class="font25">file, then you'll have to use </span><span class="font25" style="font-weight:bold;">dpkg </span><span class="font25">to install it, </span><span class="font25" style="font-weight:bold;">.rpm</span><span class="font25">'s can be installed with the </span><span class="font25" style="font-weight:bold;">rpm </span><span class="font25">command.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7319"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6136"></a><a name="bookmark7320"></a>20.10. compiling software</span></h2></li></ul>
<p><span class="font25">First and most important, whenever you download source code for installation, start by reading the README file!</span></p>
<p><a name="bookmark7321"></a><span class="font25"><a name="bookmark7322"></a>Usually the steps are always the same three : running </span><span class="font25" style="font-weight:bold;">./configure </span><span class="font25">followed by </span><span class="font25" style="font-weight:bold;">make </span><span class="font25">(which is the actual compiling) and then by </span><span class="font25" style="font-weight:bold;">make install </span><span class="font25">to copy the files to their proper location.</span></p>
<p><span class="font19">./configure</span></p>
<p><span class="font19">make</span></p>
<p><span class="font19">make install</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7323"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6137"></a><a name="bookmark7324"></a>20.11. practice: package management</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Verify whether gcc, sudo and wesnoth are installed.</span></p></li>
<li>
<p><span class="font25">2. Use yum or aptitude to search for and install the scp, tmux, and man-pages packages. Did you find them all ?</span></p></li>
<li>
<p><span class="font25">3. Search the internet for 'webmin' and figure out how to install it.</span></p></li>
<li>
<p><span class="font25">4. If time permits, search for and install samba including the samba docs pdf files (thousands of pages in two pdf's).</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7325"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6138"></a><a name="bookmark7326"></a>20.12. solution: package management</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark7327"></a><span class="font25"><a name="bookmark7328"></a>1. Verify whether gcc, sudo and wesnoth are installed.</span></h4></li></ul>
<p><span class="font19">On Red Hat/CentOS: rpm -qa | grep gcc rpm -qa | grep sudo rpm -qa | grep wesnoth</span></p>
<p><span class="font19">On Debian/Ubuntu: dpkg -l | grep gcc dpkg -l | grep sudo dpkg -l | grep wesnoth</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark7329"></a><span class="font25"><a name="bookmark7330"></a>2. Use yum or aptitude to search for and install the scp, tmux, and man-pages packages. Did you find them all ?</span></h4></li></ul>
<p><span class="font19">On Red Hat/CentOS: yum search scp yum search tmux yum search man-pages</span></p>
<p><span class="font19">On Debian/Ubuntu: aptitude search scp aptitude search tmux aptitude search man-pages</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark7331"></a><span class="font25"><a name="bookmark7332"></a>3. Search the internet for 'webmin' and figure out how to install it.</span></h4></li></ul>
<p><span class="font19">Google should point you to webmin.com.</span></p>
<p><span class="font19">There are several formats available there choose .rpm, .deb or .tgz .</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark7333"></a><span class="font25"><a name="bookmark7334"></a>4. If time permits, search for and install samba including the samba docs pdf files (thousands of pages in two pdf's).</span></h4></li></ul>
<p><a name="bookmark7335"></a><span class="font11" style="font-weight:bold;">Part VI. kernel management</span></p>
<h3><a name="bookmark7336"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7337"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7338"><span class="font24" style="font-weight:bold;">28. the Linux kernel </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7339"><span class="font24">28.1. about the Linux kernel </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7340"><span class="font24">28.2. Linux kernel source </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7341"><span class="font24">28.3. kernel boot files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7342"><span class="font24">28.4. Linux kernel modules </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7343"><span class="font24">28.5. compiling a kernel </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7344"><span class="font24">28.6. compiling one module </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7345"><span class="font24" style="font-weight:bold;">29. library management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7346"><span class="font24">29.1. introduction </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7347"><span class="font24">29.2. /lib and /usr/lib </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7348"><span class="font24">29.3. ldd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7349"><span class="font24">29.4. ltrace </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7350"><span class="font24">29.5. dpkg -S and debsums </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7351"><span class="font24">29.6. rpm -qf and rpm -V </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7352"><span class="font24">29.7. tracing with strace </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a name="bookmark7353"></a><span class="font11" style="font-weight:bold;">Chapter 28. the Linux kernel</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7354"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6201"></a><a name="bookmark7355"></a>28.1. about the Linux kernel</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark1592"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7356"></a>28.1.1. kernel versions</span></h3></li></ul></li></ul>
<p><span class="font25">In 1991 Linux Torvalds wrote (the first version of) the Linux kernel. He put it online, and other people started contributing code. Over 4000 individuals contributed source code to the latest kernel release (version 2.6.27 in November 2008).</span></p>
<p><span class="font25">Major Linux kernel versions used to come in even and odd numbers. Versions </span><span class="font25" style="font-weight:bold;">2.0</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">2.2</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">2.4 </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">2.6 </span><span class="font25">are considered stable kernel versions. Whereas </span><span class="font25" style="font-weight:bold;">2.1</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">2.3 </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">2.5 </span><span class="font25">were unstable (read development) versions. Since the release of 2.6.0 in January 2004, all development has been done in the 2.6 tree. There is currently no v2.7.x and according to Linus the even/stable vs odd/development scheme is abandoned forever.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7357"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7358"></a>28.1.2. uname -r</span></h3></li></ul>
<p><a name="bookmark7359"></a><span class="font25">To see your current Linux kernel version, issue the </span><span class="font25" style="font-weight:bold;">uname -r </span><span class="font25">command as shown below.</span></p>
<p><span class="font25">This first example shows Linux major version </span><span class="font25" style="font-weight:bold;">2.6 </span><span class="font25">and minor version </span><span class="font25" style="font-weight:bold;">24</span><span class="font25">. The rest </span><span class="font25" style="font-weight:bold;">-22-generic </span><span class="font25">is specific to the distribution (Ubuntu in this case).</span></p>
<p><span class="font19">paul@laika:~$ uname -r</span></p>
<p><span class="font19">2.6.24-22-generic</span></p>
<p><span class="font25">The same command on Red Hat Enterprise Linux shows an older kernel (2.6.18) with </span><span class="font25" style="font-weight:bold;">-92.1.17.el5 </span><span class="font25">being specific to the distribution.</span></p>
<p><span class="font19">[paul@RHEL52 ~]$ uname -r</span></p>
<p><span class="font19">2.6.18-92.1.17.el5</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7360"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7361"></a>28.1.3. /proc/cmdline</span></h3></li></ul>
<p><a name="bookmark7362"></a><span class="font25">The parameters that were passed to the kernel at boot time are in </span><span class="font25" style="font-weight:bold;">/proc/cmdline</span><span class="font25">.</span></p>
<p><span class="font19">paul@RHELv4u4:~$ cat /proc/cmdline</span></p>
<p><span class="font19">ro root=/dev/VolGroup00/LogVol00 rhgb quiet</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7363"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7364"></a>28.1.4. single user mode</span></h3></li></ul>
<p><a name="bookmark7365"></a><span class="font25">When booting the kernel with the </span><span class="font25" style="font-weight:bold;">single </span><span class="font25">parameter, it starts in </span><span class="font25" style="font-weight:bold;">single user mode</span><span class="font25">. Linux can start in a bash shell with the </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">user logged on (without password).</span></p>
<p><span class="font25">Some distributions prevent the use of this feature (at kernel compile time).</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7366"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7367"></a>28.1.5. init=/bin/bash</span></h3></li></ul>
<p><a name="bookmark7368"></a><span class="font25">Normally the kernel invokes </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">as the first daemon process. Adding </span><span class="font25" style="font-weight:bold;">init=/bin/bash </span><span class="font25">to the kernel parameters will instead invoke bash (again with root logged on without providing a password).</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7369"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7370"></a>28.1.6. /var/log/messages</span></h3></li></ul>
<p><a name="bookmark7371"></a><span class="font25"><a name="bookmark7372"></a>The kernel reports during boot to </span><span class="font25" style="font-weight:bold;">syslog </span><span class="font25">which writes a lot of kernel actions in </span><span class="font25" style="font-weight:bold;">/var/log/ messages</span><span class="font25">. Looking at this file reveals when the kernel was started, including all the devices that were detected at boot time.</span></p>
<p><span class="font19">[root@RHEL53 ~]# grep -A16 &quot;syslogd 1.4.1:&quot; /var/log/messages|cut -b24-klogd 1.4.1, log source = /proc/kmsg started.</span></p>
<div>
<p><span class="font19">syslogd kernel: kernel: kernel: kernel: kernel: kernel: kernel: kernel: kernel: kernel: kernel: kernel: kernel: kernel: kernel:</span></p>
</div><br clear="all">
<div>
<p><span class="font19">1.4.1: restart.</span></p>
</div><br clear="all">
<p><span class="font19">Linux version 2.6.18-128.el5 (</span><a href="mailto:mockbuild@hs20-bc1-5.build.red"><span class="font19">mockbuild@hs20-bc1-5.build.red</span></a><span class="font19">...</span></p>
<p><span class="font19">BIOS-provided physical RAM map:</span></p>
<p><span class="font19">BIOS-e820: 0000000000000000 - 000000000009f800 BIOS-e820: 000000000009f800 - 00000000000a0000 BIOS-e820: 00000000000ca000 - 00000000000cc000 BIOS-e820: 00000000000dc000 - 0000000000100000 BIOS-e820: 0000000000100000 - 000000001fef0000 BIOS-e820: 000000001fef0000 - 000000001feff000 BIOS-e820: 000000001feff000 - 000000001ff00000 BIOS-e820: 000000001ff00000 - 0000000020000000 BIOS-e820: 00000000fec00000 - 00000000fec10000 BIOS-e820: 00000000fee00000 - 00000000fee01000 BIOS-e820: 00000000fffe0000 - 0000000100000000 0MB HIGHMEM available.</span></p>
<div>
<p><span class="font19">(usable) (reserved) (reserved) (reserved) (usable) (ACPI data) (ACPI NVS) (usable) (reserved) (reserved) (reserved)</span></p>
</div><br clear="all">
<p><span class="font19">kernel: 512MB LOWMEM available.</span></p>
<p><span class="font25">This example shows how to use </span><span class="font25" style="font-weight:bold;">/var/log/messages </span><span class="font25">to see kernel information about </span><span class="font25" style="font-weight:bold;">/dev/sda</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL53 ~]# grep sda /var/log/messages | cut -b24-kernel: SCSI device sda: 41943040 512-byte hdwr sectors (21475 MB) kernel: sda: Write Protect is off kernel: sda: cache data unavailable kernel: sda: assuming drive cache: write through kernel: SCSI device sda: 41943040 512-byte hdwr sectors (21475 MB) kernel: sda: Write Protect is off kernel: sda: cache data unavailable kernel: sda: assuming drive cache: write through kernel: sda: sda1 sda2 kernel: sd 0:0:0:0: Attached scsi disk sda kernel: EXT3 FS on sda1, internal journal</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7373"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7374"></a>28.1.7. dmesg</span></h3></li></ul>
<h4><a name="bookmark7375"></a><span class="font25"><a name="bookmark7376"></a>The </span><span class="font25" style="font-weight:bold;">dmesg </span><span class="font25">command prints out all the kernel bootup messages (from the last boot).</span></h4>
<p><span class="font19">[root@RHEL53 ~]# dmesg | head</span></p>
<p><span class="font19">Linux version 2.6.18-128.el5 (</span><a href="mailto:mockbuild@hs20-bc1-5.build.redhat.com"><span class="font19">mockbuild@hs20-bc1-5.build.redhat.com</span></a><span class="font19">) BIOS-provided physical RAM map:</span></p>
<div>
<p><span class="font19">BIOS-e820: 0000000000000000</span></p>
<p><span class="font19">BIOS-e820: 000000000009f800</span></p>
<p><span class="font19">BIOS-e820: 00000000000ca000</span></p>
<p><span class="font19">BIOS-e820: 00000000000dc000</span></p>
<p><span class="font19">BIOS-e820: 0000000000100000</span></p>
<p><span class="font19">BIOS-e820: 000000001fef0000</span></p>
<p><span class="font19">BIOS-e820: 000000001feff000</span></p>
<p><span class="font19">BIOS-e820: 000000001ff00000</span></p>
</div><br clear="all">
<div>
<p><span class="font19">000000000009f800 (usable)</span></p>
</div><br clear="all">
<div>
<p><span class="font19">00000000000a0000 (reserved)</span></p>
</div><br clear="all">
<div>
<p><span class="font19">00000000000cc000 (reserved)</span></p>
</div><br clear="all">
<div>
<p><span class="font19">0000000000100000 (reserved)</span></p>
</div><br clear="all">
<div>
<p><span class="font19">000000001fef0000 (usable)</span></p>
<p><span class="font19">000000001feff000 (ACPI data) 000000001ff00000 (ACPI NVS) 0000000020000000 (usable)</span></p>
</div><br clear="all">
<h4><a name="bookmark7377"></a><span class="font25"><a name="bookmark7378"></a><a name="bookmark7379"></a>Thus to find information about /dev/sda, using </span><span class="font25" style="font-weight:bold;">dmesg </span><span class="font25">will yield only kernel messages from the last boot.</span></h4>
<p><span class="font19">[root@RHEL53 ~]# dmesg | grep sda</span></p>
<p><span class="font19">SCSI device sda: 41943040 512-byte hdwr sectors (21475 MB) sda: Write Protect is off sda: Mode Sense: 5d 00 00 00 sda: cache data unavailable sda: assuming drive cache: write through</span></p>
<p><span class="font19">SCSI device sda: 41943040 512-byte hdwr sectors (21475 MB) sda: Write Protect is off sda: Mode Sense: 5d 00 00 00 sda: cache data unavailable sda: assuming drive cache: write through sda: sda1 sda2 sd 0:0:0:0: Attached scsi disk sda EXT3 FS on sda1, internal journal</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7380"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6203"></a><a name="bookmark7381"></a>28.2. Linux kernel source</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark7382"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7383"></a>28.2.1. </span><a href="ftp://ftp.kernel.org"><span class="font9" style="font-weight:bold;">ftp.kernel.org</span></a></h3></li></ul></li></ul>
<p><a name="bookmark7384"></a><span class="font25"><a name="bookmark7385"></a>The home of the Linux kernel source is </span><a href="ftp://ftp.kernel.org"><span class="font25" style="font-weight:bold;">ftp.kernel.org</span></a><span class="font25">. It contains all official releases of the Linux kernel source code from 1991. It provides free downloads over http, ftp and rsync of all these releases, as well as changelogs and patches. More information can be otained on the website </span><a href="http://www.kernel.org"><span class="font25" style="font-weight:bold;">www.kernel.org</span></a><span class="font25">.</span></p>
<p><span class="font25">Anyone can anonymously use an ftp client to access </span><a href="ftp://ftp.kernel.org"><span class="font25">ftp.kernel.org</span></a></p>
<p><span class="font19">paul@laika:~$ ftp </span><a href="ftp://ftp.kernel.org"><span class="font19">ftp.kernel.org</span></a></p>
<p><span class="font19">Connected to pub3.kernel.org.</span></p>
<p><span class="font19">220 Welcome to </span><a href="ftp://ftp.kernel.org"><span class="font19">ftp.kernel.org</span></a><span class="font19">.</span></p>
<p><span class="font19">Name (ftp.kernel.org:paul): anonymous</span></p>
<p><span class="font19">331 Please specify the password.</span></p>
<p><span class="font19">Password:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">230- Welcome to the</span></p></li></ul>
<p><span class="font19">230</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">230- LINUX KERNEL ARCHIVES</span></p></li>
<li>
<p><span class="font19">230- </span><a href="ftp://ftp.kernel.org"><span class="font19">ftp.kernel.org</span></a></p></li></ul>
<p><span class="font25">All the Linux kernel versions are located in the pub/linux/kernel/ directory.</span></p>
<p><span class="font19">ftp&gt; ls pub/linux/kernel/v*</span></p>
<p><span class="font19">200 PORT command successful. Consider using PASV.</span></p>
<p><span class="font19">150 Here comes the directory listing.</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">drwxrwsr-x</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">536</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">536</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Mar</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">20</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2003</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">V1.0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">drwxrwsr-x</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">536</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">536</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">20480</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Mar</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">20</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2003</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">V1.1</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">drwxrwsr-x</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">536</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">536</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">8192</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Mar</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">20</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2003</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">v1.2</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">drwxrwsr-x</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">536</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">536</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">40960</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Mar</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">20</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2003</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">v1.3</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">drwxrwsr-x</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">536</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">536</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">16384</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">08</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2004</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">v2.0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">drwxrwsr-x</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">536</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">536</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">53248</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Mar</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">20</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2003</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">v2.1</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">drwxrwsr-x</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">536</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">536</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">12288</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Mar</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">24</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2004</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">v2.2</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">drwxrwsr-x</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">536</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">536</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">24576</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Mar</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">20</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2003</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">v2.3</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">drwxrwsr-x</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">536</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">536</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">28672</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Dec</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">02</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">08:14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">v2.4</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">drwxrwsr-x</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">536</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">536</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">32768</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Jul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2003</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">v2.5</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">drwxrwsr-x</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">7</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">536</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">536</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">110592</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Dec</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">05</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">22:36</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">v2.6</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">226 Directory</span></p></td><td colspan="2" style="vertical-align:top;">
<p><span class="font19">send OK.</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
</table>
<p><span class="font19">ftp&gt;</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7386"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7387"></a>28.2.2. /usr/src</span></h3></li></ul>
<h4><a name="bookmark7388"></a><span class="font25"><a name="bookmark7389"></a><a name="bookmark7390"></a>On your local computer, the kernel source is located in </span><span class="font25" style="font-weight:bold;">/usr/src</span><span class="font25">. Note though that the structure inside /usr/src might be different depending on the distribution that you are using.</span></h4>
<h4><a name="bookmark7391"></a><span class="font25"><a name="bookmark7392"></a>First let's take a look at </span><span class="font25" style="font-weight:bold;">/usr/src on Debian</span><span class="font25">. There appear to be two versions of the complete Linux source code there. Looking for a specific file (e1000_main.c) with find reveals it's exact location.</span></h4>
<p><span class="font19">paul@barry:~$ ls -l /usr/src/</span></p>
<p><span class="font19">drwxr-xr-x 20 root root &nbsp;&nbsp;&nbsp;&nbsp;4096 2006-04-04 22:12 linux-source-2.6.15</span></p>
<p><span class="font19">drwxr-xr-x 19 root root &nbsp;&nbsp;&nbsp;&nbsp;4096 2006-07-15 17:32 linux-source-2.6.16</span></p>
<p><span class="font19">paul@barry:~$ find /usr/src -name e1000_main.c</span></p>
<p><span class="font19">/usr/src/linux-source-2.6.15/drivers/net/e1000/e1000_main.c</span></p>
<p><span class="font19">/usr/src/linux-source-2.6.16/drivers/net/e1000/e1000_main.c</span></p>
<h4><a name="bookmark7393"></a><span class="font25"><a name="bookmark7394"></a>This is very similar to </span><span class="font25" style="font-weight:bold;">/usr/src on Ubuntu</span><span class="font25">, except there is only one kernel here (and it is newer).</span></h4>
<p><span class="font19">paul@laika:~$ ls -l /usr/src/</span></p>
<p><span class="font19">drwxr-xr-x 23 root root 4096 2008-11-24 23:28 linux-source-2.6.24 paul@laika:~$ find /usr/src -name &quot;e1000_main.c&quot;</span></p>
<p><span class="font19">/usr/src/linux-source-2.6.24/drivers/net/e1000/e1000_main.c</span></p>
<p><span class="font25">Now take a look at </span><span class="font25" style="font-weight:bold;">/usr/src on Red Hat Enterprise Linux</span><span class="font25">.</span></p>
<p><span class="font19">[paul@RHEL52 ~]$ ls -l /usr/src/</span></p>
<p><span class="font19">drwxr-xr-x 5 root root 4096 Dec 5 19:23 kernels</span></p>
<p><span class="font19">drwxr-xr-x 7 root root 4096 Oct 11 13:22 redhat</span></p>
<h4><a name="bookmark7395"></a><span class="font25"><a name="bookmark7396"></a>We will have to dig a little deeper to find the kernel source on Red Hat!</span></h4>
<p><span class="font19">[paul@RHEL52 ~]$ cd /usr/src/redhat/BUILD/</span></p>
<p><span class="font19">[paul@RHEL52 BUILD]$ find . -name &quot;e1000_main.c&quot;</span></p>
<p><span class="font19">./kernel-2.6.18/linux-2.6.18.i686/drivers/net/e1000/e1000_main.c</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7397"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7398"></a>28.2.3. downloading the kernel source</span></h3></li></ul>
<p><span class="font7" style="font-weight:bold;">Debian</span></p>
<h4><a name="bookmark7399"></a><span class="font25"><a name="bookmark7400"></a><a name="bookmark7401"></a>Installing the kernel source on Debian is really simple with </span><span class="font25" style="font-weight:bold;">aptitude install linux-source</span><span class="font25">.</span><br><br><span class="font25"><a name="bookmark7402"></a>You can do a search for all linux-source packeges first, like in this screenshot.</span></h4>
<div>
<p><span class="font19">linux-source</span></p>
</div><br clear="all">
<p><span class="font19">root@barry:~# aptitude search v &nbsp;&nbsp;linux-source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span></p>
<p><span class="font19">v &nbsp;&nbsp;linux-source-2.6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span></p>
<p><span class="font19">id &nbsp;linux-source-2.6.15 &nbsp;&nbsp;&nbsp;- Linux</span></p>
<p><span class="font19">i &nbsp;&nbsp;linux-source-2.6.16 &nbsp;&nbsp;&nbsp;- Linux</span></p>
<p><span class="font19">p &nbsp;&nbsp;linux-source-2.6.18 &nbsp;&nbsp;&nbsp;- Linux</span></p>
<p><span class="font19">p &nbsp;&nbsp;linux-source-2.6.24 &nbsp;&nbsp;&nbsp;- Linux</span></p>
<p><span class="font19">kernel source for version 2.6.15</span></p>
<p><span class="font19">kernel source for version 2.6.16</span></p>
<p><span class="font19">kernel source for version 2.6.18</span></p>
<p><span class="font19">kernel source for version 2.6.24</span></p>
<h4><a name="bookmark7403"></a><span class="font25"><a name="bookmark7404"></a>And then use </span><span class="font25" style="font-weight:bold;">aptitude install </span><span class="font25">to download and install the Debian Linux kernel source code.</span></h4>
<p><span class="font19">root@barry:~# aptitude install linux-source-2.6.24</span></p>
<h4><a name="bookmark7405"></a><span class="font25"><a name="bookmark7406"></a>When the aptitude is finished, you will see a new file named </span><span class="font25" style="font-weight:bold;">/usr/src/linux-source-&lt;version&gt;.tar.bz2</span></h4>
<p><span class="font19">root@barry:/usr/src# ls drwxr-xr-x 20 root root drwxr-xr-x 19 root root -rw-r--r-- 1 root root</span></p>
<p><span class="font19">-lh</span></p>
<p><span class="font19">4.0K 2006-04-04 22:12</span></p>
<p><span class="font19">4.0K 2006-07-15 17:32</span></p>
<p><span class="font19">45M 2008-12-02 10:56</span></p>
<div>
<p><span class="font19">linux-source-2.6.15</span></p>
<p><span class="font19">linux-source-2.6.16</span></p>
<p><span class="font19">linux-source-2.6.24.tar.bz2</span></p>
</div><br clear="all">
<p><span class="font7" style="font-weight:bold;">Ubuntu</span></p>
<h4><a name="bookmark7407"></a><span class="font25"><a name="bookmark7408"></a>Ubuntu is based on Debian and also uses </span><span class="font25" style="font-weight:bold;">aptitude</span><span class="font25">, so the task is very similar.</span></h4>
<p><span class="font19">root@laika:~# aptitude search linux-source</span></p>
<p><span class="font19">i linux-source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- Linux kernel source with Ubuntu patches</span></p>
<p><span class="font19">v linux-source-2.6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span></p>
<p><span class="font19">i A linux-source-2.6.24 - Linux kernel source for version 2.6.24 root@laika:~# aptitude install linux-source</span></p>
<h4><a name="bookmark7409"></a><span class="font25"><a name="bookmark7410"></a>And when aptitude finishes, we end up with a </span><span class="font25" style="font-weight:bold;">/usr/src/linux-source-&lt;version&gt;.tar.bz </span><span class="font25">file.</span></h4>
<p><span class="font19">oot@laika:~# ll /usr/src</span></p>
<p><span class="font19">total 45M</span></p>
<p><span class="font19">-rw-r--r-- &nbsp;1 root root 45M 2008-11-24 23:30 linux-source-2.6.24.tar.bz2</span></p>
<p><span class="font7" style="font-weight:bold;">Red Hat Enterprise Linux</span></p>
<p><span class="font25">The Red Hat kernel source is located on the fourth source cdrom. The file is called </span><span class="font25" style="font-weight:bold;">kernel-2.6.9-42.EL.src.rpm </span><span class="font25">(example for RHELv4u4). It is also available online at ftp:// ftp.redhat.com/pub/redhat/linux/enterprise/5Server/en/os/SRPMS/ (example for RHEL5).</span></p>
<p><span class="font25">To download the kernel source on RHEL, use this long wget command (on one line, without the trailing \).</span></p>
<p><span class="font19">wget ftp://ftp.redhat.com/pub/redhat/linux/enterprise/5Server/en/os/\ SRPMS/kernel-'uname -r'.src.rpm</span></p>
<p><span class="font25">When the wget download is finished, you end up with a 60M .rpm file.</span></p>
<p><span class="font19">[root@RHEL52 src]# ll total 60M</span></p>
<p><span class="font19">-rw-r--r-- 1 root root &nbsp;60M Dec &nbsp;5 20:54 kernel-2.6.18-92.1.17.el5.src.rpm</span></p>
<p><span class="font19">drwxr-xr-x 5 root root 4.0K Dec &nbsp;5 19:23 kernels</span></p>
<p><span class="font19">drwxr-xr-x 7 root root 4.0K Oct 11 13:22 redhat</span></p>
<p><span class="font25">We will need to perform some more steps before this can be used as kernel source code.</span></p>
<p><span class="font25">First, we issue the </span><span class="font25" style="font-weight:bold;">rpm -i kernel-2.6.9-42.EL.src.rpm </span><span class="font25">command to install this Red Hat package.</span></p>
<p><span class="font19">[root@RHEL52 src]# ll</span></p>
<p><span class="font19">total 60M</span></p>
<p><span class="font19">-rw-r--r-- 1 root root &nbsp;60M Dec &nbsp;5 20:54 kernel-2.6.18-92.1.17.el5.src.rpm</span></p>
<p><span class="font19">drwxr-xr-x 5 root root 4.0K Dec &nbsp;5 19:23 kernels</span></p>
<p><span class="font19">drwxr-xr-x 7 root root 4.0K Oct 11 13:22 redhat</span></p>
<p><span class="font19">[root@RHEL52 src]# rpm -i kernel-2.6.18-92.1.17.el5.src.rpm</span></p>
<p><span class="font25">Then we move to the SPECS directory and perform an </span><span class="font25" style="font-weight:bold;">rpmbuild</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL52 ~]# cd /usr/src/redhat/SPECS [root@RHEL52 SPECS]# rpmbuild -bp -vv --target=i686 kernel-2.6.spec</span></p>
<p><span class="font25">The rpmbuild command put the RHEL Linux kernel source code in </span><span class="font25" style="font-weight:bold;">/usr/src/redhat/BUILD/ kernel-&lt;version&gt;/</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL52 kernel-2.6.18]# pwd</span></p>
<p><span class="font19">/usr/src/redhat/BUILD/kernel-2.6.18</span></p>
<p><span class="font19">[root@RHEL52 kernel-2.6.18]# ll</span></p>
<p><span class="font19">total 20K</span></p>
<p><span class="font19">drwxr-xr-x &nbsp;2 root root 4.0K Dec &nbsp;6 &nbsp;2007 config</span></p>
<p><span class="font19">-rw-r--r-- &nbsp;1 root root 3.1K Dec &nbsp;5 20:58 Config.mk</span></p>
<p><span class="font19">drwxr-xr-x 20 root root 4.0K Dec 5 20:58 linux-2.6.18.i686</span></p>
<p><span class="font19">drwxr-xr-x 19 root root 4.0K Sep 20 &nbsp;2006 vanilla</span></p>
<p><span class="font19">drwxr-xr-x &nbsp;8 root root 4.0K Dec &nbsp;6 &nbsp;2007 xen</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7411"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6204"></a><a name="bookmark7412"></a>28.3. kernel boot files</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark7413"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7414"></a>28.3.1. vmlinuz</span></h3></li></ul></li></ul>
<h4><a name="bookmark7415"></a><span class="font25"><a name="bookmark7416"></a><a name="bookmark7417"></a>The </span><span class="font25" style="font-weight:bold;">vmlinuz </span><span class="font25">file in /boot is the compressed kernel.</span></h4>
<p><span class="font19">paul@barry:~$ ls -Ih /boot | grep vmlinuz</span></p>
<p><span class="font19">-rw-r--r-- 1 root root 1.2M 2006-03-06 16:22 vmlinuz-2.6.15-1-486</span></p>
<p><span class="font19">-rw-r--r-- 1 root root 1.1M 2006-03-06 16:30 vmlinuz-2.6.15-1-686</span></p>
<p><span class="font19">-rw-r--r-- 1 root root 1.3M 2008-02-11 00:00 vmlinuz-2.6.18-6-686</span></p>
<p><span class="font19">paul@barry:~$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7418"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7419"></a>28.3.2. initrd</span></h3></li></ul>
<h4><a name="bookmark7420"></a><span class="font25"><a name="bookmark7421"></a><a name="bookmark7422"></a>The kernel uses </span><span class="font25" style="font-weight:bold;">initrd </span><span class="font25">(an initial RAM disk) at boot time. The initrd is mounted before the kernel loads, and can contain additional drivers and modules. It is a </span><span class="font25" style="font-weight:bold;">compressed cpio archive</span><span class="font25">, so you can look at the contents in this way.</span></h4>
<p><span class="font19">root@RHELv4u4:/boot# mkdir /mnt/initrd</span></p>
<p><span class="font19">root@RHELv4u4:/boot# cp initrd-2.6.9-42.0.3.EL.img TMPinitrd.gz</span></p>
<p><span class="font19">root@RHELv4u4:/boot# gunzip TMPinitrd.gz</span></p>
<p><span class="font19">root@RHELv4u4:/boot# file TMPinitrd</span></p>
<p><span class="font19">TMPinitrd: ASCII cpio archive (SVR4 with no CRC)</span></p>
<p><span class="font19">root@RHELv4u4:/boot# cd /mnt/initrd/</span></p>
<p><span class="font19">root@RHELv4u4:/mnt/initrd# cpio -i | /boot/TMPinitrd 4985 blocks</span></p>
<p><span class="font19">root@RHELv4u4:/mnt/initrd# ls -l</span></p>
<div>
<p><span class="font19">total 76 drwxr-xr-x drwxr-xr-x drwxr-xr-x -rwxr-xr-x drwxr-xr-x drwxr-xr-x drwxr-xr-x lrwxrwxrwx drwxr-xr-x drwxr-xr-x</span></p>
</div><br clear="all">
<div>
<p><span class="font19">2 root root 4096 Feb</span></p>
<p><span class="font19">2 root root 4096 Feb</span></p>
<p><span class="font19">4 root root 4096 Feb</span></p>
<p><span class="font19">1 root root 1607 Feb</span></p>
<p><span class="font19">2 root root 4096 Feb</span></p>
<p><span class="font19">2 root root 4096 Feb</span></p>
<p><span class="font19">2 root root 4096 Feb</span></p>
<p><span class="font19">1 root root &nbsp;&nbsp;&nbsp;3 Feb</span></p>
<p><span class="font19">2 root root 4096 Feb</span></p>
<p><span class="font19">2 root root 4096 Feb</span></p>
</div><br clear="all">
<div>
<p><span class="font19">5 08:36 bin</span></p>
<p><span class="font19">5 08:36 dev</span></p>
<p><span class="font19">5 08:36 etc</span></p>
<p><span class="font19">5 08:36 init</span></p>
<p><span class="font19">5 08:36 lib</span></p>
<p><span class="font19">5 08:36 loopfs</span></p>
<p><span class="font19">5 08:36 proc</span></p>
<p><span class="font19">5 08:36 sbin -&gt; bin</span></p>
<p><span class="font19">5 08:36 sys</span></p>
<p><span class="font19">5 08:36 sysroot</span></p>
</div><br clear="all">
<div>
<p><span class="font19">root@RHELv4u4:/mnt/initrd#</span></p>
</div><br clear="all">
<ul style="list-style:none;"><li>
<h3><a name="bookmark7423"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7424"></a>28.3.3. System.map</span></h3></li></ul>
<p><a name="bookmark7425"></a><span class="font25"><a name="bookmark7426"></a>The </span><span class="font25" style="font-weight:bold;">System.map </span><span class="font25">contains the symbol table and changes with every kernel compile. The symbol table is also present in </span><span class="font25" style="font-weight:bold;">/proc/kallsyms </span><span class="font25">(pre 2.6 kernels name this file /proc/ksyms).</span></p>
<p><span class="font19">root@RHELv4u4:/boot# head System.map-'uname -r' 00000400 A __kernel_vsyscall</span></p>
<p><span class="font19">0000041a A SYSENTER_RETURN_OFFSET 00000420 A &nbsp;kernel_sigreturn 00000440 A &nbsp;kernel_rt_sigreturn C0100000 A _text C0100000 T startup_32 c01000c6 t checkCPUtype C0100147 t is486 c010014e t is386 c010019f t L6 root@RHELv4u4:/boot# head /proc/kallsyms c0100228 t _stext c0100228 t calibrate_delay_direct c0100228 t stext c0100337 t calibrate_delay c01004db t rest_init c0100580 t do_pre_smp_initcalls c0100585 t run_init_process c01005ac t init c0100789 t early_param_test c01007ad t early_setup_test root@RHELv4u4:/boot#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4692"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7427"></a>28.3.4. .config</span></h3></li></ul>
<p><span class="font25">The last file copied to the /boot directory is the kernel configuration used for compilation. This file is not necessary in the /boot directory, but it is common practice to put a copy there. It allows you to recompile a kernel, starting from the same configuration as an existing working one.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7428"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6205"></a><a name="bookmark7429"></a>28.4. Linux kernel modules</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark7342"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7430"></a>28.4.1. about kernel modules</span></h3></li></ul></li></ul>
<p><span class="font25">The Linux kernel is a monolithic kernel with loadable modules. These modules contain parts of the kernel used typically for device drivers, file systems and network protocols. Most of the time the necessary kernel modules are loaded automatically and dynamically without administrator interaction.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7431"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7432"></a>28.4.2. /lib/modules</span></h3></li></ul>
<p><a name="bookmark7433"></a><span class="font25">The modules are stored in the </span><span class="font25" style="font-weight:bold;">/lib/modules/&lt;kernel-version&gt; </span><span class="font25">directory. There is a separate directory for each kernel that was compiled for your system.</span></p>
<p><span class="font19">paul@laika:~$ ll /lib/modules/</span></p>
<p><span class="font19">total 12K</span></p>
<p><span class="font19">drwxr-xr-x 7 root root 4.0K 2008-11-10 14:32 2.6.24-16-generic</span></p>
<p><span class="font19">drwxr-xr-x 8 root root 4.0K 2008-12-06 15:39 2.6.24-21-generic</span></p>
<p><span class="font19">drwxr-xr-x 8 root root 4.0K 2008-12-05 12:58 2.6.24-22-generic</span></p>
<h3><a name="bookmark7434"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7435"></a>28.4.3. &lt;module&gt;.ko</span></h3>
<p><span class="font25">The file containing the modules usually ends in </span><span class="font25" style="font-weight:bold;">.ko</span><span class="font25">. This screenshot shows the location of the isdn module files.</span></p>
<p><span class="font19">paul@laika:~$ find /lib/modules -name isdn.ko</span></p>
<p><span class="font19">/lib/modules/2.6.24-21-generic/kernel/drivers/isdn/i4l/isdn.ko</span></p>
<p><span class="font19">/lib/modules/2.6.24-22-generic/kernel/drivers/isdn/i4l/isdn.ko</span></p>
<p><span class="font19">/lib/modules/2.6.24-16-generic/kernel/drivers/isdn/i4l/isdn.ko</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7436"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7437"></a>28.4.4. lsmod</span></h3></li></ul>
<p><a name="bookmark7438"></a><span class="font25">To see a list of currently loaded modules, use </span><span class="font25" style="font-weight:bold;">lsmod</span><span class="font25">. You see the name of each loaded module, the size, the use count, and the names of other modules using this one.</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[root@RHEL52</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~]# lsmod | head</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">-5</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Module</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Size</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Used by</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">autofs4</span></p></td><td style="vertical-align:top;">
<p><span class="font19">24517</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">hidp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">23105</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">rfcomm</span></p></td><td style="vertical-align:top;">
<p><span class="font19">42457</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">l2cap</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">29505</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10 hidp,rfcomm</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7439"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7440"></a>28.4.5. /proc/modules</span></h3></li></ul>
<h4><a name="bookmark7441"></a><span class="font25" style="font-weight:bold;"><a name="bookmark7442"></a><a name="bookmark7443"></a><a name="bookmark7444"></a>/proc/modules </span><span class="font25">lists all modules loaded by the kernel. The output would be too long to display here, so lets </span><span class="font25" style="font-weight:bold;">grep </span><span class="font25">for the </span><span class="font25" style="font-weight:bold;">vm </span><span class="font25">module.</span></h4>
<h4><a name="bookmark7445"></a><span class="font25"><a name="bookmark7446"></a><a name="bookmark7447"></a>We see that vmmon and vmnet are both loaded. You can display the same information with </span><span class="font25" style="font-weight:bold;">lsmod</span><span class="font25">. Actually </span><span class="font25" style="font-weight:bold;">lsmod </span><span class="font25">only reads and reformats the output of </span><span class="font25" style="font-weight:bold;">/proc/modules</span><span class="font25">.</span></h4>
<p><span class="font19">paul@laika:~$ cat /proc/modules | grep vm vmnet 36896 13 - Live 0xffffffff88b21000 (P) vmmon 194540 0 - Live 0xffffffff88af0000 (P) paul@laika:~$ lsmod | grep vm vmnet &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;36896 13</span></p>
<p><span class="font19">vmmon &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;194540 0</span></p>
<p><span class="font19">paul@laika:~$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7448"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7449"></a>28.4.6. module dependencies</span></h3></li></ul>
<h4><a name="bookmark7450"></a><span class="font25"><a name="bookmark7451"></a>Some modules depend on others. In the following example, you can see that the nfsd module is used by exportfs, lockd and sunrpc.</span></h4>
<p><span class="font19">paul@laika:~$ cat /proc/modules | grep nfsd nfsd 267432 17 - Live 0xffffffff88a40000 exportfs 7808 1 nfsd, Live 0xffffffff88a3d000 lockd 73520 3 nfs,nfsd, Live 0xffffffff88a2a000 sunrpc 185032 12 nfs,nfsd,lockd, Live 0xffffffff889fb000 paul@laika:~$ lsmod | grep nfsd nfsd &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;267432 &nbsp;17</span></p>
<p><span class="font19">exportfs &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7808 &nbsp;1 nfsd</span></p>
<p><span class="font19">lockd &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;73520 &nbsp;3 nfs,nfsd</span></p>
<p><span class="font19">sunrpc &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;185032 &nbsp;12 nfs,nfsd,lockd</span></p>
<p><span class="font19">paul@laika:~$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7452"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7453"></a>28.4.7. insmod</span></h3></li></ul>
<p><a name="bookmark7454"></a><span class="font25">Kernel modules can be manually loaded with the </span><span class="font25" style="font-weight:bold;">insmod </span><span class="font25">command. This is a very simple (and obsolete) way of loading modules. The screenshot shows </span><span class="font25" style="font-weight:bold;">insmod </span><span class="font25">loading the fat module (for fat file system support).</span></p>
<p><span class="font19">root@barry:/lib/modules/2.6.17-2-686# lsmod | grep fat</span></p>
<p><span class="font19">root@barry:/lib/modules/2.6.17-2-686# insmod kernel/fs/fat/fat.ko</span></p>
<p><span class="font19">root@barry:/lib/modules/2.6.17-2-686# lsmod | grep fat fat &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;46588 &nbsp;0</span></p>
<p><span class="font25" style="font-weight:bold;">insmod </span><span class="font25">is not detecting dependencies, so it fails to load the isdn module (because the isdn module depends on the slhc module).</span></p>
<p><span class="font19">[root@RHEL52 drivers]# pwd</span></p>
<p><span class="font19">/lib/modules/2.6.18-92.1.18.el5/kernel/drivers</span></p>
<p><span class="font19">[root@RHEL52 kernel]# insmod isdn/i4l/isdn.ko</span></p>
<p><span class="font19">insmod: error inserting 'isdn/i4l/isdn.ko': -1 Unknown symbol in module</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7455"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7456"></a>28.4.8. modinfo</span></h3></li></ul>
<p><a name="bookmark7457"></a><span class="font25">As you can see in the screenshot of </span><span class="font25" style="font-weight:bold;">modinfo </span><span class="font25">below, the isdn module depends in the slhc</span></p>
<p><span class="font25">module.</span></p>
<p><span class="font19">[root@RHEL52 drivers]# modinfo isdn/i4l/isdn.ko | head -6</span></p>
<div>
<p><span class="font19">filename: license: author: description: srcversion: depends:</span></p>
</div><br clear="all">
<p><span class="font19">isdn/i4l/isdn.ko</span></p>
<p><span class="font19">GPL</span></p>
<p><span class="font19">Fritz Elfert</span></p>
<p><span class="font19">ISDN4Linux: link layer 99650346E708173496F6739 slhc</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7458"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7459"></a>28.4.9. modprobe</span></h3></li></ul>
<p><a name="bookmark7460"></a><span class="font25"><a name="bookmark7461"></a>The big advantage of </span><span class="font25" style="font-weight:bold;">modprobe </span><span class="font25">over </span><span class="font25" style="font-weight:bold;">insmod </span><span class="font25">is that modprobe will load all necessary modules, whereas insmod requires manual loading of dependencies. Another advantage is that you don't need to point to the filename with full path.</span></p>
<p><span class="font25">This screenshot shows how modprobe loads the isdn module, automatically loading slhc in background.</span></p>
<p><span class="font19">[root@RHEL52 kernel]# lsmod | grep isdn</span></p>
<p><span class="font19">[root@RHEL52 kernel]# modprobe isdn</span></p>
<p><span class="font19">[root@RHEL52 kernel]# lsmod | grep isdn</span></p>
<p><span class="font19">isdn &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;122433 0</span></p>
<p><span class="font19">slhc &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10561 1 isdn</span></p>
<p><span class="font19">[root@RHEL52 kernel]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7462"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7463"></a>28.4.10. /lib/modules/&lt;kernel&gt;/modules.dep</span></h3></li></ul>
<h4><a name="bookmark7464"></a><span class="font25"><a name="bookmark7465"></a><a name="bookmark7466"></a>Module dependencies are stored in </span><span class="font25" style="font-weight:bold;">modules.dep</span><span class="font25">.</span></h4>
<p><span class="font19">[root@RHEL52 2.6.18-92.1.18.el5]# pwd</span></p>
<p><span class="font19">/lib/modules/2.6.18-92.1.18.el5</span></p>
<p><span class="font19">[root@RHEL52 2.6.18-92.1.18.el5]# head -3 modules.dep</span></p>
<p><span class="font19">/lib/modules/2.6.18-92.1.18.el5/kernel/drivers/net/tokenring/3c359.ko:</span></p>
<p><span class="font19">/lib/modules/2.6.18-92.1.18.el5/kernel/drivers/net/pcmcia/3c574_cs.ko: /lib/modules/2.6.18-92.1.18.el5/kernel/drivers/net/pcmcia/3c589_cs.ko:</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7467"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7468"></a>28.4.11. depmod</span></h3></li></ul>
<h4><a name="bookmark7469"></a><span class="font25"><a name="bookmark7470"></a><a name="bookmark7471"></a>The </span><span class="font25" style="font-weight:bold;">modules.dep </span><span class="font25">file can be updated (recreated) with the </span><span class="font25" style="font-weight:bold;">depmod </span><span class="font25">command. In this screenshot no modules were added, so </span><span class="font25" style="font-weight:bold;">depmod </span><span class="font25">generates the same file.</span></h4>
<p><span class="font19">root@barry:/lib/modules/2.6.17-2-686# ls -l modules.dep</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-r--r-- 1 root root 310676 2008-03-01 16:32 modules.dep</span></p></li></ul>
<p><span class="font19">root@barry:/lib/modules/2.6.17-2-686# depmod</span></p>
<p><span class="font19">root@barry:/lib/modules/2.6.17-2-686# ls -l modules.dep</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-r--r-- 1 root root 310676 2008-12-07 13:54 modules.dep</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7472"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7473"></a>28.4.12. rmmod</span></h3></li></ul>
<h4><a name="bookmark7474"></a><span class="font25"><a name="bookmark7475"></a><a name="bookmark7476"></a>Similar to insmod, the </span><span class="font25" style="font-weight:bold;">rmmod </span><span class="font25">command is rarely used anymore.</span></h4>
<div>
<p><span class="font19">[root@RHELv4u3 ~]# [root@RHELv4u3 ~]# ERROR: Module slhc</span></p>
<p><span class="font19">[root@RHELv4u3 ~]# [root@RHELv4u3 ~]# [root@RHELv4u3 ~]# [root@RHELv4u3 ~]#</span></p>
</div><br clear="all">
<div>
<p><span class="font19">modprobe isdn rmmod slhc</span></p>
<p><span class="font19">is in use by isdn rmmod isdn</span></p>
<p><span class="font19">rmmod slhc</span></p>
<p><span class="font19">lsmod | grep isdn</span></p>
</div><br clear="all">
<ul style="list-style:none;"><li>
<h3><a name="bookmark7477"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7478"></a>28.4.13. modprobe -r</span></h3></li></ul>
<h4><a name="bookmark7479"></a><span class="font25"><a name="bookmark7480"></a><a name="bookmark7481"></a>Contrary to rmmod, </span><span class="font25" style="font-weight:bold;">modprobe </span><span class="font25">will automatically remove unneeded modules.</span></h4>
<p><span class="font19">[root@RHELv4u3 ~]# modprobe isdn</span></p>
<p><span class="font19">[root@RHELv4u3 ~]# lsmod | grep isdn</span></p>
<p><span class="font19">isdn &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;133537 0</span></p>
<p><span class="font19">slhc &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7233 1 isdn</span></p>
<p><span class="font19">[root@RHELv4u3 ~]# modprobe -r isdn [root@RHELv4u3 ~]# lsmod | grep isdn [root@RHELv4u3 ~]# lsmod | grep slhc [root@RHELv4u3 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7482"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7483"></a>28.4.14. /etc/modprobe.conf</span></h3></li></ul>
<h4><a name="bookmark7484"></a><span class="font25"><a name="bookmark7485"></a><a name="bookmark7486"></a><a name="bookmark7487"></a>The </span><span class="font25" style="font-weight:bold;">/etc/modprobe.conf </span><span class="font25">file and the </span><span class="font25" style="font-weight:bold;">/etc/modprobe.d </span><span class="font25">directory can contain aliases (used by humans) and options (for dependent modules) for modprobe.</span></h4>
<p><span class="font19">[root@RHEL52 ~]# cat /etc/modprobe.conf alias scsi_hostadapter mptbase alias scsi_hostadapter1 mptspi alias scsi_hostadapter2 ata_piix alias eth0 pcnet32 alias eth2 pcnet32</span></p>
<p><span class="font19">alias ethl pcnet32</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7488"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6206"></a><a name="bookmark7489"></a>28.5. compiling a kernel</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark7490"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7491"></a>28.5.1. extraversion</span></h3></li></ul></li></ul>
<p><span class="font25">Enter into </span><span class="font25" style="font-weight:bold;">/usr/src/redhat/BUILD/kernel-2.6.9/linux-2.6.9/ </span><span class="font25">and change the </span><span class="font25" style="font-weight:bold;">extraversion </span><span class="font25">in the Makefile.</span></p>
<p><span class="font19">[root@RHEL52 linux-2.6.18.i686]# pwd</span></p>
<p><span class="font19">/usr/src/redhat/BUILD/kernel-2.6.18/linux-2.6.18.i686</span></p>
<p><span class="font19">[root@RHEL52 linux-2.6.18.i686]# vi Makefile</span></p>
<p><span class="font19">[root@RHEL52 linux-2.6.18.i686]# head -4 Makefile</span></p>
<p><span class="font19">VERSION = 2</span></p>
<p><span class="font19">PATCHLEVEL = 6</span></p>
<p><span class="font19">SUBLEVEL = 18</span></p>
<p><span class="font19">EXTRAVERSION = -paul2008</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7492"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7493"></a>28.5.2. make mrproper</span></h3></li></ul>
<p><a name="bookmark7494"></a><span class="font25">Now clean up the source from any previous installs with </span><span class="font25" style="font-weight:bold;">make mrproper</span><span class="font25">. If this is your first after downloading the source code, then this is not needed.</span></p>
<p><span class="font19">[root@RHEL52 linux-2.6.18.i686]# make mrproper</span></p>
<p><span class="font19">CLEAN scripts/basic</span></p>
<p><span class="font19">CLEAN scripts/kconfig</span></p>
<p><span class="font19">CLEAN include/config</span></p>
<p><span class="font19">CLEAN .config .config.old</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7495"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7496"></a>28.5.3. .config</span></h3></li></ul>
<p><span class="font25">Now copy a working </span><span class="font25" style="font-weight:bold;">.config </span><span class="font25">from /boot to our kernel directory. This file contains the configuration that was used for your current working kernel. It determines whether modules are included in compilation or not.</span></p>
<p><span class="font19">[root@RHEL52 linux-2.6.18.i686]# cp /boot/config-2.6.18-92.1.18.el5 .config</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7497"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7498"></a>28.5.4. make menuconfig</span></h3></li></ul>
<p><a name="bookmark7499"></a><span class="font25"><a name="bookmark7500"></a>Now run </span><span class="font25" style="font-weight:bold;">make menuconfig </span><span class="font25">(or the graphical </span><span class="font25" style="font-weight:bold;">make xconfig</span><span class="font25">). This tool allows you to select whether to compile stuff as a module (m), as part of the kernel (*), or not at all (smaller kernel size). If you remove too much, your kernel will not work. The configuration will be stored in the hidden </span><span class="font25" style="font-weight:bold;">.config </span><span class="font25">file.</span></p>
<p><span class="font19">[root@RHEL52 linux-2.6.18.i686]# make menuconfig</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7501"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7502"></a>28.5.5. make clean</span></h3></li></ul>
<p><a name="bookmark7503"></a><span class="font25">Issue a </span><span class="font25" style="font-weight:bold;">make clean </span><span class="font25">to prepare the kernel for compile. </span><span class="font25" style="font-weight:bold;">make clean </span><span class="font25">will remove most generated files, but keeps your kernel configuration. Running a </span><span class="font25" style="font-weight:bold;">make mrproper </span><span class="font25">at this point would destroy the .config file that you built with </span><span class="font25" style="font-weight:bold;">make menuconfig</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL52 linux-2.6.18.i686]# make clean</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7504"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7505"></a>28.5.6. make bzImage</span></h3></li></ul>
<p><a name="bookmark7506"></a><span class="font25"><a name="bookmark7507"></a>And then run </span><span class="font25" style="font-weight:bold;">make bzImage</span><span class="font25">, sit back and relax while the kernel compiles. You can use </span><span class="font25" style="font-weight:bold;">time make bzImage </span><span class="font25">to know how long it takes to compile, so next time you can go for a short walk.</span></p>
<p><span class="font19">[root@RHEL52 linux-2.6.18.i686]# time make bzImage</span></p>
<p><span class="font19">HOSTCC scripts/basic/fixdep</span></p>
<p><span class="font19">HOSTCC scripts/basic/docproc</span></p>
<p><span class="font19">HOSTCC scripts/kconfig/conf.o</span></p>
<p><span class="font19">HOSTCC scripts/kconfig/kxgettext.o</span></p>
<p><span class="font25">This command will end with telling you the location of the </span><span class="font25" style="font-weight:bold;">bzImage </span><span class="font25">file (and with time info if you also specified the time command.</span></p>
<p><span class="font19">Kernel: arch/i386/boot/bzImage is ready (#1)</span></p>
<p><span class="font19">real 13m59.573s</span></p>
<p><span class="font19">user 1m22.631s</span></p>
<p><span class="font19">sys 11m51.034s</span></p>
<p><span class="font19">[root@RHEL52 linux-2.6.18.i686]#</span></p>
<p><span class="font25">You can already copy this image to /boot with </span><span class="font25" style="font-weight:bold;">cp arch/i386/boot/bzImage /boot/vmlinuz-&lt;kernel-version&gt;</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7508"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7509"></a>28.5.7. make modules</span></h3></li></ul>
<p><a name="bookmark7510"></a><span class="font25">Now run </span><span class="font25" style="font-weight:bold;">make modules</span><span class="font25">. It can take 20 to 50 minutes to compile all the modules.</span></p>
<p><span class="font19">[root@RHEL52 linux-2.6.18.i686]# time make modules</span></p>
<p><span class="font19">CHK include/linux/version.h</span></p>
<p><span class="font19">CHK include/linux/utsrelease.h</span></p>
<p><span class="font19">CC [M] arch/i386/kernel/msr.o</span></p>
<p><span class="font19">CC [M] arch/i386/kernel/cpuid.o</span></p>
<p><span class="font19">CC [M] arch/i386/kernel/microcode.o</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7511"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7512"></a>28.5.8. make modules_install</span></h3></li></ul>
<p><a name="bookmark7513"></a><span class="font25">To copy all the compiled modules to </span><span class="font25" style="font-weight:bold;">/lib/modules </span><span class="font25">just run </span><span class="font25" style="font-weight:bold;">make modules_install </span><span class="font25">(takes about 20 seconds). Here's a screenshot from before the command.</span></p>
<p><span class="font19">[root@RHEL52 linux-2.6.18.i686]# ls -l /lib/modules/</span></p>
<p><span class="font19">total 20</span></p>
<p><span class="font19">drwxr-xr-x 6 root root 4096 Oct 15 13:09 2.6.18-92.1.13.el5</span></p>
<p><span class="font19">drwxr-xr-x 6 root root 4096 Nov 11 08:51 2.6.18-92.1.17.el5</span></p>
<p><span class="font19">drwxr-xr-x 6 root root 4096 Dec &nbsp;6 07:11 2.6.18-92.1.18.el5</span></p>
<p><span class="font19">[root@RHEL52 linux-2.6.18.i686]# make modules_install</span></p>
<p><span class="font25">And here is the same directory after. Notice that </span><span class="font25" style="font-weight:bold;">make modules_install </span><span class="font25">created a new directory for the new kernel.</span></p>
<p><span class="font19">[root@RHEL52 linux-2.6.18.i686]# ls -l /lib/modules/</span></p>
<p><span class="font19">total 24</span></p>
<p><span class="font19">drwxr-xr-x 6 root root 4096 Oct 15 13:09 2.6.18-92.1.13.el5</span></p>
<p><span class="font19">drwxr-xr-x 6 root root 4096 Nov 11 08:51 2.6.18-92.1.17.el5</span></p>
<p><span class="font19">drwxr-xr-x 6 root root 4096 Dec &nbsp;6 07:11 2.6.18-92.1.18.el5</span></p>
<p><span class="font19">drwxr-xr-x 3 root root 4096 Dec &nbsp;6 08:50 2.6.18-paul2008</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7514"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7515"></a>28.5.9. /boot</span></h3></li></ul>
<p><span class="font25">We still need to copy the kernel, the System.map and our configuration file to /boot. Strictly speaking the .config file is not obligatory, but it might help you in future compilations of the kernel.</span></p>
<p><span class="font19">[root@RHEL52 ]# pwd</span></p>
<p><span class="font19">/usr/src/redhat/BUILD/kernel-2.6.18/linux-2.6.18.i686</span></p>
<p><span class="font19">[root@RHEL52 ]# cp System.map /boot/System.map-2.6.18-paul2008</span></p>
<p><span class="font19">[root@RHEL52 ]# cp .config /boot/config-2.6.18-paul2008</span></p>
<p><span class="font19">[root@RHEL52 ]# cp arch/i386/boot/bzImage /boot/vmlinuz-2.6.18-paul2008</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7516"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7517"></a>28.5.10. mkinitrd</span></h3></li></ul>
<p><a name="bookmark7518"></a><span class="font25">The kernel often uses an initrd file at bootup. We can use </span><span class="font25" style="font-weight:bold;">mkinitrd </span><span class="font25">to generate this file.</span></p>
<p><span class="font25">Make sure you use the correct kernel name!</span></p>
<p><span class="font19">[root@RHEL52 ]# pwd</span></p>
<p><span class="font19">/usr/src/redhat/BUILD/kernel-2.6.18/linux-2.6.18.i686</span></p>
<p><span class="font19">[root@RHEL52 ]# mkinitrd /boot/initrd-2.6.18-paul2008 2.6.18-paul2008</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark6451"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7519"></a>28.5.11. bootloader</span></h3></li></ul>
<p><span class="font25">Compilation is now finished, don't forget to create an additional stanza in grub or lilo.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7520"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6207"></a><a name="bookmark7521"></a>28.6. compiling one module</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark7522"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7523"></a>28.6.1. hello.c</span></h3></li></ul></li></ul>
<h4><a name="bookmark7524"></a><span class="font25"><a name="bookmark7525"></a>A little C program that will be our module.</span></h4>
<p><span class="font19">[root@rhel4a kernel_module]# cat hello.c</span></p>
<p><span class="font19">#include &lt;linux/module.h&gt;</span></p>
<p><span class="font19">#include &lt;section&gt;</span></p>
<p><span class="font19">int init_module(void) {</span></p>
<p><span class="font19">printk(KERN_INFO &quot;Start Hello World...\n&quot;); return 0;</span></p>
<p><span class="font19">}</span></p>
<p><span class="font19">void cleanup_module(void)</span></p>
<p><span class="font19">{ printk(KERN_INFO &quot;End Hello World... \n&quot;);</span></p>
<p><span class="font19">}</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7526"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7527"></a>28.6.2. Makefile</span></h3></li></ul>
<h4><a name="bookmark7528"></a><span class="font25"><a name="bookmark7529"></a>The make file for this module.</span></h4>
<p><span class="font19">[root@rhel4a kernel_module]# cat Makefile obj-m += hello.o all:</span></p>
<p><span class="font19">make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules clean:</span></p>
<p><span class="font19">make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean</span></p>
<h4><a name="bookmark7530"></a><span class="font25"><a name="bookmark7531"></a>These are the only two files needed.</span></h4>
<p><span class="font19">[root@rhel4a kernel_module]# ll total 16</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-rw-r-- 1 paul paul 250 Feb 15 19:14 hello.c</span></p></li>
<li>
<p><span class="font19">-rw-rw-r-- 1 paul paul 153 Feb 15 19:15 Makefile</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7532"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7533"></a>28.6.3. make</span></h3></li></ul>
<h4><a name="bookmark7534"></a><span class="font25"><a name="bookmark7535"></a><a name="bookmark7536"></a>The running of the </span><span class="font25" style="font-weight:bold;">make </span><span class="font25">command.</span></h4>
<p><span class="font19">[root@rhel4a kernel_module]# make</span></p>
<p><span class="font19">make -C /lib/modules/2.6.9-paul-2/build M=~/kernel_module modules</span></p>
<p><span class="font19">make[1]: Entering dir... '/usr/src/redhat/BUILD/kernel-2.6.9/linux-2.6.9'</span></p>
<p><span class="font19">CC [M] /home/paul/kernel_module/hello.o</span></p>
<p><span class="font19">Building modules, stage 2.</span></p>
<p><span class="font19">MODPOST</span></p>
<p><span class="font19">CC /home/paul/kernel_module/hello.mod.o</span></p>
<p><span class="font19">LD [M] /home/paul/kernel_module/hello.ko</span></p>
<p><span class="font19">make[1]: Leaving dir... '/usr/src/redhat/BUILD/kernel-2.6.9/linux-2.6.9‘</span></p>
<p><span class="font19">[root@rhel4a kernel_module]#</span></p>
<h4><a name="bookmark7537"></a><span class="font25"><a name="bookmark7538"></a>Now we have more files.</span></h4>
<p><span class="font19">[root@rhel4a kernel_module]# ll total 172</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">-rw-rw-r-- 1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">250</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">19:14</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">hello.c</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-rw-r--r-- 1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">64475</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:top;">
<p><span class="font19">15</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19:15</span></p></td><td style="vertical-align:top;">
<p><span class="font19">hello.ko</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">-rw-r--r-- 1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">632</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">19:15</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">hello.mod.c</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">-rw-r--r-- &nbsp;1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">37036</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">19:15</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">hello.mod.o</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">-rw-r--r-- 1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">28396</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">19:15</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">hello.o</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-rw-rw-r-- 1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">153</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:top;">
<p><span class="font19">15</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19:15</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Makefile</span></p></td></tr>
</table>
<p><span class="font19">[root@rhel4a kernel_module]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7539"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7540"></a>28.6.4. hello.ko</span></h3></li></ul>
<h4><a name="bookmark7541"></a><span class="font25"><a name="bookmark7542"></a><a name="bookmark7543"></a>Use </span><span class="font25" style="font-weight:bold;">modinfo </span><span class="font25">to verify that it is really a module.</span></h4>
<p><span class="font19">[root@rhel4a kernel_module]# modinfo hello.ko</span></p>
<p><span class="font19">filename: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hello.ko</span></p>
<p><span class="font19">vermagic: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.6.9-paul-2 SMP 686 REGPARM 4KSTACKS gcc-3.4</span></p>
<p><span class="font19">depends:</span></p>
<p><span class="font19">[root@rhel4a kernel_module]#</span></p>
<h4><a name="bookmark7544"></a><span class="font25"><a name="bookmark7545"></a>Good, so now we can load our hello module.</span></h4>
<p><span class="font19">[root@rhel4a kernel_module]# lsmod | grep hello</span></p>
<p><span class="font19">[root@rhel4a kernel_module]# insmod ./hello.ko</span></p>
<p><span class="font19">[root@rhel4a kernel_module]# lsmod | grep hello</span></p>
<p><span class="font19">hello &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5504 &nbsp;0</span></p>
<p><span class="font19">[root@rhel4a kernel_module]# tail -1 /var/log/messages Feb 15 19:16:07 rhel4a kernel: Start Hello World...</span></p>
<p><span class="font19">[root@rhel4a kernel_module]# rmmod hello</span></p>
<p><span class="font19">[root@rhel4a kernel_module]#</span></p>
<h4><a name="bookmark7546"></a><span class="font25"><a name="bookmark7547"></a><a name="bookmark7548"></a>Finally </span><span class="font25" style="font-weight:bold;">/var/log/messages </span><span class="font25">has a little surprise.</span></h4>
<p><span class="font19">[root@rhel4a kernel_module]# tail -2 /var/log/messages Feb 15 19:16:07 rhel4a kernel: Start Hello World...</span></p>
<p><span class="font19">Feb 15 19:16:35 rhel4a kernel: End Hello World...</span></p>
<p><span class="font19">[root@rhel4a kernel_module]#</span></p>
<ul style="list-style:none;"><li>
<p><a name="bookmark7549"></a><span class="font11" style="font-weight:bold;">Chapter 29. library management</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7550"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6209"></a><a name="bookmark7551"></a>29.1. introduction</span></h2></li></ul>
<p><a name="bookmark7552"></a><span class="font25">With </span><span class="font25" style="font-weight:bold;">libraries </span><span class="font25">we are talking about dynamically linked libraries (aka shared objects). These are binaries that contain functions and are not started themselves as programs, but are called by other binaries.</span></p>
<p><span class="font25">Several programs can use the same library. The name of the library file usually starts with </span><span class="font25" style="font-weight:bold;">lib</span><span class="font25">, followed by the actual name of the library, then the chracters </span><span class="font25" style="font-weight:bold;">.so </span><span class="font25">and finally a version number.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7553"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6210"></a><a name="bookmark7554"></a>29.2. /lib and /usr/lib</span></h2></li></ul>
<p><a name="bookmark7555"></a><span class="font25"><a name="bookmark7556"></a>When you look at the </span><span class="font25" style="font-weight:bold;">/lib </span><span class="font25">or the </span><span class="font25" style="font-weight:bold;">/usr/lib </span><span class="font25">directory, you will see a lot of symbolic links. Most </span><span class="font25" style="font-weight:bold;">libraries </span><span class="font25">have a detailed version number in their name, but receive a symbolic link from a filename which only contains the major version number.</span></p>
<p><span class="font19">root@rhel53 ~# ls -l /lib/libext*</span></p>
<p><span class="font19">lrwxrwxrwx 1 root root 16 Feb 18 16:36 /lib/libext2fs.so.2 -&gt; libext2fs.so.2.4</span></p>
<p><span class="font19">-rwxr-xr-x 1 root root 113K Jun 30 2009 /lib/libext2fs.so.2.4</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7557"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6211"></a><a name="bookmark7558"></a>29.3. Idd</span></h2></li></ul>
<p><a name="bookmark7559"></a><span class="font25">Many programs have dependencies on the installation of certain libraries. You can display these dependencies with </span><span class="font25" style="font-weight:bold;">ldd</span><span class="font25">.</span></p>
<p><a name="bookmark7560"></a><span class="font25">This example shows the dependencies of the </span><span class="font25" style="font-weight:bold;">su </span><span class="font25">command.</span></p>
<p><span class="font19">paul@RHEL5 ~$ ldd /bin/su</span></p>
<p><span class="font19">linux-gate.so.1 =&gt; &nbsp;(0x003f7000)</span></p>
<p><span class="font19">libpam.so.0 =&gt; /lib/libpam.so.0 (0x00d5c000)</span></p>
<p><span class="font19">libpam_misc.so.0 =&gt; /lib/libpam_misc.so.0 (0x0073c000)</span></p>
<p><span class="font19">libcrypt.so.1 =&gt; /lib/libcrypt.so.1 (0x00aa4000)</span></p>
<p><span class="font19">libdl.so.2 =&gt; /lib/libdl.so.2 (0x00800000)</span></p>
<p><span class="font19">libc.so.6 =&gt; /lib/libc.so.6 (0x00ec1000)</span></p>
<p><span class="font19">libaudit.so.0 =&gt; /lib/libaudit.so.0 (0x0049f000)</span></p>
<p><span class="font19">/lib/ld-linux.so.2 (0x4769c000)</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7561"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6212"></a><a name="bookmark7562"></a>29.4. ltrace</span></h2></li></ul>
<p><a name="bookmark7563"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">ltrace </span><span class="font25">program allows to see all the calls made to library functions by a program. The example below uses the -c option to get only a summary count (there can be many calls), and the -l option to only show calls in one library file. All this to see what calls are made when executing </span><span class="font25" style="font-weight:bold;">su - serena </span><span class="font25">as root.</span></p>
<p><span class="font19">root@deb503:~# ltrace -c -l /lib/libpam.so.0 su - serena serena@deb503:~$ exit</span></p>
<table border="1">
<tr><td rowspan="2" style="vertical-align:middle;">
<p><span class="font19">logout % time</span></p></td><td rowspan="2" style="vertical-align:middle;">
<p><span class="font19">seconds</span></p></td><td rowspan="2" style="vertical-align:middle;">
<p><span class="font19">usecs/call</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">calls &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">70.31</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.014117</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">14117</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1 pam start</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">12.36</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.002482</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2482</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1 pam_open_session</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">5.17</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.001039</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1039</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1 pam_acct_mgmt</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">4.36</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.000876</span></p></td><td style="vertical-align:top;">
<p><span class="font19">876</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1 pam end</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">3.36</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.000675</span></p></td><td style="vertical-align:top;">
<p><span class="font19">675</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1 pam close session</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">3.22</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.000646</span></p></td><td style="vertical-align:top;">
<p><span class="font19">646</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1 pam authenticate</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">0.48</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.000096</span></p></td><td style="vertical-align:top;">
<p><span class="font19">48</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2 pam set item</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">0.27</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0.000054</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">54</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1 pam setcred</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">0.25</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.000050</span></p></td><td style="vertical-align:top;">
<p><span class="font19">50</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1 pam_getenvlist</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">0.22</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.000044</span></p></td><td style="vertical-align:top;">
<p><span class="font19">44</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1 pam_get_item</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">100.00</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">0.020079</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:middle;">
<p><span class="font19">11 total</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7564"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6213"></a><a name="bookmark7565"></a>29.5. dpkg -S and debsums</span></h2></li></ul>
<p><a name="bookmark7566"></a><span class="font25">Find out on Debian/Ubuntu to which package a library belongs.</span></p>
<p><span class="font19">paul@deb503:/lib$ dpkg -S libext2fs.so.2.4</span></p>
<p><span class="font19">e2fslibs: /lib/libext2fs.so.2.4</span></p>
<p><a name="bookmark7567"></a><span class="font25">You can then verify the integrity of all files in this package using </span><span class="font25" style="font-weight:bold;">debsums</span><span class="font25">.</span></p>
<p><span class="font19">paul@deb503:~$ debsums e2fslibs</span></p>
<p><a href="#bookmark7568"><span class="font19">/usr/share/doc/e2fslibs/changelog.Debian.gz</span></a></p>
<p><a href="#bookmark7569"><span class="font19">/usr/share/doc/e2fslibs/copyright</span></a></p>
<p><a href="#bookmark7570"><span class="font19">/lib/libe2p.so.2.3</span></a></p>
<p><a href="#bookmark7571"><span class="font19">/lib/libext2fs.so.2.4</span></a></p>
<p><a name="bookmark7572"></a><span class="font25">Should a library be broken, then reinstall it with </span><span class="font25" style="font-weight:bold;">aptitude reinstall $package</span><span class="font25">.</span></p>
<p><span class="font19">root@deb503:~# aptitude reinstall e2fslibs</span></p>
<p><span class="font19">Reading package lists... Done</span></p>
<p><span class="font19">Building dependency tree</span></p>
<p><span class="font19">Reading state information... Done</span></p>
<p><span class="font19">Reading extended state information</span></p>
<p><span class="font19">Initializing package states... Done</span></p>
<p><span class="font19">Reading task descriptions... Done</span></p>
<p><span class="font19">The following packages will be REINSTALLED: e2fslibs</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7573"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6214"></a><a name="bookmark7574"></a>29.6. rpm -qf and rpm -V</span></h2></li></ul>
<h4><a name="bookmark7575"></a><span class="font25"><a name="bookmark7576"></a><a name="bookmark7577"></a>Find out on Red Hat/Fedora to which package a library belongs.</span></h4>
<p><span class="font19">paul@RHEL5 ~$ rpm -qf /lib/libext2fs.so.2.4</span></p>
<p><span class="font19">e2fsprogs-libs-1.39-8.el5</span></p>
<h4><a name="bookmark7578"></a><span class="font25"><a name="bookmark7579"></a><a name="bookmark7580"></a>You can then use </span><span class="font25" style="font-weight:bold;">rpm -V </span><span class="font25">to verify all files in this package. In the example below the output shows that the </span><span class="font25" style="font-weight:bold;">S</span><span class="font25">ize and the </span><span class="font25" style="font-weight:bold;">T</span><span class="font25">ime stamp of the file have changed since installation.</span></h4>
<p><span class="font19">root@rhel53 ~# rpm -V e2fsprogs-libs</span></p>
<p><span class="font19">prelink: /lib/libext2fs.so.2.4: prelinked file size differs</span></p>
<p><span class="font19">S.?....T /lib/libext2fs.so.2.4</span></p>
<h4><a name="bookmark7581"></a><span class="font25"><a name="bookmark7582"></a><a name="bookmark7583"></a>You can then use </span><span class="font25" style="font-weight:bold;">yum reinstall $package </span><span class="font25">to overwrite the existing library with an original version.</span></h4>
<p><span class="font19">root@rhel53 lib# yum reinstall e2fsprogs-libs</span></p>
<p><span class="font19">Loaded plugins: rhnplugin, security</span></p>
<p><span class="font19">Setting up Reinstall Process</span></p>
<p><span class="font19">Resolving Dependencies</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">--&gt; Running transaction check</span></p>
<p><span class="font19">---&gt; Package e2fsprogs-libs.i386 0:1.39-23.el5</span></p>
<p><span class="font19">---&gt; Package e2fsprogs-libs.i386 0:1.39-23.el5</span></p>
<p><span class="font19">--&gt; Finished Dependency Resolution</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">set to be erased set to be updated</span></p></td></tr>
</table>
<h4><a name="bookmark7584"></a><span class="font25"><a name="bookmark7585"></a>The package verification now reports no problems with the library.</span></h4>
<p><span class="font19">root@rhel53 lib# rpm -V e2fsprogs-libs root@rhel53 lib#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7586"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6215"></a><a name="bookmark7587"></a>29.7. tracing with strace</span></h2></li></ul>
<p><a name="bookmark7588"></a><span class="font25">More detailed tracing of all function calls can be done with </span><span class="font25" style="font-weight:bold;">strace</span><span class="font25">. We start by creating a read only file.</span></p>
<p><span class="font19">root@deb503:~# echo hello &gt;&nbsp;42.txt</span></p>
<p><span class="font19">root@deb503:~# chmod 400 42.txt</span></p>
<p><span class="font19">root@deb503:~# ls -l 42.txt</span></p>
<p><span class="font19">—r-------- 1 root root 6 2011-09-26 12:03 42.txt</span></p>
<p><a name="bookmark7589"></a><span class="font25">We open the file with </span><span class="font25" style="font-weight:bold;">vi</span><span class="font25">, but include the </span><span class="font25" style="font-weight:bold;">strace </span><span class="font25">command with an output file for the trace before </span><span class="font25" style="font-weight:bold;">vi</span><span class="font25">. This will create a file with all the function calls done by </span><span class="font25" style="font-weight:bold;">vi</span><span class="font25">.</span></p>
<p><span class="font19">root@deb503:~# strace -o strace.txt vi 42.txt</span></p>
<p><span class="font25">The file is read only, but we still change the contents, and use the </span><span class="font25" style="font-weight:bold;">:w! </span><span class="font25">directive to write to this file. Then we close </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">and take a look at the trace log.</span></p>
<p><span class="font19">root@deb503:~# grep chmod strace.txt</span></p>
<p><span class="font19">chmod(&quot;42.txt&quot;, 0100600) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= -1 ENOENT (No such file or directory)</span></p>
<p><span class="font19">chmod(&quot;42.txt&quot;, 0100400) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 0</span></p>
<p><span class="font19">root@deb503:~# ls -l 42.txt -r-------- 1 root root 12 2011-09-26 12:04 42.txt</span></p>
<p><span class="font25">Notice that </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">changed the permissions on the file twice. The trace log is too long to show a complete screenshot in this book.</span></p>
<p><span class="font19">root@deb503:~# wc -l strace.txt</span></p>
<p><span class="font19">941 strace.txt</span></p>
<p><a name="bookmark7590"></a><span class="font11" style="font-weight:bold;">Part VII. backup management</span></p>
<h3><a name="bookmark7591"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7592"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7593"><span class="font24" style="font-weight:bold;">30. backup </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7594"><span class="font24">30.1. About tape devices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7595"><span class="font24">30.2. Compression </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7596"><span class="font24">30.3. tar </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7597"><span class="font24">30.4. Backup Types </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7598"><span class="font24">30.5. dump and restore </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7599"><span class="font24">30.6. cpio </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7600"><span class="font24">30.7. dd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7601"><span class="font24">30.8. split </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7602"><span class="font24">30.9. practice: backup </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark7603"></a><span class="font11" style="font-weight:bold;"><a name="bookmark7604"></a><a name="bookmark7605"></a><a name="bookmark7606"></a>Chapter 30. backup</span></h1></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6218"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7607"></a>30.1. About tape devices</span></h2></li></ul>
<p><a name="bookmark7608"></a><span class="font25">Don't forget that the name of a device strictly speaking has no meaning since the kernel will use the major and minor number to find the hardware! See the man page of </span><span class="font25" style="font-weight:bold;">mknod </span><span class="font25">and the devices.txt file in the Linux kernel source for more info.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7609"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7610"></a>30.1.1. SCSI tapes</span></h3></li></ul>
<p><a name="bookmark7611"></a><span class="font25">On the official Linux device list (</span><a href="http://www.lanana.org/docs/device-list/"><span class="font25">http://www.lanana.org/docs/device-list/</span></a><span class="font25">) we find the names for SCSI tapes (major 9 char). SCSI tape devices are located underneath </span><span class="font25" style="font-weight:bold;">/dev/st </span><span class="font25">and are numbered starting with 0 for the first tape device.</span></p>
<p><span class="font19">/dev/st0 First tape device /dev/stl Second tape device /dev/st2 Third tape device</span></p>
<p><a name="bookmark7612"></a><span class="font25">To prevent </span><span class="font25" style="font-weight:bold;">automatic rewinding of tapes</span><span class="font25">, prefix them with the letter n.</span></p>
<p><span class="font19">/dev/nst0 First no rewind tape device /dev/nstl Second no rewind tape device /dev/nst2 Third no rewind tape device</span></p>
<p><span class="font25">By default, SCSI tapes on Linux will use the highest hardware compression that is supported by the tape device. To lower the compression level, append one of the letters l (low), m (medium) or a (auto) to the tape name.</span></p>
<p><span class="font19">/dev/st0l First low compression tape device</span></p>
<p><span class="font19">/dev/st0m First medium compression tape device</span></p>
<p><span class="font19">/dev/nst2m Third no rewind medium compression tape device</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7613"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7614"></a>30.1.2. IDE tapes</span></h3></li></ul>
<p><a name="bookmark7615"></a><span class="font25">On the official Linux device list (</span><a href="http://www.lanana.org/docs/device-list/"><span class="font25">http://www.lanana.org/docs/device-list/</span></a><span class="font25">) we find the names for IDE tapes (major 37 char). IDE tape devices are located underneath </span><span class="font25" style="font-weight:bold;">/dev/ht </span><span class="font25">and are numbered starting with 0 for the first tape device. No rewind and compression is similar to SCSI tapes.</span></p>
<p><span class="font19">/dev/ht0 First IDE tape device</span></p>
<p><span class="font19">/dev/nht0 Second no rewind IDE tape device</span></p>
<p><span class="font19">/dev/ht0m First medium compression IDE tape device</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7616"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7617"></a>30.1.3. mt</span></h3></li></ul>
<p><a name="bookmark7618"></a><span class="font25">To manage your tapes, use </span><span class="font25" style="font-weight:bold;">mt </span><span class="font25">(Magnetic Tape). Some examples.</span></p>
<h4><a name="bookmark7619"></a><span class="font25"><a name="bookmark7620"></a>To receive information about the status of the tape.</span></h4>
<p><span class="font19">mt -f /dev/st0 status</span></p>
<h4><a name="bookmark7621"></a><span class="font25"><a name="bookmark7622"></a>To rewind a tape...</span></h4>
<p><span class="font19">mt -f /dev/st0 rewind</span></p>
<h4><a name="bookmark7623"></a><span class="font25"><a name="bookmark7624"></a>To rewind and eject a tape...</span></h4>
<p><span class="font19">mt -f /dev/st0 eject</span></p>
<h4><a name="bookmark7625"></a><span class="font25"><a name="bookmark7626"></a>To erase a tape...</span></h4>
<p><span class="font19">mt -f /dev/st0 erase</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7627"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6219"></a><a name="bookmark7628"></a>30.2. Compression</span></h2></li></ul>
<h4><a name="bookmark7629"></a><span class="font25"><a name="bookmark7630"></a><a name="bookmark7631"></a>It can be beneficial to compress files before backu<a name="bookmark7632"></a>p. The two most popular tools for compression of regular files on Linux are </span><span class="font25" style="font-weight:bold;">gzip/gunzip </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">bzip2/bunzip2</span><span class="font25">. Below you can see gzip in action, notice that it adds the </span><span class="font25" style="font-weight:bold;">.gz </span><span class="font25">extension to the file.</span></h4>
<p><span class="font19">paul@RHELv4u4:~/test$ ls -l allfiles.tx*</span></p>
<p><span class="font19">-rw-rw-r-- 1 paul paul 8813553 Feb 27 05:38 allfiles.txt</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ gzip allfiles.txt</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ ls -l allfiles.tx*</span></p>
<p><span class="font19">-rw-rw-r-- 1 paul paul 931863 Feb 27 05:38 allfiles.txt.gz</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ gunzip allfiles.txt.gz</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ ls -l allfiles.tx*</span></p>
<p><span class="font19">-rw-rw-r-- 1 paul paul 8813553 Feb 27 05:38 allfiles.txt</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$</span></p>
<h4><a name="bookmark7633"></a><span class="font25"><a name="bookmark7634"></a>In general, gzip is much faster than bzip2, but the latter one compresses a lot better. Let us compare the two.</span></h4>
<p><span class="font19">paul@RHELv4u4:~/test$ cp allfiles.txt bllfiles.txt</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ time gzip allfiles.txt</span></p>
<p><span class="font19">real &nbsp;&nbsp;&nbsp;0m0.050s</span></p>
<p><span class="font19">user &nbsp;&nbsp;&nbsp;0m0.041s</span></p>
<p><span class="font19">sys &nbsp;&nbsp;&nbsp;&nbsp;0m0.009s</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ time bzip2 bllfiles.txt</span></p>
<p><span class="font19">real &nbsp;&nbsp;&nbsp;0m5.968s</span></p>
<p><span class="font19">user &nbsp;&nbsp;&nbsp;0m5.794s</span></p>
<p><span class="font19">sys &nbsp;&nbsp;&nbsp;&nbsp;0m0.076s</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ ls -l ?llfiles.tx*</span></p>
<p><span class="font19">-rw-rw-r-- 1 paul paul 931863 Feb 27 05:38 allfiles.txt.gz</span></p>
<p><span class="font19">-rw-rw-r-- 1 paul paul 708871 May 12 10:52 bllfiles.txt.bz2 paul@RHELv4u4:~/test$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7635"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6220"></a><a name="bookmark7636"></a>30.3. tar</span></h2></li></ul>
<h4><a name="bookmark7637"></a><span class="font25"><a name="bookmark7638"></a><a name="bookmark7639"></a>The </span><span class="font25" style="font-weight:bold;">tar </span><span class="font25">utility gets its name from </span><span class="font25" style="font-weight:bold;">Tape ARchive</span><span class="font25">. This tool will receive and send files to a destination (typically a tape or a regular file). The c option is used to create a tar archive</span></h4>
<p><span class="font25">(or tarfile), the f option to name/create the </span><span class="font25" style="font-weight:bold;">tarfile</span><span class="font25">. The example below takes a backup of / etc into the file /backup/etc.tar .</span></p>
<p><span class="font19">root@RHELv4u4:~# tar cf /backup/etc.tar /etc</span></p>
<p><span class="font19">root@RHELv4u4:~# ls -l /backup/etc.tar</span></p>
<p><span class="font19">-rw-r--r-- &nbsp;1 root root 47800320 May 12 11:47 /backup/etc.tar</span></p>
<p><span class="font19">root@RHELv4u4:~#</span></p>
<p><span class="font25">Compression can be achieved without pipes since tar uses the z flag to compress with gzip, and the j flag to compress with bzip2.</span></p>
<p><span class="font19">root@RHELv4u4:~# tar czf /backup/etc.tar.gz /etc</span></p>
<p><span class="font19">root@RHELv4u4:~# tar cjf /backup/etc.tar.bz2 /etc</span></p>
<p><span class="font19">root@RHELv4u4:~# ls -l /backup/etc.ta*</span></p>
<p><span class="font19">-rw-r--r-- &nbsp;1 root root 47800320 May 12 11:47 /backup/etc.tar</span></p>
<p><span class="font19">-rw-r--r-- &nbsp;1 root root &nbsp;6077340 May 12 11:48 /backup/etc.tar.bz2</span></p>
<p><span class="font19">-rw-r--r-- &nbsp;1 root root &nbsp;8496607 May 12 11:47 /backup/etc.tar.gz</span></p>
<p><span class="font19">root@RHELv4u4:~#</span></p>
<p><span class="font25">The t option is used to </span><span class="font25" style="font-weight:bold;">list the contents of a tar file</span><span class="font25">. Verbose mode is enabled with v (also useful when you want to see the files being archived during archiving).</span></p>
<p><span class="font19">root@RHELv4u4:~# tar tvf /backup/etc.tar</span></p>
<p><span class="font19">drwxr-xr-x root/root &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 2007-05-12 09:38:21 etc/</span></p>
<p><span class="font19">-rw-r--r-- root/root &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2657 2004-09-27 10:15:03 etc/warnquota.conf</span></p>
<p><span class="font19">-rw-r--r-- root/root &nbsp;&nbsp;&nbsp;&nbsp;13136 2006-11-03 17:34:50 etc/mime.types</span></p>
<p><span class="font19">drwxr-xr-x root/root &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 2004-11-03 13:35:50 etc/sound/</span></p>
<p><span class="font25">To </span><span class="font25" style="font-weight:bold;">list a specific file in a tar archive</span><span class="font25">, use the t option, added with the filename (without leading /).</span></p>
<p><span class="font19">root@RHELv4u4:~# tar tvf /backup/etc.tar etc/resolv.conf</span></p>
<p><span class="font19">-rw-r--r-- root/root &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;77 2007-05-12 08:31:32 etc/resolv.conf</span></p>
<p><span class="font19">root@RHELv4u4:~#</span></p>
<p><span class="font25">Use the x flag to </span><span class="font25" style="font-weight:bold;">restore a tar archive</span><span class="font25">, or a single file from the archive. Remember that by default tar will restore the file in the current directory.</span></p>
<p><span class="font19">root@RHELv4u4:~# tar xvf /backup/etc.tar etc/resolv.conf</span></p>
<p><span class="font19">etc/resolv.conf</span></p>
<p><span class="font19">root@RHELv4u4:~# ls -l /etc/resolv.conf</span></p>
<p><span class="font19">-rw-r--r-- &nbsp;2 root root 40 May 12 12:05 /etc/resolv.conf</span></p>
<p><span class="font19">root@RHELv4u4:~# ls -l etc/resolv.conf</span></p>
<p><span class="font19">-rw-r--r-- &nbsp;1 root root 77 May 12 08:31 etc/resolv.conf</span></p>
<p><span class="font19">root@RHELv4u4:~#</span></p>
<p><a name="bookmark7640"></a><span class="font25">You can </span><span class="font25" style="font-weight:bold;">preserve file permissions </span><span class="font25">with the p flag. And you can exclude directories or file with </span><span class="font25" style="font-weight:bold;">--exclude</span><span class="font25">.</span></p>
<p><span class="font19">root ~# tar cpzf /backup/etc_with_perms.tgz /etc</span></p>
<p><span class="font19">root ~# tar cpzf /backup/etc_no_sysconf.tgz /etc --exclude /etc/sysconfig root ~# ls -l /backup/etc_*</span></p>
<p><span class="font19">-rw-r--r-- 1 root root 8434293 May 12 12:48 /backup/etc_no_sysconf.tgz</span></p>
<p><span class="font19">-rw-r--r-- 1 root root 8496591 May 12 12:48 /backup/etc_with_perms.tgz root ~#</span></p>
<p><span class="font25">You can also create a text file with names of files and directories to archive, and then supply this file to tar with the -T flag.</span></p>
<p><span class="font19">root@RHELv4u4:~# find /etc -name *.conf &gt;&nbsp;files_to_archive.txt</span></p>
<p><span class="font19">root@RHELv4u4:~# find /home -name *.pdf &gt;&gt;&nbsp;files_to_archive.txt</span></p>
<p><span class="font19">root@RHELv4u4:~# tar cpzf /backup/backup.tgz -T files_to_archive.txt</span></p>
<p><span class="font25">The tar utility can receive filenames from the find command, with the help of xargs.</span></p>
<p><span class="font19">find /etc -type f -name &quot;*.conf&quot; | xargs tar czf /backup/confs.tar.gz</span></p>
<p><span class="font25">You can also use tar to copy a directory, this is more efficient than using cp -r.</span></p>
<p><span class="font19">(cd /etc; tar -cf - . ) | (cd /backup/copy_of_etc/; tar -xpf - )</span></p>
<p><span class="font25">Another example of tar, this copies a directory securely over the network.</span></p>
<p><span class="font19">(cd /etc,-tar -cf - . )|(ssh user@srv 'cd /backup/cp_of_etc/; tar -xf - ')</span></p>
<p><span class="font25">tar can be used together with gzip and copy a file to a remote server through ssh</span></p>
<p><span class="font19">cat backup.tar | gzip | ssh </span><a href="mailto:bashuser@192.168.1.105"><span class="font19">bashuser@192.168.1.105</span></a><span class="font19"> &quot;cat - &gt;&nbsp;backup.tgz&quot;</span></p>
<p><span class="font25">Compress the tar backup when it is on the network, but leave it uncompressed at the destination.</span></p>
<p><span class="font19">cat backup.tar | gzip | ssh </span><a href="mailto:user@192.168.1.105"><span class="font19">user@192.168.1.105</span></a><span class="font19"> &quot;gunzip|cat - &gt;&nbsp;backup.tar&quot;</span></p>
<p><span class="font25">Same as the previous, but let ssh handle the compression</span></p>
<p><span class="font19">cat backup.tar | ssh -C </span><a href="mailto:bashuser@192.168.1.105"><span class="font19">bashuser@192.168.1.105</span></a><span class="font19"> &quot;cat - &gt;&nbsp;backup.tar&quot;</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7641"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6221"></a><a name="bookmark7642"></a>30.4. Backup Types</span></h2></li></ul>
<p><span class="font25">Linux uses </span><span class="font25" style="font-weight:bold;">multilevel incremental </span><span class="font25">backups using distinct levels. A full backup is a backup at level 0. A higher level x backup will include all changes since the last level x-1 backup.</span></p>
<p><span class="font25">Suppose you take a full backup on Monday (level 0) and a level 1 backup on Tuesday, then the Tuesday backup will contain all changes since Monday. Taking a level 2 on Wednesday will contain all changes since Tuesday (the last level 2-1). A level 3 backup on Thursday will contain all changes since Wednesday (the last level 3-1). Another level 3 on Friday will also contain all changes since Wednesday. A level 2 backup on Saturday would take all changes since the last level 1 from Tuesday.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7643"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6222"></a><a name="bookmark7644"></a>30.5. dump and restore</span></h2></li></ul>
<p><a name="bookmark7645"></a><span class="font25">While </span><span class="font25" style="font-weight:bold;">dump </span><span class="font25">is similar to tar, it is also very different because it looks at the file system. Where tar receives a lists of files to backup, dump will find files to backup by itself by examining ext2. Files found by dump will be copied to a tape or regular file. In case the target is not big enough to hold the dump (end-of-media), it is broken into multiple volumes.</span></p>
<p><a name="bookmark7646"></a><span class="font25">Restoring files that were backed up with dump is done with the </span><span class="font25" style="font-weight:bold;">restore </span><span class="font25">command. In the example below we take a full level 0 backup of two partitions to a SCSI tape. The no rewind is mandatory to put the volumes behind each other on the tape.</span></p>
<p><span class="font19">dump Of /dev/nst0 /boot</span></p>
<p><span class="font19">dump Of /dev/nstO /</span></p>
<p><span class="font25">Listing files in a dump archive is done with </span><span class="font25" style="font-weight:bold;">dump -t</span><span class="font25">, and you can compare files with </span><span class="font25" style="font-weight:bold;">dump -C</span><span class="font25">.</span></p>
<p><a name="bookmark7647"></a><span class="font25">You can omit files from a dump by changing the dump attribute with the </span><span class="font25" style="font-weight:bold;">chattr </span><span class="font25">command. The d attribute on ext will tell dump to skip the file, even during a full backup. In the following example, /etc/hosts is excluded from dump archives.</span></p>
<p><span class="font19">chattr +d /etc/hosts</span></p>
<p><span class="font25">To restore the complete file system with </span><span class="font25" style="font-weight:bold;">restore</span><span class="font25">, use the -r option. This can be useful to change the size or block size of a file system. You should have a clean file system mounted and cd'd into it. Like this example shows.</span></p>
<p><span class="font19">mke2fs /dev/hda3</span></p>
<p><span class="font19">mount /dev/hda3 /mnt/data cd /mnt/data</span></p>
<p><span class="font19">restore rf /dev/nstO</span></p>
<p><span class="font25">To extract only one file or directory from a dump, use the -x option.</span></p>
<p><span class="font19">restore -xf /dev/stO /etc</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7648"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6223"></a><a name="bookmark7649"></a>30.6. cpio</span></h2></li></ul>
<p><a name="bookmark7650"></a><span class="font25">Different from tar and dump is </span><span class="font25" style="font-weight:bold;">cpio </span><span class="font25">(Copy Input and Output). It can be used to receive filenames, but copies the actual files. This makes it an easy companion with find! Some examples below.</span></p>
<p><span class="font25">find sends filenames to cpio, which puts the files in an archive.</span></p>
<p><span class="font19">find /etc -depth -print | cpio -oaV -O archive.cpio</span></p>
<p><span class="font25">The same, but compressed with gzip</span></p>
<p><span class="font19">find /etc -depth -print | cpio -oaV | gzip -c &gt;&nbsp;archive.cpio.gz</span></p>
<p><span class="font25">Now pipe it through ssh (backup files to a compressed file on another machine)</span></p>
<p><span class="font19">find /etc -depth -print|cpio -oaV|gzip -c|ssh server &quot;cat - &gt;&nbsp;etc.cpio.gz&quot;</span></p>
<p><span class="font25">find sends filenames to cpio | cpio sends files to ssh | ssh sends files to cpio 'cpio extracts files'</span></p>
<p><span class="font19">find /etc -depth -print | cpio -oaV | ssh user@host 'cpio -imVd'</span></p>
<p><span class="font25">the same but reversed: copy a dir from the remote host to the local machine</span></p>
<p><span class="font19">ssh user@host &quot;find path -depth -print | cpio -oaV&quot; | cpio -imVd</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7651"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6224"></a><a name="bookmark7652"></a>30.7. dd</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark7653"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7654"></a>30.7.1. About dd</span></h3></li></ul></li></ul>
<p><a name="bookmark7655"></a><span class="font25">Some people use </span><span class="font25" style="font-weight:bold;">dd </span><span class="font25">to create backups. This can be very powerful, but dd backups can only be restored to very similar partitions or devices. There are however a lot of useful things possible with dd. Some examples.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7656"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7657"></a>30.7.2. Create a CDROM image</span></h3></li></ul>
<p><a name="bookmark7658"></a><span class="font25">The easiest way to create a </span><span class="font25" style="font-weight:bold;">.ISO file </span><span class="font25">from any CD. The if switch means Input File, of is the Output File. Any good tool can burn a copy of the CD with this .ISO file.</span></p>
<p><span class="font19">dd if=/dev/cdrom of=/path/to/cdrom.ISO</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7659"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7660"></a>30.7.3. Create a floppy image</span></h3></li></ul>
<p><span class="font25">A little outdated maybe, but just in case : make an image file from a 1.44MB floppy. Blocksize is defined by bs, and count contains the number of blocks to copy.</span></p>
<p><span class="font19">dd if=/dev/floppy of=/path/to/floppy.img bs=1024 count=1440</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7661"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7662"></a>30.7.4. Copy the master boot record</span></h3></li></ul>
<p><a name="bookmark7663"></a><span class="font25">Use dd to copy the </span><span class="font25" style="font-weight:bold;">MBR </span><span class="font25">(Master Boot Record) of hard disk /dev/hda to a file.</span></p>
<p><span class="font19">dd if=/dev/hda of=/MBR.img bs=512 count=1</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7664"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7665"></a>30.7.5. Copy files</span></h3></li></ul>
<p><span class="font25">This example shows how dd can copy files. Copy the file summer.txt to copy_of_summer.txt .</span></p>
<p><span class="font19">dd if=~/summer.txt of=~/copy_of_summer.txt</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7666"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7667"></a>30.7.6. Image disks or partitions</span></h3></li></ul>
<p><span class="font25">And who needs ghost when dd can create a (compressed) image of a partition.</span></p>
<p><span class="font19">dd if=/dev/hdb2 of=/image_of_hdb2.IMG</span></p>
<p><span class="font19">dd if=/dev/hdb2 | gzip &gt;&nbsp;/image_of_hdb2.IMG.gz</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7668"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7669"></a>30.7.7. Create files of a certain size</span></h3></li></ul>
<p><span class="font25">dd can be used to create a file of any size. The first example creates a one MEBIbyte file, the second a one MEGAbyte file.</span></p>
<p><span class="font19">dd if=/dev/zero of=file1MB count=1024 bs=1024</span></p>
<p><span class="font19">dd if=/dev/zero of=file1MB count=1000 bs=1024</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark7670"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7671"></a>30.7.8. CDROM server example</span></h3></li></ul>
<p><span class="font25">And there are of course endless combinations with ssh and bzip2. This example puts a bzip2 backup of a cdrom on a remote server.</span></p>
<p><span class="font19">dd if=/dev/cdrom |bzip2|ssh user@host &quot;cat - &gt;&nbsp;/backups/cd/cdrom.iso.bz2&quot;</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7672"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6225"></a><a name="bookmark7673"></a>30.8. split</span></h2></li></ul>
<p><a name="bookmark7674"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">split </span><span class="font25">command is useful to split files into smaller files. This can be useful to fit the file onto multiple instances of a medium too small to contain the complete file. In the example below, a file of size 5000 bytes is split into three smaller files, with maximum 2000 bytes each.</span></p>
<p><span class="font19">paul@laika:~/test$ ls -l total 8</span></p>
<p><span class="font19">-rw-r--r-- 1 paul paul 5000 2007-09-09 20:46 bigfile1 paul@laika:~/test$ split -b 2000 bigfile1 splitfile. paul@laika:~/test$ ls -l total 20</span></p>
<p><span class="font19">-rw-r--r-- 1 paul paul 5000 2007-09-09 20:46 bigfile1</span></p>
<p><span class="font19">-rw-r--r-- 1 paul paul 2000 2007-09-09 20:47 splitfile.aa</span></p>
<p><span class="font19">-rw-r--r-- 1 paul paul 2000 2007-09-09 20:47 splitfile.ab</span></p>
<p><span class="font19">-rw-r--r-- 1 paul paul 1000 2007-09-09 20:47 splitfile.ac</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7675"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6226"></a><a name="bookmark7676"></a>30.9. practice: backup</span></h2></li></ul>
<p><span class="font25">!! Careful with tar options and the position of the backup file, mistakes can destroy your system!!</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create a directory (or partition if you like) for backups. Link (or mount) it under /mnt/ backup.</span></p></li></ul>
<p><span class="font25">2a. Use tar to backup /etc in /mnt/backup/etc_date.tgz, the backup must be gzipped. (Replace date with the current date)</span></p>
<p><span class="font25">2b. Use tar to backup /bin to /mnt/backup/bin_date.tar.bz2, the backup must be bzip2'd.</span></p>
<p><span class="font25">2c. Choose a file in /etc and /bin and verify with tar that the file is indeed backed up.</span></p>
<p><span class="font25">2d. Extract those two files to your home directory.</span></p>
<p><span class="font25">3a. Create a backup directory for your neighbour, make it accessible under /mnt/ neighbourName</span></p>
<p><span class="font25">3b. Combine ssh and tar to put a backup of your /boot on your neighbours computer in / mnt/YourName</span></p>
<p><span class="font25">4a. Combine find and cpio to create a cpio archive of /etc.</span></p>
<p><span class="font25">4b. Choose a file in /etc and restore it from the cpio archive into your home directory.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Use dd and ssh to put a backup of the master boot record on your neighbours computer.</span></p></li>
<li>
<p><span class="font25">6. (On the real computer) Create and mount an ISO image of the ubuntu cdrom.</span></p></li>
<li>
<p><span class="font25">7. Combine dd and gzip to create a 'ghost' image of one of your partitions on another partition.</span></p></li>
<li>
<p><span class="font25">8. Use dd to create a five megabyte file in ~/testsplit and name it biggest. Then split this file in smaller two megabyte parts.</span></p></li></ul>
<p><span class="font19">mkdir testsplit</span></p>
<p><span class="font19">dd if=/dev/zero of=~/testsplit/biggest count=5000 bs=1024</span></p>
<p><span class="font19">split -b 2000000 biggest parts</span></p>
<p><a name="bookmark7677"></a><span class="font11" style="font-weight:bold;">Part VIII. Appendices</span></p>
<h3><a name="bookmark7678"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7679"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7680"><span class="font24" style="font-weight:bold;">A. disk quotas </span></a></p></li></ul>
<p><a href="#bookmark7681"><span class="font24">A.1. About Disk Quotas </span></a></p>
<p><a href="#bookmark7682"><span class="font24">A.2. Practice Disk quotas </span></a></p>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7683"><span class="font24" style="font-weight:bold;">B. introduction to vnc </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7684"><span class="font24">B.1. About VNC </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7685"><span class="font24">B.2. VNC Server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7686"><span class="font24">B.3. VNC Client </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7687"><span class="font24">B.4. Practice VNC </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7688"><span class="font24" style="font-weight:bold;">C. License </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark7689"></a><span class="font11" style="font-weight:bold;"><a name="bookmark7690"></a><a name="bookmark7691"></a><a name="bookmark7692"></a>Appendix A. disk quotas</span></h1></li></ul>
<h2><a name="bookmark6229"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7693"></a>A.1. About Disk Quotas</span></h2>
<p><a name="bookmark7694"></a><span class="font25"><a name="bookmark7695"></a><a name="bookmark7696"></a><a name="bookmark7697"></a>To limit the disk space used by user, you can set up </span><span class="font25" style="font-weight:bold;">disk quotas</span><span class="font25">. This requires adding </span><span class="font25" style="font-weight:bold;">usrquota </span><span class="font25">and/or </span><span class="font25" style="font-weight:bold;">grpquota </span><span class="font25">to one or more of the file systems in </span><span class="font25" style="font-weight:bold;">/etc/fstab</span><span class="font25">.</span></p>
<p><span class="font19">root@RHELv4u4:~# cat /etc/fstab | grep usrquota /dev/VolGroup00/LogVol02 /home ext3 usrquota,grpquota 0 0</span></p>
<p><span class="font25">Next you need to remount the file system.</span></p>
<p><span class="font19">root@RHELv4u4:~# mount -o remount /home</span></p>
<p><a name="bookmark7698"></a><span class="font25"><a name="bookmark7699"></a><a name="bookmark7700"></a>The next step is to build the </span><span class="font25" style="font-weight:bold;">quota.user </span><span class="font25">and/or </span><span class="font25" style="font-weight:bold;">quota.group </span><span class="font25">files. These files (called the </span><span class="font25" style="font-weight:bold;">quota files</span><span class="font25">) contain the table of the disk usage on that file system. Use the </span><span class="font25" style="font-weight:bold;">quotacheck </span><span class="font25">command to accomplish this.</span></p>
<p><span class="font19">root@RHELv4u4:~# quotacheck -cug /home root@RHELv4u4:~# quotacheck -avug</span></p>
<p><a name="bookmark7701"></a><span class="font25"><a name="bookmark7702"></a><a name="bookmark7703"></a>The </span><span class="font25" style="font-weight:bold;">-c </span><span class="font25">is for create, </span><span class="font25" style="font-weight:bold;">u </span><span class="font25">for user quota, </span><span class="font25" style="font-weight:bold;">g </span><span class="font25">for group, </span><span class="font25" style="font-weight:bold;">a </span><span class="font25">for checking all quota enabled file systems in /etc/fstab and </span><span class="font25" style="font-weight:bold;">v </span><span class="font25">for verbose information. The next step is to edit individual user quotas with </span><span class="font25" style="font-weight:bold;">edquota </span><span class="font25">or set a general quota on the file system with </span><span class="font25" style="font-weight:bold;">edquota -t</span><span class="font25">. The tool will enable you to put </span><span class="font25" style="font-weight:bold;">hard </span><span class="font25">(this is the real limit) and </span><span class="font25" style="font-weight:bold;">soft </span><span class="font25">(allows a grace period) limits on </span><span class="font25" style="font-weight:bold;">blocks </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">inodes</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">quota </span><span class="font25">command will verify that quota for a user is set. You can have a nice overview with </span><span class="font25" style="font-weight:bold;">repquota</span><span class="font25">.</span></p>
<p><span class="font25">The final step (before <a name="bookmark7704"></a>your users start complaining about lack of disk space) is to enable quotas with </span><span class="font25" style="font-weight:bold;">quotaon(1)</span><span class="font25">.</span></p>
<p><span class="font19">root@RHELv4u4:~# quotaon -vaug</span></p>
<p><a name="bookmark7705"></a><span class="font25">Issue the </span><span class="font25" style="font-weight:bold;">quotaoff </span><span class="font25">command to stop all complaints.</span></p>
<p><span class="font19">root@RHELv4u4:~# quotaoff -vaug</span></p>
<h2><a name="bookmark7706"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6230"></a><a name="bookmark7707"></a>A.2. Practice Disk quotas</span></h2>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Implement disk quotas on one of your new partitions. Limit one of your users to 10 megabyte.</span></p></li>
<li>
<p><span class="font25">2. Test that they work by copying many files to the quota'd partition.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark7708"></a><span class="font11" style="font-weight:bold;"><a name="bookmark7709"></a><a name="bookmark6231"></a><a name="bookmark7710"></a>Appendix B. introduction to vnc</span></h1></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark6232"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7711"></a>B.1. About VNC</span></h2></li></ul>
<p><a name="bookmark7712"></a><span class="font25"><a name="bookmark7713"></a>VNC can be configured in gnome or KDE using the </span><span class="font25" style="font-weight:bold;">Remote Desktop Preferences</span><span class="font25">. </span><span class="font25" style="font-weight:bold;">VNC </span><span class="font25">can be used to run your desktop on another computer, and you can also use it to see and take over the Desktop of another user. The last part can be useful for help desks to show users how to do things. VNC has the added advantage of being operating system independent, a lot of products (realvnc, tightvnc, xvnc, ...) use the same protocol on Solaris, Linux, BSD and more.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7714"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6233"></a><a name="bookmark7715"></a>B.2. VNC Server</span></h2></li></ul>
<p><span class="font25">Starting the vnc server for the first time.</span></p>
<p><span class="font19">[root@RHELv4u3 conf]# rpm -qa | grep -i vnc vnc-server-4.0-8.1</span></p>
<p><span class="font19">vnc-4.0-8.1</span></p>
<p><span class="font19">[root@RHELv4u3 conf]# vncserver :2</span></p>
<p><span class="font19">You will require a password to access your desktops.</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">Verify:</span></p>
<p><span class="font19">xauth: creating new authority file /root/.Xauthority</span></p>
<p><span class="font19">New 'RHELv4u3.localdomain:2 (root)' desktop is RHELv4u3.localdomain:2</span></p>
<p><span class="font19">Creating default startup script /root/.vnc/xstartup</span></p>
<p><span class="font19">Starting applications specified in /root/.vnc/xstartup</span></p>
<p><span class="font19">Log file is /root/.vnc/RHELv4u3.localdomain:2.log</span></p>
<p><span class="font19">[root@RHELv4u3 conf]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7716"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6234"></a><a name="bookmark7717"></a>B.3. VNC Client</span></h2></li></ul>
<p><a name="bookmark7718"></a><span class="font25">You can now use the </span><span class="font25" style="font-weight:bold;">vncviewer </span><span class="font25">from another machine to connect to your vnc server. It will default to a very simple graphical interface...</span></p>
<p><span class="font19">paul@laika:~$ vncviewer 192.168.1.49:2</span></p>
<p><span class="font19">VNC viewer version 3.3.7 - built Nov 20 2006 13:05:04 Copyright (C) 2002-2003 RealVNC Ltd.</span></p>
<p><span class="font19">Copyright (C) 1994-2000 AT&amp;T Laboratories Cambridge.</span></p>
<p><span class="font19">See </span><a href="http://www.realvnc.com"><span class="font19">http://www.realvnc.com</span></a><span class="font19"> for information on VNC.</span></p>
<p><span class="font19">VNC server supports protocol version 3.8 (viewer 3.3) Password:</span></p>
<p><span class="font19">VNC authentication succeeded</span></p>
<p><span class="font19">Desktop name &quot;RHELv4u3.localdomain:2 (root)&quot;</span></p>
<p><span class="font19">Connected to VNC server, using protocol version 3.3</span></p>
<p><a name="bookmark7719"></a><span class="font25">If you don't like the simple twm window mana<a name="bookmark7720"></a>ger, you can comment out the last two lines of </span><span class="font25" style="font-weight:bold;">~/.vnc/xstartup </span><span class="font25">and add a </span><span class="font25" style="font-weight:bold;">gnome-session &amp;&nbsp;</span><span class="font25">line to have vnc default to gnome instead.</span></p>
<p><span class="font24">introduction to vnc</span></p>
<p><span class="font19">[root@RHELv4u3 ~]# cat .vnc/xstartup</span></p>
<p><span class="font19">#!/bin/sh</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Uncomment the following two lines for normal desktop:</span></p></li>
<li>
<p><span class="font19"># unset SESSION_MANAGER</span></p></li>
<li>
<p><span class="font19"># exec /etc/X11/xinit/xinitrc</span></p></li></ul>
<p><span class="font19">[ -x /etc/vnc/xstartup ] &amp;&amp;&nbsp;exec /etc/vnc/xstartup</span></p>
<p><span class="font19">[ -r $HOME/.Xresources ] &amp;&amp;&nbsp;xrdb $HOME/.Xresources xsetroot -solid grey vncconfig -iconic &amp;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># xterm -geometry 80x24+10+10 -ls -title &quot;$VNCDESKTOP Desktop&quot; &amp;&nbsp;# twm &amp;</span></p></li></ul>
<p><span class="font19">gnome-session &amp;&nbsp;[root@RHELv4u3 ~]#</span></p>
<h4><a name="bookmark7721"></a><span class="font25"><a name="bookmark7722"></a>Don't forget to restart your vnc server after changing this file.</span></h4>
<p><span class="font19">[root@RHELv4u3 ~]# vncserver -kill :2</span></p>
<p><span class="font19">Killing Xvnc process ID 5785</span></p>
<p><span class="font19">[root@RHELv4u3 ~]# vncserver :2</span></p>
<p><span class="font19">New 'RHELv4u3.localdomain:2 (root)' desktop is RHELv4u3.localdomain:2</span></p>
<p><span class="font19">Starting applications specified in /root/.vnc/xstartup</span></p>
<p><span class="font19">Log file is /root/.vnc/RHELv4u3.localdomain:2.log</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7723"></a><span class="font10" style="font-weight:bold;"><a name="bookmark6235"></a><a name="bookmark7724"></a>B.4. Practice VNC</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark7725"></a><span class="font25"><a name="bookmark7726"></a>1. Use VNC to connect from one machine to another.</span></h4></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark7727"></a><span class="font11" style="font-weight:bold;"><a name="bookmark7728"></a><a name="bookmark7729"></a>Appendix C. License</span></h1></li></ul>
<p><span class="font19">GNU Free Documentation License</span></p>
<p><span class="font19">Version 1.3, 3 November 2008</span></p>
<p><span class="font19">Copyright © 2000, 2001, 2002, 2007, 2008 Free Software Foundation, Inc.</span></p>
<p><span class="font19">Everyone is permitted to copy and distribute verbatim copies of this license document, but changing it is not allowed.</span></p>
<p><span class="font19">0. PREAMBLE</span></p>
<p><span class="font19">The purpose of this License is to make a manual, textbook, or other functional and useful document &quot;free&quot; in the sense of freedom: to assure everyone the effective freedom to copy and redistribute it, with or without modifying it, either commercially or noncommercially. Secondarily, this License preserves for the author and publisher a way to get credit for their work, while not being considered responsible for modifications made by others.</span></p>
<p><span class="font19">This License is a kind of &quot;copyleft&quot;, which means that derivative works of the document must themselves be free in the same sense. It complements the GNU General Public License, which is a copyleft license designed for free software.</span></p>
<p><span class="font19">We have designed this License in order to use it for manuals for free software, because free software needs free documentation: a free program should come with manuals providing the same freedoms that the software does. But this License is not limited to software manuals; it can be used for any textual work, regardless of subject matter or whether it is published as a printed book. We recommend this License principally for works whose purpose is instruction or reference.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">1. APPLICABILITY AND DEFINITIONS</span></p></li></ul>
<p><span class="font19">This License applies to any manual or other work, in any medium, that contains a notice placed by the copyright holder saying it can be distributed under the terms of this License. Such a notice grants a world-wide, royalty-free license, unlimited in duration, to use that work under the conditions stated herein. The &quot;Document&quot;, below, refers to any such manual or work. Any member of the public is a licensee, and is addressed as &quot;you&quot;. You accept the license if you copy, modify or distribute the work in a way requiring permission under copyright law.</span></p>
<p><span class="font19">A &quot;Modified Version&quot; of the Document means any work containing the Document or a portion of it, either copied verbatim, or with modifications and/or translated into another language.</span></p>
<p><span class="font19">A &quot;Secondary Section&quot; is a named appendix or a front-matter section of the Document that deals exclusively with the relationship of the publishers or authors of the Document to the Document's overall subject (or to related matters) and contains nothing that could fall directly within that overall subject. (Thus, if the Document is in part a textbook of mathematics, a Secondary Section may not explain any mathematics.) The relationship could be a matter of historical connection with the subject or with related matters, or of legal, commercial, philosophical, ethical or political position regarding them.</span></p>
<p><span class="font19">The &quot;Invariant Sections&quot; are certain Secondary Sections whose titles are designated, as being those of Invariant Sections, in the notice that says that the Document is released under this License. If a section does not fit the above definition of Secondary then it is not allowed to be designated as Invariant. The Document may contain zero Invariant Sections. If the Document does not identify any Invariant Sections then there are none.</span></p>
<p><span class="font19">The &quot;Cover Texts&quot; are certain short passages of text that are listed, as Front-Cover Texts or Back-Cover Texts, in the notice that says that the Document is released under this License. A Front-Cover Text may be at most 5 words, and a Back-Cover Text may be at most 25 words.</span></p>
<p><span class="font19">A &quot;Transparent&quot; copy of the Document means a machine-readable copy, represented in a format whose specification is available to the general public, that is suitable for revising the document straightforwardly with generic text editors or (for images composed of pixels) generic paint programs or (for drawings) some widely available drawing editor, and that is suitable for input to text formatters or for automatic translation to a variety of formats suitable for input to text formatters. A copy made in an otherwise Transparent file format whose markup, or absence of markup, has been arranged to thwart or discourage subsequent modification by readers is not Transparent. An image format is not Transparent if used for any substantial amount of text. A copy that is not &quot;Transparent&quot; is called &quot;Opaque&quot;.</span></p>
<p><span class="font19">Examples of suitable formats for Transparent copies include plain ASCII without markup, Texinfo input format, LaTeX input format, SGML or XML using a publicly available DTD, and standard-conforming simple HTML, PostScript or PDF designed for human modification. Examples of transparent image formats include PNG, XCF and JPG. Opaque formats include proprietary formats that can be read and edited only by proprietary word processors, SGML or XML for which the DTD and/or processing tools are not generally available, and the machine-generated HTML, PostScript or PDF produced by some word processors for output purposes only.</span></p>
<p><span class="font19">The &quot;Title Page&quot; means, for a printed book, the title page itself, plus such following pages as are needed to hold, legibly, the material this License requires to appear in the title page. For works in formats which do not have any title page as such, &quot;Title Page&quot; means the text near the most prominent appearance of the work's title, preceding the beginning of the body of the text.</span></p>
<p><span class="font19">The &quot;publisher&quot; means any person or entity that distributes copies of the Document to the public.</span></p>
<p><span class="font19">A section &quot;Entitled XYZ&quot; means a named subunit of the Document whose title either is precisely XYZ or contains XYZ in parentheses following text that translates XYZ in another language. (Here XYZ stands for a specific section name mentioned below, such as &quot;Acknowledgements&quot;, &quot;Dedications&quot;, &quot;Endorsements&quot;, or &quot;History&quot;.) To &quot;Preserve the Title&quot; of such a section when you modify the Document means that it remains a section &quot;Entitled XYZ&quot; according to this definition.</span></p>
<p><span class="font19">The Document may include Warranty Disclaimers next to the notice which states that this License applies to the Document. These Warranty Disclaimers are considered to be included by reference in this License, but only as regards disclaiming warranties: any other implication that these Warranty Disclaimers may have is void and has no effect on the meaning of this License.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">2. VERBATIM COPYING</span></p></li></ul>
<p><span class="font19">You may copy and distribute the Document in any medium, either commercially or noncommercially, provided that this License, the copyright notices, and the license notice saying this License applies to the Document are reproduced in all copies, and that you add no other conditions whatsoever to those of this License. You may not use technical measures to obstruct or control the reading or further copying of the copies you make or distribute. However, you may accept compensation in exchange for copies. If you distribute a large enough number of copies you must also follow the conditions in section 3.</span></p>
<p><span class="font19">You may also lend copies, under the same conditions stated above, and you may publicly display copies.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">3. COPYING IN QUANTITY</span></p></li></ul>
<p><span class="font19">If you publish printed copies (or copies in media that commonly have printed covers) of the Document, numbering more than 100, and the Document's license notice requires Cover Texts, you must enclose the copies in covers that carry, clearly and legibly, all these Cover Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on the back cover. Both covers must also clearly and legibly identify you as the publisher of these copies. The front cover must present the full title with all words of the title equally prominent and visible. You may add other material on the covers in addition. Copying with changes limited to the covers, as long as they preserve the title of the Document and satisfy these conditions, can be treated as verbatim copying in other respects.</span></p>
<p><span class="font19">If the required texts for either cover are too voluminous to fit legibly, you should put the first ones listed (as many as fit reasonably) on the actual cover, and continue the rest onto adjacent pages.</span></p>
<p><span class="font19">If you publish or distribute Opaque copies of the Document numbering more than 100, you must either include a machine-readable Transparent copy along with each Opaque copy, or state in or with each Opaque copy a computer-network location from which the general network-using public has access to download using public-standard network protocols a complete Transparent copy of the Document, free of added material. If you use the latter option, you must take reasonably prudent steps, when you begin distribution of Opaque copies in quantity, to ensure that this Transparent copy will remain thus accessible at the stated location until at least one year after the last time you distribute an Opaque copy (directly or through your agents or retailers) of that edition to the public.</span></p>
<p><span class="font19">It is requested, but not required, that you contact the authors of the Document well before redistributing any large number of copies, to give them a chance to provide you with an updated version of the Document.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">4. MODIFICATIONS</span></p></li></ul>
<p><span class="font19">You may copy and distribute a Modified Version of the Document under the conditions of sections 2 and 3 above, provided that you release the Modified Version under precisely this License, with the Modified Version filling the role of the Document, thus licensing distribution and modification of the Modified Version to whoever possesses a copy of it. In addition, you must do these things in the Modified Version:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">* A. Use in the Title Page (and on the covers, if any) a title distinct from that of the Document, and from those of previous versions (which should, if there were any, be listed in the History section of the Document). You may use the same title as a previous version if the original publisher of that version gives permission.</span></p></li>
<li>
<p><span class="font19">* B. List on the Title Page, as authors, one or more persons or entities responsible for authorship of the modifications in the Modified Version, together with at least five of the principal authors of the Document (all of its principal authors, if it has fewer than five), unless they release you from this requirement.</span></p></li>
<li>
<p><span class="font19">* C. State on the Title page the name of the publisher of the Modified Version, as the publisher.</span></p></li>
<li>
<p><span class="font19">* D. Preserve all the copyright notices of the Document.</span></p></li>
<li>
<p><span class="font19">* E. Add an appropriate copyright notice for your modifications adjacent to the other copyright notices.</span></p></li>
<li>
<p><span class="font19">* F. Include, immediately after the copyright notices, a license notice giving the public permission to use the Modified Version under the terms of this License, in the form shown in the Addendum below.</span></p></li>
<li>
<p><span class="font19">* G. Preserve in that license notice the full lists of Invariant Sections and required Cover Texts given in the Document's license notice.</span></p></li>
<li>
<p><span class="font19">* H. Include an unaltered copy of this License.</span></p></li>
<li>
<p><span class="font19">* I. Preserve the section Entitled &quot;History&quot;, Preserve its Title, and add to it an item stating at least the title, year, new authors, and publisher of the Modified Version as given on the Title Page. If there is no section Entitled &quot;History&quot; in the Document, create one stating the title, year, authors, and publisher of the Document as given on its Title Page, then add an item describing the Modified Version as stated in the previous sentence.</span></p></li>
<li>
<p><span class="font19">* J. Preserve the network location, if any, given in the Document for public access to a Transparent copy of the Document, and likewise the network locations given in the Document for previous versions it was based on. These may be placed in the &quot;History&quot; section. You may omit a network location for a work that was published at least four years before the Document itself, or if the original publisher of the version it refers to gives permission.</span></p></li>
<li>
<p><span class="font19">* K. For any section Entitled &quot;Acknowledgements&quot; or &quot;Dedications&quot;, Preserve the Title of the section, and preserve in the section all the substance and tone of each of the contributor acknowledgements and/or dedications given therein.</span></p></li>
<li>
<p><span class="font19">* L. Preserve all the Invariant Sections of the Document, unaltered in their text and in their titles. Section numbers or the equivalent are not considered part of the section titles.</span></p></li>
<li>
<p><span class="font19">* M. Delete any section Entitled &quot;Endorsements&quot;. Such a section may not be included in the Modified Version.</span></p></li>
<li>
<p><span class="font19">* N. Do not retitle any existing section to be Entitled &quot;Endorsements&quot; or to conflict in title with any Invariant Section.</span></p></li>
<li>
<p><span class="font19">* O. Preserve any Warranty Disclaimers.</span></p></li></ul>
<p><span class="font19">If the Modified Version includes new front-matter sections or appendices that qualify as Secondary Sections and contain no material copied from the Document, you may at your option designate some or all of these sections as invariant. To do this, add their titles to the list of Invariant Sections in the Modified Version's license notice. These titles must be distinct from any other section titles.</span></p>
<p><span class="font19">You may add a section Entitled &quot;Endorsements&quot;, provided it contains nothing but endorsements of your Modified Version by various parties—for example, statements of peer review or that the text has been approved by an organization as the authoritative definition of a standard.</span></p>
<p><span class="font19">You may add a passage of up to five words as a Front-Cover Text, and a passage of up to 25 words as a Back-Cover Text, to the end of the list of Cover Texts in the Modified Version. Only one passage of Front-Cover Text and one of Back-Cover Text may be added by (or through arrangements made by) any one entity. If the Document already includes a cover text for the same cover, previously added by you or by arrangement made by the same entity you are acting on behalf of, you may not add another; but you may replace the old one, on explicit permission from the previous publisher that added the old one.</span></p>
<p><span class="font19">The author(s) and publisher(s) of the Document do not by this License give permission to use their names for publicity for or to assert or imply endorsement of any Modified Version.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">5. COMBINING DOCUMENTS</span></p></li></ul>
<p><span class="font19">You may combine the Document with other documents released under this License, under the terms defined in section 4 above for modified versions, provided that you include in the combination all of the Invariant Sections of all of the original documents, unmodified, and list them all as Invariant Sections of your combined work in its license notice, and that you preserve all their Warranty Disclaimers.</span></p>
<p><span class="font19">The combined work need only contain one copy of this License, and multiple identical Invariant Sections may be replaced with a single copy. If there are multiple Invariant Sections with the same name but different contents, make the title of each such section unique by adding at the end of it, in parentheses, the name of the original author or publisher of that section if known, or else a unique number. Make the same adjustment to the section titles in the list of Invariant Sections in the license notice of the combined work.</span></p>
<p><span class="font19">In the combination, you must combine any sections Entitled &quot;History&quot; in the various original documents, forming one section Entitled &quot;History&quot;; likewise combine any sections Entitled &quot;Acknowledgements&quot;, and any sections Entitled &quot;Dedications&quot;. You must delete all sections Entitled &quot;Endorsements&quot;.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">6. COLLECTIONS OF DOCUMENTS</span></p></li></ul>
<p><span class="font19">You may make a collection consisting of the Document and other documents released under this License, and replace the individual copies of this License in the various documents with a single copy that is included in the collection, provided that you follow the rules of this License for verbatim copying of each of the documents in all other respects.</span></p>
<p><span class="font19">You may extract a single document from such a collection, and distribute it individually under this License, provided you insert a copy of this License into the extracted document, and follow this License in all other respects regarding verbatim copying of that document.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">7. AGGREGATION WITH INDEPENDENT WORKS</span></p></li></ul>
<p><span class="font19">A compilation of the Document or its derivatives with other separate and independent documents or works, in or on a volume of a storage or distribution medium, is called an &quot;aggregate&quot; if the copyright resulting from the compilation is not used to limit the legal rights of the compilation's users beyond what the individual works permit. When the Document is included in an aggregate, this License does not apply to the other works in the aggregate which are not themselves derivative works of the Document.</span></p>
<p><span class="font19">If the Cover Text requirement of section 3 is applicable to these copies of the Document, then if the Document is less than one half of the entire aggregate, the Document's Cover Texts may be placed on covers that bracket the Document within the aggregate, or the electronic equivalent of covers if the Document is in electronic form. Otherwise they must appear on printed covers that bracket the whole aggregate.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">8. TRANSLATION</span></p></li></ul>
<p><span class="font19">Translation is considered a kind of modification, so you may distribute translations of the Document under the terms of section 4. Replacing Invariant Sections with translations requires special permission from their copyright holders, but you may include translations of some or all Invariant Sections in addition to the original versions of these Invariant Sections. You may include a translation of this License, and all the license notices in the Document, and any Warranty Disclaimers, provided that you also include the original English version of this License and the original versions of those notices and disclaimers. In case of a disagreement between the translation and the original version of this License or a notice or disclaimer, the original version will prevail.</span></p>
<p><span class="font19">If a section in the Document is Entitled &quot;Acknowledgements&quot;, &quot;Dedications&quot;, or &quot;History&quot;, the requirement (section 4) to Preserve its Title (section 1) will typically require changing the actual title.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">9. TERMINATION</span></p></li></ul>
<p><span class="font19">You may not copy, modify, sublicense, or distribute the Document except as expressly provided under this License. Any attempt otherwise to copy, modify, sublicense, or distribute it is void, and will automatically terminate your rights under this License.</span></p>
<p><span class="font19">However, if you cease all violation of this License, then your license from a particular copyright holder is reinstated (a) provisionally, unless and until the copyright holder explicitly and finally terminates your license, and (b) permanently, if the copyright holder fails to notify you of the violation by some reasonable means prior to 60 days after the cessation.</span></p>
<p><span class="font19">Moreover, your license from a particular copyright holder is reinstated permanently if the copyright holder notifies you of the violation by some reasonable means, this is the first time you have received notice of violation of this License (for any work) from that copyright holder, and you cure the violation prior to 30 days after your receipt of the notice.</span></p>
<p><span class="font19">Termination of your rights under this section does not terminate the licenses of parties who have received copies or rights from you under this License. If your rights have been terminated and not permanently reinstated, receipt of a copy of some or all of the same material does not give you any rights to use it.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">10. FUTURE REVISIONS OF THIS LICENSE</span></p></li></ul>
<p><span class="font19">The Free Software Foundation may publish new, revised versions of the GNU Free Documentation License from time to time. Such new versions will be similar in spirit to the present version, but may differ in detail to address new problems or concerns. See </span><a href="http://www.gnu.org/copyleft/"><span class="font19">http://www.gnu.org/copyleft/</span></a><span class="font19">.</span></p>
<p><span class="font19">Each version of the License is given a distinguishing version number. If the Document specifies that a particular numbered version of this License &quot;or any later version&quot; applies to it, you have the option of following the terms and conditions either of that specified version or of any later version that has been published (not as a draft) by the Free Software Foundation. If the Document does not specify a version number of this License, you may choose any version ever published (not as a draft) by the Free Software Foundation. If the Document specifies that a proxy can decide which future versions of this License can be used, that proxy's public statement of acceptance of a version permanently authorizes you to choose that version for the Document.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">11. RELICENSING</span></p></li></ul>
<p><span class="font19">&quot;Massive Multiauthor Collaboration Site&quot; (or &quot;MMC Site&quot;) means any World Wide Web server that publishes copyrightable works and also provides prominent facilities for anybody to edit those works. A public wiki that anybody can edit is an example of such a server. A &quot;Massive Multiauthor Collaboration&quot; (or &quot;MMC&quot;) contained in the site means any set of copyrightable works thus published on the MMC site.</span></p>
<p><span class="font19">&quot;CC-BY-SA&quot; means the Creative Commons Attribution-Share Alike 3.0 license published by Creative Commons Corporation, a not-for-profit corporation with a principal place of business in San Francisco, California, as well as future copyleft versions of that license published by that same organization.</span></p>
<p><span class="font19">&quot;Incorporate&quot; means to publish or republish a Document, in whole or in part, as part of another Document.</span></p>
<p><span class="font19">An MMC is &quot;eligible for relicensing&quot; if it is licensed under this License, and if all works that were first published under this License somewhere other than this MMC, and subsequently incorporated in whole or in part into the MMC, (1) had no cover texts or invariant sections, and (2) were thus incorporated prior to November 1, 2008.</span></p>
<p><span class="font19">The operator of an MMC Site may republish an MMC contained in the site under CC-BY-SA on the same site at any time before August 1, 2009, provided the MMC is eligible for relicensing.</span></p>
<h1><a name="bookmark7730"></a><span class="font11" style="font-weight:bold;"><a name="bookmark6237"></a><a name="bookmark7731"></a>Index</span></h1>
<p><span class="font7" style="font-weight:bold;">Symbols</span></p>
<p><span class="font24">/bin/dmesg, 36</span></p>
<p><span class="font24">/bin/login,</span><a href="#bookmark6661"><span class="font24"> 174</span></a></p>
<p><span class="font24">/boot/grub/grub.conf,</span><a href="#bookmark6521"><span class="font24"> 161</span></a></p>
<p><span class="font24">/boot/grub/menu.lst,</span><a href="#bookmark6522"><span class="font24"> 161</span></a></p>
<p><span class="font24">/dev, 47</span></p>
<p><span class="font24">/dev/hdX, 34</span></p>
<p><span class="font24">/dev/ht, </span><a href="#bookmark7615"><span class="font24">352</span></a></p>
<p><span class="font24">/dev/nst,</span><a href="#bookmark7612"><span class="font24"> 352</span></a></p>
<p><span class="font24">/dev/sdb, 88</span></p>
<p><span class="font24">/dev/sdX, 34</span></p>
<p><span class="font24">/dev/st,</span><a href="#bookmark7611"><span class="font24"> 352</span></a></p>
<p><span class="font24">/etc/apt/sources.list,</span><a href="#bookmark7231"><span class="font24"> 236</span></a></p>
<p><span class="font24">/etc/at.allow,</span><a href="#bookmark6873"><span class="font24"> 196</span></a></p>
<p><span class="font24">/etc/at.deny,</span><a href="#bookmark6874"><span class="font24"> 196</span></a></p>
<p><span class="font24">/etc/cron.allow,</span><a href="#bookmark6885"><span class="font24"> 197</span></a></p>
<p><span class="font24">/etc/cron.d,</span><a href="#bookmark6894"><span class="font24"> 198</span></a></p>
<p><span class="font24">/etc/cron.deny,</span><a href="#bookmark6886"><span class="font24"> 197</span></a></p>
<p><span class="font24">/etc/crontab,</span><a href="#bookmark6895"><span class="font24"> 198</span></a></p>
<p><span class="font24">/etc/default/grub,</span><a href="#bookmark6579"><span class="font24"> 166</span></a></p>
<p><span class="font24">/etc/exports, 310, 321</span></p>
<p><span class="font24">/etc/filesystems, 60, 67</span></p>
<p><span class="font24">/etc/fstab, 63, 71, 88, </span><a href="#bookmark7062"><span class="font24">216</span></a><span class="font24">, 311, 321,</span><a href="#bookmark7694"><span class="font24"> 362</span></a></p>
<p><span class="font24">/etc/grub.conf,</span><a href="#bookmark6525"><span class="font24"> 161</span></a></p>
<p><span class="font24">/etc/grub.d/40_custom,</span><a href="#bookmark6574"><span class="font24"> 166</span></a></p>
<p><span class="font24">/etc/hostname, 272</span></p>
<p><span class="font24">/etc/inetd.conf, 318</span></p>
<p><span class="font24">/etc/init.d/,</span><a href="#bookmark6673"><span class="font24"> 176</span></a><span class="font24">,</span><a href="#bookmark6686"><span class="font24"> 178</span></a></p>
<p><span class="font24">/etc/init.d/rc,</span><a href="#bookmark6654"><span class="font24"> 173</span></a></p>
<p><span class="font24">/etc/init.d/rcS,</span><a href="#bookmark6644"><span class="font24"> 172</span></a></p>
<p><span class="font24">/etc/inittab,</span><a href="#bookmark6627"><span class="font24"> 171</span></a><span class="font24">,</span><a href="#bookmark6651"><span class="font24"> 173</span></a><span class="font24">,</span><a href="#bookmark6658"><span class="font24"> 174</span></a></p>
<p><span class="font24">/etc/lvm/.cache, 113</span></p>
<p><span class="font24">/etc/modprobe.conf,</span><a href="#bookmark7484"><span class="font24"> 338</span></a></p>
<p><span class="font24">/etc/modprobe.d/,</span><a href="#bookmark7485"><span class="font24"> 338</span></a></p>
<p><span class="font24">/etc/mtab, 68,</span><a href="#bookmark6636"><span class="font24"> 172</span></a></p>
<p><span class="font24">/etc/network/interfaces, 265, 289, 292</span></p>
<p><span class="font24">/etc/passwd,</span><a href="#bookmark6662"><span class="font24"> 174</span></a></p>
<p><span class="font24">/etc/protocols, 262</span></p>
<p><span class="font24">/etc/raidtab, 96</span></p>
<p><span class="font24">/etc/rc.d/rc,</span><a href="#bookmark6655"><span class="font24"> 173</span></a></p>
<p><span class="font24">/etc/rc.d/rc.sysinit,</span><a href="#bookmark6637"><span class="font24"> 172</span></a></p>
<p><span class="font24">/etc/rcS.d/,</span><a href="#bookmark6645"><span class="font24"> 172</span></a></p>
<p><span class="font24">/etc/rcX.d/,</span><a href="#bookmark6653"><span class="font24"> 173</span></a></p>
<p><span class="font24">/etc/rsyslog.conf,</span><a href="#bookmark6975"><span class="font24"> 207</span></a></p>
<p><span class="font24">/etc/services, 262, 318</span></p>
<p><span class="font24">/etc/shutdown.allow,</span><a href="#bookmark6734"><span class="font24"> 182</span></a></p>
<p><span class="font24">/etc/ssh, 297</span></p>
<p><span class="font24">/etc/ssh/ssh_config, 297</span></p>
<p><span class="font24">/etc/ssh/sshd_config, 297</span></p>
<p><span class="font24">/etc/sysconfig/iptables, 314</span></p>
<p><span class="font24">/etc/sysconfig/network, 267</span></p>
<p><span class="font24">/etc/sysconfig/network-scripts/, 267</span></p>
<p><span class="font24">/etc/sysconfig/network-scripts/ifcfg-bond0, 290</span></p>
<p><span class="font24">/etc/syslog.conf, </span><a href="#bookmark6959"><span class="font24">205</span></a></p>
<p><span class="font24">/etc/xinetd.conf, 317</span></p>
<p><span class="font24">/etc/xinetd.d, 317</span></p>
<p><span class="font24">/etc/yum.conf,</span><a href="#bookmark7308"><span class="font24"> 245</span></a></p>
<p><span class="font24">/etc/yum.repos.d/,</span><a href="#bookmark7309"><span class="font24"> 245</span></a></p>
<p><span class="font24">/lib, </span><a href="#bookmark7555"><span class="font24">346</span></a></p>
<p><span class="font24">/lib/modules,</span><a href="#bookmark7433"><span class="font24"> 335</span></a><span class="font24">, </span><a href="#bookmark7513"><span class="font24">341</span></a></p>
<p><span class="font24">/lib/modules/&lt;kernel-version&gt;/modules.dep,</span><a href="#bookmark7464"><span class="font24"> 338</span></a></p>
<p><span class="font24">/proc/cmdline,</span><a href="#bookmark6545"><span class="font24"> 163</span></a><span class="font24">,</span><a href="#bookmark7362"><span class="font24"> 326</span></a></p>
<p><span class="font24">/proc/devices, 47, 47</span></p>
<p><span class="font24">/proc/filesystems, 60, 67</span></p>
<p><span class="font24">/proc/kallsyms,</span><a href="#bookmark7425"><span class="font24"> 334</span></a></p>
<p><span class="font24">/proc/mdstat, 96</span></p>
<p><span class="font24">/proc/meminfo, </span><a href="#bookmark7028"><span class="font24">213</span></a><span class="font24">, </span><a href="#bookmark7038"><span class="font24">214</span></a></p>
<p><span class="font24">/proc/modules,</span><a href="#bookmark7441"><span class="font24"> 336</span></a></p>
<p><span class="font24">/proc/mounts, 68</span></p>
<p><span class="font24">/proc/net/bonding, 290, 292</span></p>
<p><span class="font24">/proc/partitions, 47</span></p>
<p><span class="font24">/proc/scsi/scsi, 39</span></p>
<p><span class="font24">/proc/swaps, </span><a href="#bookmark7048"><span class="font24">215</span></a></p>
<p><span class="font24">/sbin, 270</span></p>
<p><span class="font24">/sbin/init,</span><a href="#bookmark6628"><span class="font24"> 171</span></a></p>
<p><span class="font24">/sbin/mingetty,</span><a href="#bookmark6663"><span class="font24"> 174</span></a></p>
<p><span class="font24">/sbin/telinit,</span><a href="#bookmark6714"><span class="font24"> 181</span></a></p>
<p><span class="font24">/usr/lib,</span><a href="#bookmark7556"><span class="font24"> 346</span></a></p>
<p><span class="font24">/usr/share/doc, 267</span></p>
<p><span class="font24">/usr/src, </span><a href="#bookmark7388"><span class="font24">330</span></a></p>
<p><span class="font24">/var/lib/nfs/etab, 310, 321</span></p>
<p><span class="font24">/var/lib/rpm, </span><a href="#bookmark7251"><span class="font24">238</span></a></p>
<p><span class="font24">/var/log/auth.log, </span><a href="#bookmark6953"><span class="font24">204</span></a></p>
<p><span class="font24">/var/log/btmp, </span><a href="#bookmark6917"><span class="font24">202</span></a><span class="font24">, </span><a href="#bookmark6943"><span class="font24">203</span></a></p>
<p><span class="font24">/var/log/lastlog,</span><a href="#bookmark6918"><span class="font24"> 202</span></a></p>
<p><span class="font24">/var/log/messages, </span><a href="#bookmark7371"><span class="font24">327</span></a><span class="font24">,</span><a href="#bookmark7546"><span class="font24"> 344</span></a></p>
<p><span class="font24">/var/log/sa, </span><a href="#bookmark7115"><span class="font24">224</span></a></p>
<p><span class="font24">/var/log/secure, </span><a href="#bookmark6954"><span class="font24">204</span></a></p>
<p><span class="font24">/var/log/wtmp,</span><a href="#bookmark6728"><span class="font24"> 182</span></a><span class="font24">,</span><a href="#bookmark6919"><span class="font24"> 202</span></a></p>
<p><span class="font24">/var/run/utmp, </span><a href="#bookmark6920"><span class="font24">202</span></a></p>
<p><span class="font24">./configure, </span><a href="#bookmark7321"><span class="font24">247</span></a></p>
<p><span class="font24">.deb, </span><a href="#bookmark7147"><span class="font24">227</span></a></p>
<p><span class="font24">.rpm, </span><a href="#bookmark7148"><span class="font24">227</span></a></p>
<p><span class="font24">.ssh, 301</span></p>
<p><span class="font24">~/.ssh/authorized_keys, 302</span></p>
<p><span class="font24">$$, </span><a href="#bookmark6293"><span class="font24">5</span></a></p>
<p><span class="font24">$PPID, </span><a href="#bookmark6294"><span class="font24">5</span></a></p>
<p><span class="font7" style="font-weight:bold;">A</span></p>
<p><span class="font24">access time, 32</span></p>
<p><span class="font24">active partition,</span><a href="#bookmark6553"><span class="font24"> 164</span></a></p>
<p><span class="font24">Alica and Bob, 298</span></p>
<p><span class="font24">anycast, 258</span></p>
<p><span class="font24">apt-get(8),</span><a href="#bookmark7156"><span class="font24"> 228</span></a><span class="font24">, </span><a href="#bookmark7193"><span class="font24">232</span></a></p>
<p><span class="font24">aptitude,</span><a href="#bookmark7572"><span class="font24"> 347</span></a></p>
<p><span class="font24">aptitude(1),</span><a href="#bookmark7399"><span class="font24"> 331</span></a></p>
<p><span class="font24">aptitude(8), </span><a href="#bookmark7157"><span class="font24">228</span></a><span class="font24">, </span><a href="#bookmark7226"><span class="font24">235</span></a></p>
<p><span class="font24">arp(1), 273</span></p>
<p><span class="font24">arp table, 273</span></p>
<p><span class="font24">at(1),</span><a href="#bookmark6852"><span class="font24"> 194</span></a><span class="font24">,</span><a href="#bookmark6858"><span class="font24"> 195</span></a></p>
<p><span class="font24">ata, 32</span></p>
<p><span class="font24">atapi, 32</span></p>
<p><span class="font24">atm, 260 atq(1),</span><a href="#bookmark6863"><span class="font24"> 195</span></a><span class="font24"> atrm(1),</span><a href="#bookmark6870"><span class="font24"> 196</span></a></p>
<p><span class="font7" style="font-weight:bold;">B</span></p>
<p><span class="font24">badblocks(8), 40 bg(1), </span><a href="#bookmark6439"><span class="font24">24</span></a></p>
<p><span class="font24">Bill Callkins,</span><a href="#bookmark6488"><span class="font24"> 159</span></a><span class="font24"> binding, 288 binding(ip), 287</span></p>
<p><span class="font24">BIOS,</span><a href="#bookmark6485"><span class="font24"> 158</span></a><span class="font24"> block device, 33 bonding(ip), 287 boot(grub),</span><a href="#bookmark6539"><span class="font24"> 163</span></a><span class="font24"> bootloader,</span><a href="#bookmark6502"><span class="font24"> 160</span></a><span class="font24"> bootp, 267, 283 broadcast, 258 BSD,</span><a href="#bookmark6474"><span class="font24"> 158</span></a><span class="font24"> btrfs, 59 bum(8),</span><a href="#bookmark6703"><span class="font24"> 180</span></a><span class="font24"> bzImage,</span><a href="#bookmark6540"><span class="font24"> 163</span></a><span class="font24"> bzip2,</span><a href="#bookmark6541"><span class="font24"> 163</span></a><span class="font24"> bzip2(1),</span><a href="#bookmark7629"><span class="font24"> 353</span></a></p>
<p><span class="font7" style="font-weight:bold;">C</span></p>
<p><span class="font24">cable select, 32 Canonical,</span><a href="#bookmark6615"><span class="font24"> 170</span></a><span class="font24"> chainloader,</span><a href="#bookmark6556"><span class="font24"> 164</span></a><span class="font24"> chainloading,</span><a href="#bookmark6552"><span class="font24"> 164</span></a><span class="font24"> character device, 33 chattr(1),</span><a href="#bookmark7647"><span class="font24"> 356</span></a><span class="font24"> chkconfig,</span><a href="#bookmark6675"><span class="font24"> 176</span></a><span class="font24"> chkconfig(8),</span><a href="#bookmark6679"><span class="font24"> 177</span></a><span class="font24"> chroot, 80</span></p>
<p><span class="font24">CHS, 33</span></p>
<p><span class="font24">Cisco, 260 cpio(1), </span><a href="#bookmark7256"><span class="font24">238</span></a><span class="font24">,</span><a href="#bookmark7650"><span class="font24"> 356</span></a><span class="font24"> cron(8),</span><a href="#bookmark6853"><span class="font24"> 194</span></a><span class="font24"> crontab(1),</span><a href="#bookmark6879"><span class="font24"> 197</span></a><span class="font24"> crontab(5),</span><a href="#bookmark6880"><span class="font24"> 197</span></a></p>
<p><span class="font24">Ctrl-Alt-Delete,</span><a href="#bookmark6732"><span class="font24"> 182</span></a><span class="font24">,</span><a href="#bookmark6737"><span class="font24"> 182</span></a><span class="font24"> Ctrl-Z, </span><a href="#bookmark6428"><span class="font24">23</span></a><span class="font24"> cylinder, 32</span></p>
<p><span class="font7" style="font-weight:bold;">D</span></p>
<p><span class="font24">daemon, </span><a href="#bookmark6285"><span class="font24">4</span></a><span class="font24">,</span><a href="#bookmark6669"><span class="font24"> 176</span></a><span class="font24"> dd(1), 51,</span><a href="#bookmark6500"><span class="font24"> 160</span></a><span class="font24">, </span><a href="#bookmark7056"><span class="font24">216</span></a><span class="font24">,</span><a href="#bookmark7655"><span class="font24"> 357</span></a><span class="font24"> deb(5), </span><a href="#bookmark7158"><span class="font24">228</span></a></p>
<p><span class="font24">debsums, </span><a href="#bookmark7567"><span class="font24">347</span></a><span class="font24"> default(grub),</span><a href="#bookmark6530"><span class="font24"> 162</span></a><span class="font24">,</span><a href="#bookmark6548"><span class="font24"> 164</span></a><span class="font24"> default gateway, 274 depmod(1), </span><a href="#bookmark7469"><span class="font24">338</span></a><span class="font24"> device driver, 47 devices.txt, 47 df, </span><a href="#bookmark7085"><span class="font24">220</span></a></p>
<p><span class="font24">df(1), 69, 69 dhclient(1), 272 dhcp, 267, 283 dhcp client, 265, 272 directory, 57 disk platters, 32 dmesg(1), 36 dmesg(8),</span><a href="#bookmark7377"><span class="font24"> 328</span></a><span class="font24"> dns, 283</span></p>
<p><span class="font24">DOS,</span><a href="#bookmark6557"><span class="font24"> 164</span></a><span class="font24"> dpkg(8), </span><a href="#bookmark7159"><span class="font24">228</span></a><span class="font24">, </span><a href="#bookmark7180"><span class="font24">230</span></a><span class="font24"> dpkg -S,</span><a href="#bookmark7566"><span class="font24"> 347</span></a><span class="font24"> dsa, 298 du, </span><a href="#bookmark7086"><span class="font24">220</span></a><span class="font24"> du(1), 69 dump(1),</span><a href="#bookmark7645"><span class="font24"> 356</span></a></p>
<p><span class="font7" style="font-weight:bold;">E</span></p>
<p><span class="font24">e2fsck(1), 63 echo(1),</span><a href="#bookmark6295"><span class="font24"> 5</span></a><span class="font24"> edquota(1),</span><a href="#bookmark7701"><span class="font24"> 362</span></a><span class="font24"> egrep,</span><a href="#bookmark6640"><span class="font24"> 172</span></a></p>
<p><span class="font24">elilo,</span><a href="#bookmark6504"><span class="font24"> 160</span></a><span class="font24"> el torito, 59</span></p>
<p><span class="font24">Eric Allman, </span><a href="#bookmark6960"><span class="font24">205</span></a><span class="font24"> eth0, 265 ethtool(1), 275</span></p>
<p><span class="font24">Evi Nemeth,</span><a href="#bookmark6670"><span class="font24"> 176</span></a><span class="font24"> exec,</span><a href="#bookmark6304"><span class="font24"> 6</span></a><span class="font24"> exportfs(1), 310, 321 ext2, 58, 61 ext3, 58</span></p>
<p><span class="font24">extended partition, 46</span></p>
<p><span class="font7" style="font-weight:bold;">F</span></p>
<p><span class="font24">fallback(grub),</span><a href="#bookmark6531"><span class="font24"> 162</span></a><span class="font24"> fat16, 59</span></p>
<p><span class="font24">fat32, 59</span></p>
<p><span class="font24">fd (partition type), 95 fddi, 260</span></p>
<p><span class="font24">fdisk, 135</span></p>
<p><span class="font24">fdisk(1), 47, 49, 50, 95</span></p>
<p><span class="font24">fdisk(8), 35</span></p>
<p><span class="font24">fdisk limitations, 52 fg(1),</span><a href="#bookmark6434"><span class="font24"> 24</span></a></p>
<p><span class="font24">file system, 56 fixed ip, 268 fixed ip address, 265 fork,</span><a href="#bookmark6303"><span class="font24"> 6</span></a></p>
<p><span class="font24">FQDN, 272</span></p>
<p><span class="font24">frame relay, 260 free, </span><a href="#bookmark7087"><span class="font24">220</span></a><span class="font24">, </span><a href="#bookmark7096"><span class="font24">221</span></a><span class="font24"> free(1),</span><a href="#bookmark7029"><span class="font24"> 213</span></a><span class="font24">, </span><a href="#bookmark7040"><span class="font24">214</span></a><span class="font24"> fsck(1), 63</span></p>
<p><span class="font24">ftp, 317</span></p>
<p><a href="ftp://ftp.kernel.org"><span class="font24">ftp://ftp.kernel.org</span></a><span class="font24">,</span><a href="#bookmark7384"><span class="font24"> 329</span></a><span class="font24"> fuser, 79, 79</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font7" style="font-weight:bold;">G</span></p>
<p><span class="font24">gateway, 274</span></p>
<p><span class="font24">gnome-session,</span><a href="#bookmark7720"><span class="font24"> 363</span></a></p>
<p><span class="font24">gpt, 52</span></p>
<p><span class="font24">grep,</span><a href="#bookmark6641"><span class="font24"> 172</span></a><span class="font24">,</span><a href="#bookmark7442"><span class="font24"> 336</span></a></p>
<p><span class="font24">grpquota,</span><a href="#bookmark7695"><span class="font24"> 362</span></a></p>
<p><span class="font24">grub,</span><a href="#bookmark6471"><span class="font24"> 157</span></a><span class="font24">,</span><a href="#bookmark6505"><span class="font24"> 160</span></a><span class="font24">,</span><a href="#bookmark6554"><span class="font24"> 164</span></a></p>
<p><span class="font24">grub2,</span><a href="#bookmark6516"><span class="font24"> 161</span></a></p>
<p><span class="font24">grub-install,</span><a href="#bookmark6565"><span class="font24"> 165</span></a></p>
<p><span class="font24">gzip(1),</span><a href="#bookmark6542"><span class="font24"> 163</span></a><span class="font24">,</span><a href="#bookmark7632"><span class="font24"> 353</span></a></p></td><td style="vertical-align:top;">
<p><span class="font7" style="font-weight:bold;">K</span></p>
<p><span class="font24">Kerberos, 309, 320</span></p>
<p><span class="font24">kernel(grub),</span><a href="#bookmark6543"><span class="font24"> 163</span></a><span class="font24"> kill(1), </span><a href="#bookmark6282"><span class="font24">4</span></a><span class="font24">, </span><a href="#bookmark6326"><span class="font24">9</span></a><span class="font24">,</span><a href="#bookmark6329"><span class="font24"> 9</span></a><span class="font24">,</span><a href="#bookmark6665"><span class="font24"> 174</span></a><span class="font24">,</span><a href="#bookmark6666"><span class="font24"> 175</span></a></p>
<p><span class="font24">killall(1),</span><a href="#bookmark6346"><span class="font24"> 11</span></a><span class="font24"> kmyfirewall, 314</span></p>
<p><span class="font7" style="font-weight:bold;">L</span></p>
<p><span class="font24">LAN, 259</span></p>
<p><span class="font24">last(1),</span><a href="#bookmark6729"><span class="font24"> 182</span></a><span class="font24">, </span><a href="#bookmark6930"><span class="font24">202</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">H</span></p>
<p><span class="font24">halt(8),</span><a href="#bookmark6723"><span class="font24"> 182</span></a></p>
<p><span class="font24">hdparm(8), 41</span></p>
<p><span class="font24">head (hard disk device), 32</span></p>
<p><span class="font24">hiddenmenu(grub),</span><a href="#bookmark6533"><span class="font24"> 162</span></a></p>
<p><span class="font24">hostname, 272</span></p>
<p><span class="font24">hostname(1), 272</span></p>
<p><a href="http://www.kernel.org"><span class="font24">http://www.kernel.org</span></a><span class="font24">,</span><a href="#bookmark7385"><span class="font24"> 329</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">lastb(1),</span><a href="#bookmark6944"><span class="font24"> 203</span></a><span class="font24"> lastlog(1), </span><a href="#bookmark6938"><span class="font24">203</span></a></p>
<p><span class="font24">LBA, 33 ldap, 310 ldd,</span><a href="#bookmark7559"><span class="font24"> 346</span></a><span class="font24"> libraries, </span><a href="#bookmark7552"><span class="font24">346</span></a><span class="font24"> lilo,</span><a href="#bookmark6506"><span class="font24"> 160</span></a><span class="font24">,</span><a href="#bookmark6591"><span class="font24"> 167</span></a><span class="font24"> lilo.conf,</span><a href="#bookmark6594"><span class="font24"> 167</span></a><span class="font24"> logger(1), </span><a href="#bookmark6980"><span class="font24">208</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">I</span></p>
<p><span class="font24">icmp, 262</span></p>
<p><span class="font24">id_dsa, 302</span></p>
<p><span class="font24">id_dsa.pub, 302</span></p>
<p><span class="font24">id_rsa, 301</span></p>
<p><span class="font24">id_rsa.pub, 301</span></p>
<p><span class="font24">ide, 47</span></p>
<p><span class="font24">ifcfg(1), 288</span></p>
<p><span class="font24">ifcfg-eth0, 268</span></p>
<p><span class="font24">ifconfig(1), 269, 270, 288, 289, 290, 292</span></p>
<p><span class="font24">ifdown(1), 266, 269, 270, 288</span></p>
<p><span class="font24">ifenslave, 292</span></p>
<p><span class="font24">iftop(1), </span><a href="#bookmark7128"><span class="font24">225</span></a></p>
<p><span class="font24">ifup(1), 266, 269, 270, 288, 289, 290</span></p>
<p><span class="font24">igmp, 262</span></p>
<p><span class="font24">inetd, 317</span></p>
<p><span class="font24">init, </span><a href="#bookmark6279"><span class="font24">4</span></a><span class="font24">,</span><a href="#bookmark6624"><span class="font24"> 171</span></a><span class="font24">,</span><a href="#bookmark6733"><span class="font24"> 182</span></a></p>
<p><span class="font24">init=/bin/bash,</span><a href="#bookmark7368"><span class="font24"> 327</span></a></p>
<p><span class="font24">initiator(iSCSI), 127</span></p>
<p><span class="font24">initng,</span><a href="#bookmark6619"><span class="font24"> 170</span></a></p>
<p><span class="font24">initrd,</span><a href="#bookmark7420"><span class="font24"> 333</span></a></p>
<p><span class="font24">initrd(grub),</span><a href="#bookmark6546"><span class="font24"> 163</span></a></p>
<p><span class="font24">insmod(1),</span><a href="#bookmark7454"><span class="font24"> 337</span></a><span class="font24">,</span><a href="#bookmark7460"><span class="font24"> 337</span></a></p>
<p><span class="font24">Intel,</span><a href="#bookmark6475"><span class="font24"> 158</span></a></p>
<p><span class="font24">iostat, 81</span></p>
<p><span class="font24">iostat(1), </span><a href="#bookmark7105"><span class="font24">223</span></a></p>
<p><span class="font24">iotop, 82</span></p>
<p><span class="font24">iptables, 314</span></p>
<p><span class="font24">iSCSI, 127</span></p>
<p><span class="font24">iscsiadm, 134</span></p>
<p><span class="font24">iso9660, 59,</span><a href="#bookmark7658"><span class="font24"> 357</span></a></p></td><td style="vertical-align:top;">
<p><span class="font24">logical drive, 46</span></p>
<p><span class="font24">logical drives, 51</span></p>
<p><span class="font24">login, </span><a href="#bookmark6931"><span class="font24">202</span></a></p>
<p><span class="font24">logrotate(1), </span><a href="#bookmark6997"><span class="font24">209</span></a></p>
<p><span class="font24">lsmod,</span><a href="#bookmark7445"><span class="font24"> 336</span></a></p>
<p><span class="font24">lsmod(1),</span><a href="#bookmark7438"><span class="font24"> 335</span></a></p>
<p><span class="font24">lsof, 78</span></p>
<p><span class="font24">lsscsi(1), 38</span></p>
<p><span class="font24">ltrace, </span><a href="#bookmark7563"><span class="font24">347</span></a></p>
<p><span class="font24">lvcreate(1), 103, 105, 119</span></p>
<p><span class="font24">lvdisplay(1), 106, 114</span></p>
<p><span class="font24">lvextend(1), 106, 120</span></p>
<p><span class="font24">lvm, 80</span></p>
<p><span class="font24">LVM, 100</span></p>
<p><span class="font24">lvmdiskscan(1), 111</span></p>
<p><span class="font24">lvol0, 119</span></p>
<p><span class="font24">lvremove(1), 119</span></p>
<p><span class="font24">lvrename(1), 120</span></p>
<p><span class="font24">lvs(1), 114</span></p>
<p><span class="font24">lvscan(1), 114</span></p>
<p><span class="font7" style="font-weight:bold;">M</span></p>
<p><span class="font24">mac address, 270</span></p>
<p><span class="font24">major number, 47</span></p>
<p><span class="font24">make,</span><a href="#bookmark7534"><span class="font24"> 344</span></a></p>
<p><span class="font24">make(1), </span><a href="#bookmark7322"><span class="font24">247</span></a></p>
<p><span class="font24">make bzImage,</span><a href="#bookmark7506"><span class="font24"> 341</span></a></p>
<p><span class="font24">make clean, </span><a href="#bookmark7503"><span class="font24">340</span></a></p>
<p><span class="font24">make menuconfig, </span><a href="#bookmark7499"><span class="font24">340</span></a></p>
<p><span class="font24">make modules,</span><a href="#bookmark7510"><span class="font24"> 341</span></a></p>
<p><span class="font24">make mrproper, </span><a href="#bookmark7494"><span class="font24">340</span></a></p>
<p><span class="font24">make xconfig,</span><a href="#bookmark7500"><span class="font24"> 340</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">J</span></p>
<p><span class="font24">jbod, 93</span></p>
<p><span class="font24">jobs,</span><a href="#bookmark6425"><span class="font24"> 23</span></a></p>
<p><span class="font24">joliet, 59</span></p>
<p><span class="font24">journaling, 58</span></p></td><td style="vertical-align:top;">
<p><span class="font24">MAN, 259</span></p>
<p><span class="font24">master (hard disk device), 32</span></p>
<p><span class="font24">master boot record, 51,</span><a href="#bookmark6497"><span class="font24"> 160</span></a></p>
<p><span class="font24">mbr, 51, 51, 52,</span><a href="#bookmark6498"><span class="font24"> 160</span></a></p>
<p><span class="font24">MBR, </span><a href="#bookmark7663"><span class="font24">357</span></a></p>
<p><span class="font24">mdadm(1), 96</span></p></td></tr>
</table>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24">mingetty,</span><a href="#bookmark6659"><span class="font24"> 174</span></a></p>
<p><span class="font24">minor number, 47</span></p>
<p><span class="font24">mirror, 93</span></p>
<p><span class="font24">mkdir, 67</span></p>
<p><span class="font24">mke2fs(1), 58, 61, 105</span></p>
<p><span class="font24">mkfifo,</span><a href="#bookmark6394"><span class="font24"> 16</span></a></p>
<p><span class="font24">mkfile(1), </span><a href="#bookmark7057"><span class="font24">216</span></a></p>
<p><span class="font24">mkfs(1), 58, 61</span></p>
<p><span class="font24">mkinitrd(1), 58,</span><a href="#bookmark7518"><span class="font24"> 342</span></a></p>
<p><span class="font24">mknod(1),</span><a href="#bookmark7608"><span class="font24"> 352</span></a></p>
<p><span class="font24">mkswap(1),</span><a href="#bookmark7051"><span class="font24"> 215</span></a></p>
<p><span class="font24">modinfo,</span><a href="#bookmark7541"><span class="font24"> 344</span></a></p>
<p><span class="font24">modinfo(1), </span><a href="#bookmark7457"><span class="font24">337</span></a></p>
<p><span class="font24">modprobe(1),</span><a href="#bookmark7461"><span class="font24"> 337</span></a><span class="font24">, </span><a href="#bookmark7479"><span class="font24">338</span></a></p>
<p><span class="font24">mount, 67</span></p>
<p><span class="font24">mount(1), 66, 68, 311, 321</span></p>
<p><span class="font24">mounting, 66</span></p>
<p><span class="font24">mount point, 66</span></p>
<p><span class="font24">mpstat(1), </span><a href="#bookmark7112"><span class="font24">224</span></a></p>
<p><span class="font24">mt(1),</span><a href="#bookmark7618"><span class="font24"> 352</span></a></p>
<p><span class="font24">multicast, 257</span></p>
<p><span class="font24">multipath, 147</span></p>
<p><span class="font7" style="font-weight:bold;">N</span></p>
<p><span class="font24">netstat(1), 274</span></p>
<p><span class="font24">network file system, 308</span></p>
<p><span class="font24">nfs, 308, 309</span></p>
<p><span class="font24">NFS, 320</span></p>
<p><span class="font24">nice,</span><a href="#bookmark6409"><span class="font24"> 18</span></a></p>
<p><span class="font24">nice(1),</span><a href="#bookmark6390"><span class="font24"> 16</span></a></p>
<p><span class="font24">no_subtree_check(nfs), 310</span></p>
<p><span class="font24">noacl(mount), 72</span></p>
<p><span class="font24">nodev, 60, 67</span></p>
<p><span class="font24">noexec(mount), 72</span></p>
<p><span class="font24">nosuid(mount), 72</span></p>
<p><span class="font24">ntop(1), </span><a href="#bookmark7123"><span class="font24">225</span></a></p></td><td style="vertical-align:top;">
<p><span class="font24">pgrep(1),</span><a href="#bookmark6318"><span class="font24"> 8</span></a></p>
<p><span class="font24">PID, </span><a href="#bookmark6272"><span class="font24">4</span></a></p>
<p><span class="font24">pidof(1), </span><a href="#bookmark6298"><span class="font24">5</span></a></p>
<p><span class="font24">ping, 262, 274</span></p>
<p><span class="font24">pipes,</span><a href="#bookmark6395"><span class="font24"> 16</span></a></p>
<p><span class="font24">pkill(1),</span><a href="#bookmark6341"><span class="font24"> 11</span></a></p>
<p><span class="font24">portmap, 309, 320</span></p>
<p><span class="font24">POST,</span><a href="#bookmark6481"><span class="font24"> 158</span></a></p>
<p><span class="font24">poweroff(8),</span><a href="#bookmark6724"><span class="font24"> 182</span></a></p>
<p><span class="font24">Power On Self Test,</span><a href="#bookmark6482"><span class="font24"> 158</span></a></p>
<p><span class="font24">PPID, </span><a href="#bookmark6276"><span class="font24">4</span></a></p>
<p><span class="font24">primary partition, 46,</span><a href="#bookmark6499"><span class="font24"> 160</span></a><span class="font24">,</span><a href="#bookmark6555"><span class="font24"> 164</span></a></p>
<p><span class="font24">private key, 298</span></p>
<p><span class="font24">process, </span><a href="#bookmark6269"><span class="font24">4</span></a></p>
<p><span class="font24">process id, </span><a href="#bookmark6273"><span class="font24">4</span></a></p>
<p><span class="font24">ps, </span><a href="#bookmark6309"><span class="font24">7</span></a><span class="font24">, </span><a href="#bookmark7088"><span class="font24">220</span></a></p>
<p><span class="font24">ps -ef, </span><a href="#bookmark6312"><span class="font24">7</span></a></p>
<p><span class="font24">ps fax, </span><a href="#bookmark6313"><span class="font24">7</span></a></p>
<p><span class="font24">public key, 298</span></p>
<p><span class="font24">pvchange(1), 116</span></p>
<p><span class="font24">pvcreate(1), 103, 105, 115</span></p>
<p><span class="font24">pvdisplay(1), 105, 112</span></p>
<p><span class="font24">pvmove(1), 116</span></p>
<p><span class="font24">pvremove(1), 115</span></p>
<p><span class="font24">pvresize(1), 115</span></p>
<p><span class="font24">pvs(1), 111</span></p>
<p><span class="font24">pvscan(1), 111</span></p>
<p><span class="font7" style="font-weight:bold;">Q</span></p>
<p><span class="font24">quota.group,</span><a href="#bookmark7698"><span class="font24"> 362</span></a></p>
<p><span class="font24">quota.user,</span><a href="#bookmark7699"><span class="font24"> 362</span></a></p>
<p><span class="font24">quota's,</span><a href="#bookmark7696"><span class="font24"> 362</span></a></p>
<p><span class="font24">quota(1),</span><a href="#bookmark7702"><span class="font24"> 362</span></a></p>
<p><span class="font24">quotacheck(1),</span><a href="#bookmark7700"><span class="font24"> 362</span></a></p>
<p><span class="font24">quotaoff(1),</span><a href="#bookmark7705"><span class="font24"> 362</span></a></p>
<p><span class="font24">quotaon(1),</span><a href="#bookmark7704"><span class="font24"> 362</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">O</span></p>
<p><span class="font24">od(1),</span><a href="#bookmark6503"><span class="font24"> 160</span></a></p>
<p><span class="font24">OpenBoot(Sun),</span><a href="#bookmark6489"><span class="font24"> 159</span></a></p>
<p><span class="font24">OpenBSD, 297</span></p>
<p><span class="font24">openssh, 297</span></p>
<p><span class="font24">openssh-server, 304</span></p>
<p><span class="font24">OS/2,</span><a href="#bookmark6558"><span class="font24"> 164</span></a></p>
<p><span class="font7" style="font-weight:bold;">P</span></p>
<p><span class="font24">package management, </span><a href="#bookmark7145"><span class="font24">227</span></a></p>
<p><span class="font24">paging,</span><a href="#bookmark7031"><span class="font24"> 213</span></a></p>
<p><span class="font24">PAN, 260</span></p>
<p><span class="font24">Parallel ATA, 32</span></p>
<p><span class="font24">parity(raid), 93</span></p>
<p><span class="font24">parted, 52, 53</span></p>
<p><span class="font24">parted(1), 49</span></p>
<p><span class="font24">partition, 46</span></p>
<p><span class="font24">partition table, 51, 51</span></p>
<p><span class="font24">partprobe(1), 51</span></p>
<p><span class="font24">password(grub),</span><a href="#bookmark6535"><span class="font24"> 162</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">R</span></p>
<p><span class="font24">RAID, 92</span></p>
<p><span class="font24">raid 1, 93</span></p>
<p><span class="font24">reboot(8),</span><a href="#bookmark6725"><span class="font24"> 182</span></a></p>
<p><span class="font24">reiserfs, 59</span></p>
<p><span class="font24">Remote Desktop,</span><a href="#bookmark7712"><span class="font24"> 363</span></a></p>
<p><span class="font24">renice,</span><a href="#bookmark6404"><span class="font24"> 17</span></a></p>
<p><span class="font24">renice(1),</span><a href="#bookmark6391"><span class="font24"> 16</span></a><span class="font24"> repository, </span><a href="#bookmark7146"><span class="font24">227</span></a><span class="font24">,</span><a href="#bookmark7153"><span class="font24"> 228</span></a><span class="font24"> repquota(1),</span><a href="#bookmark7703"><span class="font24"> 362</span></a><span class="font24"> resize2fs(1), 106</span></p>
<p><span class="font24">respawn(init),</span><a href="#bookmark6660"><span class="font24"> 174</span></a><span class="font24">,</span><a href="#bookmark6664"><span class="font24"> 174</span></a></p>
<p><span class="font24">restore(1),</span><a href="#bookmark7646"><span class="font24"> 356</span></a></p>
<p><span class="font24">rfc 3010, 309</span></p>
<p><span class="font24">rfc 3530, 309</span></p>
<p><span class="font24">rlogin, 297</span></p>
<p><span class="font24">rmmod(1),</span><a href="#bookmark7474"><span class="font24"> 338</span></a></p>
<p><span class="font24">rock ridge, 59</span></p>
<p><span class="font24">root(grub),</span><a href="#bookmark6547"><span class="font24"> 163</span></a></p>
<p><span class="font24">root servers(DNS), 258</span></p></td></tr>
</table>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24">rootsquash, 310, 321</span></p>
<p><span class="font24">rotational latency, 32</span></p>
<p><span class="font24">route(1), 274, 274</span></p>
<p><span class="font24">router, 260</span></p>
<p><span class="font24">rpc, 309</span></p>
<p><span class="font24">RPC, 320</span></p>
<p><span class="font24">rpcinfo(1), 309, 320</span></p>
<p><span class="font24">rpm, </span><a href="#bookmark7236"><span class="font24">237</span></a></p>
<p><span class="font24">rpm(8), </span><a href="#bookmark7162"><span class="font24">228</span></a></p>
<p><span class="font24">rpm2cpio(8), </span><a href="#bookmark7257"><span class="font24">238</span></a></p>
<p><span class="font24">rpm -qf,</span><a href="#bookmark7575"><span class="font24"> 348</span></a></p>
<p><span class="font24">rpm -V,</span><a href="#bookmark7578"><span class="font24"> 348</span></a></p>
<p><span class="font24">rsa, 298</span></p>
<p><span class="font24">rsh, 297</span></p>
<p><span class="font24">rsyslog, 78</span></p>
<p><span class="font24">runlevel,</span><a href="#bookmark6631"><span class="font24"> 171</span></a></p>
<p><span class="font24">runlevel(1),</span><a href="#bookmark6710"><span class="font24"> 181</span></a></p></td><td style="vertical-align:top;">
<p><span class="font24">su,</span><a href="#bookmark7560"><span class="font24"> 346</span></a></p>
<p><span class="font24">subtree_check(nfs), 310</span></p>
<p><span class="font24">Sun,</span><a href="#bookmark6477"><span class="font24"> 158</span></a><span class="font24">,</span><a href="#bookmark6617"><span class="font24"> 170</span></a></p>
<p><span class="font24">swapoff(1), </span><a href="#bookmark7052"><span class="font24">215</span></a></p>
<p><span class="font24">swapon(1), </span><a href="#bookmark7053"><span class="font24">215</span></a></p>
<p><span class="font24">swap partition, 59</span></p>
<p><span class="font24">swap partition(s), </span><a href="#bookmark7067"><span class="font24">217</span></a></p>
<p><span class="font24">swapping, </span><a href="#bookmark7032"><span class="font24">213</span></a></p>
<p><span class="font24">swap space, </span><a href="#bookmark7047"><span class="font24">215</span></a></p>
<p><span class="font24">swat, 317</span></p>
<p><span class="font24">sysctl(1), 272</span></p>
<p><span class="font24">syslog,</span><a href="#bookmark7372"><span class="font24"> 327</span></a></p>
<p><span class="font24">syslogd,</span><a href="#bookmark6961"><span class="font24"> 205</span></a><span class="font24">, </span><a href="#bookmark6964"><span class="font24">205</span></a></p>
<p><span class="font24">System.map,</span><a href="#bookmark7426"><span class="font24"> 334</span></a></p>
<p><span class="font24">system-config-securitylevel, 314</span></p>
<p><span class="font24">System V,</span><a href="#bookmark6614"><span class="font24"> 170</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">S</span></p>
<p><span class="font24">sa2(1), </span><a href="#bookmark7119"><span class="font24">224</span></a></p>
<p><span class="font24">sadc(1),</span><a href="#bookmark7116"><span class="font24"> 224</span></a></p>
<p><span class="font24">sal, </span><a href="#bookmark7117"><span class="font24">224</span></a></p>
<p><span class="font24">sar(1), </span><a href="#bookmark7118"><span class="font24">224</span></a><span class="font24">,</span><a href="#bookmark7120"><span class="font24"> 224</span></a></p>
<p><span class="font24">sata, 32</span></p>
<p><span class="font24">savedefault(grub),</span><a href="#bookmark6549"><span class="font24"> 164</span></a></p>
<p><span class="font24">scp(1), 302</span></p>
<p><span class="font24">scsi, 32</span></p>
<p><span class="font24">scsi id, 32</span></p>
<p><span class="font24">sector, 32</span></p>
<p><span class="font24">seek time, 32</span></p>
<p><span class="font24">service(1),</span><a href="#bookmark6674"><span class="font24"> 176</span></a><span class="font24">, 314</span></p>
<p><span class="font24">setuid, 72</span></p>
<p><span class="font24">sfdisk(1), 51</span></p>
<p><span class="font24">shutdown(8),</span><a href="#bookmark6718"><span class="font24"> 181</span></a></p>
<p><span class="font24">SIGHUP,</span><a href="#bookmark6332"><span class="font24"> 9</span></a></p>
<p><span class="font24">SIGKILL,</span><a href="#bookmark6719"><span class="font24"> 181</span></a></p>
<p><span class="font24">SIGTERM,</span><a href="#bookmark6347"><span class="font24"> 11</span></a><span class="font24">,</span><a href="#bookmark6720"><span class="font24"> 181</span></a></p>
<p><span class="font24">silo,</span><a href="#bookmark6507"><span class="font24"> 160</span></a></p>
<p><span class="font24">single user mode,</span><a href="#bookmark7365"><span class="font24"> 327</span></a></p>
<p><span class="font24">slave (hard disk device), 32</span></p>
<p><span class="font24">SMF,</span><a href="#bookmark6616"><span class="font24"> 170</span></a></p>
<p><span class="font24">Solaris,</span><a href="#bookmark6476"><span class="font24"> 158</span></a></p>
<p><span class="font24">solid state drive, 33</span></p>
<p><span class="font24">SPARC,</span><a href="#bookmark6490"><span class="font24"> 159</span></a></p>
<p><span class="font24">split(1),</span><a href="#bookmark7674"><span class="font24"> 358</span></a></p>
<p><span class="font24">ssd, 33</span></p>
<p><span class="font24">ssh, 297</span></p>
<p><span class="font24">ssh_host_dsa_key, 304</span></p>
<p><span class="font24">ssh_host_dsa_key.pub, 304 ssh_host_rsa_key, 304 ssh_host_rsa_key.pub, 304 sshd, 304</span></p>
<p><span class="font24">ssh-keygen, 301</span></p>
<p><span class="font24">ssh-keygen(1), 301</span></p>
<p><span class="font24">ssh -X, 302</span></p>
<p><span class="font24">stanza(grub),</span><a href="#bookmark6538"><span class="font24"> 163</span></a></p>
<p><span class="font24">strace,</span><a href="#bookmark7588"><span class="font24"> 349</span></a></p>
<p><span class="font24">striped disk, 93</span></p></td><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">T</span></p>
<p><span class="font24">tail(1), </span><a href="#bookmark6987"><span class="font24">208</span></a></p>
<p><span class="font24">tar(1), </span><a href="#bookmark7318"><span class="font24">247</span></a><span class="font24">,</span><a href="#bookmark7637"><span class="font24"> 353</span></a><span class="font24">,</span><a href="#bookmark7640"><span class="font24"> 354</span></a></p>
<p><span class="font24">tcp, 262, 309</span></p>
<p><span class="font24">tcpdump, 279, 284, 284</span></p>
<p><span class="font24">telinit(8),</span><a href="#bookmark6715"><span class="font24"> 181</span></a></p>
<p><span class="font24">telnet, 297, 317</span></p>
<p><span class="font24">time(1), </span><a href="#bookmark7507"><span class="font24">341</span></a></p>
<p><span class="font24">timeout(grub),</span><a href="#bookmark6532"><span class="font24"> 162</span></a></p>
<p><span class="font24">title(grub),</span><a href="#bookmark6534"><span class="font24"> 162</span></a></p>
<p><span class="font24">top,</span><a href="#bookmark6360"><span class="font24"> 11</span></a></p>
<p><span class="font24">top(1),</span><a href="#bookmark6321"><span class="font24"> 8</span></a><span class="font24">,</span><a href="#bookmark7030"><span class="font24"> 213</span></a><span class="font24">, </span><a href="#bookmark7042"><span class="font24">214</span></a><span class="font24">, </span><a href="#bookmark7093"><span class="font24">221</span></a></p>
<p><span class="font24">track, 32</span></p>
<p><span class="font24">tune2fs(1), 58, 62, 87</span></p>
<p><span class="font7" style="font-weight:bold;">U</span></p>
<p><span class="font24">udf, 59</span></p>
<p><span class="font24">udp, 262, 309</span></p>
<p><span class="font24">uefi, 52</span></p>
<p><span class="font24">uname(1), </span><a href="#bookmark7359"><span class="font24">326</span></a></p>
<p><span class="font24">universally unique identifier, 86</span></p>
<p><span class="font24">update-grub,</span><a href="#bookmark6584"><span class="font24"> 166</span></a></p>
<p><span class="font24">update-rc.d,</span><a href="#bookmark6676"><span class="font24"> 176</span></a></p>
<p><span class="font24">update-rc.d(8),</span><a href="#bookmark6692"><span class="font24"> 179</span></a></p>
<p><span class="font24">upstart,</span><a href="#bookmark6618"><span class="font24"> 170</span></a></p>
<p><span class="font24">usrquota,</span><a href="#bookmark7697"><span class="font24"> 362</span></a></p>
<p><span class="font24">uuid, 86</span></p>
<p><span class="font7" style="font-weight:bold;">V</span></p>
<p><span class="font24">vanilla,</span><a href="#bookmark7167"><span class="font24"> 228</span></a></p>
<p><span class="font24">vfat, 59</span></p>
<p><span class="font24">vgchange(1), 118</span></p>
<p><span class="font24">vgcreate(1), 103, 105, 117</span></p>
<p><span class="font24">vgdisplay(1), 113</span></p>
<p><span class="font24">vgextend(1), 117</span></p>
<p><span class="font24">vgmerge(1), 118</span></p>
<p><span class="font24">vgreduce(1), 117</span></p>
<p><span class="font24">vgremove(1), 117</span></p>
<p><span class="font24">vgs(1), 113</span></p>
<p><span class="font24">vgscan(1), 113</span></p></td></tr>
</table>
<p><span class="font24">vi,</span><a href="#bookmark7589"><span class="font24"> 349</span></a></p>
<p><span class="font24">virtual memory, </span><a href="#bookmark7033"><span class="font24">213</span></a><span class="font24"> vmlinuz,</span><a href="#bookmark7415"><span class="font24"> 333</span></a><span class="font24"> vmstat, 83,</span><a href="#bookmark7068"><span class="font24"> 217</span></a><span class="font24"> vmstat(1), </span><a href="#bookmark7102"><span class="font24">222</span></a><span class="font24"> vnc,</span><a href="#bookmark7713"><span class="font24"> 363</span></a></p>
<p><span class="font24">vncviewer(1),</span><a href="#bookmark7718"><span class="font24"> 363</span></a></p>
<p><span class="font24">vol_id(1), 87</span></p>
<p><span class="font7" style="font-weight:bold;">W</span></p>
<p><span class="font24">WAN, 260 watch(1), </span><a href="#bookmark6990"><span class="font24">208</span></a><span class="font24">,</span><a href="#bookmark7099"><span class="font24"> 222</span></a><span class="font24"> who(1),</span><a href="#bookmark6711"><span class="font24"> 181</span></a><span class="font24">,</span><a href="#bookmark6925"><span class="font24"> 202</span></a><span class="font24"> wireshark, 279, 297</span></p>
<p><span class="font24">WPAN, 260</span></p>
<p><span class="font7" style="font-weight:bold;">X</span></p>
<p><span class="font24">X.25, 260</span></p>
<p><span class="font24">x86,</span><a href="#bookmark6478"><span class="font24"> 158</span></a></p>
<p><span class="font24">xinetd, 317, 317 xstartup(vnc),</span><a href="#bookmark7719"><span class="font24"> 363</span></a></p>
<p><span class="font7" style="font-weight:bold;">Y</span></p>
<p><span class="font24">yaboot,</span><a href="#bookmark6508"><span class="font24"> 160</span></a></p>
<p><span class="font24">yum,</span><a href="#bookmark7581"><span class="font24"> 348</span></a></p>
<p><span class="font24">yum(8), </span><a href="#bookmark7269"><span class="font24">239</span></a></p>
<p><span class="font7" style="font-weight:bold;">Z</span></p>
<p><span class="font24">z/IPL,</span><a href="#bookmark6509"><span class="font24"> 160</span></a></p>
<p><span class="font24">zfs, 59</span></p>
<p><span class="font24">zImage,</span><a href="#bookmark6544"><span class="font24"> 163</span></a></p>
<p><span class="font24">zombie, </span><a href="#bookmark6288"><span class="font24">4</span></a></p>
<p><span class="font11" style="font-weight:bold;">Linux Servers</span></p>
<p><span class="font9" style="font-weight:bold;">Paul Cobbaut</span></p>
<p><span class="font7" style="font-weight:bold;">Linux Servers</span></p>
<p><span class="font24">Paul Cobbaut</span></p>
<p><span class="font24">Publication date 2015-05-24 CEST</span></p>
<p><span class="font4" style="font-weight:bold;">Abstract</span></p>
<p><span class="font25">This book is meant to be used in an instructor-led training. For self-study, the intent is to read this book next to a working Linux computer so you can immediately do every subject, practicing each command.</span></p>
<p><span class="font25">This book is aimed at novice Linux system administrators (and might be interesting and useful for home users that want to know a bit more about their Linux system). However, this book is not meant as an introduction to Linux desktop applications like text editors, browsers, mail clients, multimedia or office applications.</span></p>
<p><span class="font25">More information and free .pdf available at </span><a href="http://linux-training.be"><span class="font25" style="font-weight:bold;">http://linux-training.be</span></a><span class="font25" style="font-weight:bold;"> </span><span class="font25">.</span></p>
<p><span class="font25">Feel free to contact the author:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">• Paul Cobbaut: </span><a href="mailto:paul.cobbaut@gmail.com"><span class="font25">paul.cobbaut@gmail.com</span></a><span class="font25">, </span><a href="http://www.linkedin.com/in/cobbaut"><span class="font25">http://www.linkedin.com/in/cobbaut</span></a></p></li></ul>
<p><span class="font25">Contributors to the Linux Training project are:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">• Serge van Ginderachter: </span><a href="mailto:serge@ginsys.eu"><span class="font25">serge@ginsys.eu</span></a><span class="font25">, build scripts and infrastructure setup</span></p></li>
<li>
<p><span class="font25">• Ywein Van den Brande: </span><a href="mailto:ywein@crealaw.eu"><span class="font25">ywein@crealaw.eu</span></a><span class="font25">, license and legal sections</span></p></li>
<li>
<p><span class="font25">• Hendrik De Vloed: </span><a href="mailto:hendrik.devloed@ugent.be"><span class="font25">hendrik.devloed@ugent.be</span></a><span class="font25">, buildheader.pl script</span></p></li></ul>
<p><span class="font25">We'd also like to thank our reviewers:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">• Wouter Verhelst: </span><a href="mailto:wo@uter.be"><span class="font25">wo@uter.be</span></a><span class="font25">, </span><a href="http://grep.be"><span class="font25">http://grep.be</span></a></p></li>
<li>
<p><span class="font25">• Geert Goossens: </span><a href="mailto:mail.goossens.geert@gmail.com"><span class="font25">mail.goossens.geert@gmail.com</span></a><span class="font25">, </span><a href="http://www.linkedin.com/in/"><span class="font25">http://www.linkedin.com/in/</span></a><span class="font25"> geertgoossens</span></p></li>
<li>
<p><span class="font25">• Elie De Brauwer: </span><a href="mailto:elie@de-brauwer.be"><span class="font25">elie@de-brauwer.be</span></a><span class="font25">, </span><a href="http://www.de-brauwer.be"><span class="font25">http://www.de-brauwer.be</span></a></p></li>
<li>
<p><span class="font25">• Christophe Vandeplas: </span><a href="mailto:christophe@vandeplas.com"><span class="font25">christophe@vandeplas.com</span></a><span class="font25">, </span><a href="http://christophe.vandeplas.com"><span class="font25">http://christophe.vandeplas.com</span></a></p></li>
<li>
<p><span class="font25">• Bert Desmet: </span><a href="mailto:bert@devnox.be"><span class="font25">bert@devnox.be</span></a><span class="font25">, </span><a href="http://blog.bdesmet.be"><span class="font25">http://blog.bdesmet.be</span></a></p></li>
<li>
<p><span class="font25">• Rich Yonts: </span><a href="mailto:richyonts@gmail.com"><span class="font25">richyonts@gmail.com</span></a><span class="font25">,</span></p></li></ul>
<p><span class="font25">Copyright 2007-2015 Paul Cobbaut</span></p>
<p><span class="font25">Permission is granted to copy, distribute and/or modify this document under the terms of the </span><span class="font25" style="font-weight:bold;">GNU Free Documentation License</span><span class="font25">, Version 1.3 or any later version published by the Free Software Foundation; with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts. A copy of the license is included in the section entitled 'GNU Free Documentation License'.</span></p>
<h3><a name="bookmark7732"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7733"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7734"><span class="font24">I. apache and squid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7735"><span class="font24" style="font-weight:bold;">1. apache web server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7736"><span class="font24">1.1. introduction to apache </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7737"><span class="font24">1.2. port virtual hosts on Debian </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7738"><span class="font24">1.3. named virtual hosts on Debian </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7739"><span class="font24">1.4. password protected website on Debian </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7740"><span class="font24">1.5. port virtual hosts on CentOS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7741"><span class="font24">1.6. named virtual hosts on CentOS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7742"><span class="font24">1.7. password protected website on CentOS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7743"><span class="font24">1.8. troubleshooting apache </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7744"><span class="font24">1.9. virtual hosts example </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7745"><span class="font24">1.10. aliases and redirects </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7746"><span class="font24">1.11. more on .htaccess </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7747"><span class="font24">1.12. traffic </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7748"><span class="font24">1.13. self signed cert on Debian </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7749"><span class="font24">1.14. self signed cert on RHEL/CentOS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7750"><span class="font24">1.15. practice: apache </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7751"><span class="font24" style="font-weight:bold;">2. introduction to squid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7752"><span class="font24">2.1. about proxy servers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7753"><span class="font24">2.2. installing squid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7754"><span class="font24">2.3. port 3128 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7755"><span class="font24">2.4. starting and stopping </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7756"><span class="font24">2.5. client proxy settings </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7757"><span class="font24">2.6. upside down images </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7758"><span class="font24">2.7. /var/log/squid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7759"><span class="font24">2.8. access control </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7760"><span class="font24">2.9. testing squid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7761"><span class="font24">2.10. name resolution </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7762"><span class="font24">II. mysql database </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7763"><span class="font24" style="font-weight:bold;">3. introduction to sql using mysql </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7764"><span class="font24">3.1. installing mysql </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7765"><span class="font24">3.2. accessing mysql </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7766"><span class="font24">3.3. mysql databases </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7767"><span class="font24">3.4. mysql tables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7768"><span class="font24">3.5. mysql records </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7769"><span class="font24">3.6. joining two tables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7770"><span class="font24">3.7. mysql triggers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7771"><span class="font24" style="font-weight:bold;">III. dns server </span><span class="font24">[</span><span class="font24" style="font-weight:bold;">REMOVED - CHECK SECTION - 3</span><span class="font24">]</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7772"><span class="font24" style="font-weight:bold;">4. introduction to DNS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark2966"><span class="font24">4.1. about dns </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7773"><span class="font24">4.2. dns namespace </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7774"><span class="font24">4.3. caching only servers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7775"><span class="font24">4.4. authoritative dns servers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7776"><span class="font24">4.5. primary and secondary </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7777"><span class="font24">4.6. zone transfers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7778"><span class="font24">4.7. master and slave </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7779"><span class="font24">4.8. SOA record </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7780"><span class="font24">4.9. full or incremental zone transfers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7781"><span class="font24">4.10. DNS cache </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7782"><span class="font24">4.11. forward lookup zone example </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7783"><span class="font24">4.12. example: caching only DNS server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7784"><span class="font24">4.13. example: caching only with forwarder </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7785"><span class="font24">4.14. example: primary authoritative server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7786"><span class="font24">4.15. example: a DNS slave server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7787"><span class="font24">4.16. practice: dns </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7788"><span class="font24">4.17. solution: dns </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7789"><span class="font24" style="font-weight:bold;">5. advanced DNS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7790"><span class="font24">5.1. example: DNS round robin </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7791"><span class="font24">5.2. DNS delegation </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7792"><span class="font24">5.3. example: DNS delegation </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7793"><span class="font24">5.4. example: split-horizon dns </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7794"><span class="font24">5.5. old dns topics </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7795"><span class="font24" style="font-weight:bold;">IV. dhcp server </span><span class="font24">[</span><span class="font24" style="font-weight:bold;">REMOVED - CHECK SECTION - 3</span><span class="font24">]</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7796"><span class="font24" style="font-weight:bold;">6. introduction to dhcp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7797"><span class="font24">6.1. four broadcasts </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7798"><span class="font24">6.2. picturing dhcp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7799"><span class="font24">6.3. installing a dhcp server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7800"><span class="font24">6.4. dhcp server for RHEL/CentOS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7801"><span class="font24">6.5. client reservations </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7802"><span class="font24">6.6. example config files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7803"><span class="font24">6.7. older example config files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7804"><span class="font24">6.8. advanced dhcp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7805"><span class="font24">6.9. Practice: dhcp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7806"><span class="font24" style="font-weight:bold;">V. iptables firewall </span><span class="font24">[</span><span class="font24" style="font-weight:bold;">REMOVED - CHECK SECTION - 3</span><span class="font24">]</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7807"><span class="font24" style="font-weight:bold;">7. introduction to routers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7808"><span class="font24">7.1. router or firewall </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7809"><span class="font24">7.2. packet forwarding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7810"><span class="font24">7.3. packet filtering </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7811"><span class="font24">7.4. stateful </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7812"><span class="font24">7.5. nat (network address translation) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7813"><span class="font24">7.6. pat (port address translation) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7814"><span class="font24">7.7. snat (source nat) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7815"><span class="font24">7.8. masquerading </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7816"><span class="font24">7.9. dnat (destination nat) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7817"><span class="font24">7.10. port forwarding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7818"><span class="font24">7.11. /proc/sys/net/ipv4/ip_forward </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7819"><span class="font24">7.12. /etc/sysctl.conf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7820"><span class="font24">7.13. sysctl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7821"><span class="font24">7.14. practice: packet forwarding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7822"><span class="font24">7.15. solution: packet forwarding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7823"><span class="font24" style="font-weight:bold;">8. iptables firewall </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7824"><span class="font24">8.1. iptables tables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7825"><span class="font24">8.2. starting and stopping iptables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7826"><span class="font24">8.3. the filter table </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7827"><span class="font24">8.4. practice: packet filtering </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7828"><span class="font24">8.5. solution: packet filtering </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7829"><span class="font24">8.6. network address translation </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7830"><span class="font24">VI. Introduction to Samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7831"><span class="font24" style="font-weight:bold;">9. introduction to samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7832"><span class="font24">9.1. verify installed version </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7833"><span class="font24">9.2. installing samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7834"><span class="font24">9.3. documentation </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7835"><span class="font24">9.4. starting and stopping samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7836"><span class="font24">9.5. samba daemons </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7837"><span class="font24">9.6. the SMB protocol </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7838"><span class="font24">9.7. practice: introduction to samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7839"><span class="font24" style="font-weight:bold;">10. getting started with samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7840"><span class="font24">10.1. /etc/samba/smb.conf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7841"><span class="font24">10.2. /usr/bin/testparm </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7842"><span class="font24">10.3. /usr/bin/smbclient </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7843"><span class="font24">10.4. /usr/bin/smbtree </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7844"><span class="font24">10.5. server string </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7845"><span class="font24">10.6. Samba Web Administration Tool (SWAT) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7846"><span class="font24">10.7. practice: getting started with samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7847"><span class="font24">10.8. solution: getting started with samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7848"><span class="font24" style="font-weight:bold;">11. a read only file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7849"><span class="font24">11.1. Setting up a directory to share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7850"><span class="font24">11.2. configure the share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7851"><span class="font24">11.3. restart the server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7852"><span class="font24">11.4. verify the share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7853"><span class="font24">11.5. a note on netcat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7854"><span class="font24">11.6. practice: read only file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7855"><span class="font24">11.7. solution: read only file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7856"><span class="font24" style="font-weight:bold;">12. a writable file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7857"><span class="font24">12.1. set up a directory to share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7858"><span class="font24">12.2. share section in smb.conf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7859"><span class="font24">12.3. configure the share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7860"><span class="font24">12.4. test connection with windows </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7861"><span class="font24">12.5. test writing with windows </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7862"><span class="font24">12.6. How is this possible ? </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7863"><span class="font24">12.7. practice: writable file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7864"><span class="font24">12.8. solution: writable file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7865"><span class="font24" style="font-weight:bold;">13. samba first user account </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7866"><span class="font24">13.1. creating a samba user </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7867"><span class="font24">13.2. ownership of files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7868"><span class="font24">13.3. /usr/bin/smbpasswd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7869"><span class="font24">13.4. /etc/samba/smbpasswd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7870"><span class="font24">13.5. passdb backend </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7871"><span class="font24">13.6. forcing this user </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7872"><span class="font24">13.7. practice: first samba user account </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7873"><span class="font24">13.8. solution: first samba user account </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7874"><span class="font24" style="font-weight:bold;">14. samba authentication </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7875"><span class="font24">14.1. creating the users on Linux </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7876"><span class="font24">14.2. creating the users on samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7877"><span class="font24">14.3. security = user </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7878"><span class="font24">14.4. configuring the share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7879"><span class="font24">14.5. testing access with net use </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7880"><span class="font24">14.6. testing access with smbclient </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7881"><span class="font24">14.7. verify ownership </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7882"><span class="font24">14.8. common problems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7883"><span class="font24">14.9. practice : samba authentication </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7884"><span class="font24">14.10. solution: samba authentication </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7885"><span class="font24" style="font-weight:bold;">15. samba securing shares </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7886"><span class="font24">15.1. security based on user name </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7887"><span class="font24">15.2. security based on ip-address </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7888"><span class="font24">15.3. security through obscurity </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7889"><span class="font24">15.4. file system security </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7890"><span class="font24">15.5. practice: securing shares </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7891"><span class="font24">15.6. solution: securing shares </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7892"><span class="font24" style="font-weight:bold;">16. samba domain member </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7893"><span class="font24">16.1. changes in smb.conf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7894"><span class="font24">16.2. joining an Active Directory domain </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7895"><span class="font24">16.3. winbind </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7896"><span class="font24">16.4. wbinfo </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7897"><span class="font24">16.5. getent </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7898"><span class="font24">16.6. file ownership </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7899"><span class="font24">16.7. practice : samba domain member </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7900"><span class="font24" style="font-weight:bold;">17. samba domain controller </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7901"><span class="font24">17.1. about Domain Controllers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7902"><span class="font24">17.2. About security modes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7903"><span class="font24">17.3. About password backends </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7904"><span class="font24">17.4. [global] section in smb.conf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7905"><span class="font24">17.5. netlogon share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7906"><span class="font24">17.6. other [share] sections </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7907"><span class="font24">17.7. Users and Groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7908"><span class="font24">17.8. tdbsam </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7909"><span class="font24">17.9. about computer accounts </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7910"><span class="font24">17.10. local or roaming profiles </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7911"><span class="font24">17.11. Groups in NTFS acls </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7912"><span class="font24">17.12. logon scripts </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7913"><span class="font24">17.13. practice: samba domain controller </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7914"><span class="font24" style="font-weight:bold;">18. a brief look at samba 4 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7915"><span class="font24">18.1. Samba 4 alpha 6 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7916"><span class="font24" style="font-weight:bold;">VII. selinux </span><span class="font24">[</span><span class="font24" style="font-weight:bold;">REMOVED - CHECK SECTION - 6</span><span class="font24">]</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7917"><span class="font24" style="font-weight:bold;">19. introduction to SELinux </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7918"><span class="font24">19.1. selinux modes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7919"><span class="font24">19.2. logging </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7920"><span class="font24">19.3. activating selinux </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7921"><span class="font24">19.4. getenforce </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7922"><span class="font24">19.5. setenforce </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7923"><span class="font24">19.6. sestatus </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7924"><span class="font24">19.7. policy </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7925"><span class="font24">19.8. /etc/selinux/config </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7926"><span class="font24">19.9. DAC or MAC </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7927"><span class="font24">19.10. ls -Z </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7928"><span class="font24">19.11. -Z </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7929"><span class="font24">19.12. /selinux </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7930"><span class="font24">19.13. identity </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7931"><span class="font24">19.14. role </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7932"><span class="font24">19.15. type (or domain) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7933"><span class="font24">19.16. security context </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7934"><span class="font24">19.17. transition </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7935"><span class="font24">19.18. extended attributes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7936"><span class="font24">19.19. process security context </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7937"><span class="font24">19.20. chcon </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7938"><span class="font24">19.21. an example </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7939"><span class="font24">19.22. setroubleshoot </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7940"><span class="font24">19.23. booleans </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7941"><span class="font24">VIII. introducing git </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7942"><span class="font24" style="font-weight:bold;">20. git </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7943"><span class="font24">20.1. git </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7944"><span class="font24">20.2. installing git </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7945"><span class="font24">20.3. starting a project </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7946"><span class="font24">20.4. git branches </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7947"><span class="font24">20.5. to be continued</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7948"><span class="font24">20.6. github.com </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7949"><span class="font24">20.7. add your public key to github </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7950"><span class="font24">20.8. practice: git </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7951"><span class="font24" style="font-weight:bold;">IX. ipv6 </span><span class="font24">[</span><span class="font24" style="font-weight:bold;">REMOVED - CHECK SECTION - 3</span><span class="font24">]</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7952"><span class="font24" style="font-weight:bold;">21. Introduction to ipv6 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7953"><span class="font24">21.1. about ipv6 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7954"><span class="font24">21.2. network id and host id </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7955"><span class="font24">21.3. host part generation </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7956"><span class="font24">21.4. ipv4 mapped ipv6 address </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7957"><span class="font24">21.5. link local addresses </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7958"><span class="font24">21.6. unique local addresses </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7959"><span class="font24">21.7. globally unique unicast addresses </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7960"><span class="font24">21.8. 6to4 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7961"><span class="font24">21.9. ISP </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7962"><span class="font24">21.10. non routable addresses </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7963"><span class="font24">21.11. ping6 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7964"><span class="font24">21.12. Belgium and ipv6 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7965"><span class="font24">21.13. other websites </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7966"><span class="font24">21.14. 6to4 gateways </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7967"><span class="font24">21.15. ping6 and dns </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7968"><span class="font24">21.16. ipv6 and tcp/http </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7969"><span class="font24">21.17. ipv6 PTR record </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7970"><span class="font24">21.18. 6to4 setup on Linux </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7971"><span class="font24">X. Appendices </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7972"><span class="font24" style="font-weight:bold;">A. cloning </span></a></p></li></ul>
<p><a href="#bookmark7973"><span class="font24">A.1. About cloning </span></a></p>
<p><a href="#bookmark7974"><span class="font24">A.2. About offline cloning </span></a></p>
<p><a href="#bookmark7975"><span class="font24">A.3. Offline cloning example </span></a></p>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7976"><span class="font24" style="font-weight:bold;">B. License </span></a></p></li></ul>
<p><a href="#bookmark7977"><span class="font24">Index </span></a></p>
<h3><a name="bookmark7978"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7979"></a>List of Tables</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7980"><span class="font24">4.1. the first top level domains </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7981"><span class="font24">4.2. new general purpose tld's </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7982"><span class="font24">7.1. Packet Forwarding Exercise </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7983"><span class="font24">7.2. Packet Forwarding Solution </span></a></p></li></ul>
<p><a name="bookmark7984"></a><span class="font11" style="font-weight:bold;">Part I. apache and squid</span></p>
<h3><a name="bookmark7985"></a><span class="font9" style="font-weight:bold;"><a name="bookmark7986"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7987"><span class="font24" style="font-weight:bold;">1. apache web server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7988"><span class="font24">1.1. introduction to apache </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7989"><span class="font24">1.2. port virtual hosts on Debian </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7990"><span class="font24">1.3. named virtual hosts on Debian </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7991"><span class="font24">1.4. password protected website on Debian </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7992"><span class="font24">1.5. port virtual hosts on CentOS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7993"><span class="font24">1.6. named virtual hosts on CentOS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7994"><span class="font24">1.7. password protected website on CentOS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7995"><span class="font24">1.8. troubleshooting apache </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7996"><span class="font24">1.9. virtual hosts example </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7997"><span class="font24">1.10. aliases and redirects </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7998"><span class="font24">1.11. more on .htaccess </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark7999"><span class="font24">1.12. traffic </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8000"><span class="font24">1.13. self signed cert on Debian </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8001"><span class="font24">1.14. self signed cert on RHEL/CentOS </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8002"><span class="font24">1.15. practice: apache </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8003"><span class="font24" style="font-weight:bold;">2. introduction to squid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8004"><span class="font24">2.1. about proxy servers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8005"><span class="font24">2.2. installing squid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8006"><span class="font24">2.3. port 3128 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8007"><span class="font24">2.4. starting and stopping </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8008"><span class="font24">2.5. client proxy settings </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8009"><span class="font24">2.6. upside down images </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8010"><span class="font24">2.7. /var/log/squid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8011"><span class="font24">2.8. access control </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8012"><span class="font24">2.9. testing squid </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8013"><span class="font24">2.10. name resolution </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark8014"></a><span class="font11" style="font-weight:bold;"><a name="bookmark7735"></a><a name="bookmark8015"></a>Chapter 1. apache web server</span></h1></li></ul>
<p><span class="font25">In this chapter we learn how to setup a web server with the </span><span class="font25" style="font-weight:bold;">apache </span><span class="font25">software.</span></p>
<p><span class="font25">According to NetCraft (</span><a href="http://news.netcraft.com/archives/web_server_survey.html"><span class="font25">http://news.netcraft.com/archives/web_server_survey.html</span></a><span class="font25">) about seventy percent of all web servers are running on Apache. The name is derived from </span><span class="font25" style="font-weight:bold;">a patchy </span><span class="font25">web server, because of all the patches people wrote for the NCSA httpd server.</span></p>
<p><span class="font25">Later chapters will expand this web server into a LAMP stack (Linux, Apache, Mysql, Perl/ PHP/Python).</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8016"></a><span class="font10" style="font-weight:bold;"><a name="bookmark5964"></a><a name="bookmark8017"></a>1.1. introduction to apache</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark529"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8018"></a>1.1.1. installing on Debian</span></h3></li></ul></li></ul>
<h4><a name="bookmark8019"></a><span class="font25"><a name="bookmark8020"></a>This screenshot shows that there is no </span><span class="font25" style="font-weight:bold;">apache </span><span class="font25">server installed, nor does the </span><span class="font25" style="font-weight:bold;">/var/www </span><span class="font25">directory exist.</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">ls -l /var/www</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">ls: cannot access /var/www: No such file or directory</span></p></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">dpkg -l | grep apache</span></p>
<h4><a name="bookmark8021"></a><span class="font25"><a name="bookmark8022"></a>To install </span><span class="font25" style="font-weight:bold;">apache </span><span class="font25">on Debian:</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">aptitude install apache2</span></p>
<p><span class="font19">The following NEW packages will be installed:</span></p>
<p><span class="font19">apache2 apache2-mpm-worker{a} apache2-utils{a} apache2.2-bin{a} apache2.2-com\ mon{a} libapr1{a} libaprutil1{a} libaprutil1-dbd-sqlite3{a} libaprutil1-ldap{a}\</span></p>
<p><span class="font19">ssl-cert{a}</span></p>
<p><span class="font19">0 packages upgraded, 10 newly installed, 0 to remove and 0 not upgraded.</span></p>
<p><span class="font19">Need to get 1,487 kB of archives. After unpacking 5,673 kB will be used.</span></p>
<p><span class="font19">Do you want to continue? [Y/n/?]</span></p>
<h4><a name="bookmark8023"></a><span class="font25"><a name="bookmark8024"></a>After installation, the same two commands as above will yield a different result:</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">ls -l /var/www </span><span class="font19">total 4</span></p>
<p><span class="font19">-rw-r--r-- 1 root root 177 Apr 29 11:55 index.html</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">dpkg -l | grep apache | tr -s ' '</span></p>
<p><span class="font19">ii apache2 2.2.22-13+deb7u1 amd64 Apache HTTP Server metapackage</span></p>
<p><span class="font19">ii apache2-mpm-worker 2.2.22-13+deb7u1 amd64 Apache HTTP Server - high speed th\ readed model</span></p>
<p><span class="font19">ii apache2-utils 2.2.22-13+deb7u1 amd64 utility programs for webservers</span></p>
<p><span class="font19">ii apache2.2-bin 2.2.22-13+deb7u1 amd64 Apache HTTP Server common binary files</span></p>
<p><span class="font19">ii apache2.2-common 2.2.22-13+deb7u1 amd64 Apache HTTP Server common files</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8025"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8026"></a>1.1.2. installing on RHEL/CentOS</span></h3></li></ul>
<h4><a name="bookmark8027"></a><span class="font25"><a name="bookmark8028"></a>Note that Red Hat derived distributions use </span><span class="font25" style="font-weight:bold;">httpd </span><span class="font25">as package and process name instead of </span><span class="font25" style="font-weight:bold;">apache</span><span class="font25">.</span></h4>
<h4><a name="bookmark8029"></a><span class="font25"><a name="bookmark8030"></a>To verify whether </span><span class="font25" style="font-weight:bold;">apache </span><span class="font25">is installed in CentOS/RHEL:</span></h4>
<p><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">rpm -q httpd</span></p>
<p><span class="font19">package httpd is not installed [root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">ls -l /var/www </span><span class="font19">ls: cannot access /var/www: No such file or directory</span></p>
<h4><a name="bookmark8031"></a><span class="font25"><a name="bookmark8032"></a>To install apache on CentOS:</span></h4>
<p><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">yum install httpd</span></p>
<h4><a name="bookmark8033"></a><span class="font25"><a name="bookmark8034"></a>After running the </span><span class="font25" style="font-weight:bold;">yum install httpd </span><span class="font25">command, the Centos 6.5 server has apache installed and the </span><span class="font25" style="font-weight:bold;">/var/www </span><span class="font25">directory exists.</span></h4>
<p><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">rpm -q httpd </span><span class="font19">httpd-2.2.15-30.el6.centos.x86_64 [root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">ls -l /var/www </span><span class="font19">total 16</span></p>
<p><span class="font19">drwxr-xr-x. 2 root root 4096 Apr &nbsp;3 23:57 cgi-bin</span></p>
<p><span class="font19">drwxr-xr-x. 3 root root 4096 May &nbsp;6 13:08 error</span></p>
<p><span class="font19">drwxr-xr-x. 2 root root 4096 Apr &nbsp;3 23:57 html</span></p>
<p><span class="font19">drwxr-xr-x. 3 root root 4096 May &nbsp;6 13:08 icons</span></p>
<p><span class="font19">[root@centos65 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8035"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8036"></a>1.1.3. running apache on Debian</span></h3></li></ul>
<h4><a name="bookmark8037"></a><span class="font25"><a name="bookmark8038"></a><a name="bookmark8039"></a>This is how you start </span><span class="font25" style="font-weight:bold;">apache2 </span><span class="font25">on Debian.</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">service apache2 status</span></p>
<p><span class="font19">Apache2 is NOT running.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">service apache2 start</span></p>
<p><span class="font19">Starting web server: apache2apache2: Could not reliably determine the server's \ fully qualified domain name, using 127.0.1.1 for ServerName</span></p>
<h4><a name="bookmark8040"></a><span class="font25"><a name="bookmark8041"></a>To verify, run the </span><span class="font25" style="font-weight:bold;">service apache2 status </span><span class="font25">command again or use </span><span class="font25" style="font-weight:bold;">ps</span><span class="font25">.</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">root@debian7:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~# </span><span class="font19" style="font-weight:bold;">service</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19" style="font-weight:bold;">apache2 status</span></p></td></tr>
<tr><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">Apache2 is running (pid</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3680).</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">root@debian7:</span></p></td><td colspan="2" style="vertical-align:top;">
<p><span class="font19">~# </span><span class="font19" style="font-weight:bold;">ps -C apache2</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">PID TTY</span></p></td><td style="vertical-align:top;">
<p><span class="font19">TIME</span></p></td><td style="vertical-align:top;">
<p><span class="font19">CMD</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">3680 ?</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">apache2</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">3683 ?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">apache2</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">3684 ?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">apache2</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">3685 ?</span></p>
<p><span class="font19">root@debian7:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00 ~#</span></p></td><td style="vertical-align:top;">
<p><span class="font19">apache2</span></p></td></tr>
</table>
<h4><a name="bookmark8042"></a><span class="font25"><a name="bookmark8043"></a>Or use </span><span class="font25" style="font-weight:bold;">wget </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">file </span><span class="font25">to verify that your web server serves an html document.</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">wget 127.0.0.1</span></p>
<p><span class="font19">--2014-05-06 13:27:02-- &nbsp;</span><a href="http://127.0.0.1/"><span class="font19">http://127.0.0.1/</span></a></p>
<p><span class="font19">Connecting to 127.0.0.1:80... connected.</span></p>
<p><span class="font19">HTTP request sent, awaiting response... 200 OK</span></p>
<p><span class="font19">Length: 177 [text/html]</span></p>
<p><span class="font19">Saving to: 'index.html'</span></p>
<p><span class="font19">100%[==================================================&gt;] 177 &nbsp;&nbsp;&nbsp;--.-K/s in 0s</span></p>
<p><span class="font19">2014-05-06 13:27:02 (15.8 MB/s) - 'index.html' saved [177/177]</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">file index.html </span><span class="font19">index.html: HTML document, ASCII text root@debian7:~#</span></p>
<h4><a name="bookmark8044"></a><span class="font25"><a name="bookmark8045"></a>Or verify that apache is running by opening a web browser, and browse to the ip-address of your server. An Apache test page should be shown.</span></h4>
<h4><a name="bookmark8046"></a><span class="font25"><a name="bookmark8047"></a>You can do the following to quickly avoid the 'could not reliably determine the fqdn' message when restarting apache.</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">echo ServerName Debian7 &gt;&gt;&nbsp;/etc/apache2/apache2.conf </span><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">service apache2 restart</span></p>
<p><span class="font19">Restarting web server: apache2 ... waiting .</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8048"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8049"></a>1.1.4. running apache on CentOS</span></h3></li></ul>
<h4><a name="bookmark8050"></a><span class="font25"><a name="bookmark8051"></a><a name="bookmark8052"></a>Starting the </span><span class="font25" style="font-weight:bold;">httpd </span><span class="font25">on RHEL/CentOS is done with the </span><span class="font25" style="font-weight:bold;">service </span><span class="font25">command.</span></h4>
<p><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">service httpd status</span></p>
<p><span class="font19">httpd is stopped</span></p>
<p><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">service httpd start</span></p>
<p><span class="font19">Starting httpd: httpd: Could not reliably determine the server's fully qualifie\ d domain name, using 127.0.0.1 for ServerName</span></p>
<p><span class="font19">[ OK ] [root@centos65 ~]#</span></p>
<h4><a name="bookmark8053"></a><span class="font25"><a name="bookmark8054"></a>To verify that </span><span class="font25" style="font-weight:bold;">apache </span><span class="font25">is running, use </span><span class="font25" style="font-weight:bold;">ps </span><span class="font25">or issue the </span><span class="font25" style="font-weight:bold;">service httpd status </span><span class="font25">command again.</span></h4>
<p><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">service httpd status </span><span class="font19">httpd (pid 2410) is running...</span></p>
<table border="1">
<tr><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">[root@centos65</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">~]# </span><span class="font19" style="font-weight:bold;">ps -C httpd</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">PID</span></p></td><td style="vertical-align:top;">
<p><span class="font19">TTY</span></p></td><td style="vertical-align:top;">
<p><span class="font19">TIME</span></p></td><td style="vertical-align:top;">
<p><span class="font19">CMD</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2410</span></p></td><td style="vertical-align:top;">
<p><span class="font19">?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">httpd</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2412</span></p></td><td style="vertical-align:top;">
<p><span class="font19">?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">httpd</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2413</span></p></td><td style="vertical-align:top;">
<p><span class="font19">?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">httpd</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2414</span></p></td><td style="vertical-align:top;">
<p><span class="font19">?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">httpd</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2415</span></p></td><td style="vertical-align:top;">
<p><span class="font19">?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">httpd</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2416</span></p></td><td style="vertical-align:top;">
<p><span class="font19">?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">httpd</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2417</span></p></td><td style="vertical-align:top;">
<p><span class="font19">?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">httpd</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">2418</span></p></td><td style="vertical-align:top;">
<p><span class="font19">?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">httpd</span></p></td></tr>
<tr><td colspan="2" style="vertical-align:top;">
<p><span class="font19">2419 ?</span></p>
<p><span class="font19">[root@centos65</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p>
<p><span class="font19">~]#</span></p></td><td style="vertical-align:top;">
<p><span class="font19">httpd</span></p></td></tr>
</table>
<h4><a name="bookmark8055"></a><span class="font25"><a name="bookmark8056"></a>To prevent the 'Could not reliably determine the fqdn' message, issue the following command.</span></h4>
<p><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">echo ServerName Centos65 &gt;&gt;&nbsp;/etc/httpd/conf/httpd.conf </span><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">service httpd restart</span></p>
<p><span class="font19">Stopping httpd: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p>
<p><span class="font19">Starting httpd: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p>
<p><span class="font19">[root@centos65 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8057"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8058"></a>1.1.5. index file on CentOS</span></h3></li></ul>
<h4><a name="bookmark8059"></a><span class="font25"><a name="bookmark8060"></a>CentOS does not provide a standard index.html or index.php file. A simple </span><span class="font25" style="font-weight:bold;">wget </span><span class="font25">gives an error.</span></h4>
<p><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">wget 127.0.0.1</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- -2014-05-06 15:10:22-- &nbsp;</span><a href="http://127.0.0.1/"><span class="font19">http://127.0.0.1/</span></a></p></li></ul>
<p><span class="font19">Connecting to 127.0.0.1:80... connected.</span></p>
<p><span class="font19">HTTP request sent, awaiting response... 403 Forbidden</span></p>
<p><span class="font19">2014-05-06 15:10:22 ERROR 403: Forbidden.</span></p>
<h4><a name="bookmark8061"></a><span class="font25"><a name="bookmark8062"></a>Instead when visiting the ip-address of your server in a web browser you get a </span><span class="font25" style="font-weight:bold;">noindex.html </span><span class="font25">page. You can verify this using </span><span class="font25" style="font-weight:bold;">wget</span><span class="font25">.</span></h4>
<p><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">wget </span><a href="http://127.0.0.1/error/noindex.html"><span class="font19" style="font-weight:bold;">http://127.0.0.1/error/noindex.html</span></a></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- -2014-05-06 15:16:05-- </span><a href="http://127.0.0.1/error/noindex.html"><span class="font19">http://127.0.0.1/error/noindex.html</span></a></p></li></ul>
<p><span class="font19">Connecting to 127.0.0.1:80... connected.</span></p>
<p><span class="font19">HTTP request sent, awaiting response... 200 OK</span></p>
<p><span class="font19">Length: 5039 (4.9K) [text/html]</span></p>
<p><span class="font19">Saving to: “noindex.html”</span></p>
<p><span class="font19">100%[=============================================&gt;] 5,039 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--.-K/s in 0s</span></p>
<p><span class="font19">2014-05-06 15:16:05 (289 MB/s) - “noindex.html” saved [5039/5039]</span></p>
<p><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">file noindex.html</span></p>
<p><span class="font19">noindex.html: HTML document text [root@centos65 ~]#</span></p>
<h4><a name="bookmark8063"></a><span class="font25"><a name="bookmark8064"></a>Any custom </span><span class="font25" style="font-weight:bold;">index.html </span><span class="font25">file in </span><span class="font25" style="font-weight:bold;">/var/www/html </span><span class="font25">will immediately serve as an index for this web server.</span></h4>
<p><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">echo 'Welcome to my website' &gt;&nbsp;/var/www/html/index.html </span><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">wget </span><a href="http://127.0.0.1"><span class="font19" style="font-weight:bold;">http://127.0.0.1</span></a></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- -2014-05-06 15:19:16-- &nbsp;</span><a href="http://127.0.0.1/"><span class="font19">http://127.0.0.1/</span></a></p></li></ul>
<p><span class="font19">Connecting to 127.0.0.1:80... connected.</span></p>
<p><span class="font19">HTTP request sent, awaiting response... 200 OK</span></p>
<p><span class="font19">Length: 22 [text/html]</span></p>
<p><span class="font19">Saving to: “index.html”</span></p>
<p><span class="font19">100%[=============================================&gt;] 22 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--.-K/s in 0s</span></p>
<p><span class="font19">2014-05-06 15:19:16 (1.95 MB/s) - “index.html” saved [22/22]</span></p>
<p><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">cat index.html</span></p>
<p><span class="font19">Welcome to my website</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8065"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8066"></a>1.1.6. default website</span></h3></li></ul>
<h4><a name="bookmark8067"></a><span class="font25"><a name="bookmark8068"></a>Changing the default website of a freshly installed apache web server is easy. All you need to do is create (or change) an index.html file in the DocumentRoot directory.</span></h4>
<h4><a name="bookmark8069"></a><span class="font25"><a name="bookmark8070"></a>To locate the DocumentRoot directory on Debian:</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep DocumentRoot /etc/apache2/sites-available/default </span><span class="font19">DocumentRoot /var/www</span></p>
<h4><a name="bookmark8071"></a><span class="font25"><a name="bookmark8072"></a>This means that </span><span class="font25" style="font-weight:bold;">/var/www/index.html </span><span class="font25">is the default web site.</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">cat /var/www/index.html</span></p>
<p><span class="font19">&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;</span></p>
<p><span class="font19">&lt;p&gt;This is the default web page for this server.&lt;/p&gt;</span></p>
<p><span class="font19">&lt;p&gt;The web server software is running but no content has been added, yet.&lt;/p&gt;</span></p>
<p><span class="font19">&lt;/body&gt;&lt;/html&gt;</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<h4><a name="bookmark8073"></a><span class="font25"><a name="bookmark8074"></a>This screenshot shows how to locate the </span><span class="font25" style="font-weight:bold;">DocumentRoot </span><span class="font25">directory on RHEL/CentOS.</span></h4>
<p><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">grep ^DocumentRoot /etc/httpd/conf/httpd.conf </span><span class="font19">DocumentRoot &quot;/var/www/html&quot;</span></p>
<h4><a name="bookmark8075"></a><span class="font25"><a name="bookmark8076"></a>RHEL/CentOS have no default web page (only the noindex.html error page mentioned before). But an </span><span class="font25" style="font-weight:bold;">index.html </span><span class="font25">file created in </span><span class="font25" style="font-weight:bold;">/var/www/html/ </span><span class="font25">will automatically be used as default page.</span></h4>
<p><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">echo '&lt;html&gt;&lt;head&gt;&lt;title&gt;Default website&lt;/title&gt;&lt;/head&gt;&lt;body\ &gt;&lt;p&gt;A new web page&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;' &gt;&nbsp;/var/www/html/index.html </span><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">cat /var/www/html/index.html</span></p>
<p><span class="font19">&lt;html&gt;&lt;head&gt;&lt;title&gt;Default website&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;p&gt;A new web page&lt;/p&gt;&lt;/b\ ody&gt;&lt;/html&gt;</span></p>
<p><span class="font19">[root@centos65 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8077"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8078"></a>1.1.7. apache configuration</span></h3></li></ul>
<h4><a name="bookmark8079"></a><span class="font25"><a name="bookmark8080"></a>There are many similarities, but also a couple of differences when configuring </span><span class="font25" style="font-weight:bold;">apache </span><span class="font25">on Debian or on CentOS. Both Linux families will get their own chapters with examples.</span></h4>
<h4><a name="bookmark8081"></a><span class="font25"><a name="bookmark8082"></a><a name="bookmark8083"></a>All configuration on RHEL/CentOS is done in </span><span class="font25" style="font-weight:bold;">/etc/httpd</span><span class="font25">.</span></h4>
<p><span class="font19">[root@centos65 ~]# ls -l /etc/httpd/ total 8</span></p>
<div>
<p><span class="font19">drwxr-xr-x. 2 root root 4096 May drwxr-xr-x. 2 root root 4096 May lrwxrwxrwx. 1 root root 19 May lrwxrwxrwx. 1 root root 29 May les</span></p>
<p><span class="font19">lrwxrwxrwx. 1 root root 19 May [root@centos65 ~]#</span></p>
</div><br clear="all">
<p><span class="font19">6 13:08 conf</span></p>
<p><span class="font19">6 13:08 conf.d</span></p>
<p><span class="font19">6 13:08 logs -&gt; ../../var/log/httpd</span></p>
<p><span class="font19">6 13:08 modules -&gt; ../../usr/lib64/httpd/modu\</span></p>
<p><span class="font19">6 13:08 run -&gt; ../../var/run/httpd</span></p>
<h4><a name="bookmark8084"></a><span class="font25"><a name="bookmark8085"></a><a name="bookmark8086"></a>Debian (and ubuntu/mint/...) use </span><span class="font25" style="font-weight:bold;">/etc/apache2</span><span class="font25">.</span></h4>
<div>
<p><span class="font19">root@debian7:~# ls total 72 -rw-r--r-- 1 root drwxr-xr-x 2 root -rw-r--r-- 1 root -rw-r--r-- 1 root drwxr-xr-x 2 root drwxr-xr-x 2 root -rw-r--r-- 1 root drwxr-xr-x 2 root drwxr-xr-x 2 root root@debian7:~#</span></p>
</div><br clear="all">
<div>
<p><span class="font19">-l /etc/apache2/</span></p>
<p><span class="font19">root 9659 May 6 root 4096 May 6</span></p>
<p><span class="font19">root 1465 Jan 31 root 31063 Jul 20 root 4096 May 6 root 4096 May 6 root 750 Jan 26 root 4096 May 6 root 4096 May 6</span></p>
</div><br clear="all">
<div>
<p><span class="font19">14:23 apache2.conf</span></p>
<p><span class="font19">13:19 conf.d</span></p>
<p><span class="font19">18:35 envvars</span></p>
<p><span class="font19">2013 magic</span></p>
<p><span class="font19">13:19 mods-available</span></p>
<p><span class="font19">13:19 mods-enabled</span></p>
<p><span class="font19">12:13 ports.conf</span></p>
<p><span class="font19">13:19 sites-available</span></p>
<p><span class="font19">13:19 sites-enabled</span></p>
</div><br clear="all">
<ul style="list-style:none;"><li>
<h2><a name="bookmark8087"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7737"></a><a name="bookmark8088"></a>1.2. port virtual hosts on Debian</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8089"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8090"></a>1.2.1. default virtual host</span></h3></li></ul></li></ul>
<p><span class="font25">Debian has a virtualhost configuration file for its default website in </span><span class="font25" style="font-weight:bold;">/etc/apache2/sites-available/default</span><span class="font25">.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">head -2 /etc/apache2/sites-available/default</span></p>
<p><span class="font19">&lt;VirtualHost *:80&gt; ServerAdmin webmaster@localhost</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8091"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8092"></a>1.2.2. three extra virtual hosts</span></h3></li></ul>
<p><span class="font25">In this scenario we create three additional websites for three customers that share a clubhouse and want to jointly hire you. They are a model train club named </span><span class="font25" style="font-weight:bold;">Choo Choo</span><span class="font25">, a chess club named </span><span class="font25" style="font-weight:bold;">Chess Club 42 </span><span class="font25">and a hackerspace named </span><span class="font25" style="font-weight:bold;">hunter2</span><span class="font25">.</span></p>
<p><span class="font25">One way to put three websites on one web server, is to put each website on a different port. This screenshot shows three newly created </span><span class="font25" style="font-weight:bold;">virtual hosts</span><span class="font25">, one for each customer.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">vi /etc/apache2/sites-available/choochoo</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">cat /etc/apache2/sites-available/choochoo</span></p>
<p><span class="font19">&lt;VirtualHost *:7000&gt; ServerAdmin webmaster@localhost DocumentRoot /var/www/choochoo</span></p>
<p><span class="font19">&lt;/VirtualHost&gt;</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">vi /etc/apache2/sites-available/chessclub42</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">cat /etc/apache2/sites-available/chessclub42</span></p>
<p><span class="font19">&lt;VirtualHost *:8000&gt; ServerAdmin webmaster@localhost DocumentRoot /var/www/chessclub42 &lt;/VirtualHost&gt;</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">vi /etc/apache2/sites-available/hunter2</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">cat /etc/apache2/sites-available/hunter2</span></p>
<p><span class="font19">&lt;VirtualHost *:9000&gt; ServerAdmin webmaster@localhost DocumentRoot /var/www/hunter2</span></p>
<p><span class="font19">&lt;/VirtualHost&gt;</span></p>
<p><span class="font25">Notice the different port numbers 7000, 8000 and 9000. Notice also that we specified a unique </span><span class="font25" style="font-weight:bold;">DocumentRoot </span><span class="font25">for each website.</span></p>
<p><span class="font25">Are you using </span><span class="font25" style="font-weight:bold;">Ubuntu </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">Mint</span><span class="font25">, then these configfiles need to end in </span><span class="font25" style="font-weight:bold;">.conf</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8093"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8094"></a>1.2.3. three extra ports</span></h3></li></ul>
<h4><a name="bookmark8095"></a><span class="font25"><a name="bookmark8096"></a>We need to enable these three ports on apache in the </span><span class="font25" style="font-weight:bold;">ports.conf </span><span class="font25">file. Open this file with </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">and add three lines to </span><span class="font25" style="font-weight:bold;">listen </span><span class="font25">on three extra ports.</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">vi /etc/apache2/ports.conf</span></p>
<h4><a name="bookmark8097"></a><span class="font25"><a name="bookmark8098"></a>Verify with </span><span class="font25" style="font-weight:bold;">grep </span><span class="font25">that the </span><span class="font25" style="font-weight:bold;">Listen </span><span class="font25">directives are added correctly.</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep 'Listen /etc/apache2/ports.conf</span></p>
<p><span class="font19">Listen</span></p>
<div>
<p><span class="font19">80</span></p>
<p><span class="font19">7000</span></p>
<p><span class="font19">8000</span></p>
<p><span class="font19">9000</span></p>
</div><br clear="all">
<p><span class="font19">Listen</span></p>
<p><span class="font19">Listen</span></p>
<p><span class="font19">Listen</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8099"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8100"></a>1.2.4. three extra websites</span></h3></li></ul>
<h4><a name="bookmark8101"></a><span class="font25"><a name="bookmark8102"></a>Next we need to create three </span><span class="font25" style="font-weight:bold;">DocumentRoot </span><span class="font25">directories.</span></h4>
<p><span class="font19">root@debian7:~# mkdir /var/www/choochoo</span></p>
<p><span class="font19">root@debian7:~# mkdir /var/www/chessclub42</span></p>
<p><span class="font19">root@debian7:~# mkdir /var/www/hunter2</span></p>
<h4><a name="bookmark8103"></a><span class="font25"><a name="bookmark8104"></a>And we have to put some really simple website in those directories.</span></h4>
<p><span class="font19">root@debian7:~# echo 'Choo Choo model train Choo Choo' &gt;&nbsp;/var/www/choochoo/inde\ x.html</span></p>
<p><span class="font19">root@debian7:~# echo 'Welcome to chess club 42' &gt;&nbsp;/var/www/chessclub42/index.ht\ ml</span></p>
<p><span class="font19">root@debian7:~# echo 'HaCkInG iS fUn At HuNtEr2' &gt;&nbsp;/var/www/hunter2/index.html</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8105"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8106"></a>1.2.5. enabling extra websites</span></h3></li></ul>
<h4><a name="bookmark8107"></a><span class="font25"><a name="bookmark8108"></a>The last step is to enable the websites with the </span><span class="font25" style="font-weight:bold;">a2ensite </span><span class="font25">command. This command will create links in </span><span class="font25" style="font-weight:bold;">sites-enabled</span><span class="font25">.</span></h4>
<h4><a name="bookmark8109"></a><span class="font25"><a name="bookmark8110"></a>The links are not there yet...</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">cd /etc/apache2/</span></p>
<p><span class="font19">root@debian7:/etc/apache2# </span><span class="font19" style="font-weight:bold;">ls sites-available/ </span><span class="font19">chessclub42 choochoo default default-ssl hunter2 root@debian7:/etc/apache2# </span><span class="font19" style="font-weight:bold;">ls sites-enabled/ </span><span class="font19">000-default</span></p>
<h4><a name="bookmark8111"></a><span class="font25"><a name="bookmark8112"></a>So we run the </span><span class="font25" style="font-weight:bold;">a2ensite </span><span class="font25">command for all websites.</span></h4>
<p><span class="font19">root@debian7:/etc/apache2# </span><span class="font19" style="font-weight:bold;">a2ensite choochoo </span><span class="font19">Enabling site choochoo.</span></p>
<p><span class="font19">To activate the new configuration, you need to run: service apache2 reload</span></p>
<p><span class="font19">root@debian7:/etc/apache2# </span><span class="font19" style="font-weight:bold;">a2ensite chessclub42</span></p>
<p><span class="font19">Enabling site chessclub42.</span></p>
<p><span class="font19">To activate the new configuration, you need to run: service apache2 reload</span></p>
<p><span class="font19">root@debian7:/etc/apache2# </span><span class="font19" style="font-weight:bold;">a2ensite hunter2</span></p>
<p><span class="font19">Enabling site hunter2.</span></p>
<p><span class="font19">To activate the new configuration, you need to run: service apache2 reload</span></p>
<h4><a name="bookmark8113"></a><span class="font25"><a name="bookmark8114"></a>The links are created, so we can tell </span><span class="font25" style="font-weight:bold;">apache</span><span class="font25">.</span></h4>
<p><span class="font19">root@debian7:/etc/apache2# </span><span class="font19" style="font-weight:bold;">ls sites-enabled/ </span><span class="font19">000-default chessclub42 choochoo hunter2 root@debian7:/etc/apache2# </span><span class="font19" style="font-weight:bold;">service apache2 reload </span><span class="font19">Reloading web server config: apache2.</span></p>
<p><span class="font19">root@debian7:/etc/apache2#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8115"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8116"></a>1.2.6. testing the three websites</span></h3></li></ul>
<h4><a name="bookmark8117"></a><span class="font25"><a name="bookmark8118"></a>Testing the model train club named </span><span class="font25" style="font-weight:bold;">Choo Choo </span><span class="font25">on port 7000.</span></h4>
<p><span class="font19">root@debian7:/etc/apache2# </span><span class="font19" style="font-weight:bold;">wget 127.0.0.1:7000</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- -2014-05-06 21:16:03-- &nbsp;</span><a href="http://127.0.0.1:7000/"><span class="font19">http://127.0.0.1:7000/</span></a></p></li></ul>
<p><span class="font19">Connecting to 127.0.0.1:7000... connected.</span></p>
<p><span class="font19">HTTP request sent, awaiting response... 200 OK</span></p>
<p><span class="font19">Length: 32 [text/html]</span></p>
<p><span class="font19">Saving to: 'index.html'</span></p>
<p><span class="font19">100%[============================================&gt;] 32 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--.-K/s in 0s</span></p>
<p><span class="font19">2014-05-06 21:16:03 (2.92 MB/s) - 'index.html' saved [32/32]</span></p>
<p><span class="font19">root@debian7:/etc/apache2# </span><span class="font19" style="font-weight:bold;">cat index.html</span></p>
<p><span class="font19">Choo Choo model train Choo Choo</span></p>
<h4><a name="bookmark8119"></a><span class="font25"><a name="bookmark8120"></a>Testing the chess club named </span><span class="font25" style="font-weight:bold;">Chess Club 42 </span><span class="font25">on port 8000.</span></h4>
<p><span class="font19">root@debian7:/etc/apache2# </span><span class="font19" style="font-weight:bold;">wget 127.0.0.1:8000</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- -2014-05-06 21:16:20-- &nbsp;</span><a href="http://127.0.0.1:8000/"><span class="font19">http://127.0.0.1:8000/</span></a></p></li></ul>
<p><span class="font19">Connecting to 127.0.0.1:8000... connected.</span></p>
<p><span class="font19">HTTP request sent, awaiting response... 200 OK</span></p>
<p><span class="font19">Length: 25 [text/html]</span></p>
<p><span class="font19">Saving to: 'index.html.1'</span></p>
<p><span class="font19">100%[===========================================&gt;] 25 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--.-K/s in 0s</span></p>
<p><span class="font19">2014-05-06 21:16:20 (2.16 MB/s) - 'index.html.1' saved [25/25]</span></p>
<p><span class="font19">root@debian7:/etc/apache2# </span><span class="font19" style="font-weight:bold;">cat index.html.1</span></p>
<p><span class="font19">Welcome to chess club 42</span></p>
<h4><a name="bookmark8121"></a><span class="font25"><a name="bookmark8122"></a>Testing the hacker club named </span><span class="font25" style="font-weight:bold;">hunter2 </span><span class="font25">on port 9000.</span></h4>
<p><span class="font19">root@debian7:/etc/apache2# </span><span class="font19" style="font-weight:bold;">wget 127.0.0.1:9000</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- -2014-05-06 21:16:30-- &nbsp;</span><a href="http://127.0.0.1:9000/"><span class="font19">http://127.0.0.1:9000/</span></a></p></li></ul>
<p><span class="font19">Connecting to 127.0.0.1:9000... connected.</span></p>
<p><span class="font19">HTTP request sent, awaiting response... 200 OK</span></p>
<p><span class="font19">Length: 26 [text/html]</span></p>
<p><span class="font19">Saving to: 'index.html.2'</span></p>
<p><span class="font19">100%[===========================================&gt;] 26 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--.-K/s in 0s</span></p>
<p><span class="font19">2014-05-06 21:16:30 (2.01 MB/s) - 'index.html.2' saved [26/26]</span></p>
<p><span class="font19">root@debian7:/etc/apache2# </span><span class="font19" style="font-weight:bold;">cat index.html.2</span></p>
<p><span class="font19">HaCkInG iS fUn At HuNtEr2</span></p>
<h4><a name="bookmark8123"></a><span class="font25"><a name="bookmark8124"></a>Cleaning up the temporary files.</span></h4>
<p><span class="font19">root@debian7:/etc/apache2# </span><span class="font19" style="font-weight:bold;">rm index.html index.html.1 index.html.2</span></p>
<h4><a name="bookmark8125"></a><span class="font25"><a name="bookmark8126"></a>Try testing from another computer using the ip-address of your server.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8127"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7738"></a><a name="bookmark8128"></a>1.3. named virtual hosts on Debian</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark7990"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8129"></a>1.3.1. named virtual hosts</span></h3></li></ul></li></ul>
<p><span class="font25">The chess club and the model train club find the port numbers too hard to remember. They would prefere to have their website accessible by name.</span></p>
<p><span class="font25">We continue work on the same server that has three websites on three ports. We need to make sure those websites are accesible using the names </span><span class="font25" style="font-weight:bold;">choochoo.local</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">chessclub42.local </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">hunter2.local</span><span class="font25">.</span></p>
<p><span class="font25">We start by creating three new virtualhosts.</span></p>
<p><span class="font19">root@debian7:/etc/apache2/sites-available# </span><span class="font19" style="font-weight:bold;">vi choochoo.local </span><span class="font19">root@debian7:/etc/apache2/sites-available# </span><span class="font19" style="font-weight:bold;">vi chessclub42.local </span><span class="font19">root@debian7:/etc/apache2/sites-available# </span><span class="font19" style="font-weight:bold;">vi hunter2.local </span><span class="font19">root@debian7:/etc/apache2/sites-available# </span><span class="font19" style="font-weight:bold;">cat choochoo.local </span><span class="font19">&lt;VirtualHost *:80&gt;</span></p>
<p><span class="font19">ServerAdmin webmaster@localhost</span></p>
<p><span class="font19">ServerName choochoo.local</span></p>
<p><span class="font19">DocumentRoot /var/www/choochoo</span></p>
<p><span class="font19">&lt;/VirtualHost&gt;</span></p>
<p><span class="font19">root@debian7:/etc/apache2/sites-available# </span><span class="font19" style="font-weight:bold;">cat chessclub42.local</span></p>
<p><span class="font19">&lt;VirtualHost *:80&gt;</span></p>
<p><span class="font19">ServerAdmin webmaster@localhost</span></p>
<p><span class="font19">ServerName chessclub42.local</span></p>
<p><span class="font19">DocumentRoot /var/www/chessclub42</span></p>
<p><span class="font19">&lt;/VirtualHost&gt;</span></p>
<p><span class="font19">root@debian7:/etc/apache2/sites-available# </span><span class="font19" style="font-weight:bold;">cat hunter2.local</span></p>
<p><span class="font19">&lt;VirtualHost *:80&gt;</span></p>
<p><span class="font19">ServerAdmin webmaster@localhost</span></p>
<p><span class="font19">ServerName hunter2.local</span></p>
<p><span class="font19">DocumentRoot /var/www/hunter2</span></p>
<p><span class="font19">&lt;/VirtualHost&gt;</span></p>
<p><span class="font19">root@debian7:/etc/apache2/sites-available#</span></p>
<p><span class="font25">Notice that they all listen on </span><span class="font25" style="font-weight:bold;">port 80 </span><span class="font25">and have an extra </span><span class="font25" style="font-weight:bold;">ServerName </span><span class="font25">directive.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4503"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8130"></a>1.3.2. name resolution</span></h3></li></ul>
<p><span class="font25">We need some way to resolve names. This can be done with DNS, which is discussed in another chapter. For this demo it is also possible to quickly add the three names to the </span><span class="font25" style="font-weight:bold;">/etc/ hosts </span><span class="font25">file.</span></p>
<p><span class="font19">root@debian7:/etc/apache2/sites-available# </span><span class="font19" style="font-weight:bold;">grep *192 /etc/hosts</span></p>
<p><span class="font19">192.168.42.50 choochoo.local</span></p>
<p><span class="font19">192.168.42.50 chessclub42.local</span></p>
<p><span class="font19">192.168.42.50 hunter2.local</span></p>
<p><span class="font25">Note that you may have another ip address...</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8131"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8132"></a>1.3.3. enabling virtual hosts</span></h3></li></ul>
<h4><a name="bookmark8133"></a><span class="font25"><a name="bookmark8134"></a>Next we enable them with </span><span class="font25" style="font-weight:bold;">a2ensite</span><span class="font25">.</span></h4>
<p><span class="font19">root@debian7:/etc/apache2/sites-available# </span><span class="font19" style="font-weight:bold;">a2ensite choochoo.local</span></p>
<p><span class="font19">Enabling site choochoo.local.</span></p>
<p><span class="font19">To activate the new configuration, you need to run:</span></p>
<p><span class="font19">service apache2 reload</span></p>
<p><span class="font19">root@debian7:/etc/apache2/sites-available# </span><span class="font19" style="font-weight:bold;">a2ensite chessclub42.local</span></p>
<p><span class="font19">Enabling site chessclub42.local.</span></p>
<p><span class="font19">To activate the new configuration, you need to run:</span></p>
<p><span class="font19">service apache2 reload</span></p>
<p><span class="font19">root@debian7:/etc/apache2/sites-available# </span><span class="font19" style="font-weight:bold;">a2ensite hunter2.local</span></p>
<p><span class="font19">Enabling site hunter2.local.</span></p>
<p><span class="font19">To activate the new configuration, you need to run: service apache2 reload</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8135"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8136"></a>1.3.4. reload and verify</span></h3></li></ul>
<h4><a name="bookmark8137"></a><span class="font25"><a name="bookmark8138"></a>After a </span><span class="font25" style="font-weight:bold;">service apache2 reload </span><span class="font25">the websites should be available by name.</span></h4>
<p><span class="font19">root@debian7:/etc/apache2/sites-available# </span><span class="font19" style="font-weight:bold;">service apache2 reload</span></p>
<p><span class="font19">Reloading web server config: apache2.</span></p>
<p><span class="font19">root@debian7:/etc/apache2/sites-available# </span><span class="font19" style="font-weight:bold;">wget chessclub42.local</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">--2014-05-06 21:37:13-- </span><a href="http://chessclub42.local/"><span class="font19">http://chessclub42.local/</span></a></p></li></ul>
<p><span class="font19">Resolving chessclub42.local (chessclub42.local)... 192.168.42.50</span></p>
<p><span class="font19">Connecting to chessclub42.local (chessclub42.local)|192.168.42.50|:80... conne\ cted.</span></p>
<p><span class="font19">HTTP request sent, awaiting response... 200 OK</span></p>
<p><span class="font19">Length: 25 [text/html]</span></p>
<p><span class="font19">Saving to: 'index.html'</span></p>
<p><span class="font19">100%[=============================================&gt;] 25 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--.-K/s in 0s</span></p>
<p><span class="font19">2014-05-06 21:37:13 (2.06 MB/s) - 'index.html' saved [25/25]</span></p>
<p><span class="font19">root@debian7:/etc/apache2/sites-available# </span><span class="font19" style="font-weight:bold;">cat index.html</span></p>
<p><span class="font19">Welcome to chess club 42</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8139"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7739"></a><a name="bookmark8140"></a>1.4. password protected website on Debian</span></h2></li></ul>
<p><a name="bookmark8141"></a><span class="font25"><a name="bookmark8142"></a>You can secure files and directories in your website with a </span><span class="font25" style="font-weight:bold;">.htaccess </span><span class="font25">file that refers to a </span><span class="font25" style="font-weight:bold;">.htpasswd </span><span class="font25">file. The </span><span class="font25" style="font-weight:bold;">htpasswd </span><span class="font25">command can create a </span><span class="font25" style="font-weight:bold;">.htpasswd </span><span class="font25">file that contains a userid and an (encrypted) password.</span></p>
<p><span class="font25">This screenshot creates a user and password for the hacker named </span><span class="font25" style="font-weight:bold;">cliff </span><span class="font25">and uses the </span><span class="font25" style="font-weight:bold;">-c </span><span class="font25">flag to create the </span><span class="font25" style="font-weight:bold;">.htpasswd </span><span class="font25">file.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">htpasswd -c /var/www/.htpasswd cliff</span></p>
<p><span class="font19">New password:</span></p>
<p><span class="font19">Re-type new password:</span></p>
<p><span class="font19">Adding password for user cliff</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">cat /var/www/.htpasswd</span></p>
<p><span class="font19">cliff:$apr1$vujll0KL$./SZ4w9q0swhX93pQ0PVp.</span></p>
<p><span class="font25">Hacker </span><span class="font25" style="font-weight:bold;">rob </span><span class="font25">also wants access, this screenshot shows how to add a second user and password to </span><span class="font25" style="font-weight:bold;">.htpasswd</span><span class="font25">.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">htpasswd /var/www/.htpasswd rob</span></p>
<p><span class="font19">New password:</span></p>
<p><span class="font19">Re-type new password:</span></p>
<p><span class="font19">Adding password for user rob</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">cat /var/www/.htpasswd</span></p>
<p><span class="font19">cliff:$apr1$vujll0KL$./SZ4w9q0swhX93pQ0PVp.</span></p>
<p><span class="font19">rob:$apr1$HNln1FFt$nRlpF0H.IW11/1DRq4lQo0</span></p>
<p><span class="font25">Both Cliff and Rob chose the same password (hunter2), but that is not visible in the </span><span class="font25" style="font-weight:bold;">.htpasswd </span><span class="font25">file because of the different salts.</span></p>
<p><span class="font25">Next we need to create a </span><span class="font25" style="font-weight:bold;">.htaccess </span><span class="font25">file in the </span><span class="font25" style="font-weight:bold;">DocumentRoot </span><span class="font25">of the website we want to protect. This screenshot shows an example.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">cd /var/www/hunter2/</span></p>
<p><span class="font19">root@debian7:/var/www/hunter2# </span><span class="font19" style="font-weight:bold;">cat .htaccess</span></p>
<p><span class="font19">AuthUserFile /var/www/.htpasswd</span></p>
<p><span class="font19">AuthName &quot;Members only!&quot;</span></p>
<p><span class="font19">AuthType Basic require valid-user</span></p>
<p><span class="font25">Note that we are protecting the website on </span><span class="font25" style="font-weight:bold;">port 9000 </span><span class="font25">that we created earlier.</span></p>
<p><span class="font25">And because we put the website for the Hackerspace named hunter2 in a subdirectory of the default website, we will need to adjust the </span><span class="font25" style="font-weight:bold;">AllowOvveride </span><span class="font25">parameter in </span><span class="font25" style="font-weight:bold;">/etc/apache2/sites-available/default </span><span class="font25">as this screenshot shows (with line numbers on Debian7, your may vary).</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">9 &lt;Directory /var/www/&gt;</span></p></li>
<li>
<p><span class="font19">10 Options Indexes FollowSymLinks MultiViews</span></p></li>
<li>
<p><span class="font19">11</span><span class="font19" style="font-weight:bold;"> AllowOverride Authconfig</span></p></li>
<li>
<p><span class="font19">12 Order allow,deny</span></p></li>
<li>
<p><span class="font19">13 allow from all</span></p></li>
<li>
<p><span class="font19">14 &lt;/Directory</span></p></li></ul>
<p><span class="font25">Now restart the apache2 server and test that it works!</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8143"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7740"></a><a name="bookmark8144"></a>1.5. port virtual hosts on CentOS</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8145"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8146"></a>1.5.1. default virtual host</span></h3></li></ul></li></ul>
<p><span class="font25">Unlike Debian, CentOS has no virtualHost configuration file for its default website. Instead the default configuration will throw a standard error page when no index file can be found in the default location (/var/www/html).</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8147"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8148"></a>1.5.2. three extra virtual hosts</span></h3></li></ul>
<p><span class="font25">In this scenario we create three additional websites for three customers that share a clubhouse and want to jointly hire you. They are a model train club named </span><span class="font25" style="font-weight:bold;">Choo Choo</span><span class="font25">, a chess club named </span><span class="font25" style="font-weight:bold;">Chess Club 42 </span><span class="font25">and a hackerspace named </span><span class="font25" style="font-weight:bold;">hunter2</span><span class="font25">.</span></p>
<p><span class="font25">One way to put three websites on one web server, is to put each website on a different port. This screenshot shows three newly created </span><span class="font25" style="font-weight:bold;">virtual hosts</span><span class="font25">, one for each customer.</span></p>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">vi /etc/httpd/conf.d/choochoo.conf</span></p>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">cat /etc/httpd/conf.d/choochoo.conf </span><span class="font19">&lt;VirtualHost *:7000&gt;</span></p>
<p><span class="font19">ServerAdmin webmaster@localhost DocumentRoot /var/www/html/choochoo &lt;/VirtualHost&gt;</span></p>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">vi /etc/httpd/conf.d/chessclub42.conf</span></p>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">cat /etc/httpd/conf.d/chessclub42.conf</span></p>
<p><span class="font19">&lt;VirtualHost *:8000&gt;</span></p>
<p><span class="font19">ServerAdmin webmaster@localhost</span></p>
<p><span class="font19">DocumentRoot /var/www/html/chessclub42</span></p>
<p><span class="font19">&lt;/VirtualHost&gt;</span></p>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">vi /etc/httpd/conf.d/hunter2.conf</span></p>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">cat /etc/httpd/conf.d/hunter2.conf</span></p>
<p><span class="font19">&lt;VirtualHost *:9000&gt;</span></p>
<p><span class="font19">ServerAdmin webmaster@localhost DocumentRoot /var/www/html/hunter2 &lt;/VirtualHost&gt;</span></p>
<p><span class="font25">Notice the different port numbers 7000, 8000 and 9000. Notice also that we specified a unique </span><span class="font25" style="font-weight:bold;">DocumentRoot </span><span class="font25">for each website.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8149"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8150"></a>1.5.3. three extra ports</span></h3></li></ul>
<p><span class="font25">We need to enable these three ports on apache in the </span><span class="font25" style="font-weight:bold;">httpd.conf </span><span class="font25">file.</span></p>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">vi /etc/httpd/conf/httpd.conf</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep 'Listen /etc/httpd/conf/httpd.conf</span></p>
<p><span class="font19">Listen 80</span></p>
<p><span class="font19">Listen 7000</span></p>
<p><span class="font19">Listen 8000</span></p>
<p><span class="font19">Listen 9000</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8151"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8152"></a>1.5.4. SELinux guards our ports</span></h3></li></ul>
<h4><a name="bookmark8153"></a><span class="font25"><a name="bookmark8154"></a>If we try to restart our server, we will notice the following error:</span></h4>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">service httpd restart</span></p>
<p><span class="font19">Stopping httpd: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p>
<p><span class="font19">Starting httpd:</span></p>
<p><span class="font19">(13)Permission denied: make_sock: could not bind to address 0.0.0.0:7000 no listening sockets available, shutting down</span></p>
<p><span class="font19">[FAILED]</span></p>
<h4><a name="bookmark8155"></a><span class="font25"><a name="bookmark8156"></a>This is due to SELinux reserving ports 7000 and 8000 for other uses. We need to tell SELinux we want to use these ports for http traffic</span></h4>
<div>
<p><span class="font19">[root@CentOS65 [root@CentOS65 [root@CentOS65 Stopping httpd: Starting httpd:</span></p>
</div><br clear="all">
<div>
<p><span class="font19">~]# </span><span class="font19" style="font-weight:bold;">semanage port </span><span class="font19">~]# </span><span class="font19" style="font-weight:bold;">semanage port </span><span class="font19">~]# </span><span class="font19" style="font-weight:bold;">service httpd</span></p>
</div><br clear="all">
<div>
<p><span class="font19" style="font-weight:bold;">-m -t http_port_t</span></p>
<p><span class="font19" style="font-weight:bold;">-m -t http_port_t restart</span></p>
</div><br clear="all">
<div>
<ul style="list-style:none;"><li>
<p><span class="font19" style="font-weight:bold;">-p tcp 7000</span></p></li>
<li>
<p><span class="font19" style="font-weight:bold;">-p tcp 8000</span></p></li></ul>
<p><span class="font19">[ OK ]</span></p>
<p><span class="font19">[ OK ]</span></p>
</div><br clear="all">
<ul style="list-style:none;"><li>
<h3><a name="bookmark8157"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8158"></a>1.5.5. three extra websites</span></h3></li></ul>
<h4><a name="bookmark8159"></a><span class="font25"><a name="bookmark8160"></a>Next we need to create three </span><span class="font25" style="font-weight:bold;">DocumentRoot </span><span class="font25">directories.</span></h4>
<p><span class="font19">[root@CentOS65 ~]# mkdir /var/www/html/choochoo</span></p>
<p><span class="font19">[root@CentOS65 ~]# mkdir /var/www/html/chessclub42</span></p>
<p><span class="font19">[root@CentOS65 ~]# mkdir /var/www/html/hunter2</span></p>
<h4><a name="bookmark8161"></a><span class="font25"><a name="bookmark8162"></a>And we have to put some really simple website in those directories.</span></h4>
<p><span class="font19">[root@CentOS65 ~]# echo 'Choo Choo model train Choo Choo' &gt;&nbsp;/var/www/html/chooc\ hoo/index.html</span></p>
<p><span class="font19">[root@CentOS65 ~]# echo 'Welcome to chess club 42' &gt;&nbsp;/var/www/html/chessclub42/\ index.html</span></p>
<p><span class="font19">[root@CentOS65 ~]# echo 'HaCkInG iS fUn At HuNtEr2' &gt;&nbsp;/var/www/html/hunter2/ind\ ex.html</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8163"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8164"></a>1.5.6. enabling extra websites</span></h3></li></ul>
<h4><a name="bookmark8165"></a><span class="font25"><a name="bookmark8166"></a>The only way to enable or disable configurations in RHEL/CentOS is by renaming or moving the configuration files. Any file in /etc/httpd/conf.d ending on .conf will be loaded by Apache. To disable a site we can either rename the file or move it to another directory.</span></h4>
<h4><a name="bookmark8167"></a><span class="font25"><a name="bookmark8168"></a>The files are created, so we can tell </span><span class="font25" style="font-weight:bold;">apache</span><span class="font25">.</span></h4>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">ls /etc/httpd/conf.d/</span></p>
<p><span class="font19">chessclub42.conf choochoo.conf hunter2.conf README welcome.conf</span></p>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">service httpd reload</span></p>
<p><span class="font19">Reloading httpd:</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8169"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8170"></a>1.5.7. testing the three websites</span></h3></li></ul>
<h4><a name="bookmark8171"></a><span class="font25"><a name="bookmark8172"></a>Testing the model train club named </span><span class="font25" style="font-weight:bold;">Choo Choo </span><span class="font25">on port 7000.</span></h4>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">wget 127.0.0.1:7000</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- -2014-05-11 11:59:36-- &nbsp;</span><a href="http://127.0.0.1:7000/"><span class="font19">http://127.0.0.1:7000/</span></a></p></li></ul>
<p><span class="font19">Connecting to 127.0.0.1:7000... connected.</span></p>
<p><span class="font19">HTTP request sent, awaiting response... 200 OK</span></p>
<p><span class="font19">Length: 32 [text/html]</span></p>
<p><span class="font19">Saving to: 'index.html'</span></p>
<p><span class="font19">100%[===========================================&gt;] 32 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--.-K/s in 0s</span></p>
<p><span class="font19">2014-05-11 11:59:36 (4.47 MB/s) - 'index.html' saved [32/32]</span></p>
<p><span class="font19">[root@CentOS65 ~]# cat </span><span class="font19" style="font-weight:bold;">index.html</span></p>
<p><span class="font19">Choo Choo model train Choo Choo</span></p>
<h4><a name="bookmark8173"></a><span class="font25"><a name="bookmark8174"></a>Testing the chess club named </span><span class="font25" style="font-weight:bold;">Chess Club 42 </span><span class="font25">on port 8000.</span></h4>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">wget 127.0.0.1:8000</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- -2014-05-11 12:01:30-- &nbsp;</span><a href="http://127.0.0.1:8000/"><span class="font19">http://127.0.0.1:8000/</span></a></p></li></ul>
<p><span class="font19">Connecting to 127.0.0.1:8000... connected.</span></p>
<p><span class="font19">HTTP request sent, awaiting response... 200 OK</span></p>
<p><span class="font19">Length: 25 [text/html]</span></p>
<p><span class="font19">Saving to: 'index.html.1'</span></p>
<p><span class="font19">100%[===========================================&gt;] 25 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--.-K/s in 0s</span></p>
<p><span class="font19">2014-05-11 12:01:30 (4.25 MB/s) - 'index.html.1' saved [25/25]</span></p>
<p><span class="font19">root@debian7:/etc/apache2# </span><span class="font19" style="font-weight:bold;">cat index.html.1</span></p>
<p><span class="font19">Welcome to chess club 42</span></p>
<h4><a name="bookmark8175"></a><span class="font25"><a name="bookmark8176"></a>Testing the hacker club named </span><span class="font25" style="font-weight:bold;">hunter2 </span><span class="font25">on port 9000.</span></h4>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">wget 127.0.0.1:9000</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- -2014-05-11 12:02:37-- &nbsp;</span><a href="http://127.0.0.1:9000/"><span class="font19">http://127.0.0.1:9000/</span></a></p></li></ul>
<p><span class="font19">Connecting to 127.0.0.1:9000... connected.</span></p>
<p><span class="font19">HTTP request sent, awaiting response... 200 OK</span></p>
<p><span class="font19">Length: 26 [text/html]</span></p>
<p><span class="font19">Saving to: 'index.html.2'</span></p>
<p><span class="font19">100%[===========================================&gt;] 26 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--.-K/s in 0s</span></p>
<p><span class="font19">2014-05-11 12:02:37 (4.49 MB/s) - 'index.html.2' saved [26/26]</span></p>
<p><span class="font19">root@debian7:/etc/apache2# </span><span class="font19" style="font-weight:bold;">cat index.html.2</span></p>
<p><span class="font19">HaCkInG iS fUn At HuNtEr2</span></p>
<h4><a name="bookmark8177"></a><span class="font25"><a name="bookmark8178"></a>Cleaning up the temporary files.</span></h4>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">rm index.html index.html.1 index.html.2</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8179"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8180"></a>1.5.8. firewall rules</span></h3></li></ul>
<h4><a name="bookmark8181"></a><span class="font25"><a name="bookmark8182"></a>If we attempt to access the site from another machine however, we will not be able to view the website yet. The firewall is blocking incoming connections. We need to open these incoming ports first</span></h4>
<p><span class="font19">[root@CentOS65 ~]# iptables -I INPUT -p tcp --dport 80 -j ACCEPT</span></p>
<p><span class="font19">[root@CentOS65 ~]# iptables -I INPUT -p tcp --dport 7000 -j ACCEPT</span></p>
<p><span class="font19">[root@CentOS65 ~]# iptables -I INPUT -p tcp --dport 8000 -j ACCEPT</span></p>
<p><span class="font19">[root@CentOS65 ~]# iptables -I INPUT -p tcp --dport 9000 -j ACCEPT</span></p>
<h4><a name="bookmark8183"></a><span class="font25"><a name="bookmark8184"></a>And if we want these rules to remain active after a reboot, we need to save them</span></h4>
<p><span class="font19">[root@CentOS65 ~]# service iptables save</span></p>
<p><span class="font19">iptables: Saving firewall rules to /etc/sysconfig/iptables:[ OK ]</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8185"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7741"></a><a name="bookmark8186"></a>1.6. named virtual hosts on CentOS</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark7993"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8187"></a>1.6.1. named virtual hosts</span></h3></li></ul></li></ul>
<p><span class="font25">The chess club and the model train club find the port numbers too hard to remember. They would prefere to have their website accessible by name.</span></p>
<p><span class="font25">We continue work on the same server that has three websites on three ports. We need to make sure those websites are accesible using the names </span><span class="font25" style="font-weight:bold;">choochoo.local</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">chessclub42.local </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">hunter2.local</span><span class="font25">.</span></p>
<p><span class="font25">First, we need to enable named virtual hosts in the configuration</span></p>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">vi /etc/httpd/conf/httpd.conf</span></p>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">grep *NameVirtualHost /etc/httpd/conf/httpd.conf</span></p>
<p><span class="font19">NameVirtualHost *:80 [root@CentOS65 ~]#</span></p>
<p><span class="font25">Next we need to create three new virtualhosts.</span></p>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">vi /etc/httpd/conf.d/choochoo.local.conf</span></p>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">vi /etc/httpd/conf.d/chessclub42.local.conf</span></p>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">vi /etc/httpd/conf.d/hunter2.local.conf</span></p>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">cat /etc/httpd/conf.d/choochoo.local.conf</span></p>
<p><span class="font19">&lt;VirtualHost *:80&gt;</span></p>
<p><span class="font19">ServerAdmin webmaster@localhost ServerName choochoo.local DocumentRoot /var/www/html/choochoo &lt;/VirtualHost&gt;</span></p>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">cat /etc/httpd/conf.d/chessclub42.local.conf</span></p>
<p><span class="font19">&lt;VirtualHost *:80&gt;</span></p>
<p><span class="font19">ServerAdmin webmaster@localhost ServerName chessclub42.local DocumentRoot /var/www/html/chessclub42 &lt;/VirtualHost&gt;</span></p>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">cat /etc/httpd/conf.d/hunter2.local.conf</span></p>
<p><span class="font19">&lt;VirtualHost *:80&gt;</span></p>
<p><span class="font19">ServerAdmin webmaster@localhost ServerName hunter2.local DocumentRoot /var/www/html/hunter2 &lt;/VirtualHost&gt; [root@CentOS65 ~]#</span></p>
<p><span class="font25">Notice that they all listen on </span><span class="font25" style="font-weight:bold;">port 80 </span><span class="font25">and have an extra </span><span class="font25" style="font-weight:bold;">ServerName </span><span class="font25">directive.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8013"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8188"></a>1.6.2. name resolution</span></h3></li></ul>
<p><span class="font25">We need some way to resolve names. This can be done with DNS, which is discussed in another chapter. For this demo it is also possible to quickly add the three names to the </span><span class="font25" style="font-weight:bold;">/etc/ hosts </span><span class="font25">file.</span></p>
<p><span class="font19">[root@CentOS65 ~]# grep *192 /etc/hosts</span></p>
<p><span class="font19">192.168.1.225 choochoo.local</span></p>
<p><span class="font19">192.168.1.225 chessclub42.local</span></p>
<p><span class="font19">192.168.1.225 hunter2.local</span></p>
<p><span class="font25">Note that you may have another ip address...</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8189"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8190"></a>1.6.3. reload and verify</span></h3></li></ul>
<h4><a name="bookmark8191"></a><span class="font25"><a name="bookmark8192"></a>After a </span><span class="font25" style="font-weight:bold;">service httpd reload </span><span class="font25">the websites should be available by name.</span></h4>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">service httpd reload</span></p>
<p><span class="font19">Reloading httpd:</span></p>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">wget chessclub42.local</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">--2014-05-25 16:59:14-- </span><a href="http://chessclub42.local/"><span class="font19">http://chessclub42.local/</span></a></p></li></ul>
<p><span class="font19">Resolving chessclub42.local... 192.168.1.225</span></p>
<p><span class="font19">Connecting to chessclub42.local|192.168.1.225|:80... connected.</span></p>
<p><span class="font19">HTTP request sent, awaiting response... 200 OK</span></p>
<p><span class="font19">Length: 25 [text/html]</span></p>
<p><span class="font19">Saving to: aindex.htmla</span></p>
<p><span class="font19">100%[=============================================&gt;] 25 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--.-K/s in 0s</span></p>
<p><span class="font19">2014-05-25 16:59:15 (1014 KB/s) - 'index.html' saved [25/25]</span></p>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">cat index.html</span></p>
<p><span class="font19">Welcome to chess club 42</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8193"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7742"></a><a name="bookmark8194"></a>1.7. password protected website on CentOS</span></h2></li></ul>
<p><a name="bookmark8195"></a><span class="font25"><a name="bookmark8196"></a>You can secure files and directories in your website with a </span><span class="font25" style="font-weight:bold;">.htaccess </span><span class="font25">file that refers to a </span><span class="font25" style="font-weight:bold;">.htpasswd </span><span class="font25">file. The </span><span class="font25" style="font-weight:bold;">htpasswd </span><span class="font25">command can create a </span><span class="font25" style="font-weight:bold;">.htpasswd </span><span class="font25">file that contains a userid and an (encrypted) password.</span></p>
<p><span class="font25">This screenshot creates a user and password for the hacker named </span><span class="font25" style="font-weight:bold;">cliff </span><span class="font25">and uses the </span><span class="font25" style="font-weight:bold;">-c </span><span class="font25">flag to create the </span><span class="font25" style="font-weight:bold;">.htpasswd </span><span class="font25">file.</span></p>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">htpasswd -c /var/www/.htpasswd cliff</span></p>
<p><span class="font19">New password:</span></p>
<p><span class="font19">Re-type new password:</span></p>
<p><span class="font19">Adding password for user cliff</span></p>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">cat /var/www/.htpasswd</span></p>
<p><span class="font19">cliff:QNwTrymMLBctU</span></p>
<p><span class="font25">Hacker </span><span class="font25" style="font-weight:bold;">rob </span><span class="font25">also wants access, this screenshot shows how to add a second user and password to </span><span class="font25" style="font-weight:bold;">.htpasswd</span><span class="font25">.</span></p>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">htpasswd /var/www/.htpasswd rob</span></p>
<p><span class="font19">New password:</span></p>
<p><span class="font19">Re-type new password:</span></p>
<p><span class="font19">Adding password for user rob</span></p>
<p><span class="font19">[root@CentOS65 ~]# </span><span class="font19" style="font-weight:bold;">cat /var/www/.htpasswd</span></p>
<p><span class="font19">cliff:QNwTrymMLBctU</span></p>
<p><span class="font19">rob:EC2vOCcrMXDoM [root@CentOS65 ~]#</span></p>
<p><span class="font25">Both Cliff and Rob chose the same password (hunter2), but that is not visible in the </span><span class="font25" style="font-weight:bold;">.htpasswd </span><span class="font25">file because of the different salts.</span></p>
<p><span class="font25">Next we need to create a </span><span class="font25" style="font-weight:bold;">.htaccess </span><span class="font25">file in the </span><span class="font25" style="font-weight:bold;">DocumentRoot </span><span class="font25">of the website we want to protect. This screenshot shows an example.</span></p>
<p><span class="font19">[root@CentOS65 ~]# cat /var/www/html/hunter2/.htaccess</span></p>
<p><span class="font19">AuthUserFile /var/www/.htpasswd</span></p>
<p><span class="font19">AuthName &quot;Members only!&quot;</span></p>
<p><span class="font19">AuthType Basic require valid-user</span></p>
<p><span class="font25">Note that we are protecting the website on </span><span class="font25" style="font-weight:bold;">port 9000 </span><span class="font25">that we created earlier.</span></p>
<p><span class="font25">And because we put the website for the Hackerspace named hunter2 in a subdirectory of the default website, we will need to adjust the </span><span class="font25" style="font-weight:bold;">AllowOvveride </span><span class="font25">parameter in </span><span class="font25" style="font-weight:bold;">/etc/httpd/conf/ httpd.conf </span><span class="font25">under the </span><span class="font25" style="font-weight:bold;">&lt;Directory &quot;/var/www/html&quot;&gt; </span><span class="font25">directive as this screenshot shows.</span></p>
<p><span class="font19">[root@CentOS65 ~]# vi /etc/httpd/conf/httpd.conf</span></p>
<p><span class="font19">&lt;Directory &quot;/var/www/html&quot;&gt;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Possible values for the Options directive are &quot;None&quot;, &quot;All&quot;,</span></p></li>
<li>
<p><span class="font19"># or any combination of:</span></p></li>
<li>
<p><span class="font19"># Indexes Includes FollowSymLinks SymLinksifOwnerMatch ExecCGI MultiViews</span></p></li>
<li>
<p><span class="font19"># Note that &quot;MultiViews&quot; must be named *explicitly* --- &quot;Options All&quot;</span></p></li>
<li>
<p><span class="font19"># doesn't give it to you.</span></p></li>
<li>
<p><span class="font19"># The Options directive is both complicated and important. Please see</span></p></li>
<li>
<p><span class="font19"># </span><a href="http://httpd.apache.org/docs/2.2/mod/core.html%23options"><span class="font19">http://httpd.apache.org/docs/2.2/mod/core.html#options</span></a></p></li>
<li>
<p><span class="font19"># for more information.</span></p></li></ul>
<p><span class="font19">Options Indexes FollowSymLinks</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">#</span></p></li>
<li>
<p><span class="font19"># AllowOverride controls what directives may be placed in .htaccess files.</span></p></li>
<li>
<p><span class="font19"># It can be &quot;All&quot;, &quot;None&quot;, or any combination of the keywords:</span></p></li>
<li>
<p><span class="font19"># Options FileInfo AuthConfig Limit #</span></p></li></ul>
<p><span class="font19" style="font-weight:bold;">AllowOverride Authconfig</span></p>
<p><span class="font19">#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Controls who can get stuff from this server.</span></p></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font19">#</span></p></li></ul>
<p><span class="font19">Order allow,deny</span></p>
<p><span class="font19">Allow from all</span></p>
<p><span class="font19">&lt;/Directory&gt;</span></p>
<h4><a name="bookmark8197"></a><span class="font25"><a name="bookmark8198"></a>Now restart the apache2 server and test that it works!</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8199"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7743"></a><a name="bookmark8200"></a>1.8. troubleshooting apache</span></h2></li></ul>
<h4><a name="bookmark8201"></a><span class="font25"><a name="bookmark8202"></a>When apache restarts, it will verify the syntax of files in the configuration folder </span><span class="font25" style="font-weight:bold;">/etc/ apache2 </span><span class="font25">on debian or </span><span class="font25" style="font-weight:bold;">/etc/httpd </span><span class="font25">on CentOS and it will tell you the name of the faulty file, the line number and an explanation of the error.</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">service apache2 restart</span></p>
<p><span class="font19">apache2: Syntax error on line 268 of /etc/apache2/apache2.conf: Syntax error o\ n line 1 of /etc/apache2/sites-enabled/chessclub42: /etc/apache2/sites-enabled\ /chessclub42:4: &lt;VirtualHost&gt; was not closed.\n/etc/apache2/sites-enabled/ches\ sclub42:1: &lt;VirtualHost&gt; was not closed.</span></p>
<p><span class="font19">Action 'configtest' failed.</span></p>
<p><span class="font19">The Apache error log may have more information. failed!</span></p>
<h4><a name="bookmark8203"></a><span class="font25"><a name="bookmark8204"></a>Below you see the problem... a missing / before on line 4.</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">cat /etc/apache2/sites-available/chessclub42</span></p>
<p><span class="font19">&lt;VirtualHost *:8000&gt;</span></p>
<p><span class="font19">ServerAdmin webmaster@localhost DocumentRoot /var/www/chessclub42</span></p>
<p><span class="font19">&lt;VirtualHost&gt;</span></p>
<h4><a name="bookmark8205"></a><span class="font25"><a name="bookmark8206"></a>Let us force another error by renaming the directory of one of our websites:</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">mv /var/www/choochoo/ /var/www/chooshoo</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">!ser</span></p>
<p><span class="font19">service apache2 restart</span></p>
<p><span class="font19">Restarting web server: apache2Warning: DocumentRoot [/var/www/choochoo] does n\ ot exist</span></p>
<p><span class="font19">Warning: DocumentRoot [/var/www/choochoo] does not exist</span></p>
<p><span class="font19">... waiting Warning: DocumentRoot [/var/www/choochoo] does not exist</span></p>
<p><span class="font19">Warning: DocumentRoot [/var/www/choochoo] does not exist</span></p>
<h4><a name="bookmark8207"></a><span class="font25"><a name="bookmark8208"></a>As you can see, apache will tell you exactly what is wrong.</span></h4>
<h4><a name="bookmark8209"></a><span class="font25"><a name="bookmark8210"></a>You can also troubleshoot by connecting to the website via a browser and then checking the apache log files in </span><span class="font25" style="font-weight:bold;">/var/log/apache</span><span class="font25">.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8211"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7744"></a><a name="bookmark8212"></a>1.9. virtual hosts example</span></h2></li></ul>
<h4><a name="bookmark8213"></a><span class="font25"><a name="bookmark8214"></a>Below is a sample virtual host configuration. This virtual hosts overrules the default Apache </span><span class="font25" style="font-weight:bold;">ErrorDocument </span><span class="font25">directive.</span></h4>
<p><span class="font19">&lt;VirtualHost 83.217.76.245:80&gt;</span></p>
<p><span class="font19">ServerName cobbaut.be</span></p>
<p><span class="font19">ServerAlias </span><a href="http://www.cobbaut.be"><span class="font19">www.cobbaut.be</span></a></p>
<p><span class="font19">DocumentRoot /home/paul/public_html</span></p>
<p><span class="font19">ErrorLog /home/paul/logs/error_log</span></p>
<p><span class="font19">CustomLog /home/paul/logs/access_log common</span></p>
<p><span class="font19">ScriptAlias /cgi-bin/ /home/paul/cgi-bin/</span></p>
<p><span class="font19">&lt;Directory /home/paul/public_html&gt;</span></p>
<p><span class="font19">Options Indexes IncludesNOEXEC FollowSymLinks allow from all</span></p>
<p><span class="font19">&lt;/Directory&gt;</span></p>
<p><span class="font19">ErrorDocument 404 </span><a href="http://www.cobbaut.be/cobbaut.php"><span class="font19">http://www.cobbaut.be/cobbaut.php</span></a></p>
<p><span class="font19">&lt;/VirtualHost&gt;</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8215"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7745"></a><a name="bookmark8216"></a>1.10. aliases and redirects</span></h2></li></ul>
<h4><a name="bookmark8217"></a><span class="font25"><a name="bookmark8218"></a>Apache supports aliases for directories, like this example shows.</span></h4>
<p><span class="font19">Alias /paul/ &quot;/home/paul/public_html/&quot;</span></p>
<h4><a name="bookmark8219"></a><span class="font25"><a name="bookmark8220"></a>Similarly, content can be redirected to another website or web server.</span></h4>
<p><span class="font19">Redirect permanent /foo </span><a href="http://www.foo.com/bar"><span class="font19">http://www.foo.com/bar</span></a></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8221"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7746"></a><a name="bookmark8222"></a>1.11. more on .htaccess</span></h2></li></ul>
<h4><a name="bookmark8223"></a><span class="font25"><a name="bookmark8224"></a><a name="bookmark8225"></a>You can do much more with </span><span class="font25" style="font-weight:bold;">.htaccess</span><span class="font25">. One example is to use .htaccess to prevent people from certain domains to access your website. Like in this case, where a number of referer spammers are blocked from the website.</span></h4>
<p><span class="font19">paul@lounge:~/cobbaut.be$ cat .htaccess</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Options +FollowSymlinks</span></p></li></ul>
<p><span class="font19">RewriteEngine On</span></p>
<p><span class="font19">RewriteCond %{HTTP_REFERER} </span><span class="font18"><sup>A</sup></span><span class="font19">http://(www\.)?buy-adipex.fw.nu.*$ [OR]</span></p>
<p><span class="font19">RewriteCond %{http_REFEREr}</span><span class="font18"> <sup>A</sup></span><span class="font19">http://(www\.)?buy-levitra.asso.ws.*$ [NC,OR]</span></p>
<p><span class="font19">RewriteCond %{http_REFEREr}</span><span class="font18"> <sup>A</sup></span><span class="font19">http://(www\.)?buy-tramadol.fw.nu.*$ [NC,OR]</span></p>
<p><span class="font19">RewriteCond %{http_REFEREr}</span><span class="font18"> <sup>A</sup></span><span class="font19">http://(www\.)?buy-viagra.lookin.at.*$ [NC,OR]</span></p>
<p><span class="font19">...</span></p>
<p><span class="font19">RewriteCond %{HTTP_REFERER} </span><span class="font18"><sup>A</sup></span><span class="font19">http://(www\.)?www.healthinsurancehelp.net.*$ [NC] RewriteRule .* - [F,L] paul@lounge:~/cobbaut.be$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8226"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7747"></a><a name="bookmark8227"></a>1.12. traffic</span></h2></li></ul>
<h4><a name="bookmark8228"></a><span class="font25"><a name="bookmark8229"></a><a name="bookmark8230"></a>Apache keeps a log of all visitors. The </span><span class="font25" style="font-weight:bold;">webalizer </span><span class="font25">is often used to parse this log into nice html statistics.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8231"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7748"></a><a name="bookmark8232"></a>1.13. self signed cert on Debian</span></h2></li></ul>
<h4><a name="bookmark8233"></a><span class="font25"><a name="bookmark8234"></a>Below is a very quick guide on setting up Apache2 on Debian 7 with a self-signed certificate.</span><br><br><span class="font25"><a name="bookmark8235"></a>Chances are these packages are already installed.</span></h4>
<p><span class="font19">root@debian7:~# aptitude install apache2 openssl</span></p>
<p><span class="font19">No packages will be installed, upgraded, or removed.</span></p>
<p><span class="font19">0 packages upgraded, 0 newly installed, 0 to remove and 0 not upgraded.</span></p>
<p><span class="font19">Need to get 0 B of archives. After unpacking 0 B will be used.</span></p>
<h4><a name="bookmark8236"></a><span class="font25"><a name="bookmark8237"></a>Create a directory to store the certs, and use </span><span class="font25" style="font-weight:bold;">openssl </span><span class="font25">to create a self signed cert that is valid for 999 days.</span></h4>
<p><span class="font19">root@debian7:~# mkdir /etc/ssl/localcerts</span></p>
<p><span class="font19">root@debian7:~# openssl req -new -x509 -days 999 -nodes -out /etc/ssl/local\ certs/apache.pem -keyout /etc/ssl/localcerts/apache.key</span></p>
<p><span class="font19">Generating a 2048 bit RSA private key writing new private key to '/etc/ssl/localcerts/apache.key'</span></p>
<p><span class="font19">You are about to be asked to enter information that will be incorporated into your certificate request.</span></p>
<p><span class="font19">What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank.</span></p>
<p><span class="font19">Country Name (2 letter code) [AU]:BE</span></p>
<p><span class="font19">State or Province Name (full name) [Some-State]:Antwerp</span></p>
<p><span class="font19">Locality Name (eg, city) []:Antwerp</span></p>
<p><span class="font19">Organization Name (eg, company) [Internet Widgits Pty Ltd]:linux-training.be</span></p>
<p><span class="font19">Organizational Unit Name (eg, section) []:</span></p>
<p><span class="font19">Common Name (e.g. server FQDN or YOUR name) []:Paul Email Address []:</span></p>
<h4><a name="bookmark8238"></a><span class="font25"><a name="bookmark8239"></a>A little security never hurt anyone.</span></h4>
<p><span class="font19">root@debian7:~# ls -l /etc/ssl/localcerts/ total 8</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-r--r-- 1 root root 1704 Sep 16 18:24 apache.key</span></p></li>
<li>
<p><span class="font19">-rw-r--r-- 1 root root 1302 Sep 16 18:24 apache.pem</span></p></li></ul>
<p><span class="font19">root@debian7:~# chmod 600 /etc/ssl/localcerts/*</span></p>
<p><span class="font19">root@debian7:~# ls -l /etc/ssl/localcerts/ total 8</span></p>
<p><span class="font19">-rw------- 1 root root 1704 Sep 16 18:24 apache.key</span></p>
<p><span class="font19">-rw------- 1 root root 1302 Sep 16 18:24 apache.pem</span></p>
<p><span class="font25">Enable the </span><span class="font25" style="font-weight:bold;">apache ssl mod</span><span class="font25">.</span></p>
<p><span class="font19">root@debian7:~# a2enmod ssl</span></p>
<p><span class="font19">Enabling module ssl.</span></p>
<p><span class="font19">See /usr/share/doc/apache2.2-common/README.Debian.gz on how to configure SSL\ and create self-signed certificates.</span></p>
<p><span class="font19">To activate the new configuration, you need to run:</span></p>
<p><span class="font19">service apache2 restart</span></p>
<h4><a name="bookmark8240"></a><span class="font25"><a name="bookmark8241"></a>Create the website configuration.</span></h4>
<p><span class="font19">root@debian7:~# vi /etc/apache2/sites-available/choochoos root@debian7:~# cat /etc/apache2/sites-available/choochoos &lt;VirtualHost *:7000&gt;</span></p>
<p><span class="font19">ServerAdmin webmaster@localhost</span></p>
<p><span class="font19">DocumentRoot /var/www/choochoos</span></p>
<p><span class="font19">SSLEngine On</span></p>
<p><span class="font19">SSLCertificateFile /etc/ssl/localcerts/apache.pem</span></p>
<p><span class="font19">SSLCertificateKeyFile /etc/ssl/localcerts/apache.key</span></p>
<p><span class="font19">&lt;/VirtualHost &gt;</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<h4><a name="bookmark8242"></a><span class="font25"><a name="bookmark8243"></a>And create the website itself.</span></h4>
<p><span class="font19">root@debian7:/var/www/choochoos# vi index.html root@debian7:/var/www/choochoos# cat index.html Choo Choo HTTPS secured model train Choo Choo</span></p>
<h4><a name="bookmark8244"></a><span class="font25"><a name="bookmark8245"></a>Enable the website and restart (or reload) apache2.</span></h4>
<p><span class="font19">root@debian7:/var/www/choochoos# a2ensite choochoos</span></p>
<p><span class="font19">Enabling site choochoos.</span></p>
<p><span class="font19">To activate the new configuration, you need to run: service apache2 reload</span></p>
<p><span class="font19">root@debian7:/var/www/choochoos# service apache2 restart Restarting web server: apache2 ... waiting .</span></p>
<h4><a name="bookmark8246"></a><span class="font25"><a name="bookmark8247"></a>Chances are your browser will warn you about the self signed certificate.</span></h4><img src="linux_guide_files/The Complete Linux Guide-147.jpg" alt="" style="width:408pt;height:371pt;">
<ul style="list-style:none;"><li>
<h2><a name="bookmark8248"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7749"></a><a name="bookmark8249"></a>1.14. self signed cert on RHEL/CentOS</span></h2></li></ul>
<h4><a name="bookmark8250"></a><span class="font25"><a name="bookmark8251"></a>Below is a quick way to create a self signed cert for https on RHEL/CentOS. You may need these packages:</span></h4>
<p><span class="font19">[root@paulserver ~]# yum install httpd openssl mod_ssl</span></p>
<p><span class="font19">Loaded plugins: fastestmirror</span></p>
<p><span class="font19">Loading mirror speeds from cached hostfile</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">* base: </span><a href="ftp://ftp.belnet.be"><span class="font19">ftp.belnet.be</span></a></p></li>
<li>
<p><span class="font19">* extras: </span><a href="ftp://ftp.belnet.be"><span class="font19">ftp.belnet.be</span></a></p></li>
<li>
<p><span class="font19">* updates: mirrors.vooservers.com</span></p></li></ul>
<p><span class="font19">base &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 3.7 kB 00:00</span></p>
<p><span class="font19">Setting up Install Process</span></p>
<p><span class="font19">Package httpd-2.2.15-31.el6.centos.x86_64 already installed and latest version</span></p>
<p><span class="font19">Package openssl-1.0.1e-16.el6_5.15.x86_64 already installed and latest version</span></p>
<p><span class="font19">Package 1:mod_ssl-2.2.15-31.el6.centos.x86_64 already ins... and latest version</span></p>
<p><span class="font19">Nothing to do</span></p>
<h4><a name="bookmark8252"></a><span class="font25"><a name="bookmark8253"></a>We use </span><span class="font25" style="font-weight:bold;">openssl </span><span class="font25">to create the certificate.</span></h4>
<p><span class="font19">[root@paulserver ~]# mkdir certs [root@paulserver ~]# cd certs [root@paulserver certs]# openssl genrsa -out ca.key 2048 Generating RSA private key, 2048 bit long modulus .........+ + + .........................................................+ + + e is 65537 (0x10001) [root@paulserver certs]# openssl req -new -key ca.key -out ca.csr You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank.</span></p>
<p><span class="font19">Country Name (2 letter code) [XX]:BE</span></p>
<p><span class="font19">State or Province Name (full name) []:antwerp</span></p>
<p><span class="font19">Locality Name (eg, city) [Default City]:antwerp</span></p>
<p><span class="font19">Organization Name (eg, company) [Default Company Ltd]:antwerp</span></p>
<p><span class="font19">Organizational Unit Name (eg, section) []:</span></p>
<p><span class="font19">Common Name (eg, your name or your server's hostname) []:paulserver Email Address []:</span></p>
<p><span class="font19">Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []: An optional company name []:</span></p>
<p><span class="font19">[root@paulserver certs]# openssl x509 -req -days 365 -in ca.csr -signkey ca.ke\ y -out ca.crt Signature ok</span></p>
<p><span class="font19">subject=/C=BE/ST=antwerp/L=antwerp/O=antwerp/CN=paulserver Getting Private key</span></p>
<h4><a name="bookmark8254"></a><span class="font25"><a name="bookmark8255"></a>We copy the keys to the right location (You may be missing SELinux info here).</span></h4>
<p><span class="font19">[root@paulserver certs]# cp ca.crt /etc/pki/tls/certs/</span></p>
<p><span class="font19">[root@paulserver certs]# cp ca.key ca.csr /etc/pki/tls/private/</span></p>
<h4><a name="bookmark8256"></a><span class="font25"><a name="bookmark8257"></a>We add the location of our keys to this file, and also add the </span><span class="font25" style="font-weight:bold;">NameVirtualHost *:443 </span><span class="font25">directive.</span></h4>
<p><span class="font19">[root@paulserver certs]# vi /etc/httpd/conf.d/ssl.conf</span></p>
<p><span class="font19">[root@paulserver certs]# grep </span><span class="font18"><sup>A</sup></span><span class="font19">SSLCerti /etc/httpd/conf.d/ssl.conf SSLCertificateFile /etc/pki/tls/certs/ca.crt SSLCertificateKeyFile /etc/pki/tls/private/ca.key</span></p>
<h4><a name="bookmark8258"></a><span class="font25"><a name="bookmark8259"></a>Create a website configuration.</span></h4>
<p><span class="font19">[root@paulserver certs]# vi /etc/httpd/conf.d/choochoos.conf</span></p>
<p><span class="font19">[root@paulserver certs]# cat /etc/httpd/conf.d/choochoos.conf &lt;VirtualHost *:443&gt; SSLEngine on SSLCertificateFile /etc/pki/tls/certs/ca.crt SSLCertificateKeyFile /etc/pki/tls/private/ca.key DocumentRoot /var/www/choochoos ServerName paulserver</span></p>
<p><span class="font19">&lt;/VirtualHost &gt;</span></p>
<p><span class="font19">[root@paulserver certs]#</span></p>
<h4><a name="bookmark8260"></a><span class="font25"><a name="bookmark8261"></a>Create a simple website and restart apache.</span></h4>
<p><span class="font19">[root@paulserver certs]# mkdir /var/www/choochoos</span></p>
<p><span class="font19">[root@paulserver certs]# echo HTTPS model train choochoos &gt;&nbsp;/var/www/choochoos/\ index.html</span></p>
<p><span class="font19">[root@paulserver httpd]# service httpd restart</span></p>
<p><span class="font19">Stopping httpd: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p>
<p><span class="font19">Starting httpd: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p>
<h4><a name="bookmark8262"></a><span class="font25"><a name="bookmark8263"></a>And your browser will probably warn you that this certificate is self signed.</span></h4><img src="linux_guide_files/The Complete Linux Guide-148.jpg" alt="" style="width:408pt;height:371pt;">
<ul style="list-style:none;"><li>
<h2><a name="bookmark8264"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7750"></a><a name="bookmark8265"></a>1.15. practice: apache</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Verify that Apache is installed and running.</span></p></li>
<li>
<p><span class="font25">2. Browse to the Apache HTML manual.</span></p></li>
<li>
<p><span class="font25">3. Create three virtual hosts that listen on ports 8472, 31337 and 1201. Test that it all works.</span></p></li>
<li>
<p><span class="font25">4. Create three named virtual hosts startrek.local, starwars.local and stargate.local. Test that it all works.</span></p></li>
<li>
<p><span class="font25">5. Create a virtual hosts that listens on another ip-address.</span></p></li>
<li>
<p><span class="font25">6. Protect one of your websites with a user/password combo.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark8266"></a><span class="font11" style="font-weight:bold;"><a name="bookmark8267"></a><a name="bookmark7751"></a><a name="bookmark8268"></a>Chapter 2. introduction to squid</span></h1></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark7752"></a><span class="font10" style="font-weight:bold;"><a name="bookmark8269"></a>2.1. about proxy servers</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8270"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8271"></a>2.1.1. usage</span></h3></li></ul></li></ul>
<p><a name="bookmark8272"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">proxy server </span><span class="font25">is a server that caches the internet. Clients connect to the proxy server with a request for an internet server. The proxy server will connect to the internet server on behalf of the client. The proxy server will also cache the pages retrieved from the internet server. A proxy server may provide pages from his cache to a client, instead of connecting to the internet server to retrieve the (same) pages.</span></p>
<p><span class="font25">A proxy server has two main advantages. It improves web surfing speed when returning cached data to clients, and it reduces the required bandwidth (cost) to the internet.</span></p>
<p><span class="font25">Smaller organizations sometimes put the proxy server on the same physical computer that serves as a NAT to the internet. In larger organizations, the proxy server is one of many servers in the DMZ.</span></p>
<p><span class="font25">When web traffic passes via a proxy server, it is common practice to configure the proxy with extra settings for access control. Access control in a proxy server can mean user account access, but also website(url), ip-address or dns restrictions.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8004"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8273"></a>2.1.2. open proxy servers</span></h3></li></ul>
<p><span class="font25">You can find lists of open proxy servers on the internet that enable you to surf anonymously. This works when the proxy server connects on your behalf to a website, without logging your ip-address. But be careful, these (listed) open proxy servers could be created in order to eavesdrop upon their users.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3276"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8274"></a>2.1.3. squid</span></h3></li></ul>
<p><a name="bookmark8275"></a><span class="font25">This module is an introduction to the </span><span class="font25" style="font-weight:bold;">squid </span><span class="font25">proxy server (</span><a href="http://www.squid-cache.org"><span class="font25">http://www.squid-cache.org</span></a><span class="font25">). We will first configure squid as a normal proxy server.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8276"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7753"></a><a name="bookmark8277"></a>2.2. installing squid</span></h2></li></ul>
<h4><a name="bookmark8278"></a><span class="font25"><a name="bookmark8279"></a>This screenshot shows how to install squid on Debian with </span><span class="font25" style="font-weight:bold;">aptitude</span><span class="font25">. Use </span><span class="font25" style="font-weight:bold;">yum </span><span class="font25">if you are on Red Hat/CentOS.</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">aptitude install squid</span></p>
<p><span class="font19">The following NEW packages will be installed: squid squid-common{a} squid-langpack{a}</span></p>
<p><span class="font19">0 packages upgraded, 3 newly installed, 0 to remove and 0 not upgraded. Need to get 1,513 kB of archives. After unpacking 4,540 kB will be used. Do you want to continue? [Y/n/?] ...output truncated...</span></p>
<p><span class="font19">Setting up squid-langpack (20120616-1) ...</span></p>
<p><span class="font19">Setting up squid-common (2.7.STABLE9-4.1) ...</span></p>
<p><span class="font19">Setting up squid (2.7.STABLE9-4.1) ...</span></p>
<p><span class="font19">Creating squid spool directory structure</span></p>
<p><span class="font19">2014/08/01 15:19:31| Creating Swap Directories Restarting Squid HTTP proxy: squid.</span></p>
<h4><a name="bookmark8280"></a><span class="font25" style="font-weight:bold;"><a name="bookmark8281"></a><a name="bookmark8282"></a>squid</span><span class="font25">'s main configuration file is </span><span class="font25" style="font-weight:bold;">/etc/squid/squid.conf</span><span class="font25">. The file explains every parameter in great detail.</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">wc -l /etc/squid/squid.conf </span><span class="font19">4948 /etc/squid/squid.conf</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8283"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7754"></a><a name="bookmark8284"></a>2.3. port 3128</span></h2></li></ul>
<h4><a name="bookmark8285"></a><span class="font25"><a name="bookmark8286"></a>By default the </span><span class="font25" style="font-weight:bold;">squid proxy server </span><span class="font25">will lsiten to </span><span class="font25" style="font-weight:bold;">port 3128</span><span class="font25">.</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep </span><span class="font18"><sup>A</sup></span><span class="font19" style="font-weight:bold;">http_port /etc/squid/squid.conf </span><span class="font19">http_port 3128 root@debian7:~#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8287"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7755"></a><a name="bookmark8288"></a>2.4. starting and stopping</span></h2></li></ul>
<h4><a name="bookmark8289"></a><span class="font25"><a name="bookmark8290"></a>You can manage </span><span class="font25" style="font-weight:bold;">squid </span><span class="font25">with the standard </span><span class="font25" style="font-weight:bold;">service </span><span class="font25">command as shown in this screenshot.</span></h4>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">service squid start </span><span class="font19">Starting Squid HTTP proxy: squid. root@debian7:~# </span><span class="font19" style="font-weight:bold;">service squid restart </span><span class="font19">Restarting Squid HTTP proxy: squid. root@debian7:~# </span><span class="font19" style="font-weight:bold;">service squid status </span><span class="font19">squid is running.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">service squid stop </span><span class="font19">Stopping Squid HTTP proxy: squid. root@debian7:~#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8291"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7756"></a><a name="bookmark8292"></a>2.5. client proxy settings</span></h2></li></ul>
<p><span class="font25">To enable a proxy server in </span><span class="font25" style="font-weight:bold;">Firefox </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">Iceweasel </span><span class="font25">go to </span><span class="font25" style="font-weight:bold;">Edit Preferences </span><span class="font25">and configure as shown in this screenshot (replace 192.168.1.60 with the ip address of your proxy server).</span></p><img src="linux_guide_files/The Complete Linux Guide-149.jpg" alt="" style="width:255pt;height:290pt;">
<p><span class="font25">Test that your internet works with the proxy enabled. Also test that after a </span><span class="font25" style="font-weight:bold;">service squid stop </span><span class="font25">command on your proxy server that you get a message similar to this schreenshot.</span></p><img src="linux_guide_files/The Complete Linux Guide-150.jpg" alt="" style="width:341pt;height:237pt;">
<p><span class="font25">To enable a proxy server with Google Chrome (or Debian Chromium) start the program from the command line like this:</span></p>
<p><span class="font19">paul@debian7:~$ chromium --proxy-server='192.168.1.60:3128'</span></p>
<p><span class="font25">Disabling the proxy with </span><span class="font25" style="font-weight:bold;">service squid stop </span><span class="font25">should result in an error message similar to this screenshot.</span></p><img src="linux_guide_files/The Complete Linux Guide-151.jpg" alt="" style="width:341pt;height:192pt;">
<ul style="list-style:none;"><li>
<h2><a name="bookmark8293"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7757"></a><a name="bookmark8294"></a>2.6. upside down images</span></h2></li></ul>
<p><span class="font25">A proxy server sits inbetween your browser and the internet. So besides caching of internet data (the original function of a proxy server) and besides firewall like restrictions based on www content, a proxy server is in the perfect position to alter the webpages that you visit.</span></p>
<p><span class="font25">You could for instance change the advertising on a webpage (or remove certain advertisers), or like we do in this example; change all images so they are upside down.</span></p>
<p><span class="font25">The server needs command line tools to manipulate images and a perl script that uses these tools (and </span><span class="font25" style="font-weight:bold;">wget </span><span class="font25">to download the images locally and serve them with </span><span class="font25" style="font-weight:bold;">apache2</span><span class="font25">). In this example we use </span><span class="font25" style="font-weight:bold;">imagemagick </span><span class="font25">(which provides tools like </span><span class="font25" style="font-weight:bold;">convert </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">mogrify</span><span class="font25">).</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">aptitude install imagemagick wget perl apache2 </span><span class="font19">...output truncated...</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">dpkg -S $(readlink -f $(which mogrify))</span></p>
<p><span class="font19">imagemagick: /usr/bin/mogrify.im6</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<p><span class="font25">The perl script that is shown in the screenshot below can be found on several websites, yet I have not found the original author. It is however a very simple script that uses </span><span class="font25" style="font-weight:bold;">wget </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">mogrify </span><span class="font25">to download images (.jpg .gif and .png), flip them and store them in </span><span class="font25" style="font-weight:bold;">/var/www/ images</span><span class="font25">.</span></p>
<p><span class="font19">root@debian7:~# cat </span><a href="file:///usr/local/bin/flip.pl"><span class="font19">/usr/local/bin/flip.pl</span></a></p>
<p><span class="font19">#!/usr/bin/perl</span></p>
<p><span class="font19">$|=1;</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">$cou nt = 0;</span></p></li></ul>
<p><span class="font19">$pid = $$;</span></p>
<p><span class="font19">while (&lt;&gt;) {</span></p>
<p><span class="font19">chomp $_;</span></p>
<p><span class="font19">if ($_ =~ /(.*\.jpg)/i) {</span></p>
<p><span class="font19">$url = $1;</span></p>
<p><span class="font19">system(&quot;/usr/bin/wget&quot;, &quot;-q&quot;, &quot;-O&quot;,&quot;/var/www/images/$pid-$count.jpg&quot;, &quot;$url&quot;); system(&quot;/usr/bin/mogrify&quot;, &quot;-flip&quot;,&quot;/var/www/images/$pid-$count.jpg&quot;);</span></p>
<p><span class="font19">print &quot;</span><a href="http://127.0.0.1/images/$pid-$count.jpg/n"><span class="font19">http://127.0.0.1/images/$pid-$count.jpg\n</span></a><span class="font19">&quot;;</span></p>
<p><span class="font19">}</span></p>
<p><span class="font19">elsif ($_ =~ /(.*\.gif)/i) {</span></p>
<p><span class="font19">$url = $1;</span></p>
<p><span class="font19">system(&quot;/usr/bin/wget&quot;, &quot;-q&quot;, &quot;-O&quot;,&quot;/var/www/images/$pid-$count.gif&quot;, &quot;$url&quot;); system(&quot;/usr/bin/mogrify&quot;, &quot;-flip&quot;,&quot;/var/www/images/$pid-$count.gif&quot;);</span></p>
<p><span class="font19">print &quot;</span><a href="http://127.0.0.1/images/$pid-$count.gif/n"><span class="font19">http://127.0.0.1/images/$pid-$count.gif\n</span></a><span class="font19">&quot;;</span></p>
<p><span class="font19">}</span></p>
<p><span class="font19">elsif ($_ =~ /(.*\.png)/i) {</span></p>
<p><span class="font19">$url = $1;</span></p>
<p><span class="font19">system(&quot;/usr/bin/wget&quot;, &quot;-q&quot;, &quot;-O&quot;,&quot;/var/www/images/$pid-$count.png&quot;, &quot;$url&quot;); system(&quot;/usr/bin/mogrify&quot;, &quot;-flip&quot;,&quot;/var/www/images/$pid-$count.png&quot;);</span></p>
<p><span class="font19">print &quot;</span><a href="http://127.0.0.1/images/$pid-$count.png/n"><span class="font19">http://127.0.0.1/images/$pid-$count.png\n</span></a><span class="font19">&quot;;</span></p>
<p><span class="font19">}</span></p>
<p><span class="font19">else { print &quot;$_\n&quot;;;</span></p>
<p><span class="font19">}</span></p>
<p><span class="font19">$count++;</span></p>
<p><span class="font19">}</span></p>
<p><span class="font25">Change (or enable) also the following line in </span><span class="font25" style="font-weight:bold;">/etc/squid/suiqd.conf</span><span class="font25">.</span></p>
<p><span class="font19">http_access allow localnet</span></p>
<p><span class="font19">http_port 3128 transparent</span></p>
<p><span class="font19">url_rwwrite_program </span><a href="file:///usr/local/bin/flip.pl"><span class="font19">/usr/local/bin/flip.pl</span></a></p>
<p><span class="font25">The directory this script uses is </span><span class="font25" style="font-weight:bold;">/var/www/images </span><span class="font25">and should be accessible by both the </span><span class="font25" style="font-weight:bold;">squid server </span><span class="font25">(which uses the user named </span><span class="font25" style="font-weight:bold;">proxy </span><span class="font25">and by the </span><span class="font25" style="font-weight:bold;">apache2 </span><span class="font25">webserver (which uses the user </span><span class="font25" style="font-weight:bold;">www-data</span><span class="font25">. The screenshot below shows how to create this directory, set the permissions and make the users a member of the other groups.</span></p>
<p><span class="font19">root@debian7:~# mkdir /var/www/images</span></p>
<p><span class="font19">root@debian7:~# chown www-data:www-data /var/www/images</span></p>
<p><span class="font19">root@debian7:~# chmod 755 /var/www/images</span></p>
<p><span class="font19">root@debian7:~# usermod -aG www-data proxy</span></p>
<p><span class="font19">root@debian7:~# usermod -aG proxy www-data</span></p>
<p><span class="font25">Test that it works after restarting </span><span class="font25" style="font-weight:bold;">squid </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">apache2</span><span class="font25">.</span></p><img src="linux_guide_files/The Complete Linux Guide-152.jpg" alt="" style="width:284pt;height:259pt;">
<ul style="list-style:none;"><li>
<h2><a name="bookmark8295"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7758"></a><a name="bookmark8296"></a>2.7. /var/log/squid</span></h2></li></ul>
<p><a name="bookmark8297"></a><span class="font25">The standard log file location for squid is </span><span class="font25" style="font-weight:bold;">/var/log/squid</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL4 ~]# grep &quot;/var/log&quot; /etc/squid/squid.conf</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># cache_access_log /var/log/squid/access.log</span></p></li>
<li>
<p><span class="font19"># cache_log /var/log/squid/cache.log</span></p></li>
<li>
<p><span class="font19"># cache_store_log /var/log/squid/store.log</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8298"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7759"></a><a name="bookmark8299"></a>2.8. access control</span></h2></li></ul>
<p><span class="font25">The default squid setup only allows localhost access. To enable access for a private network range, look for the &quot;INSERT YOUR OWN RULE(S) HERE...&quot; sentence in squid.conf and add two lines similar to the screenshot below.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS</span></p></li></ul>
<p><span class="font19">acl company_network src 192.168.1.0/24 http_access allow company_network</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8300"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7760"></a><a name="bookmark8301"></a>2.9. testing squid</span></h2></li></ul>
<p><span class="font25">First, make sure that the server running squid has access to the internet.</span></p>
<p><span class="font19">[root@RHEL4 ~]# wget -q </span><a href="http://linux-training.be/index.html"><span class="font19">http://linux-training.be/index.html</span></a></p>
<p><span class="font19">[root@RHEL4 ~]# ls -l index.html</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-r--r-- &nbsp;1 root root 2269 Sep 18 13:18 index.html</span></p></li></ul>
<p><span class="font19">[root@RHEL4 ~]#</span></p>
<p><span class="font25">Then configure a browser on a client to use the proxy server, or you could set the HTTP_PROXY (sometimes http_proxy) variable to point command line programs to the proxy.</span></p>
<p><span class="font19">[root@fedora ~]# export HTTP_PROXY=</span><a href="http://192.168.1.39:8080"><span class="font19">http://192.168.1.39:8080</span></a></p>
<p><span class="font19">[root@ubuntu ~]# export http_proxy=</span><a href="http://192.168.1.39:8080"><span class="font19">http://192.168.1.39:8080</span></a></p>
<p><span class="font25">Testing a client machine can then be done with wget (wget -q is used to simplify the screenshot).</span></p>
<p><span class="font19">[root@RHEL5 ~]# &gt;&nbsp;/etc/resolv.conf</span></p>
<p><span class="font19">[root@RHEL5 ~]# wget -q </span><a href="http://www.linux-training.be/index.html"><span class="font19">http://www.linux-training.be/index.html</span></a></p>
<p><span class="font19">[root@RHEL5 ~]# ls -l index.html</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-r--r-- 1 root root 2269 Sep 18 &nbsp;2008 index.html</span></p></li></ul>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8302"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7761"></a><a name="bookmark8303"></a>2.10. name resolution</span></h2></li></ul>
<p><span class="font25">You need name resolution working on the </span><span class="font25" style="font-weight:bold;">squid </span><span class="font25">server, but you don't need name resolution on the clients.</span></p>
<p><span class="font19">[paul@RHEL5 ~]$ wget </span><a href="http://grep.be"><span class="font19">http://grep.be</span></a></p>
<ul style="list-style:none;"><li>
<p><span class="font19">--14:35:44-- </span><a href="http://grep.be"><span class="font19">http://grep.be</span></a></p></li></ul>
<p><span class="font19">Resolving grep.be... failed: Temporary failure in name resolution.</span></p>
<p><span class="font19">[paul@RHEL5 ~]$ export http_proxy=</span><a href="http://192.168.1.39:8080"><span class="font19">http://192.168.1.39:8080</span></a></p>
<p><span class="font19">[paul@RHEL5 ~]$ wget </span><a href="http://grep.be"><span class="font19">http://grep.be</span></a></p>
<p><span class="font19">--14:35:49-- </span><a href="http://grep.be/"><span class="font19">http://grep.be/</span></a></p>
<p><span class="font19">Connecting to 192.168.1.39:8080... connected.</span></p>
<p><span class="font19">Proxy request sent, awaiting response... 200 OK</span></p>
<p><span class="font19">Length: 5390 (5.3K) [text/html]</span></p>
<p><span class="font19">Saving to: 'index.html.1'</span></p>
<p><span class="font19">100%[================================&gt;] 5,390 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--.-K/s in 0.1s</span></p>
<p><span class="font19">14:38:29 (54.8 KB/s) - 'index.html' saved [5390/5390] [paul@RHEL5 ~]$</span></p>
<p><a name="bookmark8304"></a><span class="font11" style="font-weight:bold;">Part II. mysql database</span></p>
<h3><a name="bookmark8305"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8306"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8307"><span class="font24" style="font-weight:bold;">3. introduction to sql using mysql </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8308"><span class="font24">3.1. installing mysql </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8309"><span class="font24">3.2. accessing mysql </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8310"><span class="font24">3.3. mysql databases </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8311"><span class="font24">3.4. mysql tables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8312"><span class="font24">3.5. mysql records </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8313"><span class="font24">3.6. joining two tables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8314"><span class="font24">3.7. mysql triggers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark8315"></a><span class="font11" style="font-weight:bold;"><a name="bookmark7763"></a><a name="bookmark8316"></a>Chapter 3. introduction to sql using mysql</span></h1></li></ul>
<p><a name="bookmark8317"></a><span class="font25" style="font-weight:bold;"><a name="bookmark8318"></a>mysql </span><span class="font25">is a database server that understands Structured Query Language (</span><span class="font25" style="font-weight:bold;">SQL</span><span class="font25">). MySQL was developed by the Swedish Company </span><span class="font25" style="font-weight:bold;">MySQL AB</span><span class="font25">. The first release was in 1995. In 2008 MySQL AB was bought by Sun Microsystems (which is now owned by Oracle).</span></p>
<p><a name="bookmark8319"></a><span class="font25" style="font-weight:bold;"><a name="bookmark8320"></a>mysql </span><span class="font25">is very popular for websites in combination with </span><span class="font25" style="font-weight:bold;">php </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">apache </span><span class="font25">(the </span><span class="font25" style="font-weight:bold;">m </span><span class="font25">in </span><span class="font25" style="font-weight:bold;">lamp </span><span class="font25">servers), but </span><span class="font25" style="font-weight:bold;">mysql </span><span class="font25">is also used in organizations with huge databases like Facebook, Flickr, Google, Nokia, Wikipedia and Youtube.</span></p>
<p><span class="font25">This chapter will teach you </span><span class="font25" style="font-weight:bold;">sql </span><span class="font25">by creating and using small databases, tables, queries and a simple trigger in a local </span><span class="font25" style="font-weight:bold;">mysql </span><span class="font25">server.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8321"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7764"></a><a name="bookmark8322"></a>3.1. installing mysql</span></h2></li></ul>
<p><a name="bookmark8323"></a><span class="font25"><a name="bookmark8324"></a><a name="bookmark8325"></a>On Debian/Ubuntu you can use </span><span class="font25" style="font-weight:bold;">aptitude install mysql-server </span><span class="font25">to install the </span><span class="font25" style="font-weight:bold;">mysql server </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">client</span><span class="font25">.</span></p>
<p><span class="font19">root@ubu1204~# aptitude install mysql-server</span></p>
<p><span class="font19">The following NEW packages will be installed:</span></p>
<p><span class="font19">libdbd-mysql-perl{a} libdbi-perl{a} libhtml-template-perl{a} libnet-daemon-perl{a} libplrpc-perl{a} mysql-client-5.5{a} mysql-client-core-5.5{a} mysql-server mysql-server-5.5{a}</span></p>
<p><span class="font19">mysql-server-core-5.5{a}</span></p>
<p><span class="font19">0 packages upgraded, 10 newly installed, 0 to remove and 1 not upgraded.</span></p>
<p><span class="font19">Need to get 25.5 MB of archives. After unpacking 88.4 MB will be used.</span></p>
<p><span class="font19">Do you want to continue? [Y/n/?]</span></p>
<h4><a name="bookmark8326"></a><span class="font25"><a name="bookmark8327"></a><a name="bookmark8328"></a>During the installation you will be asked to provide a password for the </span><span class="font25" style="font-weight:bold;">root mysql user</span><span class="font25">, remember this password (or use </span><span class="font25" style="font-weight:bold;">hunter2 </span><span class="font25">like i do.</span></h4>
<h4><a name="bookmark8329"></a><span class="font25"><a name="bookmark8330"></a><a name="bookmark8331"></a>To verify the installed version, use </span><span class="font25" style="font-weight:bold;">dpkg -l </span><span class="font25">on Debian/Ubuntu. This screenshot shows version 5.0 installed.</span></h4>
<p><span class="font19">root@ubu1204~# dpkg -l mysql-server | tail -1 | tr -s ' ' | cut -c-72 ii mysql-server 5.5.24-0ubuntu0.12.04.1 MySQL database server (metapacka</span></p>
<h4><a name="bookmark8332"></a><span class="font25"><a name="bookmark8333"></a><a name="bookmark8334"></a>Issue </span><span class="font25" style="font-weight:bold;">rpm -q </span><span class="font25">to get version information about MySQL on Red Hat/Fedora/CentOS.</span></h4>
<p><span class="font19">[paul@RHEL52 ~]$ rpm -q mysql-server</span></p>
<p><span class="font19">mysql-server-5.0.45-7.el5</span></p>
<h4><a name="bookmark8335"></a><span class="font25"><a name="bookmark8336"></a><a name="bookmark8337"></a>You will need at least version 5.0 to work with </span><span class="font25" style="font-weight:bold;">triggers</span><span class="font25">.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8338"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7765"></a><a name="bookmark8339"></a>3.2. accessing mysql</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8340"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8341"></a>3.2.1. Linux users</span></h3></li></ul></li></ul>
<p><a name="bookmark8342"></a><span class="font25"><a name="bookmark8343"></a><a name="bookmark8344"></a><a name="bookmark8345"></a>The installation of </span><span class="font25" style="font-weight:bold;">mysql </span><span class="font25">creates a user account in </span><span class="font25" style="font-weight:bold;">/etc/passwd </span><span class="font25">and a group account in </span><span class="font25" style="font-weight:bold;">/ etc/group</span><span class="font25">.</span></p>
<p><span class="font19">kevin@ubu1204:~$ tail -1 /etc/passwd</span></p>
<p><span class="font19">mysql:x:120:131:MySQL Server,,,:/nonexistent:/bin/false kevin@ubu1204:~$ tail -1 /etc/group</span></p>
<p><span class="font19">mysql:x:131:</span></p>
<p><a name="bookmark8346"></a><span class="font25">The mysql daemon </span><span class="font25" style="font-weight:bold;">mysqld </span><span class="font25">will run with the credentials of this user and group.</span></p>
<p><span class="font19">root@ubu1204~# ps -eo uid,user,gid,group,comm | grep mysqld</span></p>
<p><span class="font19">120 mysql &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;131 mysql mysqld</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8347"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8348"></a>3.2.2. mysql client application</span></h3></li></ul>
<p><a name="bookmark8349"></a><span class="font25">You can now use mysql from the commandline by just typing </span><span class="font25" style="font-weight:bold;">mysql -u root -p </span><span class="font25">and you 'll be asked for the password (of the </span><span class="font25" style="font-weight:bold;">mysql root </span><span class="font25">account). In the screenshot below the user typed </span><span class="font25" style="font-weight:bold;">exit </span><span class="font25">to exit the mysql console.</span></p>
<p><span class="font19">root@ubu1204~# mysql -u root -p</span></p>
<p><span class="font19">Enter password:</span></p>
<p><span class="font19">Welcome to the MySQL monitor. Commands end with ; or \g.</span></p>
<p><span class="font19">Your MySQL connection id is 43</span></p>
<p><span class="font19">Server version: 5.5.24-0ubuntu0.12.04.1 (Ubuntu)</span></p>
<p><span class="font19">Copyright (c) 2000, 2011, Oracle and/or its affiliates. All rights reserved.</span></p>
<p><span class="font19">Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners.</span></p>
<p><span class="font19">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span></p>
<p><span class="font19">mysql&gt; </span><span class="font19" style="font-weight:bold;">exit</span></p>
<p><span class="font19">Bye</span></p>
<p><span class="font25">You could also put the password in clear text on the command line, but that would not be very secure. Anyone with access to your bash history would be able to read your mysql root password.</span></p>
<p><span class="font19">root@ubu1204~# mysql -u root -phunter2</span></p>
<p><span class="font19">Welcome to the MySQL monitor. Commands end with ; or \g.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8350"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8351"></a>3.2.3. ~/.my.cnf</span></h3></li></ul>
<p><a name="bookmark8352"></a><span class="font25">You can save configuration in your home directory in the hidden file </span><span class="font25" style="font-weight:bold;">.my.cnf</span><span class="font25">. In the screenshot below we put the root user and password in .my.cnf.</span></p>
<p><span class="font19">kevin@ubu1204:~$ pwd</span></p>
<p><span class="font19">/home/kevin</span></p>
<p><span class="font19">kevin@ubu1204:~$ cat .my.cnf</span></p>
<p><span class="font19">[client]</span></p>
<p><span class="font19">user=root</span></p>
<p><span class="font19">password=hunter2</span></p>
<p><span class="font19">kevin@ubu1204:~$</span></p>
<p><span class="font25">This enables us to log on as the </span><span class="font25" style="font-weight:bold;">root mysql </span><span class="font25">user just by typing </span><span class="font25" style="font-weight:bold;">mysql</span><span class="font25">.</span></p>
<p><span class="font19">kevin@ubu1204:~$ mysql</span></p>
<p><span class="font19">Welcome to the MySQL monitor. Commands end with ; or \g.</span></p>
<p><span class="font19">Your MySQL connection id is 56</span></p>
<p><span class="font19">Server version: 5.5.24-0ubuntu0.12.04.1 (Ubuntu)</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8353"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8354"></a>3.2.4. the mysql command line client</span></h3></li></ul>
<p><a name="bookmark8355"></a><span class="font25">You can use the </span><span class="font25" style="font-weight:bold;">mysql </span><span class="font25">command to take a look at the databases, and to execute SQL queries on them. The screenshots below show you how.</span></p>
<p><span class="font25">Here we execute the command </span><span class="font25" style="font-weight:bold;">show databases</span><span class="font25">. Every command must be terminated by a delimiter. The default delimiter is </span><span class="font25" style="font-weight:bold;">; </span><span class="font25">(the semicolon).</span></p>
<p><span class="font19">mysql&gt; show databases;</span></p>
<p><a href="#bookmark8356"><span class="font19">+</span></a></p>
<p><a href="#bookmark8357"><span class="font19">| Database</span></a></p>
<p><a href="#bookmark8358"><span class="font19">+</span></a></p>
<p><span class="font19">| information_schema |</span></p>
<p><a href="#bookmark8359"><span class="font19">| mysql</span></a></p>
<p><span class="font19">| performance_schema |</span></p>
<p><a href="#bookmark8360"><span class="font19">| test</span></a></p>
<p><a href="#bookmark8361"><span class="font19">+</span></a></p>
<p><span class="font19">4 rows in set (0.00 sec)</span></p>
<p><span class="font25">We will use this prompt in the next sections.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8362"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7762"></a><a name="bookmark8363"></a>3.3. mysql databases</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8364"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8365"></a>3.3.1. listing all databases</span></h3></li></ul></li></ul>
<h4><a name="bookmark8366"></a><span class="font25"><a name="bookmark8367"></a><a name="bookmark8368"></a>You can use the </span><span class="font25" style="font-weight:bold;">mysql </span><span class="font25">command to take a look at the databases, and to execute SQL queries on them. The screenshots below show <a name="bookmark8369"></a>you how. First, we log on to our MySQL server and execute the command </span><span class="font25" style="font-weight:bold;">show databases </span><span class="font25">to see which databases exist on our mysql server.</span></h4>
<p><span class="font19">kevin@ubu1204:~$ mysql</span></p>
<p><span class="font19">Welcome to the MySQL monitor. Commands end with ; or \g.</span></p>
<p><span class="font19">Your MySQL connection id is 57 Server version: 5.5.24-0ubuntu0.12.04.1 (Ubuntu)</span></p>
<p><span class="font19">Copyright (c) 2000, 2011, Oracle and/or its affiliates. All rights reserved.</span></p>
<p><span class="font19">Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners.</span></p>
<p><span class="font19">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span></p>
<p><span class="font19">mysql&gt; show databases;</span></p>
<p><a href="#bookmark8370"><span class="font19">+</span></a></p>
<p><a href="#bookmark8371"><span class="font19">| Database</span></a></p>
<p><a href="#bookmark8372"><span class="font19">+</span></a></p>
<p><span class="font19">| information_schema |</span></p>
<p><a href="#bookmark8373"><span class="font19">| mysql</span></a></p>
<p><span class="font19">| performance_schema |</span></p>
<p><a href="#bookmark8374"><span class="font19">| test</span></a></p>
<p><a href="#bookmark8375"><span class="font19">+</span></a></p>
<p><span class="font19">4 rows in set (0.00 sec)</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8376"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8377"></a>3.3.2. creating a database</span></h3></li></ul>
<h4><a name="bookmark8378"></a><span class="font25"><a name="bookmark8379"></a><a name="bookmark8380"></a>You can create a new database with the </span><span class="font25" style="font-weight:bold;">create database </span><span class="font25">command.</span></h4>
<p><span class="font19">mysql&gt; create database famouspeople;</span></p>
<p><span class="font19">Query OK, 1 row affected (0.00 sec)</span></p>
<p><span class="font19">mysql&gt; show databases;</span></p>
<p><a href="#bookmark8381"><span class="font19">+</span></a></p>
<p><a href="#bookmark8382"><span class="font19">| Database</span></a></p>
<p><a href="#bookmark8383"><span class="font19">+</span></a></p>
<p><span class="font19">| information_schema |</span></p>
<p><a href="#bookmark8384"><span class="font19">| famouspeople</span></a></p>
<p><a href="#bookmark8385"><span class="font19">| mysql</span></a></p>
<p><span class="font19">| performance_schema |</span></p>
<p><a href="#bookmark8386"><span class="font19">| test</span></a></p>
<p><a href="#bookmark8387"><span class="font19">+</span></a></p>
<p><span class="font19">5 rows in set (0.00 sec)</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8388"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8389"></a>3.3.3. using a database</span></h3></li></ul>
<p><a name="bookmark8390"></a><span class="font25">Next we tell </span><span class="font25" style="font-weight:bold;">mysql </span><span class="font25">to use one particular database with the </span><span class="font25" style="font-weight:bold;">use $database </span><span class="font25">command. This screenshot shows how to make wikidb the current database (in use).</span></p>
<p><span class="font19">mysql&gt; use famouspeople; Database changed mysql&gt;</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8391"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8392"></a>3.3.4. access to a database</span></h3></li></ul>
<p><a name="bookmark8393"></a><span class="font25">To give someone access to a mysql database, use the </span><span class="font25" style="font-weight:bold;">grant </span><span class="font25">command.</span></p>
<p><span class="font19">mysql&gt; grant all on famouspeople.* to kevin@localhost IDENTIFIED BY &quot;hunter2&quot;; Query OK, 0 rows affected (0.00 sec)</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8394"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8395"></a>3.3.5. deleting a database</span></h3></li></ul>
<p><a name="bookmark8396"></a><span class="font25">When a database is no longer needed, you can permanently remove it with the </span><span class="font25" style="font-weight:bold;">drop database </span><span class="font25">command.</span></p>
<p><span class="font19">mysql&gt; drop database demodb;</span></p>
<p><span class="font19">Query OK, 1 row affected (0.09 sec)</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8397"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8398"></a>3.3.6. backup and restore a database</span></h3></li></ul>
<p><span class="font25">You can take a backup of a database, or move it to another computer using the </span><span class="font25" style="font-weight:bold;">mysql </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">mysqldump </span><span class="font25">commands. In the screenshot below, we take a backup of the wikidb database on the computer named laika.</span></p>
<p><span class="font19">mysqldump -u root famouspeople &gt;&nbsp;famouspeople.backup.20120708.sql</span></p>
<p><span class="font25">Here is a screenshot of a database restore operation from this backup.</span></p>
<p><span class="font19">mysql -u root famouspeople &lt;&nbsp;famouspeople.backup.20120708.sql</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8399"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7766"></a><a name="bookmark8400"></a>3.4. mysql tables</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8401"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8402"></a>3.4.1. listing tables</span></h3></li></ul></li></ul>
<p><a name="bookmark8403"></a><span class="font25">You can see a list of tables in the current database with the </span><span class="font25" style="font-weight:bold;">show tables; </span><span class="font25">command. Our </span><span class="font25" style="font-weight:bold;">famouspeople </span><span class="font25">database has no tables yet.</span></p>
<p><span class="font19">mysql&gt; use famouspeople;</span></p>
<p><span class="font19">Database changed mysql&gt; show tables;</span></p>
<p><span class="font19">Empty set (0.00 sec)</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8404"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8405"></a>3.4.2. creating a table</span></h3></li></ul>
<p><a name="bookmark8406"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">create table </span><span class="font25">command will create a new table.</span></p>
<p><a name="bookmark8407"></a><span class="font25"><a name="bookmark8408"></a><a name="bookmark8409"></a>This screenshot shows the creation of a country table. We use the </span><span class="font25" style="font-weight:bold;">countrycode </span><span class="font25">as a </span><span class="font25" style="font-weight:bold;">primary key </span><span class="font25">(all country codes are uniquely defined). Most country codes are two or three letters, so a </span><span class="font25" style="font-weight:bold;">char </span><span class="font25">of three uses less space than a </span><span class="font25" style="font-weight:bold;">varchar </span><span class="font25">of three. The </span><span class="font25" style="font-weight:bold;">country name </span><span class="font25">and the name of the capital are both defined as </span><span class="font25" style="font-weight:bold;">varchar</span><span class="font25">. The population can be seen as an </span><span class="font25" style="font-weight:bold;">integer</span><span class="font25">.</span></p>
<p><span class="font19">mysql&gt; create table country (</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- &gt;&nbsp;countrycode char(3) NOT NULL,</span></p></li>
<li>
<p><span class="font19">- &gt;&nbsp;countryname varchar(70) NOT NULL,</span></p></li>
<li>
<p><span class="font19">- &gt;&nbsp;population int,</span></p></li>
<li>
<p><span class="font19">- &gt;&nbsp;countrycapital varchar(50),</span></p></li>
<li>
<p><span class="font19">- &gt;&nbsp;primary key (countrycode)</span></p></li>
<li>
<p><span class="font19">- &gt;&nbsp;);</span></p></li></ul>
<p><span class="font19">Query OK, 0 rows affected (0.19 sec)</span></p>
<p><a href="#bookmark8410"><span class="font19">mysql&gt; show tables; +</span></a></p>
<p><span class="font19">| Tables_in_famouspeople |</span></p>
<p><a href="#bookmark8411"><span class="font19">+</span></a></p>
<p><a href="#bookmark8412"><span class="font19">| country</span></a></p>
<p><a href="#bookmark8413"><span class="font19">+</span></a></p>
<p><span class="font19">1 row in set (0.00 sec)</span></p>
<p><span class="font19">mysql&gt;</span></p>
<p><span class="font25">You are allowed to type the </span><span class="font25" style="font-weight:bold;">create table </span><span class="font25">command on one long line, but administrators often use multiple lines to improve readability.</span></p>
<p><span class="font19">mysql&gt; create table country ( countrycode char(3) NOT NULL, countryname\ varchar(70) NOT NULL, population int, countrycapital varchar(50), prim\ ary key (countrycode) );</span></p>
<p><span class="font19">Query OK, 0 rows affected (0.18 sec)</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8414"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8415"></a>3.4.3. describing a table</span></h3></li></ul>
<h4><a name="bookmark8416"></a><span class="font25"><a name="bookmark8417"></a><a name="bookmark8418"></a>To see a description of the structure of a table, issue the </span><span class="font25" style="font-weight:bold;">describe $tablename </span><span class="font25">command as shown below.</span></h4>
<p><span class="font19">mysql&gt; describe country;</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">+ ■</span></p>
<p><span class="font19">|</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">Field</span></p></td><td style="vertical-align:top;">
<p><span class="font19">- + -|</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">Type</span></p></td><td style="vertical-align:top;">
<p><span class="font19">- + -|</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">Null</span></p></td><td style="vertical-align:top;">
<p><span class="font19">- + -|</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">Key</span></p></td><td style="vertical-align:top;">
<p><span class="font19">- + • |</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">Default</span></p></td><td style="vertical-align:top;">
<p><span class="font19">- + -|</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-------+</span></p>
<p><span class="font19">Extra |</span></p></td></tr>
<tr><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">countrycode</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">char(3)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">NO</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">PRI</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">NULL</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">|</span></p></td><td style="vertical-align:top;">
<p><span class="font19">countryname</span></p></td><td style="vertical-align:top;">
<p><span class="font19">|</span></p></td><td style="vertical-align:top;">
<p><span class="font19">varchar(70)</span></p></td><td style="vertical-align:top;">
<p><span class="font19">|</span></p></td><td style="vertical-align:top;">
<p><span class="font19">NO</span></p></td><td style="vertical-align:top;">
<p><span class="font19">|</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">|</span></p></td><td style="vertical-align:top;">
<p><span class="font19">NULL</span></p></td><td style="vertical-align:top;">
<p><span class="font19">|</span></p></td><td style="vertical-align:top;">
<p><span class="font19">|</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">population</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">int(11)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">YES</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">NULL</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p>
<p><span class="font19">+ ■</span></p></td><td style="vertical-align:top;">
<p><span class="font19">countrycapital</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p>
<p><span class="font19">- + -</span></p></td><td style="vertical-align:top;">
<p><span class="font19">varchar(50)</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p>
<p><span class="font19">- + -</span></p></td><td style="vertical-align:top;">
<p><span class="font19">YES</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p>
<p><span class="font19">- + -</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p>
<p><span class="font19">- + •</span></p></td><td style="vertical-align:top;">
<p><span class="font19">NULL</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p>
<p><span class="font19">- + -</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">| -------+</span></p></td></tr>
</table>
<p><span class="font19">4 rows in set (0.00 sec)</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8419"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8420"></a>3.4.4. removing a table</span></h3></li></ul>
<h4><a name="bookmark8421"></a><span class="font25"><a name="bookmark8422"></a><a name="bookmark8423"></a>To remove a table from a database, issue the </span><span class="font25" style="font-weight:bold;">drop table $tablename </span><span class="font25">command as shown below.</span></h4>
<p><span class="font19">mysql&gt; drop table country;</span></p>
<p><span class="font19">Query OK, 0 rows affected (0.00 sec)</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8424"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7768"></a><a name="bookmark8425"></a>3.5. mysql records</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8426"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8427"></a>3.5.1. creating records</span></h3></li></ul></li></ul>
<h4><a name="bookmark8428"></a><span class="font25"><a name="bookmark8429"></a><a name="bookmark8430"></a>Use </span><span class="font25" style="font-weight:bold;">insert </span><span class="font25">to enter data into the table. The screenshot shows several insert statements that insert values depending on the position of the data in the statement.</span></h4>
<p><span class="font19">mysql&gt; insert into country values ('BE','Belgium','11000000','Brussels');</span></p>
<p><span class="font19">Query OK, 1 row affected (0.05 sec)</span></p>
<p><span class="font19">mysql&gt; insert into country values ('DE','Germany','82000000','Berlin');</span></p>
<p><span class="font19">Query OK, 1 row affected (0.05 sec)</span></p>
<p><span class="font19">mysql&gt; insert into country values ('JP','Japan','128000000','Tokyo');</span></p>
<p><span class="font19">Query OK, 1 row affected (0.05 sec)</span></p>
<h4><a name="bookmark8431"></a><span class="font25"><a name="bookmark8432"></a><a name="bookmark8433"></a>Some administrators prefer to use uppercase for </span><span class="font25" style="font-weight:bold;">sql </span><span class="font25">keywords. The mysql client accepts both.</span></h4>
<p><span class="font19">mysql&gt; INSERT INTO country VALUES ('FR','France','64000000','Paris');</span></p>
<p><span class="font19">Query OK, 1 row affected (0.00 sec)</span></p>
<h4><a name="bookmark8434"></a><span class="font25"><a name="bookmark8435"></a>Note that you get an error when using a duplicate </span><span class="font25" style="font-weight:bold;">primary key</span><span class="font25">.</span></h4>
<p><span class="font19">mysql&gt; insert into country values ('DE','Germany','82000000','Berlin');</span></p>
<p><span class="font19">ERROR 1062 (23000): Duplicate entry 'DE' for key 'PRIMARY'</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8436"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8437"></a>3.5.2. viewing all records</span></h3></li></ul>
<h4><a name="bookmark8438"></a><span class="font25"><a name="bookmark8439"></a><a name="bookmark8440"></a>Below an example of a simple </span><span class="font25" style="font-weight:bold;">select </span><span class="font25">query to look at the contents of a table.</span></h4>
<table border="1">
<tr><td colspan="2" style="vertical-align:top;">
<p><span class="font19">mysql&gt;</span></p></td><td style="vertical-align:top;">
<p><span class="font19">select</span></p></td><td style="vertical-align:top;">
<p><span class="font19">*</span></p></td><td style="vertical-align:top;">
<p><span class="font19">from country;</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td rowspan="3" style="vertical-align:middle;">
<p><span class="font19">|</span></p>
<p><span class="font19">+ |</span></p>
<p><span class="font19">|</span></p>
<p><span class="font19">+</span></p>
<p><span class="font19">8</span></p></td><td colspan="2" style="vertical-align:middle;">
<p><span class="font19">countrycode</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">|</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">countryname</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">|</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">population</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">|</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">countrycapital</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">|</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">BE CN DE FR IN JP MX US</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:middle;">
<p><span class="font19">|</span></p>
<p><span class="font19">|</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">Belgium China Germany France India Japan Mexico</span></p>
<p><span class="font19">United States</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">|</span></p>
<p><span class="font19">|</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">11000000</span></p>
<p><span class="font19">1400000000</span></p>
<p><span class="font19">82000000</span></p>
<p><span class="font19">64000000</span></p>
<p><span class="font19">1300000000</span></p>
<p><span class="font19">128000000</span></p>
<p><span class="font19">113000000</span></p>
<p><span class="font19">313000000</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">|</span></p>
<p><span class="font19">|</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">Brussels Beijing Berlin Paris</span></p>
<p><span class="font19">New Delhi</span></p>
<p><span class="font19">Tokyo Mexico City Washington</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">|</span></p>
<p><span class="font19">|</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">rows</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">in set</span></p></td><td colspan="2" style="vertical-align:middle;">
<p><span class="font19">(0.00 sec)</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8441"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8442"></a>3.5.3. updating records</span></h3></li></ul>
<h4><a name="bookmark8443"></a><span class="font25"><a name="bookmark8444"></a>Consider the following </span><span class="font25" style="font-weight:bold;">insert </span><span class="font25">statement. The capital of Spain is not Barcelona, it is Madrid.</span></h4>
<p><span class="font19">mysql&gt; insert into country values ('ES','Spain','48000000','Barcelona'); Query OK, 1 row affected (0.08 sec)</span></p>
<h4><a name="bookmark8445"></a><span class="font25"><a name="bookmark8446"></a><a name="bookmark8447"></a>Using an </span><span class="font25" style="font-weight:bold;">update </span><span class="font25">statement, the record can be updated.</span></h4>
<p><span class="font19">mysql&gt; update country set countrycapital='Madrid' where countrycode='ES'; Query OK, 1 row affected (0.07 sec)</span></p>
<p><span class="font19">Rows matched: 1 Changed: 1 Warnings: 0</span></p>
<h4><a name="bookmark8448"></a><span class="font25"><a name="bookmark8449"></a><a name="bookmark8450"></a>We can use a </span><span class="font25" style="font-weight:bold;">select </span><span class="font25">statement to verify this change.</span></h4>
<table border="1">
<tr><td colspan="2" style="vertical-align:top;">
<p><span class="font19">mysql&gt;</span></p></td><td style="vertical-align:top;">
<p><span class="font19">select</span></p></td><td style="vertical-align:top;">
<p><span class="font19">*</span></p></td><td style="vertical-align:top;">
<p><span class="font19">from country;</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td rowspan="3" style="vertical-align:middle;">
<p><span class="font19">|</span></p>
<p><span class="font19">+ |</span></p>
<p><span class="font19">|</span></p>
<p><span class="font19">+</span></p>
<p><span class="font19">9</span></p></td><td colspan="2" style="vertical-align:middle;">
<p><span class="font19">countrycode</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">|</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">countryname</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">|</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">population</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">|</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">countrycapital</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">|</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">BE CN DE ES FR IN JP MX US</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:middle;">
<p><span class="font19">|</span></p>
<p><span class="font19">|</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">Belgium China Germany Spain France India Japan Mexico United States</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">|</span></p>
<p><span class="font19">|</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">11000000</span></p>
<p><span class="font19">1400000000</span></p>
<p><span class="font19">82000000</span></p>
<p><span class="font19">48000000</span></p>
<p><span class="font19">64000000</span></p>
<p><span class="font19">1300000000</span></p>
<p><span class="font19">128000000</span></p>
<p><span class="font19">113000000</span></p>
<p><span class="font19">313000000</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">|</span></p>
<p><span class="font19">|</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">Brussels Beijing Berlin Madrid Paris New Delhi Tokyo Mexico City Washington</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">|</span></p>
<p><span class="font19">|</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">rows</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">in set</span></p></td><td colspan="2" style="vertical-align:middle;">
<p><span class="font19">(0.00 sec)</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8451"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8452"></a>3.5.4. viewing selected records</span></h3></li></ul>
<h4><a name="bookmark8453"></a><span class="font25"><a name="bookmark8454"></a><a name="bookmark8455"></a>Using a </span><span class="font25" style="font-weight:bold;">where </span><span class="font25">clause in a </span><span class="font25" style="font-weight:bold;">select </span><span class="font25">statement, you can specify which record(s) you want to see.</span></h4>
<p><a href="#bookmark8456"><span class="font19">mysql&gt; SELECT * FROM country WHERE countrycode='ES'; +-------------+-------------+------------+</span></a></p>
<p><span class="font19">| countrycode | countryname | population | countrycapital |</span></p>
<p><a href="#bookmark8457"><span class="font19">+-------------+-------------+------------+</span></a></p>
<p><a href="#bookmark8458"><span class="font19">| ES &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| Spain &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| &nbsp;&nbsp;&nbsp;48000000 | Madrid</span></a></p>
<p><a href="#bookmark8459"><span class="font19">+-------------+-------------+------------+</span></a></p>
<p><span class="font19">1 row in set (0.00 sec)</span></p>
<p><a name="bookmark8460"></a><span class="font25"><a name="bookmark8461"></a>Another example of the </span><span class="font25" style="font-weight:bold;">where </span><span class="font25">clause.</span></p>
<p><a href="#bookmark8462"><span class="font19">mysql&gt; select * from country where countryname='Spain'; +-------------+-------------+------------+</span></a></p>
<p><span class="font19">| countrycode | countryname | population | countrycapital |</span></p>
<p><a href="#bookmark8463"><span class="font19">+-------------+-------------+------------+</span></a></p>
<p><a href="#bookmark8464"><span class="font19">| ES &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| Spain &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| &nbsp;&nbsp;&nbsp;48000000 | Madrid</span></a></p>
<p><a href="#bookmark8465"><span class="font19">+-------------+-------------+------------+</span></a></p>
<p><span class="font19">1 row in set (0.00 sec)</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8466"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8467"></a>3.5.5. primary key in where clause ?</span></h3></li></ul>
<h4><a name="bookmark8468"></a><span class="font25"><a name="bookmark8469"></a>The </span><span class="font25" style="font-weight:bold;">primary key </span><span class="font25">of a table is a field that uniquely identifies every record (every row) in the table. when using another field in the </span><span class="font25" style="font-weight:bold;">where </span><span class="font25">clause, it is possible to get multiple rows returned.</span></h4>
<p><span class="font19">mysql&gt; insert into country values ('EG','Egypt','82000000','Cairo');</span></p>
<p><span class="font19">Query OK, 1 row affected (0.33 sec)</span></p>
<p><span class="font19">mysql&gt; select * from country where population='82000000';</span></p>
<p><a href="#bookmark8470"><span class="font19">+-------------+-------------+------------+</span></a></p>
<p><span class="font19">| countrycode | countryname | population | countrycapital |</span></p>
<p><a href="#bookmark8471"><span class="font19">+-------------+-------------+------------+</span></a></p>
<p><a href="#bookmark8472"><span class="font19">| DE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| Germany &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| &nbsp;&nbsp;&nbsp;82000000 | Berlin</span></a></p>
<p><a href="#bookmark8473"><span class="font19">| EG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| Egypt &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| &nbsp;&nbsp;&nbsp;82000000 | Cairo</span></a></p>
<p><a href="#bookmark8474"><span class="font19">+-------------+-------------+------------+</span></a></p>
<p><span class="font19">2 rows in set (0.00 sec)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font9" style="font-weight:bold;">3.5.6. ordering records</span></p></li></ul>
<p><span class="font25">We know that </span><span class="font25" style="font-weight:bold;">select </span><span class="font25">allows us to see all records in a table. Consider this table.</span></p>
<p><span class="font19">mysql&gt; select countryname,population from country;</span></p>
<p><span class="font19">+---------------+------------+</span></p>
<p><span class="font19">| countryname | population |</span></p>
<table border="1">
<tr><td colspan="2" style="vertical-align:top;">
<p><span class="font19">+---------------+------------+</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">| Belgium</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">11000000 |</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| China</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1400000000 |</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Germany</span></p></td><td style="vertical-align:top;">
<p><span class="font19">82000000 |</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Egypt</span></p></td><td style="vertical-align:top;">
<p><span class="font19">82000000 |</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Spain</span></p></td><td style="vertical-align:top;">
<p><span class="font19">48000000 |</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| France</span></p></td><td style="vertical-align:top;">
<p><span class="font19">64000000 |</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| India</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1300000000 |</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Japan</span></p></td><td style="vertical-align:top;">
<p><span class="font19">128000000 |</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Mexico</span></p></td><td style="vertical-align:top;">
<p><span class="font19">113000000 |</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| United States</span></p>
<p><span class="font19">+---------------</span></p></td><td style="vertical-align:top;">
<p><span class="font19">313000000 |</span></p>
<p><span class="font19">------------+</span></p></td></tr>
</table>
<p><span class="font19">10 rows in set (0.00 sec)</span></p>
<p><a name="bookmark8475"></a><span class="font25">Using the </span><span class="font25" style="font-weight:bold;">order by </span><span class="font25">clause, we can change the order in which the records are presented.</span></p>
<p><span class="font19">mysql&gt; select countryname,population from country order by countryname;</span></p>
<p><span class="font19">+---------------+------------+</span></p>
<p><span class="font19">| countryname | population |</span></p>
<table border="1">
<tr><td colspan="2" style="vertical-align:top;">
<p><span class="font19">+---------------+------------+</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">| Belgium</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">11000000 |</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| China</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1400000000 |</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Egypt</span></p></td><td style="vertical-align:top;">
<p><span class="font19">82000000 |</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| France</span></p></td><td style="vertical-align:top;">
<p><span class="font19">64000000 |</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Germany</span></p></td><td style="vertical-align:top;">
<p><span class="font19">82000000 |</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| India</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1300000000 |</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Japan</span></p></td><td style="vertical-align:top;">
<p><span class="font19">128000000 |</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Mexico</span></p></td><td style="vertical-align:top;">
<p><span class="font19">113000000 |</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Spain</span></p></td><td style="vertical-align:top;">
<p><span class="font19">48000000 |</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| United States</span></p>
<p><span class="font19">+---------------</span></p></td><td style="vertical-align:top;">
<p><span class="font19">313000000 |</span></p>
<p><span class="font19">------------+</span></p></td></tr>
</table>
<p><span class="font19">10 rows in set (0.00 sec)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font9" style="font-weight:bold;">3.5.7. grouping records</span></p></li></ul>
<p><span class="font25">Consider this table of people. The screenshot shows how to use the </span><span class="font25" style="font-weight:bold;">avg </span><span class="font25">function to calculate</span></p>
<p><span class="font25">an average.</span></p>
<p><span class="font19">mysql&gt; select * from people;</span></p>
<p><a href="#bookmark8476"><span class="font19">+-----------------+-----------+-----------+</span></a></p>
<p><span class="font19">| Name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| Field &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| birthyear | countrycode |</span></p>
<p><a href="#bookmark8477"><span class="font19">+-----------------+-----------+-----------+</span></a></p>
<p><a href="#bookmark8478"><span class="font19">| Barack Obama &nbsp;&nbsp;&nbsp;&nbsp;| politics &nbsp;| 1961 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| US</span></a></p>
<p><a href="#bookmark8479"><span class="font19">| Deng Xiaoping &nbsp;&nbsp;&nbsp;| politics &nbsp;| 1904 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| CN</span></a></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">| Guy Verhofstadt |</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">politics</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">| 1953</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">| BE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Justine Henin |</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tennis</span></p></td><td style="vertical-align:top;">
<p><span class="font19">| 1982</span></p></td><td style="vertical-align:top;">
<p><span class="font19">| BE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Kim Clijsters &nbsp;&nbsp;&nbsp;|</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tennis</span></p></td><td style="vertical-align:top;">
<p><span class="font19">| 1983</span></p></td><td style="vertical-align:top;">
<p><span class="font19">| BE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Li Na &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tennis</span></p></td><td style="vertical-align:top;">
<p><span class="font19">| 1982</span></p></td><td style="vertical-align:top;">
<p><span class="font19">| CN &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Liu Yang &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">astronaut</span></p></td><td style="vertical-align:top;">
<p><span class="font19">| 1978</span></p></td><td style="vertical-align:top;">
<p><span class="font19">| CN &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Serena Williams |</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tennis</span></p></td><td style="vertical-align:top;">
<p><span class="font19">| 1981</span></p></td><td style="vertical-align:top;">
<p><span class="font19">| us &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Venus Williams | +-----------------+</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tennis</span></p></td><td style="vertical-align:top;">
<p><span class="font19">| 1980</span></p>
<p><span class="font19">- +--------</span></p></td><td style="vertical-align:top;">
<p><span class="font19">| us &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p>
<p><span class="font19">---+-------------+</span></p></td></tr>
</table>
<p><span class="font19">9 rows in set (0.00 sec)</span></p>
<p><span class="font19">mysql&gt; select Field,AVG(birthyear) from people;</span></p>
<p><a href="#bookmark8480"><span class="font19">+----------+</span></a></p>
<p><a href="#bookmark8481"><span class="font19">| Field &nbsp;&nbsp;&nbsp;&nbsp;| AVG(birthyear)</span></a></p>
<p><a href="#bookmark8482"><span class="font19">+----------+</span></a></p>
<p><span class="font19">| politics | 1967.111111111111 |</span></p>
<p><a href="#bookmark8483"><span class="font19">+----------+</span></a></p>
<p><span class="font19">1 row in set (0.00 sec)</span></p>
<p><a name="bookmark8484"></a><span class="font25"><a name="bookmark8485"></a><a name="bookmark8486"></a>Using the </span><span class="font25" style="font-weight:bold;">group by </span><span class="font25">clause, we can have an average per field.</span></p>
<p><span class="font19">mysql&gt; select Field,AVG(birthyear) from people group by Field;</span></p>
<p><a href="#bookmark8487"><span class="font19">+-----------+</span></a></p>
<p><span class="font19">| Field | AVG(birthyear) |</span></p>
<p><a href="#bookmark8488"><span class="font19">+-----------+</span></a></p>
<p><span class="font19">| astronaut | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1978 |</span></p>
<p><span class="font19">| politics | 1939.3333333333333 |</span></p>
<p><span class="font19">| tennis | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1981.6 |</span></p>
<p><a href="#bookmark8489"><span class="font19">+-----------+</span></a></p>
<p><span class="font19">3 rows in set (0.00 sec)</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8490"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8491"></a>3.5.8. deleting records</span></h3></li></ul>
<h4><a name="bookmark8492"></a><span class="font25"><a name="bookmark8493"></a><a name="bookmark8494"></a>You can use the </span><span class="font25" style="font-weight:bold;">delete </span><span class="font25">to permanently remove a record from a table.</span></h4>
<p><span class="font19">mysql&gt; delete from country where countryname='Spain';</span></p>
<p><span class="font19">Query OK, 1 row affected (0.06 sec)</span></p>
<p><span class="font19">mysql&gt; select * from country where countryname='Spain'; Empty set (0.00 sec)</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8495"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7769"></a><a name="bookmark8496"></a>3.6. joining two tables</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8497"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8498"></a>3.6.1. inner join</span></h3></li></ul></li></ul>
<h4><a name="bookmark8499"></a><span class="font25"><a name="bookmark8500"></a>With an </span><span class="font25" style="font-weight:bold;">inner join </span><span class="font25">you can take values from two tables and combine them in one result. Consider the country and the people tables from the previous section when looking at this screenshot of an </span><span class="font25" style="font-weight:bold;">inner join</span><span class="font25">.</span></h4>
<p><span class="font19">mysql&gt; select Name,Field,countryname</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-&gt; from country</span></p></li>
<li>
<p><span class="font19">-&gt; inner join people on people.countrycode=country.countrycode;</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">+----------------</span></p>
<p><span class="font19">| Name</span></p></td><td style="vertical-align:top;">
<p><span class="font19">- +</span></p>
<p><span class="font19">|</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">Field</span></p></td><td style="vertical-align:top;">
<p><span class="font19">- + |</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">countryname</span></p></td><td style="vertical-align:top;">
<p><span class="font19">- +</span></p>
<p><span class="font19">|</span></p></td></tr>
<tr><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">| Barack Obama</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">politics</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">United States</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">|</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Deng Xiaoping</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">politics</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">China</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Guy Verhofstadt</span></p></td><td style="vertical-align:top;">
<p><span class="font19">|</span></p></td><td style="vertical-align:top;">
<p><span class="font19">politics</span></p></td><td style="vertical-align:top;">
<p><span class="font19">|</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Belgium</span></p></td><td style="vertical-align:top;">
<p><span class="font19">|</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">| Justine Henin</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">tennis</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">Belgium</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Kim Clijsters</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">tennis</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">Belgium</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Li Na</span></p></td><td style="vertical-align:top;">
<p><span class="font19">|</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tennis</span></p></td><td style="vertical-align:top;">
<p><span class="font19">|</span></p></td><td style="vertical-align:top;">
<p><span class="font19">China</span></p></td><td style="vertical-align:top;">
<p><span class="font19">|</span></p></td></tr>
</table></li></ul>
<p><a href="#bookmark8501"><span class="font19">| Liu Yang &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| astronaut | China</span></a></p>
<p><a href="#bookmark8502"><span class="font19">| Serena Williams | tennis &nbsp;&nbsp;&nbsp;&nbsp;| United States</span></a></p>
<p><a href="#bookmark8503"><span class="font19">| Venus Williams &nbsp;| tennis &nbsp;&nbsp;&nbsp;&nbsp;| United States</span></a></p>
<p><a href="#bookmark8504"><span class="font19">+-----------------+-----------+</span></a></p>
<p><span class="font19">9 rows in set (0.00 sec)</span></p>
<p><span class="font25">This </span><span class="font25" style="font-weight:bold;">inner join </span><span class="font25">will show only records with a match on </span><span class="font25" style="font-weight:bold;">countrycode </span><span class="font25">in both tables.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8505"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8506"></a>3.6.2. left join</span></h3></li></ul>
<p><span class="font25">A </span><span class="font25" style="font-weight:bold;">left join </span><span class="font25">is different from an </span><span class="font25" style="font-weight:bold;">inner join </span><span class="font25">in that it will take all rows from the left table, regardless of a match in the right table.</span></p>
<p><span class="font19">mysql&gt; select Name,Field,countryname from country left join people on people.countrycode=count</span></p>
<p><span class="font19">+-----------------+-----------+---------------+</span></p>
<p><span class="font19">| Name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| Field | countryname |</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">+-----------------</span></p></td><td style="vertical-align:top;">
<p><span class="font19">—</span></p></td><td style="vertical-align:top;">
<p><span class="font19">---------------+</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">| Guy Verhofstadt</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">politics</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Belgium &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Justine Henin</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tennis</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Belgium &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Kim Clijsters</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tennis</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Belgium &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">| Deng Xiaoping</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">politics</span></p></td><td style="vertical-align:top;">
<p><span class="font19">China &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Li Na</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tennis</span></p></td><td style="vertical-align:top;">
<p><span class="font19">China &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Liu Yang</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">astronaut</span></p></td><td style="vertical-align:top;">
<p><span class="font19">China &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| NULL</span></p></td><td style="vertical-align:top;">
<p><span class="font19">NULL</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Germany &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| NULL</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">NULL</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Egypt &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| NULL</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">NULL</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Spain &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| NULL</span></p></td><td style="vertical-align:top;">
<p><span class="font19">NULL</span></p></td><td style="vertical-align:top;">
<p><span class="font19">France &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| NULL</span></p></td><td style="vertical-align:top;">
<p><span class="font19">NULL</span></p></td><td style="vertical-align:top;">
<p><span class="font19">India &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| NULL</span></p></td><td style="vertical-align:top;">
<p><span class="font19">NULL</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Japan &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| NULL</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">NULL</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Mexico &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Barack Obama</span></p></td><td style="vertical-align:top;">
<p><span class="font19">politics</span></p></td><td style="vertical-align:top;">
<p><span class="font19">United States |</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Serena Williams</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tennis</span></p></td><td style="vertical-align:top;">
<p><span class="font19">United States |</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">| Venus Williams +-----------------</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tennis —</span></p></td><td style="vertical-align:top;">
<p><span class="font19">United States | ---------------+</span></p></td></tr>
</table>
<p><span class="font19">16 rows in set (0.00 sec)</span></p>
<p><span class="font25">You can see that some countries are present, even when they have no matching records in the </span><span class="font25" style="font-weight:bold;">people </span><span class="font25">table.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8507"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7770"></a><a name="bookmark8508"></a>3.7. mysql triggers</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8509"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8510"></a>3.7.1. using a before trigger</span></h3></li></ul></li></ul>
<p><a name="bookmark8511"></a><span class="font25">Consider the following </span><span class="font25" style="font-weight:bold;">create table </span><span class="font25">command. The last field (</span><span class="font25" style="font-weight:bold;">amount</span><span class="font25">) is the multiplication of the two fields named </span><span class="font25" style="font-weight:bold;">unitprice </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">unitcount</span><span class="font25">.</span></p>
<p><span class="font19">mysql&gt; create table invoices (</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- &gt;&nbsp;id char(8) NOT NULL,</span></p></li>
<li>
<p><span class="font19">- &gt;&nbsp;customerid char(3) NOT NULL,</span></p></li>
<li>
<p><span class="font19">- &gt;&nbsp;unitprice int,</span></p></li>
<li>
<p><span class="font19">- &gt;&nbsp;unitcount smallint,</span></p></li>
<li>
<p><span class="font19">- &gt;&nbsp;amount int );</span></p></li></ul>
<p><span class="font19">Query OK, 0 rows affected (0.00 sec)</span></p>
<p><a name="bookmark8512"></a><span class="font25">We can let mysql do the calculation for that by using a </span><span class="font25" style="font-weight:bold;">before trigger</span><span class="font25">. The screenshot below shows the creation of a trigger that calculates the amount by multiplying two fields that are about to be inserted.</span></p>
<p><span class="font19">mysql&gt; create trigger total_amount before INSERT on invoices</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- &gt;&nbsp;for each row set new.amount = new.unitprice * new.unitcount ; Query OK, 0 rows affected (0.02 sec)</span></p></li></ul>
<h4><a name="bookmark8513"></a><span class="font25"><a name="bookmark8514"></a>Here we verify that the trigger works by inserting a new record, without providing the total amount.</span></h4>
<p><span class="font19">mysql&gt; insert into invoices values ('20090526','ABC','199','10','');</span></p>
<p><span class="font19">Query OK, 1 row affected (0.02 sec)</span></p>
<h4><a name="bookmark8515"></a><span class="font25"><a name="bookmark8516"></a>Looking at the record proves that the trigger works.</span></h4>
<p><span class="font19">mysql&gt; select * from invoices;</span></p>
<p><a href="#bookmark8517"><span class="font19">+----------+------------+-----------+-----------+</span></a></p>
<p><span class="font19">| id &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| customerid | unitprice | unitcount | amount |</span></p>
<p><a href="#bookmark8518"><span class="font19">+----------+------------+-----------+-----------+</span></a></p>
<p><span class="font19">| 20090526 | ABC &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;199 | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10 | &nbsp;&nbsp;&nbsp;1990 |</span></p>
<p><a href="#bookmark8519"><span class="font19">+----------+------------+-----------+-----------+</span></a></p>
<p><span class="font19">1 row in set (0.00 sec)</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8520"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8521"></a>3.7.2. removing a trigger</span></h3></li></ul>
<h4><a name="bookmark8522"></a><span class="font25"><a name="bookmark8523"></a><a name="bookmark8524"></a>When a </span><span class="font25" style="font-weight:bold;">trigger </span><span class="font25">is no longer needed, you can delete it with the </span><span class="font25" style="font-weight:bold;">drop trigger </span><span class="font25">command.</span></h4>
<p><span class="font19">mysql&gt; drop trigger total_amount;</span></p>
<p><span class="font19">Query OK, 0 rows affected (0.00 sec)</span></p>
<p><a name="bookmark8525"></a><span class="font11" style="font-weight:bold;">Part VI. Introduction to Samba</span></p>
<h3><a name="bookmark8526"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8527"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8528"><span class="font24" style="font-weight:bold;">9. introduction to samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8529"><span class="font24">9.1. verify installed version </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8530"><span class="font24">9.2. installing samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8531"><span class="font24">9.3. documentation </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8532"><span class="font24">9.4. starting and stopping samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8533"><span class="font24">9.5. samba daemons </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8534"><span class="font24">9.6. the SMB protocol </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8535"><span class="font24">9.7. practice: introduction to samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8536"><span class="font24" style="font-weight:bold;">10. getting started with samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8537"><span class="font24">10.1. /etc/samba/smb.conf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8538"><span class="font24">10.2. /usr/bin/testparm </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8539"><span class="font24">10.3. /usr/bin/smbclient </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8540"><span class="font24">10.4. /usr/bin/smbtree </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8541"><span class="font24">10.5. server string </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8542"><span class="font24">10.6. Samba Web Administration Tool (SWAT) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8543"><span class="font24">10.7. practice: getting started with samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8544"><span class="font24">10.8. solution: getting started with samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8545"><span class="font24" style="font-weight:bold;">11. a read only file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8546"><span class="font24">11.1. Setting up a directory to share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8547"><span class="font24">11.2. configure the share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8548"><span class="font24">11.3. restart the server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8549"><span class="font24">11.4. verify the share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8550"><span class="font24">11.5. a note on netcat </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8551"><span class="font24">11.6. practice: read only file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8552"><span class="font24">11.7. solution: read only file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8553"><span class="font24" style="font-weight:bold;">12. a writable file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8554"><span class="font24">12.1. set up a directory to share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8555"><span class="font24">12.2. share section in smb.conf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8556"><span class="font24">12.3. configure the share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8557"><span class="font24">12.4. test connection with windows </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8558"><span class="font24">12.5. test writing with windows </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8559"><span class="font24">12.6. How is this possible ? </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8560"><span class="font24">12.7. practice: writable file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8561"><span class="font24">12.8. solution: writable file server </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8562"><span class="font24" style="font-weight:bold;">13. samba first user account </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8563"><span class="font24">13.1. creating a samba user </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8564"><span class="font24">13.2. ownership of files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8565"><span class="font24">13.3. /usr/bin/smbpasswd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8566"><span class="font24">13.4. /etc/samba/smbpasswd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8567"><span class="font24">13.5. passdb backend </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8568"><span class="font24">13.6. forcing this user </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8569"><span class="font24">13.7. practice: first samba user account </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8570"><span class="font24">13.8. solution: first samba user account </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8571"><span class="font24" style="font-weight:bold;">14. samba authentication </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8572"><span class="font24">14.1. creating the users on Linux </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8573"><span class="font24">14.2. creating the users on samba </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8574"><span class="font24">14.3. security = user </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8575"><span class="font24">14.4. configuring the share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8576"><span class="font24">14.5. testing access with net use </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8577"><span class="font24">14.6. testing access with smbclient </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8578"><span class="font24">14.7. verify ownership </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8579"><span class="font24">14.8. common problems </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8580"><span class="font24">14.9. practice : samba authentication </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8581"><span class="font24">14.10. solution: samba authentication </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8582"><span class="font24" style="font-weight:bold;">15. samba securing shares </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8583"><span class="font24">15.1. security based on user name </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8584"><span class="font24">15.2. security based on ip-address </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8585"><span class="font24">15.3. security through obscurity </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8586"><span class="font24">15.4. file system security </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8587"><span class="font24">15.5. practice: securing shares </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8588"><span class="font24">15.6. solution: securing shares </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8589"><span class="font24" style="font-weight:bold;">16. samba domain member </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8590"><span class="font24">16.1. changes in smb.conf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8591"><span class="font24">16.2. joining an Active Directory domain </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8592"><span class="font24">16.3. winbind </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8593"><span class="font24">16.4. wbinfo </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8594"><span class="font24">16.5. getent </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8595"><span class="font24">16.6. file ownership </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8596"><span class="font24">16.7. practice : samba domain member </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8597"><span class="font24" style="font-weight:bold;">17. samba domain controller </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8598"><span class="font24">17.1. about Domain Controllers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8599"><span class="font24">17.2. About security modes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8600"><span class="font24">17.3. About password backends </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8601"><span class="font24">17.4. [global] section in smb.conf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8602"><span class="font24">17.5. netlogon share </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8603"><span class="font24">17.6. other [share] sections </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8604"><span class="font24">17.7. Users and Groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8605"><span class="font24">17.8. tdbsam </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8606"><span class="font24">17.9. about computer accounts </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8607"><span class="font24">17.10. local or roaming profiles </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8608"><span class="font24">17.11. Groups in NTFS acls </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8609"><span class="font24">17.12. logon scripts </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8610"><span class="font24">17.13. practice: samba domain controller </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8611"><span class="font24" style="font-weight:bold;">18. a brief look at samba 4 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark8612"><span class="font24">18.1. Samba 4 alpha 6 </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark8613"></a><span class="font11" style="font-weight:bold;"><a name="bookmark7830"></a><a name="bookmark8614"></a>Chapter 9. introduction to samba</span></h1></li></ul>
<p><span class="font25">This introduction to the Samba server simply explains how to install Samba 3 and briefly mentions the SMB protocol.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8615"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7832"></a><a name="bookmark8616"></a>9.1. verify installed version</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8617"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8618"></a>9.1.1. .rpm based distributions</span></h3></li></ul></li></ul>
<p><a name="bookmark8619"></a><span class="font25">To see the version of samba installed on Red Hat, Fedora or CentOS use </span><span class="font25" style="font-weight:bold;">rpm -q samba</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL52 ~]# rpm -q samba</span></p>
<p><span class="font19">samba-3.0.28-1.el5_2.1</span></p>
<p><a name="bookmark8620"></a><span class="font25">The screenshot above shows that RHEL5 has </span><span class="font25" style="font-weight:bold;">Samba </span><span class="font25">version 3.0 installed. The last number in the Samba version counts the number of updates or patches.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">Below the same command on a more recent version of CentOS with Samba version 3.5 installed.</span></p></li></ul>
<p><span class="font19">[root@centos6 ~]# rpm -q samba</span></p>
<p><span class="font19">samba-3.5.10-116.el6_2.i686</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8621"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8622"></a>9.1.2. .deb based distributions</span></h3></li></ul>
<p><a name="bookmark8623"></a><span class="font25"><a name="bookmark8624"></a>Use </span><span class="font25" style="font-weight:bold;">dpkg -l </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">aptitide show </span><span class="font25">on Debian or Ubuntu. Both Debian 7.0 (Wheezy) and Ubuntu</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">12.04 (Precise) use version 3.6.3 of the Samba server.</span></p></li></ul>
<p><span class="font19">root@debian7~# aptitude show samba | grep Version</span></p>
<p><span class="font19">Version: 2:3.6.3-1</span></p>
<p><span class="font25">Ubuntu 12.04 is currently at Samba version 3.6.3.</span></p>
<p><span class="font19">root@ubu1204:~# dpkg -l samba | tail -1</span></p>
<p><span class="font19">ii samba 2:3.6.3-2ubuntu2.1 SMB/CIFS file, print, and login server for Unix</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8625"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7833"></a><a name="bookmark8626"></a>9.2. installing samba</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8627"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8628"></a>9.2.1. .rpm based distributions</span></h3></li></ul></li></ul>
<p><a name="bookmark8629"></a><span class="font25"><a name="bookmark8630"></a>Samba is installed by default on Red Hat Enterprise Linux. If Samba is not yet installed, then you can use the graphical menu (Applications -- System Settings -- Add/Remove Applications) and select &quot;Windows File Server&quot; in the Server section. The non-graphical way is to use </span><span class="font25" style="font-weight:bold;">rpm </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">yum</span><span class="font25">.</span></p>
<p><span class="font25">When you downloaded the .rpm file, you can install Samba like this.</span></p>
<p><span class="font19">[paul@RHEL52 ~]$ rpm -i samba-3.0.28-1.el5_2.1.rpm</span></p>
<p><span class="font25">When you have a subscription to RHN (Red Hat Network), then </span><span class="font25" style="font-weight:bold;">yum </span><span class="font25">is an easy tool to use.</span></p>
<p><span class="font25">This </span><span class="font25" style="font-weight:bold;">yum </span><span class="font25">command works by default on Fedora and CentOS.</span></p>
<p><span class="font19">[root@centos6 ~]# yum install samba</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8631"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8632"></a>9.2.2. .deb based distributions</span></h3></li></ul>
<p><a name="bookmark8633"></a><span class="font25">Ubuntu and Debian users can use the </span><span class="font25" style="font-weight:bold;">aptitude </span><span class="font25">program (or use a graphical tool like Synaptic).</span></p>
<p><span class="font19">root@debian7~# aptitude install samba</span></p>
<p><span class="font19">The following NEW packages will be installed:</span></p>
<p><span class="font19">samba samba-common{a} samba-common-bin{a} tdb-tools{a}</span></p>
<p><span class="font19">0 packages upgraded, 4 newly installed, 0 to remove and 1 not upgraded.</span></p>
<p><span class="font19">Need to get 15.1 MB of archives. After unpacking 42.9 MB will be used.</span></p>
<p><span class="font19">Do you want to continue? [Y/n/?]</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8634"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7834"></a><a name="bookmark8635"></a>9.3. documentation</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8636"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8637"></a>9.3.1. samba howto</span></h3></li></ul></li></ul>
<p><span class="font25">Samba comes with excellent documentation in html and pdf format (and also as a free download from samba.org and it is for sale as a printed book).</span></p>
<p><span class="font25">The documentation is a separate package, so install it if you want it on the server itself.</span></p>
<p><span class="font19">[root@centos6 ~]# yum install samba-doc</span></p>
<p><span class="font19">...</span></p>
<p><span class="font19">[root@centos6 ~]# ls -l /usr/share/doc/samba-doc-3.5.10/ total 10916 drwxr-xr-x. 6 root root &nbsp;&nbsp;&nbsp;4096 May &nbsp;6 15:50 htmldocs</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-r--r--. 1 root root 4605496 Jun 14 &nbsp;2011 Samba3-ByExample.pdf</span></p></li>
<li>
<p><span class="font19">- rw-r--r--. 1 root root &nbsp;608260 Jun 14 &nbsp;2011 Samba3-Developers-Guide.pdf</span></p></li>
<li>
<p><span class="font19">- rw-r--r--. 1 root root 5954602 Jun 14 &nbsp;2011 Samba3-HOWTO.pdf</span></p></li></ul>
<p><span class="font25">This action is very similar on Ubuntu and Debian except that the pdf files are in a separate package named </span><span class="font25" style="font-weight:bold;">samba-doc-pdf</span><span class="font25">.</span></p>
<p><span class="font19">root@ubu1204:~# aptitude install samba-doc-pdf</span></p>
<p><span class="font19">The following NEW packages will be installed:</span></p>
<p><span class="font19">samba-doc-pdf</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8638"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8639"></a>9.3.2. samba by example</span></h3></li></ul>
<p><span class="font25">Besides the howto, there is also an excellent book called </span><span class="font25" style="font-weight:bold;">Samba By Example </span><span class="font25">(again available as printed edition in shops, and as a free pdf and html).</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8640"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7825"></a><a name="bookmark8641"></a>9.4. starting and stopping samba</span></h2></li></ul>
<h4><a name="bookmark8642"></a><span class="font25"><a name="bookmark8643"></a><a name="bookmark8644"></a><a name="bookmark8645"></a>You can start the daemons by invoking </span><span class="font25" style="font-weight:bold;">/etc/init.d/smb start </span><span class="font25">(some systems use </span><span class="font25" style="font-weight:bold;">/etc/init.d/ samba</span><span class="font25">) on any linux.</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">root@laika:~# /etc/init.d/samba</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">stop</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">* Stopping Samba daemons</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">[ OK ]</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">root@laika:~# /etc/init.d/samba</span></p></td><td style="vertical-align:top;">
<p><span class="font19">start</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">* Starting Samba daemons</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">[ OK ]</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">root@laika:~# /etc/init.d/samba</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">restart</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">* Stopping Samba daemons</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">[ OK ]</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">* Starting Samba daemons</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">[ OK ]</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">root@laika:~# /etc/init.d/samba</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">status</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">* SMBD is running</span></p></td><td style="vertical-align:top;">
<p><span class="font19">[ OK ]</span></p></td></tr>
</table>
<h4><a name="bookmark8646"></a><span class="font25"><a name="bookmark8647"></a><a name="bookmark8648"></a>Red Hat derived systems are happy with </span><span class="font25" style="font-weight:bold;">service smb start</span><span class="font25">.</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[root@RHEL4b ~]# /etc/init.d/smb start Starting SMB services:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">[ OK ]</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Starting NMB services:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">[ OK ]</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[root@RHEL4b ~]# service smb restart Shutting down SMB services:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">[ OK ]</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Shutting down NMB services:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">[ OK ]</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Starting SMB services:</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">[ OK ]</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Starting NMB services: [root@RHEL4b ~]#</span></p></td><td style="vertical-align:top;">
<p><span class="font19">[ OK ]</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8649"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7836"></a><a name="bookmark8650"></a>9.5. samba daemons</span></h2></li></ul>
<p><a name="bookmark8651"></a><span class="font25"><a name="bookmark8652"></a><a name="bookmark8653"></a>Samba 3 consists of three daemons, they are named </span><span class="font25" style="font-weight:bold;">nmbd</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">smbd </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">winbindd</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font9" style="font-weight:bold;">9.5.1. nmbd</span></p></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">nmbd </span><span class="font25">daemon takes care of all the names and naming. It registers and resolves names, and handles browsing. According to the Samba documentation, it should be the first daemon to start.</span></p>
<p><span class="font19">[root@RHEL52 ~]# ps -C nmbd PID TTY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TIME CMD</span></p>
<p><span class="font19">5681 ? &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;00:00:00 nmbd</span></p>
<ul style="list-style:none;"><li>
<p><span class="font9" style="font-weight:bold;">9.5.2. smbd</span></p></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">smbd </span><span class="font25">daemon manages file transfers and authentication.</span></p>
<p><span class="font19">[root@RHEL52 ~]# ps -C smbd</span></p>
<p><a href="#bookmark8654"><span class="font19">PID TTY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TIME</span></a></p>
<p><a href="#bookmark8655"><span class="font19">5678 ? &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;00:00:00</span></a></p>
<p><a href="#bookmark8656"><span class="font19">5683 ? &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;00:00:00</span></a></p>
<ul style="list-style:none;"><li>
<p><span class="font9" style="font-weight:bold;">9.5.3. winbindd</span></p></li></ul>
<p><a name="bookmark8657"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">winbind daemon </span><span class="font25">(winbindd) is only started to handle Microsoft Windows domain membership.</span></p>
<p><a name="bookmark8658"></a><span class="font25">Note that </span><span class="font25" style="font-weight:bold;">winbindd </span><span class="font25">is started by the </span><span class="font25" style="font-weight:bold;">/etc/init.d/winbind </span><span class="font25">script (two dd's for the daemon and only one d for the script).</span></p>
<p><span class="font19">[root@RHEL52 ~]# /etc/init.d/winbind start Starting Winbind services:</span></p>
<div>
<p><span class="font19">[ OK ]</span></p>
</div><br clear="all">
<p><span class="font19">[root@RHEL52 ~]# ps -C winbindd</span></p>
<p><span class="font19">PID TTY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TIME CMD</span></p>
<p><span class="font19">5752 ? &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;00:00:00 winbindd</span></p>
<p><span class="font19">5754 ? &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;00:00:00 winbindd</span></p>
<p><span class="font25">On Debian and Ubuntu, the winbindd daemon is installed via a separate package called </span><span class="font25" style="font-weight:bold;">winbind</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8659"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7837"></a><a name="bookmark8660"></a>9.6. the SMB protocol</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8661"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8662"></a>9.6.1. brief history</span></h3></li></ul></li></ul>
<p><a name="bookmark8663"></a><span class="font25">Development of this protocol was started by </span><span class="font25" style="font-weight:bold;">IBM </span><span class="font25">in the early eighties. By the end of the eighties, most develpment was done by </span><span class="font25" style="font-weight:bold;">Microsoft</span><span class="font25">. SMB is an application level protocol designed to run on top of NetBIOS/NetBEUI, but can also be run on top of tcp/ip.</span></p>
<p><span class="font25">In 1996 Microsoft was asked to document the protocol. They submitted CIFS (Common Internet File System) as an internet draft, but it never got final rfc status.</span></p>
<p><span class="font25">In 2004 the European Union decided Microsoft should document the protocol to enable other developers to write compatible software. December 20th 2007 Microsoft came to an agreement. The Samba team now has access to SMB/CIFS, Windows for Workgroups and Active Directory documentation.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8664"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8665"></a>9.6.2. broadcasting protocol</span></h3></li></ul>
<p><a name="bookmark8666"></a><span class="font25">SMB uses the NetBIOS </span><span class="font25" style="font-weight:bold;">service location protocol</span><span class="font25">, which is a broadcasting protocol. This means that NetBIOS names have to be unique on the network (even when you have different IP-addresses). Having duplicate names on an SMB network can seriously harm communications.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8667"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8668"></a>9.6.3. NetBIOS names</span></h3></li></ul>
<p><a name="bookmark8669"></a><span class="font25"><a name="bookmark8670"></a>NetBIOS names are similar to </span><span class="font25" style="font-weight:bold;">hostnames</span><span class="font25">, but are always uppercase and only 15 characters in length. Microsoft Windows computers and Samba servers will broadcast this name on the network.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8671"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8672"></a>9.6.4. network bandwidth</span></h3></li></ul>
<p><a name="bookmark8673"></a><span class="font25">Having many broadcasting SMB/CIFS computers on your network can cause bandwidth issues. A solution can be the use of a </span><span class="font25" style="font-weight:bold;">NetBIOS name server </span><span class="font25">(NBNS) like </span><span class="font25" style="font-weight:bold;">WINS </span><span class="font25">(Windows Internet Naming Service).</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8674"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7838"></a><a name="bookmark8675"></a>9.7. practice: introduction to samba</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">0. !! Make sure you know your student number, anything *ANYTHING* you name must include your student number!</span></p></li>
<li>
<p><span class="font25">1. Verify that you can logon to a Linux/Unix computer. Write down the name and ip address of this computer.</span></p></li>
<li>
<p><span class="font25">2. Do the same for all the other (virtual) machines available to you.</span></p></li>
<li>
<p><span class="font25">3. Verify networking by pinging the computer, edit the appropriate hosts files so you can use names. Test the names by pinging them.</span></p></li>
<li>
<p><span class="font25">4. Make sure Samba is installed, write down the version of Samba.</span></p></li>
<li>
<p><span class="font25">5. Open the Official Samba-3 howto pdf file that is installed on your computer. How many A4 pages is this file ? Then look at the same pdf on samba.org, it is updated regularly.</span></p></li>
<li>
<p><span class="font25">6. Stop the Samba server.</span></p></li></ul>
<ul style="list-style:none;"><li>
<p><a name="bookmark8676"></a><span class="font11" style="font-weight:bold;">Chapter 10. getting started with samba</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8677"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7840"></a><a name="bookmark8678"></a>10.1. /etc/samba/smb.conf</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8679"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8680"></a>10.1.1. smbd -b</span></h3></li></ul></li></ul>
<p><a name="bookmark8681"></a><span class="font25">Samba configuration is done in the </span><span class="font25" style="font-weight:bold;">smb.conf </span><span class="font25">file. The file can be edited manually, or you can use a web based interface like webmin or swat to mana<a name="bookmark8682"></a>ge it. The file is usually located in /etc/samba. You can find the exact location with </span><span class="font25" style="font-weight:bold;">smbd -b</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL4b ~]# smbd -b | grep CONFIGFILE</span></p>
<p><span class="font19">CONFIGFILE: /etc/samba/smb.conf</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8683"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8684"></a>10.1.2. the default smb.conf</span></h3></li></ul>
<p><span class="font25">The default smb.conf file contains a lot of examples with explanations.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ ls -l /etc/samba/smb.conf</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-r--r-- &nbsp;1 root root 10836 May 30 23:08 /etc/samba/smb.conf</span></p></li></ul>
<p><span class="font25">Also on Ubuntu and Debian, smb.conf is packed with samples and explanations.</span></p>
<p><span class="font19">paul@laika:~$ ls -l /etc/samba/smb.conf</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-r--r-- 1 root root 10515 2007-05-24 00:21 /etc/samba/smb.conf</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8685"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8686"></a>10.1.3. minimal smb.conf</span></h3></li></ul>
<p><span class="font25">Below is an example of a very minimalistic </span><span class="font25" style="font-weight:bold;">smb.conf</span><span class="font25">. It allows samba to start, and to be visible to other computers (Microsoft shows computers in Network Neighborhood or My Network Places).</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ cat /etc/samba/smb.conf</span></p>
<p><span class="font19">[global]</span></p>
<p><span class="font19">workgroup = WORKGROUP</span></p>
<p><span class="font19">[firstshare]</span></p>
<p><span class="font19">path = /srv/samba/public</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8687"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8688"></a>10.1.4. net view</span></h3></li></ul>
<p><a name="bookmark8689"></a><span class="font25">Below is a screenshot of the </span><span class="font25" style="font-weight:bold;">net view </span><span class="font25">command on Microsoft Windows Server 2003 sp2. It shows how a Red Hat Enterprise Linux 5.3 and a Ubuntu 9.04 Samba server, both with a minimalistic smb.conf, are visible to Microsoft computers nearby.</span></p>
<p><span class="font19">C:\Documents and Settings\Administrator&gt;net view</span></p>
<p><span class="font19">Server Name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remark</span></p>
<p><span class="font19">\\LAIKA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Samba 3.3.2</span></p>
<p><span class="font19">\\RHEL53 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Samba 3.0.33-3.7.el5</span></p>
<p><span class="font19">\\W2003</span></p>
<p><span class="font19">The command completed successfully.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3189"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8690"></a>10.1.5. long lines in smb.conf</span></h3></li></ul>
<p><span class="font25">Some parameters in smb.conf can get a long list of values behind them. You can continue a line (for clarity) on the next by ending the line with a backslash.</span></p>
<p><span class="font19">valid users = Serena, Venus, Lindsay \</span></p>
<p><span class="font19">Kim, Justine, Sabine \ Amelie, Marie, Suzanne</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8691"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8692"></a>10.1.6. curious smb.conf</span></h3></li></ul>
<p><span class="font25">Curious but true: smb.conf accepts synonyms like </span><span class="font25" style="font-weight:bold;">create mode </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">create mask</span><span class="font25">, and (sometimes) minor spelling errors like </span><span class="font25" style="font-weight:bold;">browsable </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">browseable</span><span class="font25">. And on occasion you can even switch words, the </span><span class="font25" style="font-weight:bold;">guest only </span><span class="font25">parameter is identical to </span><span class="font25" style="font-weight:bold;">only guest</span><span class="font25">. And </span><span class="font25" style="font-weight:bold;">writable = yes </span><span class="font25">is the same as </span><span class="font25" style="font-weight:bold;">readonly = no</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8693"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8694"></a>10.1.7. man smb.conf</span></h3></li></ul>
<p><a name="bookmark8695"></a><span class="font25">You can access a lot of documentation when typing </span><span class="font25" style="font-weight:bold;">man smb.conf</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL4b samba]# apropos samba</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">cupsaddsmb</span></p></td><td style="vertical-align:top;">
<p><span class="font19">(8)</span></p></td><td style="vertical-align:top;">
<p><span class="font19">- export printers to samba for windows clients</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">lmhosts</span></p></td><td style="vertical-align:top;">
<p><span class="font19">(5)</span></p></td><td style="vertical-align:top;">
<p><span class="font19">- The Samba NetBIOS hosts file</span></p></td></tr>
</table>
<p><span class="font19">net &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(8) &nbsp;- Tool for administration of Samba and remote CIFS servers</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">pdbedit</span></p></td><td style="vertical-align:top;">
<p><span class="font19">(8)</span></p></td><td style="vertical-align:top;">
<p><span class="font19">- manage the SAM database (Database</span></p></td><td style="vertical-align:top;">
<p><span class="font19">of Samba Users)</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">samba</span></p></td><td style="vertical-align:top;">
<p><span class="font19">(7)</span></p></td><td style="vertical-align:top;">
<p><span class="font19">- A Windows SMB/CIFS fileserver for</span></p></td><td style="vertical-align:top;">
<p><span class="font19">UNIX</span></p></td></tr>
</table>
<p><span class="font19">smb.conf [smb] (5) smbpasswd (5) smbstatus (1) swat (8) tdbbackup (8)</span></p>
<p><span class="font19">The configuration file for the Samba suite</span></p>
<p><span class="font19">The Samba encrypted password file report on current Samba connections Samba Web Administration Tool tool for backing up and ... of samba .tdb files</span></p>
<p><span class="font19">[root@RHEL4b samba]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8696"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7841"></a><a name="bookmark8697"></a>10.2. /usr/bin/testparm</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8698"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8699"></a>10.2.1. syntax check smb.conf</span></h3></li></ul></li></ul>
<p><a name="bookmark8700"></a><span class="font25">To verify the syntax of the smb.conf file, you can use </span><span class="font25" style="font-weight:bold;">testparm</span><span class="font25">.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ testparm</span></p>
<p><span class="font19">Load smb config files from /etc/samba/smb.conf Processing section &quot;[firstshare]&quot; Loaded services file OK.</span></p>
<p><span class="font19">Server role: ROLE_STANDALONE</span></p>
<p><span class="font19">Press enter to see a dump of your service definitions</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8701"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8702"></a>10.2.2. testparm -v</span></h3></li></ul>
<p><a name="bookmark8703"></a><span class="font25">An interesting option is </span><span class="font25" style="font-weight:bold;">testparm -v</span><span class="font25">, which will output all the global options with their default value.</span></p>
<p><span class="font19">[root@RHEL52 ~]# testparm -v | head</span></p>
<p><span class="font19">Load smb config files from /etc/samba/smb.conf</span></p>
<p><span class="font19">Processing section &quot;[pub0]&quot;</span></p>
<p><span class="font19">Processing section &quot;[global$]&quot; Loaded services file OK. Server role: ROLE_STANDALONE Press enter to see a dump of your service definitions [global] dos charset = CP850 unix charset = UTF-8 display charset = LOCALE workgroup = WORKGROUP</span></p>
<p><span class="font19">realm =</span></p>
<p><span class="font19">netbios name = TEACHER0 netbios aliases = netbios scope =</span></p>
<p><span class="font19">server string = Samba 3.0.28-1.el5_2.1</span></p>
<p><span class="font25">There were about 350 default values for smb.conf parameters in Samba 3.0.x. This number grew to almost 400 in Samba 3.5.x.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8704"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8705"></a>10.2.3. testparm -s</span></h3></li></ul>
<p><a name="bookmark8706"></a><span class="font25">The samba daemons are constantly (once every 60 seconds) checking the smb.conf file, so it is good practice to keep this file small. But it is also good practice to document your samba configuration, and to explicitly set options that have the same default values. The </span><span class="font25" style="font-weight:bold;">testparm -s </span><span class="font25">option allows you to do both. It will output the smallest possible samba configuration file, while retaining all your settings. The idea is to have your samba configuration in another file (like smb.conf.full) and let testparm parse this for you. The screenshot below shows you how. First the smb.conf.full file with the explicitly set option workgroup to WORKGROUP.</span></p>
<p><span class="font19">[root@RHEL4b samba]# cat smb.conf.full</span></p>
<p><span class="font19">[global]</span></p>
<p><span class="font19">workgroup = WORKGROUP</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># This is a demo of a documented smb.conf</span></p></li>
<li>
<p><span class="font19"># These two lines are removed by testparm -s</span></p></li></ul>
<p><span class="font19">server string = Public Test Server</span></p>
<p><span class="font19">[firstshare]</span></p>
<p><span class="font19">path = /srv/samba/public</span></p>
<p><a name="bookmark8707"></a><span class="font25">Next, we execute testparm with the -s option, and redirect stdout to the real </span><span class="font25" style="font-weight:bold;">smb.conf </span><span class="font25">file.</span></p>
<p><span class="font19">[root@RHEL4b samba]# testparm -s smb.conf.full &gt;&nbsp;smb.conf</span></p>
<p><span class="font19">Load smb config files from smb.conf.full</span></p>
<p><span class="font19">Processing section &quot;[firstshare]&quot;</span></p>
<p><span class="font19">Loaded services file OK.</span></p>
<p><span class="font25">And below is the end result. The two comment lines and the default option are no longer there.</span></p>
<p><span class="font19">[root@RHEL4b samba]# cat smb.conf</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Global parameters</span></p></li></ul>
<p><span class="font19">[global]</span></p>
<p><span class="font19">server string = Public Test Server</span></p>
<p><span class="font19">[firstshare]</span></p>
<p><span class="font19">path = /srv/samba/public</span></p>
<p><span class="font19">[root@RHEL4b samba]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8708"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7842"></a><a name="bookmark8709"></a>10.3. /usr/bin/smbclient</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8710"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8711"></a>10.3.1. smbclient looking at Samba</span></h3></li></ul></li></ul>
<p><a name="bookmark8712"></a><span class="font25">With </span><span class="font25" style="font-weight:bold;">smbclient </span><span class="font25">you can see browsing and share information from your smb server. It will display all your shares, your workgroup, and the name of the Master Browser. The -N switch <a name="bookmark8713"></a><a name="bookmark8714"></a>is added to avoid having to enter an empty password. The -L switch is followed by the name of the host to check.</span></p>
<p><span class="font19">[root@RHEL4b init.d]# smbclient -NL rhel4b</span></p>
<p><span class="font19">Anonymous login successful</span></p>
<p><span class="font19">Domain=[WORKGROUP] OS=[Unix] Server=[Samba 3.0.10-1.4E.9]</span></p>
<p><span class="font19">Sharename &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Type &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Comment</span></p>
<p><span class="font19">firstshare &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Disk</span></p>
<p><span class="font19">IPC$ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IPC &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IPC Service (Public Test Server)</span></p>
<p><span class="font19">ADMIN$ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IPC &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IPC Service (Public Test Server)</span></p>
<p><span class="font19">Anonymous login successful</span></p>
<p><span class="font19">Domain=[WORKGROUP] OS=[Unix] Server=[Samba 3.0.10-1.4E.9]</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">Server</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Comment</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">RHEL4B</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Public Test Server</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">WINXP</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">Workgroup</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">Master</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">WORKGROUP</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">WINXP</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8715"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8716"></a>10.3.2. smbclient anonymous</span></h3></li></ul>
<h4><a name="bookmark8717"></a><span class="font25"><a name="bookmark8718"></a>The screenshot below uses </span><span class="font25" style="font-weight:bold;">smbclient </span><span class="font25">to display information about a remote smb server (in this case a computer with Ubuntu 11.10).</span></h4>
<p><span class="font19">root@ubu1110:/etc/samba# testparm smbclient -NL 127.0.0.1</span></p>
<p><span class="font19">Anonymous login successful</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">Domain=[LINUXTR]</span></p></td><td style="vertical-align:top;">
<p><span class="font19">OS=[Unix]</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Server=[Samba 3.5.11]</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">Sharename</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">Type</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">Comment</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">share1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Disk</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">IPC$</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IPC</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IPC Service (Samba 3.5.11)</span></p></td></tr>
</table>
<p><span class="font19">Anonymous login successful</span></p>
<p><span class="font19">Domain=[LINUXTR] OS=[Unix] Server=[Samba 3.5.11]</span></p>
<p><span class="font19">Server &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Comment</span></p>
<p><span class="font19">Workgroup &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master</span></p>
<p><span class="font19">LINUXTR &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEBIAN6</span></p>
<p><span class="font19">WORKGROUP &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UBU1110</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8719"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8720"></a>10.3.3. smbclient with credentials</span></h3></li></ul>
<h4><a name="bookmark8721"></a><span class="font25"><a name="bookmark8722"></a><a name="bookmark8723"></a>Windows versions after xp sp2 and 2003 sp1 do not accept guest access (the NT_STATUS_ACCESS_DENIED error). This example shows how to provide credentials with </span><span class="font25" style="font-weight:bold;">smbclient</span><span class="font25">.</span></h4>
<p><span class="font19">[paul@RHEL53 ~]$ smbclient -L w2003 -U administrator%stargate</span></p>
<p><span class="font19">Domain=[W2003] OS=[Windows Server 2003 3790 Service Pack 2] Server=...</span></p>
<p><span class="font19">Sharename &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Type &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Comment</span></p>
<p><span class="font19">--------- ---- ------- C$ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Disk &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Default share</span></p>
<div>
<p><span class="font19">IPC$</span></p>
<p><span class="font19">ADMIN$</span></p>
</div><br clear="all">
<p><span class="font19">IPC &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remote IPC</span></p>
<p><span class="font19">Disk &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remote Admin</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8724"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7843"></a><a name="bookmark8725"></a>10.4. /usr/bin/smbtree</span></h2></li></ul>
<p><a name="bookmark8726"></a><span class="font25">Another useful tool to troubleshoot Samba or simply to browse the SMB network is </span><span class="font25" style="font-weight:bold;">smbtree</span><span class="font25">. In its simplest form, smbtree will do an anonymous browsing on the local subnet. displaying all SMB computers and (if authorized) their shares.</span></p>
<p><span class="font25">Let's take a look at two screenshots of smbtree in action (with blank password). The first one is taken immediately after booting four different computers (one MS Windows 2000, one MS Windows xp, one MS Windows 2003 and one RHEL 4 with Samba 3.0.10).</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ smbtree</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">WORKGROUP</span></p>
<p><span class="font19">PEGASUS</span></p>
<p><span class="font19">\\WINXP</span></p>
<p><span class="font19">\\RHEL4B &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pegasus Domain Member Server</span></p>
<p><span class="font19">Error connecting to 127.0.0.1 (Connection refused)</span></p>
<p><span class="font19">cli_full_connection: failed to connect to RHEL4B&lt;20&gt; (127.0.0.1)</span></p>
<p><span class="font19">\\HM2003</span></p>
<p><span class="font19">[paul@RHEL4b ~]$</span></p>
<p><span class="font25">The information displayed in the previous screenshot looks incomplete. The browsing elections are still ongoing, the browse list is not yet distributed to all clients by the (to be elected) browser master. The next screenshot was taken about one minute later. And it shows even less.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ smbtree</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">WORKGROUP</span></p>
<p><span class="font19">\\W2000</span></p>
<p><span class="font19">[paul@RHEL4b ~]$</span></p>
<p><span class="font25">So we wait a while, and then run </span><span class="font25" style="font-weight:bold;">smbtree </span><span class="font25">again, this time it looks a lot nicer.</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ smbtree</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">WORKGROUP</span></p>
<p><span class="font19">\\W2000</span></p>
<p><span class="font19">PEGASUS</span></p>
<p><span class="font19">\\WINXP</span></p>
<p><span class="font19">\\RHEL4B &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pegasus Domain Member Server</span></p>
<p><span class="font19">\\RHEL4B\ADMIN$ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IPC Service (Pegasus Domain Member Server)</span></p>
<p><span class="font19">\\RHEL4B\IPC$ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IPC Service (Pegasus Domain Member Server)</span></p>
<p><span class="font19">\\RHEL4B\domaindata &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Active Directory users only</span></p>
<p><span class="font19">\\HM2003</span></p>
<p><span class="font19">[paul@RHEL4b ~]$ smbtree --version</span></p>
<p><span class="font19">Version 3.0.10-1.4E.9</span></p>
<p><span class="font19">[paul@RHEL4b ~]$</span></p>
<p><span class="font25">I added the version number of </span><span class="font25" style="font-weight:bold;">smbtree </span><span class="font25">in the previous screenshot, to show you the difference when using the latest version of smbtree (below a screenshot taken from Ubuntu Feisty Fawn). The latest version shows a more complete overview of machines and shares.</span></p>
<p><span class="font19">paul@laika:~$ smbtree --version</span></p>
<p><span class="font19">Version 3.0.24</span></p>
<p><span class="font19">paul@laika:~$ smbtree</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">WORKGROUP</span></p>
<p><span class="font19">\\W2000</span></p>
<p><span class="font19">\\W2000\firstshare</span></p>
<p><span class="font19">\\W2000\C$ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Default share</span></p>
<p><span class="font19">\\W2000\ADMIN$ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remote Admin</span></p>
<p><span class="font19">\\W2000\IPC$ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remote IPC</span></p>
<p><span class="font19">PEGASUS</span></p>
<p><span class="font19">\\WINXP</span></p>
<p><span class="font19">cli_rpc_pipe_open: cli_nt_create failed on pipe \srvsvc to machine WINXP.</span></p>
<p><span class="font19">Error was NT_STATUS_ACCESS_DENIED</span></p>
<p><span class="font19">\\RHEL4B &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pegasus Domain Member Server</span></p>
<p><span class="font19">\\RHEL4B\ADMIN$ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IPC Service (Pegasus Domain Member Server)</span></p>
<p><span class="font19">\\RHEL4B\IPC$ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IPC Service (Pegasus Domain Member Server)</span></p>
<p><span class="font19">\\RHEL4B\domaindata &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Active Directory users only</span></p>
<p><span class="font19">\\HM2003</span></p>
<p><span class="font19">cli_rpc_pipe_open: cli_nt_create failed on pipe \srvsvc to machine HM2003.</span></p>
<p><span class="font19">Error was NT_STATUS_ACCESS_DENIED</span></p>
<p><span class="font19">paul@laika:~$</span></p>
<h4><a name="bookmark8727"></a><span class="font25"><a name="bookmark8728"></a><a name="bookmark8729"></a>The previous screenshot also provides useful errors on why we cannot see shared info on computers winxp and w2003. Let us try the old </span><span class="font25" style="font-weight:bold;">smbtree </span><span class="font25">version on our RHEL server, but this time with Administrator credentials (which are the same on all computers).</span></h4>
<div>
<p><span class="font19">[paul@RHEL4b ~]$ smbtree WORKGROUP</span></p>
<p><span class="font19">\\W2000</span></p>
<p><span class="font19">PEGASUS</span></p>
<p><span class="font19">\\WINXP</span></p>
<p><span class="font19">\\WINXP\C$ \\WINXP\ADMIN$ \\WINXP\share55 \\WINXP\IPC$</span></p>
<p><span class="font19">\\RHEL4B</span></p>
<p><span class="font19">\\RHEL4B\ADMIN$ \\RHEL4B\IPC$ \\RHEL4B\domaindata</span></p>
<p><span class="font19">\\HM2003</span></p>
<p><span class="font19">\\HM2003\NETLOGON \\HM2003\SYSVOL \\HM2003\WSUSTemp \\HM2003\ADMIN$ \\HM2003\tools \\HM2003\IPC$</span></p>
<p><span class="font19">\\HM2003\WsusContent \\HM2003\C$</span></p>
<p><span class="font19">[paul@RHEL4b ~]$</span></p>
</div><br clear="all">
<p><span class="font19">-UAdministrator%Stargate1</span></p>
<p><span class="font19">Default share</span></p>
<p><span class="font19">Remote Admin</span></p>
<p><span class="font19">Remote IPC</span></p>
<p><span class="font19">Pegasus Domain Member Server</span></p>
<p><span class="font19">IPC Service (Pegasus Domain Member Server) IPC Service (Pegasus Domain Member Server) Active Directory users only</span></p>
<p><span class="font19">Logon server share</span></p>
<p><span class="font19">Logon server share</span></p>
<p><span class="font19">A network share used by Local Publishing ... Remote Admin</span></p>
<p><span class="font19">Remote IPC</span></p>
<p><span class="font19">A network share to be used by Local ... Default share</span></p>
<h4><a name="bookmark8730"></a><span class="font25"><a name="bookmark8731"></a>As you can see, this gives a very nice overview of all SMB computers and their shares.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8732"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7844"></a><a name="bookmark8733"></a>10.5. server string</span></h2></li></ul>
<h4><a name="bookmark8734"></a><span class="font25"><a name="bookmark8735"></a><a name="bookmark8736"></a>The comment seen by the </span><span class="font25" style="font-weight:bold;">net view </span><span class="font25">and the </span><span class="font25" style="font-weight:bold;">smbclient </span><span class="font25">commands is the default value for the </span><span class="font25" style="font-weight:bold;">server string </span><span class="font25">option. Simply adding this value to the global section in </span><span class="font25" style="font-weight:bold;">smb.conf </span><span class="font25">and restarting samba will change the option.</span></h4>
<p><span class="font19">[root@RHEL53 samba]# testparm -s 2&gt;/dev/null | grep server server string = Red Hat Server in Paris</span></p>
<h4><a name="bookmark8737"></a><span class="font25"><a name="bookmark8738"></a>After a short while, the changed option is visible on the Microsoft computers.</span></h4>
<p><span class="font19">C:\Documents and Settings\Administrator&gt;net view</span></p>
<p><span class="font19">Server Name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remark</span></p>
<p><span class="font19">\\LAIKA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ubuntu 9.04 server in Antwerp</span></p>
<p><span class="font19">\\RHEL53 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Red Hat Server in Paris</span></p>
<p><span class="font19">\\W2003</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8739"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7845"></a><a name="bookmark8740"></a>10.6. Samba Web Administration Tool (SWAT)</span></h2></li></ul>
<h4><a name="bookmark8741"></a><span class="font25"><a name="bookmark8742"></a><a name="bookmark8743"></a><a name="bookmark8744"></a>Samba comes with a web based tool to manage your samba configuration file. </span><span class="font25" style="font-weight:bold;">SWAT </span><span class="font25">is accessible with a web browser on port 901 of the host s<a name="bookmark8745"></a>ystem. To enable the tool, first find out whether your system is using the </span><span class="font25" style="font-weight:bold;">inetd </span><span class="font25">or the </span><span class="font25" style="font-weight:bold;">xinetd </span><span class="font25">superdaemon.</span></h4>
<p><span class="font19">[root@RHEL4b samba]# ps fax | grep inet</span></p>
<p><span class="font19">15026 pts/0 &nbsp;&nbsp;&nbsp;S+ &nbsp;&nbsp;&nbsp;&nbsp;0:00 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\_ grep inet</span></p>
<p><span class="font19">2771 ? &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ss &nbsp;&nbsp;&nbsp;&nbsp;0:00 xinetd -stayalive -pidfile /var/run/xinetd.pid</span></p>
<p><span class="font19">[root@RHEL4b samba]#</span></p>
<h4><a name="bookmark8746"></a><span class="font25"><a name="bookmark8747"></a><a name="bookmark8748"></a><a name="bookmark8749"></a>Then edit the </span><span class="font25" style="font-weight:bold;">inetd.conf </span><span class="font25">or change the disable = yes line in </span><span class="font25" style="font-weight:bold;">/etc/xinetd.d/swat </span><span class="font25">to disable = no.</span></h4>
<p><span class="font19">[root@RHEL4b samba]# cat /etc/xinetd.d/swat # default: off # description: SWAT is the Samba Web Admin Tool. Use swat \ # &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to configure your Samba server. To use SWAT, \</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connect to port 901 with your favorite web browser.</span></p></li></ul>
<p><a href="#bookmark8750"><span class="font19">service swat { port &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</span></a></p>
<p><span class="font19">socket_type &nbsp;&nbsp;&nbsp;&nbsp;= stream</span></p>
<p><a href="#bookmark8751"><span class="font19">wait &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</span></a></p>
<p><span class="font19">only_from &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 127.0.0.1</span></p>
<p><span class="font19">user &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</span></p>
<p><span class="font19">server &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= /usr/sbin/swat</span></p>
<p><a href="#bookmark8752"><span class="font19">log_on_failure += USERID disable</span></a></p>
<p><span class="font19">} [root@RHEL4b samba]# /etc/init.d/xinetd restart Stopping xinetd: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p>
<p><span class="font19">Starting xinetd: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p>
<p><span class="font19">[root@RHEL4b samba]#</span></p>
<h4><a name="bookmark8753"></a><span class="font25"><a name="bookmark8754"></a>Change the </span><span class="font25" style="font-weight:bold;">only from </span><span class="font25">value to enable swat from remote computers. This examples shows how to provide swat access to all computers in a /24 subnet.</span></h4>
<p><span class="font19">[root@RHEL53 xinetd.d]# grep only /etc/xinetd.d/swat only_from = 192.168.1.0/24</span></p>
<h4><a name="bookmark8755"></a><span class="font25"><a name="bookmark8756"></a>Be careful when using SWAT, it erases all your manually edited comments in smb.conf.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8757"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7839"></a><a name="bookmark8758"></a>10.7. practice: getting started with samba</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Take a backup copy of the original smb.conf, name it smb.conf.orig</span></p></li>
<li>
<p><span class="font25">2. Enable SWAT and take a look at it.</span></p></li>
<li>
<p><span class="font25">3. Stop the Samba server.</span></p></li>
<li>
<p><span class="font25">4. Create a minimalistic smb.conf.minimal and test it with testparm.</span></p></li>
<li>
<p><span class="font25">5. Use tesparm -s to create /etc/samba/smb.conf from your smb.conf.minimal .</span></p></li>
<li>
<p><span class="font25">6. Start Samba with your minimal smb.conf.</span></p></li>
<li>
<p><span class="font25">7. Verify with smbclient that your Samba server works.</span></p></li>
<li>
<p><span class="font25">8. Verify that another (Microsoft) computer can see your Samba server.</span></p></li>
<li>
<p><span class="font25">9. Browse the network with net view, smbtree and with Windows Explorer.</span></p></li>
<li>
<p><span class="font25">10. Change the &quot;Server String&quot; parameter in smb.conf. How long does it take before you see the change (net view, smbclient, My Network Places,...) ?</span></p></li>
<li>
<p><span class="font25">11. Will restarting Samba after a change to smb.conf speed up the change ?</span></p></li>
<li>
<p><span class="font25">12. Which computer is the master browser master in your workgroup ? What is the master browser ?</span></p></li>
<li>
<p><span class="font25">13. If time permits (or if you are waiting for other students to finish this practice), then install a sniffer (wireshark) and watch the browser elections.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8759"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7846"></a><a name="bookmark8760"></a>10.8. solution: getting started with samba</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Take a backup copy of the original smb.conf, name it smb.conf.orig</span></p></li></ul>
<p><span class="font19">cd /etc/samba ; cp smb.conf smb.conf.orig</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Enable SWAT and take a look at it.</span></p></li></ul>
<p><span class="font19">on Debian/Ubuntu: vi /etc/inetd.conf (remove # before swat)</span></p>
<p><span class="font19">on RHEL/Fedora: vi /etc/xinetd.d/swat (set disable to no)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Stop the Samba server.</span></p></li></ul>
<p><span class="font19">/etc/init.d/smb stop (Red Hat)</span></p>
<p><span class="font19">/etc/init.d/samba stop (Debian)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Create a minimalistic smb.conf.minimal and test it with testparm.</span></p></li></ul>
<p><span class="font19">cd /etc/samba ; mkdir my_smb_confs ; cd my_smb_confs</span></p>
<p><span class="font19">vi smb.conf.minimal</span></p>
<p><span class="font19">testparm smb.conf.minimal</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Use tesparm -s to create /etc/samba/smb.conf from your smb.conf.minimal .</span></p></li></ul>
<p><span class="font19">testparm -s smb.conf.minimal &gt;&nbsp;../smb.conf</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Start Samba with your minimal smb.conf.</span></p></li></ul>
<p><span class="font19">/etc/init.d/smb restart (Red Hat)</span></p>
<p><span class="font19">/etc/init.d/samba restart (Debian)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. Verify with smbclient that your Samba server works.</span></p></li></ul>
<p><span class="font19">smbclient -NL 127.0.0.1</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. Verify that another computer can see your Samba server.</span></p></li></ul>
<p><span class="font19">smbclient -NL 'ip-address' (on a Linux)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">9. Browse the network with net view, smbtree and with Windows Explorer. </span><span class="font19">on Linux: smbtree</span></p></li></ul>
<p><span class="font19">on Windows: net view (and WindowsKey + e)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">10. Change the &quot;Server String&quot; parameter in smb.conf. How long does it take before you see the change (net view, smbclient, My Network Places,...) ?</span></p></li></ul>
<p><span class="font19">vi /etc/samba/smb.conf</span></p>
<p><span class="font19">(should take only seconds when restarting samba)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">11. Will restarting Samba after a change to smb.conf speed up the change ? </span><span class="font19">yes</span></p></li>
<li>
<p><span class="font25">12. Which computer is the master browser master in your workgroup ? What is the master browser ?</span></p></li></ul>
<p><span class="font19">The computer that won the elections.</span></p>
<p><span class="font19">This machine will make the list of computers in the network</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">13. If time permits (or if you are waiting for other students to finish this practice), then install a sniffer (wireshark) and watch the browser elections.</span></p></li></ul>
<p><span class="font19">On ubuntu: sudo aptitude install wireshark</span></p>
<p><span class="font19">then: sudo wireshark, select interface</span></p>
<ul style="list-style:none;"><li>
<p><a name="bookmark8761"></a><span class="font11" style="font-weight:bold;">Chapter 11. a read only file server</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8762"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7849"></a><a name="bookmark8763"></a>11.1. Setting up a directory to share</span></h2></li></ul>
<p><span class="font25">Let's start with setting up a very simple read only file server with Samba. Everyone (even anonymous guests) will receive read access.</span></p>
<p><span class="font25">The first step is to create a directory and put some test files in it.</span></p>
<p><span class="font19">[root@RHEL52 ~]# mkdir -p /srv/samba/readonly</span></p>
<p><span class="font19">[root@RHEL52 ~]# cd /srv/samba/readonly/</span></p>
<p><span class="font19">[root@RHEL52 readonly]# echo &quot;It is cold today.&quot; &gt;&nbsp;winter.txt</span></p>
<p><span class="font19">[root@RHEL52 readonly]# echo &quot;It is hot today.&quot; &gt;&nbsp;summer.txt</span></p>
<p><span class="font19">[root@RHEL52 readonly]# ls -l</span></p>
<p><span class="font19">total 8</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-r--r-- 1 root root 17 Jan 21 05:49 summer.txt</span></p></li>
<li>
<p><span class="font19">-rw-r--r-- 1 root root 18 Jan 21 05:49 winter.txt</span></p></li></ul>
<p><span class="font19">[root@RHEL52 readonly]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8764"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7850"></a><a name="bookmark8765"></a>11.2. configure the share</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8766"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8767"></a>11.2.1. smb.conf [global] section</span></h3></li></ul></li></ul>
<p><a name="bookmark8768"></a><span class="font25">In this example the samba server is a member of WORKGROUP (the default workgroup). We also set a descriptive server string, this string is visible to users browsing the network with net view, windows explorer or smbclient.</span></p>
<p><span class="font19">[root@RHEL52 samba]# head -5 smb.conf</span></p>
<p><span class="font19">[global]</span></p>
<p><span class="font19">workgroup = WORKGROUP</span></p>
<p><span class="font19">server string = Public Anonymous File Server</span></p>
<p><span class="font19">netbios name = TEACHER0 security = share</span></p>
<p><a name="bookmark8769"></a><span class="font25">You might have noticed the line with </span><span class="font25" style="font-weight:bold;">security = share</span><span class="font25">. This line sets the default security mode for our samba server. Setting the security mode to </span><span class="font25" style="font-weight:bold;">share </span><span class="font25">will allow clients (smbclient, any windows, another Samba server, ...) to provide a password for each share. This is one way of using the SMB/CIFS protocol. The other way (called </span><span class="font25" style="font-weight:bold;">user mode</span><span class="font25">) will allow the client to provide a username/password combination, before the server knows which share the client wants to access.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8770"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8771"></a>11.2.2. smb.conf [share] section</span></h3></li></ul>
<p><a name="bookmark8772"></a><span class="font25">The share is called pubread and the path is set to our newly created directory. Everyone is allowed access (</span><span class="font25" style="font-weight:bold;">guest ok = yes</span><span class="font25">) and security is set to read only.</span></p>
<p><span class="font19">[pubread]</span></p>
<p><span class="font19">path = /srv/samba/readonly comment = files to read read only = yes guest ok = yes</span></p>
<p><span class="font25">Here is a very similar configuration on Ubuntu 11.10.</span></p>
<p><span class="font19">root@ubu1110:~# cat /etc/samba/smb.conf [global] workgroup = LINUXTR netbios name = UBU1110 security = share [roshare1] path = /srv/samba/readonly read only = yes guest ok = yes</span></p>
<h4><a name="bookmark8773"></a><span class="font25"><a name="bookmark8774"></a>It doesn't really matter which Linux distribution you use. Below the same config on Debian 6, as good as identical.</span></h4>
<p><span class="font19">root@debian6:~# cat /etc/samba/smb.conf [global] workgroup = LINUXTR netbios name = DEBIAN6 security = share [roshare1] path = /srv/samba/readonly read only = yes guest ok = yes</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8775"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7851"></a><a name="bookmark8776"></a>11.3. restart the server</span></h2></li></ul>
<h4><a name="bookmark8777"></a><span class="font25"><a name="bookmark8778"></a>After testing with </span><span class="font25" style="font-weight:bold;">testparm</span><span class="font25">, restart the samba server (so you don't have to wait).</span></h4>
<p><span class="font19">[root@RHEL4b readonly]# service smb restart</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">Shutting</span></p></td><td style="vertical-align:top;">
<p><span class="font19">down SMB services:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">[ OK ]</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Shutting</span></p></td><td style="vertical-align:top;">
<p><span class="font19">down NMB services:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">[ OK ]</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Starting</span></p></td><td style="vertical-align:top;">
<p><span class="font19">SMB services:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">[ OK ]</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Starting</span></p></td><td style="vertical-align:top;">
<p><span class="font19">NMB services:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">[ OK ]</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8779"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7852"></a><a name="bookmark8780"></a>11.4. verify the share</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8781"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8782"></a>11.4.1. verify with smbclient</span></h3></li></ul></li></ul>
<h4><a name="bookmark8783"></a><span class="font25"><a name="bookmark8784"></a><a name="bookmark8785"></a>You can now verify the existence of the share with </span><span class="font25" style="font-weight:bold;">smbclient</span><span class="font25">. Our </span><span class="font25" style="font-weight:bold;">pubread </span><span class="font25">is listed as the fourth share.</span></h4>
<p><span class="font19">[root@RHEL52 samba]# smbclient -NL 127.0.0.1</span></p>
<p><span class="font19">Domain=[WORKGROUP] OS=[Unix] Server=[Samba 3.0.33-3.7.el5]</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">Sharename</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Type</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Comment</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">IPC$</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IPC</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">IPC Service (Public Anonymous File Server)</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">global$</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Disk</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">pub0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Disk</span></p></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">pubread</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Disk</span></p></td><td style="vertical-align:top;">
<p><span class="font19">files to read</span></p></td></tr>
</table>
<p><span class="font19">Domain=[WORKGROUP] OS=[Unix] Server=[Samba 3.0.33-3.7.el5]</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">Server</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Comment</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">TEACHER0</span></p>
<p><span class="font19">W2003EE</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Samba 3.0.33-3.7.el5</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">Workgroup</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">Master</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">WORKGROUP</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">W2003EE</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8786"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8787"></a>11.4.2. verify on windows</span></h3></li></ul>
<h4><a name="bookmark8788"></a><span class="font25"><a name="bookmark8789"></a><a name="bookmark8790"></a>The final test is to go to a Microsoft windows computer and read a file on the Samba server. First we use the </span><span class="font25" style="font-weight:bold;">net use </span><span class="font25">command to mount the pubread share on the driveletter k.</span></h4>
<p><span class="font19">C:\&gt;net use K: \\teacher0\pubread</span></p>
<p><span class="font19">The command completed successfully.</span></p>
<h4><a name="bookmark8791"></a><span class="font25"><a name="bookmark8792"></a>Then we test looking at the contents of the share, and reading the files.</span></h4>
<p><span class="font19">C:\&gt;dir k:</span></p>
<p><span class="font19">Volume in drive K is pubread</span></p>
<p><span class="font19">Volume Serial Number is 0C82-11F2</span></p>
<p><span class="font19">Directory of K:\</span></p>
<p><span class="font19">21/01/2009 05:49 &nbsp;&nbsp;&nbsp;&lt;DIR&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.</span></p>
<p><span class="font19">21/01/2009 05:49 &nbsp;&nbsp;&nbsp;&lt;DIR&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..</span></p>
<p><span class="font19">21/01/2009 05:49 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17 summer.txt</span></p>
<p><span class="font19">21/01/2009 05:49 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;18 winter.txt</span></p>
<p><span class="font19">2 File(s) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;35 bytes</span></p>
<p><span class="font19">2 Dir(s) 13.496.242.176 bytes free</span></p>
<h4><a name="bookmark8793"></a><span class="font25"><a name="bookmark8794"></a>Just to be on the safe side, let us try writing.</span></h4>
<p><span class="font19">K:\&gt;echo very cold &gt;&nbsp;winter.txt Access is denied.</span></p>
<p><span class="font19">K:\&gt;</span></p>
<h4><a name="bookmark8795"></a><span class="font25"><a name="bookmark8796"></a>Or you can use windows explorer...</span></h4><img src="linux_guide_files/The Complete Linux Guide-153.jpg" alt="" style="width:412pt;height:299pt;">
<ul style="list-style:none;"><li>
<h2><a name="bookmark8797"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7853"></a><a name="bookmark8798"></a>11.5. a note on netcat</span></h2></li></ul>
<p><a name="bookmark8799"></a><span class="font25">The Windows command line screenshot is made in a Linux console, using </span><span class="font25" style="font-weight:bold;">netcat </span><span class="font25">as a pipe to a Windows command shell.</span></p>
<p><span class="font25">The way this works, is by enabling netcat to listen on the windows computer to a certain port, executing cmd.exe when a connection is received. Netcat is similar to cat, in the way that cat does nothing, only netcat does nothing over the network.</span></p>
<p><span class="font25">To enable this connection, type the following on the windows computer (after downloading netcat for windows).</span></p>
<p><span class="font19">nc -l -p 23 -t -e cmd.exe</span></p>
<p><span class="font25">And then connect to this machine with netcat from any Linux computer. You end up with a cmd.exe prompt inside your Linux shell.</span></p>
<p><span class="font19">paul@laika:~$ nc 192.168.1.38 23</span></p>
<p><span class="font19">Microsoft Windows [Version 5.2.3790]</span></p>
<p><span class="font19">(C) Copyright 1985-2003 Microsoft Corp.</span></p>
<p><span class="font19">C:\&gt;net use k: /delete</span></p>
<p><span class="font19">net use k: /delete</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">k: was deleted successfully.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8800"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7848"></a><a name="bookmark8801"></a>11.6. practice: read only file server</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create a directory in a good location (FHS) to share files for everyone to read.</span></p></li>
<li>
<p><span class="font25">2. Make sure the directory is owned properly and is world accessible.</span></p></li>
<li>
<p><span class="font25">3. Put a textfile in this directory.</span></p></li>
<li>
<p><span class="font25">4. Share the directory with Samba.</span></p></li>
<li>
<p><span class="font25">5. Verify from your own and from another computer (smbclient, net use, ...) that the share is accessible for reading.</span></p></li>
<li>
<p><span class="font25">6. Make a backup copy of your smb.conf, name it smb.conf.ReadOnlyFileServer.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8802"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7854"></a><a name="bookmark8803"></a>11.7. solution: read only file server</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark8804"></a><span class="font25"><a name="bookmark8805"></a>1. Create a directory in a good location (FHS) to share files for everyone to read.</span></h4></li></ul>
<p><span class="font19">choose one of these...</span></p>
<p><span class="font19">mkdir -p /srv/samba/readonly</span></p>
<p><span class="font19">mkdir -p /home/samba/readonly</span></p>
<p><span class="font19">/home/paul/readonly is wrong!!</span></p>
<p><span class="font19">/etc/samba/readonly is wrong!!</span></p>
<p><span class="font19">/readonly is wrong!!</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark8806"></a><span class="font25"><a name="bookmark8807"></a>2. Make sure the directory is owned properly and is world accessible.</span></h4></li></ul>
<p><span class="font19">chown root:root /srv/samba/readonly</span></p>
<p><span class="font19">chmod 755 /srv/samba/readonly</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark8808"></a><span class="font25"><a name="bookmark8809"></a>3. Put a textfile in this directory.</span></h4></li></ul>
<p><span class="font19">echo Hello World &gt;&nbsp;hello.txt</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark8810"></a><span class="font25"><a name="bookmark8811"></a>4. Share the directory with Samba.</span></h4></li></ul>
<p><span class="font19">You smb.conf.readonly could look like this: [global]</span></p>
<p><span class="font19">workgroup = WORKGROUP</span></p>
<p><span class="font19">server string = Read Only File Server</span></p>
<p><span class="font19">netbios name = STUDENTx security = share</span></p>
<p><span class="font19">[readonlyX]</span></p>
<p><span class="font19">path = /srv/samba/readonly comment = read only file share read only = yes guest ok = yes</span></p>
<p><span class="font19">test with testparm before going in production!</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark8812"></a><span class="font25"><a name="bookmark8813"></a>5. Verify from your own and from another computer (smbclient, net use, ...) that the share is accessible for reading.</span></h4></li></ul>
<p><span class="font19">On Linux: smbclient -NL 127.0.0.1</span></p>
<p><span class="font19">On Windows Explorer: browse to My Network Places</span></p>
<p><span class="font19">On Windows cmd.exe: net use L: //studentx/readonly</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark8814"></a><span class="font25"><a name="bookmark8815"></a>6. Make a backup copy of your smb.conf, name it smb.conf.ReadOnlyFileServer.</span></h4></li></ul>
<p><span class="font19">cp smb.conf smb.conf.ReadOnlyFileServer</span></p>
<ul style="list-style:none;"><li>
<p><a name="bookmark8816"></a><span class="font11" style="font-weight:bold;">Chapter 12. a writable file server</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8817"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7857"></a><a name="bookmark8818"></a>12.1. set up a directory to share</span></h2></li></ul>
<h4><a name="bookmark8819"></a><span class="font25"><a name="bookmark8820"></a>In this second example, we will create a share where everyone can create files and write to files. Again, we start by creating a directory</span></h4>
<p><span class="font19">[root@RHEL52 samba]# mkdir -p /srv/samba/writable</span></p>
<p><span class="font19">[root@RHEL52 samba]# chmod 777 /srv/samba/writable/</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8821"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7858"></a><a name="bookmark8822"></a>12.2. share section in smb.conf</span></h2></li></ul>
<h4><a name="bookmark8823"></a><span class="font25"><a name="bookmark8824"></a><a name="bookmark8825"></a><a name="bookmark8826"></a>There are two parameters to make a share writable. We can use </span><span class="font25" style="font-weight:bold;">read only </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">writable</span><span class="font25">. This example shows how to use </span><span class="font25" style="font-weight:bold;">writable </span><span class="font25">to give write access to a share. </span><span class="font19">writable = yes</span></h4>
<h4><a name="bookmark8827"></a><span class="font25"><a name="bookmark8828"></a>And this is an example of using the </span><span class="font25" style="font-weight:bold;">read only </span><span class="font25">parameter to give write access to a share.</span></h4>
<p><span class="font19">read only = no</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8829"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7859"></a><a name="bookmark8830"></a>12.3. configure the share</span></h2></li></ul>
<h4><a name="bookmark8831"></a><span class="font25"><a name="bookmark8832"></a><a name="bookmark8833"></a>Then we simply add a share to our file server by editing </span><span class="font25" style="font-weight:bold;">smb.conf</span><span class="font25">. Below the check with testparm. (We could have changed the description of the server...)</span></h4>
<p><span class="font19">[root@RHEL52 samba]# testparm</span></p>
<p><span class="font19">Load smb config files from /etc/samba/smb.conf Processing section &quot;[pubwrite]&quot; Processing section &quot;[pubread]&quot; Loaded services file OK.</span></p>
<p><span class="font19">Server role: ROLE_STANDALONE</span></p>
<p><span class="font19">Press enter to see a dump of your service definitions</span></p>
<p><span class="font19">[global]</span></p>
<p><span class="font19">netbios name = TEACHER0</span></p>
<p><span class="font19">server string = Public Anonymous File Server security = SHARE</span></p>
<p><span class="font19">[pubwrite] comment = files to write path = /srv/samba/writable read only = No guest ok = Yes</span></p>
<p><span class="font19">[pubread] comment = files to read path = /srv/samba/readonly guest ok = Yes</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8834"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7860"></a><a name="bookmark8835"></a>12.4. test connection with windows</span></h2></li></ul>
<h4><a name="bookmark8836"></a><span class="font25"><a name="bookmark8837"></a><a name="bookmark8838"></a>We can now test the connection on a windows 2003 computer. We use the </span><span class="font25" style="font-weight:bold;">net use </span><span class="font25">for this.</span></h4>
<p><span class="font19">C:\&gt;net use L: \\teacher0\pubwrite</span></p>
<p><span class="font19">net use L: \\teacher0\pubwrite The command completed successfully.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8839"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7861"></a><a name="bookmark8840"></a>12.5. test writing with windows</span></h2></li></ul>
<p><span class="font25">We mounted the </span><span class="font25" style="font-weight:bold;">pubwrite </span><span class="font25">share on the L: drive in windows. Below we test that we can write to this share.</span></p>
<p><span class="font19">L:\&gt;echo hoi &gt;&nbsp;hoi.txt</span></p>
<p><span class="font19">L:\&gt;dir</span></p>
<p><span class="font19">Volume in drive L is pubwrite</span></p>
<p><span class="font19">Volume Serial Number is 0C82-272A</span></p>
<p><span class="font19">Directory of L:\</span></p>
<p><span class="font19">21/01/2009 06:11 &nbsp;&nbsp;&nbsp;&lt;DIR&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.</span></p>
<p><span class="font19">21/01/2009 06:11 &nbsp;&nbsp;&nbsp;&lt;DIR&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..</span></p>
<p><span class="font19">21/01/2009 &nbsp;06:16 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6 hoi.txt</span></p>
<p><span class="font19">1 File(s) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6 bytes</span></p>
<p><span class="font19">2 Dir(s) 13.496.238.080 bytes free</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8841"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7862"></a><a name="bookmark8842"></a>12.6. How is this possible ?</span></h2></li></ul>
<p><span class="font25">Linux (or any Unix) always needs a user account to gain access to a system. The windows computer did not provide the samba server with a user account or a password. Instead, the Linux owner of the files created through this writable share is the Linux guest account (usually named nobody).</span></p>
<p><span class="font19">[root@RHEL52 samba]# ls -l /srv/samba/writable/ total 4</span></p>
<p><span class="font19">-rwxr--r-- 1 nobody nobody 6 Jan 21 06:16 hoi.txt</span></p>
<p><span class="font25">So this is not the cleanest solution. We will need to improve this.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8843"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7856"></a><a name="bookmark8844"></a>12.7. practice: writable file server</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create a directory and share it with Samba.</span></p></li>
<li>
<p><span class="font25">2. Make sure everyone can read and write files, test writing with smbclient and from a Microsoft computer.</span></p></li>
<li>
<p><span class="font25">3. Verify the ownership of files created by (various) users.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8845"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7855"></a><a name="bookmark8846"></a>12.8. solution: writable file server</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark8847"></a><span class="font25"><a name="bookmark8848"></a>1. Create a directory and share it with Samba.</span></h4></li></ul>
<p><span class="font19">mkdir /srv/samba/writable</span></p>
<p><span class="font19">chmod 777 /srv/samba/writable</span></p>
<p><span class="font19">the share section in smb.conf can look like this:</span></p>
<p><span class="font19">[pubwrite]</span></p>
<p><span class="font19">path = /srv/samba/writable comment = files to write read only = no guest ok = yes</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark8849"></a><span class="font25"><a name="bookmark8850"></a>2. Make sure everyone can read and write files, test writing with smbclient and from a Microsoft computer.</span></h4></li></ul>
<p><span class="font19">to test writing with smbclient:</span></p>
<p><span class="font19">echo one &gt;&nbsp;count.txt</span></p>
<p><span class="font19">echo two &gt;&gt;&nbsp;count.txt</span></p>
<p><span class="font19">echo three &gt;&gt;&nbsp;count.txt</span></p>
<p><span class="font19">smbclient //localhost/pubwrite</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">smb: \&gt; put count.txt</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark8851"></a><span class="font25"><a name="bookmark8852"></a>3. Verify the ownership of files created by (various) users.</span></h4></li></ul>
<p><span class="font19">ls -l /srv/samba/writable</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8853"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7866"></a><a name="bookmark8854"></a>13.1. creating a samba user</span></h2></li></ul>
<p><span class="font25">We will create a user for our samba file server and make this user the owner of the directory and all of its files. This anonymous user gets a clear description, but does not get a login shell.</span></p>
<p><span class="font19">[root@RHEL52 samba]# useradd -s /bin/false sambanobody</span></p>
<p><span class="font19">[root@RHEL52 samba]# usermod -c &quot;Anonymous Samba Access&quot; sambanobody</span></p>
<p><span class="font19">[root@RHEL52 samba]# passwd sambanobody</span></p>
<p><span class="font19">Changing password for user sambanobody.</span></p>
<p><span class="font19">New UNIX password:</span></p>
<p><span class="font19">Retype new UNIX password:</span></p>
<p><span class="font19">passwd: all authentication tokens updated successfully.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8855"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7867"></a><a name="bookmark8856"></a>13.2. ownership of files</span></h2></li></ul>
<p><span class="font25">We can use this user as owner of files and directories, instead of using the root account. This approach is clear and more secure.</span></p>
<p><span class="font19">[root@RHEL52 samba]# chown -R sambanobody:sambanobody /srv/samba/ [root@RHEL52 samba]# ls -al /srv/samba/writable/</span></p>
<p><span class="font19">total 12</span></p>
<p><span class="font19">drwxrwxrwx 2 sambanobody sambanobody 4096 Jan 21 06:11 .</span></p>
<p><span class="font19">drwxr-xr-x 6 sambanobody sambanobody 4096 Jan 21 06:11 ..</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rwxr--r-- 1 sambanobody sambanobody &nbsp;&nbsp;&nbsp;6 Jan 21 06:16 hoi.txt</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8857"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7868"></a><a name="bookmark8858"></a>13.3. /usr/bin/smbpasswd</span></h2></li></ul>
<p><span class="font25">The sambanobody user account that we created in the previous examples is not yet used by samba. It just owns the files and directories that we created for our shares. The goal of this section is to force ownership of files created through the samba share to belong to our sambanobody user. Remember, our server is still accessible to everyone, nobody needs to know this user account or password. We just want a clean Linux server.</span></p>
<p><a name="bookmark8859"></a><span class="font25">To accomplish this, we first have to tell Samba about this user. We can do this by adding the account to </span><span class="font25" style="font-weight:bold;">smbpasswd</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL52 samba]# smbpasswd -a sambanobody</span></p>
<p><span class="font19">New SMB password:</span></p>
<p><span class="font19">Retype new SMB password: Added user sambanobody.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8860"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7869"></a><a name="bookmark8861"></a>13.4. /etc/samba/smbpasswd</span></h2></li></ul>
<p><a name="bookmark8862"></a><span class="font25">To find out where Samba keeps this information (for now), use </span><span class="font25" style="font-weight:bold;">smbd -b</span><span class="font25">. The PRIVATE_DIR variable will show you where the smbpasswd database is located.</span></p>
<p><span class="font19">[root@RHEL52 samba]# smbd -b | grep PRIVATE</span></p>
<p><span class="font19">PRIVATE_DIR: /etc/samba</span></p>
<p><span class="font19">[root@RHEL52 samba]# ls -l smbpasswd</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw------- 1 root root 110 Jan 21 06:19 smbpasswd</span></p></li></ul>
<p><a name="bookmark8863"></a><span class="font25">You can use a simple cat to see the contents of the </span><span class="font25" style="font-weight:bold;">smbpasswd </span><span class="font25">database. The sambanobody user does have a password (it is secret).</span></p>
<p><span class="font19">[root@RHEL52 samba]# cat smbpasswd</span></p>
<p><span class="font19">sambanobody:503:AE9 ... 9DB309C528E540978:[U &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]:LCT-4976B05B:</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8864"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7870"></a><a name="bookmark8865"></a>13.5. passdb backend</span></h2></li></ul>
<p><a name="bookmark8866"></a><span class="font25"><a name="bookmark8867"></a>Note that recent versions of Samba have </span><span class="font25" style="font-weight:bold;">tdbsam </span><span class="font25">as default for the </span><span class="font25" style="font-weight:bold;">passdb backend </span><span class="font25">paramater.</span></p>
<p><span class="font19">root@ubu1110:~# testparm -v 2&gt;/dev/null| grep 'passdb backend'</span></p>
<p><span class="font19">passdb backend = tdbsam</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8868"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7871"></a><a name="bookmark8869"></a>13.6. forcing this user</span></h2></li></ul>
<p><a name="bookmark8870"></a><span class="font25"><a name="bookmark8871"></a>Now that Samba knows about this user, we can adjust our writable share to force the ownership of files created through it. For this we use the </span><span class="font25" style="font-weight:bold;">force user </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">force group </span><span class="font25">options. Now we can be sure that all files in the Samba writable share are owned by the same sambanobody user.</span></p>
<p><span class="font25">Below is the renewed definition of our share in smb.conf.</span></p>
<p><span class="font19">[pubwrite] path = /srv/samba/writable comment = files to write force user = sambanobody force group = sambanobody read only = no guest ok = yes</span></p>
<p><span class="font25">When you reconnect to the share and write a file, then this sambanobody user will own the newly created file (and nobody needs to know the password).</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8872"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7872"></a><a name="bookmark8873"></a>13.7. practice: first samba user account</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create a user account for use with samba.</span></p></li>
<li>
<p><span class="font25">2. Add this user to samba's user database.</span></p></li>
<li>
<p><span class="font25">3. Create a writable shared directory and use the &quot;force user&quot; and &quot;force group&quot; directives to force ownership of files.</span></p></li>
<li>
<p><span class="font25">4. Test the working of force user with smbclient, net use and Windows Explorer.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8874"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7873"></a><a name="bookmark8875"></a>13.8. solution: first samba user account</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark8876"></a><span class="font25"><a name="bookmark8877"></a>1. Create a user account for use with samba.</span></h4></li></ul>
<p><span class="font19">useradd -s /bin/false smbguest</span></p>
<p><span class="font19">usermod -c 'samba guest'</span></p>
<p><span class="font19">passwd smbguest</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark8878"></a><span class="font25"><a name="bookmark8879"></a>2. Add this user to samba's user database.</span></h4></li></ul>
<p><span class="font19">smbpasswd -a smbguest</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark8880"></a><span class="font25"><a name="bookmark8881"></a>3. Create a writable shared directory and use the &quot;force user&quot; and &quot;force group&quot; directives to force ownership of files.</span></h4></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font19">[userwrite]</span></p></li></ul>
<p><span class="font19">path = /srv/samba/userwrite</span></p>
<p><span class="font19">comment = everyone writes files owned by smbguest read only = no guest ok = yes force user = smbguest force group = smbguest</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark8882"></a><span class="font25"><a name="bookmark8883"></a>4. Test the working of force user with smbclient, net use and Windows Explorer.</span></h4></li></ul>
<p><span class="font19">ls -l /srv/samba/userwrite (and verify ownership)</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8884"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7875"></a><a name="bookmark8885"></a>14.1. creating the users on Linux</span></h2></li></ul>
<p><span class="font25">The goal of this example is to set up a file share accessible to a number of different users. The users will need to authenticate with their password before access to this share is granted. We will first create three randomly named users, each with their own password. First we add these users to Linux.</span></p>
<p><span class="font19">[root@RHEL52 ~]# useradd -c &quot;Serena Williams&quot; serena [root@RHEL52 ~]# useradd -c &quot;Justine Henin&quot; justine [root@RHEL52 ~]# useradd -c &quot;Martina Hingis&quot; martina [root@RHEL52 ~]# passwd serena Changing password for user serena.</span></p>
<p><span class="font19">New UNIX password:</span></p>
<p><span class="font19">Retype new UNIX password:</span></p>
<p><span class="font19">passwd: all authentication tokens updated successfully. [root@RHEL52 ~]# passwd justine Changing password for user justine.</span></p>
<p><span class="font19">New UNIX password:</span></p>
<p><span class="font19">Retype new UNIX password:</span></p>
<p><span class="font19">passwd: all authentication tokens updated successfully. [root@RHEL52 ~]# passwd martina Changing password for user martina.</span></p>
<p><span class="font19">New UNIX password:</span></p>
<p><span class="font19">Retype new UNIX password:</span></p>
<p><span class="font19">passwd: all authentication tokens updated successfully.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8886"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7876"></a><a name="bookmark8887"></a>14.2. creating the users on samba</span></h2></li></ul>
<p><a name="bookmark8888"></a><span class="font25">Then we add them to the </span><span class="font25" style="font-weight:bold;">smbpasswd </span><span class="font25">file, with the same password.</span></p>
<p><span class="font19">[root@RHEL52 ~]# smbpasswd -a serena</span></p>
<p><span class="font19">New SMB password:</span></p>
<p><span class="font19">Retype new SMB password:</span></p>
<p><span class="font19">Added user serena.</span></p>
<p><span class="font19">[root@RHEL52 ~]# smbpasswd -a justine</span></p>
<p><span class="font19">New SMB password:</span></p>
<p><span class="font19">Retype new SMB password:</span></p>
<p><span class="font19">Added user justine.</span></p>
<p><span class="font19">[root@RHEL52 ~]# smbpasswd -a martina</span></p>
<p><span class="font19">New SMB password:</span></p>
<p><span class="font19">Retype new SMB password:</span></p>
<p><span class="font19">Added user martina.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8889"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7877"></a><a name="bookmark8890"></a>14.3. security = user</span></h2></li></ul>
<p><a name="bookmark8891"></a><span class="font25">Remember that we set samba's security mode to share with the </span><span class="font25" style="font-weight:bold;">security = share </span><span class="font25">directive in the [global] section ? Since we now require users to always provide a userid and password for access to our samba server, we will need to change this. Setting </span><span class="font25" style="font-weight:bold;">security = user </span><span class="font25">will require the client to provide samba with a valid userid and password before giving access to a share.</span></p>
<p><span class="font25">Our [global] section now looks like this.</span></p>
<p><span class="font19">[global] workgroup = WORKGROUP netbios name = TEACHER0 server string = Samba File Server security = user</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8892"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7878"></a><a name="bookmark8893"></a>14.4. configuring the share</span></h2></li></ul>
<h4><a name="bookmark8894"></a><span class="font25"><a name="bookmark8895"></a>We add the following [share] section to our smb.conf (and we do not forget to create the directory /srv/samba/authwrite).</span></h4>
<p><span class="font19">[authwrite]</span></p>
<p><span class="font19">path = /srv/samba/authwrite</span></p>
<p><span class="font19">comment = authenticated users only</span></p>
<p><span class="font19">read only = no guest ok = no</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8896"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7879"></a><a name="bookmark8897"></a>14.5. testing access with net use</span></h2></li></ul>
<h4><a name="bookmark8898"></a><span class="font25"><a name="bookmark8899"></a><a name="bookmark8900"></a>After restarting samba, we test with different users from within Microsoft computers. The screenshots use the </span><span class="font25" style="font-weight:bold;">net use</span><span class="font25">First serena from Windows XP.</span></h4>
<p><span class="font19">C:\&gt;net use m: \\teacher0\authwrite stargate /user:serena The command completed successfully.</span></p>
<p><span class="font19">C:\&gt;m:</span></p>
<p><span class="font19">M:\&gt;echo greetings from Serena &gt;&nbsp;serena.txt</span></p>
<h4><a name="bookmark8901"></a><span class="font25"><a name="bookmark8902"></a>The next screenshot is martina on a Windows 2000 computer, she succeeds in writing her files, but fails to overwrite the file from serena.</span></h4>
<p><span class="font19">C:\&gt;net use k: \\teacher0\authwrite stargate /user:martina The command completed successfully.</span></p>
<p><span class="font19">C:\&gt;k:</span></p>
<p><span class="font19">K:\&gt;echo greetings from martina &gt;&nbsp;Martina.txt</span></p>
<p><span class="font19">K:\&gt;echo test overwrite &gt;&nbsp;serena.txt</span></p>
<p><span class="font19">Access is denied.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8903"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7880"></a><a name="bookmark8904"></a>14.6. testing access with smbclient</span></h2></li></ul>
<h4><a name="bookmark8905"></a><span class="font25"><a name="bookmark8906"></a><a name="bookmark8907"></a>You can also test connecting with authentication with </span><span class="font25" style="font-weight:bold;">smbclient</span><span class="font25">. First we test with a wrong password.</span></h4>
<p><span class="font19">[root@RHEL52 samba]# smbclient //teacher0/authwrite -U martina wrongpass session setup failed: NT_STATUS_LOGON_FAILURE</span></p>
<h4><a name="bookmark8908"></a><span class="font25"><a name="bookmark8909"></a>Then we test with the correct password, and verify that we can access a file on the share.</span></h4>
<p><span class="font19">[root@RHEL52 samba]# smbclient //teacherO/authwrite -U martina stargate</span></p>
<p><span class="font19">Domain=[TEACHER0] OS=[Unix] Server=[Samba 3.0.33-3.7.el5] smb: \&gt; more serena.txt</span></p>
<p><span class="font19">getting file \serena.txt of size 14 as /tmp/smbmore.QQfmSN (6.8 kb/s) one two three smb: \&gt; q</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8910"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7881"></a><a name="bookmark8911"></a>14.7. verify ownership</span></h2></li></ul>
<h4><a name="bookmark8912"></a><span class="font25"><a name="bookmark8913"></a>We now have a simple standalone samba file server with authenticated access. And the files in the shares belong to their proper owners.</span></h4>
<p><span class="font19">[root@RHEL52 samba]# ls -l /srv/samba/authwrite/ total 8</span></p>
<p><span class="font19">-rwxr--r-- 1 martina martina &nbsp;0 Jan 21 20:06 martina.txt</span></p>
<p><span class="font19">-rwxr--r-- 1 serena &nbsp;serena &nbsp;14 Jan 21 20:06 serena.txt</span></p>
<p><span class="font19">-rwxr--r-- 1 serena &nbsp;serena &nbsp;&nbsp;6 Jan 21 20:09 ser.txt</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8914"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7882"></a><a name="bookmark8915"></a>14.8. common problems</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8916"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8917"></a>14.8.1. NT_STATUS_BAD_NETWORK_NAME</span></h3></li></ul></li></ul>
<h4><a name="bookmark8918"></a><span class="font25"><a name="bookmark8919"></a><a name="bookmark8920"></a>You can get </span><span class="font25" style="font-weight:bold;">NT_STATUS_BAD_NETWORK_NAME </span><span class="font25">when you forget to create the target directory.</span></h4>
<p><span class="font19">[root@RHEL52 samba]# rm -rf /srv/samba/authwrite/</span></p>
<p><span class="font19">[root@RHEL52 samba]# smbclient //teacher0/authwrite -U martina stargate</span></p>
<p><span class="font19">Domain=[TEACHER0] OS=[Unix] Server=[Samba 3.0.33-3.7.el5] tree connect failed: NT_STATUS_BAD_NETWORK_NAME</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8921"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8922"></a>14.8.2. NT_STATUS_LOGON_FAILURE</span></h3></li></ul>
<h4><a name="bookmark8923"></a><span class="font25"><a name="bookmark8924"></a><a name="bookmark8925"></a>You can get </span><span class="font25" style="font-weight:bold;">NT_STATUS_LOGON_FAILURE </span><span class="font25">when you type the wrong password or when you type an unexisting username.</span></h4>
<p><span class="font19">[root@RHEL52 samba]# smbclient //teacher0/authwrite -U martina STARGATE session setup failed: NT_STATUS_LOGON_FAILURE</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8926"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8927"></a>14.8.3. usernames are (not) case sensitive</span></h3></li></ul>
<h4><a name="bookmark8928"></a><span class="font25"><a name="bookmark8929"></a>Remember that usernames om Linux are case sensitive.</span></h4>
<p><span class="font19">[root@RHEL52 samba]# su - MARTINA su: user MARTINA does not exist</span></p>
<p><span class="font19">[root@RHEL52 samba]# su - martina [martina@RHEL52 ~]$</span></p>
<h4><a name="bookmark8930"></a><span class="font25"><a name="bookmark8931"></a>But usernames on Microsoft computers are not case sensitive.</span></h4>
<p><span class="font19">[root@RHEL52 samba]# smbclient //teacherO/authwrite -U martina stargate Domain=[TEACHER0] OS=[Unix] Server=[Samba 3.0.33-3.7.el5] smb: \&gt; q</span></p>
<p><span class="font19">[root@RHEL52 samba]# smbclient //teacher0/authwrite -U MARTINA stargate Domain=[TEACHER0] OS=[Unix] Server=[Samba 3.0.33-3.7.el5] smb: \&gt; q</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8932"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7883"></a><a name="bookmark8933"></a>14.9. practice : samba authentication</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">0. Make sure you have properly named backups of your smb.conf of the previous practices.</span></p></li>
<li>
<p><span class="font25">1. Create three users (on the Linux and on the samba), remember their passwords!</span></p></li>
<li>
<p><span class="font25">2. Set up a shared directory that is only accessible to authenticated users.</span></p></li>
<li>
<p><span class="font25">3. Use smbclient and a windows computer to access your share, use more than one user account (windows requires a logoff/logon for this).</span></p></li>
<li>
<p><span class="font25">4. Verify that files created by these users belong to them.</span></p></li>
<li>
<p><span class="font25">5. Try to change or delete a file from another user.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8934"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7884"></a><a name="bookmark8935"></a>14.10. solution: samba authentication</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create three users (on the Linux and on the samba), remember their passwords!</span></p></li></ul>
<p><span class="font19">useradd -c 'SMB useri' userx</span></p>
<p><span class="font19">passwd userx</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Set up a shared directory that is only accessible to authenticated users.</span></p></li></ul>
<p><span class="font19">The shared section in smb.conf could look like this:</span></p>
<p><span class="font19">[authwrite]</span></p>
<p><span class="font19">path = /srv/samba/authwrite</span></p>
<p><span class="font19">comment = authenticated users only</span></p>
<p><span class="font19">read only = no guest ok = no</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Use smbclient and a windows computer to access your share, use more than one user account (windows requires a logoff/logon for this).</span></p></li></ul>
<p><span class="font19">on Linux: smbclient //studentX/authwrite -U useri password</span></p>
<p><span class="font19">on windows net use p: \\studentX\authwrite password /user:user2</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Verify that files created by these users belong to them.</span></p></li></ul>
<p><span class="font19">ls -l /srv/samba/authwrite</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Try to change or delete a file from another user.</span></p></li></ul>
<p><span class="font19">you should not be able to change or overwrite files from others.</span></p>
<ul style="list-style:none;"><li>
<p><a name="bookmark8936"></a><span class="font11" style="font-weight:bold;">Chapter 15. samba securing shares</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8937"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7886"></a><a name="bookmark8938"></a>15.1. security based on user name</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8939"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8940"></a>15.1.1. valid users</span></h3></li></ul></li></ul>
<p><a name="bookmark8941"></a><span class="font25">To restrict users per share, you can use the </span><span class="font25" style="font-weight:bold;">valid users </span><span class="font25">parameter. In the example below, only the users listed as valid will be able to access the tennis share.</span></p>
<p><span class="font19">[tennis]</span></p>
<p><span class="font19">path = /srv/samba/tennis</span></p>
<p><span class="font19">comment = authenticated and valid users only</span></p>
<p><span class="font19">read only = No guest ok = No valid users = serena, kim, venus, justine</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8942"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8943"></a>15.1.2. invalid users</span></h3></li></ul>
<p><a name="bookmark8944"></a><span class="font25">If you are paranoia, you can also use </span><span class="font25" style="font-weight:bold;">invalid users </span><span class="font25">to explicitely deny the listed users access.</span></p>
<p><span class="font25">When a user is in both lists, the user has no access!</span></p>
<p><span class="font19">[tennis]</span></p>
<p><span class="font19">path = /srv/samba/tennis</span></p>
<p><span class="font19">read only = No</span></p>
<p><span class="font19">guest ok = No</span></p>
<p><span class="font19">valid users = kim, serena, venus, justine invalid users = venus</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8945"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8946"></a>15.1.3. read list</span></h3></li></ul>
<p><a name="bookmark8947"></a><span class="font25">On a writable share, you can set a list of read only users with the </span><span class="font25" style="font-weight:bold;">read list </span><span class="font25">parameter.</span></p>
<p><span class="font19">[football]</span></p>
<p><span class="font19">path = /srv/samba/football</span></p>
<p><span class="font19">read only = No</span></p>
<p><span class="font19">guest ok = No read list = martina, roberto</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8948"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8949"></a>15.1.4. write list</span></h3></li></ul>
<p><a name="bookmark8950"></a><span class="font25">Even on a read only share, you can set a list of users that can write. Use the </span><span class="font25" style="font-weight:bold;">write list </span><span class="font25">parameter.</span></p>
<p><span class="font19">[football]</span></p>
<p><span class="font19">path = /srv/samba/golf</span></p>
<p><span class="font19">read only = Yes</span></p>
<p><span class="font19">guest ok = No</span></p>
<p><span class="font19">write list = eddy, jan</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8951"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7887"></a><a name="bookmark8952"></a>15.2. security based on ip-address</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8953"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8954"></a>15.2.1. hosts allow</span></h3></li></ul></li></ul>
<p><a name="bookmark8955"></a><span class="font25"><a name="bookmark8956"></a>The </span><span class="font25" style="font-weight:bold;">hosts allow </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">allow hosts </span><span class="font25">parameter is one of the key advantages of Samba. It allows access control of shares on the ip-address level. To allow only specific hosts to access a share, list the hosts, separated by comma's.</span></p>
<p><span class="font19">allow hosts = 192.168.1.5, 192.168.1.40</span></p>
<p><span class="font25">Allowing entire subnets is done by ending the range with a dot.</span></p>
<p><span class="font19">allow hosts = 192.168.1.</span></p>
<p><span class="font25">Subnet masks can be added in the classical way.</span></p>
<p><span class="font19">allow hosts = 10.0.0.0/255.0.0.0</span></p>
<p><span class="font25">You can also allow an entire subnet with exceptions.</span></p>
<p><span class="font19">hosts allow = 10. except 10.0.0.12</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8957"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8958"></a>15.2.2. hosts deny</span></h3></li></ul>
<p><a name="bookmark8959"></a><span class="font25"><a name="bookmark8960"></a>The </span><span class="font25" style="font-weight:bold;">hosts deny </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">deny hosts </span><span class="font25">parameter is the logical counterpart of the previous. The syntax is the same as for hosts allow.</span></p>
<p><span class="font19">hosts deny = 192.168.1.55, 192.168.1.56</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8961"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7888"></a><a name="bookmark8962"></a>15.3. security through obscurity</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8963"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8964"></a>15.3.1. hide unreadable</span></h3></li></ul></li></ul>
<p><a name="bookmark8965"></a><span class="font25">Setting </span><span class="font25" style="font-weight:bold;">hide unreadable </span><span class="font25">to yes will prevent users from seeing files that cannot be read by them.</span></p>
<p><span class="font19">hide unreadable = yes</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8966"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8967"></a>15.3.2. browsable</span></h3></li></ul>
<p><a name="bookmark8968"></a><span class="font25">Setting the </span><span class="font25" style="font-weight:bold;">browseable = no </span><span class="font25">directive will hide shares from My Network Places. But it will not prevent someone from accessing the share (when the name of the share is known).</span></p>
<p><a name="bookmark8969"></a><span class="font25">Note that </span><span class="font25" style="font-weight:bold;">browsable </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">browseable </span><span class="font25">are both correct syntax.</span></p>
<p><span class="font19">[pubread]</span></p>
<p><span class="font19">path = /srv/samba/readonly comment = files to read read only = yes guest ok = yes browseable = no</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8970"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7889"></a><a name="bookmark8971"></a>15.4. file system security</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8972"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8973"></a>15.4.1. create mask</span></h3></li></ul></li></ul>
<p><a name="bookmark8974"></a><span class="font25"><a name="bookmark8975"></a>You can use </span><span class="font25" style="font-weight:bold;">create mask </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">directory mask </span><span class="font25">to set the maximum allowed permissions for newly created files and directories. The mask you set is an AND mask (it takes permissions away).</span></p>
<p><span class="font19">[tennis]</span></p>
<p><span class="font19">path = /srv/samba/tennis read only = No</span></p>
<p><span class="font19">guest ok = No create mask = 640 directory mask = 750</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8976"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8977"></a>15.4.2. force create mode</span></h3></li></ul>
<p><a name="bookmark8978"></a><span class="font25">Similar to </span><span class="font25" style="font-weight:bold;">create mask</span><span class="font25">, but different. Where the mask from above was a logical AND, the mode<a name="bookmark8979"></a> you set here is a logical OR (so it adds permissions). You can use the </span><span class="font25" style="font-weight:bold;">force create mode </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">force directory mode </span><span class="font25">to set the minimal required permissions for newly created files and directories. </span><span class="font19">[tennis] path = /srv/samba/tennis read only = No guest ok = No force create mode = 444 force directory mode = 550</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8980"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8981"></a>15.4.3. security mask</span></h3></li></ul>
<p><a name="bookmark8982"></a><span class="font25"><a name="bookmark8983"></a>The </span><span class="font25" style="font-weight:bold;">security mask </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">directory security mask </span><span class="font25">work in the same way as </span><span class="font25" style="font-weight:bold;">create mask </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">directory mask</span><span class="font25">, but apply only when a windows user is changing permissions using the windows security dialog box.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8984"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8985"></a>15.4.4. force security mode</span></h3></li></ul>
<p><a name="bookmark8986"></a><span class="font25"><a name="bookmark8987"></a>The </span><span class="font25" style="font-weight:bold;">force security mode </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">force directory security mode </span><span class="font25">work in the same way as </span><span class="font25" style="font-weight:bold;">force create mode </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">force directory mode</span><span class="font25">, but apply only when a windows user is changing permissions using the windows security dialog box.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3220"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8988"></a>15.4.5. inherit permissions</span></h3></li></ul>
<p><span class="font25">With </span><span class="font25" style="font-weight:bold;">inherit permissions = yes </span><span class="font25">you can force newly created files and directories to inherit permissions from their parent directory, overriding the create mask and directory mask settings.</span></p>
<p><span class="font19">[authwrite]</span></p>
<p><span class="font19">path = /srv/samba/authwrite</span></p>
<p><span class="font19">comment = authenticated users only read only = no guest ok = no create mask = 600 directory mask = 555 inherit permissions = yes</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8989"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7885"></a><a name="bookmark8990"></a>15.5. practice: securing shares</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create a writable share called sales, and a readonly share called budget. Test that it works.</span></p></li>
<li>
<p><span class="font25">2. Limit access to the sales share to ann, sandra and veronique.</span></p></li>
<li>
<p><span class="font25">3. Make sure that roberto cannot access the sales share.</span></p></li>
<li>
<p><span class="font25">4. Even though the sales share is writable, ann should only have read access.</span></p></li>
<li>
<p><span class="font25">5. Even though the budget share is read only, sandra should also have write access.</span></p></li>
<li>
<p><span class="font25">6. Limit one shared directory to the 192.168.1.0/24 subnet, and another share to the two computers with ip-addresses 192.168.1.33 and 172.17.18.19.</span></p></li>
<li>
<p><span class="font25">7. Make sure the computer with ip 192.168.1.203 cannot access the budget share.</span></p></li>
<li>
<p><span class="font25">8. Make sure (on the budget share) that users can see only files and directories to which they have access.</span></p></li>
<li>
<p><span class="font25">9. Make sure the sales share is not visible when browsing the network.</span></p></li>
<li>
<p><span class="font25">10. All files created in the sales share should have 640 permissions or less.</span></p></li>
<li>
<p><span class="font25">11. All directories created in the budget share should have 750 permissions or more.</span></p></li>
<li>
<p><span class="font25">12. Permissions for files on the sales share should never be set more than 664.</span></p></li>
<li>
<p><span class="font25">13. Permissions for files on the budget share should never be set less than 500.</span></p></li>
<li>
<p><span class="font25">14. If time permits (or if you are waiting for other students to finish this practice), then combine the &quot;read only&quot; and &quot;writable&quot; statements to check which one has priority.</span></p></li>
<li>
<p><span class="font25">15. If time permits then combine &quot;read list&quot;, &quot;write list&quot;, &quot;hosts allow&quot; and &quot;hosts deny&quot;. Which of these has priority ?</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8991"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7891"></a><a name="bookmark8992"></a>15.6. solution: securing shares</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create a writable share called sales, and a readonly share called budget. Test that it works. </span><span class="font19">see previous solutions on how to do this...</span></p></li>
<li>
<p><span class="font25">2. Limit access to the sales share to ann, sandra and veronique.</span></p></li></ul>
<p><span class="font19">valid users = ann, sandra, veronique</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Make sure that roberto cannot access the sales share.</span></p></li></ul>
<p><span class="font19">invalid users = roberto</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Even though the sales share is writable, ann should only have read access.</span></p></li></ul>
<p><span class="font19">read list = ann</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Even though the budget share is read only, sandra should also have write access.</span></p></li></ul>
<p><span class="font19">write list = sandra</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Limit one shared directory to the 192.168.1.0/24 subnet, and another share to the two computers with ip-addresses 192.168.1.33 and 172.17.18.19.</span></p></li></ul>
<p><span class="font19">hosts allow = 192.168.1.</span></p>
<p><span class="font19">hosts allow = 192.168.1.33, 172.17.18.19</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. Make sure the computer with ip 192.168.1.203 cannot access the budget share.</span></p></li></ul>
<p><span class="font19">hosts deny = 192.168.1.203</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. Make sure (on the budget share) that users can see only files and directories to which they have access.</span></p></li></ul>
<p><span class="font19">hide unreadable = yes</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">9. Make sure the sales share is not visible when browsing the network.</span></p></li></ul>
<p><span class="font19">browsable = no</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">10. All files created in the sales share should have 640 permissions or less.</span></p></li></ul>
<p><span class="font19">create mask = 640</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">11. All directories created in the budget share should have 750 permissions or more.</span></p></li></ul>
<p><span class="font19">force directory mode = 750</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">12. Permissions for files on the sales share should never be set more than 664.</span></p></li></ul>
<p><span class="font19">security mask = 750</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">13. Permissions for files on the budget share should never be set less than 500.</span></p></li></ul>
<p><span class="font19">force security directory mask = 500</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">14. If time permits (or if you are waiting for other students to finish this practice), then combine the &quot;read only&quot; and &quot;writable&quot; statements to check which one has priority.</span></p></li>
<li>
<p><span class="font25">15. If time permits then combine &quot;read list&quot;, &quot;write list&quot;, &quot;hosts allow&quot; and &quot;hosts deny&quot;. Which of these has priority ?</span></p></li></ul>
<ul style="list-style:none;"><li>
<p><a name="bookmark8993"></a><span class="font11" style="font-weight:bold;">Chapter 16. samba domain member</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark8994"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7893"></a><a name="bookmark8995"></a>16.1. changes in smb.conf</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark8996"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8997"></a>16.1.1. workgroup</span></h3></li></ul></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">workgroup </span><span class="font25">option in the global section should match the netbios name of the Active Directory domain.</span></p>
<p><span class="font19">workgroup = STARGATE</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8599"></a><span class="font9" style="font-weight:bold;"><a name="bookmark8998"></a>16.1.2. security mode</span></h3></li></ul>
<p><span class="font25">Authentication will not be handled by samba now, but by the Active Directory domain controllers, so we set the </span><span class="font25" style="font-weight:bold;">security </span><span class="font25">option to domain.</span></p>
<p><span class="font19">security = Domain</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8999"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9000"></a>16.1.3. Linux uid's</span></h3></li></ul>
<p><a name="bookmark9001"></a><span class="font25"><a name="bookmark9002"></a>Linux requires a user account for every user accessing its file system, we need to provide Samba with a range of uid's and gid's that it can use to create these user accounts. The range is determined with the </span><span class="font25" style="font-weight:bold;">idmap uid </span><span class="font25">and the </span><span class="font25" style="font-weight:bold;">idmap gid </span><span class="font25">parameters. The first Active Directory user to connect will receive Linux uid 20000.</span></p>
<p><span class="font19">idmap uid = 20000-22000 idmap gid = 20000-22000</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9003"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9004"></a>16.1.4. winbind use default domain</span></h3></li></ul>
<p><a name="bookmark9005"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">winbind use default domain </span><span class="font25">parameter makes sure winbind also operates on users without a domain component in their name.</span></p>
<p><span class="font19">winbind use default domain = yes</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8601"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9006"></a>16.1.5. [global] section in smb.conf</span></h3></li></ul>
<p><a name="bookmark9007"></a><span class="font25">Below is our new global section in </span><span class="font25" style="font-weight:bold;">smb.conf</span><span class="font25">.</span></p>
<p><span class="font19">[global]</span></p>
<p><span class="font19">workgroup = STARGATE security = Domain server string = Stargate Domain Member Server idmap uid = 20000-22000 idmap gid = 20000-22000 winbind use default domain = yes</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9008"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9009"></a>16.1.6. realm in /etc/krb5.conf</span></h3></li></ul>
<p><span class="font25">To connect to a Windows 2003 sp2 (or later) you will need to adjust the kerberos realm in </span><span class="font25" style="font-weight:bold;">/etc/krb5.conf </span><span class="font25">and set both lookup statements to true.</span></p>
<p><span class="font19">[libdefaults]</span></p>
<p><span class="font19">default_realm = STARGATE.LOCAL dns_lookup_realm = true dns_lookup_kdc = true</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3154"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9010"></a>16.1.7. [share] section in smb.conf</span></h3></li></ul>
<p><span class="font25">Nothing special is required for the share section in smb.conf. Remember that we do not manually create users in smbpasswd or on the Linux (/etc/passwd). Only Active Directory users are allowed access.</span></p>
<p><span class="font19">[domaindata]</span></p>
<p><span class="font19">path = /srv/samba/domaindata</span></p>
<p><span class="font19">comment = Active Directory users only read only = No</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9011"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7894"></a><a name="bookmark9012"></a>16.2. joining an Active Directory domain</span></h2></li></ul>
<p><a name="bookmark9013"></a><span class="font25">While the Samba server is stopped, you can use </span><span class="font25" style="font-weight:bold;">net rpc join </span><span class="font25">to join the Active Directory domain.</span></p>
<p><span class="font19">[root@RHEL52 samba]# service smb stop</span></p>
<p><span class="font19">Shutting down SMB services: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p>
<p><span class="font19">Shutting down NMB services: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p>
<p><span class="font19">[root@RHEL52 samba]# net rpc join -U Administrator</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">Joined domain STARGATE.</span></p>
<p><span class="font25">We can verify in the aduc (Active Directory Users and Computers) that a computer account is created for this samba server.</span></p><img src="linux_guide_files/The Complete Linux Guide-154.jpg" alt="" style="width:410pt;height:252pt;">
<ul style="list-style:none;"><li>
<h2><a name="bookmark9014"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7895"></a><a name="bookmark9015"></a>16.3. winbind</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark9016"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9017"></a>16.3.1. adding winbind to nsswitch.conf</span></h3></li></ul></li></ul>
<p><a name="bookmark9018"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">winbind daemon </span><span class="font25">is talking with the Active Directory domain.</span></p>
<p><a name="bookmark9019"></a><span class="font25">We need to update the </span><span class="font25" style="font-weight:bold;">/etc/nsswitch.conf </span><span class="font25">file now, so user group and host names can be resolved against the winbind daemon.</span></p>
<p><span class="font19">[root@RHEL52 samba]# vi /etc/nsswitch.conf</span></p>
<p><span class="font19">[root@RHEL52 samba]# grep winbind /etc/nsswitch.conf</span></p>
<p><span class="font19">passwd: &nbsp;&nbsp;&nbsp;&nbsp;files winbind</span></p>
<p><span class="font19">group: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;files winbind</span></p>
<p><span class="font19">hosts: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;files dns winbind</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9020"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9021"></a>16.3.2. starting samba and winbindd</span></h3></li></ul>
<p><a name="bookmark9022"></a><span class="font25">Time to start Samba followed by </span><span class="font25" style="font-weight:bold;">winbindd</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL4b samba]# service smb start</span></p>
<p><a href="#bookmark9023"><span class="font19">Starting SMB services: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ &nbsp;OK</span></a></p>
<p><a href="#bookmark9024"><span class="font19">Starting NMB services: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ &nbsp;OK</span></a></p>
<p><a href="#bookmark9025"><span class="font19">[root@RHEL4b samba]# service winbind start Starting winbindd services: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ &nbsp;OK</span></a></p>
<p><span class="font19">[root@RHEL4b samba]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9026"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7896"></a><a name="bookmark9027"></a>16.4. wbinfo</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark9028"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9029"></a>16.4.1. verify the trust</span></h3></li></ul></li></ul>
<p><a name="bookmark9030"></a><span class="font25">You can use </span><span class="font25" style="font-weight:bold;">wbinfo -t </span><span class="font25">to verify the trust between your samba server and Active Directory.</span></p>
<p><span class="font19">[root@RHEL52 ~]# wbinfo -t</span></p>
<p><span class="font19">checking the trust secret via RPC calls succeeded</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9031"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9032"></a>16.4.2. list all users</span></h3></li></ul>
<p><span class="font25">We can obtain a list of all user with the </span><span class="font25" style="font-weight:bold;">wbinfo -u </span><span class="font25">command. The domain is not shown when the </span><span class="font25" style="font-weight:bold;">winbind use default domain </span><span class="font25">parameter is set.</span></p>
<p><span class="font19">[root@RHEL52 ~]# wbinfo -u</span></p>
<p><span class="font19">TEACHER0\serena</span></p>
<p><span class="font19">TEACHER0\justine</span></p>
<p><span class="font19">TEACHER0\martina</span></p>
<p><span class="font19">STARGATE\administrator</span></p>
<p><span class="font19">STARGATE\guest</span></p>
<p><span class="font19">STARGATE\support_388945a0</span></p>
<p><span class="font19">STARGATE\pol</span></p>
<p><span class="font19">STARGATE\krbtgt</span></p>
<p><span class="font19">STARGATE\arthur</span></p>
<p><span class="font19">STARGATE\harry</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9033"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9034"></a>16.4.3. list all groups</span></h3></li></ul>
<p><span class="font25">We can obtain a list of all domain groups with the </span><span class="font25" style="font-weight:bold;">wbinfo -g </span><span class="font25">command. The domain is not shown when the </span><span class="font25" style="font-weight:bold;">winbind use default domain </span><span class="font25">parameter is set.</span></p>
<p><span class="font19">[root@RHEL52 ~]# wbinfo -g</span></p>
<p><span class="font19">BUILTIN\administrators</span></p>
<p><span class="font19">BUILTIN\users</span></p>
<p><span class="font19">BATMAN\domain computers</span></p>
<p><span class="font19">BATMAN\domain controllers</span></p>
<p><span class="font19">BATMAN\schema admins</span></p>
<p><span class="font19">BATMAN\enterprise admins</span></p>
<p><span class="font19">BATMAN\domain admins</span></p>
<p><span class="font19">BATMAN\domain users</span></p>
<p><span class="font19">BATMAN\domain guests</span></p>
<p><span class="font19">BATMAN\group policy creator owners</span></p>
<p><span class="font19">BATMAN\dnsupdateproxy</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9035"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9036"></a>16.4.4. query a user</span></h3></li></ul>
<p><a name="bookmark9037"></a><span class="font25">We can use </span><span class="font25" style="font-weight:bold;">wbinfo -a </span><span class="font25">to verify authentication of a user against Active Directory. Assuming a user account </span><span class="font25" style="font-weight:bold;">harry </span><span class="font25">with password </span><span class="font25" style="font-weight:bold;">stargate </span><span class="font25">is just created on the Active Directory, we get the following screenshot.</span></p>
<p><span class="font19">[root@RHEL52 ~]# wbinfo -a harry%stargate plaintext password authentication succeeded challenge/response password authentication succeeded</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9038"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7897"></a><a name="bookmark9039"></a>16.5. getent</span></h2></li></ul>
<p><a name="bookmark9040"></a><span class="font25">We can use </span><span class="font25" style="font-weight:bold;">getent </span><span class="font25">to verify that winbindd is working and actually adding the Active directory users to /etc/passwd.</span></p>
<p><span class="font19">[root@RHEL52 ~]# getent passwd harry</span></p>
<p><span class="font19">harry:*:20000:20008:harry potter:/home/BATMAN/harry:/bin/false</span></p>
<p><span class="font19">[root@RHEL52 ~]# getent passwd arthur</span></p>
<p><span class="font19">arthur:*:20001:20008:arthur dent:/home/BATMAN/arthur:/bin/false</span></p>
<p><span class="font19">[root@RHEL52 ~]# getent passwd bilbo</span></p>
<p><span class="font19">bilbo:*:20002:20008:bilbo baggins:/home/BATMAN/bilbo:/bin/false</span></p>
<h4><a name="bookmark9041"></a><span class="font25"><a name="bookmark9042"></a><a name="bookmark9043"></a>If the user already exists locally, then the local user account is shown. This is because winbind is configured in </span><span class="font25" style="font-weight:bold;">/etc/nsswitch.conf </span><span class="font25">after </span><span class="font25" style="font-weight:bold;">files</span><span class="font25">.</span></h4>
<p><span class="font19">[root@RHEL52 ~]# getent passwd paul</span></p>
<p><span class="font19">paul:x:500:500:Paul Cobbaut:/home/paul:/bin/bash</span></p>
<h4><a name="bookmark9044"></a><span class="font25"><a name="bookmark9045"></a>All the Active Directory users can now easily connect to the Samba share. Files created by them, belong to them.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9046"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7898"></a><a name="bookmark9047"></a>16.6. file ownership</span></h2></li></ul>
<p><span class="font19">[root@RHEL4b samba]# ll /srv/samba/domaindata/</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">total 0</span></p>
<p><span class="font19">-rwxr--r-- &nbsp;1 justine 20000 0 Jun 22 19:54</span></p>
<p><span class="font19">-rwxr--r-- &nbsp;1 venus &nbsp;&nbsp;20000 0 Jun 22 19:55</span></p>
<p><span class="font19">-rwxr--r-- &nbsp;1 maria &nbsp;&nbsp;20000 0 Jun 22 19:57</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">create_by_justine_on_winxp.txt create_by_venus.txt</span></p>
<p><span class="font19">Maria.txt</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9048"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7899"></a><a name="bookmark9049"></a>16.7. practice : samba domain member</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Verify that you have a working Active Directory (AD) domain.</span></p></li>
<li>
<p><span class="font25">2. Add the domain name and domain controller to /etc/hosts. Set the AD-DNS in /etc/ resolv.conf.</span></p></li>
<li>
<p><span class="font25">3. Setup Samba as a member server in the domain.</span></p></li>
<li>
<p><span class="font25">4. Verify the creation of a computer account in AD for your Samba server.</span></p></li>
<li>
<p><span class="font25">5. Verify the automatic creation of AD users in /etc/passwd with wbinfo and getent.</span></p></li>
<li>
<p><span class="font25">6. Connect to Samba shares with AD users, and verify ownership of their files.</span></p></li></ul>
<ul style="list-style:none;"><li>
<p><a name="bookmark9050"></a><span class="font11" style="font-weight:bold;">Chapter 17. samba domain controller</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9051"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7900"></a><a name="bookmark9052"></a>17.1. about Domain Controllers</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark9053"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9054"></a>17.1.1. Windows NT4</span></h3></li></ul></li></ul>
<p><span class="font25">Windows NT4 works with single master replication domain controllers. There is exactly one PDC (Primary Domain Controller) in the domain, and zero or more BDC's (Backup Domain Controllers). Samba 3 has all features found in Windows NT4 PDC and BDC, and more. This includes file and print serving, domain control with single logon, logon scripts, home directories and roaming profiles.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9055"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9056"></a>17.1.2. Windows 200x</span></h3></li></ul>
<p><span class="font25">With Windows 2000 came Active Directory. AD includes multimaster replication and group policies. Samba 3 can only be a member server in Active Directory, it cannot manage group policies. Samba 4 can do this (in beta).</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9057"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9058"></a>17.1.3. Samba 3</span></h3></li></ul>
<p><span class="font25">Samba 3 can act as a domain controller in its own domain. In a Windows NT4 domain, with one Windows NT4 PDC and zero or more BDC's, Samba 3 can only be a member server. The same is valid for Samba 3 in an Active Directory Domain. In short, a Samba 3 domain controller can not share domain control with Windows domain controllers.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9059"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9060"></a>17.1.4. Samba 4</span></h3></li></ul>
<p><span class="font25">Samba 4 can be a domain controller in an Active Directory domain, including managing group policies. As of this writing, Samba 4 is not released for production!</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9061"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7902"></a><a name="bookmark9062"></a>17.2. About security modes</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark3173"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9063"></a>17.2.1. security = share</span></h3></li></ul></li></ul>
<p><span class="font25">The 'Windows for Workgroups' way of working, a client requests connection to a share and provides a password for that connection. Aanyone who knows a password for a share can access that share. This security model was common in Windows 3.11, Windows 95, Windows 98 and Windows ME.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark4611"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9064"></a>17.2.2. security = user</span></h3></li></ul>
<p><span class="font25">The client will send a userid + password before the server knows which share the client wants to access. This mode should be used whenever the samba server is in control of the user database. Both for standalone and samba domain controllers.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9065"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9066"></a>17.2.3. security = domain</span></h3></li></ul>
<p><span class="font25">This mode will allow samba to verify user credentials using NTLM in Windows NT4 and in all Active Directory domains. This is similar to Windows NT4 BDC's joining a native Windows 2000/3 Active Directory domain.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9067"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9068"></a>17.2.4. security = ads</span></h3></li></ul>
<p><span class="font25">This mode will make samba use Kerberos to connect to the Active Directory domain.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark8574"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9069"></a>17.2.5. security = server</span></h3></li></ul>
<p><span class="font25">This mode is obsolete, it can be used to forward authentication to another server.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9070"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7903"></a><a name="bookmark9071"></a>17.3. About password backends</span></h2></li></ul>
<p><a name="bookmark9072"></a><span class="font25"><a name="bookmark9073"></a>The previous chapters all used the </span><span class="font25" style="font-weight:bold;">smbpasswd </span><span class="font25">user database. For domain control we opt for the </span><span class="font25" style="font-weight:bold;">tdbsam </span><span class="font25">password backend. Another option would be to use LDAP. Larger domains will benefit from using LDAP instead of the not so scalable tdbsam. When you need more than one Domain Controller, then the Samba team advises to not use tdbsam.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9074"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7904"></a><a name="bookmark9075"></a>17.4. [global] section in smb.conf</span></h2></li></ul>
<p><span class="font25">Now is a good time to start adding comments in your smb.conf. First we will take a look at the naming of our domain and server in the </span><span class="font25" style="font-weight:bold;">[global] </span><span class="font25">section, and at the domain controlling parameters.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9076"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9077"></a>17.4.1. security</span></h3></li></ul>
<p><span class="font25">The security must be set to user (which is the default). This mode will make samba control the user accounts, so it will allow samba to act as a domain controller.</span></p>
<p><span class="font19">security = user</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9078"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9079"></a>17.4.2. os level</span></h3></li></ul>
<p><a name="bookmark9080"></a><span class="font25">A samba server is the most stable computer in the network, so it should win all browser elections (</span><span class="font25" style="font-weight:bold;">os level </span><span class="font25">above 32) to become the </span><span class="font25" style="font-weight:bold;">browser master</span></p>
<p><span class="font19">os level = 33</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark3166"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9081"></a>17.4.3. passdb backend</span></h3></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">passdb backend </span><span class="font25">parameter will determine whether samba uses </span><span class="font25" style="font-weight:bold;">smbpasswd</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">tdbsam </span><span class="font25">or ldap.</span></p>
<p><span class="font19">passdb backend = tdbsam</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9082"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9083"></a>17.4.4. preferred master</span></h3></li></ul>
<p><span class="font25">Setting the </span><span class="font25" style="font-weight:bold;">preferred master </span><span class="font25">parameter to yes will make the nmbd daemon force an election on startup.</span></p>
<p><span class="font19">preferred master = yes</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9084"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9085"></a>17.4.5. domain logons</span></h3></li></ul>
<p><span class="font25">Setting the </span><span class="font25" style="font-weight:bold;">domain logons </span><span class="font25">parameter will make this samba server a domain controller.</span></p>
<p><span class="font19">domain logons = yes</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9086"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9087"></a>17.4.6. domain master</span></h3></li></ul>
<p><span class="font25">Setting the </span><span class="font25" style="font-weight:bold;">domain master </span><span class="font25">parameter can cause samba to claim the </span><span class="font25" style="font-weight:bold;">domain master browser </span><span class="font25">role for its workgroup. Don't use this parameter in a workgroup with an active NT4 PDC.</span></p>
<p><span class="font19">domain master = yes</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9088"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9089"></a>17.4.7. [global] section</span></h3></li></ul>
<p><span class="font25">The screenshot below shows a sample [global] section for a samba domain controller.</span></p>
<p><span class="font19">[global] # names workgroup = SPORTS netbios name = DCSPORTS server string = Sports Domain Controller # domain control parameters security = user os level = 33 preferred master = Yes domain master = Yes domain logons = Yes</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9090"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7905"></a><a name="bookmark9091"></a>17.5. netlogon share</span></h2></li></ul>
<p><span class="font25">Part of the microsoft definition for a domain controller is that it should have a </span><span class="font25" style="font-weight:bold;">netlogon share</span><span class="font25">. This is the relevant part of smb.conf to create this netlogon share on Samba.</span></p>
<p><span class="font19">[netlogon]</span></p>
<p><span class="font19">comment = Network Logon Service path = /srv/samba/netlogon admin users = root</span></p>
<p><span class="font19">guest ok = Yes browseable = No</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9092"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7906"></a><a name="bookmark9093"></a>17.6. other [share] sections</span></h2></li></ul>
<p><span class="font25">We create some sections for file shares, to test the samba server. Users can all access the general sports file share, but only group members can access their own sports share.</span></p>
<p><span class="font19">[sports]</span></p>
<p><span class="font19">comment = Information about all sports path = /srv/samba/sports valid users = @ntsports read only = No</span></p>
<p><span class="font19">[tennis]</span></p>
<p><span class="font19">comment = Information about tennis path = /srv/samba/tennis valid users = @nttennis read only = No</span></p>
<p><span class="font19">[football]</span></p>
<p><span class="font19">comment = Information about football path = /srv/samba/football valid users = @ntfootball read only = No</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9094"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7907"></a><a name="bookmark9095"></a>17.7. Users and Groups</span></h2></li></ul>
<h4><a name="bookmark9096"></a><span class="font25"><a name="bookmark9097"></a>To be able to use users and groups in the samba domain controller, we can first set up some groups on the Linux computer.</span></h4>
<div>
<p><span class="font19">[root@RHEL52 samba]#</span></p>
<p><span class="font19">[root@RHEL52 samba]#</span></p>
<p><span class="font19">[root@RHEL52 samba]#</span></p>
<p><span class="font19">[root@RHEL52 samba]#</span></p>
</div><br clear="all">
<div>
<p><span class="font19">groupadd ntadmins groupadd ntsports groupadd ntfootball groupadd nttennis</span></p>
</div><br clear="all">
<h4><a name="bookmark9098"></a><span class="font25"><a name="bookmark9099"></a>This enables us to add group membership info to some new users for our samba domain. Don't forget to give them a password.</span></h4>
<p><span class="font19">[root@RHEL52 samba]# useradd -m -G ntadmins Administrator [root@RHEL52 samba]# useradd -m -G ntsports,nttennis venus [root@RHEL52 samba]# useradd -m -G ntsports,nttennis kim [root@RHEL52 samba]# useradd -m -G ntsports,nttennis jelena [root@RHEL52 samba]# useradd -m -G ntsports,ntfootball figo [root@RHEL52 samba]# useradd -m -G ntsports,ntfootball ronaldo [root@RHEL52 samba]# useradd -m -G ntsports,ntfootball pfaff</span></p>
<h4><a name="bookmark9100"></a><span class="font25"><a name="bookmark9101"></a>It is always safe to verify creation of users, groups and passwords in /etc/passwd, /etc/shadow and /etc/group.</span></h4>
<p><span class="font19">[root@RHEL52 samba]# tail -11 /etc/group</span></p>
<p><span class="font19">ntadmins:x:507:Administrator</span></p>
<p><span class="font19">ntsports:x:508:venus,kim,jelena,figo,ronaldo,pfaff</span></p>
<p><span class="font19">ntfootball:x:509:figo,ronaldo,pfaff</span></p>
<p><span class="font19">nttennis:x:510:venus,kim,jelena</span></p>
<p><span class="font19">Administrator:x:511:</span></p>
<p><span class="font19">venus:x:512:</span></p>
<p><span class="font19">kim:x:513:</span></p>
<p><span class="font19">jelena:x:514:</span></p>
<p><span class="font19">figo:x:515:</span></p>
<p><span class="font19">ronaldo:x:516:</span></p>
<p><span class="font19">pfaff:x:517:</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9102"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7908"></a><a name="bookmark9103"></a>17.8. tdbsam</span></h2></li></ul>
<h4><a name="bookmark9104"></a><span class="font25"><a name="bookmark9105"></a><a name="bookmark9106"></a><a name="bookmark9107"></a>Next we must make these users known to samba with the smbpasswd tool. When you add the first user to </span><span class="font25" style="font-weight:bold;">tdbsam</span><span class="font25">, the file </span><span class="font25" style="font-weight:bold;">/etc/samba/passdb.tdb </span><span class="font25">will be created.</span></h4>
<p><span class="font19">[root@RHEL52 samba]# smbpasswd -a root New SMB password:</span></p>
<p><span class="font19">Retype new SMB password:</span></p>
<p><span class="font19">tdbsam_open: Converting version 0 database to version 3. Added user root.</span></p>
<p><span class="font25">Adding all the other users generates less output, because tdbsam is already created.</span></p>
<p><span class="font19">[root@RHEL4b samba]# smbpasswd -a root</span></p>
<p><span class="font19">New SMB password:</span></p>
<p><span class="font19">Retype new SMB password: Added user root.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9108"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7909"></a><a name="bookmark9109"></a>17.9. about computer accounts</span></h2></li></ul>
<p><a name="bookmark9110"></a><span class="font25">Every NT computer (Windows NT, 2000, XP, Vista) can become a member of a domain. Joining the domain (by right-clicking on My Computer) means that a computer account will be created in the domain. This computer account also has a password (but you cannot know it) to prevent other computers with the same name from accidentally becoming member of the domain. The computer account created by Samba is visible in the </span><span class="font25" style="font-weight:bold;">/etc/passwd </span><span class="font25">file on Linux. Computer accounts appear as a normal user account, but end their name with a dollar sign. Below a screenshot of the windows 2003 computer account, created by Samba 3.</span></p>
<p><span class="font19">[root@RHEL52 samba]# tail -5 /etc/passwd jelena:x:510:514::/home/jelena:/bin/bash figo:x:511:515::/home/figo:/bin/bash ronaldo:x:512:516::/home/ronaldo:/bin/bash pfaff:x:513:517::/home/pfaff:/bin/bash w2003ee$:x:514:518::/home/nobody:/bin/false</span></p>
<p><span class="font25">To be able to create the account, you will need to provide credentials of an account with the permission to create accounts (by default only root can do this on Linux). And we will have to tell Samba how to to this, by adding an </span><span class="font25" style="font-weight:bold;">add machine script </span><span class="font25">to the global section of smb.conf.</span></p>
<p><span class="font19">add machine script = /usr/sbin/useradd -s /bin/false -d /home/nobody %u</span></p>
<p><span class="font25">You can now join a Microsoft computer to the sports domain (with the root user). After reboot of the Microsoft computer, you will be able to logon with Administrator (password Stargate1), but you will get an error about your roaming profile. We will fix this in the next section.</span></p>
<p><span class="font25">When joining the samba domain, you have to enter the credentials of a Linux account that can create users (usually only root can do this). If the Microsoft computer complains with </span><span class="font25" style="font-weight:bold;">The parameter is incorrect</span><span class="font25">, then you possibly forgot to add the </span><span class="font25" style="font-weight:bold;">add machine script</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9111"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7910"></a><a name="bookmark9112"></a>17.10. local or roaming profiles</span></h2></li></ul>
<p><span class="font25">For your information, if you want to force local profiles instead of roaming profiles, then simply add the following two lines to the global section in smb.conf.</span></p>
<p><span class="font19">logon home = logon path =</span></p>
<p><a name="bookmark9113"></a><span class="font25">Microsoft computers store a lot of User Metadata and application data in a user profile. Making this profile available on the network will enable users to keep their Desktop and Application settings across computers. User profiles on the network are called </span><span class="font25" style="font-weight:bold;">roaming profiles </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">roving profiles</span><span class="font25">. The Samba domain controller can manage these profiles. First we need to add the relevant section in smb.conf.</span></p>
<p><span class="font19">[Profiles] comment = User Profiles path = /srv/samba/profiles readonly = No profile acls = Yes</span></p>
<p><span class="font25">Besides the share section, we also need to set the location of the profiles share (this can be another Samba server) in the global section.</span></p>
<p><span class="font19">logon path = \\%L\Profiles\%U</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">%L </span><span class="font25">variable is the name of this Samba server, the </span><span class="font25" style="font-weight:bold;">%U </span><span class="font25">variable translates to the username. After adding a user to smbpasswd and letting the user log on and off, the profile of the user will look like this.</span></p>
<p><span class="font19">[root@RHEL4b samba]# ll /srv/samba/profiles/Venus/ total 568</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">drwxr-xr-x</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Jul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10:03</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Application Data</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">drwxr-xr-x</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Jul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">10:03</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Cookies</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">drwxr-xr-x</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Jul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10:03</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Desktop</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">drwxr-xr-x</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Jul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">10:03</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Favorites</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">drwxr-xr-x</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Jul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10:03</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">My Documents</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">drwxr-xr-x</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Jul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">10:03</span></p></td><td style="vertical-align:top;">
<p><span class="font19">NetHood</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">-rwxr--r--</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">524288</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Jul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2007</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">NTUSER.DAT</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">-rwxr--r--</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1024</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Jul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2007</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">NTUSER.DAT.LOG</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">-rw-r--r--</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">268</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Jul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10:03</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ntuser.ini</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">drwxr-xr-x</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Jul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">10:03</span></p></td><td style="vertical-align:top;">
<p><span class="font19">PrintHood</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">drwxr-xr-x</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Jul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10:03</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Recent</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">drwxr-xr-x</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Jul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10:03</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">SendTo</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">drwxr-xr-x</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Jul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">10:03</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Start Menu</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">drwxr-xr-x</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Venus</span></p></td><td style="vertical-align:top;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Jul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">10:03</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Templates</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9114"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7911"></a><a name="bookmark9115"></a>17.11. Groups in NTFS acls</span></h2></li></ul>
<p><span class="font25">We have users on Unix, we have groups on Unix that contain those users.</span></p>
<p><span class="font19">[root@RHEL4b samba]# grep nt /etc/group ...</span></p>
<p><span class="font19">ntadmins:x:506:Administrator</span></p>
<p><span class="font19">ntsports:x:507:Venus,Serena,Kim,Figo,Pfaff</span></p>
<p><span class="font19">nttennis:x:508:Venus,Serena,Kim</span></p>
<p><span class="font19">ntfootball:x:509:Figo,Pfaff</span></p>
<p><span class="font19">[root@RHEL4b samba]#</span></p>
<p><a name="bookmark9116"></a><span class="font25">We already added Venus to the </span><span class="font25" style="font-weight:bold;">tdbsam </span><span class="font25">with </span><span class="font25" style="font-weight:bold;">smbpasswd</span><span class="font25">.</span></p>
<p><span class="font19">smbpasswd -a Venus</span></p>
<p><a name="bookmark9117"></a><span class="font25">Does this mean that Venus can access the tennis and the sports shares ? Yes, all access works fine on the Samba server. But the nttennis group is not available on the windows machines. To make the groups available on windows (like in the ntfs security tab of files and folders), we have to map unix groups to windows groups. To do this, we use the </span><span class="font25" style="font-weight:bold;">net groupmap </span><span class="font25">command.</span></p>
<p><span class="font19">[root@RHEL4b samba]# net groupmap add ntgroup=&quot;tennis&quot; unixgroup=nttennis type=d No rid or sid specified, choosing algorithmic mapping Successully added group tennis to the mapping db</span></p>
<p><span class="font19">[root@RHEL4b samba]# net groupmap add ntgroup=&quot;football&quot; unixgroup=ntfootball type=d No rid or sid specified, choosing algorithmic mapping</span></p>
<p><span class="font19">Successully added group football to the mapping db</span></p>
<p><span class="font19">[root@RHEL4b samba]# net groupmap add ntgroup=&quot;sports&quot; unixgroup=ntsports type=d</span></p>
<p><span class="font19">No rid or sid specified, choosing algorithmic mapping Successully added group sports to the mapping db [root@RHEL4b samba]#</span></p>
<p><span class="font25">Now you can use the Samba groups on all NTFS volumes on members of the domain.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9118"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7912"></a><a name="bookmark9119"></a>17.12. logon scripts</span></h2></li></ul>
<p><span class="font25">Before testing a logon script, make sure it has the proper carriage returns that DOS files have.</span></p>
<p><span class="font19">[root@RHEL4b netlogon]# cat start.bat</span></p>
<p><span class="font19">net use Z: \\DCSPORTS0\SPORTS</span></p>
<p><span class="font19">[root@RHEL4b netlogon]# unix2dos start.bat</span></p>
<p><span class="font19">unix2dos: converting file start.bat to DOS format ...</span></p>
<p><span class="font19">[root@RHEL4b netlogon]#</span></p>
<p><span class="font25">Then copy the scripts to the netlogon share, and add the following parameter to smb.conf.</span></p>
<p><span class="font19">logon script = start.bat</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9120"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7913"></a><a name="bookmark9121"></a>17.13. practice: samba domain controller</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Setup Samba as a domain controller.</span></p></li>
<li>
<p><span class="font25">2. Create the shares salesdata, salespresentations and meetings. Salesdata must be accessible to all sales people and to all managers. SalesPresentations is only for all sales people. Meetings is only accessible to all managers. Use groups to accomplish this.</span></p></li>
<li>
<p><span class="font25">3. Join a Microsoft computer to your domain. Verify the creation of a computer account in /etc/passwd.</span></p></li>
<li>
<p><span class="font25">4. Setup and verify the proper working of roaming profiles.</span></p></li>
<li>
<p><span class="font25">5. Find information about home directories for users, set them up and verify that users receive their home directory mapped under the H:-drive in MS Windows Explorer.</span></p></li>
<li>
<p><span class="font25">6. Use a couple of samba domain groups with members to set acls on ntfs. Verify that it works!</span></p></li>
<li>
<p><span class="font25">7. Knowing that the %m variable contains the computername, create a separate log file for every computer(account).</span></p></li>
<li>
<p><span class="font25">8. Knowing that %s contains the client operating system, include a smb.%s.conf file that contains a share. (The share will only be visible to clients with that OS).</span></p></li>
<li>
<p><span class="font25">9. If time permits (or if you are waiting for other students to finish this practice), then combine &quot;valid users&quot; and &quot;invalid users&quot; with groups and usernames with &quot;hosts allow&quot; and &quot;hosts deny&quot; and make a table of which get priority over which.</span></p></li></ul>
<ul style="list-style:none;"><li>
<p><a name="bookmark9122"></a><span class="font11" style="font-weight:bold;">Chapter 18. a brief look at samba 4</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9123"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7915"></a><a name="bookmark9124"></a>18.1. Samba 4 alpha 6</span></h2></li></ul>
<p><span class="font25">A quick view on Samba 4 alpha 6 (January 2009). You can also follow this guide http:// wiki.samba.org/index.php/Samba4/HOWTO</span></p>
<p><span class="font25">Remove old Samba from Red Hat</span></p>
<p><span class="font19">yum remove samba</span></p>
<p><span class="font25">set a fix ip address (Red Hat has an easy GUI)</span></p>
<p><span class="font25">download and untar</span></p>
<p><span class="font19">samba.org, click 'download info', choose mirror, dl samba4 latest alpha</span></p>
<p><span class="font25">once untarred, enter the directory and read the howto4.txt </span><span class="font19">cd samba-4.0.0alpha6/ more howto4.txt</span></p>
<p><span class="font25">first we have to configure, compile and install samba4 </span><span class="font19">cd source4/ ./configure</span></p>
<p><span class="font19">make</span></p>
<p><span class="font19">make install</span></p>
<p><span class="font25">Then we can use the provision script to setup our realm. I used booi.schot as domain name (instead of example.com).</span></p>
<p><span class="font19">./setup/provision --realm=BOOI.SCHOT --domain=BOOI --adminpass=stargate \ --server-role='domain controller'</span></p>
<p><span class="font25">i added a simple share for testing</span></p>
<p><span class="font19">vi /usr/local/samba/etc/smb.conf</span></p>
<p><span class="font25">then i started samba</span></p>
<p><span class="font19">cd /usr/local/samba/sbin/ ./samba</span></p>
<p><span class="font25">I tested with smbclient, it works</span></p>
<p><span class="font19">smbclient //localhost/test -Uadministrator%stargate</span></p>
<p><span class="font25">I checked that bind (and bind-chroot) were installed (yes), so copied the srv records </span><span class="font19">cp booi.schot.zone /var/named/chroot/etc/</span></p>
<p><span class="font25">then appended to named.conf</span></p>
<p><span class="font19">cat named.conf &gt;&gt;&nbsp;/var/named/chroot/etc/named.conf</span></p>
<p><span class="font25">I followed these steps in the howto4.txt</span></p>
<p><span class="font19">vi /etc/init.d/named [added two export lines right after start()] chmod a+r /usr/local/samba/private/dns.keytab</span></p>
<p><span class="font19">cp krb5.conf /etc/</span></p>
<p><span class="font19">vi /var/named/chroot/etc/named.conf</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">--&gt; remove a lot, but keep allow-update { any; };</span></p></li></ul>
<p><span class="font25">restart bind (named!), then tested dns with dig, this works (stripped screenshot!)</span></p>
<p><span class="font19">[root@RHEL52 private]# dig _ldap._tcp.dc._msdcs.booi.schot SRV @localhost</span></p>
<p><span class="font19">; (1 server found)</span></p>
<p><span class="font19">;; global options: printcmd</span></p>
<p><span class="font19">;; Got answer:</span></p>
<p><span class="font19">;; -HEADER- opcode: QUERY, status: NXDOMAIN, id: 58186</span></p>
<p><span class="font19">;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 0</span></p>
<p><span class="font19">;; QUESTION SECTION:</span></p>
<p><span class="font19">;_ldap._tcp.dc._msdcs.booi.schot. IN SRV</span></p>
<p><span class="font19">;; AUTHORITY SECTION: . &nbsp;&nbsp;10800 IN SOA A.ROOT-SERVERS.NET....</span></p>
<p><span class="font19">;; Query time: 54 msec</span></p>
<p><span class="font19">;; SERVER: 127.0.0.1#53(127.0.0.1)</span></p>
<p><span class="font19">;; WHEN: Tue Jan 27 20:57:05 2009</span></p>
<p><span class="font19">;; MSG SIZE rcvd: 124</span></p>
<p><span class="font19">[root@RHEL52 private]#</span></p>
<p><span class="font25">made sure /etc/resolv.conf points to himself</span></p>
<p><span class="font19">[root@RHEL52 private]# cat /etc/resolv.conf search booi.schot</span></p>
<p><span class="font19">nameserver 127.0.0.1</span></p>
<p><span class="font25">start windows 2003 server, enter the samba4 as DNS!</span></p>
<p><span class="font25">ping the domain, if it doesn't work, then add your redhats hostname and your realm to windows/system32/drivers/etc/hosts</span></p>
<p><span class="font25">join the windows computer to the domain</span></p>
<p><span class="font25">reboot the windows</span></p>
<p><span class="font25">log on with administrator stargate</span></p>
<p><span class="font25">start run dsa.msc to manage samba4</span></p>
<p><span class="font25">create an OU, a user and a GPO, test that it works</span></p>
<p><a name="bookmark9125"></a><span class="font11" style="font-weight:bold;">Part VIII. introducing git</span></p>
<h3><a name="bookmark9126"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9127"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9128"><span class="font24" style="font-weight:bold;">20. git </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9129"><span class="font24">20.1. git </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6563"><span class="font24">20.2. installing git </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9130"><span class="font24">20.3. starting a project </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9131"><span class="font24">20.4. git branches </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9132"><span class="font24">20.5. to be continued</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9133"><span class="font24">20.6. github.com </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9134"><span class="font24">20.7. add your public key to github </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9135"><span class="font24">20.8. practice: git </span></a></p></li></ul>
<h1><a name="bookmark9136"></a><span class="font11" style="font-weight:bold;"><a name="bookmark9137"></a><a name="bookmark9138"></a>Chapter 20. git</span></h1>
<p><span class="font25">This chapter is an introduction to using </span><span class="font25" style="font-weight:bold;">git </span><span class="font25">on the command line. The </span><span class="font25" style="font-weight:bold;">git repository </span><span class="font25">is hosted by </span><span class="font25" style="font-weight:bold;">github</span><span class="font25">, but you are free to choose another server (or create your own).</span></p>
<p><span class="font25">There are many excellent online tutorials for </span><span class="font25" style="font-weight:bold;">git</span><span class="font25">. This list can save you one Google query:</span></p>
<p><a href="http://gitimmersion.com/"><span class="font19">http://gitimmersion.com/</span></a></p>
<p><a href="http://git-scm.com/book"><span class="font19">http://git-scm.com/book</span></a></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9139"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7942"></a><a name="bookmark9140"></a>20.1. git</span></h2></li></ul>
<p><a name="bookmark9141"></a><span class="font25">Linus Torvalds created </span><span class="font25" style="font-weight:bold;">git </span><span class="font25">back in 2005 when Bitkeeper changed its license and the Linux kernel developers where no longer able to use it for free.</span></p>
<p><span class="font25" style="font-weight:bold;">git </span><span class="font25">quickly became popular and is now the most widely used </span><span class="font25" style="font-weight:bold;">distributed version control </span><span class="font25">system in the world.</span></p>
<p><span class="font25">Geek and Poke demonstrates why we need version control (image property of Geek and Poke CCA 3.0).</span></p>
<h1><a name="bookmark9142"></a><span class="font11" style="font-weight:bold;"><a name="bookmark9143"></a>SIMPLY EXPLAINED</span></h1><img src="linux_guide_files/The Complete Linux Guide-155.jpg" alt="" style="width:366pt;height:339pt;">
<p><span class="font4" style="font-weight:bold;">VERSION CONTROL</span></p>
<p><span class="font25">Besides </span><span class="font25" style="font-weight:bold;">source code </span><span class="font25">for software, you can also find German and Icelandic </span><span class="font25" style="font-weight:bold;">law </span><span class="font25">on github (and probably much more by the time you are reading this).</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9144"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7944"></a><a name="bookmark9145"></a>20.2. installing git</span></h2></li></ul>
<h4><a name="bookmark9146"></a><span class="font25"><a name="bookmark9147"></a><a name="bookmark9148"></a>We install </span><span class="font25" style="font-weight:bold;">git </span><span class="font25">with </span><span class="font25" style="font-weight:bold;">aptitude install git </span><span class="font25">as seen in this screenshot on Debian 6.</span></h4>
<p><span class="font19">root@debian6:~# aptitude install git</span></p>
<p><span class="font19">The following NEW packages will be installed:</span></p>
<p><span class="font19">git libcurl3-gnutls{a} liberror-perl{a}</span></p>
<p><span class="font19">0 packages upgraded, 3 newly installed, 0 to remove and 0 not upgraded.</span></p>
<p><span class="font19">...</span></p>
<p><span class="font19">Processing triggers for man-db ...</span></p>
<p><span class="font19">Setting up libcurl3-gnutls (7.21.0-2.1+squeeze2) ...</span></p>
<p><span class="font19">Setting up liberror-perl (0.17-1) ...</span></p>
<p><span class="font19">Setting up git (1:1.7.2.5-3) ...</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9149"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7945"></a><a name="bookmark9150"></a>20.3. starting a project</span></h2></li></ul>
<h4><a name="bookmark9151"></a><span class="font25"><a name="bookmark9152"></a>First we create a project directory, with a simple file in it.</span></h4>
<p><span class="font19">paul@debian6~$ mkdir project42</span></p>
<p><span class="font19">paul@debian6~$ cd project42/</span></p>
<p><span class="font19">paul@debian6~/project42$ echo &quot;echo The answer is 42.&quot; &gt;&gt;&nbsp;question.sh</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9153"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9154"></a>20.3.1. git init</span></h3></li></ul>
<h4><a name="bookmark9155"></a><span class="font25"><a name="bookmark9156"></a>Then we tell </span><span class="font25" style="font-weight:bold;">git </span><span class="font25">to create an empty git repository in this directory.</span></h4>
<p><span class="font19">paul@debian6~/project42$ ls -la total 12</span></p>
<p><span class="font19">drwxrwxr-x 2 paul paul 4096 Dec &nbsp;8 16:41 .</span></p>
<p><span class="font19">drwxr-xr-x 46 paul paul 4096 Dec &nbsp;8 16:41 ..</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-rw-r-- 1 paul paul &nbsp;&nbsp;23 Dec &nbsp;8 16:41 question.sh</span></p></li></ul>
<p><span class="font19">paul@debian6~/project42$ git init</span></p>
<p><span class="font19">Initialized empty Git repository in /home/paul/project42/.git/ paul@debian6~/project42$ ls -la total 16 drwxrwxr-x &nbsp;3 paul paul 4096 Dec &nbsp;8 16:44 .</span></p>
<p><span class="font19">drwxr-xr-x 46 paul paul 4096 Dec &nbsp;8 16:41 ..</span></p>
<p><span class="font19">drwxrwxr-x &nbsp;7 paul paul 4096 Dec &nbsp;8 16:44 .git</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-rw-r-- &nbsp;1 paul paul &nbsp;&nbsp;23 Dec &nbsp;8 16:41 question.sh</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9157"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9158"></a>20.3.2. git config</span></h3></li></ul>
<h4><a name="bookmark9159"></a><span class="font25"><a name="bookmark9160"></a>Next we use </span><span class="font25" style="font-weight:bold;">git config </span><span class="font25">to set some global options.</span></h4>
<p><span class="font19">paul@debian6$ git config --global user.name Paul</span></p>
<p><span class="font19">paul@debian6$ git config --global user.email &quot;</span><a href="mailto:paul.cobbaut@gmail.com"><span class="font19">paul.cobbaut@gmail.com</span></a><span class="font19">&quot; paul@debian6$ git config --global core.editor vi</span></p>
<h4><a name="bookmark9161"></a><span class="font25"><a name="bookmark9162"></a>We can verify this config in </span><span class="font25" style="font-weight:bold;">~/.gitconfig</span><span class="font25">:</span></h4>
<p><span class="font19">paul@debian6~/project42$ cat ~/.gitconfig [user] name = Paul email = </span><a href="mailto:paul.cobbaut@gmail.com"><span class="font19">paul.cobbaut@gmail.com</span></a></p>
<p><span class="font19">[core] editor = vi</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9163"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9164"></a>20.3.3. git add</span></h3></li></ul>
<h4><a name="bookmark9165"></a><span class="font25"><a name="bookmark9166"></a>Time now to add file to our project with </span><span class="font25" style="font-weight:bold;">git add</span><span class="font25">, and verify that it is added with </span><span class="font25" style="font-weight:bold;">git status</span><span class="font25">.</span></h4>
<p><span class="font19">paul@debian6~/project42$ git add question.sh</span></p>
<p><span class="font19">paul@debian6~/project42$ git status</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># On branch master</span></p></li></ul>
<p><span class="font19">#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Initial commit</span></p></li></ul>
<p><span class="font19">#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Changes to be committed:</span></p></li>
<li>
<p><span class="font19"># (use &quot;git rm --cached &lt;file&gt;...&quot; to unstage) #</span></p></li>
<li>
<p><span class="font19"># new file: question.sh</span></p></li></ul>
<p><span class="font19">#</span></p>
<h4><a name="bookmark9167"></a><span class="font25"><a name="bookmark9168"></a>The </span><span class="font25" style="font-weight:bold;">git status </span><span class="font25">tells us there is a new file ready to be committed.</span></h4>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9169"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9170"></a>20.3.4. git commit</span></h3></li></ul>
<h4><a name="bookmark9171"></a><span class="font25"><a name="bookmark9172"></a>With </span><span class="font25" style="font-weight:bold;">git commit </span><span class="font25">you force git to record all added files (and all changes to those files) permanently.</span></h4>
<p><span class="font19">paul@debian6~/project42$ git commit -m &quot;starting a project&quot; [master (root-commit) 5c10768] starting a project</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">1 file changed, 1 insertion(+) create mode 100644 question.sh paul@debian6~/project42$ git status # On branch master nothing to commit (working directory clean)</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9173"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9174"></a>20.3.5. changing a committed file</span></h3></li></ul>
<h4><a name="bookmark9175"></a><span class="font25"><a name="bookmark9176"></a>The screenshots below show several steps. First we change a file:</span></h4>
<p><span class="font19">paul@debian6~/project42$ git status # On branch master nothing to commit (working directory clean) paul@debian6~/project42$ vi question.sh</span></p>
<h4><a name="bookmark9177"></a><span class="font25"><a name="bookmark9178"></a>Then we verify the status and see that it is modified:</span></h4>
<p><span class="font19">paul@debian6~/project42$ git status</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># On branch master</span></p></li>
<li>
<p><span class="font19"># Changes not staged for commit:</span></p></li>
<li>
<p><span class="font19"># (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span></p></li>
<li>
<p><span class="font19"># (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory) #</span></p></li>
<li>
<p><span class="font19"># modified: question.sh #</span></p></li></ul>
<p><span class="font19">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span></p>
<h4><a name="bookmark9179"></a><span class="font25"><a name="bookmark9180"></a>Next we add it to the git repository.</span></h4>
<p><span class="font19">paul@debian6~/project42$ git add question.sh</span></p>
<p><span class="font19">paul@debian6~/project42$ git commit -m &quot;adding a she-bang to the main script&quot; [master 86b8347] adding a she-bang to the main script</span></p>
<p><span class="font19">1 file changed, 1 insertion(+) paul@debian6~/project42$ git status # On branch master nothing to commit (working directory clean)</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9181"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9182"></a>20.3.6. git log</span></h3></li></ul>
<h4><a name="bookmark9183"></a><span class="font25"><a name="bookmark9184"></a>We can see all our commits again using </span><span class="font25" style="font-weight:bold;">git log</span><span class="font25">.</span></h4>
<p><span class="font19">paul@debian6~/project42$ git log</span></p>
<p><span class="font19">commit 86b8347192ea025815df7a8e628d99474b41fb6c</span></p>
<p><span class="font19">Author: Paul &lt;</span><a href="mailto:paul.cobbaut@gmail.com"><span class="font19">paul.cobbaut@gmail.com</span></a><span class="font19">&gt;</span></p>
<p><span class="font19">Date: &nbsp;&nbsp;Sat Dec 8 17:12:24 2012 +0100</span></p>
<p><span class="font19">adding a she-bang to the main script</span></p>
<p><span class="font19">commit 5c10768f29aecc16161fb197765e0f14383f7bca</span></p>
<p><span class="font19">Author: Paul &lt;</span><a href="mailto:paul.cobbaut@gmail.com"><span class="font19">paul.cobbaut@gmail.com</span></a><span class="font19">&gt;</span></p>
<p><span class="font19">Date: &nbsp;&nbsp;Sat Dec 8 17:09:29 2012 +0100</span></p>
<p><span class="font19">starting a project</span></p>
<h4><a name="bookmark9185"></a><span class="font25"><a name="bookmark9186"></a>The log format can be changed.</span></h4>
<p><span class="font19">paul@debian6~/project42$ git log --pretty=oneline</span></p>
<p><span class="font19">86b8347192ea025815df7a8e628d99474b41fb6c adding a she-bang to the main script 5c10768f29aecc16161fb197765e0f14383f7bca starting a project</span></p>
<h4><a name="bookmark9187"></a><span class="font25"><a name="bookmark9188"></a>The log format can be customized a lot.</span></h4>
<p><span class="font19">paul@debian6~/project42$ git log --pretty=format:&quot;%an: %ar :%s&quot;</span></p>
<p><span class="font19">Paul: 8 minutes ago :adding a she-bang to the main script</span></p>
<p><span class="font19">Paul: 11 minutes ago :starting a project</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9189"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9190"></a>20.3.7. git mv</span></h3></li></ul>
<h4><a name="bookmark9191"></a><span class="font25"><a name="bookmark9192"></a>Renaming a file can be done with </span><span class="font25" style="font-weight:bold;">mv </span><span class="font25">followed by a </span><span class="font25" style="font-weight:bold;">git remove </span><span class="font25">and a </span><span class="font25" style="font-weight:bold;">git add </span><span class="font25">of the new filename. But it can be done easier and in one command using </span><span class="font25" style="font-weight:bold;">git mv</span><span class="font25">.</span></h4>
<p><span class="font19">paul@debian6~/project42$ git mv question.sh thequestion.sh</span></p>
<p><span class="font19">paul@debian6~/project42$ git status</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># On branch master</span></p></li>
<li>
<p><span class="font19"># Changes to be committed:</span></p></li>
<li>
<p><span class="font19"># (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span></p></li></ul>
<p><span class="font19">#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># renamed: &nbsp;&nbsp;&nbsp;question.sh -&gt; thequestion.sh</span></p></li></ul>
<p><span class="font19">#</span></p>
<p><span class="font19">paul@debian6~/project42$ git commit -m &quot;improved naming scheme&quot;</span></p>
<p><span class="font19">[master 69b2c8b] improved naming scheme</span></p>
<p><span class="font19">1 file changed, 0 insertions(+), 0 deletions(-)</span></p>
<p><span class="font19">rename question.sh =&gt; thequestion.sh (100%)</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9193"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7946"></a><a name="bookmark9194"></a>20.4. git branches</span></h2></li></ul>
<p><span class="font25">Working on the project can be done in one or more </span><span class="font25" style="font-weight:bold;">git branches</span><span class="font25">. Here we create a new branch that will make changes to the script. We will </span><span class="font25" style="font-weight:bold;">merge </span><span class="font25">this branch with the </span><span class="font25" style="font-weight:bold;">master branch </span><span class="font25">when we are sure the script works. (It can be useful to add </span><span class="font25" style="font-weight:bold;">git status </span><span class="font25">commands when practicing).</span></p>
<p><span class="font19">paul@debian6~/project42$ git branch * master</span></p>
<p><span class="font19">paul@debian6~/project42$ git checkout -b newheader Switched to a new branch 'newheader' paul@debian6~/project42$ vi thequestion.sh</span></p>
<p><span class="font19">paul@debian6~/project42$ git add thequestion.sh paul@debian6~/project42$ source thequestion.sh The answer is 42.</span></p>
<p><span class="font25">It seems to work, so we commit in this branch.</span></p>
<p><span class="font19">paul@debian6~/project42$ git commit -m &quot;adding a new company header&quot; [newheader 730a22b] adding a new company header</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">1 file changed, 4 insertions(+)</span></p></li></ul>
<p><span class="font19">paul@debian6~/project42$ git branch master</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">* newheader</span></p></li></ul>
<p><span class="font19">paul@debian6~/project42$ cat thequestion.sh #!/bin/bash #</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># copyright linux-training.be #</span></p></li></ul>
<p><span class="font19">echo The answer is 42.</span></p>
<p><span class="font25">Let us go back to the master branch and see what happened there.</span></p>
<p><span class="font19">paul@debian6~/project42$ git checkout master Switched to branch 'master' paul@debian6~/project42$ cat thequestion.sh #!/bin/bash echo The answer is 42.</span></p>
<p><span class="font25">Nothing happened in the master branch, because we worked in another branch.</span></p>
<p><span class="font25">When we are sure the branch is ready for production, then we merge it into the master branch.</span></p>
<p><span class="font19">paul@debian6~/project42$ cat thequestion.sh #!/bin/bash echo The answer is 42.</span></p>
<p><span class="font19">paul@debian6~/project42$ git merge newheader Updating 69b2c8b..730a22b Fast-forward</span></p>
<p><span class="font19">thequestion.sh | &nbsp;&nbsp;&nbsp;4 ++++</span></p>
<p><span class="font19">1 file changed, 4 insertions(+)</span></p>
<p><span class="font19">paul@debian6~/project42$ cat thequestion.sh #!/bin/bash #</span></p>
<p><span class="font19"># copyright linux-training.be #</span></p>
<p><span class="font19">echo The answer is 42.</span></p>
<p><span class="font25">The newheader branch can now be deleted.</span></p>
<p><span class="font19">paul@debian6~/project42$ git branch</span></p>
<p><span class="font19">* master</span></p>
<p><span class="font19">newheader</span></p>
<p><span class="font19">paul@debian6~/project42$ git branch -d newheader Deleted branch newheader (was 730a22b).</span></p>
<p><span class="font19">paul@debian6~/project42$ git branch * master</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9195"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7947"></a><a name="bookmark9196"></a>20.5. to be continued...</span></h2></li></ul>
<h4><a name="bookmark9197"></a><span class="font25"><a name="bookmark9198"></a>The </span><span class="font25" style="font-weight:bold;">git </span><span class="font25">story is not finished.</span><br><br><span class="font25"><a name="bookmark9199"></a>There are many excellent online tutorials for </span><span class="font25" style="font-weight:bold;">git</span><span class="font25">. This list can save you one Google query:</span></h4>
<p><a href="http://gitimmersion.com/"><span class="font19">http://gitimmersion.com/</span></a></p>
<p><a href="http://git-scm.com/book"><span class="font19">http://git-scm.com/book</span></a></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9200"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7948"></a><a name="bookmark9201"></a>20.6. github.com</span></h2></li></ul>
<p><a name="bookmark9202"></a><span class="font25">Create an account on </span><span class="font25" style="font-weight:bold;">github.com</span><span class="font25">. This website is a frontend for an immense git server with over two and a half million users and almost five million projects (including Fedora, Linux kernel, Android, Ruby on Rails, Wine, X.org, VLC...)</span></p>
<p><a href="https://github.com/signup/free"><span class="font19">https://github.com/signup/free</span></a></p>
<p><span class="font25">This account is free of charge, we will use it in the examples below.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9203"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7949"></a><a name="bookmark9204"></a>20.7. add your public key to github</span></h2></li></ul>
<p><a name="bookmark9205"></a><span class="font25">I prefer to use github with a </span><span class="font25" style="font-weight:bold;">public key</span><span class="font25">, so it probably is a good idea that you also upload your public key to github.com.</span></p>
<p><span class="font25">You can upload your own key via the web interface:</span></p>
<p><a href="https://github.com/settings/ssh"><span class="font19">https://github.com/settings/ssh</span></a></p>
<p><span class="font25">Please do not forget to protect your </span><span class="font25" style="font-weight:bold;">private key</span><span class="font25">!</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9206"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7950"></a><a name="bookmark9207"></a>20.8. practice: git</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create a project on github to host a script that you wrote. Have at least two other people improve the script.</span></p></li></ul>
<p><a name="bookmark9208"></a><span class="font11" style="font-weight:bold;">Part X. Appendices</span></p>
<h3><a name="bookmark9209"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9210"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9211"><span class="font24" style="font-weight:bold;">A. cloning </span></a></p></li></ul>
<p><a href="#bookmark9212"><span class="font24">A.1. About cloning </span></a></p>
<p><a href="#bookmark9213"><span class="font24">A.2. About offline cloning </span></a></p>
<p><a href="#bookmark9214"><span class="font24">A.3. Offline cloning example </span></a></p>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9215"><span class="font24" style="font-weight:bold;">B. License </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark9216"></a><span class="font11" style="font-weight:bold;"><a name="bookmark9217"></a><a name="bookmark9218"></a><a name="bookmark9219"></a>Appendix A. cloning</span></h1></li></ul>
<h2><a name="bookmark7973"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9220"></a>A.1. About cloning</span></h2>
<p><span class="font25">You can have distinct goals for cloning a server. For instance a clone can be a cold iron backup system used for manual disaster recovery of a service. Or a clone can be created to serve in a test environment. Or you might want to make an almost identical server. Let's take a look at some offline and online ways to create a clone of a Linux server.</span></p>
<h2><a name="bookmark9221"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7974"></a><a name="bookmark9222"></a>A.2. About offline cloning</span></h2>
<p><span class="font25">The term offline cloning is used when you power off the running Linux server to create the clone. This method is easy since we don't have to consider open files and we don't have to skip virtual file systems like </span><span class="font25" style="font-weight:bold;">/dev </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">/sys </span><span class="font25">. The offline cloning method can be broken down into these steps:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">1. Boot source and target server with a bootable CD</span></p></li>
<li>
<p><span class="font19">2. Partition, format and mount volumes on the target server</span></p></li>
<li>
<p><span class="font19">3. Copy files/partitions from source to target over the network</span></p></li></ul>
<p><span class="font25">The first step is trivial. The second step is explained in the Disk Management chapter. For the third step, you can use a combination of </span><span class="font25" style="font-weight:bold;">ssh </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">netcat </span><span class="font25">with </span><span class="font25" style="font-weight:bold;">cp</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">dd</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">dump </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">restore</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">tar</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">cpio</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">rsync </span><span class="font25">or even </span><span class="font25" style="font-weight:bold;">cat</span><span class="font25">.</span></p>
<h2><a name="bookmark9223"></a><span class="font10" style="font-weight:bold;"><a name="bookmark7975"></a><a name="bookmark9224"></a>A.3. Offline cloning example</span></h2>
<p><span class="font25">We have a working Red Hat Enterprise Linux 5 server, and we want a perfect copy of it on newer hardware. First thing to do is discover the disk layout.</span></p>
<p><span class="font19">[root@RHEL5 ~]# df -h</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Filesystem</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Size</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Used</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Avail</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Use%</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Mounted on</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sda2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15G</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4.5G</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">9.3G</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">33%</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/sda1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">99M</span></p></td><td style="vertical-align:top;">
<p><span class="font19">31M</span></p></td><td style="vertical-align:top;">
<p><span class="font19">64M</span></p></td><td style="vertical-align:top;">
<p><span class="font19">33%</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/boot</span></p></td></tr>
</table>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">/boot </span><span class="font25">partition is small but big enough. If we create an identical partition, then </span><span class="font25" style="font-weight:bold;">dd </span><span class="font25">should be a good cloning option. Suppose the </span><span class="font25" style="font-weight:bold;">/ </span><span class="font25">partition needs to be enlarged on the target system. The best option then is to use a combination of </span><span class="font25" style="font-weight:bold;">dump </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">restore</span><span class="font25">. Remember that dd copies blocks, whereas dump/restore copies files.</span></p>
<p><span class="font25">The first step to do is to boot the target server with a live CD and partition the target disk. To do this we use the Red Hat Enterprise Linux 5 install CD. At the CD boot prompt we type &quot;linux rescue&quot;. The cd boots into a root console where we can use fdisk to discover and prepare the attached disks.</span></p>
<p><span class="font25">When the partitions are created and have their filesystem, then we can use dd to copy the / boot partition.</span></p>
<p><span class="font24">cloning</span></p>
<p><span class="font19">ssh </span><a href="mailto:root@192.168.1.40"><span class="font19">root@192.168.1.40</span></a><span class="font19"> &quot;dd if=/dev/sda1&quot; | dd of=/dev/sda1</span></p>
<h4><a name="bookmark9225"></a><span class="font25"><a name="bookmark9226"></a>Then we use a dump and restore combo to copy the / partition.</span></h4>
<p><span class="font19">mkdir /mnt/x</span></p>
<p><span class="font19">mount /dev/sda2 /mnt/x cd /mnt/x</span></p>
<p><span class="font19">ssh </span><a href="mailto:root@192.168.1.40"><span class="font19">root@192.168.1.40</span></a><span class="font19"> &quot;dump -0 -f - /&quot; | restore -r -f -</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark9227"></a><span class="font11" style="font-weight:bold;"><a name="bookmark9228"></a><a name="bookmark9229"></a>Appendix B. License</span></h1></li></ul>
<p><span class="font19">GNU Free Documentation License</span></p>
<p><span class="font19">Version 1.3, 3 November 2008</span></p>
<p><span class="font19">Copyright © 2000, 2001, 2002, 2007, 2008 Free Software Foundation, Inc.</span></p>
<p><span class="font19">Everyone is permitted to copy and distribute verbatim copies of this license document, but changing it is not allowed.</span></p>
<p><span class="font19">0. PREAMBLE</span></p>
<p><span class="font19">The purpose of this License is to make a manual, textbook, or other functional and useful document &quot;free&quot; in the sense of freedom: to assure everyone the effective freedom to copy and redistribute it, with or without modifying it, either commercially or noncommercially. Secondarily, this License preserves for the author and publisher a way to get credit for their work, while not being considered responsible for modifications made by others.</span></p>
<p><span class="font19">This License is a kind of &quot;copyleft&quot;, which means that derivative works of the document must themselves be free in the same sense. It complements the GNU General Public License, which is a copyleft license designed for free software.</span></p>
<p><span class="font19">We have designed this License in order to use it for manuals for free software, because free software needs free documentation: a free program should come with manuals providing the same freedoms that the software does. But this License is not limited to software manuals; it can be used for any textual work, regardless of subject matter or whether it is published as a printed book. We recommend this License principally for works whose purpose is instruction or reference.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">1. APPLICABILITY AND DEFINITIONS</span></p></li></ul>
<p><span class="font19">This License applies to any manual or other work, in any medium, that contains a notice placed by the copyright holder saying it can be distributed under the terms of this License. Such a notice grants a world-wide, royalty-free license, unlimited in duration, to use that work under the conditions stated herein. The &quot;Document&quot;, below, refers to any such manual or work. Any member of the public is a licensee, and is addressed as &quot;you&quot;. You accept the license if you copy, modify or distribute the work in a way requiring permission under copyright law.</span></p>
<p><span class="font19">A &quot;Modified Version&quot; of the Document means any work containing the Document or a portion of it, either copied verbatim, or with modifications and/or translated into another language.</span></p>
<p><span class="font19">A &quot;Secondary Section&quot; is a named appendix or a front-matter section of the Document that deals exclusively with the relationship of the publishers or authors of the Document to the Document's overall subject (or to related matters) and contains nothing that could fall directly within that overall subject. (Thus, if the Document is in part a textbook of mathematics, a Secondary Section may not explain any mathematics.) The relationship could be a matter of historical connection with the subject or with related matters, or of legal, commercial, philosophical, ethical or political position regarding them.</span></p>
<p><span class="font19">The &quot;Invariant Sections&quot; are certain Secondary Sections whose titles are designated, as being those of Invariant Sections, in the notice that says that the Document is released under this License. If a section does not fit the above definition of Secondary then it is not allowed to be designated as Invariant. The Document may contain zero Invariant Sections. If the Document does not identify any Invariant Sections then there are none.</span></p>
<p><span class="font19">The &quot;Cover Texts&quot; are certain short passages of text that are listed, as Front-Cover Texts or Back-Cover Texts, in the notice that says that the Document is released under this License. A Front-Cover Text may be at most 5 words, and a Back-Cover Text may be at most 25 words.</span></p>
<p><span class="font19">A &quot;Transparent&quot; copy of the Document means a machine-readable copy, represented in a format whose specification is available to the general public, that is suitable for revising the document straightforwardly with generic text editors or (for images composed of pixels) generic paint programs or (for drawings) some widely available drawing editor, and that is suitable for input to text formatters or for automatic translation to a variety of formats suitable for input to text formatters. A copy made in an otherwise Transparent file format whose markup, or absence of markup, has been arranged to thwart or discourage subsequent modification by readers is not Transparent. An image format is not Transparent if used for any substantial amount of text. A copy that is not &quot;Transparent&quot; is called &quot;Opaque&quot;.</span></p>
<p><span class="font19">Examples of suitable formats for Transparent copies include plain ASCII without markup, Texinfo input format, LaTeX input format, SGML or XML using a publicly available DTD, and standard-conforming simple HTML, PostScript or PDF designed for human modification. Examples of transparent image formats include PNG, XCF and JPG. Opaque formats include proprietary formats that can be read and edited only by proprietary word processors, SGML or XML for which the DTD and/or processing tools are not generally available, and the machine-generated HTML, PostScript or PDF produced by some word processors for output purposes only.</span></p>
<p><span class="font19">The &quot;Title Page&quot; means, for a printed book, the title page itself, plus such following pages as are needed to hold, legibly, the material this License requires to appear in the title page. For works in formats which do not have any title page as such, &quot;Title Page&quot; means the text near the most prominent appearance of the work's title, preceding the beginning of the body of the text.</span></p>
<p><span class="font19">The &quot;publisher&quot; means any person or entity that distributes copies of the Document to the public.</span></p>
<p><span class="font19">A section &quot;Entitled XYZ&quot; means a named subunit of the Document whose title either is precisely XYZ or contains XYZ in parentheses following text that translates XYZ in another language. (Here XYZ stands for a specific section name mentioned below, such as &quot;Acknowledgements&quot;, &quot;Dedications&quot;, &quot;Endorsements&quot;, or &quot;History&quot;.) To &quot;Preserve the Title&quot; of such a section when you modify the Document means that it remains a section &quot;Entitled XYZ&quot; according to this definition.</span></p>
<p><span class="font19">The Document may include Warranty Disclaimers next to the notice which states that this License applies to the Document. These Warranty Disclaimers are considered to be included by reference in this License, but only as regards disclaiming warranties: any other implication that these Warranty Disclaimers may have is void and has no effect on the meaning of this License.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">2. VERBATIM COPYING</span></p></li></ul>
<p><span class="font19">You may copy and distribute the Document in any medium, either commercially or noncommercially, provided that this License, the copyright notices, and the license notice saying this License applies to the Document are reproduced in all copies, and that you add no other conditions whatsoever to those of this License. You may not use technical measures to obstruct or control the reading or further copying of the copies you make or distribute. However, you may accept compensation in exchange for copies. If you distribute a large enough number of copies you must also follow the conditions in section 3.</span></p>
<p><span class="font19">You may also lend copies, under the same conditions stated above, and you may publicly display copies.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">3. COPYING IN QUANTITY</span></p></li></ul>
<p><span class="font19">If you publish printed copies (or copies in media that commonly have printed covers) of the Document, numbering more than 100, and the Document's license notice requires Cover Texts, you must enclose the copies in covers that carry, clearly and legibly, all these Cover Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on the back cover. Both covers must also clearly and legibly identify you as the publisher of these copies. The front cover must present the full title with all words of the title equally prominent and visible. You may add other material on the covers in addition. Copying with changes limited to the covers, as long as they preserve the title of the Document and satisfy these conditions, can be treated as verbatim copying in other respects.</span></p>
<p><span class="font19">If the required texts for either cover are too voluminous to fit legibly, you should put the first ones listed (as many as fit reasonably) on the actual cover, and continue the rest onto adjacent pages.</span></p>
<p><span class="font19">If you publish or distribute Opaque copies of the Document numbering more than 100, you must either include a machine-readable Transparent copy along with each Opaque copy, or state in or with each Opaque copy a computer-network location from which the general network-using public has access to download using public-standard network protocols a complete Transparent copy of the Document, free of added material. If you use the latter option, you must take reasonably prudent steps, when you begin distribution of Opaque copies in quantity, to ensure that this Transparent copy will remain thus accessible at the stated location until at least one year after the last time you distribute an Opaque copy (directly or through your agents or retailers) of that edition to the public.</span></p>
<p><span class="font19">It is requested, but not required, that you contact the authors of the Document well before redistributing any large number of copies, to give them a chance to provide you with an updated version of the Document.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">4. MODIFICATIONS</span></p></li></ul>
<p><span class="font19">You may copy and distribute a Modified Version of the Document under the conditions of sections 2 and 3 above, provided that you release the Modified Version under precisely this License, with the Modified Version filling the role of the Document, thus licensing distribution and modification of the Modified Version to whoever possesses a copy of it. In addition, you must do these things in the Modified Version:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">* A. Use in the Title Page (and on the covers, if any) a title distinct from that of the Document, and from those of previous versions (which should, if there were any, be listed in the History section of the Document). You may use the same title as a previous version if the original publisher of that version gives permission.</span></p></li>
<li>
<p><span class="font19">* B. List on the Title Page, as authors, one or more persons or entities responsible for authorship of the modifications in the Modified Version, together with at least five of the principal authors of the Document (all of its principal authors, if it has fewer than five), unless they release you from this requirement.</span></p></li>
<li>
<p><span class="font19">* C. State on the Title page the name of the publisher of the Modified Version, as the publisher.</span></p></li>
<li>
<p><span class="font19">* D. Preserve all the copyright notices of the Document.</span></p></li>
<li>
<p><span class="font19">* E. Add an appropriate copyright notice for your modifications adjacent to the other copyright notices.</span></p></li>
<li>
<p><span class="font19">* F. Include, immediately after the copyright notices, a license notice giving the public permission to use the Modified Version under the terms of this License, in the form shown in the Addendum below.</span></p></li>
<li>
<p><span class="font19">* G. Preserve in that license notice the full lists of Invariant Sections and required Cover Texts given in the Document's license notice.</span></p></li>
<li>
<p><span class="font19">* H. Include an unaltered copy of this License.</span></p></li>
<li>
<p><span class="font19">* I. Preserve the section Entitled &quot;History&quot;, Preserve its Title, and add to it an item stating at least the title, year, new authors, and publisher of the Modified Version as given on the Title Page. If there is no section Entitled &quot;History&quot; in the Document, create one stating the title, year, authors, and publisher of the Document as given on its Title Page, then add an item describing the Modified Version as stated in the previous sentence.</span></p></li>
<li>
<p><span class="font19">* J. Preserve the network location, if any, given in the Document for public access to a Transparent copy of the Document, and likewise the network locations given in the Document for previous versions it was based on. These may be placed in the &quot;History&quot; section. You may omit a network location for a work that was published at least four years before the Document itself, or if the original publisher of the version it refers to gives permission.</span></p></li>
<li>
<p><span class="font19">* K. For any section Entitled &quot;Acknowledgements&quot; or &quot;Dedications&quot;, Preserve the Title of the section, and preserve in the section all the substance and tone of each of the contributor acknowledgements and/or dedications given therein.</span></p></li>
<li>
<p><span class="font19">* L. Preserve all the Invariant Sections of the Document, unaltered in their text and in their titles. Section numbers or the equivalent are not considered part of the section titles.</span></p></li>
<li>
<p><span class="font19">* M. Delete any section Entitled &quot;Endorsements&quot;. Such a section may not be included in the Modified Version.</span></p></li>
<li>
<p><span class="font19">* N. Do not retitle any existing section to be Entitled &quot;Endorsements&quot; or to conflict in title with any Invariant Section.</span></p></li>
<li>
<p><span class="font19">* O. Preserve any Warranty Disclaimers.</span></p></li></ul>
<p><span class="font19">If the Modified Version includes new front-matter sections or appendices that qualify as Secondary Sections and contain no material copied from the Document, you may at your option designate some or all of these sections as invariant. To do this, add their titles to the list of Invariant Sections in the Modified Version's license notice. These titles must be distinct from any other section titles.</span></p>
<p><span class="font19">You may add a section Entitled &quot;Endorsements&quot;, provided it contains nothing but endorsements of your Modified Version by various parties—for example, statements of peer review or that the text has been approved by an organization as the authoritative definition of a standard.</span></p>
<p><span class="font19">You may add a passage of up to five words as a Front-Cover Text, and a passage of up to 25 words as a Back-Cover Text, to the end of the list of Cover Texts in the Modified Version. Only one passage of Front-Cover Text and one of Back-Cover Text may be added by (or through arrangements made by) any one entity. If the Document already includes a cover text for the same cover, previously added by you or by arrangement made by the same entity you are acting on behalf of, you may not add another; but you may replace the old one, on explicit permission from the previous publisher that added the old one.</span></p>
<p><span class="font19">The author(s) and publisher(s) of the Document do not by this License give permission to use their names for publicity for or to assert or imply endorsement of any Modified Version.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">5. COMBINING DOCUMENTS</span></p></li></ul>
<p><span class="font19">You may combine the Document with other documents released under this License, under the terms defined in section 4 above for modified versions, provided that you include in the combination all of the Invariant Sections of all of the original documents, unmodified, and list them all as Invariant Sections of your combined work in its license notice, and that you preserve all their Warranty Disclaimers.</span></p>
<p><span class="font19">The combined work need only contain one copy of this License, and multiple identical Invariant Sections may be replaced with a single copy. If there are multiple Invariant Sections with the same name but different contents, make the title of each such section unique by adding at the end of it, in parentheses, the name of the original author or publisher of that section if known, or else a unique number. Make the same adjustment to the section titles in the list of Invariant Sections in the license notice of the combined work.</span></p>
<p><span class="font19">In the combination, you must combine any sections Entitled &quot;History&quot; in the various original documents, forming one section Entitled &quot;History&quot;; likewise combine any sections Entitled &quot;Acknowledgements&quot;, and any sections Entitled &quot;Dedications&quot;. You must delete all sections Entitled &quot;Endorsements&quot;.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">6. COLLECTIONS OF DOCUMENTS</span></p></li></ul>
<p><span class="font19">You may make a collection consisting of the Document and other documents released under this License, and replace the individual copies of this License in the various documents with a single copy that is included in the collection, provided that you follow the rules of this License for verbatim copying of each of the documents in all other respects.</span></p>
<p><span class="font19">You may extract a single document from such a collection, and distribute it individually under this License, provided you insert a copy of this License into the extracted document, and follow this License in all other respects regarding verbatim copying of that document.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">7. AGGREGATION WITH INDEPENDENT WORKS</span></p></li></ul>
<p><span class="font19">A compilation of the Document or its derivatives with other separate and independent documents or works, in or on a volume of a storage or distribution medium, is called an &quot;aggregate&quot; if the copyright resulting from the compilation is not used to limit the legal rights of the compilation's users beyond what the individual works permit. When the Document is included in an aggregate, this License does not apply to the other works in the aggregate which are not themselves derivative works of the Document.</span></p>
<p><span class="font19">If the Cover Text requirement of section 3 is applicable to these copies of the Document, then if the Document is less than one half of the entire aggregate, the Document's Cover Texts may be placed on covers that bracket the Document within the aggregate, or the electronic equivalent of covers if the Document is in electronic form. Otherwise they must appear on printed covers that bracket the whole aggregate.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">8. TRANSLATION</span></p></li></ul>
<p><span class="font19">Translation is considered a kind of modification, so you may distribute translations of the Document under the terms of section 4. Replacing Invariant Sections with translations requires special permission from their copyright holders, but you may include translations of some or all Invariant Sections in addition to the original versions of these Invariant Sections. You may include a translation of this License, and all the license notices in the Document, and any Warranty Disclaimers, provided that you also include the original English version of this License and the original versions of those notices and disclaimers. In case of a disagreement between the translation and the original version of this License or a notice or disclaimer, the original version will prevail.</span></p>
<p><span class="font19">If a section in the Document is Entitled &quot;Acknowledgements&quot;, &quot;Dedications&quot;, or &quot;History&quot;, the requirement (section 4) to Preserve its Title (section 1) will typically require changing the actual title.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">9. TERMINATION</span></p></li></ul>
<p><span class="font19">You may not copy, modify, sublicense, or distribute the Document except as expressly provided under this License. Any attempt otherwise to copy, modify, sublicense, or distribute it is void, and will automatically terminate your rights under this License.</span></p>
<p><span class="font19">However, if you cease all violation of this License, then your license from a particular copyright holder is reinstated (a) provisionally, unless and until the copyright holder explicitly and finally terminates your license, and (b) permanently, if the copyright holder fails to notify you of the violation by some reasonable means prior to 60 days after the cessation.</span></p>
<p><span class="font19">Moreover, your license from a particular copyright holder is reinstated permanently if the copyright holder notifies you of the violation by some reasonable means, this is the first time you have received notice of violation of this License (for any work) from that copyright holder, and you cure the violation prior to 30 days after your receipt of the notice.</span></p>
<p><span class="font19">Termination of your rights under this section does not terminate the licenses of parties who have received copies or rights from you under this License. If your rights have been terminated and not permanently reinstated, receipt of a copy of some or all of the same material does not give you any rights to use it.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">10. FUTURE REVISIONS OF THIS LICENSE</span></p></li></ul>
<p><span class="font19">The Free Software Foundation may publish new, revised versions of the GNU Free Documentation License from time to time. Such new versions will be similar in spirit to the present version, but may differ in detail to address new problems or concerns. See </span><a href="http://www.gnu.org/copyleft/"><span class="font19">http://www.gnu.org/copyleft/</span></a><span class="font19">.</span></p>
<p><span class="font19">Each version of the License is given a distinguishing version number. If the Document specifies that a particular numbered version of this License &quot;or any later version&quot; applies to it, you have the option of following the terms and conditions either of that specified version or of any later version that has been published (not as a draft) by the Free Software Foundation. If the Document does not specify a version number of this License, you may choose any version ever published (not as a draft) by the Free Software Foundation. If the Document specifies that a proxy can decide which future versions of this License can be used, that proxy's public statement of acceptance of a version permanently authorizes you to choose that version for the Document.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">11. RELICENSING</span></p></li></ul>
<p><span class="font19">&quot;Massive Multiauthor Collaboration Site&quot; (or &quot;MMC Site&quot;) means any World Wide Web server that publishes copyrightable works and also provides prominent facilities for anybody to edit those works. A public wiki that anybody can edit is an example of such a server. A &quot;Massive Multiauthor Collaboration&quot; (or &quot;MMC&quot;) contained in the site means any set of copyrightable works thus published on the MMC site.</span></p>
<p><span class="font19">&quot;CC-BY-SA&quot; means the Creative Commons Attribution-Share Alike 3.0 license published by Creative Commons Corporation, a not-for-profit corporation with a principal place of business in San Francisco, California, as well as future copyleft versions of that license published by that same organization.</span></p>
<p><span class="font19">&quot;Incorporate&quot; means to publish or republish a Document, in whole or in part, as part of another Document.</span></p>
<p><span class="font19">An MMC is &quot;eligible for relicensing&quot; if it is licensed under this License, and if all works that were first published under this License somewhere other than this MMC, and subsequently incorporated in whole or in part into the MMC, (1) had no cover texts or invariant sections, and (2) were thus incorporated prior to November 1, 2008.</span></p>
<p><span class="font19">The operator of an MMC Site may republish an MMC contained in the site under CC-BY-SA on the same site at any time before August 1, 2009, provided the MMC is eligible for relicensing.</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><a name="bookmark9230"></a><span class="font11" style="font-weight:bold;">Index</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">CIFS,</span><a href="#bookmark8673"><span class="font24"> 143</span></a></p>
<p><span class="font24">CNAME (DNS record), 67</span></p>
<p><span class="font24">context type(selinux), 215</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">Symbols</span></p>
<p><span class="font24">/etc/apache2,</span><a href="#bookmark8084"><span class="font24"> 10</span></a></p>
<p><span class="font24">/etc/bind/named.conf.local, 76</span></p>
<p><span class="font24">/etc/group, </span><a href="#bookmark8342"><span class="font24">45</span></a></p>
<p><span class="font24">/etc/httpd,</span><a href="#bookmark8081"><span class="font24"> 10</span></a></p>
<p><span class="font24">/etc/inetd.conf,</span><a href="#bookmark8746"><span class="font24"> 152</span></a></p>
<p><span class="font24">/etc/init.d/samba,</span><a href="#bookmark8642"><span class="font24"> 141</span></a></p>
<p><span class="font24">/etc/init.d/smb,</span><a href="#bookmark8643"><span class="font24"> 141</span></a></p>
<p><span class="font24">/etc/init.d/winbind,</span><a href="#bookmark8658"><span class="font24"> 142</span></a></p>
<p><span class="font24">/etc/nsswitch.conf,</span><a href="#bookmark9019"><span class="font24"> 190</span></a><span class="font24">,</span><a href="#bookmark9041"><span class="font24"> 192</span></a></p>
<p><span class="font24">/etc/passwd, </span><a href="#bookmark8343"><span class="font24">45</span></a><span class="font24">,</span><a href="#bookmark9110"><span class="font24"> 199</span></a></p>
<p><span class="font24">/etc/resolv.conf, 62</span></p>
<p><span class="font24">/etc/samba/passdb.tdb,</span><a href="#bookmark9104"><span class="font24"> 198</span></a></p>
<p><span class="font24">/etc/samba/smb.conf,</span><a href="#bookmark8681"><span class="font24"> 146</span></a><span class="font24">,</span><a href="#bookmark8695"><span class="font24"> 147</span></a><span class="font24">,</span><a href="#bookmark8707"><span class="font24"> 148</span></a><span class="font24">,</span><a href="#bookmark8831"><span class="font24"> 164</span></a><span class="font24">,</span><a href="#bookmark9007"><span class="font24"> 188</span></a></p>
<p><span class="font24">/etc/samba/smbpasswd,</span><a href="#bookmark8863"><span class="font24"> 169</span></a><span class="font24">,</span><a href="#bookmark9072"><span class="font24"> 196</span></a></p>
<p><span class="font24">/etc/selinux/config, 212</span></p>
<p><span class="font24">/etc/squid/squid.conf,</span><a href="#bookmark8280"><span class="font24"> 34</span></a></p>
<p><span class="font24">/etc/sysctl.conf, 116</span></p>
<p><span class="font24">/etc/xinetd.d/swat,</span><a href="#bookmark8747"><span class="font24"> 152</span></a></p>
<p><span class="font24">/proc/sys/net/ipv4/ip_forward, 116</span></p>
<p><span class="font24">/selinux, 214</span></p>
<p><span class="font24">/selinux/enforce, 214</span></p>
<p><span class="font24">/var/log/audit/audit.log, 210</span></p>
<p><span class="font24">/var/log/squid,</span><a href="#bookmark8297"><span class="font24"> 39</span></a></p>
<p><span class="font24">.htaccess, </span><a href="#bookmark8223"><span class="font24">27</span></a></p>
<p><span class="font24">.htpasswd,</span><a href="#bookmark8141"><span class="font24"> 17</span></a><span class="font24">, </span><a href="#bookmark8195"><span class="font24">24</span></a></p>
<p><span class="font24">.my.cnf, </span><a href="#bookmark8352"><span class="font24">46</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">create(mysql), </span><a href="#bookmark8378"><span class="font24">47</span></a><span class="font24">, </span><a href="#bookmark8406"><span class="font24">49</span></a><span class="font24">, </span><a href="#bookmark8511"><span class="font24">55</span></a></p>
<p><span class="font24">create mask (Samba),</span><a href="#bookmark8974"><span class="font24"> 182</span></a></p>
<p><span class="font7" style="font-weight:bold;">D</span></p>
<p><span class="font24">delete(mysql), </span><a href="#bookmark8492"><span class="font24">54</span></a></p>
<p><span class="font24">deny hosts (Samba),</span><a href="#bookmark8959"><span class="font24"> 182</span></a></p>
<p><span class="font24">describe(mysql),</span><a href="#bookmark8416"><span class="font24"> 50</span></a></p>
<p><span class="font24">dhclient, 118</span></p>
<p><span class="font24">dhcp server, 62</span></p>
<p><span class="font24">directory mask (Samba),</span><a href="#bookmark8975"><span class="font24"> 182</span></a></p>
<p><span class="font24">directory security mask(samba),</span><a href="#bookmark8982"><span class="font24"> 183</span></a></p>
<p><span class="font24">DNAT, 115</span></p>
<p><span class="font24">dns, 60, 60</span></p>
<p><span class="font24">dnsdomainname, 66</span></p>
<p><span class="font24">dns namespace, 63</span></p>
<p><span class="font24">dns server, 62</span></p>
<p><span class="font24">domain (dns), 64</span></p>
<p><span class="font24">domain name system, 60, 60</span></p>
<p><span class="font24">dpkg,</span><a href="#bookmark8624"><span class="font24"> 138</span></a></p>
<p><span class="font24">dpkg(1), </span><a href="#bookmark8329"><span class="font24">44</span></a></p>
<p><span class="font24">drop(mysql), </span><a href="#bookmark8396"><span class="font24">48</span></a><span class="font24">,</span><a href="#bookmark8421"><span class="font24"> 50</span></a><span class="font24">, </span><a href="#bookmark8522"><span class="font24">56</span></a></p>
<p><span class="font7" style="font-weight:bold;">F</span></p>
<p><span class="font24">filter table (iptables), 123</span></p>
<p><span class="font24">firewall, 114</span></p>
<p><span class="font24">force create mode(samba),</span><a href="#bookmark8979"><span class="font24"> 183</span></a></p>
<p><span class="font24">force directory mode(samba),</span><a href="#bookmark8978"><span class="font24"> 183</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">A</span></p>
<p><span class="font24">A (DNS record), 67</span></p>
<p><span class="font24">AAAA (DNS record), 67 allow hosts (Samba),</span><a href="#bookmark8955"><span class="font24"> 181</span></a><span class="font24"> apache2,</span><a href="#bookmark8037"><span class="font24"> 6</span></a><span class="font24"> aptitude,</span><a href="#bookmark8623"><span class="font24"> 138</span></a><span class="font24">,</span><a href="#bookmark8633"><span class="font24"> 139</span></a><span class="font24">, </span><a href="#bookmark9146"><span class="font24">227</span></a><span class="font24"> aptitude(8), </span><a href="#bookmark8323"><span class="font24">44</span></a><span class="font24"> auditd, 210 authoritative (dns), 71 authoritative zone, 66 axfr, 74</span></p></td><td style="vertical-align:top;">
<p><span class="font24">force directory security mode(samba),</span><a href="#bookmark8986"><span class="font24"> 183</span></a></p>
<p><span class="font24">force group(samba),</span><a href="#bookmark8870"><span class="font24"> 170</span></a></p>
<p><span class="font24">force security mode(samba),</span><a href="#bookmark8987"><span class="font24"> 183</span></a></p>
<p><span class="font24">force user(samba),</span><a href="#bookmark8871"><span class="font24"> 170</span></a></p>
<p><span class="font24">forwarder (dns), 70</span></p>
<p><span class="font24">forward lookup query, 61</span></p>
<p><span class="font24">fqdn, 66</span></p>
<p><span class="font24">fully qualified domain name, 66</span></p>
<p><span class="font7" style="font-weight:bold;">G</span></p>
<p><span class="font24">getenforce, 211</span></p>
<p><span class="font24">getent(1),</span><a href="#bookmark9040"><span class="font24"> 191</span></a></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font7" style="font-weight:bold;">B</span></p>
<p><span class="font24">bind, 64</span></p>
<p><span class="font24">bind(DNS), 90</span></p>
<p><span class="font24">browsable (Samba),</span><a href="#bookmark8969"><span class="font24"> 182</span></a></p>
<p><span class="font24">browseable (Samba),</span><a href="#bookmark8968"><span class="font24"> 182</span></a></p>
<p><span class="font24">browser master,</span><a href="#bookmark9080"><span class="font24"> 196</span></a></p></td><td style="vertical-align:top;">
<p><span class="font24">getfattr(1), 217</span></p>
<p><span class="font24">git, </span><a href="#bookmark9141"><span class="font24">226</span></a></p>
<p><span class="font24">github,</span><a href="#bookmark9202"><span class="font24"> 232</span></a></p>
<p><span class="font24">glue record (dns), 67</span></p>
<p><span class="font24">grant(mysql), </span><a href="#bookmark8393"><span class="font24">48</span></a></p>
<p><span class="font24">group by(mysql), </span><a href="#bookmark8484"><span class="font24">54</span></a></p>
<p><span class="font24">guest ok (Samba),</span><a href="#bookmark8772"><span class="font24"> 157</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">C</span></p>
<p><span class="font24">cahing only name server, 68</span></p>
<p><span class="font24">chain (iptables), 123</span></p>
<p><span class="font24">char(mysql), </span><a href="#bookmark8407"><span class="font24">49</span></a></p>
<p><span class="font24">chcon(1), 216, 217</span></p>
<p><span class="font24">chkconfig, 210</span></p>
<p><span class="font24">chmod, 213</span></p></td><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">H</span></p>
<p><span class="font24">hide unreadable (Samba),</span><a href="#bookmark8965"><span class="font24"> 182</span></a></p>
<p><span class="font24">host (DNS record), 67</span></p>
<p><span class="font24">hostname, 66,</span><a href="#bookmark8669"><span class="font24"> 143</span></a></p>
<p><span class="font24">hosts.txt, 60</span></p>
<p><span class="font24">hosts allow (Samba),</span><a href="#bookmark8956"><span class="font24"> 181</span></a></p>
<p><span class="font24">hosts deny (Samba),</span><a href="#bookmark8960"><span class="font24"> 182</span></a></p></td></tr>
</table>
<p><span class="font24">htpasswd(1),</span><a href="#bookmark8142"><span class="font24"> 17</span></a><span class="font24">, </span><a href="#bookmark8196"><span class="font24">24</span></a></p>
<p><span class="font24">httpd, </span><a href="#bookmark8050"><span class="font24">7</span></a></p>
<p><span class="font7" style="font-weight:bold;">I</span></p>
<p><span class="font24">IBM,</span><a href="#bookmark8663"><span class="font24"> 143</span></a></p>
<p><span class="font24">id(1), 216</span></p>
<p><span class="font24">identity(selinux), 214</span></p>
<p><span class="font24">idmap gid(samba),</span><a href="#bookmark9001"><span class="font24"> 188</span></a></p>
<p><span class="font24">idmap uid(samba),</span><a href="#bookmark9002"><span class="font24"> 188</span></a></p>
<p><span class="font24">inetd(8),</span><a href="#bookmark8741"><span class="font24"> 152</span></a></p>
<p><span class="font24">insert(mysql), </span><a href="#bookmark8428"><span class="font24">51</span></a></p>
<p><span class="font24">integer(mysql), </span><a href="#bookmark8408"><span class="font24">49</span></a></p>
<p><span class="font24">invalid users (Samba),</span><a href="#bookmark8944"><span class="font24"> 181</span></a></p>
<p><span class="font24">iptables, 122, 123</span></p>
<p><span class="font24">iptables save, 127</span></p>
<p><span class="font24">iterative query, 70</span></p>
<p><span class="font24">ixfr, 74</span></p>
<p><span class="font7" style="font-weight:bold;">L</span></p>
<p><span class="font24">LAMP, </span><a href="#bookmark8319"><span class="font24">43</span></a></p>
<p><span class="font24">ls, 213</span></p>
<p><span class="font24">ls(1), 217</span></p>
<p><span class="font7" style="font-weight:bold;">M</span></p>
<p><span class="font24">mac address, 117</span></p>
<p><span class="font24">mangle table (iptables), 123</span></p>
<p><span class="font24">masquerading, 115</span></p>
<p><span class="font24">master server (DNS), 73</span></p>
<p><span class="font24">MX (DNS record), 67</span></p>
<p><span class="font24">mysql, </span><a href="#bookmark8317"><span class="font24">43</span></a><span class="font24">, </span><a href="#bookmark8349"><span class="font24">45</span></a><span class="font24">, </span><a href="#bookmark8355"><span class="font24">46</span></a><span class="font24">, </span><a href="#bookmark8366"><span class="font24">47</span></a></p>
<p><span class="font24">mysql(group), </span><a href="#bookmark8344"><span class="font24">45</span></a></p>
<p><span class="font24">mysql(user), </span><a href="#bookmark8345"><span class="font24">45</span></a></p>
<p><span class="font24">mysql-client, </span><a href="#bookmark8324"><span class="font24">44</span></a></p>
<p><span class="font24">mysqld, </span><a href="#bookmark8346"><span class="font24">45</span></a></p>
<p><span class="font24">mysql-server, </span><a href="#bookmark8325"><span class="font24">44</span></a></p>
<p><span class="font7" style="font-weight:bold;">N</span></p>
<p><span class="font24">NAPT, 115</span></p>
<p><span class="font24">NAT, 115</span></p>
<p><span class="font24">nat table (iptables), 123</span></p>
<p><span class="font24">NetBIOS names,</span><a href="#bookmark8670"><span class="font24"> 143</span></a></p>
<p><span class="font24">netcat,</span><a href="#bookmark8799"><span class="font24"> 160</span></a></p>
<p><span class="font24">net groupmap, </span><a href="#bookmark9117"><span class="font24">201</span></a></p>
<p><span class="font24">net rpc join(samba),</span><a href="#bookmark9013"><span class="font24"> 189</span></a></p>
<p><span class="font24">net use(microsoft),</span><a href="#bookmark8788"><span class="font24"> 159</span></a><span class="font24">,</span><a href="#bookmark8836"><span class="font24"> 164</span></a><span class="font24">,</span><a href="#bookmark8898"><span class="font24"> 175</span></a></p>
<p><span class="font24">net view(microsoft),</span><a href="#bookmark8689"><span class="font24"> 146</span></a><span class="font24">,</span><a href="#bookmark8734"><span class="font24"> 151</span></a></p>
<p><span class="font24">nmbd(8),</span><a href="#bookmark8651"><span class="font24"> 142</span></a></p>
<p><span class="font24">NS (DNS record), 67</span></p>
<p><span class="font24">nslookup, 61</span></p>
<p><span class="font24">NT_STATUS_BAD_NETWORK_NAME, NT_STATUS_LOGON_FAILURE,</span><a href="#bookmark8923"><span class="font24"> 176</span></a></p>
<p><span class="font7" style="font-weight:bold;">O</span></p>
<p><span class="font24">order by(mysql),</span><a href="#bookmark8475"><span class="font24"> 53</span></a></p>
<p><span class="font7" style="font-weight:bold;">P</span></p>
<p><span class="font24">packet filtering, 114, 124</span></p>
<div>
<p><span class="font24">packet forwarding, 114</span></p>
<p><span class="font24">passdb backend (Samba),</span><a href="#bookmark8866"><span class="font24"> 170</span></a></p>
<p><span class="font24">PAT, 115</span></p>
<p><span class="font24">Paul Mockapetris, 60</span></p>
<p><span class="font24">php, </span><a href="#bookmark8320"><span class="font24">43</span></a></p>
<p><span class="font24">ping, 117, 118</span></p>
<p><span class="font24">port forwarding, 115</span></p>
<p><span class="font24">primary dns server, 71</span></p>
<p><span class="font24">primary server (DNS), 73</span></p>
<p><span class="font24">proxy server,</span><a href="#bookmark8272"><span class="font24"> 33</span></a></p>
<p><span class="font24">ps(1), 217</span></p>
<p><span class="font24">PTR (DNS record), 67</span></p>
<p><span class="font24">public key, </span><a href="#bookmark9205"><span class="font24">232</span></a></p>
<p><span class="font7" style="font-weight:bold;">Q</span></p>
<p><span class="font24">query (dns), 61</span></p>
<p><span class="font7" style="font-weight:bold;">R</span></p>
<p><span class="font24">read list (Samba),</span><a href="#bookmark8947"><span class="font24"> 181</span></a></p>
<p><span class="font24">read only (Samba),</span><a href="#bookmark8823"><span class="font24"> 164</span></a></p>
<p><span class="font24">recursive query, 70</span></p>
<p><span class="font24">reverse lookup query, 61</span></p>
<p><span class="font24">roaming profiles(samba), </span><a href="#bookmark9113"><span class="font24">200</span></a></p>
<p><span class="font24">role(selinux), 214</span></p>
<p><span class="font24">root(DNS), 63</span></p>
<p><span class="font24">root(mysql), </span><a href="#bookmark8326"><span class="font24">44</span></a></p>
<p><span class="font24">root hints, 64</span></p>
<p><span class="font24">root server (dns), 69</span></p>
<p><span class="font24">root servers (dns), 63</span></p>
<p><span class="font24">router, 114</span></p>
<p><span class="font24">rpm,</span><a href="#bookmark8619"><span class="font24"> 138</span></a></p>
<p><span class="font24">rpm(1), </span><a href="#bookmark8332"><span class="font24">44</span></a></p>
<p><span class="font24">rpm(8),</span><a href="#bookmark8629"><span class="font24"> 139</span></a></p>
<p><span class="font7" style="font-weight:bold;">S</span></p>
<p><span class="font24">samba,</span><a href="#bookmark8620"><span class="font24"> 138</span></a></p>
<p><span class="font24">secondary dns server, 71</span></p>
<p><span class="font24">secondary server (DNS), 73</span></p>
<p><span class="font24">security(Samba),</span><a href="#bookmark8769"><span class="font24"> 157</span></a></p>
<p><span class="font24">security mask(samba),</span><a href="#bookmark8983"><span class="font24"> 183</span></a></p>
<p><span class="font24">security mode(samba),</span><a href="#bookmark8891"><span class="font24"> 174</span></a><span class="font24"> select(mysql),</span><a href="#bookmark8438"><span class="font24"> 51</span></a><span class="font24">, </span><a href="#bookmark8448"><span class="font24">52</span></a><span class="font24">,</span><a href="#bookmark8453"><span class="font24"> 52</span></a></p>
<p><span class="font24">SELinux, 209</span></p>
<p><span class="font24">selinux, 212</span></p>
<p><span class="font24">selinux-activate, 210</span></p>
<p><span class="font24">service(8),</span><a href="#bookmark8646"><span class="font24"> 141</span></a></p>
<p><span class="font24">sestatus, 212</span></p>
<p><span class="font24">setenforce, 211</span></p>
<p><span class="font24">show(mysql), </span><a href="#bookmark8369"><span class="font24">47</span></a><span class="font24">, </span><a href="#bookmark8403"><span class="font24">49</span></a></p>
<p><span class="font24">slave server (DNS), 73</span></p>
<p><span class="font24">SMB,</span><a href="#bookmark8666"><span class="font24"> 143</span></a></p>
<p><span class="font24">smbclient,</span><a href="#bookmark8721"><span class="font24"> 149</span></a><span class="font24">,</span><a href="#bookmark8783"><span class="font24"> 158</span></a></p>
<p><span class="font24">smbclient(1),</span><a href="#bookmark8712"><span class="font24"> 148</span></a><span class="font24">,</span><a href="#bookmark8905"><span class="font24"> 175</span></a></p>
<p><span class="font24">smbd(8),</span><a href="#bookmark8652"><span class="font24"> 142</span></a><span class="font24">,</span><a href="#bookmark8682"><span class="font24"> 146</span></a><span class="font24">,</span><a href="#bookmark8862"><span class="font24"> 169</span></a></p>
<p><span class="font24">smbpasswd(1), </span><a href="#bookmark9116"><span class="font24">201</span></a></p>
<p><span class="font24">smbpasswd(8),</span><a href="#bookmark8859"><span class="font24"> 169</span></a><span class="font24">,</span><a href="#bookmark8888"><span class="font24"> 174</span></a><span class="font24"> smbtree,</span><a href="#bookmark8727"><span class="font24"> 151</span></a></p>
</div><br clear="all">
<p><span class="font24">smbtree(1),</span><a href="#bookmark8726"><span class="font24"> 150</span></a></p>
<p><span class="font24">smtp, 67</span></p>
<p><span class="font24">SNAT, 115</span></p>
<p><span class="font24">soa (dns record), 71</span></p>
<p><span class="font24">SQL, </span><a href="#bookmark8318"><span class="font24">43</span></a><span class="font24">, </span><a href="#bookmark8431"><span class="font24">51</span></a></p>
<p><span class="font24">squid,</span><a href="#bookmark8275"><span class="font24"> 33</span></a></p>
<p><span class="font24">stateful firewall, 114</span></p>
<p><span class="font24">swat(8),</span><a href="#bookmark8742"><span class="font24"> 152</span></a></p>
<p><span class="font24">sysctl, 116</span></p>
<p><span class="font7" style="font-weight:bold;">T</span></p>
<p><span class="font24">tcpdump, 61, 118</span></p>
<p><span class="font24">tdbsam,</span><a href="#bookmark8867"><span class="font24"> 170</span></a><span class="font24">,</span><a href="#bookmark9073"><span class="font24"> 196</span></a><span class="font24">,</span><a href="#bookmark9105"><span class="font24"> 198</span></a></p>
<p><span class="font24">testparm(1),</span><a href="#bookmark8700"><span class="font24"> 147</span></a><span class="font24">,</span><a href="#bookmark8703"><span class="font24"> 147</span></a><span class="font24">,</span><a href="#bookmark8706"><span class="font24"> 148</span></a></p>
<p><span class="font24">tld, 65</span></p>
<p><span class="font24">TLD (dns), 65</span></p>
<p><span class="font24">top level domain, 65 transition(selinux), 216 trigger(mysql), </span><a href="#bookmark8512"><span class="font24">55</span></a><span class="font24"> triggers(mysql), </span><a href="#bookmark8335"><span class="font24">44</span></a><span class="font24"> type(selinux), 215</span></p>
<p><span class="font7" style="font-weight:bold;">U</span></p>
<p><span class="font24">update(mysql), </span><a href="#bookmark8445"><span class="font24">52</span></a><span class="font24"> use(mysql), </span><a href="#bookmark8390"><span class="font24">48</span></a></p>
<p><span class="font7" style="font-weight:bold;">V</span></p>
<p><span class="font24">valid users (Samba),</span><a href="#bookmark8941"><span class="font24"> 181</span></a></p>
<p><span class="font24">varchar(mysql), </span><a href="#bookmark8409"><span class="font24">49</span></a></p>
<p><span class="font24">virtualbox, 117</span></p>
<p><span class="font24">vmware, 117</span></p>
<p><span class="font7" style="font-weight:bold;">W</span></p>
<p><span class="font24">wbinfo(1),</span><a href="#bookmark9030"><span class="font24"> 190</span></a><span class="font24">,</span><a href="#bookmark9037"><span class="font24"> 191</span></a><span class="font24"> webalizer, </span><a href="#bookmark8228"><span class="font24">27</span></a></p>
<p><span class="font24">winbind(8),</span><a href="#bookmark9018"><span class="font24"> 190</span></a></p>
<p><span class="font24">winbind(samba),</span><a href="#bookmark9005"><span class="font24"> 188</span></a></p>
<p><span class="font24">winbindd(8),</span><a href="#bookmark8653"><span class="font24"> 142</span></a><span class="font24">,</span><a href="#bookmark8657"><span class="font24"> 142</span></a><span class="font24">,</span><a href="#bookmark9022"><span class="font24"> 190</span></a></p>
<p><span class="font24">wireshark, 118</span></p>
<p><span class="font24">workgroup,</span><a href="#bookmark8768"><span class="font24"> 157</span></a></p>
<p><span class="font24">writable (Samba),</span><a href="#bookmark8824"><span class="font24"> 164</span></a><span class="font24"> write list (Samba),</span><a href="#bookmark8950"><span class="font24"> 181</span></a></p>
<p><span class="font7" style="font-weight:bold;">X</span></p>
<p><span class="font24">xinetd(8),</span><a href="#bookmark8745"><span class="font24"> 152</span></a></p>
<p><span class="font7" style="font-weight:bold;">Y</span></p>
<p><span class="font24">yum,</span><a href="#bookmark8630"><span class="font24"> 139</span></a></p>
<p><span class="font7" style="font-weight:bold;">Z</span></p>
<p><span class="font24">zone (dns), 66, 71</span></p>
<p><span class="font24">zone transfer (dns), 71</span></p>
<p><span class="font11" style="font-weight:bold;">Linux Security</span></p>
<p><span class="font9" style="font-weight:bold;">Paul Cobbaut</span></p>
<p><span class="font7" style="font-weight:bold;">Linux Security</span></p>
<p><span class="font24">Paul Cobbaut</span></p>
<p><span class="font24">Paul Cobbaut</span></p>
<p><span class="font24">Publication date 2015-05-24 CEST</span></p>
<p><span class="font4" style="font-weight:bold;">Abstract</span></p>
<p><span class="font25">This book is meant to be used in an instructor-led training. For self-study, the intent is to read this book next to a working Linux computer so you can immediately do every subject, practicing each command.</span></p>
<p><span class="font25">This book is aimed at novice Linux system administrators (and might be interesting and useful for home users that want to know a bit more about their Linux system). However, this book is not meant as an introduction to Linux desktop applications like text editors, browsers, mail clients, multimedia or office applications.</span></p>
<p><span class="font25">More information and free .pdf available at </span><a href="http://linux-training.be"><span class="font25" style="font-weight:bold;">http://linux-training.be</span></a><span class="font25" style="font-weight:bold;"> </span><span class="font25">.</span></p>
<p><span class="font25">Feel free to contact the author:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">• Paul Cobbaut: </span><a href="mailto:paul.cobbaut@gmail.com"><span class="font25">paul.cobbaut@gmail.com</span></a><span class="font25">, </span><a href="http://www.linkedin.com/in/cobbaut"><span class="font25">http://www.linkedin.com/in/cobbaut</span></a></p></li></ul>
<p><span class="font25">Contributors to the Linux Training project are:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">• Serge van Ginderachter: </span><a href="mailto:serge@ginsys.be"><span class="font25">serge@ginsys.be</span></a><span class="font25">, build scripts; infrastructure setup; minor stuff</span></p></li>
<li>
<p><span class="font25">• Hendrik De Vloed: </span><a href="mailto:hendrik.devloed@ugent.be"><span class="font25">hendrik.devloed@ugent.be</span></a><span class="font25">, buildheader.pl script</span></p></li></ul>
<p><span class="font25">We'd also like to thank our reviewers:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">• Wouter Verhelst: </span><a href="mailto:wouter@grep.be"><span class="font25">wouter@grep.be</span></a><span class="font25">, </span><a href="http://grep.be"><span class="font25">http://grep.be</span></a></p></li>
<li>
<p><span class="font25">• Geert Goossens: </span><a href="mailto:mail.goossens.geert@gmail.com"><span class="font25">mail.goossens.geert@gmail.com</span></a><span class="font25">, </span><a href="http://www.linkedin.com/in/"><span class="font25">http://www.linkedin.com/in/</span></a><span class="font25"> geertgoossens</span></p></li>
<li>
<p><span class="font25">• Elie De Brauwer: </span><a href="mailto:elie@de-brauwer.be"><span class="font25">elie@de-brauwer.be</span></a><span class="font25">, </span><a href="http://www.de-brauwer.be"><span class="font25">http://www.de-brauwer.be</span></a></p></li>
<li>
<p><span class="font25">• Christophe Vandeplas: </span><a href="mailto:christophe@vandeplas.com"><span class="font25">christophe@vandeplas.com</span></a><span class="font25">, </span><a href="http://christophe.vandeplas.com"><span class="font25">http://christophe.vandeplas.com</span></a></p></li>
<li>
<p><span class="font25">• Bert Desmet: </span><a href="mailto:bert@devnox.be"><span class="font25">bert@devnox.be</span></a><span class="font25">, </span><a href="http://bdesmet.be"><span class="font25">http://bdesmet.be</span></a></p></li>
<li>
<p><span class="font25">• Rich Yonts: </span><a href="mailto:richyonts@gmail.com"><span class="font25">richyonts@gmail.com</span></a><span class="font25">,</span></p></li></ul>
<p><span class="font25">Copyright 2007-2015 Paul Cobbaut</span></p>
<p><span class="font25">Permission is granted to copy, distribute and/or modify this document under the terms of the </span><span class="font25" style="font-weight:bold;">GNU Free Documentation License</span><span class="font25">, Version 1.3 or any later version published by the Free Software Foundation; with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts. A copy of the license is included in the section entitled 'GNU Free Documentation License'.</span></p>
<h3><a name="bookmark9231"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9232"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9233"><span class="font24" style="font-weight:bold;">I. local user management </span><span class="font24">[</span><span class="font24" style="font-weight:bold;">REMOVED - CHECK SECTION - 1</span><span class="font24">]</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9234"><span class="font24" style="font-weight:bold;">1. introduction to users </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9235"><span class="font24">1.1. whoami </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9236"><span class="font24">1.2. who </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9237"><span class="font24">1.3. who am i </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9238"><span class="font24">1.4. w </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9239"><span class="font24">1.5. id </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9240"><span class="font24">1.6. su to another user </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9241"><span class="font24">1.7. su to root </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9242"><span class="font24">1.8. su as root </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9243"><span class="font24">1.9. su - $username </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9244"><span class="font24">1.10. su - </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9245"><span class="font24">1.11. run a program as another user </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9246"><span class="font24">1.12. visudo </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9247"><span class="font24">1.13. sudo su - </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9248"><span class="font24">1.14. sudo logging </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9249"><span class="font24">1.15. practice: introduction to users </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9250"><span class="font24">1.16. solution: introduction to users </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9251"><span class="font24" style="font-weight:bold;">2. user management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9252"><span class="font24">2.1. user management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9253"><span class="font24">2.2. /etc/passwd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9254"><span class="font24">2.3. root </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9255"><span class="font24">2.4. useradd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9256"><span class="font24">2.5. /etc/default/useradd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9257"><span class="font24">2.6. userdel </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9258"><span class="font24">2.7. usermod </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9259"><span class="font24">2.8. creating home directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9260"><span class="font24">2.9. /etc/skel/ </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9261"><span class="font24">2.10. deleting home directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9262"><span class="font24">2.11. login shell </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9263"><span class="font24">2.12. chsh </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9264"><span class="font24">2.13. practice: user management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9265"><span class="font24">2.14. solution: user management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9266"><span class="font24" style="font-weight:bold;">3. user passwords </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9267"><span class="font24">3.1. passwd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9268"><span class="font24">3.2. shadow file </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9269"><span class="font24">3.3. encryption with passwd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9270"><span class="font24">3.4. encryption with openssl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9271"><span class="font24">3.5. encryption with crypt </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9272"><span class="font24">3.6. /etc/login.defs </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9273"><span class="font24">3.7. chage </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9274"><span class="font24">3.8. disabling a password </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9275"><span class="font24">3.9. editing local files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9276"><span class="font24">3.10. practice: user passwords </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9277"><span class="font24">3.11. solution: user passwords </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9278"><span class="font24" style="font-weight:bold;">4. user profiles </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9279"><span class="font24">4.1. system profile </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9280"><span class="font24">4.2. ~/.bash_profile </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9281"><span class="font24">4.3. ~/.bash_login </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9282"><span class="font24">4.4. ~/.profile </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9283"><span class="font24">4.5. ~/.bashrc </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9284"><span class="font24">4.6. ~/.bash_logout </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9285"><span class="font24">4.7. Debian overview </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9286"><span class="font24">4.8. RHEL5 overview </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9287"><span class="font24">4.9. practice: user profiles </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9288"><span class="font24">4.10. solution: user profiles </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9289"><span class="font24" style="font-weight:bold;">5. groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9290"><span class="font24">5.1. groupadd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9291"><span class="font24">5.2. group file </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9292"><span class="font24">5.3. groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9293"><span class="font24">5.4. usermod </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9294"><span class="font24">5.5. groupmod </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9295"><span class="font24">5.6. groupdel </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9296"><span class="font24">5.7. gpasswd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9297"><span class="font24">5.8. newgrp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9298"><span class="font24">5.9. vigr </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9299"><span class="font24">5.10. practice: groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9300"><span class="font24">5.11. solution: groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9301"><span class="font24" style="font-weight:bold;">II. file security </span><span class="font24">[</span><span class="font24" style="font-weight:bold;">REMOVED - CHECK SECTION - 3</span><span class="font24">]</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9302"><span class="font24" style="font-weight:bold;">6. standard file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9303"><span class="font24">6.1. file ownership </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9304"><span class="font24">6.2. list of special files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9305"><span class="font24">6.3. permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9306"><span class="font24">6.4. practice: standard file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9307"><span class="font24">6.5. solution: standard file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9308"><span class="font24" style="font-weight:bold;">7. advanced file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9309"><span class="font24">7.1. sticky bit on directory </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9310"><span class="font24">7.2. setgid bit on directory </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9311"><span class="font24">7.3. setgid and setuid on regular files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9312"><span class="font24">7.4. setuid on sudo </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9313"><span class="font24">7.5. practice: sticky, setuid and setgid bits </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9314"><span class="font24">7.6. solution: sticky, setuid and setgid bits </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9315"><span class="font24" style="font-weight:bold;">8. access control lists </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9316"><span class="font24">8.1. acl in /etc/fstab </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9317"><span class="font24">8.2. getfacl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9318"><span class="font24">8.3. setfacl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9319"><span class="font24">8.4. remove an acl entry </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9320"><span class="font24">8.5. remove the complete acl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9321"><span class="font24">8.6. the acl mask </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9322"><span class="font24">8.7. eiciel </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9323"><span class="font24" style="font-weight:bold;">9. file links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9324"><span class="font24">9.1. inodes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9325"><span class="font24">9.2. about directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9326"><span class="font24">9.3. hard links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9327"><span class="font24">9.4. symbolic links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9328"><span class="font24">9.5. removing links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9329"><span class="font24">9.6. practice : links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9330"><span class="font24">9.7. solution : links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9331"><span class="font24" style="font-weight:bold;">III. iptables firewall </span><span class="font24">[</span><span class="font24" style="font-weight:bold;">REMOVED - CHECK SECTION - 3</span><span class="font24">]</span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9332"><span class="font24" style="font-weight:bold;">10. introduction to routers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9333"><span class="font24">10.1. router or firewall </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9334"><span class="font24">10.2. packet forwarding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9335"><span class="font24">10.3. packet filtering </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9336"><span class="font24">10.4. stateful </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9337"><span class="font24">10.5. nat (network address translation) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9338"><span class="font24">10.6. pat (port address translation) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9339"><span class="font24">10.7. snat (source nat) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9340"><span class="font24">10.8. masquerading </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9341"><span class="font24">10.9. dnat (destination nat) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9342"><span class="font24">10.10. port forwarding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9343"><span class="font24">10.11. /proc/sys/net/ipv4/ip_forward </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9344"><span class="font24">10.12. /etc/sysctl.conf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9345"><span class="font24">10.13. sysctl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9346"><span class="font24">10.14. practice: packet forwarding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9347"><span class="font24">10.15. solution: packet forwarding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9348"><span class="font24" style="font-weight:bold;">11. iptables firewall </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9349"><span class="font24">11.1. iptables tables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9350"><span class="font24">11.2. starting and stopping iptables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9351"><span class="font24">11.3. the filter table </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9352"><span class="font24">11.4. practice: packet filtering </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9353"><span class="font24">11.5. solution: packet filtering </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9354"><span class="font24">11.6. network address translation </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9355"><span class="font24">IV. selinux </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9356"><span class="font24" style="font-weight:bold;">12. introduction to SELinux </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9357"><span class="font24">12.1. selinux modes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9358"><span class="font24">12.2. logging </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9359"><span class="font24">12.3. activating selinux </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9360"><span class="font24">12.4. getenforce </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9361"><span class="font24">12.5. setenforce </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9362"><span class="font24">12.6. sestatus </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9363"><span class="font24">12.7. policy </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9364"><span class="font24">12.8. /etc/selinux/config </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9365"><span class="font24">12.9. DAC or MAC </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9366"><span class="font24">12.10. ls -Z </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9367"><span class="font24">12.11. -Z </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9368"><span class="font24">12.12. /selinux </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9369"><span class="font24">12.13. identity </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9370"><span class="font24">12.14. role </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9371"><span class="font24">12.15. type (or domain) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9372"><span class="font24">12.16. security context </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9373"><span class="font24">12.17. transition </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9374"><span class="font24">12.18. extended attributes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9375"><span class="font24">12.19. process security context </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9376"><span class="font24">12.20. chcon </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9377"><span class="font24">12.21. an example </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9378"><span class="font24">12.22. setroubleshoot </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9379"><span class="font24">12.23. booleans </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9380"><span class="font24">V. Appendix </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9381"><span class="font24" style="font-weight:bold;">A. License </span></a></p></li></ul>
<p><a href="#bookmark9382"><span class="font24">Index </span></a></p>
<h3><a name="bookmark9383"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9384"></a>List of Tables</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9385"><span class="font24">4.1. Debian User Environment </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9386"><span class="font24">4.2. Red Hat User Environment </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9387"><span class="font24">6.1. Unix special files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9388"><span class="font24">6.2. standard Unix file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9389"><span class="font24">6.3. Unix file permissions position </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9390"><span class="font24">6.4. Octal permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9391"><span class="font24">10.1. Packet Forwarding Exercise </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9392"><span class="font24">10.2. Packet Forwarding Solution </span></a></p></li></ul>
<p><a name="bookmark9393"></a><span class="font11" style="font-weight:bold;">Part I. local user management</span></p>
<h3><a name="bookmark9394"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9395"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9396"><span class="font24" style="font-weight:bold;">1. introduction to users </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9397"><span class="font24">1.1. whoami </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9398"><span class="font24">1.2. who </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9399"><span class="font24">1.3. who am i </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9400"><span class="font24">1.4. w </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9401"><span class="font24">1.5. id </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9402"><span class="font24">1.6. su to another user </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9403"><span class="font24">1.7. su to root </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9404"><span class="font24">1.8. su as root </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9405"><span class="font24">1.9. su - $username </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9406"><span class="font24">1.10. su - </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9407"><span class="font24">1.11. run a program as another user </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark6270"><span class="font24">1.12. visudo </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9408"><span class="font24">1.13. sudo su - </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9409"><span class="font24">1.14. sudo logging </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9410"><span class="font24">1.15. practice: introduction to users </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9411"><span class="font24">1.16. solution: introduction to users </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9412"><span class="font24" style="font-weight:bold;">2. user management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9413"><span class="font24">2.1. user management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9414"><span class="font24">2.2. /etc/passwd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9415"><span class="font24">2.3. root </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9416"><span class="font24">2.4. useradd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9417"><span class="font24">2.5. /etc/default/useradd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9418"><span class="font24">2.6. userdel </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9419"><span class="font24">2.7. usermod </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9420"><span class="font24">2.8. creating home directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9421"><span class="font24">2.9. /etc/skel/ </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9422"><span class="font24">2.10. deleting home directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9423"><span class="font24">2.11. login shell </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9424"><span class="font24">2.12. chsh </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9425"><span class="font24">2.13. practice: user management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9426"><span class="font24">2.14. solution: user management </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9427"><span class="font24" style="font-weight:bold;">3. user passwords </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9428"><span class="font24">3.1. passwd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9429"><span class="font24">3.2. shadow file </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9430"><span class="font24">3.3. encryption with passwd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9431"><span class="font24">3.4. encryption with openssl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9432"><span class="font24">3.5. encryption with crypt </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9433"><span class="font24">3.6. /etc/login.defs </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9434"><span class="font24">3.7. chage </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9435"><span class="font24">3.8. disabling a password </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9436"><span class="font24">3.9. editing local files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9437"><span class="font24">3.10. practice: user passwords </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9438"><span class="font24">3.11. solution: user passwords </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9439"><span class="font24" style="font-weight:bold;">4. user profiles </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9440"><span class="font24">4.1. system profile </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9441"><span class="font24">4.2. ~/.bash_profile </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9442"><span class="font24">4.3. ~/.bash_login </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9443"><span class="font24">4.4. ~/.profile </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9444"><span class="font24">4.5. ~/.bashrc </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9445"><span class="font24">4.6. ~/.bash_logout </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9446"><span class="font24">4.7. Debian overview </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9447"><span class="font24">4.8. RHEL5 overview </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9448"><span class="font24">4.9. practice: user profiles </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9449"><span class="font24">4.10. solution: user profiles </span></a></p></li></ul>
<p><span class="font24">local user management</span></p>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9450"><span class="font24" style="font-weight:bold;">5. groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9451"><span class="font24">5.1. groupadd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9452"><span class="font24">5.2. group file </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9453"><span class="font24">5.3. groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9454"><span class="font24">5.4. usermod </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9455"><span class="font24">5.5. groupmod </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9456"><span class="font24">5.6. groupdel </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9457"><span class="font24">5.7. gpasswd </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9458"><span class="font24">5.8. newgrp </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9459"><span class="font24">5.9. vigr </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9460"><span class="font24">5.10. practice: groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9461"><span class="font24">5.11. solution: groups </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark9462"></a><span class="font11" style="font-weight:bold;"><a name="bookmark9234"></a><a name="bookmark9463"></a>Chapter 1. introduction to users</span></h1></li></ul>
<p><span class="font25">This little chapter will teach you how to identify your user account on a Unix computer using commands like </span><span class="font25" style="font-weight:bold;">who am i</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">id</span><span class="font25">, and more.</span></p>
<p><span class="font25">In a second part you will learn how to become another user with the </span><span class="font25" style="font-weight:bold;">su </span><span class="font25">command.</span></p>
<p><span class="font25">And you will learn how to run a program as another user with </span><span class="font25" style="font-weight:bold;">sudo</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9464"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9235"></a><a name="bookmark9465"></a>1.1. whoami</span></h2></li></ul>
<h4><a name="bookmark9466"></a><span class="font25"><a name="bookmark9467"></a><a name="bookmark9468"></a>The </span><span class="font25" style="font-weight:bold;">whoami </span><span class="font25">command tells you your username.</span></h4>
<p><span class="font19">[paul@centos7 ~]$ </span><span class="font19" style="font-weight:bold;">whoami</span></p>
<p><span class="font19">paul</span></p>
<p><span class="font19">[paul@centos7 ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9469"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9236"></a><a name="bookmark9470"></a>1.2. who</span></h2></li></ul>
<h4><a name="bookmark9471"></a><span class="font25"><a name="bookmark9472"></a><a name="bookmark9473"></a>The </span><span class="font25" style="font-weight:bold;">who </span><span class="font25">command will give you information about who is logged on the system.</span></h4>
<p><span class="font19">[paul@centos7 ~]$ </span><span class="font19" style="font-weight:bold;">who</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pts/0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2014-10-10</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">23:07</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">(10.104.33.101)</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">pts/1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2014-10-10</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">23:30</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">(10.104.33.101)</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">laura</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2014-10-10</span></p></td><td style="vertical-align:top;">
<p><span class="font19">23:34</span></p></td><td style="vertical-align:top;">
<p><span class="font19">(10.104.33.96)</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">tania</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2014-10-10</span></p></td><td style="vertical-align:top;">
<p><span class="font19">23:39</span></p></td><td style="vertical-align:top;">
<p><span class="font19">(10.104.33.91)</span></p></td></tr>
</table>
<p><span class="font19">[paul@centos7 ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9474"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9237"></a><a name="bookmark9475"></a>1.3. who am i</span></h2></li></ul>
<h4><a name="bookmark9476"></a><span class="font25"><a name="bookmark9477"></a><a name="bookmark9478"></a>With </span><span class="font25" style="font-weight:bold;">who am i </span><span class="font25">the </span><span class="font25" style="font-weight:bold;">who </span><span class="font25">command will display only the line pointing to your current session.</span></h4>
<p><span class="font19">[paul@centos7 ~]$ </span><span class="font19" style="font-weight:bold;">who am i</span></p>
<p><span class="font19">paul pts/1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2014-10-10 23:30 (10.104.33.101)</span></p>
<p><span class="font19">[paul@centos7 ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9479"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9238"></a><a name="bookmark9480"></a>1.4. w</span></h2></li></ul>
<h4><a name="bookmark9481"></a><span class="font25"><a name="bookmark9482"></a><a name="bookmark9483"></a>The </span><span class="font25" style="font-weight:bold;">w </span><span class="font25">command shows you who is logged on and what they are doing.</span></h4>
<p><span class="font19">[paul@centos7 ~]$ </span><span class="font19" style="font-weight:bold;">w</span></p>
<p><span class="font19">23:34:07 up 31 min, 2 users, load average: 0.00, 0.01, 0.02</span></p>
<p><span class="font19">USER TTY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGIN@ IDLE JCPU PCPU WHAT</span></p>
<p><span class="font19">root &nbsp;&nbsp;&nbsp;&nbsp;pts/0 &nbsp;&nbsp;&nbsp;&nbsp;23:07 &nbsp;&nbsp;15.00s &nbsp;0.01s &nbsp;0.01s top</span></p>
<p><span class="font19">paul &nbsp;&nbsp;&nbsp;&nbsp;pts/1 &nbsp;&nbsp;&nbsp;&nbsp;23:30 &nbsp;&nbsp;&nbsp;7.00s &nbsp;0.00s &nbsp;0.00s w</span></p>
<p><span class="font19">[paul@centos7 ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9484"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9239"></a><a name="bookmark9485"></a>1.5. id</span></h2></li></ul>
<h4><a name="bookmark9486"></a><span class="font25"><a name="bookmark9487"></a><a name="bookmark9488"></a>The </span><span class="font25" style="font-weight:bold;">id </span><span class="font25">command will give you your user id, primary group id, and a list of the groups that you belong to.</span></h4>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">id</span></p>
<p><span class="font19">uid=1000(paul) gid=1000(paul) groups=1000(paul)</span></p>
<h4><a name="bookmark9489"></a><span class="font25"><a name="bookmark9490"></a>On RHEL/CentOS you will also get </span><span class="font25" style="font-weight:bold;">SELinux </span><span class="font25">context information with this command.</span></h4>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">id</span></p>
<p><span class="font19">uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r\</span></p>
<p><span class="font19">:unconfined_t:s0-s0:c0.c1023</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9491"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9240"></a><a name="bookmark9492"></a>1.6. su to another user</span></h2></li></ul>
<p><a name="bookmark9493"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">su </span><span class="font25">command allows a user to run a shell as another user.</span></p>
<p><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">su tania</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">tania@debian7:/home/laura$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9494"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9241"></a><a name="bookmark9495"></a>1.7. su to root</span></h2></li></ul>
<p><a name="bookmark9496"></a><span class="font25">Yes you can also </span><span class="font25" style="font-weight:bold;">su </span><span class="font25">to become </span><span class="font25" style="font-weight:bold;">root</span><span class="font25">, when you know the </span><span class="font25" style="font-weight:bold;">root password</span><span class="font25">.</span></p>
<p><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">su root</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">root@debian7:/home/laura#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9497"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9242"></a><a name="bookmark9498"></a>1.8. su as root</span></h2></li></ul>
<p><span class="font25">You need to know the password of the user you want to substitute to, unless your are logged in as </span><span class="font25" style="font-weight:bold;">root</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">user can become any existing user without knowing that user's password.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">id</span></p>
<p><span class="font19">uid=0(root) gid=0(root) groups=0(root) root@debian7:~# </span><span class="font19" style="font-weight:bold;">su - valentina </span><span class="font19">valentina@debian7:~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9499"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9243"></a><a name="bookmark9500"></a>1.9. su - $username</span></h2></li></ul>
<p><a name="bookmark9501"></a><span class="font25">By default, the </span><span class="font25" style="font-weight:bold;">su </span><span class="font25">command maintains the same shell environment. To become another user and also get the target user's environment, issue the </span><span class="font25" style="font-weight:bold;">su - </span><span class="font25">command followed by the target username.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">su laura</span></p>
<p><span class="font19">laura@debian7:/root$ </span><span class="font19" style="font-weight:bold;">exit</span></p>
<p><span class="font19">exit</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">su - laura</span></p>
<p><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">pwd </span><span class="font19">/home/laura</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9502"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9244"></a><a name="bookmark9503"></a>1.10. su -</span></h2></li></ul>
<p><span class="font25">When no username is provided to </span><span class="font25" style="font-weight:bold;">su </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">su -</span><span class="font25">, the command will assume </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">is the target.</span></p>
<p><span class="font19">tania@debian7:~$ </span><span class="font19" style="font-weight:bold;">su -</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9504"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9245"></a><a name="bookmark9505"></a>1.11. run a program as another user</span></h2></li></ul>
<p><a name="bookmark9506"></a><span class="font25">The sudo program allows a user to start a program with the credentials of another user. Before this works, the system administrator has to set up the </span><span class="font25" style="font-weight:bold;">/etc/sudoers </span><span class="font25">file. This can be useful to delegate administrative tasks to another user (without giving the root password).</span></p>
<p><a name="bookmark9507"></a><span class="font25"><a name="bookmark9508"></a>The screenshot below shows the usage of </span><span class="font25" style="font-weight:bold;">sudo</span><span class="font25">. User </span><span class="font25" style="font-weight:bold;">paul </span><span class="font25">received the right to run </span><span class="font25" style="font-weight:bold;">useradd </span><span class="font25">with the credentials of </span><span class="font25" style="font-weight:bold;">root</span><span class="font25">. This allows </span><span class="font25" style="font-weight:bold;">paul </span><span class="font25">to create new users on the system without becoming </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">and without knowing the </span><span class="font25" style="font-weight:bold;">root password</span><span class="font25">.</span></p>
<p><span class="font25">First the command fails for </span><span class="font25" style="font-weight:bold;">paul</span><span class="font25">.</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">/usr/sbin/useradd -m valentina </span><span class="font19">useradd: Permission denied.</span></p>
<p><span class="font19">useradd: cannot lock /etc/passwd; try again later.</span></p>
<p><span class="font25">But with </span><span class="font25" style="font-weight:bold;">sudo </span><span class="font25">it works.</span></p>
<p><span class="font19">paul@debian7:~$ </span><span class="font19" style="font-weight:bold;">sudo /usr/sbin/useradd -m valentina</span></p>
<p><span class="font19">[sudo] password for paul:</span></p>
<p><span class="font19">paul@debian7:~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9509"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9246"></a><a name="bookmark9510"></a>1.12. visudo</span></h2></li></ul>
<p><a name="bookmark9511"></a><span class="font25">Check the man page of </span><span class="font25" style="font-weight:bold;">visudo </span><span class="font25">before playing with the </span><span class="font25" style="font-weight:bold;">/etc/sudoers </span><span class="font25">file. Editing the </span><span class="font25" style="font-weight:bold;">sudoers </span><span class="font25">is out of scope for this fundamentals book.</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">apropos visudo</span></p>
<p><span class="font19">visudo &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(8) &nbsp;- edit the sudoers file</span></p>
<p><span class="font19">paul@rhel65:~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9512"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9247"></a><a name="bookmark9513"></a>1.13. sudo su -</span></h2></li></ul>
<p><a name="bookmark9514"></a><span class="font25"><a name="bookmark9515"></a><a name="bookmark9516"></a>On some Linux systems like Ubuntu and Xubuntu, the </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">user does not have a password set. This means that it is not possible to login as </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">(extra security). To perform tasks as </span><span class="font25" style="font-weight:bold;">root</span><span class="font25">, the first user is given all </span><span class="font25" style="font-weight:bold;">sudo rights </span><span class="font25">via the </span><span class="font25" style="font-weight:bold;">/etc/sudoers</span><span class="font25">. In fact all users that are members of the admin group can use sudo to run all commands as root.</span></p>
<p><span class="font19">root@laika:~# </span><span class="font19" style="font-weight:bold;">grep admin /etc/sudoers</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Members of the admin group may gain root privileges %admin ALL=(ALL) ALL</span></p></li></ul>
<p><a name="bookmark9517"></a><span class="font25">The end result of this is that the user can type </span><span class="font25" style="font-weight:bold;">sudo su - </span><span class="font25">and become root without having to enter the root password. The sudo command does require you to enter your own password. Thus the password prompt in the screenshot below is for sudo, not for su.</span></p>
<p><span class="font19">paul@laika:~$ </span><span class="font19" style="font-weight:bold;">sudo su -</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">root@laika:~#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9518"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9248"></a><a name="bookmark9519"></a>1.14. sudo logging</span></h2></li></ul>
<p><span class="font25">Using </span><span class="font25" style="font-weight:bold;">sudo </span><span class="font25">without authorization will result in a severe warning:</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">sudo su -</span></p>
<p><span class="font19">We trust you have received the usual lecture from the local System Administrator. It usually boils down to these three things:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># 1) Respect the privacy of others.</span></p></li>
<li>
<p><span class="font19"># 2) Think before you type.</span></p></li>
<li>
<p><span class="font19"># 3) With great power comes great responsibility.</span></p></li></ul>
<p><span class="font19">[sudo] password for paul:</span></p>
<p><span class="font19">paul is not in the sudoers file. This incident will be reported. paul@rhel65:~$</span></p>
<p><span class="font25">The root user can see this in the </span><span class="font25" style="font-weight:bold;">/var/log/secure </span><span class="font25">on Red Hat and in </span><span class="font25" style="font-weight:bold;">/var/log/auth.log </span><span class="font25">on Debian).</span></p>
<p><span class="font19">root@rhel65:~# </span><span class="font19" style="font-weight:bold;">tail /var/log/secure | grep sudo | tr -s ' '</span></p>
<p><span class="font19">Apr 13 16:03:42 rhel65 sudo: paul : user NOT in sudoers ; TTY=pts/0 ; PWD=\ /home/paul ; USER=root ; COMMAND=/bin/su -</span></p>
<p><span class="font19">root@rhel65:~#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9520"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9249"></a><a name="bookmark9521"></a>1.15. practice: introduction to users</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Run a command that displays only your currently logged on user name.</span></p></li>
<li>
<p><span class="font25">2. Display a list of all logged on users.</span></p></li>
<li>
<p><span class="font25">3. Display a list of all logged on users including the command they are running at this very moment.</span></p></li>
<li>
<p><span class="font25">4. Display your user name and your unique user identification (userid).</span></p></li>
<li>
<p><span class="font25">5. Use </span><span class="font25" style="font-weight:bold;">su </span><span class="font25">to switch to another user account (unless you are root, you will need the password of the other account). And get back to the previous account.</span></p></li>
<li>
<p><span class="font25">6. Now use </span><span class="font25" style="font-weight:bold;">su - </span><span class="font25">to switch to another user and notice the difference.</span></p></li></ul>
<p><span class="font25">Note that </span><span class="font25" style="font-weight:bold;">su - </span><span class="font25">gets you into the home directory of </span><span class="font25" style="font-weight:bold;">Tania</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. Try to create a new user account (when using your normal user account). this should fail. (Details on adding user accounts are explained in the next chapter.)</span></p></li>
<li>
<p><span class="font25">8. Now try the same, but with </span><span class="font25" style="font-weight:bold;">sudo </span><span class="font25">before your command.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9522"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9250"></a><a name="bookmark9523"></a>1.16. solution: introduction to users</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark9524"></a><span class="font25"><a name="bookmark9525"></a>1. Run a command that displays only your currently logged on user name.</span></h4></li></ul>
<p><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">whoami </span><span class="font19">laura</span></p>
<p><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">echo $USER </span><span class="font19">laura</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark9526"></a><span class="font25"><a name="bookmark9527"></a>2. Display a list of all logged on users.</span></h4></li></ul>
<p><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">who</span></p>
<p><span class="font19">laura pts/0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2014-10-13 07:22 (10.104.33.101)</span></p>
<p><span class="font19">laura@debian7:~$</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark9528"></a><span class="font25"><a name="bookmark9529"></a>3. Display a list of all logged on users including the command they are running at this very moment.</span></h4></li></ul>
<p><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">w</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">07:47:</span></p></td><td style="vertical-align:top;">
<p><span class="font19">:02 up 16 min, 2 users,</span></p></td><td style="vertical-align:top;">
<p><span class="font19">load average</span></p></td><td style="vertical-align:top;">
<p><span class="font19">: 0.00,</span></p></td><td style="vertical-align:top;">
<p><span class="font19">, 0.00,</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">USER</span></p></td><td style="vertical-align:top;">
<p><span class="font19">TTY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM</span></p></td><td style="vertical-align:top;">
<p><span class="font19">LOGIN@</span></p></td><td style="vertical-align:top;">
<p><span class="font19">IDLE</span></p></td><td style="vertical-align:top;">
<p><span class="font19">JCPU</span></p></td><td style="vertical-align:top;">
<p><span class="font19">PCPU WHAT</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">pts/0 &nbsp;&nbsp;&nbsp;10.104.33.101</span></p></td><td style="vertical-align:top;">
<p><span class="font19">07:30</span></p></td><td style="vertical-align:top;">
<p><span class="font19">6.00s</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.04s</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00s w</span></p></td></tr>
<tr><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">root &nbsp;&nbsp;&nbsp;&nbsp;pts/1 &nbsp;&nbsp;&nbsp;10.104.33.101</span></p>
<p><span class="font19">laura@debian7:~$</span></p></td><td style="vertical-align:top;">
<p><span class="font19">07:46</span></p></td><td style="vertical-align:top;">
<p><span class="font19">6.00s</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.01s</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0.00s sleep 42</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h4><a name="bookmark9530"></a><span class="font25"><a name="bookmark9531"></a>4. Display your user name and your unique user identification (userid).</span></h4></li></ul>
<p><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">id</span></p>
<p><span class="font19">uid=1005(laura) gid=1007(laura) groups=1007(laura) laura@debian7:~$</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark9532"></a><span class="font25"><a name="bookmark9533"></a>5. Use </span><span class="font25" style="font-weight:bold;">su </span><span class="font25">to switch to another user account (unless you are root, you will need the password of the other account). And get back to the previous account.</span></h4></li></ul>
<p><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">su tania</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">tania@debian7:/home/laura$ </span><span class="font19" style="font-weight:bold;">id</span></p>
<p><span class="font19">uid=1006(tania) gid=1008(tania) groups=1008(tania)</span></p>
<p><span class="font19">tania@debian7:/home/laura$ </span><span class="font19" style="font-weight:bold;">exit</span></p>
<p><span class="font19">laura@debian7:~$</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark9534"></a><span class="font25"><a name="bookmark9535"></a>6. Now use </span><span class="font25" style="font-weight:bold;">su - </span><span class="font25">to switch to another user and notice the difference.</span></h4></li></ul>
<p><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">su - tania</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">tania@debian7:~$ </span><span class="font19" style="font-weight:bold;">pwd</span></p>
<p><span class="font19">/home/tania</span></p>
<p><span class="font19">tania@debian7:~$ </span><span class="font19" style="font-weight:bold;">logout</span></p>
<p><span class="font19">laura@debian7:~$</span></p>
<h4><a name="bookmark9536"></a><span class="font25"><a name="bookmark9537"></a>Note that </span><span class="font25" style="font-weight:bold;">su - </span><span class="font25">gets you into the home directory of </span><span class="font25" style="font-weight:bold;">Tania</span><span class="font25">.</span></h4>
<ul style="list-style:none;"><li>
<p><span class="font25">7. Try to create a new user account (when using your normal user account). this should fail. (Details on adding user accounts are explained in the next chapter.) </span><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">useradd valentina </span><span class="font19">-su: useradd: command not found laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">/usr/sbin/useradd valentina </span><span class="font19">useradd: Permission denied.</span></p></li></ul>
<p><span class="font19">useradd: cannot lock /etc/passwd; try again later.</span></p>
<p><span class="font25">It is possible that </span><span class="font25" style="font-weight:bold;">useradd </span><span class="font25">is located in </span><span class="font25" style="font-weight:bold;">/sbin/useradd </span><span class="font25">on your computer.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. Now try the same, but with </span><span class="font25" style="font-weight:bold;">sudo </span><span class="font25">before your command.</span></p></li></ul>
<p><span class="font19">laura@debian7:~$ </span><span class="font19" style="font-weight:bold;">sudo /usr/sbin/useradd valentina </span><span class="font19">[sudo] password for laura: laura is not in the sudoers file. This incident will be reported. laura@debian7:~$</span></p>
<p><span class="font25">Notice that </span><span class="font25" style="font-weight:bold;">laura </span><span class="font25">has no permission to use the </span><span class="font25" style="font-weight:bold;">sudo </span><span class="font25">on this system.</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark9538"></a><span class="font11" style="font-weight:bold;"><a name="bookmark9251"></a><a name="bookmark9539"></a>Chapter 2. user management</span></h1></li></ul>
<p><span class="font25">This chapter will teach you how to use </span><span class="font25" style="font-weight:bold;">useradd</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">usermod </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">userdel </span><span class="font25">to create, modify and remove user accounts.</span></p>
<p><span class="font25">You will need </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">access on a Linux computer to complete this chapter.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9540"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9252"></a><a name="bookmark9541"></a>2.1. user management</span></h2></li></ul>
<p><span class="font25">User management on Linux can be done in three complementary ways. You can use the </span><span class="font25" style="font-weight:bold;">graphical </span><span class="font25">tools provided by your distribution. These tools have a look and feel that depends on the distribution. If you are a novice Linux user on your home system, then use the graphical tool that is provided by your distribution. This will make sure that you do not run into problems.</span></p>
<p><span class="font25">Another option is to use </span><span class="font25" style="font-weight:bold;">command line tools </span><span class="font25">like useradd, usermod, gpasswd, passwd and others. Server administrators are likely to use these tools, since they are familiar and very similar across many different distributions. This chapter will focus on these command line tools.</span></p>
<p><span class="font25">A third and rather extremist way is to </span><span class="font25" style="font-weight:bold;">edit the local configuration files </span><span class="font25">directly using vi (or vipw/vigr). Do not attempt this as a novice on production systems!</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9542"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9253"></a><a name="bookmark9543"></a>2.2. /etc/passwd</span></h2></li></ul>
<p><a name="bookmark9544"></a><span class="font25">The local user database on Linux (and on most Unixes) is </span><span class="font25" style="font-weight:bold;">/etc/passwd</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">tail /etc/passwd</span></p>
<p><span class="font19">inge:x:518:524:art dealer:/home/inge:/bin/ksh ann:x:519:525:flute player:/home/ann:/bin/bash frederik:x:520:526:rubius poet:/home/frederik:/bin/bash steven:x:521:527:roman emperor:/home/steven:/bin/bash pascale:x:522:528:artist:/home/pascale:/bin/ksh geert:x:524:530:kernel developer:/home/geert:/bin/bash wim:x:525:531:master damuti:/home/wim:/bin/bash sandra:x:526:532:radish stresser:/home/sandra:/bin/bash annelies:x:527:533:sword fighter:/home/annelies:/bin/bash laura:x:528:534:art dealer:/home/laura:/bin/ksh</span></p>
<p><span class="font25">As you can see, this file contains seven columns separated by a colon. The columns contain the username, an x, the user id, the primary group id, a description, the name of the home directory, and the login shell.</span></p>
<p><span class="font25">More information can be found by typing </span><span class="font25" style="font-weight:bold;">man 5 passwd</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">man 5 passwd</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9545"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9254"></a><a name="bookmark9546"></a>2.3. root</span></h2></li></ul>
<p><a name="bookmark9547"></a><span class="font25"><a name="bookmark9548"></a>The </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">user also called the </span><span class="font25" style="font-weight:bold;">superuser </span><span class="font25">is the most powerful account on your Linux system. This user can do almost anything, including the creation of other users. The root user always has userid 0 (regardless of the name of the account).</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">head -1 /etc/passwd</span></p>
<p><span class="font19">root:x:0:0:root:/root:/bin/bash</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9549"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9255"></a><a name="bookmark9550"></a>2.4. useradd</span></h2></li></ul>
<p><a name="bookmark9551"></a><span class="font25">You can add users with the </span><span class="font25" style="font-weight:bold;">useradd </span><span class="font25">command. The example below shows how to add a user named yanina (last parameter) and at the same time forcing the creation of the home directory (-m), setting the name of the home directory (-d), and setting a description (-c).</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">useradd -m -d /home/yanina -c &quot;yanina wickmayer&quot; yanina </span><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">tail -1 /etc/passwd</span></p>
<p><span class="font19">yanina:x:529:529:yanina wickmayer:/home/yanina:/bin/bash</span></p>
<p><a name="bookmark9552"></a><span class="font25">The user named yanina received userid 529 and </span><span class="font25" style="font-weight:bold;">primary group </span><span class="font25">id 529.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9553"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9256"></a><a name="bookmark9554"></a>2.5. /etc/default/useradd</span></h2></li></ul>
<p><a name="bookmark9555"></a><span class="font25"><a name="bookmark9556"></a>Both Red Hat Enterprise Linux and Debian/Ubuntu have a file called </span><span class="font25" style="font-weight:bold;">/etc/default/useradd </span><span class="font25">that contains some default user options. Besides using cat to display this file, you can also use </span><span class="font25" style="font-weight:bold;">useradd -D</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL4 ~]# </span><span class="font19" style="font-weight:bold;">useradd -D</span></p>
<p><span class="font19">GROUP=100</span></p>
<p><span class="font19">HOME=/home</span></p>
<p><span class="font19">INACTIVE=-1</span></p>
<p><span class="font19">EXPIRE=</span></p>
<p><span class="font19">SHELL=/bin/bash</span></p>
<p><span class="font19">SKEL=/etc/skel</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9557"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9257"></a><a name="bookmark9558"></a>2.6. userdel</span></h2></li></ul>
<p><a name="bookmark9559"></a><span class="font25">You can delete the user yanina with </span><span class="font25" style="font-weight:bold;">userdel</span><span class="font25">. The -r option of userdel will also remove the home directory.</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">userdel -r yanina</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9560"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9258"></a><a name="bookmark9561"></a>2.7. usermod</span></h2></li></ul>
<p><a name="bookmark9562"></a><span class="font25">You can modify the properties of a user with the </span><span class="font25" style="font-weight:bold;">usermod </span><span class="font25">command. This example uses </span><span class="font25" style="font-weight:bold;">usermod </span><span class="font25">to change the description of the user harry.</span></p>
<p><span class="font19">[root@RHEL4 ~]# </span><span class="font19" style="font-weight:bold;">tail -1 /etc/passwd</span></p>
<p><span class="font19">harry:x:516:520:harry potter:/home/harry:/bin/bash</span></p>
<p><span class="font19">[root@RHEL4 ~]# </span><span class="font19" style="font-weight:bold;">usermod -c 'wizard' harry</span></p>
<p><span class="font19">[root@RHEL4 ~]# </span><span class="font19" style="font-weight:bold;">tail -1 /etc/passwd</span></p>
<p><span class="font19">harry:x:516:520:wizard:/home/harry:/bin/bash</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9563"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9259"></a><a name="bookmark9564"></a>2.8. creating home directories</span></h2></li></ul>
<p><a name="bookmark9565"></a><span class="font25">The easiest way to create a home directory is to supply the </span><span class="font25" style="font-weight:bold;">-m </span><span class="font25">option with </span><span class="font25" style="font-weight:bold;">useradd </span><span class="font25">(it is likely set as a default option on Linux).</span></p>
<p><a name="bookmark9566"></a><span class="font25"><a name="bookmark9567"></a><a name="bookmark9568"></a>A less easy way is to create a home directory manually with </span><span class="font25" style="font-weight:bold;">mkdir </span><span class="font25">which also requires setting the owner and the permissions on the directory with </span><span class="font25" style="font-weight:bold;">chmod </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">chown </span><span class="font25">(both commands are discussed in detail in another chapter).</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">mkdir /home/laura</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">chown laura:laura /home/laura</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">chmod 700 /home/laura</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">ls -ld /home/laura/</span></p>
<p><span class="font19">drwx------ 2 laura laura 4096 Jun 24 15:17 /home/laura/</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9569"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9260"></a><a name="bookmark9570"></a>2.9. /etc/skel/</span></h2></li></ul>
<p><a name="bookmark9571"></a><span class="font25">When using </span><span class="font25" style="font-weight:bold;">useradd </span><span class="font25">the </span><span class="font25" style="font-weight:bold;">-m </span><span class="font25">option, the </span><span class="font25" style="font-weight:bold;">/etc/skel/ </span><span class="font25">directory is copied to the newly created home directory. The </span><span class="font25" style="font-weight:bold;">/etc/skel/ </span><span class="font25">directory contains some (usually hidden) files that contain profile settings and default values for applications. In this way </span><span class="font25" style="font-weight:bold;">/etc/skel/ </span><span class="font25">serves as a default home directory and as a default user profile.</span></p>
<div>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">ls </span><span class="font19">total 48 drwxr-xr-x 2 root drwxr-xr-x 97 root -rw-r--r-- &nbsp;1 root</span></p>
<p><span class="font19">-rw-r--r-- &nbsp;1 root</span></p>
<p><span class="font19">-rw-r--r-- &nbsp;1 root</span></p>
</div><br clear="all">
<div>
<p><span class="font19" style="font-weight:bold;">-la /etc/skel/</span></p>
<p><span class="font19">root 4096 Apr 1 root 12288 Jun 24 root 24 Jul 12 root 176 Jul 12</span></p>
<p><span class="font19">root 124 Jul 12</span></p>
</div><br clear="all">
<div>
<p><span class="font19">00:11 .</span></p>
<p><span class="font19">15:36 ..</span></p>
<p><span class="font19">2006 .bash_logout</span></p>
<p><span class="font19">2006 .bash_profile</span></p>
<p><span class="font19">2006 .bashrc</span></p>
</div><br clear="all">
<ul style="list-style:none;"><li>
<h2><a name="bookmark9572"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9261"></a><a name="bookmark9573"></a>2.10. deleting home directories</span></h2></li></ul>
<p><a name="bookmark9574"></a><span class="font25">The -r option of </span><span class="font25" style="font-weight:bold;">userdel </span><span class="font25">will make sure that the home directory is deleted together with the user account.</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">ls -ld /home/wim/</span></p>
<p><span class="font19">drwx------ 2 wim wim 4096 Jun 24 15:19 /home/wim/</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">userdel -r wim</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">ls -ld /home/wim/</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">ls: /home/wim/: No such file or directory</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9575"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9262"></a><a name="bookmark9576"></a>2.11. login shell</span></h2></li></ul>
<p><a name="bookmark9577"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">/etc/passwd </span><span class="font25">file specifies the </span><span class="font25" style="font-weight:bold;">login shell </span><span class="font25">for the user. In the screenshot below you can see that user annelies will log in with the </span><span class="font25" style="font-weight:bold;">/bin/bash </span><span class="font25">shell, and user laura with the </span><span class="font25" style="font-weight:bold;">/bin/ksh </span><span class="font25">shell.</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">tail -2 /etc/passwd</span></p>
<p><span class="font19">annelies:x:527:533:sword fighter:/home/annelies:/bin/bash laura:x:528:534:art dealer:/home/laura:/bin/ksh</span></p>
<p><span class="font25">You can use the usermod command to change the shell for a user.</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">usermod -s /bin/bash laura</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">tail -1 /etc/passwd</span></p>
<p><span class="font19">laura:x:528:534:art dealer:/home/laura:/bin/bash</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9578"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9263"></a><a name="bookmark9579"></a>2.12. chsh</span></h2></li></ul>
<p><a name="bookmark9580"></a><span class="font25"><a name="bookmark9581"></a><a name="bookmark9582"></a>Users can change their login shell with the </span><span class="font25" style="font-weight:bold;">chsh </span><span class="font25">command. First, user harry obtains a list of available shells (he could also have done a </span><span class="font25" style="font-weight:bold;">cat /etc/shells</span><span class="font25">) and then changes his login shell to the </span><span class="font25" style="font-weight:bold;">Korn shell </span><span class="font25">(/bin/ksh). At the next login, harry will default into ksh instead of bash.</span></p>
<p><span class="font19">[laura@centos7 ~]$ </span><span class="font19" style="font-weight:bold;">chsh -l</span></p>
<p><span class="font19">/bin/sh</span></p>
<p><span class="font19">/bin/bash</span></p>
<p><span class="font19">/sbin/nologin</span></p>
<p><span class="font19">/usr/bin/sh</span></p>
<p><span class="font19">/usr/bin/bash</span></p>
<p><span class="font19">/usr/sbin/nologin</span></p>
<p><span class="font19">/bin/ksh</span></p>
<p><span class="font19">/bin/tcsh</span></p>
<p><span class="font19">/bin/csh</span></p>
<p><span class="font19">[laura@centos7 ~]$</span></p>
<p><span class="font25">Note that the </span><span class="font25" style="font-weight:bold;">-l </span><span class="font25">option does not exist on Debian and that the above screenshot assumes that </span><span class="font25" style="font-weight:bold;">ksh </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">csh </span><span class="font25">shells are installed.</span></p>
<p><span class="font25">The screenshot below shows how </span><span class="font25" style="font-weight:bold;">laura </span><span class="font25">can change her default shell (active on next login).</span></p>
<p><span class="font19">[laura@centos7 ~]$ </span><span class="font19" style="font-weight:bold;">chsh -s /bin/ksh</span></p>
<p><span class="font19">Changing shell for laura.</span></p>
<p><span class="font19">Password:</span></p>
<p><span class="font19">Shell changed.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9583"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9264"></a><a name="bookmark9584"></a>2.13. practice: user management</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create a user account named </span><span class="font25" style="font-weight:bold;">serena</span><span class="font25">, including a home directory and a description (or comment) that reads </span><span class="font25" style="font-weight:bold;">Serena Williams</span><span class="font25">. Do all this in one single command.</span></p></li>
<li>
<p><span class="font25">2. Create a user named </span><span class="font25" style="font-weight:bold;">venus</span><span class="font25">, including home directory, bash shell, a description that reads </span><span class="font25" style="font-weight:bold;">Venus Williams </span><span class="font25">all in one single command.</span></p></li>
<li>
<p><span class="font25">3. Verify that both users have correct entries in </span><span class="font25" style="font-weight:bold;">/etc/passwd</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">/etc/shadow </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/etc/group</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">4. Verify that their home directory was created.</span></p></li>
<li>
<p><span class="font25">5. Create a user named </span><span class="font25" style="font-weight:bold;">einstime </span><span class="font25">with </span><span class="font25" style="font-weight:bold;">/bin/date </span><span class="font25">as his default logon shell.</span></p></li>
<li>
<p><span class="font25">7. What happens when you log on with the </span><span class="font25" style="font-weight:bold;">einstime </span><span class="font25">user ? Can you think of a useful real world example for changing a user's login shell to an application ?</span></p></li>
<li>
<p><span class="font25">8. Create a file named </span><span class="font25" style="font-weight:bold;">welcome.txt </span><span class="font25">and make sure every new user will see this file in their home directory.</span></p></li>
<li>
<p><span class="font25">9. Verify this setup by creating (and deleting) a test user account.</span></p></li>
<li>
<p><span class="font25">10. Change the default login shell for the </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">user to </span><span class="font25" style="font-weight:bold;">/bin/bash</span><span class="font25">. Verify before and after you make this change.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9585"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9265"></a><a name="bookmark9586"></a>2.14. solution: user management</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create a user account named </span><span class="font25" style="font-weight:bold;">serena</span><span class="font25">, including a home directory and a description (or comment) that reads </span><span class="font25" style="font-weight:bold;">Serena Williams</span><span class="font25">. Do all this in one single command.</span></p></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">useradd -m -c 'Serena Williams' serena</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Create a user named </span><span class="font25" style="font-weight:bold;">venus</span><span class="font25">, including home directory, bash shell, a description that reads </span><span class="font25" style="font-weight:bold;">Venus Williams </span><span class="font25">all in one single command.</span></p></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">useradd -m -c &quot;Venus Williams&quot; -s /bin/bash venus</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Verify that both users have correct entries in </span><span class="font25" style="font-weight:bold;">/etc/passwd</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">/etc/shadow </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/etc/group</span><span class="font25">.</span></p></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">tail -2 /etc/passwd</span></p>
<p><span class="font19">serena:x:1008:1010:Serena Williams:/home/serena:/bin/sh</span></p>
<p><span class="font19">venus:x:1009:1011:Venus Williams:/home/venus:/bin/bash</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">tail -2 /etc/shadow</span></p>
<p><span class="font19">serena:!:16358:0:99999:7:::</span></p>
<p><span class="font19">venus:!:16358:0:99999:7:::</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">tail -2 /etc/group</span></p>
<p><span class="font19">serena:x:1010:</span></p>
<p><span class="font19">venus:x:1011:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Verify that their home directory was created.</span></p></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">ls -lrt /home | tail -2</span></p>
<p><span class="font19">drwxr-xr-x 2 serena &nbsp;&nbsp;&nbsp;serena &nbsp;&nbsp;&nbsp;4096 Oct 15 10:50 serena</span></p>
<p><span class="font19">drwxr-xr-x 2 venus &nbsp;&nbsp;&nbsp;&nbsp;venus &nbsp;&nbsp;&nbsp;&nbsp;4096 Oct 15 10:59 venus</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Create a user named </span><span class="font25" style="font-weight:bold;">einstime </span><span class="font25">with </span><span class="font25" style="font-weight:bold;">/bin/date </span><span class="font25">as his default logon shell.</span></p></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">useradd -s /bin/date einstime</span></p>
<p><span class="font25">Or even better:</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">useradd -s $(which date) einstime</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. What happens when you log on with the </span><span class="font25" style="font-weight:bold;">einstime </span><span class="font25">user ? Can you think of a useful real world example for changing a user's login shell to an application ?</span></p></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">su - einstime</span></p>
<p><span class="font19">Wed Oct 15 11:05:56 UTC 2014 # You get the output of the date command root@debian7:~#</span></p>
<p><span class="font25">It can be useful when users need to access only one application on the server. Just logging in opens the application for them, and closing the application automatically logs them out.</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark9587"></a><span class="font25"><a name="bookmark9588"></a>8. Create a file named </span><span class="font25" style="font-weight:bold;">welcome.txt </span><span class="font25">and make sure every new user will see this file in their home directory.</span></h4></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">echo Hello &gt;&nbsp;/etc/skel/welcome.txt</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark9589"></a><span class="font25"><a name="bookmark9590"></a>9. Verify this setup by creating (and deleting) a test user account.</span></h4></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">useradd -m test</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">ls -l /home/test</span></p>
<p><span class="font19">total 4</span></p>
<p><span class="font19">-rw-r--r-- 1 test test 6 Oct 15 11:16 welcome.txt</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">userdel -r test</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark9591"></a><span class="font25"><a name="bookmark9592"></a>10. Change the default login shell for the </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">user to </span><span class="font25" style="font-weight:bold;">/bin/bash</span><span class="font25">. Verify before and after you make this change.</span></h4></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep serena /etc/passwd</span></p>
<p><span class="font19">serena:x:1008:1010:Serena Williams:/home/serena:/bin/sh</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">usermod -s /bin/bash serena</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep serena /etc/passwd</span></p>
<p><span class="font19">serena:x:1008:1010:Serena Williams:/home/serena:/bin/bash</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark9593"></a><span class="font11" style="font-weight:bold;"><a name="bookmark9266"></a><a name="bookmark9594"></a>Chapter 3. user passwords</span></h1></li></ul>
<p><span class="font25">This chapter will tell you more about passwords for local users.</span></p>
<p><span class="font25">Three methods for setting passwords are explained; using the </span><span class="font25" style="font-weight:bold;">passwd </span><span class="font25">command, using </span><span class="font25" style="font-weight:bold;">openssel passwd</span><span class="font25">, and using the </span><span class="font25" style="font-weight:bold;">crypt </span><span class="font25">function in a C program.</span></p>
<p><span class="font25">The chapter will also discuss password settings and disabling, suspending or locking accounts.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9595"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9267"></a><a name="bookmark9596"></a>3.1. passwd</span></h2></li></ul>
<p><a name="bookmark9597"></a><span class="font25">Passwords of users can be set with the </span><span class="font25" style="font-weight:bold;">passwd </span><span class="font25">command. Users will have to provide their old password before twice entering the new one.</span></p>
<p><span class="font19">[tania@centos7 ~]$ </span><span class="font19" style="font-weight:bold;">passwd</span></p>
<p><span class="font19">Changing password for user tania.</span></p>
<p><span class="font19">Changing password for tania.</span></p>
<p><span class="font19">(current) UNIX password:</span></p>
<p><span class="font19">New password:</span></p>
<p><span class="font19">BAD PASSWORD: The password is shorter than 8 characters</span></p>
<p><span class="font19">New password:</span></p>
<p><span class="font19">BAD PASSWORD: The password is a palindrome</span></p>
<p><span class="font19">New password:</span></p>
<p><span class="font19">BAD PASSWORD: The password is too similar to the old one passwd: Have exhausted maximum number of retries for service</span></p>
<p><span class="font25">As you can see, the passwd tool will do some basic verification to prevent users from using too simple passwords. The </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">user does not have to follow these rules (there will be a warning though). The </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">user also does not have to provide the old password before entering the new password twice.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">passwd tania</span></p>
<p><span class="font19">Enter new UNIX password:</span></p>
<p><span class="font19">Retype new UNIX password:</span></p>
<p><span class="font19">passwd: password updated successfully</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9598"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9268"></a><a name="bookmark9599"></a>3.2. shadow file</span></h2></li></ul>
<p><a name="bookmark9600"></a><span class="font25"><a name="bookmark9601"></a>User passwords are encrypted and kept in </span><span class="font25" style="font-weight:bold;">/etc/shadow</span><span class="font25">. The /etc/shadow file is read only and can only be read by root. We will see in the file permissions section how it is possible for users to change their password. For now, you will have to know that users can change their password with the </span><span class="font25" style="font-weight:bold;">/usr/bin/passwd </span><span class="font25">command.</span></p>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">tail -4 /etc/shadow</span></p>
<p><span class="font19">paul:$6$ikp2Xta5BT.Tml.p$2TZjNnOYNNQKpwLJqoGJbVsZG5/Fti8ovBRd.VzRbiDSl7TEq\ IaSMH.TeBKnTS/SjlMruW8qffC0JNORW.BTW1:16338:0:99999:7:::</span></p>
<p><span class="font19">tania:$6$8Z/zovxj$9qvoqT8i9KIrmN.k4EQwAF5ryz5yzNwEvYjAa9L5XVXQu.z4DlpvMREH\ eQpQzvRnqFdKkVj17H5ST.c79HDZw0:16356:0:99999:7:::</span></p>
<p><span class="font19">laura:$6$glDuTY5e$/NYYWLxfHgZFWeoujaXSMcR.Mz.lGOxtcxFocFVJNb98nbTPhWFXfKWG\ SyYh1WCv6763Wq54.w24Yr3uAZBOm/:16356:0:99999:7:::</span></p>
<p><span class="font19">valentina:$6$jrZa6PVI$1uQgqR6En9mZB6mKJ3LXRB4CnFko6LRhbh.v4iqUk9MVreui1lv7\ GxHOUDSKA0N55ZRNhGHa6T2ouFnVno/0o1:16356:0:99999:7:::</span></p>
<p><span class="font19">[root@centos7 ~]#</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">/etc/shadow </span><span class="font25">file contains nine colon separated columns. The nine fields contain (from left to right) the user name, the encrypted password (note that only inge and laura have an encrypted password), the day the password was last changed (day 1 is January 1, 1970), number of days the password must be left unchanged, password expiry day, warning number of days before password expiry, number of days after expiry before disabling the account, and the day the account was disabled (again, since 1970). The last field has no meaning yet.</span></p>
<p><span class="font25">All the passwords in the screenshot above are hashes of </span><span class="font25" style="font-weight:bold;">hunter2</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9602"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9269"></a><a name="bookmark9603"></a>3.3. encryption with passwd</span></h2></li></ul>
<p><a name="bookmark9604"></a><span class="font25"><a name="bookmark9605"></a><a name="bookmark9606"></a>Passwords are stored in an encrypted format. This encryption is done by the </span><span class="font25" style="font-weight:bold;">crypt </span><span class="font25">function. The easiest (and recommended) way to add a user with a password to the system is to add the user with the </span><span class="font25" style="font-weight:bold;">useradd -m user </span><span class="font25">command, and then set the user's password with </span><span class="font25" style="font-weight:bold;">passwd</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL4 ~]# </span><span class="font19" style="font-weight:bold;">useradd -m xavier</span></p>
<p><span class="font19">[root@RHEL4 ~]# </span><span class="font19" style="font-weight:bold;">passwd xavier</span></p>
<p><span class="font19">Changing password for user xavier.</span></p>
<p><span class="font19">New UNIX password:</span></p>
<p><span class="font19">Retype new UNIX password:</span></p>
<p><span class="font19">passwd: all authentication tokens updated successfully.</span></p>
<p><span class="font19">[root@RHEL4 ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9607"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9270"></a><a name="bookmark9608"></a>3.4. encryption with openssl</span></h2></li></ul>
<p><a name="bookmark9609"></a><span class="font25">Another way to create users with a password is to use the -p option of useradd, but that option requires an encrypted password. You can generate this encrypted password with the </span><span class="font25" style="font-weight:bold;">openssl passwd </span><span class="font25">command.</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">openssl passwd </span><span class="font25">command will generate several distinct hashes for the same password, for this it uses a </span><span class="font25" style="font-weight:bold;">salt</span><span class="font25">.</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">openssl passwd hunter2</span></p>
<p><span class="font19">86jcUNlnGDFpY</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">openssl passwd hunter2</span></p>
<p><span class="font19">Yj7mDO9OAnvq6</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">openssl passwd hunter2</span></p>
<p><span class="font19">YqDcJeGoDbzKA</span></p>
<p><span class="font19">paul@rhel65:~$</span></p>
<p><span class="font25">This </span><span class="font25" style="font-weight:bold;">salt </span><span class="font25">can be chosen and is visible as the first two characters of the hash.</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">openssl passwd -salt 42 hunter2</span></p>
<p><span class="font19">42ZrbtP1Ze8G.</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">openssl passwd -salt 42 hunter2</span></p>
<p><span class="font19">42ZrbtP1Ze8G.</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">openssl passwd -salt 42 hunter2</span></p>
<p><span class="font19">42ZrbtP1Ze8G.</span></p>
<p><span class="font19">paul@rhel65:~$</span></p>
<p><span class="font25">This example shows how to create a user with password.</span></p>
<p><span class="font19">root@rhel65:~# </span><span class="font19" style="font-weight:bold;">useradd -m -p $(openssl passwd hunter2) mohamed</span></p>
<p><span class="font25" style="font-style:italic;">Note that this command puts the password in your command history!</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9610"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9271"></a><a name="bookmark9611"></a>3.5. encryption with crypt</span></h2></li></ul>
<p><span class="font25">A third option is to create your own C program using the crypt function, and compile this into a command.</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">cat MyCrypt.c</span></p>
<p><span class="font19">#include &lt;stdio.h&gt;</span></p>
<p><span class="font19">#define __USE_XOPEN</span></p>
<p><span class="font19">#include &lt;unistd.h&gt;</span></p>
<p><span class="font19">int main(int argc, char** argv)</span></p>
<p><span class="font19">{</span></p>
<p><span class="font19">if(argc==3)</span></p>
<p><span class="font19">{ printf(&quot;%s\n&quot;, crypt(argv[1],argv[2]));</span></p>
<p><span class="font19">} else { printf(&quot;Usage: MyCrypt $password $salt\n&quot; );</span></p>
<p><span class="font19">} return 0;</span></p>
<p><span class="font19">}</span></p>
<p><a name="bookmark9612"></a><span class="font25">This little program can be compiled with </span><span class="font25" style="font-weight:bold;">gcc </span><span class="font25">like this.</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">gcc MyCrypt.c -o MyCrypt -lcrypt</span></p>
<p><span class="font25">To use it, we need to give two parameters to MyCrypt. The first is the unencrypted password, the second is the salt. The salt is used to perturb the encryption algorithm in one of 4096 different ways. This variation prevents two users with the same password from having the same entry in </span><span class="font25" style="font-weight:bold;">/etc/shadow</span><span class="font25">.</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">./MyCrypt hunter2 42</span></p>
<p><span class="font19">42ZrbtP1Ze8G.</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">./MyCrypt hunter2 33 </span><span class="font19">33d6taYSiEUXI</span></p>
<p><a name="bookmark9613"></a><span class="font25">Did you notice that the first two characters of the password are the </span><span class="font25" style="font-weight:bold;">salt</span><span class="font25">?</span></p>
<p><a name="bookmark9614"></a><span class="font25">The standard output of the crypt function is using the DES algorithm which is old and can be cracked in minutes. A better method is to use </span><span class="font25" style="font-weight:bold;">md5 </span><span class="font25">passwords which can be recognized by a salt starting with $1$.</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">./MyCrypt hunter2 '$1$42'</span></p>
<p><span class="font19">$1$42$7l6Y3xT5282XmZrtDOF9f0</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">./MyCrypt hunter2 '$6$42'</span></p>
<p><span class="font19">$6$42$OqFFAVnI3gTSYG0yI9TZWX9cpyQzwIop7HwpG1LLEsNBiMr4w6OvLX1KDa./UpwXfrFk1i...</span></p>
<p><a name="bookmark9615"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">md5 </span><span class="font25">salt can be up to eight characters long. The salt is displayed in </span><span class="font25" style="font-weight:bold;">/etc/shadow </span><span class="font25">between the second and third $, so never use the password as the salt!</span></p>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">./MyCrypt hunter2 '$1$hunter2' </span><span class="font19">$1$hunter2$YVxrxDmidq7Xf8Gdt6qM2.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9616"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9272"></a><a name="bookmark9617"></a>3.6. /etc/login.defs</span></h2></li></ul>
<p><a name="bookmark9618"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">/etc/login.defs </span><span class="font25">file contains some default settings for user passwords like password aging and length settings. (You will also find the numerical limits of user ids and group ids and whether or not a home directory should be created by default).</span></p>
<p><span class="font19">root@rhel65:~# </span><span class="font19" style="font-weight:bold;">grep *PASS /etc/login.defs</span></p>
<p><span class="font19">PASS_MAX_DAYS 99999</span></p>
<p><span class="font19">PASS_MIN_DAYS 0</span></p>
<p><span class="font19">PASS_MIN_LEN 5</span></p>
<p><span class="font19">PASS WARN AGE 7</span></p>
<p><span class="font25">Debian also has this file.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep PASS /etc/login.defs</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># PASS_MAX_DAYS &nbsp;&nbsp;Maximum number of days a password may be used.</span></p></li>
<li>
<p><span class="font19"># PASS_MIN_DAYS &nbsp;&nbsp;Minimum number of days allowed between password changes.</span></p></li>
<li>
<p><span class="font19"># PASS_WARN_AGE &nbsp;&nbsp;Number of days warning given before a password expires.</span></p></li></ul>
<p><span class="font19">PASS_MAX_DAYS 99999</span></p>
<p><span class="font19">PASS_MIN_DAYS 0</span></p>
<p><span class="font19">PASS_WARN_AGE 7</span></p>
<p><span class="font19">#PASS_CHANGE_TRIES</span></p>
<p><span class="font19">#PASS_ALWAYS_WARN</span></p>
<p><span class="font19">#PASS_MIN_LEN</span></p>
<p><span class="font19">#PASS_MAX_LEN</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># NO_PASSWORD_CONSOLE</span></p></li></ul>
<p><span class="font19">root@debian7:~#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9619"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9273"></a><a name="bookmark9620"></a>3.7. chage</span></h2></li></ul>
<p><a name="bookmark9621"></a><span class="font25"><a name="bookmark9622"></a>The </span><span class="font25" style="font-weight:bold;">chage </span><span class="font25">command can be used to set an expiration date for a user account (-E), set a minimum (-m) and maximum (-M) password age, a password expiration date, and set the number of warning days before the password expiration date. Much of this functionality is also available from the </span><span class="font25" style="font-weight:bold;">passwd </span><span class="font25">command. The </span><span class="font25" style="font-weight:bold;">-l </span><span class="font25">option of chage will list these settings for a user.</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">root@rhel65:~#</span></p></td><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19" style="font-weight:bold;">chage -l paul</span></p></td></tr>
<tr><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">Last password change Password expires Password inactive Account expires</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Mar 27, 2014 never never never</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Minimum number</span></p></td><td style="vertical-align:top;">
<p><span class="font19">of days between password change</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Maximum number</span></p></td><td style="vertical-align:top;">
<p><span class="font19">of days between password change</span></p></td><td style="vertical-align:top;">
<p><span class="font19">99999</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">Number of days root@rhel65:~#</span></p></td><td style="vertical-align:top;">
<p><span class="font19">of warning before password expires</span></p></td><td style="vertical-align:top;">
<p><span class="font19">7</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9623"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9274"></a><a name="bookmark9624"></a>3.8. disabling a password</span></h2></li></ul>
<p><span class="font25">Passwords in </span><span class="font25" style="font-weight:bold;">/etc/shadow </span><span class="font25">cannot begin with an exclamation mark. When the second field in </span><span class="font25" style="font-weight:bold;">/etc/passwd </span><span class="font25">starts with an exclamation mark, then the password can not be used.</span></p>
<p><a name="bookmark9625"></a><span class="font25">Using this feature is often called </span><span class="font25" style="font-weight:bold;">locking</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">disabling</span><span class="font25">, or </span><span class="font25" style="font-weight:bold;">suspending </span><span class="font25">a user account. Besides </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">(or vipw) you can also accomplish this with </span><span class="font25" style="font-weight:bold;">usermod</span><span class="font25">.</span></p>
<p><span class="font25">The first command in the next screenshot will show the hashed password of </span><span class="font25" style="font-weight:bold;">laura </span><span class="font25">in </span><span class="font25" style="font-weight:bold;">/etc/ shadow</span><span class="font25">. The next command disables the password of </span><span class="font25" style="font-weight:bold;">laura</span><span class="font25">, making it impossible for Laura to authenticate using this password.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep laura /etc/shadow | cut -c1-70</span></p>
<p><span class="font19">laura:$6$JYj4JZqp$stwwWACp3OtE1R2aZuE87j.nbW.puDkNUYVk7mCHfCVMa3CoDUJV root@debian7:~# </span><span class="font19" style="font-weight:bold;">usermod -L laura</span></p>
<p><span class="font25">As you can see below, the password hash is simply preceded with an exclamation mark.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep laura /etc/shadow | cut -c1-70</span></p>
<p><span class="font19">laura:!$6$JYj4JZqp$stwwWACp3OtE1R2aZuE87j.nbW.puDkNUYVk7mCHfCVMa3CoDUJ root@debian7:~#</span></p>
<p><a name="bookmark9626"></a><span class="font25"><a name="bookmark9627"></a>The root user (and users with </span><span class="font25" style="font-weight:bold;">sudo </span><span class="font25">rights on </span><span class="font25" style="font-weight:bold;">su</span><span class="font25">) still will be able to </span><span class="font25" style="font-weight:bold;">su </span><span class="font25">into the </span><span class="font25" style="font-weight:bold;">laura </span><span class="font25">account (because the password is not needed here). Also note that </span><span class="font25" style="font-weight:bold;">laura </span><span class="font25">will still be able to login if she has set up passwordless ssh!</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">su - laura</span></p>
<p><span class="font19">laura@debian7:~$</span></p>
<p><a name="bookmark9628"></a><span class="font25">You can unlock the account again with </span><span class="font25" style="font-weight:bold;">usermod -U</span><span class="font25">.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">usermod -U laura</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep laura /etc/shadow | cut -c1-70</span></p>
<p><span class="font19">laura:$6$JYj4JZqp$stwwWACp3OtE1R2aZuE87j.nbW.puDkNUYVk7mCHfCVMa3CoDUJV</span></p>
<p><span class="font25">Watch out for tiny differences in the command line options of </span><span class="font25" style="font-weight:bold;">passwd</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">usermod</span><span class="font25">, and </span><span class="font25" style="font-weight:bold;">useradd </span><span class="font25">on different Linux distributions. Verify the local files when using features like </span><span class="font25" style="font-weight:bold;">&quot;disabling, suspending, or locking&quot; </span><span class="font25">on user accounts and their passwords.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9629"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9275"></a><a name="bookmark9630"></a>3.9. editing local files</span></h2></li></ul>
<p><a name="bookmark9631"></a><span class="font25"><a name="bookmark9632"></a><a name="bookmark9633"></a>If you still want to manually edit the </span><span class="font25" style="font-weight:bold;">/etc/passwd </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">/etc/shadow</span><span class="font25">, after knowing these commands for password management, then use </span><span class="font25" style="font-weight:bold;">vipw </span><span class="font25">instead of vi(m) directly. The </span><span class="font25" style="font-weight:bold;">vipw </span><span class="font25">tool will do proper locking of the file.</span></p>
<p><span class="font19">[root@RHEL5 ~]# </span><span class="font19" style="font-weight:bold;">vipw /etc/passwd</span></p>
<p><span class="font19">vipw: the password file is busy (/etc/ptmp present)</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9634"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9276"></a><a name="bookmark9635"></a>3.10. practice: user passwords</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Set the password for </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">to </span><span class="font25" style="font-weight:bold;">hunter2</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">2. Also set a password for </span><span class="font25" style="font-weight:bold;">venus </span><span class="font25">and then lock the </span><span class="font25" style="font-weight:bold;">venus </span><span class="font25">user account with </span><span class="font25" style="font-weight:bold;">usermod</span><span class="font25">. Verify the locking in </span><span class="font25" style="font-weight:bold;">/etc/shadow </span><span class="font25">before and after you lock it.</span></p></li>
<li>
<p><span class="font25">3. Use </span><span class="font25" style="font-weight:bold;">passwd -d </span><span class="font25">to disable the </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">password. Verify the </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">line in </span><span class="font25" style="font-weight:bold;">/etc/shadow </span><span class="font25">before and after disabling.</span></p></li>
<li>
<p><span class="font25">4. What is the difference between locking a user account and disabling a user account's password like we just did with </span><span class="font25" style="font-weight:bold;">usermod -L </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">passwd -d</span><span class="font25">?</span></p></li>
<li>
<p><span class="font25">5. Try changing the password of serena to serena as serena.</span></p></li>
<li>
<p><span class="font25">6. Make sure </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">has to change her password in 10 days.</span></p></li>
<li>
<p><span class="font25">7. Make sure every new user needs to change their password every 10 days.</span></p></li>
<li>
<p><span class="font25">8. Take a backup as root of </span><span class="font25" style="font-weight:bold;">/etc/shadow</span><span class="font25">. Use </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">to copy an encrypted </span><span class="font25" style="font-weight:bold;">hunter2 </span><span class="font25">hash from </span><span class="font25" style="font-weight:bold;">venus </span><span class="font25">to </span><span class="font25" style="font-weight:bold;">serena</span><span class="font25">. Can </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">now log on with </span><span class="font25" style="font-weight:bold;">hunter2 </span><span class="font25">as a password ?</span></p></li>
<li>
<p><span class="font25">9. Why use </span><span class="font25" style="font-weight:bold;">vipw </span><span class="font25">instead of </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">? What could be the problem when using </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">vim </span><span class="font25">?</span></p></li>
<li>
<p><span class="font25">10. Use </span><span class="font25" style="font-weight:bold;">chsh </span><span class="font25">to list all shells (only works on RHEL/CentOS/Fedora), and compare to </span><span class="font25" style="font-weight:bold;">cat / etc/shells</span><span class="font25">.</span></p></li>
<li>
<p><span class="font25">11. Which </span><span class="font25" style="font-weight:bold;">useradd </span><span class="font25">option allows you to name a home directory ?</span></p></li>
<li>
<p><span class="font25">12. How can you see whether the password of user </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">is locked or unlocked ? Give a solution with </span><span class="font25" style="font-weight:bold;">grep </span><span class="font25">and a solution with </span><span class="font25" style="font-weight:bold;">passwd</span><span class="font25">.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9636"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9277"></a><a name="bookmark9637"></a>3.11. solution: user passwords</span></h2></li></ul>
<ul style="list-style:none;"><li>
<h4><a name="bookmark9638"></a><span class="font25"><a name="bookmark9639"></a>1. Set the password for </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">to </span><span class="font25" style="font-weight:bold;">hunter2</span><span class="font25">.</span></h4></li></ul>
<p><span class="font19" style="font-weight:bold;">root@debian7:~# passwd serena</span></p>
<p><span class="font19">Enter new UNIX password:</span></p>
<p><span class="font19">Retype new UNIX password: passwd: password updated successfully</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark9640"></a><span class="font25"><a name="bookmark9641"></a>2. Also set a password for </span><span class="font25" style="font-weight:bold;">venus </span><span class="font25">and then lock the </span><span class="font25" style="font-weight:bold;">venus </span><span class="font25">user account with </span><span class="font25" style="font-weight:bold;">usermod</span><span class="font25">. Verify the locking in </span><span class="font25" style="font-weight:bold;">/etc/shadow </span><span class="font25">before and after you lock it.</span></h4></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">passwd venus</span></p>
<p><span class="font19">Enter new UNIX password:</span></p>
<p><span class="font19">Retype new UNIX password:</span></p>
<p><span class="font19">passwd: password updated successfully</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep venus /etc/shadow | cut -c1-70</span></p>
<p><span class="font19">venus:$6$gswzXICW$uSnKFV1kFKZmTPaMVS4AvNA/KO27OxN0v5LHdV9ed0gTyXrjUeM/ root@debian7:~# </span><span class="font19" style="font-weight:bold;">usermod -L venus</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep venus /etc/shadow | cut -c1-70</span></p>
<p><span class="font19">venus:!$6$gswzXICW$uSnKFV1kFKZmTPaMVS4AvNA/KO27OxN0v5LHdV9ed0gTyXrjUeM</span></p>
<h4><a name="bookmark9642"></a><span class="font25"><a name="bookmark9643"></a>Note that </span><span class="font25" style="font-weight:bold;">usermod -L </span><span class="font25">precedes the password hash with an exclamation mark (!).</span></h4>
<ul style="list-style:none;"><li>
<h4><a name="bookmark9644"></a><span class="font25"><a name="bookmark9645"></a>3. Use </span><span class="font25" style="font-weight:bold;">passwd -d </span><span class="font25">to disable the </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">password. Verify the </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">line in </span><span class="font25" style="font-weight:bold;">/etc/shadow </span><span class="font25">before and after disabling.</span></h4></li></ul>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep serena /etc/shadow | cut -c1-70</span></p>
<p><span class="font19">serena:$6$Es/omrPE$F2Ypu8kpLrfKdW0v/UIwA5jrYyBD2nwZ/dt.i/IypRgiPZSdB/B root@debian7:~# </span><span class="font19" style="font-weight:bold;">passwd -d serena </span><span class="font19">passwd: password expiry information changed.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep serena /etc/shadow</span></p>
<p><span class="font19">serena::16358:0:99999:7:::</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark9646"></a><span class="font25"><a name="bookmark9647"></a>4. What is the difference between locking a user account and disabling a user account's password like we just did with </span><span class="font25" style="font-weight:bold;">usermod -L </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">passwd -d</span><span class="font25">?</span></h4></li></ul>
<h4><a name="bookmark9648"></a><span class="font25"><a name="bookmark9649"></a>Locking will prevent the user from logging on to the system with his password by putting a ! in front of the password in </span><span class="font25" style="font-weight:bold;">/etc/shadow</span><span class="font25">.</span></h4>
<h4><a name="bookmark9650"></a><span class="font25"><a name="bookmark9651"></a>Disabling with </span><span class="font25" style="font-weight:bold;">passwd </span><span class="font25">will erase the password from </span><span class="font25" style="font-weight:bold;">/etc/shadow</span><span class="font25">.</span></h4>
<ul style="list-style:none;"><li>
<h4><a name="bookmark9652"></a><span class="font25"><a name="bookmark9653"></a>5. Try changing the password of serena to serena as serena.</span></h4></li></ul>
<p><span class="font19">log on as serena, then execute: passwd serena... it should fail!</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark9654"></a><span class="font25"><a name="bookmark9655"></a>6. Make sure </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">has to change her password in 10 days.</span></h4></li></ul>
<p><span class="font19">chage -M 10 serena</span></p>
<ul style="list-style:none;"><li>
<h4><a name="bookmark9656"></a><span class="font25"><a name="bookmark9657"></a>7. Make sure every new user needs to change their password every 10 days.</span></h4></li></ul>
<p><span class="font19">vi /etc/login.defs (and change PASS_MAX_DAYS to 10)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. Take a backup as root of </span><span class="font25" style="font-weight:bold;">/etc/shadow</span><span class="font25">. Use </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">to copy an encrypted </span><span class="font25" style="font-weight:bold;">hunter2 </span><span class="font25">hash from </span><span class="font25" style="font-weight:bold;">venus </span><span class="font25">to </span><span class="font25" style="font-weight:bold;">serena</span><span class="font25">. Can </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">now log on with </span><span class="font25" style="font-weight:bold;">hunter2 </span><span class="font25">as a password ?</span></p></li></ul>
<p><span class="font19">Yes.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">9. Why use </span><span class="font25" style="font-weight:bold;">vipw </span><span class="font25">instead of </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">? What could be the problem when using </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">vim </span><span class="font25">?</span></p></li></ul>
<p><span class="font19" style="font-weight:bold;">vipw </span><span class="font19">will give a warning when someone else is already using that file (with </span><span class="font19" style="font-weight:bold;">vipw</span><span class="font19">).</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">10. Use </span><span class="font25" style="font-weight:bold;">chsh </span><span class="font25">to list all shells (only works on RHEL/CentOS/Fedora), and compare to </span><span class="font25" style="font-weight:bold;">cat / etc/shells</span><span class="font25">.</span></p></li></ul>
<p><span class="font19">chsh -l</span></p>
<p><span class="font19">cat /etc/shells</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">11. Which </span><span class="font25" style="font-weight:bold;">useradd </span><span class="font25">option allows you to name a home directory ?</span></p></li></ul>
<p><span class="font19">-d</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">12. How can you see whether the password of user </span><span class="font25" style="font-weight:bold;">serena </span><span class="font25">is locked or unlocked ? Give a solution with </span><span class="font25" style="font-weight:bold;">grep </span><span class="font25">and a solution with </span><span class="font25" style="font-weight:bold;">passwd</span><span class="font25">.</span></p></li></ul>
<p><span class="font19">grep serena /etc/shadow</span></p>
<p><span class="font19">passwd -S serena</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark9658"></a><span class="font11" style="font-weight:bold;"><a name="bookmark9659"></a><a name="bookmark9660"></a>Chapter 4. user profiles</span></h1></li></ul>
<p><a name="bookmark9661"></a><span class="font25">Logged on users have a number of preset (and customized) aliases, variables, and functions, but where do they come from ? The </span><span class="font25" style="font-weight:bold;">shell </span><span class="font25">uses a number of startup files that are executed (or rather </span><span class="font25" style="font-weight:bold;">sourced</span><span class="font25">) whenever the shell is invoked. What follows is an overview of startup scripts.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9662"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9278"></a><a name="bookmark9663"></a>4.1. system profile</span></h2></li></ul>
<p><a name="bookmark9664"></a><span class="font25"><a name="bookmark9665"></a><a name="bookmark9666"></a>Both the </span><span class="font25" style="font-weight:bold;">bash </span><span class="font25">and the </span><span class="font25" style="font-weight:bold;">ksh </span><span class="font25">shell will verify the existence of </span><span class="font25" style="font-weight:bold;">/etc/profile </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">source </span><span class="font25">it if it exists.</span></p>
<p><a name="bookmark9667"></a><span class="font25">When reading this script, you will notice (both on Debian and on Red Hat Enterprise Linux) that it builds the PATH environment variable (among others). The script might also change the PS1 variable, set the HOSTNAME and execute even more scripts like </span><span class="font25" style="font-weight:bold;">/etc/inputrc</span></p>
<p><span class="font25">This screenshot uses grep to show PATH manipulation in </span><span class="font25" style="font-weight:bold;">/etc/profile </span><span class="font25">on Debian.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">grep PATH /etc/profile</span></p>
<p><span class="font19">PATH=&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot; PATH=&quot;/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games&quot;</span></p>
<p><span class="font19">export PATH</span></p>
<p><span class="font19">root@debian7:~#</span></p>
<p><span class="font25">This screenshot uses grep to show PATH manipulation in </span><span class="font25" style="font-weight:bold;">/etc/profile </span><span class="font25">on RHEL7/CentOS7.</span></p>
<p><span class="font19">[root@centos7 ~]# </span><span class="font19" style="font-weight:bold;">grep PATH /etc/profile</span></p>
<p><span class="font19">case &quot;:${PATH}:&quot; in</span></p>
<p><span class="font19">PATH=$PATH:$1</span></p>
<p><span class="font19">PATH=$1:$PATH</span></p>
<p><span class="font19">export PATH USER LOGNAME MAIL HOSTNAME HISTSIZE HISTCONTROL [root@centos7 ~]#</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">root user </span><span class="font25">can use this script to set aliases, functions, and variables for every user on the system.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9668"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9280"></a><a name="bookmark9669"></a>4.2. ~/.bash_profile</span></h2></li></ul>
<p><span class="font25">When this file exists in the home directory, then </span><span class="font25" style="font-weight:bold;">bash </span><span class="font25">will source it. On Debian Linux 5/6/7 this file does not exist by default.</span></p>
<p><a name="bookmark9670"></a><span class="font25"><a name="bookmark9671"></a>RHEL7/CentOS7 uses a small </span><span class="font25" style="font-weight:bold;">~/.bash_profile </span><span class="font25">where it checks for the existence of </span><span class="font25" style="font-weight:bold;">~/.bashrc </span><span class="font25">and then sources it. It also adds $HOME/bin to the $PATH variable.</span></p>
<p><span class="font19">[root@rhel7 ~]# </span><span class="font19" style="font-weight:bold;">cat /home/paul/.bash_profile</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># .bash_profile</span></p></li>
<li>
<p><span class="font19"># Get the aliases and functions</span></p></li></ul>
<p><span class="font19">if [ -f ~/.bashrc ]; then . ~/.bashrc</span></p>
<p><span class="font19">fi</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># User specific environment and startup programs</span></p></li></ul>
<p><span class="font19">PATH=$PATH:$HOME/.local/bin:$HOME/bin</span></p>
<p><span class="font19">export PATH</span></p>
<p><span class="font19">[root@rhel7 ~]#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9672"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9281"></a><a name="bookmark9673"></a>4.3. ~/.bash_login</span></h2></li></ul>
<p><a name="bookmark9674"></a><span class="font25">When </span><span class="font25" style="font-weight:bold;">.bash_profile </span><span class="font25">does not exist, then </span><span class="font25" style="font-weight:bold;">bash </span><span class="font25">will check for </span><span class="font25" style="font-weight:bold;">~/.bash_login </span><span class="font25">and source it.</span></p>
<p><span class="font25">Neither Debian nor Red Hat have this file by default.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9675"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9282"></a><a name="bookmark9676"></a>4.4. ~/.profile</span></h2></li></ul>
<p><span class="font25">When neither </span><span class="font25" style="font-weight:bold;">~/.bash_profile </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">~/.bash_login </span><span class="font25">exist, then bash will verify the existence of </span><span class="font25" style="font-weight:bold;">~/.profile </span><span class="font25">and execute it. This file does not exist by default on Red Hat.</span></p>
<p><a name="bookmark9677"></a><span class="font25">On Debian this script can execute </span><span class="font25" style="font-weight:bold;">~/.bashrc </span><span class="font25">and will add $HOME/bin to the $PATH variable.</span></p>
<p><span class="font19">root@debian7:~# </span><span class="font19" style="font-weight:bold;">tail -11 /home/paul/.profile </span><span class="font19">if [ -n &quot;$BASH_VERSION&quot; ]; then # include .bashrc if it exists if [ -f &quot;$HOME/.bashrc&quot; ]; then . &quot;$HOME/.bashrc&quot; fi fi</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># set PATH so it includes user's private bin if it exists if [ -d &quot;$HOME/bin&quot; ] ; then</span></p></li></ul>
<p><span class="font19">PATH=&quot;$HOME/bin:$PATH&quot; fi</span></p>
<p><span class="font25">RHEL/CentOS does not have this file by default.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9678"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9283"></a><a name="bookmark9679"></a>4.5. ~/.bashrc</span></h2></li></ul>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">~/.bashrc </span><span class="font25">script is often sourced by other scripts. Let us take a look at what it does by default.</span></p>
<p><a name="bookmark9680"></a><span class="font25">Red Hat uses a very simple </span><span class="font25" style="font-weight:bold;">~/.bashrc</span><span class="font25">, checking for </span><span class="font25" style="font-weight:bold;">/etc/bashrc </span><span class="font25">and sourcing it. It also leaves room for custom aliases and functions.</span></p>
<p><span class="font19">[root@rhel7 ~]# </span><span class="font19" style="font-weight:bold;">cat /home/paul/.bashrc </span><span class="font19"># .bashrc</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># Source global definitions if [ -f /etc/bashrc ]; then . /etc/bashrc fi</span></p></li>
<li>
<p><span class="font19"># Uncomment the following line if you don't like systemctl's auto-paging feature: # export SYSTEMD_PAGER=</span></p></li>
<li>
<p><span class="font19"># User specific aliases and functions</span></p></li></ul>
<p><span class="font25">On Debian this script is quite a bit longer and configures $PS1, some history variables and a number af active and inactive aliases.</span></p>
<p><span class="font19">root@debian7:~# wc -l /home/paul/.bashrc 110 /home/paul/.bashrc</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9681"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9284"></a><a name="bookmark9682"></a>4.6. ~/.bash_logout</span></h2></li></ul>
<h4><a name="bookmark9683"></a><span class="font25"><a name="bookmark9684"></a><a name="bookmark9685"></a>When exiting </span><span class="font25" style="font-weight:bold;">bash</span><span class="font25">, it can execute </span><span class="font25" style="font-weight:bold;">~/.bash_logout</span><span class="font25">.</span><br><br><span class="font25"><a name="bookmark9686"></a>Debian use this opportunity to clear the console screen.</span></h4>
<p><span class="font19">serena@deb503:~$ </span><span class="font19" style="font-weight:bold;">cat .bash_logout</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># ~/.bash_logout: executed by bash(1) when login shell exits.</span></p></li>
<li>
<p><span class="font19"># when leaving the console clear the screen to increase privacy</span></p></li></ul>
<p><span class="font19">if [ &quot;$SHLVL&quot; = 1 ]; then</span></p>
<p><span class="font19">[ -x /usr/bin/clear_console ] &amp;&amp;&nbsp;/usr/bin/clear_console -q</span></p>
<p><span class="font19">fi</span></p>
<h4><a name="bookmark9687"></a><span class="font25"><a name="bookmark9688"></a>Red Hat Enterprise Linux 5 will simple call the </span><span class="font25" style="font-weight:bold;">/usr/bin/clear </span><span class="font25">command in this script.</span></h4>
<p><span class="font19">[serena@rhel53 ~]$ cat .bash_logout</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># ~/.bash_logout</span></p></li></ul>
<p><span class="font19">/usr/bin/clear</span></p>
<h4><a name="bookmark9689"></a><span class="font25"><a name="bookmark9690"></a>Red Hat Enterprise Linux 6 and 7 create this file, but leave it empty (except for a comment).</span></h4>
<p><span class="font19">paul@rhel65:~$ </span><span class="font19" style="font-weight:bold;">cat .bash_logout</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># ~/.bash_logout</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9691"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9285"></a><a name="bookmark9692"></a>4.7. Debian overview</span></h2></li></ul>
<p><a name="bookmark9693"></a><span class="font25">Below is a table overview of when Debian is running any of these bash startup scripts.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 4.1. Debian User Environment</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">script</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">su</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">su -</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">ssh</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">gdm</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">~./bashrc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">no</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">~/.profile</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">no</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">/etc/profile</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">no</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font24">/etc/bash.bashrc</span></p></td><td style="vertical-align:middle;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:middle;">
<p><span class="font24">no</span></p></td><td style="vertical-align:middle;">
<p><span class="font24">no</span></p></td><td style="vertical-align:middle;">
<p><span class="font24">yes</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9694"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9286"></a><a name="bookmark9695"></a>4.8. RHEL5 overview</span></h2></li></ul>
<p><a name="bookmark9696"></a><span class="font25">Below is a table overview of when Red Hat Enterprise Linux 5 is running any of these bash startup scripts.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 4.2. Red Hat User Environment</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">script</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">su</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">su -</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">ssh</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">gdm</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">~./bashrc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">~/.bash_profile</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">no</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">/etc/profile</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">no</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">/etc/bashrc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">yes</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9697"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9287"></a><a name="bookmark9698"></a>4.9. practice: user profiles</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Make a list of all the profile files on your system.</span></p></li>
<li>
<p><span class="font25">2. Read the contents of each of these, often they </span><span class="font25" style="font-weight:bold;">source </span><span class="font25">extra scripts.</span></p></li>
<li>
<p><span class="font25">3. Put a unique variable, alias and function in each of those files.</span></p></li>
<li>
<p><span class="font25">4. Try several different ways to obtain a shell (su, su -, ssh, tmux, gnome-terminal, Ctrl-alt-F1, ...) and verify which of your custom variables, aliases and function are present in your environment.</span></p></li>
<li>
<p><span class="font25">5. Do you also know the order in which they are executed?</span></p></li>
<li>
<p><span class="font25">6. When an application depends on a setting in $HOME/.profile, does it matter whether $HOME/.bash_profile exists or not ?</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9699"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9288"></a><a name="bookmark9700"></a>4.10. solution: user profiles</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Make a list of all the profile files on your system.</span></p></li></ul>
<p><span class="font19">ls -a ~ </span><span class="font3" style="font-style:italic;">;</span><span class="font19"> ls -l /etc/pro* /etc/bash*</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Read the contents of each of these, often they </span><span class="font25" style="font-weight:bold;">source </span><span class="font25">extra scripts.</span></p></li>
<li>
<p><span class="font25">3. Put a unique variable, alias and function in each of those files.</span></p></li>
<li>
<p><span class="font25">4. Try several different ways to obtain a shell (su, su -, ssh, tmux, gnome-terminal, Ctrl-alt-F1, ...) and verify which of your custom variables, aliases and function are present in your environment.</span></p></li>
<li>
<p><span class="font25">5. Do you also know the order in which they are executed?</span></p></li></ul>
<p><span class="font19">same name aliases, functions and variables will overwrite each other</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. When an application depends on a setting in $HOME/.profile, does it matter whether $HOME/.bash_profile exists or not ?</span></p></li></ul>
<p><span class="font19">Yes it does matter. (man bash /INVOCATION)</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark9701"></a><span class="font11" style="font-weight:bold;"><a name="bookmark9702"></a><a name="bookmark9703"></a>Chapter 5. groups</span></h1></li></ul>
<p><a name="bookmark9704"></a><span class="font25">Users can be listed in </span><span class="font25" style="font-weight:bold;">groups</span><span class="font25">. Groups allow you to set permissions on the group level instead of having to set permissions for every individual user.</span></p>
<p><span class="font25">Every Unix or Linux distribution will have a graphical tool to manage groups. Novice users are advised to use this graphical tool. More experienced users can use command line tools to manage users, but be careful: Some distributions do not allow the mixed use of GUI and CLI tools to manage groups (YaST in Novell Suse). Senior administrators can edit the relevant files directly with </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">vigr</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9705"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9290"></a><a name="bookmark9706"></a>5.1. groupadd</span></h2></li></ul>
<p><a name="bookmark9707"></a><span class="font25">Groups can be created with the </span><span class="font25" style="font-weight:bold;">groupadd </span><span class="font25">command. The example below shows the creation of five (empty) groups.</span></p>
<p><span class="font19">root@laika:~# groupadd tennis</span></p>
<p><span class="font19">root@laika:~# groupadd football</span></p>
<p><span class="font19">root@laika:~# groupadd snooker</span></p>
<p><span class="font19">root@laika:~# groupadd formulal root@laika:~# groupadd salsa</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9708"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9291"></a><a name="bookmark9709"></a>5.2. group file</span></h2></li></ul>
<p><a name="bookmark9710"></a><span class="font25">Users can be a member of several groups. Group membership is defined by the </span><span class="font25" style="font-weight:bold;">/etc/group </span><span class="font25">file.</span></p>
<p><span class="font19">root@laika:~# tail -5 /etc/group</span></p>
<p><span class="font19">tennis:x:1006:</span></p>
<p><span class="font19">football:x:1007:</span></p>
<p><span class="font19">snooker:x:1008:</span></p>
<p><span class="font19">formula1:x:1009:</span></p>
<p><span class="font19">salsa:x:1010:</span></p>
<p><span class="font19">root@laika:~#</span></p>
<p><a name="bookmark9711"></a><span class="font25">The first field is the group's name. The second field is the group's (encrypted) password (can be empty). The third field is the group identification or </span><span class="font25" style="font-weight:bold;">GID</span><span class="font25">. The fourth field is the list of members, these groups have no members.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9712"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9289"></a><a name="bookmark9713"></a>5.3. groups</span></h2></li></ul>
<p><a name="bookmark9714"></a><span class="font25">A user can type the </span><span class="font25" style="font-weight:bold;">groups </span><span class="font25">command to see a list of groups where the user belongs to.</span></p>
<p><span class="font19">[harry@RHEL4b ~]$ groups harry sports</span></p>
<p><span class="font19">[harry@RHEL4b ~]$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9715"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9293"></a><a name="bookmark9716"></a>5.4. usermod</span></h2></li></ul>
<h4><a name="bookmark9717"></a><span class="font25"><a name="bookmark9718"></a><a name="bookmark9719"></a>Group membership can be modified with the useradd or </span><span class="font25" style="font-weight:bold;">usermod </span><span class="font25">command.</span></h4>
<p><span class="font19">root@laika:~# usermod -a -G tennis inge root@laika:~# usermod -a -G tennis katrien root@laika:~# usermod -a -G salsa katrien root@laika:~# usermod -a -G snooker sandra root@laika:~# usermod -a -G formulal annelies root@laika:~# tail -5 /etc/group tennis:x:1006:inge,katrien football:x:1007: snooker:x:1008:sandra formula1:x:1009:annelies salsa:x:1010:katrien root@laika:~#</span></p>
<h4><a name="bookmark9720"></a><span class="font25"><a name="bookmark9721"></a>Be careful when using </span><span class="font25" style="font-weight:bold;">usermod </span><span class="font25">to add users to groups. By default, the </span><span class="font25" style="font-weight:bold;">usermod </span><span class="font25">command will </span><span class="font25" style="font-weight:bold;">remove </span><span class="font25">the user from every group of which he is a member if the group is not listed in the command! Using the </span><span class="font25" style="font-weight:bold;">-a </span><span class="font25">(append) switch prevents this behaviour.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9722"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9292"></a><a name="bookmark9723"></a>5.5. groupmod</span></h2></li></ul>
<h4><a name="bookmark9724"></a><span class="font25"><a name="bookmark9725"></a><a name="bookmark9726"></a>You can change the group name with the </span><span class="font25" style="font-weight:bold;">groupmod </span><span class="font25">command.</span></h4>
<p><span class="font19">root@laika:~# groupmod -n darts snooker root@laika:~# tail -5 /etc/group tennis:x:1006:inge,katrien football:x:1007:</span></p>
<p><span class="font19">formula1:x:1009:annelies salsa:x:1010:katrien darts:x:1008:sandra</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9727"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9295"></a><a name="bookmark9728"></a>5.6. groupdel</span></h2></li></ul>
<h4><a name="bookmark9729"></a><span class="font25"><a name="bookmark9730"></a><a name="bookmark9731"></a>You can permanently remove a group with the </span><span class="font25" style="font-weight:bold;">groupdel </span><span class="font25">command.</span></h4>
<p><span class="font19">root@laika:~# groupdel tennis root@laika:~#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9732"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9296"></a><a name="bookmark9733"></a>5.7. gpasswd</span></h2></li></ul>
<h4><a name="bookmark9734"></a><span class="font25"><a name="bookmark9735"></a><a name="bookmark9736"></a><a name="bookmark9737"></a>You can delegate control of group membership to another user with the </span><span class="font25" style="font-weight:bold;">gpasswd </span><span class="font25">command. In the example below we delegate permissions to add and remove group members to serena for the sports group. Then we </span><span class="font25" style="font-weight:bold;">su </span><span class="font25">to serena and add harry to the sports group.</span></h4>
<p><span class="font19">[root@RHEL4b ~]# gpasswd -A serena sports</span></p>
<p><span class="font19">[root@RHEL4b ~]# su - serena</span></p>
<p><span class="font19">[serena@RHEL4b ~]$ id harry</span></p>
<p><span class="font19">uid=516(harry) gid=520(harry) groups=520(harry)</span></p>
<p><span class="font19">[serena@RHEL4b ~]$ gpasswd -a harry sports</span></p>
<p><span class="font19">Adding user harry to group sports</span></p>
<p><span class="font19">[serena@RHEL4b ~]$ id harry</span></p>
<p><span class="font19">uid=516(harry) gid=520(harry) groups=520(harry),522(sports)</span></p>
<p><span class="font19">[serena@RHEL4b ~]$ tail -1 /etc/group</span></p>
<p><span class="font19">sports:x:522:serena,venus,harry</span></p>
<p><span class="font19">[serena@RHEL4b ~]$</span></p>
<h4><a name="bookmark9738"></a><span class="font25"><a name="bookmark9739"></a>Group administrators do not have to be a member of the group. They can remove themselves from a group, but this does not influence their ability to add or remove members.</span></h4>
<p><span class="font19">[serena@RHEL4b ~]$ gpasswd -d serena sports</span></p>
<p><span class="font19">Removing user serena from group sports</span></p>
<p><span class="font19">[serena@RHEL4b ~]$ exit</span></p>
<h4><a name="bookmark9740"></a><span class="font25"><a name="bookmark9741"></a><a name="bookmark9742"></a>Information about group administrators is kept in the </span><span class="font25" style="font-weight:bold;">/etc/gshadow </span><span class="font25">file.</span></h4>
<p><span class="font19">[root@RHEL4b ~]# tail -1 /etc/gshadow</span></p>
<p><span class="font19">sports:!:serena:venus,harry</span></p>
<p><span class="font19">[root@RHEL4b ~]#</span></p>
<h4><a name="bookmark9743"></a><span class="font25"><a name="bookmark9744"></a>To remove all group administrators from a group, use the </span><span class="font25" style="font-weight:bold;">gpasswd </span><span class="font25">command to set an empty administrators list.</span></h4>
<p><span class="font19">[root@RHEL4b ~]# gpasswd -A &quot;&quot;&nbsp;sports</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9745"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9297"></a><a name="bookmark9746"></a>5.8. newgrp</span></h2></li></ul>
<h4><a name="bookmark9747"></a><span class="font25"><a name="bookmark9748"></a>You can start a </span><span class="font25" style="font-weight:bold;">child shell </span><span class="font25">with a new temporary </span><span class="font25" style="font-weight:bold;">primary group </span><span class="font25">using the </span><span class="font25" style="font-weight:bold;">newgrp </span><span class="font25">command.</span></h4>
<p><span class="font19">root@rhel65:~# mkdir prigroup</span></p>
<p><span class="font19">root@rhel65:~# cd prigroup/</span></p>
<p><span class="font19">root@rhel65:~/prigroup# touch standard.txt</span></p>
<p><span class="font19">root@rhel65:~/prigroup# ls -l</span></p>
<p><span class="font19">total 0</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-r--r--. 1 root root 0 Apr 13 17:49 standard.txt root@rhel65:~/prigroup# echo $SHLVL 1</span></p></li></ul>
<p><span class="font19">root@rhel65:~/prigroup# newgrp tennis</span></p>
<p><span class="font19">root@rhel65:~/prigroup# echo $SHLVL 2</span></p>
<p><span class="font19">root@rhel65:~/prigroup# touch newgrp.txt</span></p>
<p><span class="font19">root@rhel65:~/prigroup# ls -l</span></p>
<p><span class="font19">total 0</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-r--r--. 1 root tennis 0 Apr 13 17:49 newgrp.txt</span></p></li>
<li>
<p><span class="font19">- rw-r--r--. 1 root root 0 Apr 13 17:49 standard.txt root@rhel65:~/prigroup# exit exit</span></p></li></ul>
<p><span class="font19">root@rhel65:~/prigroup#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9749"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9298"></a><a name="bookmark9750"></a>5.9. vigr</span></h2></li></ul>
<h4><a name="bookmark9751"></a><span class="font25"><a name="bookmark9752"></a><a name="bookmark9753"></a><a name="bookmark9754"></a>Similar to vipw, the </span><span class="font25" style="font-weight:bold;">vigr </span><span class="font25">command can be used to manually edit the </span><span class="font25" style="font-weight:bold;">/etc/group </span><span class="font25">file, since it will do proper locking of the file. Only experienced senior administrators should use </span><span class="font25" style="font-weight:bold;">vi </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">vigr </span><span class="font25">to manage groups.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9755"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9299"></a><a name="bookmark9756"></a>5.10. practice: groups</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create the groups tennis, football and sports.</span></p></li>
<li>
<p><span class="font25">2. In one command, make venus a member of tennis and sports.</span></p></li>
<li>
<p><span class="font25">3. Rename the football group to foot.</span></p></li>
<li>
<p><span class="font25">4. Use vi to add serena to the tennis group.</span></p></li>
<li>
<p><span class="font25">5. Use the id command to verify that serena is a member of tennis.</span></p></li>
<li>
<p><span class="font25">6. Make someone responsible for managing group membership of foot and sports. Test that it works.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9757"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9300"></a><a name="bookmark9758"></a>5.11. solution: groups</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create the groups tennis, football and sports.</span></p></li></ul>
<p><span class="font19">groupadd tennis ; groupadd football ; groupadd sports</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. In one command, make venus a member of tennis and sports.</span></p></li></ul>
<p><span class="font19">usermod -a -G tennis,sports venus</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Rename the football group to foot. </span><span class="font19">groupmod -n foot football</span></p></li>
<li>
<p><span class="font25">4. Use vi to add serena to the tennis group.</span></p></li></ul>
<p><span class="font19">vi /etc/group</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Use the id command to verify that serena is a member of tennis.</span></p></li></ul>
<p><span class="font19">id (and after logoff logon serena should be member)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Make someone responsible for managing group membership of foot and sports. Test that it works.</span></p></li></ul>
<p><span class="font19">gpasswd -A (to make manager)</span></p>
<p><span class="font19">gpasswd -a (to add member)</span></p>
<p><a name="bookmark9759"></a><span class="font11" style="font-weight:bold;">Part II. file security</span></p>
<h3><a name="bookmark9760"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9761"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9762"><span class="font24" style="font-weight:bold;">6. standard file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9763"><span class="font24">6.1. file ownership </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9764"><span class="font24">6.2. list of special files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9765"><span class="font24">6.3. permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9766"><span class="font24">6.4. practice: standard file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9767"><span class="font24">6.5. solution: standard file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9768"><span class="font24" style="font-weight:bold;">7. advanced file permissions </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9769"><span class="font24">7.1. sticky bit on directory </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9770"><span class="font24">7.2. setgid bit on directory </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9771"><span class="font24">7.3. setgid and setuid on regular files </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9772"><span class="font24">7.4. setuid on sudo </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9773"><span class="font24">7.5. practice: sticky, setuid and setgid bits </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9774"><span class="font24">7.6. solution: sticky, setuid and setgid bits </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9775"><span class="font24" style="font-weight:bold;">8. access control lists </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark3739"><span class="font24">8.1. acl in /etc/fstab </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9776"><span class="font24">8.2. getfacl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9777"><span class="font24">8.3. setfacl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9778"><span class="font24">8.4. remove an acl entry </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9779"><span class="font24">8.5. remove the complete acl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9780"><span class="font24">8.6. the acl mask </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9781"><span class="font24">8.7. eiciel </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9782"><span class="font24" style="font-weight:bold;">9. file links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9783"><span class="font24">9.1. inodes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9784"><span class="font24">9.2. about directories </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9785"><span class="font24">9.3. hard links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9786"><span class="font24">9.4. symbolic links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9787"><span class="font24">9.5. removing links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9788"><span class="font24">9.6. practice : links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9789"><span class="font24">9.7. solution : links </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark9790"></a><span class="font11" style="font-weight:bold;"><a name="bookmark9302"></a><a name="bookmark9791"></a>Chapter 6. standard file permissions</span></h1></li></ul>
<p><span class="font25">This chapter contains details about basic file security through </span><span class="font25" style="font-weight:bold;">file ownership </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">file permissions</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9792"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9303"></a><a name="bookmark9793"></a>6.1. file ownership</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark9794"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9795"></a>6.1.1. user owner and group owner</span></h3></li></ul></li></ul>
<p><a name="bookmark9796"></a><span class="font25"><a name="bookmark9797"></a><a name="bookmark9798"></a>The </span><span class="font25" style="font-weight:bold;">users </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">groups </span><span class="font25">of a system can be locally managed in </span><span class="font25" style="font-weight:bold;">/etc/passwd </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">/etc/group</span><span class="font25">, or they can be in a NIS, LDAP, or Samba domain. These users and groups can </span><span class="font25" style="font-weight:bold;">own </span><span class="font25">files. Actually, every file has a </span><span class="font25" style="font-weight:bold;">user owner </span><span class="font25">and a </span><span class="font25" style="font-weight:bold;">group owner</span><span class="font25">, as can be seen in the following screenshot.</span></p>
<p><span class="font19">paul@rhel65:~/owners$ ls -Ih</span></p>
<p><span class="font19">total 636K</span></p>
<p><span class="font19">-rw-r--r--. 1 paul snooker 1.1K Apr &nbsp;8 18:47 data.odt</span></p>
<p><span class="font19">-rw-r--r--. 1 paul paul &nbsp;&nbsp;&nbsp;626K Apr &nbsp;8 18:46 file1</span></p>
<p><span class="font19">-rw-r--r--. 1 root tennis &nbsp;&nbsp;185 Apr &nbsp;8 18:46 file2</span></p>
<p><span class="font19">-rw-rw-r--. 1 root root &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 Apr &nbsp;8 18:47 stuff.txt</span></p>
<p><span class="font19">paul@rhel65:~/owners$</span></p>
<p><span class="font25">User paul owns three files; file1 has paul as </span><span class="font25" style="font-weight:bold;">user owner </span><span class="font25">and has the group paul as </span><span class="font25" style="font-weight:bold;">group owner</span><span class="font25">, data.odt is </span><span class="font25" style="font-weight:bold;">group owned </span><span class="font25">by the group snooker, file2 by the group tennis.</span></p>
<p><span class="font25">The last file is called stuff.txt and is owned by the root user and the root group.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9799"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9800"></a>6.1.2. listing user accounts</span></h3></li></ul>
<p><span class="font25">You can use the following command to list all local user accounts.</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">paul@debian7~$</span></p></td><td style="vertical-align:top;">
<p><span class="font19">cut -d: -f1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/etc/passwd |</span></p></td><td colspan="2" style="vertical-align:top;">
<p><span class="font19">column</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ntp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">sam</span></p></td><td style="vertical-align:top;">
<p><span class="font19">bert</span></p></td><td style="vertical-align:top;">
<p><span class="font19">naomi</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">daemon</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mysql</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tom</span></p></td><td style="vertical-align:top;">
<p><span class="font19">rino</span></p></td><td style="vertical-align:top;">
<p><span class="font19">matthias2</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">bin</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">wouter</span></p></td><td style="vertical-align:top;">
<p><span class="font19">antonio</span></p></td><td style="vertical-align:top;">
<p><span class="font19">bram</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sys</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">maarten</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">robrecht</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">simon</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">fabrice</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sync</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">kevin</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">bilal</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sven</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">chimene</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">games</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">yuri</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">dimitri</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">wouter2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">messagebus</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">man</span></p></td><td style="vertical-align:top;">
<p><span class="font19">william</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ahmed</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tarik</span></p></td><td style="vertical-align:top;">
<p><span class="font19">roger</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">lp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">yves</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">dylan</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">jan</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">frank</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">mail</span></p></td><td style="vertical-align:top;">
<p><span class="font19">kris</span></p></td><td style="vertical-align:top;">
<p><span class="font19">robin</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ian</span></p></td><td style="vertical-align:top;">
<p><span class="font19">toon</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">news</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">hamid</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">matthias</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ivan</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">rinus</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">uucp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">vladimir</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ben</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">azeddine</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">eddy</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">proxy</span></p></td><td style="vertical-align:top;">
<p><span class="font19">abiy</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mike</span></p></td><td style="vertical-align:top;">
<p><span class="font19">eric</span></p></td><td style="vertical-align:top;">
<p><span class="font19">bram2</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">www-data</span></p></td><td style="vertical-align:top;">
<p><span class="font19">david</span></p></td><td style="vertical-align:top;">
<p><span class="font19">kevin2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">kamel</span></p></td><td style="vertical-align:top;">
<p><span class="font19">keith</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">backup</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">chahid</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">kenzo</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ischa</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">jesse</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">list</span></p></td><td style="vertical-align:top;">
<p><span class="font19">stef</span></p></td><td style="vertical-align:top;">
<p><span class="font19">aaron</span></p></td><td style="vertical-align:top;">
<p><span class="font19">bart</span></p></td><td style="vertical-align:top;">
<p><span class="font19">frederick</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">irc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">joeri</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">lorenzo</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">omer</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">hans</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">gnats</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">glenn</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">jens</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">kurt</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">dries</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">nobody</span></p></td><td style="vertical-align:top;">
<p><span class="font19">yannick</span></p></td><td style="vertical-align:top;">
<p><span class="font19">ruben</span></p></td><td style="vertical-align:top;">
<p><span class="font19">steve</span></p></td><td style="vertical-align:top;">
<p><span class="font19">steve2</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">libuuid</span></p></td><td style="vertical-align:top;">
<p><span class="font19">christof</span></p></td><td style="vertical-align:top;">
<p><span class="font19">jelle</span></p></td><td style="vertical-align:top;">
<p><span class="font19">constantin</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tomas</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Debian-exim</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">george</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">stefaan</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">sam2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">johan</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">statd</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">joost</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">marc</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">bjorn</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tom2</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">sshd</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">arno</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">thomas</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ronald</span></p></td><td style="vertical-align:top;"></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9801"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9802"></a>6.1.3. chgrp</span></h3></li></ul>
<h4><a name="bookmark9803"></a><span class="font25"><a name="bookmark9804"></a><a name="bookmark9805"></a>You can change the group owner of a file using the </span><span class="font25" style="font-weight:bold;">chgrp </span><span class="font25">command.</span></h4>
<p><span class="font19">root@rhel65:/home/paul/owners# ls -l file2</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-r--r--. 1 root tennis 185 Apr 8 18:46 file2 root@rhel65:/home/paul/owners# </span><span class="font19" style="font-weight:bold;">chgrp snooker file2 </span><span class="font19">root@rhel65:/home/paul/owners# ls -l file2 -rw-r--r--. 1 root </span><span class="font19" style="font-weight:bold;">snooker </span><span class="font19">185 Apr 8 18:46 file2 root@rhel65:/home/paul/owners#</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9806"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9807"></a>6.1.4. chown</span></h3></li></ul>
<h4><a name="bookmark9808"></a><span class="font25"><a name="bookmark9809"></a><a name="bookmark9810"></a>The user owner of a file can be changed with </span><span class="font25" style="font-weight:bold;">chown </span><span class="font25">command.</span></h4>
<p><span class="font19">root@laika:/home/paul# ls -l FileForPaul</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-r--r-- 1 root paul 0 2008-08-06 14:11 FileForPaul root@laika:/home/paul# chown paul FileForPaul root@laika:/home/paul# ls -l FileForPaul</span></p></li>
<li>
<p><span class="font19">- rw-r--r-- 1 paul paul 0 2008-08-06 14:11 FileForPaul</span></p></li></ul>
<h4><a name="bookmark9811"></a><span class="font25"><a name="bookmark9812"></a>You can also use </span><span class="font25" style="font-weight:bold;">chown </span><span class="font25">to change both the user owner and the group owner.</span></h4>
<p><span class="font19">root@laika:/home/paul# ls -l FileForPaul</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-r--r-- 1 paul paul 0 2008-08-06 14:11 FileForPaul root@laika:/home/paul# chown root:project42 FileForPaul root@laika:/home/paul# ls -l FileForPaul</span></p></li>
<li>
<p><span class="font19">- rw-r--r-- 1 root project42 0 2008-08-06 14:11 FileForPaul</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9813"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9304"></a><a name="bookmark9814"></a>6.2. list of special files</span></h2></li></ul>
<p><a name="bookmark9815"></a><span class="font25"><a name="bookmark9816"></a>When you use </span><span class="font25" style="font-weight:bold;">ls -l</span><span class="font25">, for each file you can see ten characters before the user and group owner. The first character tells us the type of file. Regular files get a </span><span class="font25" style="font-weight:bold;">-</span><span class="font25">, directories get a </span><span class="font25" style="font-weight:bold;">d</span><span class="font25">, symbolic links are shown with an </span><span class="font25" style="font-weight:bold;">l</span><span class="font25">, pipes get a </span><span class="font25" style="font-weight:bold;">p</span><span class="font25">, character devices a </span><span class="font25" style="font-weight:bold;">c</span><span class="font25">, block devices a </span><span class="font25" style="font-weight:bold;">b</span><span class="font25">, and sockets an </span><span class="font25" style="font-weight:bold;">s</span><span class="font25">.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 6.1. Unix special files</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">first character</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">file type</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font24">-</span></p></td><td style="vertical-align:middle;">
<p><span class="font24">normal file</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">d</span></p></td><td style="vertical-align:top;">
<p><span class="font24">directory</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">l</span></p></td><td style="vertical-align:top;">
<p><span class="font24">symbolic link</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font24">P</span></p></td><td style="vertical-align:bottom;">
<p><span class="font24">named pipe</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">b</span></p></td><td style="vertical-align:top;">
<p><span class="font24">block device</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">c</span></p></td><td style="vertical-align:top;">
<p><span class="font24">character device</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">s</span></p></td><td style="vertical-align:top;">
<p><span class="font24">socket</span></p></td></tr>
</table>
<p><span class="font25">Below a screenshot of a character device (the console) and a block device (the hard disk).</span></p>
<p><span class="font19">paul@debian6lt~$ ls -ld /dev/console /dev/sda</span></p>
<p><span class="font19">crw------- 1 root root 5, 1 Mar 15 12:45 /dev/console</span></p>
<p><span class="font19">brw-rw---- &nbsp;&nbsp;1 root disk 8, 0 Mar 15 12:45 /dev/sda</span></p>
<p><span class="font25">And here you can see a directory, a regular file and a symbolic link.</span></p>
<p><span class="font19">paul@debian6lt~$ ls -ld /etc /etc/hosts /etc/motd</span></p>
<p><span class="font19">drwxr-xr-x 128 root root 12288 Mar 15 18:34 /etc</span></p>
<p><span class="font19">-rw-r--r-- &nbsp;&nbsp;1 root root &nbsp;&nbsp;372 Dec 10 17:36 /etc/hosts</span></p>
<p><span class="font19">lrwxrwxrwx 1 root root &nbsp;&nbsp;&nbsp;13 Dec &nbsp;5 10:36 /etc/motd -&gt; /var/run/motd</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9817"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9305"></a><a name="bookmark9818"></a>6.3. permissions</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark9819"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9820"></a>6.3.1. rwx</span></h3></li></ul></li></ul>
<p><a name="bookmark9821"></a><span class="font25">The nine characters following the file type denote the permissions in three triplets. A permission can be </span><span class="font25" style="font-weight:bold;">r </span><span class="font25">for read access, </span><span class="font25" style="font-weight:bold;">w </span><span class="font25">for write access, and </span><span class="font25" style="font-weight:bold;">x </span><span class="font25">for execute. You need the </span><span class="font25" style="font-weight:bold;">r </span><span class="font25">permission to list (ls) the contents of a directory. You need the </span><span class="font25" style="font-weight:bold;">x </span><span class="font25">permission to enter (cd) a directory. You need the </span><span class="font25" style="font-weight:bold;">w </span><span class="font25">permission to create files in or remove files from a directory.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 6.2. standard Unix file permissions</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">permission</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">on a file</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">on a directory</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">r (read)</span></p></td><td style="vertical-align:top;">
<p><span class="font24">read file contents (cat)</span></p></td><td style="vertical-align:top;">
<p><span class="font24">read directory contents (Is)</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">w (write)</span></p></td><td style="vertical-align:top;">
<p><span class="font24">change file contents (vi)</span></p></td><td style="vertical-align:top;">
<p><span class="font24">create files in (touch)</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">x (execute)</span></p></td><td style="vertical-align:top;">
<p><span class="font24">execute the file</span></p></td><td style="vertical-align:top;">
<p><span class="font24">enter the directory (cd)</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9822"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9823"></a>6.3.2. three sets of rwx</span></h3></li></ul>
<p><a name="bookmark9824"></a><span class="font25">We already know that the output of </span><span class="font25" style="font-weight:bold;">ls -l </span><span class="font25">starts with ten characters for each file. This screenshot shows a regular file (because the first character is a - ).</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ ls -l proc42.bash</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rwxr-xr-- 1 paul proj 984 Feb 6 12:01 proc42.bash</span></p></li></ul>
<p><a name="bookmark9825"></a><span class="font25">Below is a table describing the function of all ten characters.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 6.3. Unix file permissions position</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">position</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">characters</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">function</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font24">1</span></p></td><td style="vertical-align:middle;">
<p><span class="font24">-</span></p></td><td style="vertical-align:middle;">
<p><span class="font24">this is a regular file</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">2-4</span></p></td><td style="vertical-align:top;">
<p><span class="font24">rwx</span></p></td><td style="vertical-align:top;">
<p><span class="font24">permissions for the </span><span class="font24" style="font-weight:bold;">user owner</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">5-7</span></p></td><td style="vertical-align:top;">
<p><span class="font24">r-x</span></p></td><td style="vertical-align:top;">
<p><span class="font24">permissions for the </span><span class="font24" style="font-weight:bold;">group owner</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">8-10</span></p></td><td style="vertical-align:top;">
<p><span class="font24">r--</span></p></td><td style="vertical-align:top;">
<p><span class="font24">permissions for </span><span class="font24" style="font-weight:bold;">others</span></p></td></tr>
</table>
<p><a name="bookmark9826"></a><span class="font25">When you are the </span><span class="font25" style="font-weight:bold;">user owner </span><span class="font25">of a file, then the </span><span class="font25" style="font-weight:bold;">user owner permissions </span><span class="font25">apply to you. The rest of the permissions have no influence on your access to the file.</span></p>
<p><span class="font25">When you belong to the </span><span class="font25" style="font-weight:bold;">group </span><span class="font25">that is the </span><span class="font25" style="font-weight:bold;">group owner </span><span class="font25">of a file, then the </span><span class="font25" style="font-weight:bold;">group owner permissions </span><span class="font25">apply to you. The rest of the permissions have no influence on your access to the file.</span></p>
<p><span class="font25">When you are not the </span><span class="font25" style="font-weight:bold;">user owner </span><span class="font25">of a file and you do not belong to the </span><span class="font25" style="font-weight:bold;">group owner</span><span class="font25">, then the </span><span class="font25" style="font-weight:bold;">others permissions </span><span class="font25">apply to you. The rest of the permissions have no influence on your access to the file.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9827"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9828"></a>6.3.3. permission examples</span></h3></li></ul>
<p><span class="font25">Some example combinations on files and directories are seen in this screenshot. The name of the file explains the permissions.</span></p>
<p><span class="font19">paul@laika:~/perms$ ls -Ih</span></p>
<p><span class="font19">total 12K</span></p>
<p><span class="font19">drwxr-xr-x 2 paul paul 4.0K 2007-02-07 22:26 AllEnter_UserCreateDelete</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rwxrwxrwx 1 paul paul &nbsp;&nbsp;&nbsp;0 2007-02-07 22:21 EveryoneFullControl.txt</span></p></li>
<li>
<p><span class="font19">- r--r----- 1 paul paul &nbsp;&nbsp;&nbsp;0 2007-02-07 22:21 OnlyOwnersRead.txt</span></p></li>
<li>
<p><span class="font19">- rwxrwx--- 1 paul paul &nbsp;&nbsp;&nbsp;0 2007-02-07 22:21 OwnersAll_RestNothing.txt</span></p></li></ul>
<p><span class="font19">dr-xr-x--- 2 paul paul 4.0K 2007-02-07 22:25 UserAndGroupEnter</span></p>
<p><span class="font19">dr-x------ 2 paul paul 4.0K 2007-02-07 22:25 OnlyUserEnter</span></p>
<p><span class="font19">paul@laika:~/perms$</span></p>
<p><span class="font25">To summarise, the first </span><span class="font25" style="font-weight:bold;">rwx </span><span class="font25">triplet represents the permissions for the </span><span class="font25" style="font-weight:bold;">user owner</span><span class="font25">. The second triplet corresponds to the </span><span class="font25" style="font-weight:bold;">group owner</span><span class="font25">; it specifies permissions for all members of that group. The third triplet defines permissions for all </span><span class="font25" style="font-weight:bold;">other </span><span class="font25">users that are not the user owner and are not a member of the group owner.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9829"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9830"></a>6.3.4. setting permissions (chmod)</span></h3></li></ul>
<h4><a name="bookmark9831"></a><span class="font25"><a name="bookmark9832"></a><a name="bookmark9833"></a>Permissions can be changed with </span><span class="font25" style="font-weight:bold;">chmod</span><span class="font25">. The first example gives the user owner execute permissions.</span></h4>
<p><span class="font19">paul@laika:~/perms$ ls -l permissions.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-r--r-- 1 paul paul 0 2007-02-07 22:34 permissions.txt</span></p></li></ul>
<p><span class="font19">paul@laika:~/perms$ chmod u+x permissions.txt</span></p>
<p><span class="font19">paul@laika:~/perms$ ls -l permissions.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rwxr--r-- 1 paul paul 0 2007-02-07 22:34 permissions.txt</span></p></li></ul>
<h4><a name="bookmark9834"></a><span class="font25"><a name="bookmark9835"></a>This example removes the group owners read permission.</span></h4>
<p><span class="font19">paul@laika:~/perms$ chmod g-r permissions.txt</span></p>
<p><span class="font19">paul@laika:~/perms$ ls -l permissions.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rwx---r-- 1 paul paul 0 2007-02-07 22:34 permissions.txt</span></p></li></ul>
<h4><a name="bookmark9836"></a><span class="font25"><a name="bookmark9837"></a>This example removes the others read permission.</span></h4>
<p><span class="font19">paul@laika:~/perms$ chmod o-r permissions.txt</span></p>
<p><span class="font19">paul@laika:~/perms$ ls -l permissions.txt</span></p>
<p><span class="font19">-rwx------ 1 paul paul 0 2007-02-07 22:34 permissions.txt</span></p>
<h4><a name="bookmark9838"></a><span class="font25"><a name="bookmark9839"></a>This example gives all of them the write permission.</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">paul@laika:~/perms$ chmod</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">a+w permissions.txt</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">paul@laika:~/perms$ ls -l</span></p></td><td style="vertical-align:top;">
<p><span class="font19">permissions.txt</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-rwx-w--w- 1 paul paul 0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2007-02-07 22:34 permissions.txt</span></p></td></tr>
</table>
<h4><a name="bookmark9840"></a><span class="font25"><a name="bookmark9841"></a>You don't even have to type the a.</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">paul@laika:~/perms$ chmod</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">+x permissions.txt</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">paul@laika:~/perms$ ls -l</span></p></td><td style="vertical-align:top;">
<p><span class="font19">permissions.txt</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-rwx-wx-wx 1 paul paul 0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2007-02-07 22:34 permissions.txt</span></p></td></tr>
</table>
<h4><a name="bookmark9842"></a><span class="font25"><a name="bookmark9843"></a>You can also set explicit permissions.</span></h4>
<p><span class="font19">paul@laika:~/perms$ chmod u=rw permissions.txt</span></p>
<p><span class="font19">paul@laika:~/perms$ ls -l permissions.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw--wx-wx 1 paul paul 0 2007-02-07 22:34 permissions.txt</span></p></li></ul>
<h4><a name="bookmark9844"></a><span class="font25"><a name="bookmark9845"></a>Feel free to make any kind of combination.</span></h4>
<p><span class="font19">paul@laika:~/perms$ chmod u=rw,g=rw,o=r permissions.txt</span></p>
<p><span class="font19">paul@laika:~/perms$ ls -l permissions.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-rw-r-- 1 paul paul 0 2007-02-07 22:34 permissions.txt</span></p></li></ul>
<h4><a name="bookmark9846"></a><span class="font25"><a name="bookmark9847"></a>Even fishy combinations are accepted by chmod.</span></h4>
<p><span class="font19">paul@laika:~/perms$ chmod u=rwx,ug+rw,o=r permissions.txt</span></p>
<p><span class="font19">paul@laika:~/perms$ ls -l permissions.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rwxrw-r-- 1 paul paul 0 2007-02-07 22:34 permissions.txt</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9848"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9849"></a>6.3.5. setting octal permissions</span></h3></li></ul>
<h4><a name="bookmark9850"></a><span class="font25"><a name="bookmark9851"></a><a name="bookmark9852"></a><a name="bookmark9853"></a>Most Unix administrators will use the </span><span class="font25" style="font-weight:bold;">old school </span><span class="font25">octal system to talk about and set permissions. Look at the triplet bitwise, equating r to 4, w to 2, and x to 1.</span></h4>
<p><span class="font25" style="font-weight:bold;">Table 6.4. Octal permissions</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">binary</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">octal</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">permission</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font24">000</span></p></td><td style="vertical-align:middle;">
<p><span class="font24">0</span></p></td><td style="vertical-align:middle;">
<p><span class="font24">---</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">001</span></p></td><td style="vertical-align:top;">
<p><span class="font24">1</span></p></td><td style="vertical-align:top;">
<p><span class="font24">--x</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">010</span></p></td><td style="vertical-align:top;">
<p><span class="font24">2</span></p></td><td style="vertical-align:top;">
<p><span class="font24">-w-</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">011</span></p></td><td style="vertical-align:top;">
<p><span class="font24">3</span></p></td><td style="vertical-align:top;">
<p><span class="font24">-wx</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">100</span></p></td><td style="vertical-align:top;">
<p><span class="font24">4</span></p></td><td style="vertical-align:top;">
<p><span class="font24">r--</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">101</span></p></td><td style="vertical-align:top;">
<p><span class="font24">5</span></p></td><td style="vertical-align:top;">
<p><span class="font24">r-x</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">110</span></p></td><td style="vertical-align:top;">
<p><span class="font24">6</span></p></td><td style="vertical-align:top;">
<p><span class="font24">rw-</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">111</span></p></td><td style="vertical-align:top;">
<p><span class="font24">7</span></p></td><td style="vertical-align:top;">
<p><span class="font24">rwx</span></p></td></tr>
</table>
<h4><a name="bookmark9854"></a><span class="font25"><a name="bookmark9855"></a><a name="bookmark9856"></a><a name="bookmark9857"></a>This makes </span><span class="font25" style="font-weight:bold;">777 </span><span class="font25">equal to rwxrwxrwx and by the same logic, 654 mean rw-r-xr-- . The </span><span class="font25" style="font-weight:bold;">chmod </span><span class="font25">command will accept these numbers.</span></h4>
<p><span class="font19">paul@laika:~/perms$ chmod 777 permissions.txt</span></p>
<p><span class="font19">paul@laika:~/perms$ ls -l permissions.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rwxrwxrwx 1 paul paul 0 2007-02-07 22:34 permissions.txt</span></p></li></ul>
<p><span class="font19">paul@laika:~/perms$ chmod 664 permissions.txt</span></p>
<p><span class="font19">paul@laika:~/perms$ ls -l permissions.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-rw-r-- 1 paul paul 0 2007-02-07 22:34 permissions.txt</span></p></li></ul>
<p><span class="font19">paul@laika:~/perms$ chmod 750 permissions.txt</span></p>
<p><span class="font19">paul@laika:~/perms$ ls -l permissions.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rwxr-x--- 1 paul paul 0 2007-02-07 22:34 permissions.txt</span></p></li></ul>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9858"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9859"></a>6.3.6. umask</span></h3></li></ul>
<p><a name="bookmark9860"></a><span class="font25">When creating a file or directory, a set of default permissions are applied. These default permissions are determined by the </span><span class="font25" style="font-weight:bold;">umask</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">umask </span><span class="font25">specifies permissions that you do not want set on by default. You can display the </span><span class="font25" style="font-weight:bold;">umask </span><span class="font25">with the </span><span class="font25" style="font-weight:bold;">umask </span><span class="font25">command.</span></p>
<p><span class="font19">[Harry@RHEL4b ~]$ umask 0002</span></p>
<p><span class="font19">[Harry@RHEL4b ~]$ touch test</span></p>
<p><span class="font19">[Harry@RHEL4b ~]$ ls -l test</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-rw-r-- 1 Harry Harry 0 Jul 24 06:03 test [Harry@RHEL4b ~]$</span></p></li></ul>
<p><a name="bookmark9861"></a><span class="font25">As you can also see, the file is also not executable by default. This is a general security feature among Unixes; newly created files are never executable by default. You have to explicitly do a </span><span class="font25" style="font-weight:bold;">chmod +x </span><span class="font25">to make a file executable. This also means that the 1 bit in the </span><span class="font25" style="font-weight:bold;">umask </span><span class="font25">has no meaning--a </span><span class="font25" style="font-weight:bold;">umask </span><span class="font25">of 0022 is the same as 0033.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9862"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9863"></a>6.3.7. mkdir -m</span></h3></li></ul>
<p><a name="bookmark9864"></a><span class="font25">When creating directories with </span><span class="font25" style="font-weight:bold;">mkdir </span><span class="font25">you can use the </span><span class="font25" style="font-weight:bold;">-m </span><span class="font25">option to set the </span><span class="font25" style="font-weight:bold;">mode</span><span class="font25">. This screenshot explains.</span></p>
<p><span class="font19">paul@debian5~$ mkdir -m 700 MyDir</span></p>
<p><span class="font19">paul@debian5~$ mkdir -m 777 Public</span></p>
<p><span class="font19">paul@debian5~$ ls -dl MyDir/ Public/</span></p>
<p><span class="font19">drwx------ 2 paul paul 4096 2011-10-16 19:16 MyDir/</span></p>
<p><span class="font19">drwxrwxrwx 2 paul paul 4096 2011-10-16 19:16 Public/</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9865"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9866"></a>6.3.8. cp -p</span></h3></li></ul>
<p><span class="font25">To preserve permissions and time stamps from source files, use </span><span class="font25" style="font-weight:bold;">cp -p</span><span class="font25">.</span></p>
<p><span class="font19">paul@laika:~/perms$ cp file* cp paul@laika:~/perms$ cp -p file* cpp paul@laika:~/perms$ ll *</span></p>
<p><span class="font19">-rwx------ 1 paul paul &nbsp;&nbsp;&nbsp;0 2008-08-25 13:26 file33</span></p>
<p><span class="font19">-rwxr-x &nbsp;1 paul paul &nbsp;&nbsp;&nbsp;0 2008-08-25 13:26 file42</span></p>
<p><span class="font19">cp:</span></p>
<p><span class="font19">total 0</span></p>
<p><span class="font19">-rwx------ 1 paul paul 0 2008-08-25 13:34 file33</span></p>
<p><span class="font19">-rwxr-x &nbsp;1 paul paul 0 2008-08-25 13:34 file42</span></p>
<p><span class="font19">cpp:</span></p>
<p><span class="font19">total 0</span></p>
<p><span class="font19">-rwx------ 1 paul paul 0 2008-08-25 13:26 file33</span></p>
<p><span class="font19">-rwxr-x &nbsp;1 paul paul 0 2008-08-25 13:26 file42</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9867"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9306"></a><a name="bookmark9868"></a>6.4. practice: standard file permissions</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. As normal user, create a directory ~/permissions. Create a file owned by yourself in there.</span></p></li>
<li>
<p><span class="font25">2. Copy a file owned by root from /etc/ to your permissions dir, who owns this file now ?</span></p></li>
<li>
<p><span class="font25">3. As root, create a file in the users ~/permissions directory.</span></p></li>
<li>
<p><span class="font25">4. As normal user, look at who owns this file created by root.</span></p></li>
<li>
<p><span class="font25">5. Change the ownership of all files in ~/permissions to yourself.</span></p></li>
<li>
<p><span class="font25">6. Make sure you have all rights to these files, and others can only read.</span></p></li>
<li>
<p><span class="font25">7. With chmod, is 770 the same as rwxrwx--- ?</span></p></li>
<li>
<p><span class="font25">8. With chmod, is 664 the same as r-xr-xr-- ?</span></p></li>
<li>
<p><span class="font25">9. With chmod, is 400 the same as r--------?</span></p></li>
<li>
<p><span class="font25">10. With chmod, is 734 the same as rwxr-xr-- ?</span></p></li></ul>
<p><span class="font25">11a. Display the umask in octal and in symbolic form.</span></p>
<p><span class="font25">11b. Set the umask to 077, but use the symbolic format to set it. Verify that this works.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">12. Create a file as root, give only read to others. Can a normal user read this file ? Test writing to this file with vi.</span></p></li></ul>
<p><span class="font25">13a. Create a file as normal user, give only read to others. Can another normal user read this file ? Test writing to this file with vi.</span></p>
<p><span class="font25">13b. Can root read this file ? Can root write to this file with vi ?</span></p>
<p><span class="font25">14. Create a directory that belongs to a group, where every member of that group can read and write to files, and create files. Make sure that people can only delete their own files.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9869"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9307"></a><a name="bookmark9870"></a>6.5. solution: standard file permissions</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. As normal user, create a directory ~/permissions. Create a file owned by yourself in there. </span><span class="font19">mkdir ~/permissions ; touch ~/permissions/myfile.txt</span></p></li>
<li>
<p><span class="font25">2. Copy a file owned by root from /etc/ to your permissions dir, who owns this file now ? </span><span class="font19">cp /etc/hosts ~/permissions/</span></p></li></ul>
<p><span class="font25">The copy is owned by you.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. As root, create a file in the users ~/permissions directory.</span></p></li></ul>
<p><span class="font19">(become root)# touch /home/username/permissions/rootfile</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. As normal user, look at who owns this file created by root.</span></p></li></ul>
<p><span class="font19">ls -l ~/permissions</span></p>
<p><span class="font25">The file created by root is owned by root.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Change the ownership of all files in ~/permissions to yourself.</span></p></li></ul>
<p><span class="font19">chown user ~/permissions/*</span></p>
<p><span class="font25">You cannot become owner of the file that belongs to root.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Make sure you have all rights to these files, and others can only read.</span></p></li></ul>
<p><span class="font19">chmod 644 (on files)</span></p>
<p><span class="font19">chmod 755 (on directories)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. With chmod, is 770 the same as rwxrwx--- ?</span></p></li></ul>
<p><span class="font25">yes</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. With chmod, is 664 the same as r-xr-xr-- ?</span></p></li></ul>
<p><span class="font25">No</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">9. With chmod, is 400 the same as r--------?</span></p></li></ul>
<p><span class="font25">yes</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">10. With chmod, is 734 the same as rwxr-xr-- ?</span></p></li></ul>
<p><span class="font25">no</span></p>
<p><span class="font25">11a. Display the umask in octal and in symbolic form.</span></p>
<p><span class="font19">umask ; umask -S</span></p>
<p><span class="font25">11b. Set the umask to 077, but use the symbolic format to set it. Verify that this works.</span></p>
<p><span class="font19">umask -S u=rwx,go=</span></p>
<p><span class="font25">12. Create a file as root, give only read to others. Can a normal user read this file ? Test writing to this file with vi.</span></p>
<p><span class="font19">(become root)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># echo hello &gt;&nbsp;/home/username/root.txt</span></p></li>
<li>
<p><span class="font19"># chmod 744 /home/username/root.txt</span></p></li></ul>
<p><span class="font19">(become user)</span></p>
<p><span class="font19">vi ~/root.txt</span></p>
<p><span class="font25">13a. Create a file as normal user, give only read to others. Can another normal user read this file ? Test writing to this file with vi.</span></p>
<p><span class="font19">echo hello &gt;&nbsp;file ; chmod 744 file</span></p>
<p><span class="font25">Yes, others can read this file</span></p>
<p><span class="font25">13b. Can root read this file ? Can root write to this file with vi ?</span></p>
<p><span class="font25">Yes, root can read and write to this file. Permissions do not apply to root.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">14. Create a directory that belongs to a group, where every member of that group can read and write to files, and create files. Make sure that people can only delete their own files.</span></p></li></ul>
<p><span class="font19">mkdir /home/project42 ; groupadd project42</span></p>
<p><span class="font19">chgrp project42 /home/project42 ; chmod 775 /home/project42</span></p>
<p><span class="font25">You can not yet do the last part of this exercise...</span></p>
<ul style="list-style:none;"><li>
<p><a name="bookmark9871"></a><span class="font11" style="font-weight:bold;">Chapter 7. advanced file permissions</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9872"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9309"></a><a name="bookmark9873"></a>7.1. sticky bit on directory</span></h2></li></ul>
<p><a name="bookmark9874"></a><span class="font25">You can set the </span><span class="font25" style="font-weight:bold;">sticky bit </span><span class="font25">on a directory to prevent users from removing files that they do not own as a user owner. The sticky bit is displayed at the same location as the x permission for others. The sticky bit is represented by a </span><span class="font25" style="font-weight:bold;">t </span><span class="font25">(meaning x is also there) or a </span><span class="font25" style="font-weight:bold;">T </span><span class="font25">(when there is no x for others).</span></p>
<p><span class="font19">root@RHELv4u4:~# mkdir /project55</span></p>
<p><span class="font19">root@RHELv4u4:~# ls -ld /project55</span></p>
<p><span class="font19">drwxr-xr-x 2 root root 4096 Feb 7 17:38 /project55</span></p>
<p><span class="font19">root@RHELv4u4:~# chmod +t /project55/</span></p>
<p><span class="font19">root@RHELv4u4:~# ls -ld /project55</span></p>
<p><span class="font19">drwxr-xr-t 2 root root 4096 Feb 7 17:38 /project55</span></p>
<p><span class="font19">root@RHELv4u4:~#</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">sticky bit </span><span class="font25">can also be set with octal permissions, it is binary 1 in the first of four triplets.</span></p>
<p><span class="font19">root@RHELv4u4:~# chmod 1775 /project55/</span></p>
<p><span class="font19">root@RHELv4u4:~# ls -ld /project55</span></p>
<p><span class="font19">drwxrwxr-t 2 root root 4096 Feb 7 17:38 /project55 root@RHELv4u4:~#</span></p>
<p><a name="bookmark9875"></a><span class="font25">You will typically find the </span><span class="font25" style="font-weight:bold;">sticky bit </span><span class="font25">on the </span><span class="font25" style="font-weight:bold;">/tmp </span><span class="font25">directory.</span></p>
<p><span class="font19">root@barry:~# ls -ld /tmp</span></p>
<p><span class="font19">drwxrwxrwt 6 root root 4096 2009-06-04 19:02 /tmp</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9876"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9310"></a><a name="bookmark9877"></a>7.2. setgid bit on directory</span></h2></li></ul>
<p><a name="bookmark9878"></a><span class="font25" style="font-weight:bold;">setgid </span><span class="font25">can be used on directories to make sure that all files inside the directory are owned by the group owner of the directory. The </span><span class="font25" style="font-weight:bold;">setgid </span><span class="font25">bit is displayed at the same location as the x permission for group owner. The </span><span class="font25" style="font-weight:bold;">setgid </span><span class="font25">bit is represented by an </span><span class="font25" style="font-weight:bold;">s </span><span class="font25">(meaning x is also there) or a </span><span class="font25" style="font-weight:bold;">S </span><span class="font25">(when there is no x for the group owner). As this example shows, even though </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">does not belong to the group proj55, the files created by root in /project55 will belong to proj55 since the </span><span class="font25" style="font-weight:bold;">setgid </span><span class="font25">is set.</span></p>
<p><span class="font19">root@RHELv4u4:~# groupadd proj55</span></p>
<p><span class="font19">root@RHELv4u4:~# chown root:proj55 /project55/</span></p>
<p><span class="font19">root@RHELv4u4:~# chmod 2775 /project55/</span></p>
<p><span class="font19">root@RHELv4u4:~# touch /project55/fromroot.txt</span></p>
<p><span class="font19">root@RHELv4u4:~# ls -ld /project55/</span></p>
<p><span class="font19">drwxrwsr-x 2 root proj55 4096 Feb 7 17:45 /project55/</span></p>
<p><span class="font19">root@RHELv4u4:~# ls -l /project55/ total 4</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-r--r-- &nbsp;1 root proj55 0 Feb 7 17:45 fromroot.txt</span></p></li></ul>
<p><span class="font19">root@RHELv4u4:~#</span></p>
<p><a name="bookmark9879"></a><span class="font25"><a name="bookmark9880"></a>You can use the </span><span class="font25" style="font-weight:bold;">find </span><span class="font25">command to find all </span><span class="font25" style="font-weight:bold;">setgid </span><span class="font25">directories.</span></p>
<p><span class="font19">paul@laika:~$ find / -type d -perm -2000 2&gt; /dev/null /var/log/mysql</span></p>
<p><span class="font19">/var/log/news</span></p>
<p><span class="font19">/var/local</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9881"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9311"></a><a name="bookmark9882"></a>7.3. setgid and setuid on regular files</span></h2></li></ul>
<p><a name="bookmark9883"></a><span class="font25">These two permissions cause an executable file to be executed with the permissions of the </span><span class="font25" style="font-weight:bold;">file owner </span><span class="font25">instead of the </span><span class="font25" style="font-weight:bold;">executing owner</span><span class="font25">. This means that if any user executes a program that belongs to the </span><span class="font25" style="font-weight:bold;">root user</span><span class="font25">, and the </span><span class="font25" style="font-weight:bold;">setuid </span><span class="font25">bit is set on that program, then the program runs as </span><span class="font25" style="font-weight:bold;">root</span><span class="font25">. This can be dangerous, but sometimes this is good for security.</span></p>
<p><a name="bookmark9884"></a><span class="font25">Take the example of passwords; they are stored in </span><span class="font25" style="font-weight:bold;">/etc/shadow </span><span class="font25">which is only readable by </span><span class="font25" style="font-weight:bold;">root</span><span class="font25">. (The </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">user never needs permissions anyway.)</span></p>
<p><span class="font19">root@RHELv4u4:~# ls -l /etc/shadow</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">—r-------- 1 root root 1260 Jan 21 07:49 /etc/shadow</span></p></li></ul>
<p><a name="bookmark9885"></a><span class="font25">Changing your password requires an update of this file, so how can normal non-root users do this? Let's take a look at the permissions on the </span><span class="font25" style="font-weight:bold;">/usr/bin/passwd</span><span class="font25">.</span></p>
<p><span class="font19">root@RHELv4u4:~# ls -l /usr/bin/passwd</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-r-s--x--x 1 root root 21200 Jun 17 &nbsp;2005 /usr/bin/passwd</span></p></li></ul>
<p><a name="bookmark9886"></a><span class="font25">When running the </span><span class="font25" style="font-weight:bold;">passwd </span><span class="font25">program, you are executing it with </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">credentials.</span></p>
<p><a name="bookmark9887"></a><span class="font25"><a name="bookmark9888"></a>You can use the </span><span class="font25" style="font-weight:bold;">find </span><span class="font25">command to find all </span><span class="font25" style="font-weight:bold;">setuid </span><span class="font25">programs.</span></p>
<p><span class="font19">paul@laika:~$ find /usr/bin -type f -perm -04000</span></p>
<p><span class="font19">/usr/bin/arping</span></p>
<p><span class="font19">/usr/bin/kgrantpty</span></p>
<p><span class="font19">/usr/bin/newgrp</span></p>
<p><span class="font19">/usr/bin/chfn</span></p>
<p><span class="font19">/usr/bin/sudo</span></p>
<p><span class="font19">/usr/bin/fping6</span></p>
<p><span class="font19">/usr/bin/passwd</span></p>
<p><span class="font19">/usr/bin/gpasswd</span></p>
<p><span class="font25">In most cases, setting the </span><span class="font25" style="font-weight:bold;">setuid </span><span class="font25">bit on executables is sufficient. Setting the </span><span class="font25" style="font-weight:bold;">setgid </span><span class="font25">bit will result in these programs to run with the credentials of their group owner.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9889"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9312"></a><a name="bookmark9890"></a>7.4. setuid on sudo</span></h2></li></ul>
<p><a name="bookmark9891"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">sudo </span><span class="font25">binary has the </span><span class="font25" style="font-weight:bold;">setuid </span><span class="font25">bit set, so any user can run it with the effective userid of root.</span></p>
<p><span class="font19">paul@rhel65:~$ ls -l $(which sudo) ---s--x--x. 1 root root 123832 Oct 7 &nbsp;2013 /usr/bin/sudo paul@rhel65:~$</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9892"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9313"></a><a name="bookmark9893"></a>7.5. practice: sticky, setuid and setgid bits</span></h2></li></ul>
<p><span class="font25">1a. Set up a directory, owned by the group sports.</span></p>
<p><span class="font25">1b. Members of the sports group should be able to create files in this directory.</span></p>
<p><span class="font25">1c. All files created in this directory should be group-owned by the sports group.</span></p>
<p><span class="font25">1d. Users should be able to delete only their own user-owned files.</span></p>
<p><span class="font25">1e. Test that this works!</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Verify the permissions on </span><span class="font25" style="font-weight:bold;">/usr/bin/passwd</span><span class="font25">. Remove the </span><span class="font25" style="font-weight:bold;">setuid</span><span class="font25">, then try changing your password as a normal user. Reset the permissions back and try again.</span></p></li>
<li>
<p><span class="font25">3. If time permits (or if you are waiting for other students to finish this practice), read about file attributes in the man page of chattr and lsattr. Try setting the i attribute on a file and test that it works.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9894"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9314"></a><a name="bookmark9895"></a>7.6. solution: sticky, setuid and setgid bits</span></h2></li></ul>
<p><span class="font25">1a. Set up a directory, owned by the group sports.</span></p>
<p><span class="font19">groupadd sports</span></p>
<p><span class="font19">mkdir /home/sports</span></p>
<p><span class="font19">chown root:sports /home/sports</span></p>
<p><span class="font25">1b. Members of the sports group should be able to create files in this directory.</span></p>
<p><span class="font19">chmod 770 /home/sports</span></p>
<p><span class="font25">1c. All files created in this directory should be group-owned by the sports group.</span></p>
<p><span class="font19">chmod 2770 /home/sports</span></p>
<p><span class="font25">1d. Users should be able to delete only their own user-owned files.</span></p>
<p><span class="font19">chmod +t /home/sports</span></p>
<p><span class="font25">1e. Test that this works!</span></p>
<p><span class="font25">Log in with different users (group members and others and root), create files and watch the permissions. Try changing and deleting files...</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Verify the permissions on </span><span class="font25" style="font-weight:bold;">/usr/bin/passwd</span><span class="font25">. Remove the </span><span class="font25" style="font-weight:bold;">setuid</span><span class="font25">, then try changing your password as a normal user. Reset the permissions back and try again.</span></p></li></ul>
<p><span class="font19">root@deb503:~# ls -l /usr/bin/passwd</span></p>
<p><span class="font19">-rwsr-xr-x 1 root root 31704 2009-11-14 15:41 /usr/bin/passwd root@deb503:~# chmod 755 /usr/bin/passwd root@deb503:~# ls -l /usr/bin/passwd</span></p>
<p><span class="font19">-rwxr-xr-x 1 root root 31704 2009-11-14 15:41 /usr/bin/passwd</span></p>
<p><span class="font25">A normal user cannot change password now.</span></p>
<p><span class="font19">root@deb503:~# chmod 4755 /usr/bin/passwd root@deb503:~# ls -l /usr/bin/passwd</span></p>
<p><span class="font19">-rwsr-xr-x 1 root root 31704 2009-11-14 15:41 /usr/bin/passwd</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. If time permits (or if you are waiting for other students to finish this practice), read about file attributes in the man page of chattr and lsattr. Try setting the i attribute on a file and test that it works.</span></p></li></ul>
<p><span class="font19">paul@laika:~$ sudo su -</span></p>
<p><span class="font19">[sudo] password for paul: root@laika:~# mkdir attr root@laika:~# cd attr/ root@laika:~/attr# touch file42 root@laika:~/attr# lsattr ------------------ ./file42 root@laika:~/attr# chattr +i file42</span></p>
<p><span class="font19">root@laika:~/attr#</span></p>
<p><span class="font19">root@laika:~/attr# rm -rf rm: cannot remove 'file42 root@laika:~/attr# chattr root@laika:~/attr# rm -rf root@laika:~/attr#</span></p>
<div>
<p><span class="font19">lsattr</span></p>
<p><span class="font19">./file42</span></p>
</div><br clear="all">
<p><span class="font19">file42</span></p>
<p><span class="font19">: Operation not permitted</span></p>
<p><span class="font19">-i file42</span></p>
<p><span class="font19">file42</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark9896"></a><span class="font11" style="font-weight:bold;"><a name="bookmark9315"></a><a name="bookmark9897"></a>Chapter 8. access control lists</span></h1></li></ul>
<p><span class="font25">Standard Unix permissions might not be enough for some organisations. This chapter introduces </span><span class="font25" style="font-weight:bold;">access control lists </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">acl's </span><span class="font25">to further protect files and directories.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9898"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9316"></a><a name="bookmark9899"></a>8.1. acl in /etc/fstab</span></h2></li></ul>
<p><a name="bookmark9900"></a><span class="font25"><a name="bookmark9901"></a><a name="bookmark9902"></a>File systems that support </span><span class="font25" style="font-weight:bold;">access control lists</span><span class="font25">, or </span><span class="font25" style="font-weight:bold;">acls</span><span class="font25">, have to be mounted with the </span><span class="font25" style="font-weight:bold;">acl </span><span class="font25">option listed in </span><span class="font25" style="font-weight:bold;">/etc/fstab</span><span class="font25">. In the example below, you can see that the root file system has </span><span class="font25" style="font-weight:bold;">acl </span><span class="font25">support, whereas /home/data does not.</span></p>
<p><span class="font19">root@laika:~# tail -4 /etc/fstab</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sda1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ext3</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">acl,relatime</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/sdb2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/home/data</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">auto</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">noacl,defaults</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">pasha:/home/r</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/home/pasha</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nfs</span></p></td><td style="vertical-align:top;">
<p><span class="font19">defaults</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">wolf:/srv/data</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/home/wolf</span></p></td><td style="vertical-align:top;">
<p><span class="font19">nfs</span></p></td><td style="vertical-align:top;">
<p><span class="font19">defaults</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9903"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9317"></a><a name="bookmark9904"></a>8.2. getfacl</span></h2></li></ul>
<p><a name="bookmark9905"></a><span class="font25"><a name="bookmark9906"></a>Reading </span><span class="font25" style="font-weight:bold;">acls </span><span class="font25">can be done with </span><span class="font25" style="font-weight:bold;">/usr/bin/getfacl</span><span class="font25">. This screenshot shows how to read the </span><span class="font25" style="font-weight:bold;">acl </span><span class="font25">of </span><span class="font25" style="font-weight:bold;">file33 </span><span class="font25">with </span><span class="font25" style="font-weight:bold;">getfacl</span><span class="font25">.</span></p>
<p><span class="font19">paul@laika:~/test$ getfacl file33</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># file: file33</span></p></li>
<li>
<p><span class="font19"># owner: paul</span></p></li>
<li>
<p><span class="font19"># group: paul</span></p></li></ul>
<p><span class="font19">user::rw-</span></p>
<p><span class="font19">group::r--mask::rwx other::r--</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9907"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9318"></a><a name="bookmark9908"></a>8.3. setfacl</span></h2></li></ul>
<p><a name="bookmark9909"></a><span class="font25"><a name="bookmark9910"></a>Writing or changing </span><span class="font25" style="font-weight:bold;">acls </span><span class="font25">can be done with </span><span class="font25" style="font-weight:bold;">/usr/bin/setfacl</span><span class="font25">. These screenshots show how to change the </span><span class="font25" style="font-weight:bold;">acl </span><span class="font25">of </span><span class="font25" style="font-weight:bold;">file33 </span><span class="font25">with </span><span class="font25" style="font-weight:bold;">setfacl</span><span class="font25">.</span></p>
<p><span class="font25">First we add </span><span class="font25" style="font-weight:bold;">u</span><span class="font25">ser </span><span class="font25" style="font-weight:bold;">sandra </span><span class="font25">with octal permission </span><span class="font25" style="font-weight:bold;">7 </span><span class="font25">to the </span><span class="font25" style="font-weight:bold;">acl</span><span class="font25">.</span></p>
<p><span class="font19">paul@laika:~/test$ setfacl -m u:sandra:7 file33</span></p>
<p><span class="font25">Then we add the </span><span class="font25" style="font-weight:bold;">g</span><span class="font25">roup tennis with octal permission </span><span class="font25" style="font-weight:bold;">6 </span><span class="font25">to the </span><span class="font25" style="font-weight:bold;">acl </span><span class="font25">of the same file.</span></p>
<p><span class="font19">paul@laika:~/test$ setfacl -m g:tennis:6 file33</span></p>
<p><span class="font25">The result is visible with </span><span class="font25" style="font-weight:bold;">getfacl</span><span class="font25">.</span></p>
<p><span class="font19">paul@laika:~/test$ getfacl file33</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># file: file33</span></p></li>
<li>
<p><span class="font19"># owner: paul # group: paul user::rw-user:sandra:rwx group::r--group:tennis:rw-mask::rwx other::r--</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9911"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9319"></a><a name="bookmark9912"></a>8.4. remove an acl entry</span></h2></li></ul>
<h4><a name="bookmark9913"></a><span class="font25"><a name="bookmark9914"></a>The </span><span class="font25" style="font-weight:bold;">-x </span><span class="font25">option of the </span><span class="font25" style="font-weight:bold;">setfacl </span><span class="font25">command will remove an </span><span class="font25" style="font-weight:bold;">acl </span><span class="font25">entry from the targeted file.</span></h4>
<p><span class="font19">paul@laika:~/test$ setfacl -m u:sandra:7 file33 paul@laika:~/test$ getfacl file33 | grep sandra user:sandra:rwx</span></p>
<p><span class="font19">paul@laika:~/test$ setfacl -x sandra file33</span></p>
<p><span class="font19">paul@laika:~/test$ getfacl file33 | grep sandra</span></p>
<h4><a name="bookmark9915"></a><span class="font25"><a name="bookmark9916"></a>Note that omitting the </span><span class="font25" style="font-weight:bold;">u </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">g </span><span class="font25">when defining the </span><span class="font25" style="font-weight:bold;">acl </span><span class="font25">for an account will default it to a user account.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9917"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9320"></a><a name="bookmark9918"></a>8.5. remove the complete acl</span></h2></li></ul>
<h4><a name="bookmark9919"></a><span class="font25"><a name="bookmark9920"></a>The </span><span class="font25" style="font-weight:bold;">-b </span><span class="font25">option of the </span><span class="font25" style="font-weight:bold;">setfacl </span><span class="font25">command will remove the </span><span class="font25" style="font-weight:bold;">acl </span><span class="font25">from the targeted file.</span></h4>
<p><span class="font19">paul@laika:~/test$ setfacl -b file33</span></p>
<p><span class="font19">paul@laika:~/test$ getfacl file33</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># file: file33</span></p></li>
<li>
<p><span class="font19"># owner: paul</span></p></li>
<li>
<p><span class="font19"># group: paul</span></p></li></ul>
<p><span class="font19">user::rw-</span></p>
<p><span class="font19">group::r--other::r--</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9921"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9321"></a><a name="bookmark9922"></a>8.6. the acl mask</span></h2></li></ul>
<h4><a name="bookmark9923"></a><span class="font25"><a name="bookmark9924"></a>The </span><span class="font25" style="font-weight:bold;">acl mask </span><span class="font25">defines the maximum effective permissions for any entry in the </span><span class="font25" style="font-weight:bold;">acl</span><span class="font25">. This </span><span class="font25" style="font-weight:bold;">mask </span><span class="font25">is calculated every time you execute the </span><span class="font25" style="font-weight:bold;">setfacl </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">chmod </span><span class="font25">commands.</span></h4>
<h4><a name="bookmark9925"></a><span class="font25"><a name="bookmark9926"></a>You can prevent the calculation by using the </span><span class="font25" style="font-weight:bold;">--no-mask </span><span class="font25">switch.</span></h4>
<p><span class="font19">paul@laika:~/test$ setfacl --no-mask -m u:sandra:7 file33 paul@laika:~/test$ getfacl file33</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># file: file33</span></p></li>
<li>
<p><span class="font19"># owner: paul</span></p></li>
<li>
<p><span class="font19"># group: paul</span></p></li></ul>
<p><span class="font19">user::rw-</span></p>
<p><span class="font19">user:sandra:rwx #effective:rw-</span></p>
<p><span class="font19">group::r--</span></p>
<p><span class="font19">mask::rw-</span></p>
<p><span class="font19">other::r--</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9927"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9322"></a><a name="bookmark9928"></a>8.7. eiciel</span></h2></li></ul>
<p><a name="bookmark9929"></a><span class="font25"><a name="bookmark9930"></a>Desktop users might want to use </span><span class="font25" style="font-weight:bold;">eiciel </span><span class="font25">to manage </span><span class="font25" style="font-weight:bold;">acls </span><span class="font25">with a graphical tool.</span></p>
<p><span class="font22">Basic Emblems Permissions Open With Notes Access Control List</span></p><img src="linux_guide_files/The Complete Linux Guide-156.jpg" alt="" style="width:362pt;height:156pt;">
<p><span class="font25">You will need to install </span><span class="font25" style="font-weight:bold;">eiciel </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">nautilus-actions </span><span class="font25">to have an extra tab in </span><span class="font25" style="font-weight:bold;">nautilus </span><span class="font25">to manage </span><span class="font25" style="font-weight:bold;">acls</span><span class="font25">.</span></p>
<p><span class="font19">paul@laika:~$ sudo aptitude install eiciel nautilus-actions</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark9931"></a><span class="font11" style="font-weight:bold;"><a name="bookmark9932"></a><a name="bookmark9933"></a>Chapter 9. file links</span></h1></li></ul>
<p><span class="font25">An average computer using Linux has a file system with many </span><span class="font25" style="font-weight:bold;">hard links </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">symbolic links</span><span class="font25">.</span></p>
<p><a name="bookmark9934"></a><span class="font25">To understand links in a file system, you first have to understand what an </span><span class="font25" style="font-weight:bold;">inode </span><span class="font25">is.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9935"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9324"></a><a name="bookmark9936"></a>9.1. inodes</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark9937"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9938"></a>9.1.1. inode contents</span></h3></li></ul></li></ul>
<p><span class="font25">An </span><span class="font25" style="font-weight:bold;">inode </span><span class="font25">is a data structure that contains metadata about a file. When the file system stores a new file on the hard disk, it stores not only the contents (data) of the file, but also extra properties like the name of the file, the creation date, its permissions, the owner of the file, and more. All this information (except the name of the file and the contents of the file) is stored in the </span><span class="font25" style="font-weight:bold;">inode </span><span class="font25">of the file.</span></p>
<p><a name="bookmark9939"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">ls -l </span><span class="font25">command will display some of the inode contents, as seen in this screenshot.</span></p>
<p><span class="font19">root@rhel53 ~# ls -ld /home/project42/</span></p>
<p><span class="font19">drwxr-xr-x 4 root pro42 4.0K Mar 27 14:29 /home/project42/</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9940"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9941"></a>9.1.2. inode table</span></h3></li></ul>
<p><a name="bookmark9942"></a><span class="font25"><a name="bookmark9943"></a><a name="bookmark9944"></a>The </span><span class="font25" style="font-weight:bold;">inode table </span><span class="font25">contains all of the </span><span class="font25" style="font-weight:bold;">inodes </span><span class="font25">and is created when you create the file system (with </span><span class="font25" style="font-weight:bold;">mkfs</span><span class="font25">). You can use the </span><span class="font25" style="font-weight:bold;">df -i </span><span class="font25">command to see how many </span><span class="font25" style="font-weight:bold;">inodes </span><span class="font25">are used and free on mounted file systems.</span></p>
<p><span class="font19">root@rhel53 ~# df -i</span></p>
<p><span class="font19">Filesystem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Inodes lUsed IFree IUse% Mounted on</span></p>
<p><span class="font19">/dev/mapper/VolGroup00-LogVol00</span></p>
<table border="1">
<tr><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">4947968</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">115326</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4832642</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">3%</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">/dev/hda1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">26104</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">45</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">26059</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1%</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/boot</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">tmpfs</span></p></td><td style="vertical-align:top;">
<p><span class="font19">64417</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">64416</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1%</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/dev/shm</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/sda1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">262144</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2207</span></p></td><td style="vertical-align:top;">
<p><span class="font19">259937</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1%</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/home/project42</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/sdb1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">74400</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5519</span></p></td><td style="vertical-align:top;">
<p><span class="font19">68881</span></p></td><td style="vertical-align:top;">
<p><span class="font19">8%</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/home/project33</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/sdb5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/home/sales</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">/dev/sdb6</span></p></td><td style="vertical-align:top;">
<p><span class="font19">100744</span></p></td><td style="vertical-align:top;">
<p><span class="font19">11</span></p></td><td style="vertical-align:top;">
<p><span class="font19">100733</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1%</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/home/research</span></p></td></tr>
</table>
<p><span class="font25">In the </span><span class="font25" style="font-weight:bold;">df -i </span><span class="font25">screenshot above you can see the </span><span class="font25" style="font-weight:bold;">inode </span><span class="font25">usage for several mounted </span><span class="font25" style="font-weight:bold;">file systems</span><span class="font25">.</span></p>
<p><span class="font25">You don't see numbers for </span><span class="font25" style="font-weight:bold;">/dev/sdb5 </span><span class="font25">because it is a </span><span class="font25" style="font-weight:bold;">fat </span><span class="font25">file system.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9945"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9946"></a>9.1.3. inode number</span></h3></li></ul>
<p><a name="bookmark9947"></a><span class="font25">Each </span><span class="font25" style="font-weight:bold;">inode </span><span class="font25">has a unique number (the inode number). You can see the </span><span class="font25" style="font-weight:bold;">inode </span><span class="font25">numbers with the </span><span class="font25" style="font-weight:bold;">ls -li </span><span class="font25">command.</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ touch file1</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ touch file2</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ touch file3</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ ls -li total 12</span></p>
<p><span class="font19">817266 -rw-rw-r-- &nbsp;1 paul paul 0 Feb &nbsp;5 15:38 file1</span></p>
<p><span class="font19">817267 -rw-rw-r-- &nbsp;1 paul paul 0 Feb &nbsp;5 15:38 file2</span></p>
<p><span class="font19">817268 -rw-rw-r-- &nbsp;1 paul paul 0 Feb &nbsp;5 15:38 file3</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$</span></p>
<p><span class="font25">These three files were created one after the other and got three different </span><span class="font25" style="font-weight:bold;">inodes </span><span class="font25">(the first column). All the information you see with this </span><span class="font25" style="font-weight:bold;">ls </span><span class="font25">command resides in the </span><span class="font25" style="font-weight:bold;">inode</span><span class="font25">, except for the filename (which is contained in the directory).</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9948"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9949"></a>9.1.4. inode and file contents</span></h3></li></ul>
<p><span class="font25">Let's put some data in one of the files.</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ ls -li total 16</span></p>
<p><span class="font19">817266 -rw-rw-r-- &nbsp;1 paul paul &nbsp;0 Feb &nbsp;5 15:38 filel</span></p>
<p><span class="font19">817270 -rw-rw-r-- &nbsp;1 paul paul 92 Feb &nbsp;5 15:42 file2</span></p>
<p><span class="font19">817268 -rw-rw-r-- &nbsp;1 paul paul &nbsp;0 Feb &nbsp;5 15:38 file3</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ cat file2</span></p>
<p><span class="font19">It is winter now and it is very cold.</span></p>
<p><span class="font19">We do not like the cold, we prefer hot summer nights. paul@RHELv4u4:~/test$</span></p>
<p><span class="font25">The data that is displayed by the </span><span class="font25" style="font-weight:bold;">cat </span><span class="font25">command is not in the </span><span class="font25" style="font-weight:bold;">inode</span><span class="font25">, but somewhere else on the disk. The </span><span class="font25" style="font-weight:bold;">inode </span><span class="font25">contains a pointer to that data.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9950"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9325"></a><a name="bookmark9951"></a>9.2. about directories</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark9952"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9953"></a>9.2.1. a directory is a table</span></h3></li></ul></li></ul>
<p><a name="bookmark9954"></a><span class="font25"><a name="bookmark9955"></a>A </span><span class="font25" style="font-weight:bold;">directory </span><span class="font25">is a special kind of file that contains a table which maps filenames to inodes. Listing our current directory with </span><span class="font25" style="font-weight:bold;">ls -ali </span><span class="font25">will display the contents of the directory file.</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ ls -ali total 32</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">817262</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">drwxrwxr-x</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15:42 .</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">800768</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">drwx------</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">16</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">4096</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15:42 ..</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">817266</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">-rw-rw-r--</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15:38 file1</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">817270</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">-rw-rw-r--</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">92</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15:42 file2</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">817268</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-rw-rw-r--</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">15:38 file3</span></p></td></tr>
</table>
<p><span class="font19">paul@RHELv4u4:~/test$</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9956"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9957"></a>9.2.2. . and ..</span></h3></li></ul>
<p><a name="bookmark9958"></a><span class="font25"><a name="bookmark9959"></a>You can see five names, and the mapping to their five inodes. The dot </span><span class="font25" style="font-weight:bold;">. </span><span class="font25">is a mapping to itself, and the dotdot </span><span class="font25" style="font-weight:bold;">.. </span><span class="font25">is a mapping to the parent directory. The three other names are mappings to different inodes.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9960"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9326"></a><a name="bookmark9961"></a>9.3. hard links</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark9962"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9963"></a>9.3.1. creating hard links</span></h3></li></ul></li></ul>
<p><a name="bookmark9964"></a><span class="font25"><a name="bookmark9965"></a>When we create a </span><span class="font25" style="font-weight:bold;">hard link </span><span class="font25">to a file with </span><span class="font25" style="font-weight:bold;">ln</span><span class="font25">, an extra entry is added in the directory. A new file name is mapped to an existing inode.</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ ln file2 hardlink_to_file2</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ ls -li total 24</span></p>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">817266</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">-rw-rw-r--</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15:38</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">file1</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">817270</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">-rw-rw-r--</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">92</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15:42</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">file2</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">817268</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">-rw-rw-r--</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">5</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">15:38</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">file3</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">817270</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-rw-rw-r--</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">paul</span></p></td><td style="vertical-align:top;">
<p><span class="font19">92</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Feb</span></p></td><td style="vertical-align:top;">
<p><span class="font19">5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">15:42</span></p></td><td style="vertical-align:top;">
<p><span class="font19">hardlink_to_file2</span></p></td></tr>
</table>
<p><span class="font19">paul@RHELv4u4:~/test$</span></p>
<p><span class="font25">Both files have the same inode, so they will always have the same permissions and the same owner. Both files will have the same content. Actually, both files are equal now, meaning you can safely remove the original file, the hardlinked file will remain. The inode contains a counter, counting the number of hard links to itself. When the counter drops to zero, then the inode is emptied.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9966"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9967"></a>9.3.2. finding hard links</span></h3></li></ul>
<p><a name="bookmark9968"></a><span class="font25"><a name="bookmark9969"></a>You can use the </span><span class="font25" style="font-weight:bold;">find </span><span class="font25">command to look for files with a certain inode. The screenshot below shows how to search for all filenames that point to </span><span class="font25" style="font-weight:bold;">inode </span><span class="font25">817270. Remember that an </span><span class="font25" style="font-weight:bold;">inode </span><span class="font25">number is unique to its partition.</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ find / -inum 817270 2&gt; /dev/null</span></p>
<p><span class="font19">/home/paul/test/file2</span></p>
<p><span class="font19">/home/paul/test/hardlink_to_file2</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9970"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9327"></a><a name="bookmark9971"></a>9.4. symbolic links</span></h2></li></ul>
<h4><a name="bookmark9972"></a><span class="font25"><a name="bookmark9973"></a><a name="bookmark9974"></a><a name="bookmark9975"></a><a name="bookmark9976"></a>Symbolic links (sometimes called </span><span class="font25" style="font-weight:bold;">soft links</span><span class="font25">) do not link to inodes, but create a name to name mapping. Symbolic links are created with </span><span class="font25" style="font-weight:bold;">ln -s</span><span class="font25">. As you can see below, the </span><span class="font25" style="font-weight:bold;">symbolic link </span><span class="font25">gets an inode of its own.</span></h4>
<p><span class="font19">paul@RHELv4u4:~/test$ ln -s file2 symlink_to_file2</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$ ls -li</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">total 32</span></p>
<p><span class="font19">817273 -rw-rw-r-- &nbsp;1 paul paul &nbsp;13 Feb &nbsp;5 17:06</span></p>
<p><span class="font19">817270 -rw-rw-r-- &nbsp;2 paul paul 106 Feb &nbsp;5 17:04</span></p>
<p><span class="font19">817268 -rw-rw-r-- &nbsp;1 paul paul &nbsp;&nbsp;0 Feb &nbsp;5 15:38</span></p>
<p><span class="font19">817270 -rw-rw-r-- &nbsp;2 paul paul 106 Feb &nbsp;5 17:04</span></p>
<p><span class="font19">817267 lrwxrwxrwx &nbsp;1 paul paul &nbsp;&nbsp;5 Feb &nbsp;5 16:55</span></p>
<p><span class="font19">paul@RHELv4u4:~/test$</span></p></td><td style="vertical-align:middle;">
<p><span class="font19">file1</span></p>
<p><span class="font19">file2</span></p>
<p><span class="font19">file3</span></p>
<p><span class="font19">hardlink_to_file2</span></p>
<p><span class="font19">symlink_to_file2 -&gt; file2</span></p></td></tr>
</table>
<h4><a name="bookmark9977"></a><span class="font25"><a name="bookmark9978"></a>Permissions on a symbolic link have no meaning, since the permissions of the target apply. Hard links are limited to their own partition (because they point to an inode), symbolic links can link anywhere (other file systems, even networked).</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9979"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9328"></a><a name="bookmark9980"></a>9.5. removing links</span></h2></li></ul>
<h4><a name="bookmark9981"></a><span class="font25"><a name="bookmark9982"></a><a name="bookmark9983"></a>Links can be removed with </span><span class="font25" style="font-weight:bold;">rm</span><span class="font25">.</span></h4>
<p><span class="font19">paul@laika:~$ touch data.txt</span></p>
<p><span class="font19">paul@laika:~$ ln -s data.txt sl_data.txt</span></p>
<p><span class="font19">paul@laika:~$ ln data.txt hl_data.txt</span></p>
<p><span class="font19">paul@laika:~$ rm sl_data.txt</span></p>
<p><span class="font19">paul@laika:~$ rm hl_data.txt</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9984"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9329"></a><a name="bookmark9985"></a>9.6. practice : links</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create two files named winter.txt and summer.txt, put some text in them.</span></p></li>
<li>
<p><span class="font25">2. Create a hard link to winter.txt named hlwinter.txt.</span></p></li>
<li>
<p><span class="font25">3. Display the inode numbers of these three files, the hard links should have the same inode.</span></p></li>
<li>
<p><span class="font25">4. Use the find command to list the two hardlinked files</span></p></li>
<li>
<p><span class="font25">5. Everything about a file is in the inode, except two things : name them!</span></p></li>
<li>
<p><span class="font25">6. Create a symbolic link to summer.txt called slsummer.txt.</span></p></li>
<li>
<p><span class="font25">7. Find all files with inode number 2. What does this information tell you ?</span></p></li>
<li>
<p><span class="font25">8. Look at the directories /etc/init.d/ /etc/rc2.d/ /etc/rc3.d/ ... do you see the links ?</span></p></li>
<li>
<p><span class="font25">9. Look in /lib with ls -l...</span></p></li>
<li>
<p><span class="font25">10. Use </span><span class="font25" style="font-weight:bold;">find </span><span class="font25">to look in your home directory for regular files that do not(!) have one hard link.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark9986"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9330"></a><a name="bookmark9987"></a>9.7. solution : links</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Create two files named winter.txt and summer.txt, put some text in them.</span></p></li></ul>
<p><span class="font19">echo cold &gt;&nbsp;winter.txt ; echo hot &gt;&nbsp;summer.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Create a hard link to winter.txt named hlwinter.txt.</span></p></li></ul>
<p><span class="font19">ln winter.txt hlwinter.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">3. Display the inode numbers of these three files, the hard links should have the same inode.</span></p></li></ul>
<p><span class="font19">ls -li winter.txt summer.txt hlwinter.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Use the find command to list the two hardlinked files</span></p></li></ul>
<p><span class="font19">find . -inum xyz #replace xyz with the inode number</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Everything about a file is in the inode, except two things : name them!</span></p></li></ul>
<p><span class="font25">The name of the file is in a directory, and the contents is somewhere on the disk.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Create a symbolic link to summer.txt called slsummer.txt.</span></p></li></ul>
<p><span class="font19">ln -s summer.txt slsummer.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">7. Find all files with inode number 2. What does this information tell you ?</span></p></li></ul>
<p><span class="font25">It tells you there is more than one inode table (one for every formatted partition + virtual file systems)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">8. Look at the directories /etc/init.d/ /etc/rc.d/ /etc/rc3.d/ ... do you see the links ?</span></p></li></ul>
<p><span class="font19">ls -l /etc/init.d</span></p>
<p><span class="font19">ls -l /etc/rc2.d</span></p>
<p><span class="font19">ls -l /etc/rc3.d</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">9. Look in /lib with ls -l...</span></p></li></ul>
<p><span class="font19">ls -l /lib</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">10. Use </span><span class="font25" style="font-weight:bold;">find </span><span class="font25">to look in your home directory for regular files that do not(!) have one hard link. </span><span class="font19">find ~ ! -links 1 -type f</span></p></li></ul>
<p><a name="bookmark9988"></a><span class="font11" style="font-weight:bold;">Part III. iptables firewall</span></p>
<h3><a name="bookmark9989"></a><span class="font9" style="font-weight:bold;"><a name="bookmark9990"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9991"><span class="font24" style="font-weight:bold;">10. introduction to routers </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9992"><span class="font24">10.1. router or firewall </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9993"><span class="font24">10.2. packet forwarding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9994"><span class="font24">10.3. packet filtering </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9995"><span class="font24">10.4. stateful </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9996"><span class="font24">10.5. nat (network address translation) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9997"><span class="font24">10.6. pat (port address translation) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9998"><span class="font24">10.7. snat (source nat) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark9999"><span class="font24">10.8. masquerading </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10000"><span class="font24">10.9. dnat (destination nat) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10001"><span class="font24">10.10. port forwarding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10002"><span class="font24">10.11. /proc/sys/net/ipv4/ip_forward </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10003"><span class="font24">10.12. /etc/sysctl.conf </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10004"><span class="font24">10.13. sysctl </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10005"><span class="font24">10.14. practice: packet forwarding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10006"><span class="font24">10.15. solution: packet forwarding </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10007"><span class="font24" style="font-weight:bold;">11. iptables firewall </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10008"><span class="font24">11.1. iptables tables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10009"><span class="font24">11.2. starting and stopping iptables </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10010"><span class="font24">11.3. the filter table </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10011"><span class="font24">11.4. practice: packet filtering </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10012"><span class="font24">11.5. solution: packet filtering </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10013"><span class="font24">11.6. network address translation </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark10014"></a><span class="font11" style="font-weight:bold;"><a name="bookmark9332"></a><a name="bookmark10015"></a>Chapter 10. introduction to routers</span></h1></li></ul>
<p><span class="font25">What follows is a very brief introduction to using Linux as a router.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10016"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9333"></a><a name="bookmark10017"></a>10.1. router or firewall</span></h2></li></ul>
<p><a name="bookmark10018"></a><span class="font25"><a name="bookmark10019"></a>A </span><span class="font25" style="font-weight:bold;">router </span><span class="font25">is a device that connects two networks. A </span><span class="font25" style="font-weight:bold;">firewall </span><span class="font25">is a device that besides acting as a </span><span class="font25" style="font-weight:bold;">router</span><span class="font25">, also contains (and implements) rules to determine whether packets are allowed to travel from one network to another. A firewall can be configured to block access based on networks, hosts, protocols and ports. Firewalls can also change the contents of packets while forwarding them.</span></p><img src="linux_guide_files/The Complete Linux Guide-157.jpg" alt="" style="width:397pt;height:120pt;">
<ul style="list-style:none;"><li>
<h2><a name="bookmark10020"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9334"></a><a name="bookmark10021"></a>10.2. packet forwarding</span></h2></li></ul>
<p><a name="bookmark10022"></a><span class="font25" style="font-weight:bold;">Packet forwarding </span><span class="font25">means allowing packets to go from one network to another. When a multihomed host is connected to two different networks, and it allows packets to travel from one network to another through its two network interfaces, it is said to have enabled </span><span class="font25" style="font-weight:bold;">packet forwarding</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10023"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9335"></a><a name="bookmark10024"></a>10.3. packet filtering</span></h2></li></ul>
<p><a name="bookmark10025"></a><span class="font25" style="font-weight:bold;">Packet filtering </span><span class="font25">is very similar to packet forwarding, but every packet is individually tested against rules that decide on allowing or dropping the packet. The rules are stored by iptables.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10026"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9336"></a><a name="bookmark10027"></a>10.4. stateful</span></h2></li></ul>
<p><a name="bookmark10028"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">stateful </span><span class="font25">firewall is an advancement over stateless firewalls that inspect every individual packet. A stateful firewall will keep a table of active connections, and is knowledgeable enough to recognise when new connections are part of an active session. Linux iptables is a stateful firewall.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10029"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9337"></a><a name="bookmark10030"></a>10.5. nat (network address translation)</span></h2></li></ul>
<p><a name="bookmark10031"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">nat </span><span class="font25">device is a router that is also changing the source and/or target ip-address in packets. It is typically used to connect multiple computers in a private address range (rfc 1918) with the (public) internet. A </span><span class="font25" style="font-weight:bold;">nat </span><span class="font25">can hide private addresses from the internet.</span></p>
<p><span class="font25">It is important to understand that people and vendors do not always use the right term when referring to a certain type of </span><span class="font25" style="font-weight:bold;">nat</span><span class="font25">. Be sure you talk about the same thing. We can distuinguish several types of </span><span class="font25" style="font-weight:bold;">nat</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10032"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9338"></a><a name="bookmark10033"></a>10.6. pat (port address translation)</span></h2></li></ul>
<p><a name="bookmark10034"></a><span class="font25" style="font-weight:bold;"><a name="bookmark10035"></a>nat </span><span class="font25">often includes </span><span class="font25" style="font-weight:bold;">pat</span><span class="font25">. A </span><span class="font25" style="font-weight:bold;">pat </span><span class="font25">device is a router that is also changing the source and/or target tcp/udp port in packets. </span><span class="font25" style="font-weight:bold;">pat </span><span class="font25">is Cisco terminology and is used by </span><span class="font25" style="font-weight:bold;">snat</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">dnat</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">masquerading </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">port forwarding </span><span class="font25">in Linux. RFC 3022 calls it </span><span class="font25" style="font-weight:bold;">NAPT </span><span class="font25">and defines the </span><span class="font25" style="font-weight:bold;">nat/pat </span><span class="font25">combo as &quot;traditional nat&quot;. A device sold to you as a nat-device will probably do </span><span class="font25" style="font-weight:bold;">nat </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">pat</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10036"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9339"></a><a name="bookmark10037"></a>10.7. snat (source nat)</span></h2></li></ul>
<p><a name="bookmark10038"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">snat </span><span class="font25">device is changing the source ip-address when a packet passes our </span><span class="font25" style="font-weight:bold;">nat</span><span class="font25">. </span><span class="font25" style="font-weight:bold;">snat </span><span class="font25">configuration with iptables includes a fixed target source address.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10039"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9340"></a><a name="bookmark10040"></a>10.8. masquerading</span></h2></li></ul>
<p><a name="bookmark10041"></a><span class="font25" style="font-weight:bold;">Masquerading </span><span class="font25">is a form of </span><span class="font25" style="font-weight:bold;">snat </span><span class="font25">that will hide the (private) source ip-addresses of your private network using a public ip-address. Masquerading is common on dynamic internet interfaces (broadband modem/routers). Masquerade configuration with iptables uses a dynamic target source address.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10042"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9341"></a><a name="bookmark10043"></a>10.9. dnat (destination nat)</span></h2></li></ul>
<p><a name="bookmark10044"></a><span class="font25">A </span><span class="font25" style="font-weight:bold;">dnat </span><span class="font25">device is changing the destination ip-address when a packet passes our </span><span class="font25" style="font-weight:bold;">nat</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10045"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9342"></a><a name="bookmark10046"></a>10.10. port forwarding</span></h2></li></ul>
<p><a name="bookmark10047"></a><span class="font25">When static </span><span class="font25" style="font-weight:bold;">dnat </span><span class="font25">is set up in a way that allows outside connections to enter our private network, then we call it </span><span class="font25" style="font-weight:bold;">port forwarding</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10048"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9343"></a><a name="bookmark10049"></a>10.11. /proc/sys/net/ipv4/ip_forward</span></h2></li></ul>
<p><a name="bookmark10050"></a><span class="font25">Whether a host is forwarding packets is defined in </span><span class="font25" style="font-weight:bold;">/proc/sys/net/ipv4/ip_forward</span><span class="font25">. The following screenshot shows how to enable packet forwarding on Linux.</span></p>
<p><span class="font19">root@router~# echo 1 &gt;&nbsp;/proc/sys/net/ipv4/ip_forward</span></p>
<p><span class="font25">The next command shows how to disable packet forwarding.</span></p>
<p><span class="font19">root@router~# echo 0 &gt;&nbsp;/proc/sys/net/ipv4/ip_forward</span></p>
<p><span class="font25">Use cat to check if packet forwarding is enabled.</span></p>
<p><span class="font19">root@router~# cat /proc/sys/net/ipv4/ip_forward</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10051"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9344"></a><a name="bookmark10052"></a>10.12. /etc/sysctl.conf</span></h2></li></ul>
<p><a name="bookmark10053"></a><span class="font25">By default, most Linux computers are not configured for automatic packet forwarding. To enable packet forwarding whenever the system starts, change the </span><span class="font25" style="font-weight:bold;">net.ipv4.ip_forward </span><span class="font25">variable in </span><span class="font25" style="font-weight:bold;">/etc/sysctl.conf </span><span class="font25">to the value 1.</span></p>
<p><span class="font19">root@router~# grep ip_forward /etc/sysctl.conf net.ipv4.ip_forward = 0</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10054"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9345"></a><a name="bookmark10055"></a>10.13. sysctl</span></h2></li></ul>
<p><a name="bookmark10056"></a><span class="font25">For more information, take a look at the man page of </span><span class="font25" style="font-weight:bold;">sysctl</span><span class="font25">.</span></p>
<p><span class="font19">root@debian6~# man sysctl</span></p>
<p><span class="font19">root@debian6~# sysctl -a 2&gt;/dev/null | grep ip_forward</span></p>
<p><span class="font19">net.ipv4.ip_forward = 0</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10057"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9346"></a><a name="bookmark10058"></a>10.14. practice: packet forwarding</span></h2></li></ul>
<p><a name="bookmark10059"></a><span class="font25"><a name="bookmark10060"></a>0. You have the option to select (or create) an internal network when adding a network card in </span><span class="font25" style="font-weight:bold;">VirtualBox </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">VMWare</span><span class="font25">. Use this option to create two internal networks. I named them </span><span class="font25" style="font-weight:bold;">leftnet </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">rightnet</span><span class="font25">, but you can choose any other name.</span></p>
<p><span class="font25" style="font-weight:bold;">IsP Network</span></p>
<p><span class="font5">Adapter 1. </span><span class="font25" style="font-weight:bold;">Intel </span><span class="font5">PRO/1000 MT Desktop (Bridged Adapter, enl: AirPort)</span></p>
<p><span class="font5">Adapter 2: &nbsp;Intel PRO/1000 MT Desktop (Internal Network, 'Ie ft net<sup>1</sup>)</span></p>
<p><span class="font5">Adapter 3: Intel PRO/1000 MT Desktop (Internal Network, 'rightnet')</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Set up two Linux machines, one on </span><span class="font25" style="font-weight:bold;">leftnet</span><span class="font25">, the other on </span><span class="font25" style="font-weight:bold;">rightnet</span><span class="font25">. Make sure they both get an ip-address in the correct subnet. These two machines will be 'left' and 'right' from the 'router'.</span></p><img src="linux_guide_files/The Complete Linux Guide-158.jpg" alt="" style="width:403pt;height:143pt;"></li>
<li>
<p><a name="bookmark10061"></a><span class="font25"><a name="bookmark10062"></a>2. Set up a third Linux computer with three network cards, one on </span><span class="font25" style="font-weight:bold;">leftnet</span><span class="font25">, the other on </span><span class="font25" style="font-weight:bold;">rightnet</span><span class="font25">. This computer will be the 'router'. Complete the table below with the relevant names, ip-addresses and </span><span class="font25" style="font-weight:bold;">mac-addresses</span><span class="font25">.</span></p></li></ul>
<p><span class="font25" style="font-weight:bold;">Table 10.1. Packet Forwarding Exercise</span></p>
<table border="1">
<tr><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">leftnet computer</span></p></td><td colspan="2" style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">the router</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">rightnet computer</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">MAC</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">IP</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td><td style="vertical-align:top;"></td></tr>
</table>
<ul style="list-style:none;"><li>
<p><a name="bookmark10063"></a><span class="font25">3. How can you verify whether the </span><span class="font25" style="font-weight:bold;">router </span><span class="font25">will allow packet forwarding by default or not ? Test that you can </span><span class="font25" style="font-weight:bold;">ping </span><span class="font25">from the </span><span class="font25" style="font-weight:bold;">router </span><span class="font25">to the two other machines, and from those two machines to the </span><span class="font25" style="font-weight:bold;">router</span><span class="font25">. Use </span><span class="font25" style="font-weight:bold;">arp -a </span><span class="font25">to make sure you are connected with the correct </span><span class="font25" style="font-weight:bold;">mac addresses</span><span class="font25">.</span></p></li>
<li>
<p><a name="bookmark10064"></a><span class="font25">4.</span><span class="font25" style="font-weight:bold;"> Ping </span><span class="font25">from the leftnet computer to the rightnet computer. Enable and/or disable packet forwarding on the </span><span class="font25" style="font-weight:bold;">router </span><span class="font25">and verify what happens to the ping between the two networks. If you do not succeed in pinging between the two networks (on different subnets), then use a sniffer like </span><span class="font25" style="font-weight:bold;">wireshark </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">tcpdump </span><span class="font25">to discover the problem.</span></p></li>
<li>
<p><a name="bookmark10065"></a><span class="font25"><a name="bookmark10066"></a>5. Use </span><span class="font25" style="font-weight:bold;">wireshark </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">tcpdump </span><span class="font25">-xx to answer the following questions. Does the source MAC change when a packet passes through the filter ? And the destination MAC ? What about source and destination IP-addresses ?</span></p></li>
<li>
<p><a name="bookmark10067"></a><span class="font25">6. Remember the third network card on the router ? Connect this card to a LAN with internet connection. On many LAN's the command </span><span class="font25" style="font-weight:bold;">dhclient eth0 </span><span class="font25">just works (replace </span><span class="font25" style="font-weight:bold;">eth0 </span><span class="font25">with the correct interface).</span></p></li></ul>
<p><span class="font19">root@router~# dhclient eth0</span></p>
<p><span class="font25">You now have a setup similar to this picture. What needs to be done to give internet access to </span><span class="font25" style="font-weight:bold;">leftnet </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">rightnet</span><span class="font25">.</span></p><img src="linux_guide_files/The Complete Linux Guide-159.jpg" alt="" style="width:403pt;height:219pt;">
<ul style="list-style:none;"><li>
<h2><a name="bookmark10068"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9347"></a><a name="bookmark10069"></a>10.15. solution: packet forwarding</span></h2></li></ul>
<p><span class="font25" style="font-weight:bold;">Is? Network</span></p>
<p><span class="font5">Adapter 1. Intel PRO/1000 MT Desktop (Bridged Adapter, enl: AirPort)</span></p>
<p><span class="font5">Adapter 2: &nbsp;Intel PRO/1000 MT Desktop (Internal Network, 'Ie ft net<sup>1</sup>)</span></p>
<p><span class="font5">Adapter 3: Intel PRO/1000 MT Desktop (Internal Network, 'rightnet’)</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Set up two Linux machines, one on </span><span class="font25" style="font-weight:bold;">leftnet</span><span class="font25">, the other on </span><span class="font25" style="font-weight:bold;">rightnet</span><span class="font25">. Make sure they both get an ip-address in the correct subnet. These two machines will be 'left' and 'right' from the 'router'.</span></p><img src="linux_guide_files/The Complete Linux Guide-160.jpg" alt="" style="width:403pt;height:143pt;"></li></ul>
<p><span class="font25">The ip configuration on your computers should be similar to the following two screenshots. Both machines must be in a different subnet (here 192.168.60.0/24 and 192.168.70.0/24). I created a little script on both machines to configure the interfaces.</span></p>
<p><span class="font19">root@left~# cat leftnet.sh pkill dhclient</span></p>
<p><span class="font19">ifconfig eth0 192.168.60.8 netmask 255.255.255.0</span></p>
<p><span class="font19">root@right~# cat rightnet.sh pkill dhclient</span></p>
<p><span class="font19">ifconfig eth0 192.168.70.9 netmask 255.255.255.0</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">2. Set up a third Linux computer with three network cards, one on </span><span class="font25" style="font-weight:bold;">leftnet</span><span class="font25">, the other on </span><span class="font25" style="font-weight:bold;">rightnet</span><span class="font25">. This computer will be the 'router'. Complete the table below with the relevant names, ip-addresses and mac-addresses.</span></p></li></ul>
<p><span class="font19">root@router~# cat router.sh</span></p>
<p><span class="font19">ifconfig eth1 192.168.60.1 netmask 255.255.255.0</span></p>
<p><span class="font19">ifconfig eth2 192.168.70.1 netmask 255.255.255.0</span></p>
<p><span class="font19">#echo 1 &gt;&nbsp;/proc/sys/net/ipv4/ip_forward</span></p>
<p><a name="bookmark10070"></a><span class="font25">Your setup may use different ip and mac addresses than the ones in the table below.</span></p>
<p><span class="font25" style="font-weight:bold;">Table 10.2. Packet Forwarding Solution</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">leftnet computer</span></p></td><td colspan="2" style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">the router</span></p></td><td style="vertical-align:top;">
<p><span class="font24" style="font-weight:bold;">rightnet computer</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">08:00:27:f6:ab:b9</span></p></td><td style="vertical-align:top;">
<p><span class="font24">08:00:27:43:1f:5a</span></p></td><td style="vertical-align:top;">
<p><span class="font24">08:00:27:be:4a:6b</span></p></td><td style="vertical-align:top;">
<p><span class="font24">08:00:27:14:8b:17</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font24">192.168.60.8</span></p></td><td style="vertical-align:top;">
<p><span class="font24">192.168.60.1</span></p></td><td style="vertical-align:top;">
<p><span class="font24">192.168.70.1</span></p></td><td style="vertical-align:top;">
<p><span class="font24">192.168.70.9</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<p><span class="font25">3. How can you verify whether the </span><span class="font25" style="font-weight:bold;">router </span><span class="font25">will allow packet forwarding by default or not ? Test that you can ping from the </span><span class="font25" style="font-weight:bold;">router </span><span class="font25">to the two other machines, and from those two machines to the </span><span class="font25" style="font-weight:bold;">router</span><span class="font25">. Use </span><span class="font25" style="font-weight:bold;">arp -a </span><span class="font25">to make sure you are connected with the correct </span><span class="font25" style="font-weight:bold;">mac addresses</span><span class="font25">.</span></p></li></ul>
<p><span class="font25">This can be done with &quot;</span><span class="font25" style="font-weight:bold;">grep ip_forward /etc/sysctl.conf</span><span class="font25">&quot; (1 is enabled, 0 is disabled) or with </span><span class="font25" style="font-weight:bold;">sysctl -a | grep ip_for</span><span class="font25">.</span></p>
<p><span class="font19">root@router~# grep ip_for /etc/sysctl.conf net.ipv4.ip_forward = 0</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">4. Ping from the leftnet computer to the rightnet computer. Enable and/or disable packet forwarding on the </span><span class="font25" style="font-weight:bold;">router </span><span class="font25">and verify what happens to the ping between the two networks. If you do not succeed in pinging between the two networks (on different subnets), then use a sniffer like wireshark or tcpdump to discover the problem.</span></p></li></ul>
<p><span class="font25">Did you forget to add a </span><span class="font25" style="font-weight:bold;">default gateway </span><span class="font25">to the LAN machines ? Use </span><span class="font25" style="font-weight:bold;">route add default gw 'ip-address'</span><span class="font25">.</span></p>
<p><span class="font19">root@left~# route add default gw 192.168.60.1</span></p>
<p><span class="font19">root@right~# route add default gw 192.168.70.1</span></p>
<p><span class="font25">You should be able to ping when packet forwarding is enabled (and both default gateways are properly configured). The ping will not work when packet forwarding is disabled or when gateways are not configured correctly.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">5. Use wireshark or tcpdump -xx to answer the following questions. Does the source MAC change when a packet passes through the filter ? And the destination MAC ? What about source and destination IP-addresses ?</span></p></li></ul>
<p><span class="font25">Both MAC addresses are changed when passing the router. Use </span><span class="font25" style="font-weight:bold;">tcpdump -xx </span><span class="font25">like this:</span></p>
<p><span class="font19">root@router~# tcpdump -xx -i eth1</span></p>
<p><span class="font19">root@router~# tcpdump -xx -i eth2</span></p>
<ul style="list-style:none;"><li>
<p><span class="font25">6. Remember the third network card on the router ? Connect this card to a LAN with internet connection. On many LAN's the command </span><span class="font25" style="font-weight:bold;">dhclient eth0 </span><span class="font25">just works (replace </span><span class="font25" style="font-weight:bold;">eth0 </span><span class="font25">with the correct interface.</span></p></li></ul>
<p><span class="font19">root@router~# dhclient eth0</span></p>
<p><span class="font25">You now have a setup similar to this picture. What needs to be done to give internet access to </span><span class="font25" style="font-weight:bold;">leftnet </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">rightnet</span><span class="font25">.</span></p><img src="linux_guide_files/The Complete Linux Guide-161.jpg" alt="" style="width:403pt;height:219pt;">
<p><span class="font25">The clients on </span><span class="font25" style="font-weight:bold;">leftnet </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">rightnet </span><span class="font25">need a working </span><span class="font25" style="font-weight:bold;">dns server</span><span class="font25">. We use one of Google's dns servers here.</span></p>
<p><span class="font19">echo nameserver 8.8.8.8 &gt;&nbsp;/etc/resolv.conf</span></p>
<ul style="list-style:none;"><li>
<h1><a name="bookmark10071"></a><span class="font11" style="font-weight:bold;"><a name="bookmark9348"></a><a name="bookmark10072"></a>Chapter 11. iptables firewall</span></h1></li></ul>
<p><span class="font25">This chapter introduces some simple firewall rules and how to configure them with </span><span class="font25" style="font-weight:bold;">iptables</span><span class="font25">.</span></p>
<p><a name="bookmark10073"></a><span class="font25" style="font-weight:bold;">iptables </span><span class="font25">is an application that allows a user to configure the firewall functionality built into the </span><span class="font25" style="font-weight:bold;">Linux </span><span class="font25">kernel.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10074"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9349"></a><a name="bookmark10075"></a>11.1. iptables tables</span></h2></li></ul>
<h4><a name="bookmark10076"></a><span class="font25"><a name="bookmark10077"></a><a name="bookmark10078"></a>By default there are three </span><span class="font25" style="font-weight:bold;">tables </span><span class="font25">in the kernel that contain sets of rules.</span><br><br><a name="bookmark10079"></a><span class="font25"><a name="bookmark10080"></a>The </span><span class="font25" style="font-weight:bold;">filter table </span><span class="font25">is used for packet filtering.</span></h4>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">root@debian6~# iptables -t filter Chain INPUT (policy ACCEPT) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source</span></p></td><td style="vertical-align:top;">
<p><span class="font19">-L</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">destination</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">Chain FORWARD (policy ACCEPT) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">destination</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">Chain OUTPUT (policy ACCEPT) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">destination</span></p></td></tr>
</table>
<h4><a name="bookmark10081"></a><span class="font25"><a name="bookmark10082"></a><a name="bookmark10083"></a>The </span><span class="font25" style="font-weight:bold;">nat table </span><span class="font25">is used for address translation.</span></h4>
<table border="1">
<tr><td style="vertical-align:top;">
<p><span class="font19">root@debian6~# iptables -t nat -L Chain PREROUTING (policy ACCEPT) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">destination</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">Chain POSTROUTING (policy ACCEPT) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">destination</span></p></td></tr>
<tr><td style="vertical-align:middle;">
<p><span class="font19">Chain OUTPUT (policy ACCEPT) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">destination</span></p></td></tr>
</table>
<h4><a name="bookmark10084"></a><span class="font25"><a name="bookmark10085"></a><a name="bookmark10086"></a>The </span><span class="font25" style="font-weight:bold;">mangle table </span><span class="font25">can be used for special-purpose processing of packets.</span></h4>
<h4><a name="bookmark10087"></a><span class="font25"><a name="bookmark10088"></a><a name="bookmark10089"></a>Series of rules in each table are called a </span><span class="font25" style="font-weight:bold;">chain</span><span class="font25">. We will discuss chains and the nat table later in this chapter.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10090"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9350"></a><a name="bookmark10091"></a>11.2. starting and stopping iptables</span></h2></li></ul>
<h4><a name="bookmark10092"></a><span class="font25"><a name="bookmark10093"></a>The following screenshot shows how to stop and start </span><span class="font25" style="font-weight:bold;">iptables </span><span class="font25">on Red Hat/Fedora/CentOS and compatible distributions.</span></h4>
<p><span class="font19">[root@centos6 ~]# service iptables stop</span></p>
<p><span class="font19">[root@centos6 ~]# service iptables start</span></p>
<p><span class="font19">iptables: Applying firewall rules &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ ok ]</span></p>
<p><span class="font19">[root@centos6 ~]#</span></p>
<h4><a name="bookmark10094"></a><span class="font25"><a name="bookmark10095"></a>Debian and *buntu distributions do not have this script, but allow for an uninstall.</span></h4>
<p><span class="font19">root@debian6~# aptitude purge iptables</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10096"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9351"></a><a name="bookmark10097"></a>11.3. the filter table</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark9994"></a><span class="font9" style="font-weight:bold;"><a name="bookmark10098"></a>11.3.1. about packet filtering</span></h3></li></ul></li></ul>
<p><a name="bookmark10099"></a><span class="font25" style="font-weight:bold;">Packet filtering </span><span class="font25">is a bit more than </span><span class="font25" style="font-weight:bold;">packet forwarding</span><span class="font25">. While </span><span class="font25" style="font-weight:bold;">packet forwarding </span><span class="font25">uses only a routing table to make decisions, </span><span class="font25" style="font-weight:bold;">packet filtering </span><span class="font25">also uses a list of rules. The kernel will inspect packets and decide based on these rules what to do with each packet.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark10010"></a><span class="font9" style="font-weight:bold;"><a name="bookmark10100"></a>11.3.2. filter table</span></h3></li></ul>
<p><span class="font25">The filter table in </span><span class="font25" style="font-weight:bold;">iptables </span><span class="font25">has three chains (sets of rules). The INPUT chain is used for any packet coming into the system. The OUTPUT chain is for any packet leaving the system. And the FORWARD chain is for packets that are forwarded (routed) through the system.</span></p><img src="linux_guide_files/The Complete Linux Guide-162.jpg" alt="" style="width:397pt;height:163pt;">
<p><span class="font25">The screenshot below shows how to list the filter table and all its rules.</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -t filter -nL</span></p>
<p><span class="font19">Chain INPUT (policy ACCEPT) target prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">Chain FORWARD (policy ACCEPT) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">Chain OUTPUT (policy ACCEPT) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<p><span class="font25">As you can see, all three chains in the filter table are set to ACCEPT everything. ACCEPT is the default behaviour.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark10101"></a><span class="font9" style="font-weight:bold;"><a name="bookmark10102"></a>11.3.3. setting default rules</span></h3></li></ul>
<p><span class="font25">The default for the default rule is indeed to ACCEPT everything. This is not the most secure firewall.</span></p>
<p><span class="font25">A more secure setup would be to DROP everything. A package that is </span><span class="font25" style="font-weight:bold;">dropped </span><span class="font25">will not continue in any chain, and no warning or error will be sent anywhere.</span></p>
<p><span class="font25">The below commands lock down a computer. Do not execute these commands inside a remote ssh shell.</span></p>
<p><span class="font19">root@debianpaul~# iptables -P INPUT DROP</span></p>
<p><span class="font19">root@debianpaul~# iptables -P OUTPUT DROP</span></p>
<p><span class="font19">root@debianpaul~# iptables -P FORWARD DROP</span></p>
<p><span class="font19">root@debianpaul~# iptables -L</span></p>
<p><span class="font19">Chain INPUT (policy DROP)</span></p>
<p><span class="font19">target prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">Chain FORWARD (policy DROP)</span></p>
<p><span class="font19">target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">Chain OUTPUT (policy DROP)</span></p>
<p><span class="font19">target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark10103"></a><span class="font9" style="font-weight:bold;"><a name="bookmark10104"></a>11.3.4. changing policy rules</span></h3></li></ul>
<p><span class="font25">To start, let's set the default policy for all three chains to drop everything. Note that you might lose your connection when typing this over ssh ;-).</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -P INPUT DROP</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -P FORWARD DROP</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -P OUTPUT DROP</span></p>
<p><span class="font25">Next, we allow the server to use its own loopback device (this allows the server to access its services running on localhost). We first append a rule to the INPUT chain to allow (ACCEPT) traffic from the lo (loopback) interface, then we do the same to allow packets to leave the system through the loopback interface.</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -A INPUT -i lo -j ACCEPT</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -A OUTPUT -o lo -j ACCEPT</span></p>
<p><span class="font25">Looking at the filter table again (omitting -t filter because it is the default table).</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -nL Chain INPUT (policy DROP) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source</span></p>
<div>
<p><span class="font19">destination 0.0.0.0/0</span></p>
</div><br clear="all">
<p><span class="font19">ACCEPT &nbsp;&nbsp;&nbsp;&nbsp;all -- 0.0.0.0/0</span></p>
<p><span class="font19">Chain FORWARD (policy DROP) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">Chain OUTPUT (policy DROP) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">ACCEPT &nbsp;&nbsp;&nbsp;&nbsp;all &nbsp;-- &nbsp;0.0.0.0/0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0/0</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark10105"></a><span class="font9" style="font-weight:bold;"><a name="bookmark10106"></a>11.3.5. Allowing ssh over eth0</span></h3></li></ul>
<h4><a name="bookmark10107"></a><span class="font25"><a name="bookmark10108"></a>This example show how to add two rules to allow ssh access to your system from outside.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# iptables -A INPUT -i eth0 -p tcp --dport 22 -j ACCEPT</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -A OUTPUT -o eth0 -p tcp --sport 22 -j ACCEPT</span></p>
<h4><a name="bookmark10109"></a><span class="font25"><a name="bookmark10110"></a>The filter table will look something like this screenshot (note that -v is added for more verbose output).</span></h4>
<p><span class="font19">[root@RHEL5 ~]# iptables -nvL</span></p>
<p><span class="font19">Chain INPUT (policy DROP 7 packets, 609 bytes) pkts bytes target prot opt in &nbsp;&nbsp;&nbsp;out &nbsp;&nbsp;source &nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;0 ACCEPT all &nbsp;-- &nbsp;lo &nbsp;&nbsp;&nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0/0 &nbsp;0.0.0.0/0</span></p>
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;0 ACCEPT tcp &nbsp;-- &nbsp;eth0 &nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0/0 &nbsp;0.0.0.0/0 tcp dpt:22</span></p>
<p><span class="font19">Chain FORWARD (policy DROP 0 packets, 0 bytes) pkts bytes target prot opt in &nbsp;&nbsp;&nbsp;out &nbsp;&nbsp;source &nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">Chain OUTPUT (policy DROP 3 packets, 228 bytes) pkts bytes target prot opt in &nbsp;&nbsp;&nbsp;out &nbsp;&nbsp;source &nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;0 ACCEPT all &nbsp;-- &nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;lo &nbsp;&nbsp;&nbsp;0.0.0.0/0 &nbsp;0.0.0.0/0</span></p>
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;0 ACCEPT tcp &nbsp;-- &nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;eth0 &nbsp;0.0.0.0/0 &nbsp;0.0.0.0/0 tcp spt:22</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark10111"></a><span class="font9" style="font-weight:bold;"><a name="bookmark10112"></a>11.3.6. Allowing access from a subnet</span></h3></li></ul>
<h4><a name="bookmark10113"></a><span class="font25"><a name="bookmark10114"></a>This example shows how to allow access from any computer in the 10.1.1.0/24 network, but only through eth1. There is no port (application) limitation here.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# iptables -A INPUT -i eth1 -s 10.1.1.0/24 -p tcp -j ACCEPT</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -A OUTPUT -o eth1 -d 10.1.1.0/24 -p tcp -j ACCEPT</span></p>
<h4><a name="bookmark10115"></a><span class="font25"><a name="bookmark10116"></a>Together with the previous examples, the policy is expanding.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# iptables -nvL</span></p>
<p><span class="font19">Chain INPUT (policy DROP 7 packets, 609 bytes)</span></p>
<p><span class="font19">pkts bytes target prot opt in &nbsp;&nbsp;&nbsp;out &nbsp;&nbsp;source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;0 ACCEPT all &nbsp;-- &nbsp;lo &nbsp;&nbsp;&nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0/0 &nbsp;&nbsp;0.0.0.0/0</span></p>
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;0 ACCEPT tcp &nbsp;-- &nbsp;eth0 &nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0/0 &nbsp;&nbsp;0.0.0.0/0 &nbsp;tcp dpt:22</span></p>
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;0 ACCEPT tcp &nbsp;-- &nbsp;eth1 &nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;10.1.1.0/24 0.0.0.0/0</span></p>
<p><span class="font19">Chain FORWARD (policy DROP 0 packets, 0 bytes) pkts bytes target prot opt in out source destination</span></p>
<p><span class="font19">Chain OUTPUT (policy DROP 3 packets, 228 bytes) pkts bytes target prot opt in &nbsp;&nbsp;&nbsp;out &nbsp;&nbsp;source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;0 ACCEPT all &nbsp;-- &nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;lo &nbsp;&nbsp;&nbsp;0.0.0.0/0 &nbsp;&nbsp;0.0.0.0/0</span></p>
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;0 ACCEPT tcp &nbsp;-- &nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;eth0 &nbsp;0.0.0.0/0 &nbsp;&nbsp;0.0.0.0/0 tcp spt:22</span></p>
<p><span class="font19">0 &nbsp;&nbsp;&nbsp;&nbsp;0 ACCEPT tcp &nbsp;-- &nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;eth1 &nbsp;0.0.0.0/0 &nbsp;&nbsp;10.1.1.0/24</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark10117"></a><span class="font9" style="font-weight:bold;"><a name="bookmark10118"></a>11.3.7. iptables save</span></h3></li></ul>
<h4><a name="bookmark10119"></a><span class="font25"><a name="bookmark10120"></a><a name="bookmark10121"></a>Use </span><span class="font25" style="font-weight:bold;">iptables save </span><span class="font25">to automatically implement these rules when the firewall is (re)started.</span></h4>
<p><span class="font19">[root@RHEL5 ~]# /etc/init.d/iptables save</span></p>
<p><span class="font19">Saving firewall rules to /etc/sysconfig/iptables: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark10122"></a><span class="font9" style="font-weight:bold;"><a name="bookmark10123"></a>11.3.8. scripting example</span></h3></li></ul>
<h4><a name="bookmark10124"></a><span class="font25"><a name="bookmark10125"></a>You can write a simple script for these rules. Below is an example script that implements the firewall rules that you saw before in this chapter.</span></h4>
<p><span class="font19">#!/bin/bash</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># first cleanup everything iptables -t filter -F iptables -t filter -X iptables -t nat -F iptables -t nat -X</span></p></li>
<li>
<p><span class="font19"># default drop</span></p></li></ul>
<p><span class="font19">iptables -P INPUT DROP</span></p>
<p><span class="font19">iptables -P FORWARD DROP iptables -P OUTPUT DROP</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># allow loopback device</span></p></li></ul>
<p><span class="font19">iptables -A INPUT -i lo -j ACCEPT iptables -A OUTPUT -o lo -j ACCEPT</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># allow ssh over eth0 from outside to system</span></p></li></ul>
<p><span class="font19">iptables -A INPUT -i eth0 -p tcp --dport 22 -j ACCEPT</span></p>
<p><span class="font19">iptables -A OUTPUT -o eth0 -p tcp --sport 22 -j ACCEPT</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># allow any traffic from 10.1.1.0/24 to system</span></p></li></ul>
<p><span class="font19">iptables -A INPUT -i eth1 -s 10.1.1.0/24 -p tcp -j ACCEPT</span></p>
<p><span class="font19">iptables -A OUTPUT -o eth1 -d 10.1.1.0/24 -p tcp -j ACCEPT</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark10126"></a><span class="font9" style="font-weight:bold;"><a name="bookmark10127"></a>11.3.9. Allowing ICMP(ping)</span></h3></li></ul>
<p><span class="font25">When you enable iptables, you will get an </span><span class="font25" style="font-weight:bold;">'Operation not permitted' </span><span class="font25">message when trying to ping other hosts.</span></p>
<p><span class="font19">[root@RHEL5 ~# ping 192.168.187.130</span></p>
<p><span class="font19">PING 192.168.187.130 (192.168.187.130) 56(84) bytes of data.</span></p>
<p><span class="font19">ping: sendmsg: Operation not permitted</span></p>
<p><span class="font19">ping: sendmsg: Operation not permitted</span></p>
<p><span class="font25">The screenshot below shows you how to setup iptables to allow a ping from or to your machine.</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -A INPUT -p icmp --icmp-type any -j ACCEPT [root@RHEL5 ~]# iptables -A OUTPUT -p icmp --icmp-type any -j ACCEPT</span></p>
<p><span class="font25">The previous two lines do not allow other computers to route ping messages through your router, because it only handles INPUT and OUTPUT. For routing of ping, you will need to enable it on the FORWARD chain. The following command enables routing of icmp messages between networks.</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -A FORWARD -p icmp --icmp-type any -j ACCEPT</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10128"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9352"></a><a name="bookmark10129"></a>11.4. practice: packet filtering</span></h2></li></ul>
<ul style="list-style:none;"><li>
<p><span class="font25">1. Make sure you can ssh to your router-system when iptables is active.</span></p></li>
<li>
<p><span class="font25">2. Make sure you can ping to your router-system when iptables is active.</span></p></li>
<li>
<p><span class="font25">3. Define one of your networks as 'internal' and the other as 'external'. Configure the router to allow visits to a website (http) to go from the internal network to the external network (but not in the other direction).</span></p></li>
<li>
<p><span class="font25">4. Make sure the internal network can ssh to the external, but not the other way around.</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10130"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9353"></a><a name="bookmark10131"></a>11.5. solution: packet filtering</span></h2></li></ul>
<h4><a name="bookmark10132"></a><span class="font25"><a name="bookmark10133"></a>A possible solution, where leftnet is the internal and rightnet is the external network.</span></h4>
<p><span class="font19">#!/bin/bash</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># first cleanup everything iptables -t filter -F iptables -t filter -X iptables -t nat -F iptables -t nat -X</span></p></li>
<li>
<p><span class="font19"># default drop</span></p></li></ul>
<p><span class="font19">iptables -P INPUT DROP</span></p>
<p><span class="font19">iptables -P FORWARD DROP iptables -P OUTPUT DROP</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># allow loopback device</span></p></li></ul>
<p><span class="font19">iptables -A INPUT -i lo -j ACCEPT iptables -A OUTPUT -o lo -j ACCEPT</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># question 1: allow ssh over eth0</span></p></li></ul>
<p><span class="font19">iptables -A INPUT -i eth0 -p tcp --dport 22 -j ACCEPT iptables -A OUTPUT -o eth0 -p tcp --sport 22 -j ACCEPT</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># question 2: Allow icmp(ping) anywhere</span></p></li></ul>
<p><span class="font19">iptables -A INPUT -p icmp --icmp-type any -j ACCEPT</span></p>
<p><span class="font19">iptables -A FORWARD -p icmp --icmp-type any -j ACCEPT iptables -A OUTPUT -p icmp --icmp-type any -j ACCEPT</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># question 3: allow http from internal(leftnet) to external(rightnet) iptables -A FORWARD -i eth1 -o eth2 -p tcp --dport 80 -j ACCEPT</span></p></li></ul>
<p><span class="font19">iptables -A FORWARD -i eth2 -o eth1 -p tcp --sport 80 -j ACCEPT</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># question 4: allow ssh from internal(leftnet) to external(rightnet) iptables -A FORWARD -i eth1 -o eth2 -p tcp --dport 22 -j ACCEPT</span></p></li></ul>
<p><span class="font19">iptables -A FORWARD -i eth2 -o eth1 -p tcp --sport 22 -j ACCEPT</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># allow http from external(rightnet) to internal(leftnet)</span></p></li>
<li>
<p><span class="font19"># iptables -A FORWARD -i eth2 -o eth1 -p tcp --dport 80 -j ACCEPT</span></p></li>
<li>
<p><span class="font19"># iptables -A FORWARD -i eth1 -o eth2 -p tcp --sport 80 -j ACCEPT</span></p></li>
<li>
<p><span class="font19"># allow rpcinfo over eth0 from outside to system</span></p></li>
<li>
<p><span class="font19"># iptables -A INPUT -i eth2 -p tcp --dport 111 -j ACCEPT</span></p></li>
<li>
<p><span class="font19"># iptables -A OUTPUT -o eth2 -p tcp --sport 111 -j ACCEPT</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10134"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9354"></a><a name="bookmark10135"></a>11.6. network address translation</span></h2>
<ul style="list-style:none;">
<li>
<h3><a name="bookmark10136"></a><span class="font9" style="font-weight:bold;"><a name="bookmark10137"></a>11.6.1. about NAT</span></h3></li></ul></li></ul>
<p><span class="font25">A NAT device is a router that is also changing the source and/or target ip-address in packets. It is typically used to connect multiple computers in a private address range with the (public) internet. A NAT can hide private addresses from the internet.</span></p>
<p><span class="font25">NAT was developed to mitigate the use of real ip addresses, to allow private address ranges to reach the internet and back, and to not disclose details about internal networks to the outside.</span></p>
<p><span class="font25">The nat table in iptables adds two new chains. PREROUTING allows altering of packets before they reach the INPUT chain. POSTROUTING allows altering packets after they exit the OUTPUT chain.</span></p><img src="linux_guide_files/The Complete Linux Guide-163.jpg" alt="" style="width:409pt;height:81pt;">
<p><span class="font25">Use </span><span class="font25" style="font-weight:bold;">iptables -t nat -nvL </span><span class="font25">to look at the NAT table. The screenshot below shows an empty NAT table.</span></p>
<p><span class="font19">[root@RHEL5 ~]# iptables -t nat -nL Chain PREROUTING (policy ACCEPT) target prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">Chain POSTROUTING (policy ACCEPT) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">Chain OUTPUT (policy ACCEPT) target &nbsp;&nbsp;&nbsp;&nbsp;prot opt source &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination</span></p>
<p><span class="font19">[root@RHEL5 ~]#</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9998"></a><span class="font9" style="font-weight:bold;"><a name="bookmark10138"></a>11.6.2. SNAT (Source NAT)</span></h3></li></ul>
<p><span class="font25">The goal of source nat is to change the source address inside a packet before it leaves the system (e.g. to the internet). The destination will return the packet to the NAT-device. This means our NAT-device will need to keep a table in memory of all the packets it changed, so it can deliver the packet to the original source (e.g. in the private network).</span></p>
<p><span class="font25">Because SNAT is about packets leaving the system, it uses the POSTROUTING chain.</span></p>
<p><span class="font25">Here is an example SNAT rule. The rule says that packets coming from 10.1.1.0/24 network and exiting via eth1 will get the source ip-address set to 11.12.13.14. (Note that this is a one line command!)</span></p>
<p><span class="font19">iptables -t nat -A POSTROUTING -o ethl -s 10.1.1.0/24 -j SNAT \</span></p>
<p><span class="font19">--to-source 11.12.13.14</span></p>
<p><span class="font25">Of course there must exist a proper iptables filter setup to allow the packet to traverse from one network to the other.</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark10139"></a><span class="font9" style="font-weight:bold;"><a name="bookmark10140"></a>11.6.3. SNAT example setup</span></h3></li></ul>
<p><span class="font25">This example script uses a typical nat setup. The internal (eth0) network has access via SNAT to external (eth1) webservers (port 80).</span></p>
<p><span class="font19">#!/bin/bash #</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># iptables script for simple classic nat websurfing</span></p></li>
<li>
<p><span class="font19"># eth0 is internal network, eth1 is internet #</span></p></li></ul>
<p><span class="font19">echo 0 &gt;&nbsp;/proc/sys/net/ipv4/ip_forward</span></p>
<p><span class="font19">iptables -P INPUT ACCEPT</span></p>
<p><span class="font19">iptables -P OUTPUT ACCEPT</span></p>
<p><span class="font19">iptables -P FORWARD DROP</span></p>
<p><span class="font19">iptables -A FORWARD -i eth0 -o eth1 -s 10.1.1.0/24 -p tcp \</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- -dport 80 -j ACCEPT</span></p></li></ul>
<p><span class="font19">iptables -A FORWARD -i eth1 -o eth0 -d 10.1.1.0/24 -p tcp \</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- -sport 80 -j ACCEPT</span></p></li></ul>
<p><span class="font19">iptables -t nat -A POSTROUTING -o eth1 -s 10.1.1.0/24 -j SNAT \ --to-source 11.12.13.14 echo 1 &gt;&nbsp;/proc/sys/net/ipv4/ip_forward</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark9999"></a><span class="font9" style="font-weight:bold;"><a name="bookmark10141"></a>11.6.4. IP masquerading</span></h3></li></ul>
<p><span class="font25">IP masquerading is very similar to SNAT, but is meant for dynamic interfaces. Typical example are broadband 'router/modems' connected to the internet and receiving a different ip-address from the isp, each time they are cold-booted.</span></p>
<p><span class="font25">The only change needed to convert the SNAT script to a masquerading is one line.</span></p>
<p><span class="font19">iptables -t nat -A POSTROUTING -o ethl -s 10.1.1.0/24 -j MASQUERADE</span></p>
<ul style="list-style:none;"><li>
<h3><a name="bookmark10000"></a><span class="font9" style="font-weight:bold;"><a name="bookmark10142"></a>11.6.5. DNAT (Destination NAT)</span></h3></li></ul>
<p><span class="font25">DNAT is typically used to allow packets from the internet to be redirected to an internal server (in your DMZ) and in a private address range that is inaccessible directly form the internet.</span></p>
<p><span class="font25">This example script allows internet users to reach your internal (192.168.1.99) server via ssh (port 22).</span></p>
<p><span class="font19">#!/bin/bash</span></p>
<p><span class="font19">#</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># iptables script for DNAT</span></p></li>
<li>
<p><span class="font19"># eth0 is internal network, eth1 is internet</span></p></li></ul>
<p><span class="font19">#</span></p>
<p><span class="font19">echo 0 &gt;&nbsp;/proc/sys/net/ipv4/ip_forward</span></p>
<p><span class="font19">iptables -P INPUT ACCEPT</span></p>
<p><span class="font19">iptables -P OUTPUT ACCEPT</span></p>
<p><span class="font19">iptables -P FORWARD DROP</span></p>
<p><span class="font19">iptables -A FORWARD -i eth0 -o eth1 -s 10.1.1.0/24 -j ACCEPT</span></p>
<p><span class="font19">iptables -A FORWARD -i eth1 -o eth0 -p tcp --dport 22 -j ACCEPT</span></p>
<p><span class="font19">iptables -t nat -A PREROUTING -i eth1 -p tcp --dport 22 \</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- j DNAT --to-destination 10.1.1.99</span></p></li></ul>
<p><span class="font19">echo 1 &gt;&nbsp;/proc/sys/net/ipv4/ip_forward</span></p>
<p><a name="bookmark10143"></a><span class="font11" style="font-weight:bold;">Part IV. selinux</span></p>
<h3><a name="bookmark10144"></a><span class="font9" style="font-weight:bold;"><a name="bookmark10145"></a>Table of Contents</span></h3>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10146"><span class="font24" style="font-weight:bold;">12. introduction to SELinux </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10147"><span class="font24">12.1. selinux modes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10148"><span class="font24">12.2. logging </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10149"><span class="font24">12.3. activating selinux </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10150"><span class="font24">12.4. getenforce </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10151"><span class="font24">12.5. setenforce </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10152"><span class="font24">12.6. sestatus </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10153"><span class="font24">12.7. policy </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10154"><span class="font24">12.8. /etc/selinux/config </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10155"><span class="font24">12.9. DAC or MAC </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10156"><span class="font24">12.10. ls -Z </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10157"><span class="font24">12.11. -Z </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10158"><span class="font24">12.12. /selinux </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10159"><span class="font24">12.13. identity </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10160"><span class="font24">12.14. role </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10161"><span class="font24">12.15. type (or domain) </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10162"><span class="font24">12.16. security context </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10163"><span class="font24">12.17. transition </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10164"><span class="font24">12.18. extended attributes </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10165"><span class="font24">12.19. process security context </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10166"><span class="font24">12.20. chcon </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10167"><span class="font24">12.21. an example </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10168"><span class="font24">12.22. setroubleshoot </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<p><a href="#bookmark10169"><span class="font24">12.23. booleans </span></a></p></li></ul>
<ul style="list-style:none;"><li>
<h1><a name="bookmark10170"></a><span class="font11" style="font-weight:bold;"><a name="bookmark9356"></a><a name="bookmark10171"></a>Chapter 12. introduction to SELinux</span></h1></li></ul>
<p><a name="bookmark10172"></a><span class="font25">Security Enhanced Linux or </span><span class="font25" style="font-weight:bold;">SELinux </span><span class="font25">is a set of modifications developed by the United States National Security Agency (NSA) to provide a variety of security policies for Linux. SELinux was released as open source at the end of 2000. Since kernel version 2.6 it is an integrated part of Linux.</span></p>
<p><span class="font25">SELinux offers security! SELinux can control what kind of access users have to files and processes. Even when a file received </span><span class="font25" style="font-weight:bold;">chmod 777</span><span class="font25">, SELinux can still prevent applications from accessing it (Unix file permissions are checked first!). SELinux does this by placing users in </span><span class="font25" style="font-weight:bold;">roles </span><span class="font25">that represent a security context. Administrators have very strict control on access permissions granted to roles.</span></p>
<p><span class="font25">SELinux is present in the latest versions of Red Hat Enterprise Linux, Debian, CentOS, Fedora, and many other distributions..</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10173"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9357"></a><a name="bookmark10174"></a>12.1. selinux modes</span></h2></li></ul>
<p><span class="font25" style="font-weight:bold;">selinux </span><span class="font25">knows three modes: enforcing, permissive and disabled. The </span><span class="font25" style="font-weight:bold;">enforcing </span><span class="font25">mode will enforce policies, and may deny access based on </span><span class="font25" style="font-weight:bold;">selinux rules</span><span class="font25">. The </span><span class="font25" style="font-weight:bold;">permissive </span><span class="font25">mode will not enforce policies, but can still log actions that would have been denied in </span><span class="font25" style="font-weight:bold;">enforcing </span><span class="font25">mode. The </span><span class="font25" style="font-weight:bold;">disabled </span><span class="font25">mode disables </span><span class="font25" style="font-weight:bold;">selinux</span><span class="font25">.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10175"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9358"></a><a name="bookmark10176"></a>12.2. logging</span></h2></li></ul>
<p><span class="font25">Verify that </span><span class="font25" style="font-weight:bold;">syslog </span><span class="font25">is running and activated on boot to enable logging of deny messages in </span><span class="font25" style="font-weight:bold;">/var/log/messages</span><span class="font25">.</span></p>
<p><span class="font19">[root@rhel55 ~]# chkconfig --list syslog</span></p>
<p><span class="font19">syslog &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0:off 1:off 2:on 3:on 4:on 5:on 6:off</span></p>
<p><a name="bookmark10177"></a><span class="font25"><a name="bookmark10178"></a>Verify that </span><span class="font25" style="font-weight:bold;">auditd </span><span class="font25">is running and activated on boot to enable logging of easier to read messages in </span><span class="font25" style="font-weight:bold;">/var/log/audit/audit.log</span><span class="font25">.</span></p>
<p><span class="font19">[root@rhel55 ~]# chkconfig --list auditd</span></p>
<p><span class="font19">auditd &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0:off 1:off 2:on 3:on 4:on 5:on 6:off</span></p>
<p><a name="bookmark10179"></a><span class="font25">If not activated, then run </span><span class="font25" style="font-weight:bold;">chkconfig --levels 2345 auditd on </span><span class="font25">and </span><span class="font25" style="font-weight:bold;">service auditd start</span><span class="font25">.</span></p>
<p><span class="font19">[root@rhel55 ~]# service auditd status</span></p>
<p><span class="font19">auditd (pid 1660) is running...</span></p>
<p><span class="font19">[root@rhel55 ~]# service syslog status</span></p>
<p><span class="font19">syslogd (pid 1688) is running...</span></p>
<p><span class="font19">klogd (pid 1691) is running...</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">/var/log/messages </span><span class="font25">log file will tell you that </span><span class="font25" style="font-weight:bold;">selinux </span><span class="font25">is disabled.</span></p>
<p><span class="font19">root@deb503:~# grep -i selinux /var/log/messages</span></p>
<p><span class="font19">Jun 25 15:59:34 deb503 kernel: [ &nbsp;&nbsp;&nbsp;0.084083] SELinux: Disabled at boot.</span></p>
<p><span class="font25">Or that it is enabled.</span></p>
<p><span class="font19">root@deb503:~# grep SELinux /var/log/messages | grep -i Init</span></p>
<p><span class="font19">Jun 25 15:09:52 deb503 kernel: [ &nbsp;&nbsp;&nbsp;0.084094] SELinux: Initializing.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10180"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9359"></a><a name="bookmark10181"></a>12.3. activating selinux</span></h2></li></ul>
<p><a name="bookmark10182"></a><span class="font25">On RHEL you can use the GUI tool to activate </span><span class="font25" style="font-weight:bold;">selinux</span><span class="font25">, on Debian there is the </span><span class="font25" style="font-weight:bold;">selinux-activate </span><span class="font25">command. Activation requires a reboot.</span></p>
<p><span class="font19">root@deb503:~# selinux-activate</span></p>
<p><span class="font19">Activating SE Linux</span></p>
<p><span class="font19">Searching for GRUB installation directory ... found: /boot/grub</span></p>
<p><span class="font19">Searching for default file ... found: /boot/grub/default</span></p>
<p><span class="font19">Testing for an existing GRUB menu.lst file ... found: /boot/grub/menu.lst Searching for splash image ... none found, skipping ...</span></p>
<p><span class="font19">Found kernel: /boot/vmlinuz-2.6.26-2-686</span></p>
<p><span class="font19">Updating /boot/grub/menu.lst ... done</span></p>
<p><span class="font19">SE Linux is activated. You may need to reboot now.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10183"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9360"></a><a name="bookmark10184"></a>12.4. getenforce</span></h2></li></ul>
<h4><a name="bookmark10185"></a><span class="font25"><a name="bookmark10186"></a><a name="bookmark10187"></a>Use </span><span class="font25" style="font-weight:bold;">getenforce </span><span class="font25">to verify whether selinux is </span><span class="font25" style="font-weight:bold;">enforced</span><span class="font25">, </span><span class="font25" style="font-weight:bold;">disabled </span><span class="font25">or </span><span class="font25" style="font-weight:bold;">permissive</span><span class="font25">.</span></h4>
<p><span class="font19">[root@rhel55 ~]# getenforce</span></p>
<p><span class="font19">Permissive</span></p>
<h4><a name="bookmark10188"></a><span class="font25"><a name="bookmark10189"></a>The </span><span class="font25" style="font-weight:bold;">/selinux/enforce </span><span class="font25">file contains 1 when enforcing, and 0 when permissive mode is active.</span></h4>
<p><span class="font19">root@fedora13 ~# cat /selinux/enforce 1root@fedora13 ~#</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10190"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9361"></a><a name="bookmark10191"></a>12.5. setenforce</span></h2></li></ul>
<h4><a name="bookmark10192"></a><span class="font25"><a name="bookmark10193"></a><a name="bookmark10194"></a>You can use </span><span class="font25" style="font-weight:bold;">setenforce </span><span class="font25">to switch between the </span><span class="font25" style="font-weight:bold;">Permissive </span><span class="font25">or the </span><span class="font25" style="font-weight:bold;">Enforcing </span><span class="font25">state once </span><span class="font25" style="font-weight:bold;">selinux </span><span class="font25">is activated..</span></h4>
<p><span class="font19">[root@rhel55 ~]# setenforce Enforcing</span></p>
<p><span class="font19">[root@rhel55 ~]# getenforce</span></p>
<p><span class="font19">Enforcing</span></p>
<p><span class="font19">[root@rhel55 ~]# setenforce Permissive</span></p>
<p><span class="font19">[root@rhel55 ~]# getenforce</span></p>
<p><span class="font19">Permissive</span></p>
<h4><a name="bookmark10195"></a><span class="font25"><a name="bookmark10196"></a>Or you could just use 0 and 1 as argument.</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[root@centos65 [root@centos65 Enforcing</span></p>
<p><span class="font19">[root@centos65 [root@centos65 Permissive [root@centos65</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~]# setenforce 1</span></p>
<p><span class="font19">~]# getenforce</span></p>
<p><span class="font19">~]# setenforce 0 ~]# getenforce</span></p>
<p><span class="font19">~]#</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10197"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9362"></a><a name="bookmark10198"></a>12.6. sestatus</span></h2></li></ul>
<h4><a name="bookmark10199"></a><span class="font25"><a name="bookmark10200"></a><a name="bookmark10201"></a><a name="bookmark10202"></a>You can see the current </span><span class="font25" style="font-weight:bold;">selinux </span><span class="font25">status and policy with the </span><span class="font25" style="font-weight:bold;">sestatus </span><span class="font25">command.</span></h4>
<p><span class="font19">[root@rhel55 ~]# sestatus SELinux status: SELinuxfs mount: Current mode:</span></p>
<div>
<p><span class="font19">enabled /selinux permissive permissive 21 targeted</span></p>
</div><br clear="all">
<p><span class="font19">Mode from config file: Policy version:</span></p>
<p><span class="font19">Policy from config file:</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10203"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9363"></a><a name="bookmark10204"></a>12.7. policy</span></h2></li></ul>
<h4><a name="bookmark10205"></a><span class="font25"><a name="bookmark10206"></a>Most Red Hat server will have the </span><span class="font25" style="font-weight:bold;">targeted </span><span class="font25">policy. Only NSA/FBI/CIA/DOD/HLS use the </span><span class="font25" style="font-weight:bold;">mls </span><span class="font25">policy.</span></h4>
<h4><a name="bookmark10207"></a><span class="font25"><a name="bookmark10208"></a>The targted policy will protect hundreds of processes, but lets other processes run 'unconfined' (= they can do anything).</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10209"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9364"></a><a name="bookmark10210"></a>12.8. /etc/selinux/config</span></h2></li></ul>
<h4><a name="bookmark10211"></a><span class="font25"><a name="bookmark10212"></a><a name="bookmark10213"></a>The main configuration file for </span><span class="font25" style="font-weight:bold;">selinux </span><span class="font25">is </span><span class="font25" style="font-weight:bold;">/etc/selinux/config</span><span class="font25">. When in </span><span class="font25" style="font-weight:bold;">permissive </span><span class="font25">mode, the file looks like this.</span></h4>
<h4><a name="bookmark10214"></a><span class="font25"><a name="bookmark10215"></a>The targeted policy is selected in </span><span class="font25" style="font-weight:bold;">/etc/selinux/config</span><span class="font25">.</span></h4>
<p><span class="font19">[root@centos65 ~]# cat /etc/selinux/config</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># This file controls the state of SELinux on the system.</span></p></li>
<li>
<p><span class="font19"># SELINUX= can take one of these three values:</span></p></li>
<li>
<p><span class="font19"># enforcing - SELinux security policy is enforced.</span></p></li>
<li>
<p><span class="font19"># permissive - SELinux prints warnings instead of enforcing.</span></p></li>
<li>
<p><span class="font19"># disabled - SELinux is fully disabled.</span></p></li></ul>
<p><span class="font19">SELINUX=permissive</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19"># SELINUXTYPE= type of policy in use. Possible values are:</span></p></li>
<li>
<p><span class="font19"># targeted - Only targeted network daemons are protected.</span></p></li>
<li>
<p><span class="font19"># strict - Full SELinux protection.</span></p></li></ul>
<p><span class="font19">SELINUXTYPE=targeted</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10216"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9365"></a><a name="bookmark10217"></a>12.9. DAC or MAC</span></h2></li></ul>
<p><a name="bookmark10218"></a><span class="font25">Standard Unix permissions use </span><span class="font25" style="font-weight:bold;">Discretionary Access Control </span><span class="font25">to set permissions on files. This means that a user that owns a file, can make it world readable by typing </span><span class="font25" style="font-weight:bold;">chmod 777 $file</span><span class="font25">.</span></p>
<p><span class="font25">With </span><span class="font25" style="font-weight:bold;">selinux </span><span class="font25">the kernel will enforce </span><span class="font25" style="font-weight:bold;">Mandatory Access Control </span><span class="font25">which strictly controls what processes or threads can do with files (superseding DAC). Processes are confined by the kernel to the minimum access they require.</span></p>
<p><span class="font25">SELinux MAC is about labeling and type enforcing! Files, processes, etc are all labeled with an SELinux context. For files, these are extended attributes, for processes this is managed by the kernel.</span></p>
<p><span class="font25">The format of the labels is as follows:</span></p>
<p><span class="font19">user:role:type:(level)</span></p>
<p><span class="font25">We only use the </span><span class="font25" style="font-weight:bold;">type </span><span class="font25">label in the targeted policy.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10219"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9366"></a><a name="bookmark10220"></a>12.10. ls -Z</span></h2></li></ul>
<p><span class="font25">To see the DAC permissions on a file, use </span><span class="font25" style="font-weight:bold;">ls -l </span><span class="font25">to display user and group </span><span class="font25" style="font-weight:bold;">owner </span><span class="font25">and permissions.</span></p>
<p><a name="bookmark10221"></a><span class="font25">For MAC permissions there is new </span><span class="font25" style="font-weight:bold;">-Z </span><span class="font25">option added to </span><span class="font25" style="font-weight:bold;">ls</span><span class="font25">. The output shows that file in </span><span class="font25" style="font-weight:bold;">/root </span><span class="font25">have a XXXtype of </span><span class="font25" style="font-weight:bold;">admin_home_t</span><span class="font25">.</span></p>
<p><span class="font19">[root@centos65 ~]# ls -Z</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-------. root root system_u:object_r:admin_home_t:s0 anaconda-ks.cfg</span></p></li>
<li>
<p><span class="font19">- rw-r--r--. root root system_u:object_r:admin_home_t:s0 install.log</span></p></li>
<li>
<p><span class="font19">- rw-r--r--. root root system_u:object_r:admin_home_t:s0 install.log.syslog</span></p></li></ul>
<p><span class="font19">[root@centos65 ~]# useradd -m -s /bin/bash pol</span></p>
<p><span class="font19">[root@centos65 ~]# ls -Z /home/pol/.bashrc</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rw-r--r--. pol pol unconfined_u:object_r:user_home_t:s0 /home/pol/.bashrc</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10222"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9367"></a><a name="bookmark10223"></a>12.11. -Z</span></h2></li></ul>
<p><span class="font25">There are also some other tools with the -Z switch:</span></p>
<p><span class="font19">mkdir -Z cp -Z ps -Z netstat -Z</span></p>
<h2><a name="bookmark10224"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9368"></a><a name="bookmark10225"></a>12.12. /selinux</span></h2>
<p><span class="font25">When selinux is active, there is a new virtual file system named </span><span class="font25" style="font-weight:bold;">/selinux</span><span class="font25">. (You can compare it to /proc and /dev.)</span></p>
<table border="1">
<tr><td colspan="2" style="vertical-align:bottom;">
<p><span class="font19">[root@centos65</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">~]#</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">ls -l</span></p></td><td colspan="7" style="vertical-align:bottom;">
<p><span class="font19">/selinux/</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">total 0</span></p>
<p><span class="font19">-rw-rw-rw-.</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">12</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">19</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">40</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">access</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">dr-xr-xr-x.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">40</span></p></td><td style="vertical-align:top;">
<p><span class="font19">avc</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">dr-xr-xr-x.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">40</span></p></td><td style="vertical-align:top;">
<p><span class="font19">booleans</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-rw-r--r--.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">40</span></p></td><td style="vertical-align:top;">
<p><span class="font19">checkreqprot</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">dr-xr-xr-x.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">83</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">40</span></p></td><td style="vertical-align:top;">
<p><span class="font19">class</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">--w-------.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">40</span></p></td><td style="vertical-align:top;">
<p><span class="font19">commit_pending_bools</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-rw-rw-rw-.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">40</span></p></td><td style="vertical-align:top;">
<p><span class="font19">context</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">-rw-rw-rw-.</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">12</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">19</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">40</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">create</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-r--r--r--.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">40</span></p></td><td style="vertical-align:top;">
<p><span class="font19">deny unknown</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">--w-------.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">40</span></p></td><td style="vertical-align:top;">
<p><span class="font19">disable</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-rw-r--r--.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">40</span></p></td><td style="vertical-align:top;">
<p><span class="font19">enforce</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">dr-xr-xr-x.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">40</span></p></td><td style="vertical-align:top;">
<p><span class="font19">initial contexts</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-rw-------.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">40</span></p></td><td style="vertical-align:top;">
<p><span class="font19">load</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-rw-rw-rw-.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">40</span></p></td><td style="vertical-align:top;">
<p><span class="font19">member</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-r--r--r--.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">40</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mls</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">crw-rw-rw-.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1,</span></p></td><td style="vertical-align:top;">
<p><span class="font19">3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">40</span></p></td><td style="vertical-align:top;">
<p><span class="font19">null</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-r--------.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">40</span></p></td><td style="vertical-align:top;">
<p><span class="font19">policy</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">dr-xr-xr-x.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">40</span></p></td><td style="vertical-align:top;">
<p><span class="font19">policy_capabilities</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-r--r--r--.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">40</span></p></td><td style="vertical-align:top;">
<p><span class="font19">policyvers</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-r--r--r--.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">40</span></p></td><td style="vertical-align:top;">
<p><span class="font19">reject unknown</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-rw-rw-rw-.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">40</span></p></td><td style="vertical-align:top;">
<p><span class="font19">relabel</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">-r--r--r--.</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:bottom;">
<p><span class="font19">0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">12</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">19</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">40</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">status</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">-rw-rw-rw-.</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;">
<p><span class="font19">root</span></p></td><td style="vertical-align:top;"></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Apr</span></p></td><td style="vertical-align:top;">
<p><span class="font19">12</span></p></td><td style="vertical-align:top;">
<p><span class="font19">19</span></p></td><td style="vertical-align:top;">
<p><span class="font19">40</span></p></td><td style="vertical-align:top;">
<p><span class="font19">user</span></p></td></tr>
</table>
<p><a name="bookmark10226"></a><span class="font25"><a name="bookmark10227"></a>Although some files in </span><span class="font25" style="font-weight:bold;">/selinux </span><span class="font25">appear wih size 0, they often contain a boolean value. Check </span><span class="font25" style="font-weight:bold;">/selinux/enforce </span><span class="font25">to see if selinux is running in enforced mode.</span></p>
<p><span class="font19">[root@RHEL5 ~]# ls -l /selinux/enforce</span></p>
<p><span class="font19">-rw-r--r-- 1 root root 0 Apr 29 08:21 /selinux/enforce</span></p>
<p><span class="font19">[root@RHEL5 ~]# echo $(cat /selinux/enforce)</span></p>
<p><span class="font19">1</span></p>
<h2><a name="bookmark10228"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9369"></a><a name="bookmark10229"></a>12.13. identity</span></h2>
<p><a name="bookmark10230"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">SELinux Identity </span><span class="font25">of a user is distinct from the user ID. An identity is part of a security context, and (via domains) determines what you can do. The screenshot shows user </span><span class="font25" style="font-weight:bold;">root </span><span class="font25">having identity </span><span class="font25" style="font-weight:bold;">user_u</span><span class="font25">.</span></p>
<p><span class="font19">[root@rhel55 ~]# id -Z</span></p>
<p><span class="font19">user_u:system_r:unconfined_t</span></p>
<h2><a name="bookmark10231"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9370"></a><a name="bookmark10232"></a>12.14. role</span></h2>
<p><a name="bookmark10233"></a><span class="font25">The </span><span class="font25" style="font-weight:bold;">selinux role </span><span class="font25">defines the domains that can be used. A </span><span class="font25" style="font-weight:bold;">role </span><span class="font25">is denied to enter a domain, unless the </span><span class="font25" style="font-weight:bold;">role </span><span class="font25">is explicitely authorized to do so.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10234"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9371"></a><a name="bookmark10235"></a>12.15. type (or domain)</span></h2></li></ul>
<h4><a name="bookmark10236"></a><span class="font25"><a name="bookmark10237"></a><a name="bookmark10238"></a>The </span><span class="font25" style="font-weight:bold;">selinux context </span><span class="font25">is the security context of a process. An </span><span class="font25" style="font-weight:bold;">selinux type </span><span class="font25">determines what a process can do. The screenshot shows init running in type </span><span class="font25" style="font-weight:bold;">init_t </span><span class="font25">and the mingetty's running in type </span><span class="font25" style="font-weight:bold;">getty_t</span><span class="font25">.</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[root@centos65 ~]# ps fax -Z</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">| grep</span></p></td><td colspan="5" style="vertical-align:bottom;">
<p><span class="font19">/sbin/init</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">system_u:system_r:init_t:s0</span></p>
<p><span class="font19">[root@centos65 ~]# ps fax -Z system_u:system_r:getty_t:s0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">| grep 1307</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1 ?</span></p>
<p><span class="font19">getty_t tty1</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Ss</span></p>
<p><span class="font19">Ss +</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0</span></p>
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">:00 /sbin/init</span></p>
<p><span class="font19">/sbin/mingetty</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">/dev/tty1</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">system_u:system_r:getty_t:s0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1309</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tty2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Ss +</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/sbin/mingetty</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/dev/tty2</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">system_u:system_r:getty_t:s0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1311</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tty3</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Ss +</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/sbin/mingetty</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/dev/tty3</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">system_u:system_r:getty_t:s0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1313</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tty4</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Ss +</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/sbin/mingetty</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/dev/tty4</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">system_u:system_r:getty_t:s0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1320</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tty5</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Ss +</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/sbin/mingetty</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/dev/tty5</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">system_u:system_r:getty_t:s0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1322</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tty6</span></p></td><td style="vertical-align:top;">
<p><span class="font19">Ss +</span></p></td><td style="vertical-align:top;">
<p><span class="font19">0:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/sbin/mingetty</span></p></td><td style="vertical-align:top;">
<p><span class="font19">/dev/tty6</span></p></td></tr>
</table>
<h4><a name="bookmark10239"></a><span class="font25"><a name="bookmark10240"></a><a name="bookmark10241"></a>The </span><span class="font25" style="font-weight:bold;">selinux type </span><span class="font25">is similar to an </span><span class="font25" style="font-weight:bold;">selinux domain</span><span class="font25">, but refers to directories and files instead of processes.</span></h4>
<h4><a name="bookmark10242"></a><span class="font25"><a name="bookmark10243"></a>Hundreds of binaries also have a type:</span></h4>
<p><span class="font19">[root@centos65 sbin]# ls -lZ useradd usermod userdel httpd postcat postfix</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">- rwxr-xr-x. root root system_u:object_r:httpd_exec_t:s0 httpd</span></p></li>
<li>
<p><span class="font19">- rwxr-xr-x. root root system_u:object_r:postfix_master_exec_t:s0 postcat</span></p></li>
<li>
<p><span class="font19">- rwxr-xr-x. root root system_u:object_r:postfix_master_exec_t:s0 postfix</span></p></li>
<li>
<p><span class="font19">- rwxr-x---. root root system_u:object_r:useradd_exec_t:s0 useradd</span></p></li>
<li>
<p><span class="font19">- rwxr-x---. root root system_u:object_r:useradd_exec_t:s0 userdel</span></p></li>
<li>
<p><span class="font19">- rwxr-x---. root root system_u:object_r:useradd_exec_t:s0 usermod</span></p></li></ul>
<h4><a name="bookmark10244"></a><span class="font25"><a name="bookmark10245"></a>Ports also have a context.</span></h4>
<p><span class="font19">[root@centos65 sbin]# netstat -nptlZ | tr -s ' ' | cut -d' ' -f6-</span></p>
<p><span class="font19">Foreign Address State PID/Program name Security Context</span></p>
<p><span class="font19">LISTEN 1096/rpcbind system_u:system_r:rpcbind_t:s0</span></p>
<p><span class="font19">LISTEN 1208/sshd system_u:system_r:sshd_t:s0-s0:c0.c1023</span></p>
<p><span class="font19">LISTEN 1284/master system_u:system_r:postfix_master_t:s0</span></p>
<p><span class="font19">LISTEN 1114/rpc.statd system_u:system_r:rpcd_t:s0</span></p>
<p><span class="font19">LISTEN 1096/rpcbind system_u:system_r:rpcbind_t:s0</span></p>
<p><span class="font19">LISTEN 1666/httpd unconfined_u:system_r:httpd_t:s0</span></p>
<p><span class="font19">LISTEN 1208/sshd system_u:system_r:sshd_t:s0-s0:c0.c1023</span></p>
<p><span class="font19">LISTEN 1114/rpc.statd system_u:system_r:rpcd_t:s0</span></p>
<p><span class="font19">LISTEN 1284/master system_u:system_r:postfix_master_t:s0</span></p>
<h4><a name="bookmark10246"></a><span class="font25"><a name="bookmark10247"></a>You can also get a list of ports that are managed by SELinux:</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[root@centos65 ~]# semanage</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">port -l</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">| tail</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">xfs_port_t</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">7100</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">xserver_port_t</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">6000-6150</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">zabbix_agent_port_t</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">10050</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">zabbix_port_t</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">10051</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">zarafa_port_t</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">236, 237</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">zebra_port_t</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">2600-2604, 2606</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">zebra_port_t</span></p></td><td style="vertical-align:top;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">2600-2604, 2606</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">zented_port_t</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1229</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">zented_port_t</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">udp</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1229</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">zope_port_t</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tcp</span></p></td><td style="vertical-align:top;">
<p><span class="font19">8021</span></p></td></tr>
</table>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10248"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9372"></a><a name="bookmark10249"></a>12.16. security context</span></h2></li></ul>
<p><a name="bookmark10250"></a><span class="font25">The combination of identity, role and domain or type make up the </span><span class="font25" style="font-weight:bold;">selinux security context</span><span class="font25">.</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">id </span><span class="font25">will show you your security context in the form identity:role:domain.</span></p>
<p><span class="font19">[paul@RHEL5 ~]$ id | cut -d' ' -f4 context=user_u:system_r:unconfined_t</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">ls -Z </span><span class="font25">command shows the security context for a file in the form identity:role:type.</span></p>
<p><span class="font19">[paul@RHEL5 ~]$ ls -Z test</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-rw-r-- paul paul user_u:object_r:user_home_t &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test</span></p></li></ul>
<p><span class="font25">The security context for processes visible in /proc defines both the type (of the file in /proc) and the domain (of the running process). Let's take a look at the init process and /proc/1/ .</span></p>
<p><span class="font25">The init process runs in domain </span><span class="font25" style="font-weight:bold;">init_t</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL5 ~]# ps -ZC init</span></p>
<p><span class="font19">LABEL &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PID TTY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TIME CMD</span></p>
<p><span class="font19">system_u:system_r:init_t &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 ? &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;00:00:01 init</span></p>
<p><span class="font25">The </span><span class="font25" style="font-weight:bold;">/proc/1/ </span><span class="font25">directory, which identifies the </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">process, has type </span><span class="font25" style="font-weight:bold;">init_t</span><span class="font25">.</span></p>
<p><span class="font19">[root@RHEL5 ~]# ls -Zd /proc/1/</span></p>
<p><span class="font19">dr-xr-xr-x root root system_u:system_r:init_t &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/proc/1/</span></p>
<p><span class="font25">It is not a coincidence that the domain of the </span><span class="font25" style="font-weight:bold;">init </span><span class="font25">process and the type of </span><span class="font25" style="font-weight:bold;">/proc/1/ </span><span class="font25">are both </span><span class="font25" style="font-weight:bold;">init_t</span><span class="font25">.</span></p>
<p><a name="bookmark10251"></a><span class="font25">Don't try to use </span><span class="font25" style="font-weight:bold;">chcon </span><span class="font25">on /proc! It will not work.</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10252"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9373"></a><a name="bookmark10253"></a>12.17. transition</span></h2></li></ul>
<p><a name="bookmark10254"></a><span class="font25">An </span><span class="font25" style="font-weight:bold;">selinux transition </span><span class="font25">(aka an selinux labelling) determines the security context that will be assigned. A transition of process domains is used when you execute a process. A transition of file type happens when you create a file.</span></p>
<p><span class="font25">An example of file type transition.</span></p>
<p><span class="font19">[pol@centos65 ~]$ touch test /tmp/test</span></p>
<p><span class="font19">[pol@centos65 ~]$ ls -Z test</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-rw-r--. pol pol unconfined_u:object_r:user_home_t:s0 test</span></p></li></ul>
<p><span class="font19">[pol@centos65 ~]$ ls -Z /tmp/test</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-rw-r--. pol pol unconfined_u:object_r:user_tmp_t:s0 /tmp/test</span></p></li></ul>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10255"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9374"></a><a name="bookmark10256"></a>12.18. extended attributes</span></h2></li></ul>
<h4><a name="bookmark10257"></a><span class="font25"><a name="bookmark10258"></a><a name="bookmark10259"></a>Extended attributes are used by </span><span class="font25" style="font-weight:bold;">selinux </span><span class="font25">to store security contexts. These attributes can be viewed with </span><span class="font25" style="font-weight:bold;">ls </span><span class="font25">when </span><span class="font25" style="font-weight:bold;">selinux </span><span class="font25">is running.</span></h4>
<p><span class="font19">[root@RHEL5 home]# ls --context</span></p>
<p><span class="font19">drwx------ paul paul system_u:object_r:user_home_dir_t paul</span></p>
<p><span class="font19">drwxr-xr-x root root user_u:object_r:user_home_dir_t project42 drwxr-xr-x root root user_u:object_r:user_home_dir_t project55</span></p>
<p><span class="font19">[root@RHEL5 home]# ls -Z</span></p>
<p><span class="font19">drwx------ paul paul system_u:object_r:user_home_dir_t paul</span></p>
<p><span class="font19">drwxr-xr-x root root user_u:object_r:user_home_dir_t project42 drwxr-xr-x root root user_u:object_r:user_home_dir_t project55</span></p>
<p><span class="font19">[root@RHEL5 home]#</span></p>
<h4><a name="bookmark10260"></a><span class="font25"><a name="bookmark10261"></a><a name="bookmark10262"></a>When selinux is not running, then </span><span class="font25" style="font-weight:bold;">getfattr </span><span class="font25">is the tool to use.</span></h4>
<p><span class="font19">[root@RHEL5 etc]# getfattr -m . -d hosts # file: hosts</span></p>
<p><span class="font19">security.selinux=&quot;system_u:object_r:etc_t:s0\000&quot;</span></p>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10263"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9375"></a><a name="bookmark10264"></a>12.19. process security context</span></h2></li></ul>
<h4><a name="bookmark10265"></a><span class="font25"><a name="bookmark10266"></a><a name="bookmark10267"></a>A new option is added to </span><span class="font25" style="font-weight:bold;">ps </span><span class="font25">to see the selinux security context of processes.</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[root@RHEL5 etc]# ps -ZC mingetty</span></p>
<p><span class="font19">LABEL &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PID</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">TTY</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">TIME</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">CMD</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">system_u:system_r:getty_t &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2941</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">tty1</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">mingetty</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">system_u:system_r:getty_t &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2942</span></p></td><td style="vertical-align:top;">
<p><span class="font19">tty2</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">mingetty</span></p></td></tr>
</table>
<h2><a name="bookmark10268"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9376"></a><a name="bookmark10269"></a>12.20. chcon</span></h2>
<h4><a name="bookmark10270"></a><span class="font25"><a name="bookmark10271"></a><a name="bookmark10272"></a>Use </span><span class="font25" style="font-weight:bold;">chcon </span><span class="font25">to change the selinux security context.</span><br><br><span class="font25"><a name="bookmark10273"></a>This example shows how to use </span><span class="font25" style="font-weight:bold;">chcon </span><span class="font25">to change the </span><span class="font25" style="font-weight:bold;">type </span><span class="font25">of a file.</span></h4>
<p><span class="font19">[root@rhel55 ~]# ls -Z /var/www/html/test42.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-r--r-- root root user_u:object_r:httpd_sys_content_t /var/www/html/test4\</span></p></li></ul>
<p><span class="font19">2.txt</span></p>
<p><span class="font19">[root@rhel55 ~]# chcon -t samba_share_t /var/www/html/test42.txt</span></p>
<p><span class="font19">[root@rhel55 ~]# ls -Z /var/www/html/test42.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-r--r-- root root user_u:object_r:samba_share_t /var/www/html/test42.txt</span></p></li></ul>
<h4><a name="bookmark10274"></a><span class="font25"><a name="bookmark10275"></a>Be sure to read </span><span class="font25" style="font-weight:bold;">man chcon</span><span class="font25">.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10276"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9377"></a><a name="bookmark10277"></a>12.21. an example</span></h2></li></ul>
<h4><a name="bookmark10278"></a><span class="font25"><a name="bookmark10279"></a>The </span><span class="font25" style="font-weight:bold;">Apache2 webserver </span><span class="font25">is by default targeted with </span><span class="font25" style="font-weight:bold;">SELinux</span><span class="font25">. The next screenshot shows that any file created in </span><span class="font25" style="font-weight:bold;">/var/www/html </span><span class="font25">will by default get the </span><span class="font25" style="font-weight:bold;">httpd_sys_content_t </span><span class="font25">type.</span></h4>
<p><span class="font19">[root@centos65 ~]# touch /var/www/html/test42.txt</span></p>
<p><span class="font19">[root@centos65 ~]# ls -Z /var/www/html/test42.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-r--r--. root root unconfined_u:object_r:httpd_sys_content_t:s0 /var/www/h\</span></p></li></ul>
<p><span class="font19">tml/test42.txt</span></p>
<h4><a name="bookmark10280"></a><span class="font25"><a name="bookmark10281"></a>Files created elsewhere do not get this type.</span></h4>
<p><span class="font19">[root@centos65 ~]# touch /root/test42.txt</span></p>
<p><span class="font19">[root@centos65 ~]# ls -Z /root/test42.txt</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">-rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 /root/test42.txt</span></p></li></ul>
<h4><a name="bookmark10282"></a><span class="font25"><a name="bookmark10283"></a>Make sure </span><span class="font25" style="font-weight:bold;">Apache2 </span><span class="font25">runs.</span></h4>
<p><span class="font19">[root@centos65 ~]# service httpd restart</span></p>
<p><span class="font19">Stopping httpd: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p>
<p><span class="font19">Starting httpd: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p>
<h4><a name="bookmark10284"></a><span class="font25"><a name="bookmark10285"></a>Will this work ? Yes it does.</span></h4>
<p><span class="font19">[root@centos65 ~]# wget </span><a href="http://localhost/test42.txt"><span class="font19">http://localhost/test42.txt</span></a></p>
<p><span class="font19">--2014-04-12 20:56:47-- </span><a href="http://localhost/test42.txt"><span class="font19">http://localhost/test42.txt</span></a></p>
<p><span class="font19">Resolving localhost... ::1, 127.0.0.1</span></p>
<p><span class="font19">Connecting to localhost|::1|:80... connected.</span></p>
<p><span class="font19">HTTP request sent, awaiting response... 200 OK</span></p>
<p><span class="font19">Length: 0 [text/plain]</span></p>
<p><span class="font19">Saving to: “test42.txt”</span></p>
<h4><a name="bookmark10286"></a><span class="font25"><a name="bookmark10287"></a>Why does this work ? Because Apache2 runs in the </span><span class="font25" style="font-weight:bold;">httpd_t </span><span class="font25">domain and the files in </span><span class="font25" style="font-weight:bold;">/var/ www/html </span><span class="font25">have the </span><span class="font25" style="font-weight:bold;">httpd_sys_content_t </span><span class="font25">type.</span></h4>
<table border="1">
<tr><td style="vertical-align:bottom;">
<p><span class="font19">[root@centos65 ~]# ps -ZC httpd |</span></p></td><td colspan="4" style="vertical-align:bottom;">
<p><span class="font19">head -4</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">LABEL</span></p></td><td style="vertical-align:top;">
<p><span class="font19">PID</span></p></td><td style="vertical-align:top;">
<p><span class="font19">TTY</span></p></td><td style="vertical-align:top;">
<p><span class="font19">TIME</span></p></td><td style="vertical-align:top;">
<p><span class="font19">CMD</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font19">unconfined_u:system_r:httpd_t:s0</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">1666</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">?</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:bottom;">
<p><span class="font19">httpd</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">unconfined_u:system_r:httpd_t:s0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1668</span></p></td><td style="vertical-align:top;">
<p><span class="font19">?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">httpd</span></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font19">unconfined_u:system_r:httpd_t:s0</span></p></td><td style="vertical-align:top;">
<p><span class="font19">1669</span></p></td><td style="vertical-align:top;">
<p><span class="font19">?</span></p></td><td style="vertical-align:top;">
<p><span class="font19">00:00:00</span></p></td><td style="vertical-align:top;">
<p><span class="font19">httpd</span></p></td></tr>
</table>
<h4><a name="bookmark10288"></a><span class="font25"><a name="bookmark10289"></a>So let's set SELinux to </span><span class="font25" style="font-weight:bold;">enforcing </span><span class="font25">and change the </span><span class="font25" style="font-weight:bold;">type </span><span class="font25">of this file.</span></h4>
<p><span class="font19">[root@centos65 ~]# chcon -t samba_share_t /var/www/html/test42.txt</span></p>
<p><span class="font19">[root@centos65 ~]# ls -Z /var/www/html/test42.txt</span></p>
<p><span class="font19">-rw-r--r--. root root unconfined_u:object_r:samba_share_t:s0 /var/www/html/t\ est42.txt</span></p>
<p><span class="font19">[root@centos65 ~]# setenforce 1</span></p>
<p><span class="font19">[root@centos65 ~]# getenforce</span></p>
<p><span class="font19">Enforcing</span></p>
<h4><a name="bookmark10290"></a><span class="font25"><a name="bookmark10291"></a>There are two possibilities now: either it works, or it fails. It works when </span><span class="font25" style="font-weight:bold;">selinux </span><span class="font25">is in </span><span class="font25" style="font-weight:bold;">permissive mode</span><span class="font25">, it fails when in </span><span class="font25" style="font-weight:bold;">enforcing mode</span><span class="font25">.</span></h4>
<p><span class="font19">[root@centos65 ~]# wget </span><a href="http://localhost/test42.txt"><span class="font19">http://localhost/test42.txt</span></a></p>
<p><span class="font19">--2014-04-12 21:05:02-- </span><a href="http://localhost/test42.txt"><span class="font19">http://localhost/test42.txt</span></a></p>
<p><span class="font19">Resolving localhost... ::1, 127.0.0.1</span></p>
<p><span class="font19">Connecting to localhost|::1|:80... connected.</span></p>
<p><span class="font19">HTTP request sent, awaiting response... 403 Forbidden 2014-04-12 21:05:02 ERROR 403: Forbidden.</span></p>
<h4><a name="bookmark10292"></a><span class="font25"><a name="bookmark10293"></a>The log file gives you a cryptic message...</span></h4>
<p><span class="font19">[root@centos65 ~]# tail -3 /var/log/audit/audit.log</span></p>
<p><span class="font19">type=SYSCALL msg=audit(1398200702.803:64): arch=c000003e syscall=4 succ\ ess=no exit=-13 a0=7f5fbc334d70 a1=7fff553b4f10 a2=7fff553b4f10 a3=0 it\ ems=0 ppid=1666 pid=1673 auid=500 uid=48 gid=48 euid=48 suid=48 fsuid=4\ 8 egid=48 sgid=48 fsgid=48 tty=(none) ses=1 comm=&quot;httpd&quot; exe=&quot;/usr/sbin\ /httpd&quot; subj=unconfined_u:system_r:httpd_t:s0 key=(null)</span></p>
<p><span class="font19">type=AVC msg=audit(1398200702.804:65): avc: denied { getattr } for p\ id=1673 comm=&quot;httpd&quot; path=&quot;/var/www/html/test42.txt&quot; dev=dm-0 ino=26324\ 1 scontext=unconfined_u:system_r:httpd_t:s0 tcontext=unconfined_u:objec\ t_r:samba_share_t:s0 tclass=file</span></p>
<p><span class="font19">type=SYSCALL msg=audit(1398200702.804:65): arch=c000003e syscall=6 succ\ ess=no exit=-13 a0=7f5fbc334e40 a1=7fff553b4f10 a2=7fff553b4f10 a3=1 it\ ems=0 ppid=1666 pid=1673 auid=500 uid=48 gid=48 euid=48 suid=48 fsuid=4\ 8 egid=48 sgid=48 fsgid=48 tty=(none) ses = 1 comm=&quot;httpd&quot; exe=&quot;/usr/sbin\ /httpd&quot; subj=unconfined_u:system_r:httpd_t:s0 key=(null)</span></p>
<h4><a name="bookmark10294"></a><span class="font25"><a name="bookmark10295"></a>And </span><span class="font25" style="font-weight:bold;">/var/log/messages </span><span class="font25">mentions nothing of the failed download.</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10296"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9378"></a><a name="bookmark10297"></a>12.22. setroubleshoot</span></h2></li></ul>
<h4><a name="bookmark10298"></a><span class="font25"><a name="bookmark10299"></a>The log file above was not very helpful, but these two packages can make your life much easier.</span></h4>
<p><span class="font19">[root@centos65 ~]# yum -y install setroubleshoot setroubleshoot-server</span></p>
<h4><a name="bookmark10300"></a><span class="font25"><a name="bookmark10301"></a>You need to </span><span class="font25" style="font-weight:bold;">reboot </span><span class="font25">for this to work...</span></h4>
<h4><a name="bookmark10302"></a><span class="font25"><a name="bookmark10303"></a>So we reboot, restart the httpd server, reactive SELinux Enforce, and do the wget again... and it fails (because of SELinux).</span></h4>
<p><span class="font19">[root@centos65 ~]# service httpd restart</span></p>
<p><span class="font19">Stopping httpd: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[FAILED]</span></p>
<p><span class="font19">Starting httpd: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ OK ]</span></p>
<p><span class="font19">[root@centos65 ~]# getenforce Permissive [root@centos65 ~]# setenforce 1 [root@centos65 ~]# getenforce Enforcing [root@centos65 ~]# wget </span><a href="http://localhost/test42.txt"><span class="font19">http://localhost/test42.txt</span></a><span class="font19"> --2014-04-12 21:44:13-- </span><a href="http://localhost/test42.txt"><span class="font19">http://localhost/test42.txt</span></a><span class="font19"> Resolving localhost... ::1, 127.0.0.1</span></p>
<p><span class="font19">Connecting to localhost|::1|:80... connected.</span></p>
<p><span class="font19">HTTP request sent, awaiting response... 403 Forbidden 2014-04-12 21:44:13 ERROR 403: Forbidden.</span></p>
<h4><a name="bookmark10304"></a><span class="font25"><a name="bookmark10305"></a>The </span><span class="font25" style="font-weight:bold;">/var/log/audit/ </span><span class="font25">is still not out best friend, but take a look at </span><span class="font25" style="font-weight:bold;">/var/log/messages</span><span class="font25">.</span></h4>
<p><span class="font19">[root@centos65 ~]# tail -2 /var/log/messages</span></p>
<p><span class="font19">Apr 12 21:44:16 centos65 setroubleshoot: SELinux is preventing /usr/sbin/h\ ttpd from getattr access on the file /var/www/html/test42.txt. For complete \</span></p>
<p><span class="font19">SELinux messages. run </span><span class="font19" style="font-weight:bold;">sealert -l b2a84386-54c1-4344-96fb-dcf969776696</span></p>
<p><span class="font19">Apr 12 21:44:16 centos65 setroubleshoot: SELinux is preventing /usr/sbin/h\ ttpd from getattr access on the file /var/www/html/test42.txt. For complete \</span></p>
<p><span class="font19">SELinux messages. run </span><span class="font19" style="font-weight:bold;">sealert -l b2a84386-54c1-4344-96fb-dcf969776696</span></p>
<h4><a name="bookmark10306"></a><span class="font25"><a name="bookmark10307"></a>So we run the command it suggests...</span></h4>
<p><span class="font19">[root@centos65 ~]# sealert -l b2a84386-54c1-4344-96fb-dcf969776696</span></p>
<p><span class="font19">SELinux is preventing /usr/sbin/httpd from getattr access on the file /va\ r/www/html/test42.txt.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">***** Plugin restorecon (92.2 confidence) suggests *********************</span></p></li></ul>
<p><span class="font19">If you want to fix the label.</span></p>
<p><span class="font19">/var/www/html/test42.txt default label should be httpd_sys_content_t. Then you can run restorecon. Do # /sbin/restorecon -v /var/www/html/test42.txt</span></p>
<h4><a name="bookmark10308"></a><span class="font25"><a name="bookmark10309"></a>We follow the friendly advice and try again to download our file:</span></h4>
<p><span class="font19">[root@centos65 ~]# </span><span class="font19" style="font-weight:bold;">/sbin/restorecon -v /var/www/html/test42.txt</span></p>
<p><span class="font19">/sbin/restorecon reset /var/www/html/test42.txt context unconfined_u:objec\</span></p>
<p><span class="font19">t_r:samba_share_t:s0-&gt;unconfined_u:object_r:httpd_sys_content_t:s0 [root@centos65 ~]# wget </span><a href="http://localhost/test42.txt"><span class="font19">http://localhost/test42.txt</span></a></p>
<p><span class="font19">--2014-04-12 21:54:03-- </span><a href="http://localhost/test42.txt"><span class="font19">http://localhost/test42.txt</span></a></p>
<p><span class="font19">Resolving localhost... ::1, 127.0.0.1</span></p>
<p><span class="font19">Connecting to localhost|::1|:80... connected.</span></p>
<p><span class="font19">HTTP request sent, awaiting response... 200 OK</span></p>
<h4><a name="bookmark10310"></a><span class="font25"><a name="bookmark10311"></a>It works!</span></h4>
<ul style="list-style:none;"><li>
<h2><a name="bookmark10312"></a><span class="font10" style="font-weight:bold;"><a name="bookmark9379"></a><a name="bookmark10313"></a>12.23. booleans</span></h2></li></ul>
<h4><a name="bookmark10314"></a><span class="font25"><a name="bookmark10315"></a>Booleans are on/off switches</span></h4>
<p><span class="font19">[root@centos65 ~]# getsebool -a | head</span></p>
<p><span class="font19">abrt_anon_write --&gt; off</span></p>
<p><span class="font19">abrt_handle_event --&gt; off allow_console_login --&gt; on allow_cvs_read_shadow --&gt; off allow_daemons_dump_core --&gt; on</span></p>
<p><span class="font19">allow_daemons_use_tcp_wrapper --&gt; off allow_daemons_use_tty --&gt; on allow_domain_fd_use --&gt; on allow_execheap --&gt; off allow_execmem --&gt; on</span></p>
<h4><a name="bookmark10316"></a><span class="font25"><a name="bookmark10317"></a>You can set and read individual booleans.</span></h4>
<p><span class="font19">[root@centos65 ~]# setsebool httpd_read_user_content=1</span></p>
<p><span class="font19">[root@centos65 ~]# getsebool httpd_read_user_content httpd_read_user_content --&gt; on</span></p>
<p><span class="font19">[root@centos65 ~]# setsebool httpd_enable_homedirs=1</span></p>
<p><span class="font19">[root@centos65 ~]# getsebool httpd_enable_homedirs httpd_enable_homedirs --&gt; on</span></p>
<h4><a name="bookmark10318"></a><span class="font25"><a name="bookmark10319"></a>You can set these booleans permanent.</span></h4>
<p><span class="font19">[root@centos65 ~]# setsebool -P httpd_enable_homedirs=1 [root@centos65 ~]# setsebool -P httpd_read_user_content=1</span></p>
<h4><a name="bookmark10320"></a><span class="font25"><a name="bookmark10321"></a>The above commands regenerate the complete /etc/selinux/targeted directory!</span></h4>
<p><span class="font19">[root@centos65 ~]# cat /etc/selinux/targeted/modules/active/booleans.local # This file is auto-generated by libsemanage</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19" style="font-weight:bold;"># Do not edit directly.</span></p></li></ul>
<p><span class="font19">httpd_enable_homedirs=1</span></p>
<p><span class="font19">httpd_read_user_content=1</span></p>
<p><a name="bookmark10322"></a><span class="font11" style="font-weight:bold;">Part V. Appendix</span></p>
<h3><a name="bookmark10323"></a><span class="font9" style="font-weight:bold;"><a name="bookmark10324"></a>Table of Contents</span></h3>
<p><a href="#bookmark10325"><span class="font24" style="font-weight:bold;">A. License</span></a></p>
<div>
<p><a href="#bookmark10325"><span class="font24" style="font-weight:bold;">115</span></a></p>
</div><br clear="all">
<h1><a name="bookmark10325"></a><span class="font11" style="font-weight:bold;"><a name="bookmark10326"></a><a name="bookmark10327"></a>Appendix A. License</span></h1>
<p><span class="font19">GNU Free Documentation License</span></p>
<p><span class="font19">Version 1.3, 3 November 2008</span></p>
<p><span class="font19">Copyright © 2000, 2001, 2002, 2007, 2008 Free Software Foundation, Inc.</span></p>
<p><span class="font19">Everyone is permitted to copy and distribute verbatim copies of this license document, but changing it is not allowed.</span></p>
<p><span class="font19">0. PREAMBLE</span></p>
<p><span class="font19">The purpose of this License is to make a manual, textbook, or other functional and useful document &quot;free&quot; in the sense of freedom: to assure everyone the effective freedom to copy and redistribute it, with or without modifying it, either commercially or noncommercially. Secondarily, this License preserves for the author and publisher a way to get credit for their work, while not being considered responsible for modifications made by others.</span></p>
<p><span class="font19">This License is a kind of &quot;copyleft&quot;, which means that derivative works of the document must themselves be free in the same sense. It complements the GNU General Public License, which is a copyleft license designed for free software.</span></p>
<p><span class="font19">We have designed this License in order to use it for manuals for free software, because free software needs free documentation: a free program should come with manuals providing the same freedoms that the software does. But this License is not limited to software manuals; it can be used for any textual work, regardless of subject matter or whether it is published as a printed book. We recommend this License principally for works whose purpose is instruction or reference.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">1. APPLICABILITY AND DEFINITIONS</span></p></li></ul>
<p><span class="font19">This License applies to any manual or other work, in any medium, that contains a notice placed by the copyright holder saying it can be distributed under the terms of this License. Such a notice grants a world-wide, royalty-free license, unlimited in duration, to use that work under the conditions stated herein. The &quot;Document&quot;, below, refers to any such manual or work. Any member of the public is a licensee, and is addressed as &quot;you&quot;. You accept the license if you copy, modify or distribute the work in a way requiring permission under copyright law.</span></p>
<p><span class="font19">A &quot;Modified Version&quot; of the Document means any work containing the Document or a portion of it, either copied verbatim, or with modifications and/or translated into another language.</span></p>
<p><span class="font19">A &quot;Secondary Section&quot; is a named appendix or a front-matter section of the Document that deals exclusively with the relationship of the publishers or authors of the Document to the Document's overall subject (or to related matters) and contains nothing that could fall directly within that overall subject. (Thus, if the Document is in part a textbook of mathematics, a Secondary Section may not explain any mathematics.) The relationship could be a matter of historical connection with the subject or with related matters, or of legal, commercial, philosophical, ethical or political position regarding them.</span></p>
<p><span class="font19">The &quot;Invariant Sections&quot; are certain Secondary Sections whose titles are designated, as being those of Invariant Sections, in the notice that says that the Document is released under this License. If a section does not fit the above definition of Secondary then it is not allowed to be designated as Invariant. The Document may contain zero Invariant Sections. If the Document does not identify any Invariant Sections then there are none.</span></p>
<p><span class="font19">The &quot;Cover Texts&quot; are certain short passages of text that are listed, as Front-Cover Texts or Back-Cover Texts, in the notice that says that the Document is released under this License. A Front-Cover Text may be at most 5 words, and a Back-Cover Text may be at most 25 words.</span></p>
<p><span class="font19">A &quot;Transparent&quot; copy of the Document means a machine-readable copy, represented in a format whose specification is available to the general public, that is suitable for revising the document straightforwardly with generic text editors or (for images composed of pixels) generic paint programs or (for drawings) some widely available drawing editor, and that is suitable for input to text formatters or for automatic translation to a variety of formats suitable for input to text formatters. A copy made in an otherwise Transparent file format whose markup, or absence of markup, has been arranged to thwart or discourage subsequent modification by readers is not Transparent. An image format is not Transparent if used for any substantial amount of text. A copy that is not &quot;Transparent&quot; is called &quot;Opaque&quot;.</span></p>
<p><span class="font19">Examples of suitable formats for Transparent copies include plain ASCII without markup, Texinfo input format, LaTeX input format, SGML or XML using a publicly available DTD, and standard-conforming simple HTML, PostScript or PDF designed for human modification. Examples of transparent image formats include PNG, XCF and JPG. Opaque formats include proprietary formats that can be read and edited only by proprietary word processors, SGML or XML for which the DTD and/or processing tools are not generally available, and the machine-generated HTML, PostScript or PDF produced by some word processors for output purposes only.</span></p>
<p><span class="font19">The &quot;Title Page&quot; means, for a printed book, the title page itself, plus such following pages as are needed to hold, legibly, the material this License requires to appear in the title page. For works in formats which do not have any title page as such, &quot;Title Page&quot; means the text near the most prominent appearance of the work's title, preceding the beginning of the body of the text.</span></p>
<p><span class="font19">The &quot;publisher&quot; means any person or entity that distributes copies of the Document to the public.</span></p>
<p><span class="font19">A section &quot;Entitled XYZ&quot; means a named subunit of the Document whose title either is precisely XYZ or contains XYZ in parentheses following text that translates XYZ in another language. (Here XYZ stands for a specific section name mentioned below, such as &quot;Acknowledgements&quot;, &quot;Dedications&quot;, &quot;Endorsements&quot;, or &quot;History&quot;.) To &quot;Preserve the Title&quot; of such a section when you modify the Document means that it remains a section &quot;Entitled XYZ&quot; according to this definition.</span></p>
<p><span class="font19">The Document may include Warranty Disclaimers next to the notice which states that this License applies to the Document. These Warranty Disclaimers are considered to be included by reference in this License, but only as regards disclaiming warranties: any other implication that these Warranty Disclaimers may have is void and has no effect on the meaning of this License.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">2. VERBATIM COPYING</span></p></li></ul>
<p><span class="font19">You may copy and distribute the Document in any medium, either commercially or noncommercially, provided that this License, the copyright notices, and the license notice saying this License applies to the Document are reproduced in all copies, and that you add no other conditions whatsoever to those of this License. You may not use technical measures to obstruct or control the reading or further copying of the copies you make or distribute. However, you may accept compensation in exchange for copies. If you distribute a large enough number of copies you must also follow the conditions in section 3.</span></p>
<p><span class="font19">You may also lend copies, under the same conditions stated above, and you may publicly display copies.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">3. COPYING IN QUANTITY</span></p></li></ul>
<p><span class="font19">If you publish printed copies (or copies in media that commonly have printed covers) of the Document, numbering more than 100, and the Document's license notice requires Cover Texts, you must enclose the copies in covers that carry, clearly and legibly, all these Cover Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on the back cover. Both covers must also clearly and legibly identify you as the publisher of these copies. The front cover must present the full title with all words of the title equally prominent and visible. You may add other material on the covers in addition. Copying with changes limited to the covers, as long as they preserve the title of the Document and satisfy these conditions, can be treated as verbatim copying in other respects.</span></p>
<p><span class="font19">If the required texts for either cover are too voluminous to fit legibly, you should put the first ones listed (as many as fit reasonably) on the actual cover, and continue the rest onto adjacent pages.</span></p>
<p><span class="font19">If you publish or distribute Opaque copies of the Document numbering more than 100, you must either include a machine-readable Transparent copy along with each Opaque copy, or state in or with each Opaque copy a computer-network location from which the general network-using public has access to download using public-standard network protocols a complete Transparent copy of the Document, free of added material. If you use the latter option, you must take reasonably prudent steps, when you begin distribution of Opaque copies in quantity, to ensure that this Transparent copy will remain thus accessible at the stated location until at least one year after the last time you distribute an Opaque copy (directly or through your agents or retailers) of that edition to the public.</span></p>
<p><span class="font19">It is requested, but not required, that you contact the authors of the Document well before redistributing any large number of copies, to give them a chance to provide you with an updated version of the Document.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">4. MODIFICATIONS</span></p></li></ul>
<p><span class="font19">You may copy and distribute a Modified Version of the Document under the conditions of sections 2 and 3 above, provided that you release the Modified Version under precisely this License, with the Modified Version filling the role of the Document, thus licensing distribution and modification of the Modified Version to whoever possesses a copy of it. In addition, you must do these things in the Modified Version:</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">* A. Use in the Title Page (and on the covers, if any) a title distinct from that of the Document, and from those of previous versions (which should, if there were any, be listed in the History section of the Document). You may use the same title as a previous version if the original publisher of that version gives permission.</span></p></li>
<li>
<p><span class="font19">* B. List on the Title Page, as authors, one or more persons or entities responsible for authorship of the modifications in the Modified Version, together with at least five of the principal authors of the Document (all of its principal authors, if it has fewer than five), unless they release you from this requirement.</span></p></li>
<li>
<p><span class="font19">* C. State on the Title page the name of the publisher of the Modified Version, as the publisher.</span></p></li>
<li>
<p><span class="font19">* D. Preserve all the copyright notices of the Document.</span></p></li>
<li>
<p><span class="font19">* E. Add an appropriate copyright notice for your modifications adjacent to the other copyright notices.</span></p></li>
<li>
<p><span class="font19">* F. Include, immediately after the copyright notices, a license notice giving the public permission to use the Modified Version under the terms of this License, in the form shown in the Addendum below.</span></p></li>
<li>
<p><span class="font19">* G. Preserve in that license notice the full lists of Invariant Sections and required Cover Texts given in the Document's license notice.</span></p></li>
<li>
<p><span class="font19">* H. Include an unaltered copy of this License.</span></p></li>
<li>
<p><span class="font19">* I. Preserve the section Entitled &quot;History&quot;, Preserve its Title, and add to it an item stating at least the title, year, new authors, and publisher of the Modified Version as given on the Title Page. If there is no section Entitled &quot;History&quot; in the Document, create one stating the title, year, authors, and publisher of the Document as given on its Title Page, then add an item describing the Modified Version as stated in the previous sentence.</span></p></li>
<li>
<p><span class="font19">* J. Preserve the network location, if any, given in the Document for public access to a Transparent copy of the Document, and likewise the network locations given in the Document for previous versions it was based on. These may be placed in the &quot;History&quot; section. You may omit a network location for a work that was published at least four years before the Document itself, or if the original publisher of the version it refers to gives permission.</span></p></li>
<li>
<p><span class="font19">* K. For any section Entitled &quot;Acknowledgements&quot; or &quot;Dedications&quot;, Preserve the Title of the section, and preserve in the section all the substance and tone of each of the contributor acknowledgements and/or dedications given therein.</span></p></li>
<li>
<p><span class="font19">* L. Preserve all the Invariant Sections of the Document, unaltered in their text and in their titles. Section numbers or the equivalent are not considered part of the section titles.</span></p></li>
<li>
<p><span class="font19">* M. Delete any section Entitled &quot;Endorsements&quot;. Such a section may not be included in the Modified Version.</span></p></li>
<li>
<p><span class="font19">* N. Do not retitle any existing section to be Entitled &quot;Endorsements&quot; or to conflict in title with any Invariant Section.</span></p></li>
<li>
<p><span class="font19">* O. Preserve any Warranty Disclaimers.</span></p></li></ul>
<p><span class="font19">If the Modified Version includes new front-matter sections or appendices that qualify as Secondary Sections and contain no material copied from the Document, you may at your option designate some or all of these sections as invariant. To do this, add their titles to the list of Invariant Sections in the Modified Version's license notice. These titles must be distinct from any other section titles.</span></p>
<p><span class="font19">You may add a section Entitled &quot;Endorsements&quot;, provided it contains nothing but endorsements of your Modified Version by various parties—for example, statements of peer review or that the text has been approved by an organization as the authoritative definition of a standard.</span></p>
<p><span class="font19">You may add a passage of up to five words as a Front-Cover Text, and a passage of up to 25 words as a Back-Cover Text, to the end of the list of Cover Texts in the Modified Version. Only one passage of Front-Cover Text and one of Back-Cover Text may be added by (or through arrangements made by) any one entity. If the Document already includes a cover text for the same cover, previously added by you or by arrangement made by the same entity you are acting on behalf of, you may not add another; but you may replace the old one, on explicit permission from the previous publisher that added the old one.</span></p>
<p><span class="font19">The author(s) and publisher(s) of the Document do not by this License give permission to use their names for publicity for or to assert or imply endorsement of any Modified Version.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">5. COMBINING DOCUMENTS</span></p></li></ul>
<p><span class="font19">You may combine the Document with other documents released under this License, under the terms defined in section 4 above for modified versions, provided that you include in the combination all of the Invariant Sections of all of the original documents, unmodified, and list them all as Invariant Sections of your combined work in its license notice, and that you preserve all their Warranty Disclaimers.</span></p>
<p><span class="font19">The combined work need only contain one copy of this License, and multiple identical Invariant Sections may be replaced with a single copy. If there are multiple Invariant Sections with the same name but different contents, make the title of each such section unique by adding at the end of it, in parentheses, the name of the original author or publisher of that section if known, or else a unique number. Make the same adjustment to the section titles in the list of Invariant Sections in the license notice of the combined work.</span></p>
<p><span class="font19">In the combination, you must combine any sections Entitled &quot;History&quot; in the various original documents, forming one section Entitled &quot;History&quot;; likewise combine any sections Entitled &quot;Acknowledgements&quot;, and any sections Entitled &quot;Dedications&quot;. You must delete all sections Entitled &quot;Endorsements&quot;.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">6. COLLECTIONS OF DOCUMENTS</span></p></li></ul>
<p><span class="font19">You may make a collection consisting of the Document and other documents released under this License, and replace the individual copies of this License in the various documents with a single copy that is included in the collection, provided that you follow the rules of this License for verbatim copying of each of the documents in all other respects.</span></p>
<p><span class="font19">You may extract a single document from such a collection, and distribute it individually under this License, provided you insert a copy of this License into the extracted document, and follow this License in all other respects regarding verbatim copying of that document.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">7. AGGREGATION WITH INDEPENDENT WORKS</span></p></li></ul>
<p><span class="font19">A compilation of the Document or its derivatives with other separate and independent documents or works, in or on a volume of a storage or distribution medium, is called an &quot;aggregate&quot; if the copyright resulting from the compilation is not used to limit the legal rights of the compilation's users beyond what the individual works permit. When the Document is included in an aggregate, this License does not apply to the other works in the aggregate which are not themselves derivative works of the Document.</span></p>
<p><span class="font19">If the Cover Text requirement of section 3 is applicable to these copies of the Document, then if the Document is less than one half of the entire aggregate, the Document's Cover Texts may be placed on covers that bracket the Document within the aggregate, or the electronic equivalent of covers if the Document is in electronic form. Otherwise they must appear on printed covers that bracket the whole aggregate.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">8. TRANSLATION</span></p></li></ul>
<p><span class="font19">Translation is considered a kind of modification, so you may distribute translations of the Document under the terms of section 4. Replacing Invariant Sections with translations requires special permission from their copyright holders, but you may include translations of some or all Invariant Sections in addition to the original versions of these Invariant Sections. You may include a translation of this License, and all the license notices in the Document, and any Warranty Disclaimers, provided that you also include the original English version of this License and the original versions of those notices and disclaimers. In case of a disagreement between the translation and the original version of this License or a notice or disclaimer, the original version will prevail.</span></p>
<p><span class="font19">If a section in the Document is Entitled &quot;Acknowledgements&quot;, &quot;Dedications&quot;, or &quot;History&quot;, the requirement (section 4) to Preserve its Title (section 1) will typically require changing the actual title.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">9. TERMINATION</span></p></li></ul>
<p><span class="font19">You may not copy, modify, sublicense, or distribute the Document except as expressly provided under this License. Any attempt otherwise to copy, modify, sublicense, or distribute it is void, and will automatically terminate your rights under this License.</span></p>
<p><span class="font19">However, if you cease all violation of this License, then your license from a particular copyright holder is reinstated (a) provisionally, unless and until the copyright holder explicitly and finally terminates your license, and (b) permanently, if the copyright holder fails to notify you of the violation by some reasonable means prior to 60 days after the cessation.</span></p>
<p><span class="font19">Moreover, your license from a particular copyright holder is reinstated permanently if the copyright holder notifies you of the violation by some reasonable means, this is the first time you have received notice of violation of this License (for any work) from that copyright holder, and you cure the violation prior to 30 days after your receipt of the notice.</span></p>
<p><span class="font19">Termination of your rights under this section does not terminate the licenses of parties who have received copies or rights from you under this License. If your rights have been terminated and not permanently reinstated, receipt of a copy of some or all of the same material does not give you any rights to use it.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">10. FUTURE REVISIONS OF THIS LICENSE</span></p></li></ul>
<p><span class="font19">The Free Software Foundation may publish new, revised versions of the GNU Free Documentation License from time to time. Such new versions will be similar in spirit to the present version, but may differ in detail to address new problems or concerns. See </span><a href="http://www.gnu.org/copyleft/"><span class="font19">http://www.gnu.org/copyleft/</span></a><span class="font19">.</span></p>
<p><span class="font19">Each version of the License is given a distinguishing version number. If the Document specifies that a particular numbered version of this License &quot;or any later version&quot; applies to it, you have the option of following the terms and conditions either of that specified version or of any later version that has been published (not as a draft) by the Free Software Foundation. If the Document does not specify a version number of this License, you may choose any version ever published (not as a draft) by the Free Software Foundation. If the Document specifies that a proxy can decide which future versions of this License can be used, that proxy's public statement of acceptance of a version permanently authorizes you to choose that version for the Document.</span></p>
<ul style="list-style:none;"><li>
<p><span class="font19">11. RELICENSING</span></p></li></ul>
<p><span class="font19">&quot;Massive Multiauthor Collaboration Site&quot; (or &quot;MMC Site&quot;) means any World Wide Web server that publishes copyrightable works and also provides prominent facilities for anybody to edit those works. A public wiki that anybody can edit is an example of such a server. A &quot;Massive Multiauthor Collaboration&quot; (or &quot;MMC&quot;) contained in the site means any set of copyrightable works thus published on the MMC site.</span></p>
<p><span class="font19">&quot;CC-BY-SA&quot; means the Creative Commons Attribution-Share Alike 3.0 license published by Creative Commons Corporation, a not-for-profit corporation with a principal place of business in San Francisco, California, as well as future copyleft versions of that license published by that same organization.</span></p>
<p><span class="font19">&quot;Incorporate&quot; means to publish or republish a Document, in whole or in part, as part of another Document.</span></p>
<p><span class="font19">An MMC is &quot;eligible for relicensing&quot; if it is licensed under this License, and if all works that were first published under this License somewhere other than this MMC, and subsequently incorporated in whole or in part into the MMC, (1) had no cover texts or invariant sections, and (2) were thus incorporated prior to November 1, 2008.</span></p>
<p><span class="font19">The operator of an MMC Site may republish an MMC contained in the site under CC-BY-SA on the same site at any time before August 1, 2009, provided the MMC is eligible for relicensing.</span></p>
<table border="1">
<tr><td style="vertical-align:top;">
<p><a name="bookmark10328"></a><span class="font11" style="font-weight:bold;">Index</span></p></td><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">D</span></p>
<p><span class="font24">df -i, </span><a href="#bookmark9942"><span class="font24">68</span></a></p>
<p><span class="font24">dhclient,</span><a href="#bookmark10067"><span class="font24"> 81</span></a></p></td></tr>
<tr><td style="vertical-align:top;">
<p><span class="font7" style="font-weight:bold;">Symbols</span></p>
<p><span class="font24">/bin/bash, </span><a href="#bookmark9664"><span class="font24">30</span></a></p>
<p><span class="font24">/bin/ksh,</span><a href="#bookmark9665"><span class="font24"> 30</span></a></p>
<p><span class="font24">/etc/bashrc,</span><a href="#bookmark9680"><span class="font24"> 31</span></a></p>
<p><span class="font24">/etc/default/useradd,</span><a href="#bookmark9555"><span class="font24"> 14</span></a></p>
<p><span class="font24">/etc/fstab, </span><a href="#bookmark9900"><span class="font24">64</span></a></p>
<p><span class="font24">/etc/group,</span><a href="#bookmark9710"><span class="font24"> 37</span></a><span class="font24">, </span><a href="#bookmark9796"><span class="font24">46</span></a></p>
<p><span class="font24">/etc/gshadow,</span><a href="#bookmark9740"><span class="font24"> 39</span></a></p>
<p><span class="font24">/etc/inputrc, </span><a href="#bookmark9667"><span class="font24">30</span></a></p>
<p><span class="font24">/etc/login.defs, </span><a href="#bookmark9618"><span class="font24">24</span></a></p>
<p><span class="font24">/etc/passwd,</span><a href="#bookmark9544"><span class="font24"> 13</span></a><span class="font24">,</span><a href="#bookmark9577"><span class="font24"> 16</span></a><span class="font24">,</span><a href="#bookmark9631"><span class="font24"> 25</span></a><span class="font24">, </span><a href="#bookmark9632"><span class="font24">25</span></a><span class="font24">, </span><a href="#bookmark9797"><span class="font24">46</span></a></p>
<p><span class="font24">/etc/profile, </span><a href="#bookmark9666"><span class="font24">30</span></a></p>
<p><span class="font24">/etc/selinux/config,</span><a href="#bookmark10211"><span class="font24"> 102</span></a></p>
<p><span class="font24">/etc/shadow, </span><a href="#bookmark9600"><span class="font24">21</span></a><span class="font24">,</span><a href="#bookmark9615"><span class="font24"> 23</span></a><span class="font24">, </span><a href="#bookmark9884"><span class="font24">59</span></a></p>
<p><span class="font24">/etc/shells,</span><a href="#bookmark9580"><span class="font24"> 16</span></a></p>
<p><span class="font24">/etc/skel,</span><a href="#bookmark9571"><span class="font24"> 15</span></a></p>
<p><span class="font24">/etc/sudoers, </span><a href="#bookmark9506"><span class="font24">7</span></a><span class="font24">,</span><a href="#bookmark9514"><span class="font24"> 8</span></a></p>
<p><span class="font24">/etc/sysctl.conf, </span><a href="#bookmark10053"><span class="font24">79</span></a></p>
<p><span class="font24">/proc/sys/net/ipv4/ip_forward, </span><a href="#bookmark10050"><span class="font24">79</span></a></p>
<p><span class="font24">/selinux,</span><a href="#bookmark10226"><span class="font24"> 104</span></a></p>
<p><span class="font24">/selinux/enforce,</span><a href="#bookmark10227"><span class="font24"> 104</span></a></p>
<p><span class="font24">/tmp,</span><a href="#bookmark9875"><span class="font24"> 58</span></a></p>
<p><span class="font24">/usr/bin/getfacl,</span><a href="#bookmark9905"><span class="font24"> 64</span></a></p>
<p><span class="font24">/usr/bin/passwd,</span><a href="#bookmark9885"><span class="font24"> 59</span></a></p>
<p><span class="font24">/usr/bin/setfacl,</span><a href="#bookmark9909"><span class="font24"> 64</span></a></p>
<p><span class="font24">/var/log/audit/audit.log,</span><a href="#bookmark10177"><span class="font24"> 100</span></a></p>
<p><span class="font24">.. (directory),</span><a href="#bookmark9958"><span class="font24"> 69</span></a></p>
<p><span class="font24">. (directory), </span><a href="#bookmark9959"><span class="font24">69</span></a></p>
<p><span class="font24">.bash_login,</span><a href="#bookmark9674"><span class="font24"> 31</span></a></p>
<p><span class="font24">.bash_logout,</span><a href="#bookmark9683"><span class="font24"> 32</span></a></p>
<p><span class="font24">.bash_profile, </span><a href="#bookmark9670"><span class="font24">30</span></a></p>
<p><span class="font24">.bashrc,</span><a href="#bookmark9671"><span class="font24"> 30</span></a><span class="font24">,</span><a href="#bookmark9677"><span class="font24"> 31</span></a></p>
<p><span class="font24">777,</span><a href="#bookmark9854"><span class="font24"> 52</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">directory,</span><a href="#bookmark9954"><span class="font24"> 69</span></a></p>
<p><span class="font24">DNAT, </span><a href="#bookmark10044"><span class="font24">78</span></a></p>
<p><span class="font7" style="font-weight:bold;">E</span></p>
<p><span class="font24">eiciel,</span><a href="#bookmark9930"><span class="font24"> 66</span></a></p>
<p><span class="font7" style="font-weight:bold;">F</span></p>
<p><span class="font24">file ownership, </span><a href="#bookmark9798"><span class="font24">46</span></a></p>
<p><span class="font24">filter table (iptables),</span><a href="#bookmark10079"><span class="font24"> 86</span></a></p>
<p><span class="font24">find(1), </span><a href="#bookmark9879"><span class="font24">58</span></a><span class="font24">,</span><a href="#bookmark9887"><span class="font24"> 59</span></a><span class="font24">, </span><a href="#bookmark9968"><span class="font24">70</span></a></p>
<p><span class="font24">firewall, </span><a href="#bookmark10018"><span class="font24">77</span></a></p>
<p><span class="font7" style="font-weight:bold;">G</span></p>
<p><span class="font24">gcc(1),</span><a href="#bookmark9612"><span class="font24"> 23</span></a></p>
<p><span class="font24">getenforce,</span><a href="#bookmark10185"><span class="font24"> 101</span></a></p>
<p><span class="font24">getfacl,</span><a href="#bookmark9906"><span class="font24"> 64</span></a></p>
<p><span class="font24">getfattr(1),</span><a href="#bookmark10260"><span class="font24"> 107</span></a></p>
<p><span class="font24">GID,</span><a href="#bookmark9711"><span class="font24"> 37</span></a></p>
<p><span class="font24">gpasswd,</span><a href="#bookmark9734"><span class="font24"> 39</span></a></p>
<p><span class="font24">groupadd(1),</span><a href="#bookmark9707"><span class="font24"> 37</span></a></p>
<p><span class="font24">groupdel(1), </span><a href="#bookmark9729"><span class="font24">38</span></a></p>
<p><span class="font24">groupmod(1),</span><a href="#bookmark9724"><span class="font24"> 38</span></a></p>
<p><span class="font24">groups,</span><a href="#bookmark9704"><span class="font24"> 36</span></a></p>
<p><span class="font24">groups(1),</span><a href="#bookmark9714"><span class="font24"> 37</span></a></p>
<p><span class="font7" style="font-weight:bold;">H</span></p>
<p><span class="font24">hard link, </span><a href="#bookmark9964"><span class="font24">70</span></a></p>
<p><span class="font7" style="font-weight:bold;">I</span></p>
<p><span class="font24">id,</span><a href="#bookmark9486"><span class="font24"> 5</span></a></p>
<p><span class="font24">id(1),</span><a href="#bookmark10250"><span class="font24"> 106</span></a></p>
<p><span class="font24">identity(selinux),</span><a href="#bookmark10230"><span class="font24"> 104</span></a></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">A</span></p>
<p><span class="font24">access control list, </span><a href="#bookmark9901"><span class="font24">64</span></a></p>
<p><span class="font24">acl,</span><a href="#bookmark9929"><span class="font24"> 66</span></a></p>
<p><span class="font24">acls, </span><a href="#bookmark9902"><span class="font24">64</span></a></p>
<p><span class="font24">auditd,</span><a href="#bookmark10178"><span class="font24"> 100</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">inode, </span><a href="#bookmark9934"><span class="font24">67</span></a><span class="font24">, </span><a href="#bookmark9969"><span class="font24">70</span></a></p>
<p><span class="font24">inode table, </span><a href="#bookmark9943"><span class="font24">68</span></a></p>
<p><span class="font24">iptables,</span><a href="#bookmark10073"><span class="font24"> 85</span></a><span class="font24">,</span><a href="#bookmark10076"><span class="font24"> 86</span></a></p>
<p><span class="font24">iptables save, </span><a href="#bookmark10119"><span class="font24">90</span></a></p>
<p><span class="font7" style="font-weight:bold;">K</span></p></td></tr>
<tr><td style="vertical-align:bottom;">
<p><span class="font7" style="font-weight:bold;">C</span></p>
<p><span class="font24">chage, </span><a href="#bookmark9621"><span class="font24">24</span></a></p>
<p><span class="font24">chain (iptables),</span><a href="#bookmark10087"><span class="font24"> 86</span></a></p>
<p><span class="font24">chcon(1),</span><a href="#bookmark10251"><span class="font24"> 106</span></a><span class="font24">,</span><a href="#bookmark10270"><span class="font24"> 107</span></a></p>
<p><span class="font24">chgrp(1), </span><a href="#bookmark9803"><span class="font24">47</span></a></p>
<p><span class="font24">chkconfig,</span><a href="#bookmark10179"><span class="font24"> 100</span></a></p>
<p><span class="font24">chmod,</span><a href="#bookmark9566"><span class="font24"> 15</span></a><span class="font24">, </span><a href="#bookmark9855"><span class="font24">52</span></a><span class="font24">,</span><a href="#bookmark10218"><span class="font24"> 103</span></a></p>
<p><span class="font24">chmod(1), </span><a href="#bookmark9831"><span class="font24">51</span></a></p>
<p><span class="font24">chmod +x, </span><a href="#bookmark9861"><span class="font24">53</span></a></p>
<p><span class="font24">chown,</span><a href="#bookmark9567"><span class="font24"> 15</span></a></p>
<p><span class="font24">chown(1), </span><a href="#bookmark9808"><span class="font24">47</span></a></p>
<p><span class="font24">chsh(1),</span><a href="#bookmark9581"><span class="font24"> 16</span></a></p>
<p><span class="font24">context type(selinux),</span><a href="#bookmark10236"><span class="font24"> 105</span></a></p>
<p><span class="font24">crypt,</span><a href="#bookmark9604"><span class="font24"> 22</span></a></p></td><td style="vertical-align:bottom;">
<p><span class="font24">Korn Shell,</span><a href="#bookmark9582"><span class="font24"> 16</span></a></p>
<p><span class="font7" style="font-weight:bold;">L</span></p>
<p><span class="font24">ln, </span><a href="#bookmark9972"><span class="font24">71</span></a></p>
<p><span class="font24">ln(1), </span><a href="#bookmark9965"><span class="font24">70</span></a></p>
<p><span class="font24">ls, </span><a href="#bookmark9824"><span class="font24">49</span></a><span class="font24">,</span><a href="#bookmark9939"><span class="font24"> 68</span></a><span class="font24">,</span><a href="#bookmark10221"><span class="font24"> 103</span></a></p>
<p><span class="font24">ls(1),</span><a href="#bookmark9947"><span class="font24"> 68</span></a><span class="font24">, </span><a href="#bookmark9955"><span class="font24">69</span></a><span class="font24">,</span><a href="#bookmark10257"><span class="font24"> 107</span></a></p>
<p><span class="font24">ls -l, </span><a href="#bookmark9816"><span class="font24">48</span></a></p>
<p><span class="font7" style="font-weight:bold;">M</span></p>
<p><span class="font24">mac address,</span><a href="#bookmark10062"><span class="font24"> 80</span></a></p>
<p><span class="font24">mangle table (iptables),</span><a href="#bookmark10084"><span class="font24"> 86</span></a></p>
<p><span class="font24">masquerading, </span><a href="#bookmark10041"><span class="font24">78</span></a></p>
<p><span class="font24">md5, </span><a href="#bookmark9614"><span class="font24">23</span></a></p></td></tr>
</table>
<p><span class="font24">mkdir,</span><a href="#bookmark9568"><span class="font24"> 15</span></a></p>
<p><span class="font24">mkdir(1), </span><a href="#bookmark9864"><span class="font24">53</span></a></p>
<p><span class="font24">mkfs,</span><a href="#bookmark9944"><span class="font24"> 68</span></a></p>
<p><span class="font7" style="font-weight:bold;">N</span></p>
<p><span class="font24">NAPT, </span><a href="#bookmark10034"><span class="font24">78</span></a></p>
<p><span class="font24">NAT, </span><a href="#bookmark10031"><span class="font24">78</span></a></p>
<p><span class="font24">nat table (iptables),</span><a href="#bookmark10081"><span class="font24"> 86</span></a></p>
<p><span class="font7" style="font-weight:bold;">O</span></p>
<p><span class="font24">octal permissions,</span><a href="#bookmark9851"><span class="font24"> 52</span></a></p>
<p><span class="font24">openssl, </span><a href="#bookmark9609"><span class="font24">22</span></a></p>
<p><span class="font24">owner, </span><a href="#bookmark9826"><span class="font24">49</span></a></p>
<p><span class="font7" style="font-weight:bold;">P</span></p>
<p><span class="font24">packet filtering, </span><a href="#bookmark10025"><span class="font24">77</span></a><span class="font24">,</span><a href="#bookmark10099"><span class="font24"> 87</span></a></p>
<p><span class="font24">packet forwarding, </span><a href="#bookmark10022"><span class="font24">77</span></a></p>
<p><span class="font24">passwd, </span><a href="#bookmark9597"><span class="font24">21</span></a><span class="font24">, </span><a href="#bookmark9601"><span class="font24">21</span></a><span class="font24">,</span><a href="#bookmark9605"><span class="font24"> 22</span></a><span class="font24">, </span><a href="#bookmark9622"><span class="font24">24</span></a></p>
<p><span class="font24">passwd(1), </span><a href="#bookmark9886"><span class="font24">59</span></a></p>
<p><span class="font24">PAT, </span><a href="#bookmark10035"><span class="font24">78</span></a></p>
<p><span class="font24">ping,</span><a href="#bookmark10063"><span class="font24"> 80</span></a><span class="font24">,</span><a href="#bookmark10064"><span class="font24"> 81</span></a></p>
<p><span class="font24">port forwarding, </span><a href="#bookmark10047"><span class="font24">78</span></a></p>
<p><span class="font24">primary group,</span><a href="#bookmark9552"><span class="font24"> 14</span></a></p>
<p><span class="font24">ps(1),</span><a href="#bookmark10265"><span class="font24"> 107</span></a></p>
<p><span class="font7" style="font-weight:bold;">R</span></p>
<p><span class="font24">rm(1), </span><a href="#bookmark9981"><span class="font24">71</span></a></p>
<p><span class="font24">role(selinux),</span><a href="#bookmark10233"><span class="font24"> 104</span></a></p>
<p><span class="font24">root, </span><a href="#bookmark9496"><span class="font24">6</span></a><span class="font24">, </span><a href="#bookmark9507"><span class="font24">7</span></a><span class="font24">,</span><a href="#bookmark9515"><span class="font24"> 8</span></a><span class="font24">,</span><a href="#bookmark9547"><span class="font24"> 13</span></a></p>
<p><span class="font24">router, </span><a href="#bookmark10019"><span class="font24">77</span></a></p>
<p><span class="font7" style="font-weight:bold;">S</span></p>
<p><span class="font24">salt (encryption), </span><a href="#bookmark9613"><span class="font24">23</span></a></p>
<p><span class="font24">SELinux, </span><a href="#bookmark10172"><span class="font24">99</span></a></p>
<p><span class="font24">selinux,</span><a href="#bookmark10199"><span class="font24"> 102</span></a></p>
<p><span class="font24">selinux-activate,</span><a href="#bookmark10182"><span class="font24"> 100</span></a></p>
<p><span class="font24">sestatus,</span><a href="#bookmark10200"><span class="font24"> 102</span></a></p>
<p><span class="font24">setenforce,</span><a href="#bookmark10192"><span class="font24"> 101</span></a></p>
<p><span class="font24">setfacl, </span><a href="#bookmark9910"><span class="font24">64</span></a></p>
<p><span class="font24">setgid,</span><a href="#bookmark9878"><span class="font24"> 58</span></a><span class="font24">, </span><a href="#bookmark9880"><span class="font24">58</span></a></p>
<p><span class="font24">setuid,</span><a href="#bookmark9883"><span class="font24"> 59</span></a><span class="font24">, </span><a href="#bookmark9888"><span class="font24">59</span></a><span class="font24">,</span><a href="#bookmark9891"><span class="font24"> 59</span></a></p>
<p><span class="font24">shell, </span><a href="#bookmark9661"><span class="font24">29</span></a></p>
<p><span class="font24">SNAT, </span><a href="#bookmark10038"><span class="font24">78</span></a></p>
<p><span class="font24">soft link, </span><a href="#bookmark9973"><span class="font24">71</span></a></p>
<p><span class="font24">stateful firewall, </span><a href="#bookmark10028"><span class="font24">77</span></a></p>
<p><span class="font24">sticky bit, </span><a href="#bookmark9874"><span class="font24">58</span></a></p>
<p><span class="font24">su, </span><a href="#bookmark9493"><span class="font24">6</span></a><span class="font24">, </span><a href="#bookmark9501"><span class="font24">6</span></a><span class="font24">, </span><a href="#bookmark9626"><span class="font24">25</span></a><span class="font24">, </span><a href="#bookmark9735"><span class="font24">39</span></a></p>
<p><span class="font24">sudo, </span><a href="#bookmark9508"><span class="font24">7</span></a><span class="font24">,</span><a href="#bookmark9516"><span class="font24"> 8</span></a><span class="font24">, </span><a href="#bookmark9627"><span class="font24">25</span></a></p>
<p><span class="font24">sudo su -,</span><a href="#bookmark9517"><span class="font24"> 8</span></a></p>
<p><span class="font24">superuser,</span><a href="#bookmark9548"><span class="font24"> 13</span></a></p>
<p><span class="font24">symbolic link, </span><a href="#bookmark9974"><span class="font24">71</span></a></p>
<p><span class="font24">sysctl, </span><a href="#bookmark10056"><span class="font24">79</span></a></p>
<p><span class="font7" style="font-weight:bold;">T</span></p>
<p><span class="font24">tcpdump,</span><a href="#bookmark10065"><span class="font24"> 81</span></a></p>
<p><span class="font24">transition(selinux),</span><a href="#bookmark10254"><span class="font24"> 106</span></a></p>
<p><span class="font24">type(selinux),</span><a href="#bookmark10239"><span class="font24"> 105</span></a></p>
<div>
<p><span class="font7" style="font-weight:bold;">U</span></p>
<p><span class="font24">umask(1),</span><a href="#bookmark9860"><span class="font24"> 53</span></a></p>
<p><span class="font24">useradd,</span><a href="#bookmark9551"><span class="font24"> 14</span></a><span class="font24">,</span><a href="#bookmark9574"><span class="font24"> 15</span></a><span class="font24">, </span><a href="#bookmark9606"><span class="font24">22</span></a></p>
<p><span class="font24">useradd(1),</span><a href="#bookmark9565"><span class="font24"> 15</span></a></p>
<p><span class="font24">useradd -D,</span><a href="#bookmark9556"><span class="font24"> 14</span></a></p>
<p><span class="font24">userdel(1),</span><a href="#bookmark9559"><span class="font24"> 14</span></a></p>
<p><span class="font24">usermod,</span><a href="#bookmark9625"><span class="font24"> 25</span></a><span class="font24">, </span><a href="#bookmark9628"><span class="font24">25</span></a><span class="font24">,</span><a href="#bookmark9717"><span class="font24"> 38</span></a><span class="font24"> usermod(1),</span><a href="#bookmark9562"><span class="font24"> 14</span></a></p>
<p><span class="font7" style="font-weight:bold;">V</span></p>
<p><span class="font24">vi, </span><a href="#bookmark9751"><span class="font24">40</span></a></p>
<p><span class="font24">vigr(1), </span><a href="#bookmark9752"><span class="font24">40</span></a></p>
<p><span class="font24">vipw,</span><a href="#bookmark9633"><span class="font24"> 25</span></a></p>
<p><span class="font24">virtualbox,</span><a href="#bookmark10059"><span class="font24"> 80</span></a></p>
<p><span class="font24">visudo, </span><a href="#bookmark9511"><span class="font24">7</span></a></p>
<p><span class="font24">vmware,</span><a href="#bookmark10060"><span class="font24"> 80</span></a></p>
<p><span class="font7" style="font-weight:bold;">W</span></p>
<p><span class="font24">w, </span><a href="#bookmark9481"><span class="font24">5</span></a></p>
<p><span class="font24">who, </span><a href="#bookmark9471"><span class="font24">5</span></a></p>
<p><span class="font24">whoami,</span><a href="#bookmark9466"><span class="font24"> 5</span></a></p>
<p><span class="font24">who am i, </span><a href="#bookmark9476"><span class="font24">5</span></a></p>
<p><span class="font24">wireshark,</span><a href="#bookmark10066"><span class="font24"> 81</span></a></p>
</div><br clear="all">
<p><span class="font24">123</span></p>
</body>
</html>
