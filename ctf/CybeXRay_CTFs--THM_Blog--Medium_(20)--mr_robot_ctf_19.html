<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>mr robot ctf</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>mr robot ctf</h1><br/><p></p><p><strong><h1>Mr Robot CTF</h1></strong></p><p><strong>Machine IP: 				10.10.108.225 			10.10.7.69</strong></p><p></p><p>We begin with nmap scan</p><p></p><p><img src="images/19-1.png" alt="images/19-1.png" /></p><p></p><p>We find port 80 &amp; 443 Open &amp; port 22 shown as closed (Might be partially open - Not needed for the write up)</p><p></p><p>We browse the website manually, it has various cool pages. But nothing intresting to give us access.</p><p>We then do an enumeration of directories with gobuster.</p><p></p><p><em><strong>gobuster dir -u http://10.10.108.225 -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt</strong></em></p><p></p><p><strong>Output:</strong></p><p><img src="images/19-2.png" alt="images/19-2.png" /></p><p></p><p><strong>We find 2 intresting files with (Status: 200).</strong></p><p>/robots -------→ Instruction for webpage crawlers </p><p>/wp-login ------→ Wordpress Login</p><p></p><p></p><p><img src="images/19-3.png" alt="images/19-3.png" /></p><p></p><p>Accessing <strong>http://10.10.7.69/robots</strong> we get the above. </p><p></p><p>We get the <strong>first key</strong> and a dictionary file named <strong>fscocity.dic</strong></p><p></p><p></p><p><strong>http://10.10.7.69/key-1-of-3.txt</strong></p><p><img src="images/19-4.png" alt="images/19-4.png" /></p><p></p><p></p><p><strong>http://10.10.7.69/fsocity.dic</strong></p><p><img src="images/19-5.png" alt="images/19-5.png" /></p><p></p><p></p><p>Next we open the other intresting page. <strong>wp-login</strong></p><p>We will use <strong>hydra</strong> and <strong>dictionary file</strong> recieved to find out both <strong>username</strong> and <strong>password</strong>.</p><p></p><p>We capture the post request with burpsuite and collect the three important parameters.</p><p></p><p>1. Post Requester</p><p>2. Post Request</p><p>3. Error Message</p><p></p><p><strong>We get 1 and 2 below</strong></p><p><img src="images/19-6.png" alt="images/19-6.png" /></p><p><strong>We get 3 below</strong></p><p><img src="images/19-7.png" alt="images/19-7.png" /></p><p></p><p><strong>Hydra Code for finding out Username:</strong></p><p></p><p><em><strong>hydra -L /home/cybex/lab/thm/MrRobotCTF/fsocity.dic -p test -s 80 10.10.7.69 http-post-form &quot;/wp-login.php:log=^USER^&amp;pwd=^PASS^&amp;wp-submit=Log+In&amp;redirect_to=http%3A%2F%2F10.10.7.69%2Fwp-admin%2F&amp;testcookie=1:Invalid username&quot; -vv -t 64</strong></em></p><p></p><p><img src="images/19-8.png" alt="images/19-8.png" /></p><p></p><p>We found that <strong>Elliot</strong> is a valid username. This can be confirmed by using the above credentials in wordpress login. We will get a different error message.</p><p></p><p><img src="images/19-9.png" alt="images/19-9.png" /></p><p></p><p></p><p></p><p>keeping the 1 and 2 parameters same. We change the 3 parameter to the above error and following is the hydra code for password brute-force with Elliot as user.</p><p></p><p><strong>Hydra Code for finding out Password:</strong></p><p></p><p><em><strong>hydra -l Elliot -P /home/cybex/lab/thm/MrRobotCTF/fsocity.dic -s 80 10.10.7.69 http-post-form &quot;/wp-login.php:log=^USER^&amp;pwd=^PASS^&amp;wp-submit=Log+In&amp;redirect_to=http%3A%2F%2F10.10.7.69%2Fwp-admin%2F&amp;testcookie=1:The password you entered for the username&quot; -vv -t 64</strong></em></p><p></p><p><img src="images/19-10.png" alt="images/19-10.png" /></p><p></p><p></p><p><strong>Thus, we get the wordpress credentials:</strong></p><p><strong>Username: Elliot</strong></p><p><strong>Password: ER28-0652</strong></p><p></p><p><strong>Note:</strong></p><p>Alternative to Bruteforce, the page <strong>/license</strong> contains the <strong>username</strong> &amp; <strong>password</strong> in its source code.</p><p></p><p></p><p>Next we login to <strong>wp-login</strong> page and gain foot hold by editing a non-default theme and live preview it, (So that it will load all the php files and in doing so our reverse shell php will also get executed.)</p><p></p><p><strong>Note:</strong>  1) Choose a non-default theme so that we can live preview it.</p><p>			2) Choose any php to replace with reverse shell code. (However, 404.php is more common for this purpose as its present in almost all themes and can be easily used.</p><p></p><p><strong>See the following process:</strong></p><p></p><p><img src="images/19-11.png" alt="images/19-11.png" /></p><p></p><p>Once we are at the dashboard.</p><p></p><p>Go to <strong>Appearance ---→ Themes</strong></p><p></p><p><img src="images/19-12.png" alt="images/19-12.png" /></p><p></p><p>We notice that there are 3 themes.</p><p>We should ideally choose any non default theme. <strong>eg. Twenty Fourteen or Twenty Thirteen</strong></p><p></p><p><strong>Say We select Twenty Fourteen.</strong> Just keep the name in mind</p><p>and <strong>Go to Appearance ----→ Editor</strong></p><p></p><p><img src="images/19-13.png" alt="images/19-13.png" /></p><p></p><p>In the editor select theme, in the upper right corner highlighted above.</p><p>Select previously discussed <strong>Twenty Fourteen</strong></p><p></p><p><img src="images/19-14.png" alt="images/19-14.png" /></p><p></p><p>Then click on <strong>404 Template</strong>. It will open the <strong>404.php</strong></p><p><strong>Remove</strong> the enitire contents and <strong>replace</strong> with a <strong>php-reverse-shell</strong></p><p>Then hit <strong>Update File</strong> at the bottom of the page to save it.</p><p></p><p></p><p>Now, open a netcat listner in our terminal.</p><p>To run the reverse shell payload.</p><p></p><p>Go back to <strong>Appearance ---→ Themes</strong></p><p>Then hover the mouse on <strong>Twenty Fourteen</strong> and click on <strong>Live Preview</strong></p><p><strong>Note:</strong> if Live Preview doesn&#39;t work. Go to <em><strong>http://10.10.7.69/wp-admin/404.php?theme=twentyfourteen</strong></em></p><p></p><p></p><p><img src="images/19-15.png" alt="images/19-15.png" /></p><p></p><p>By doing this we will get a shell in our netcat listener.</p><p></p><p><img src="images/19-16.png" alt="images/19-16.png" /></p><p></p><p>We got our initial foothold as user <strong>‘daemon’</strong></p><p></p><p></p><p><strong>Changing to a system user</strong></p><p></p><p><img src="images/19-17.png" alt="images/19-17.png" /></p><p></p><p>We have a MD5 Password for the user robot it seems. We copy it to a local hash file.</p><p>We crack it using john</p><p></p><p><em><strong>john --format=Raw-MD5 --wordlist=/usr/share/wordlists/rockyou.txt john_hash_robot</strong></em></p><p></p><p><img src="images/19-18.png" alt="images/19-18.png" /></p><p></p><p>Thus we find the password to be <strong>abcdefghijklmnopqrstuvwxyz</strong></p><p></p><p>We stablize the terminal with <strong>python</strong>.</p><p>We use <strong>su</strong> to switch to user <strong>robot</strong> using the above passord.</p><p></p><p></p><p></p><p></p><p></p><p><strong>Privilege Escalation</strong></p><p></p><p><img src="images/19-19.png" alt="images/19-19.png" /></p><p></p><p></p><p>Once inside the user robot.</p><p>We read the 2nd flag file and then search for ways to do privilege escalation.</p><p>We find the setuid binaries. We find that nmap is allowed to run with SUID bit set.</p><p>We look at GTFObins to find a way to elevate this.</p><p></p><p><strong>/usr/local/bin/nmap --interactive</strong></p><p><strong>!sh</strong></p><p><img src="images/19-20.png" alt="images/19-20.png" /></p><p>Now, we can get the root flag from /root directory.</p><p></p><p></p><p>Thanks!!</p></div>
</body>
</html>
