<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>blog</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>blog</h1><br/><strong><h1>THM Blog</h1></strong><br /><br /><br />To Solve this machine we need to add <strong>blog.thm</strong> to our hosts file as mentioned in the room.<br /><br /><strong><h3>Nmap Scan</h3></strong><br /><br /><img src="images/22-1.png" alt="images/22-1.png" /><br /><br />Ports Open: <strong>22,80,139,445</strong><br /><br /><strong><h3>Enumeration</h3></strong><br /><br />The Samba Port items are <strong>rabbit hole</strong> without any important information.<br /><br /><strong>Website</strong><br />We browsed the website and wappalyzer found <strong>wordpress CMS 5.0</strong> running on the site.<br />We also found a login page.<br /><img src="images/22-2.png" alt="images/22-2.png" /><br /><br />We will use <strong>wpscan</strong> for further emuneration.<br /><br />To enumerate users we use the following<br /><strong>wpscan --url http://blog.thm/ -e u</strong><br /><br /><img src="images/22-3.png" alt="images/22-3.png" /><br /><br />We found 4 possible usernames:<br /><strong>kwheel<br />bjoel<br />Karen Wheeler<br />Billy Joel</strong><br /><br />We then tried each username one by one on the <strong>wp-login</strong> page with a dummy password.<br />(We do this to check the error message of each and find the validity of usernames)<br /><br /><br />Invalid Users: Error Message - <strong>Invalid username.</strong><br /><strong>Karen Wheeler<br />Billy Joel</strong><br /><br /><br />Valid Users: Error Message - <strong>The password you entered for the username xxxx is incorrect</strong><br /><strong>kwheel<br />bjoel</strong><br /><br />Now we use each username separately in <strong>wpscan</strong> brute force.<br /><strong>Note:</strong> We can give a Username file containing both/all usernames. It will take a lot of time.<br />The reason we do it separately because one username can be a rabbit hole. (Found out later)<br /><br /><strong><h3>Brute Force using wpscan</h3></strong><br /><br /><strong>wpscan --url http://blog.thm/ -P /usr/share/wordlists/rockyou.txt -u kwheel --max-threads 50<br />wpscan --url http://blog.thm/ -P /usr/share/wordlists/rockyou.txt -u bjoel --max-threads 50</strong><br /><br /><strong>Note:</strong> The user bjoel is a rabbit hoie and takes forever to crack. However, we cracked <strong>kwheel&#39;s</strong> password.<br /><br /><img src="images/22-4.png" alt="images/22-4.png" /><br /><br />Thus we found the following <strong>wp-login</strong> credentials.<br /><br /><strong>Username: kwheel<br />Password: cutiepie1</strong><br /><br /><br /><strong><h3>Foothold</h3></strong><br /><br />We search <strong>wordpress 5.0</strong> in metasploit framework and use the following exploit.<br /><strong>exploit/multi/http/wp_crop_rce</strong><br /><br /><img src="images/22-5.png" alt="images/22-5.png" /><br /><br />We set the above options. Following is the snap fo final <strong>show options</strong><br /><br /><img src="images/22-6.png" alt="images/22-6.png" /><br /><br />Then we run the exploit and get a user shell.<br /><br /><img src="images/22-7.png" alt="images/22-7.png" /><br /><br /><strong><h3>Privilege Escalation</h3></strong><br /><br />We look for files with <strong>SUID</strong> set for privilege escalation.<br /><strong>find / -type f -perm -04000 2&gt;/dev/null</strong><br /><br /><img src="images/22-8.png" alt="images/22-8.png" /><br /><br />Intresting File Found<br /><strong>/usr/sbin/checker</strong><br /><br /><img src="images/22-9.png" alt="images/22-9.png" /><br /><br />When we run it, we get message. Not an Admin<br /><br />We download the executible and ananlyze it with <strong>ghidra</strong><br />We create a temporary project and open the <strong>checker</strong> executible in <strong>CodeBrowser</strong><br /><br /><img src="images/22-10.png" alt="images/22-10.png" /><br /><br />Click on Import File and add the checker executible into the project.<br /><img src="images/22-11.png" alt="images/22-11.png" /><br /><br /><br />Click on the <strong>Green Dragon</strong> option to open the <strong>CodeBrowser</strong> and add the <strong>checker</strong> file<br /><br /><img src="images/22-12.png" alt="images/22-12.png" /><br /><br />Then we go to the <strong>main function</strong> and analyze it.<br /><br /><img src="images/22-13.png" alt="images/22-13.png" /><br /><br />We see the decompiled code in the right side of the browser.<br />We observe that the program checks an <strong>environment variable</strong> named: <strong>“admin”</strong><br /><br />if its blank it will return as not an admin<br />But if it has any string value it should open a root shell.<br /><br />We try this on the program and get root access.<br /><br /><img src="images/22-14.png" alt="images/22-14.png" /><br /><br /><br />We get the required flags.<br /><br />Thanks !!</div>
</body>
</html>
