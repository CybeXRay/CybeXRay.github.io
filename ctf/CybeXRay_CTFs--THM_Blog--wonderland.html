<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>wonderland</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>wonderland</h1><br/><strong><h1>THM Wonderland</h1></strong><br /><br /><br /><strong><h2>Enumeration</h2></strong><br /><br />Rustscan<br /><img src="images/26-1.png" alt="images/26-1.png" /><br /><br />We get 3 image files in the <strong>http://10.10.237.165/img</strong> directory<br />We use <strong>steghide</strong> to analyze the files. Just hit <strong>“Enter”</strong> when asked for paraphrase.<br /><br /><br /><img src="images/26-2.png" alt="images/26-2.png" /><br /><br /><br /><br /><strong>We use gobuster to find hidden directories.</strong><br /><img src="images/26-3.png" alt="images/26-3.png" /><br /><br />We found <strong>http://10.10.237.165/r </strong>which tells us tp continue<br /><img src="images/26-4.png" alt="images/26-4.png" /><br /><br />We do gobuster again with the new found directory.<br /><br /><img src="images/26-5.png" alt="images/26-5.png" /><br /><br />Using the above and the hint text found. We confim the endpoint url to be <strong>http://10.10.237.165/r/a/b/b/i/t</strong> <br />We find the following.<br /><br /><img src="images/26-6.png" alt="images/26-6.png" /><br /><br /><br />We view its source to find a set of credentials.<br /><img src="images/26-7.png" alt="images/26-7.png" /><br /><br /><br /><strong>Credentials Found</strong><br />Username:	alice<br />Password:	HowDothTheLittleCrocodileImproveHisShiningTail<br /><br /><br /><strong><h2>Foothold</h2></strong><br /><br />We ssh to the machine using the above credentials.<br /><br /><img src="images/26-8.png" alt="images/26-8.png" /><br /><br /><br /><strong><h2>Privilege Escalation</h2></strong><br /><br /><br /><img src="images/26-9.png" alt="images/26-9.png" /><br /><br />We see we can run the python program as <strong>Rabbit</strong> if we run as user <strong>Rabbit</strong><br />Also we notice we can&#39;t edit the <strong>walrus_and_the_carpenter.py </strong>file. <br />But we see it imports <strong>random</strong>. <br />What we can do is create a local python file named random which will open a <strong>shell</strong> as <strong>Rabbit</strong>.<br /><br />Create a file named <strong>random.py</strong> and enter the following.<br /><br /><img src="images/26-10.png" alt="images/26-10.png" /><br /><br />Then we run the python program as rabbit user with sudo as follows<br /><br /><img src="images/26-11.png" alt="images/26-11.png" /><br /><br />Inside Rabbit&#39;s home, we find an intresting executible file called <strong>teaParty</strong> with <strong>SUID</strong> set.<br /><br /><img src="images/26-12.png" alt="images/26-12.png" /><br /><br />We download the executible using scp. But we don&#39;t know ssh password of <strong>Rabbit</strong>.<br />Thus we create a key file in our local machine. Enter a paraphrase to secure it.<br /><br /><img src="images/26-13.png" alt="images/26-13.png" /><br /><br /><img src="images/26-14.png" alt="images/26-14.png" /><br /><br />Then we copy the public key into authorized keys of user <strong>Rabbit</strong><br /><br /><img src="images/26-15.png" alt="images/26-15.png" /><br /><br />Now we can scp without <strong>rabbit&#39;s </strong>password. We need to enter the paraphrase we set before while making the keys.<br /><br /><img src="images/26-16.png" alt="images/26-16.png" /><br /><br /><br />Once we have the executibles ready locally, we can use <strong>strings</strong> or <strong>ghidra</strong> to analyze the files and look for strings.<br /><br /><strong>Strings</strong><br /><img src="images/26-17.png" alt="images/26-17.png" /><br /><br /><strong>ghidra</strong><br /><img src="images/26-18.png" alt="images/26-18.png" /><br /><br />Both cases we see that the <strong>date</strong> program is called without full path.<br />Thus we can create a <strong>local</strong> <strong>date executible</strong> that would run a <strong>shell</strong>. We also need to add the <strong>Rabbit&#39;s home</strong> to the <strong>path</strong>.<br /><br /><img src="images/26-19.png" alt="images/26-19.png" /><br /><br /><br /><br />Then we look for <strong>cap_setuid</strong> files<br /><br /><img src="images/26-20.png" alt="images/26-20.png" /><br /><br />We can use this to spawn a <strong>root shell</strong> as seen in <strong>GTFOBins</strong><br /><br /><img src="images/26-21.png" alt="images/26-21.png" /><br /><br /><br />We use the following and pwn the machine.<br /><strong>/usr/bin/perl -e &#39;use POSIX qw(setuid); POSIX::setuid(0); exec &quot;/bin/bash&quot;;&#39;</strong><br /><br /><img src="images/26-22.png" alt="images/26-22.png" /><br /><br /><br />We get both the flags as shown above.<br />Thanks!!<br /><br /></div>
</body>
</html>
