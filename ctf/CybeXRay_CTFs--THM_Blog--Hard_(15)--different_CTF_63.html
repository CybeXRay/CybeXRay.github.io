<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>different CTF</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>different CTF</h1><br/><p><strong><h1>THM: Different CTF</h1></strong></p><p></p><p><strong><h2>Enumeration</h2></strong></p><p></p><p><strong><span style="text-decoration:underline;">Rustscan &amp; Nmap</span></strong></p><p></p><p><img src="images/63-1.png" alt="images/63-1.png" /></p><p></p><p><strong><span style="text-decoration:underline;">Website Enumeration</span></strong></p><p></p><p>From nmap output we can see that the site uses Wordpress 5.6</p><p>The issue is that if we directly load the IP of the website, the site won&#39;t load properly.</p><p>Therefore, I checked the <strong>network</strong> tab of <strong>inspect</strong> to get any DNS requests being made.</p><p></p><p><img src="images/63-2.png" alt="images/63-2.png" /></p><p></p><p>As we can see the site hasn&#39;t loaded properly. However, there are several requests to domain <strong>adana.thm</strong></p><p>I added it to the hosts file &amp; the website loaded properly.</p><p></p><p><strong>10.10.39.85     adana.thm</strong></p><p></p><p>Then, we go the <strong>http://adana.thm</strong> &amp; the website loaded properly.</p><p>I didn&#39;t find any intresting info in the website. However, there is a login page. But, we do not have any credentials yet.</p><p></p><p><img src="images/63-3.png" alt="images/63-3.png" /></p><p></p><p></p><p><strong><span style="text-decoration:underline;">Directory Enumeration</span></strong></p><p></p><p>Next, i move on to directory enumeration using <strong>gobuster</strong>.</p><p></p><p><img src="images/63-4.png" alt="images/63-4.png" /></p><p></p><p></p><p>we found an intesting directory called <strong>annoucements</strong>. Lets view it.</p><p></p><p><img src="images/63-5.png" alt="images/63-5.png" /></p><p></p><p>In the link, we found a <strong>picture</strong> &amp; a <strong>wordlist</strong>. I downloaded them both.</p><p>I tried to see if anything is hidden in the picture using <strong>steghide</strong>. However, it asks for paraphrase.</p><p></p><p><img src="images/63-6.png" alt="images/63-6.png" /></p><p></p><p></p><p>Thus, we will use <strong>stegcracker</strong> to see whats hidden inside the picture &amp; use the wordlist to open it.</p><p></p><p>stegcracker &lt;filename&gt; &lt;wordlist&gt;</p><p></p><p>eg. <strong>stegcracker austrailian-bulldog-ant.jpg wordlist.txt</strong></p><p></p><p><img src="images/63-7.png" alt="images/63-7.png" /></p><p></p><p>I inspected the output file &amp; found a base64 encoded string. I decoded it to find the FTP Credentials.</p><p></p><p><img src="images/63-8.png" alt="images/63-8.png" /></p><p></p><p></p><p><strong><span style="text-decoration:underline;">FTP Enumeration (With Found credentials)</span></strong></p><p></p><p><img src="images/63-9.png" alt="images/63-9.png" /></p><p></p><p>Next, we explore the files.</p><p></p><p><img src="images/63-10.png" alt="images/63-10.png" /></p><p></p><p>It looks like we are in the root of the WordPress site. On a normal default install the wp-config.php file will contain the database credentials. Let&#39;s get it and have a look:</p><p></p><p><img src="images/63-11.png" alt="images/63-11.png" /></p><p></p><p>We found DB credentials, lets login to the admin login of the webpage.</p><p></p><p><strong><span style="text-decoration:underline;">Website Enumeration-2</span></strong></p><p></p><p>we go to <strong>http://adana.thm/phpmyadmin</strong> to enter the DB</p><p></p><p><img src="images/63-12.png" alt="images/63-12.png" /></p><p></p><p>we use the found credentials. We got into the admin panel of the page.</p><p></p><p><img src="images/63-13.png" alt="images/63-13.png" /></p><p></p><p>We can see a list of databased on the left panel. Intesting point is there are 2 databases <strong>phpmyadmin</strong> &amp; <strong>phpmyadmin1</strong></p><p>Generally, the <strong>wp-options</strong> file contains the corresponding URL. Lets check them for each.</p><p></p><p>For <strong>phpmyadmin</strong></p><p></p><p><img src="images/63-14.png" alt="images/63-14.png" /></p><p></p><p>For <strong>phpmyadmin1</strong></p><p></p><p><img src="images/63-15.png" alt="images/63-15.png" /></p><p></p><p>Findings, we found that we have FTP write access to one webroot.</p><p>However, we have 2 wordpress websites.</p><p></p><p><strong>http://adana.thm</strong></p><p><strong>http://subdomain.adana.thm</strong></p><p></p><p>I added this domain in the <strong>hosts</strong> file.</p><p></p><p>We will test with a demo file to check which domain we have acccess to through the FTP.</p><p>I uploaded the following demo file using FTP.</p><p></p><p><strong>echo &quot;cybex was here&quot; &gt; test.txt</strong></p><p></p><p>Next, we upload it.</p><p></p><p><img src="images/63-16.png" alt="images/63-16.png" /></p><p></p><p><strong>Important</strong></p><p>For this to work, we also need to change the permission of file to 777 for the file to load in the webserver.</p><p></p><p><img src="images/63-17.png" alt="images/63-17.png" /></p><p></p><p>Finally, lets check in both the domains, to see where I find my test file.</p><p></p><p><img src="images/63-18.png" alt="images/63-18.png" /></p><p></p><p></p><p><img src="images/63-19.png" alt="images/63-19.png" /></p><p></p><p>Thus, we have access to <strong>http://subdomain.adana.thm</strong> using the <strong>FTP</strong> access. We can upload a custom PHP reverse shell in FTP &amp; access the reverse shell file using the website.</p><p></p><p><strong><h2>Foothold</h2></strong></p><p></p><p>I upload a PHP reverse shell in FTP found from <strong>/usr/share/webshells/php/php-revshell-all-OS.php</strong> by changing its name to shell.php &amp; changing the IP &amp; Port to connect back to.</p><p></p><p><strong>Note:</strong> Remember to change the permission to 777</p><p></p><p><img src="images/63-20.png" alt="images/63-20.png" /></p><p></p><p>Start a reverse shell listner.</p><p>We can go the link in browser to activate the shell or we can use curl as foilows:</p><p></p><p><strong>curl http://subdomain.adana.thm/shell.php</strong></p><p><strong></strong></p><p>We have foothold on the machine.</p><p></p><p><img src="images/63-21.png" alt="images/63-21.png" /></p><p></p><p>Next, we stabilize the shell using python.</p><p></p><p><strong>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</strong></p><p><strong>export TERM=xterm</strong></p><p></p><p><strong><h3>Lateral Movement</h3></strong></p><p></p><p>There is only 1 user named “<strong>hakanbey</strong>” in the home directory.</p><p></p><p><img src="images/63-22.png" alt="images/63-22.png" /></p><p></p><p>I tried may ways, but the way to get to this user is through <strong>sucrack</strong></p><p></p><p>Link: <strong>https://github.com/hemp3l/sucrack</strong> </p><p></p><p>Its a login cracker which uses a wordlist.</p><p>We will use the wordlist found before in the <strong>/annoucements</strong> page.</p><p></p><p></p><p>I uploaded the sucrack binary from my local kali machine &amp; wordlist using FTP. I moved both the files into /tmp directory &amp; run the program.</p><p></p><p><img src="images/63-23.png" alt="images/63-23.png" /></p><p></p><p><strong>Note: </strong>Remember to change permission to 777 in FTP.</p><p></p><p>Then, I moved both files to /tmp &amp; ran it.</p><p></p><p></p><p><strong>./sucrack -u hakanbey -w 100 wordlist.txt</strong></p><p></p><p>The tool ran completely however, we didn&#39;t find any successful logins.</p><p>Then, we added the password style to entire wordlist.</p><p>The FTP Password began with <strong>123adana</strong></p><p>So we add a <strong>123adana</strong> to the entire wordlist.txt</p><p></p><p>This can be easily done using in GUI using sublime text&#39;s find &amp; replace.</p><p></p><p><strong>Sublime Text</strong></p><p></p><p>Hold Ctrl + H to open Find &amp; Replace Panel</p><p>Select the “regular expression” button on the left.</p><p>Find <strong>^</strong> (Beginning of Line) &amp; Replace with <strong>123adana</strong></p><p></p><p><img src="images/63-24.png" alt="images/63-24.png" /></p><p></p><p>Or</p><p></p><p>CLI sed tool</p><p></p><p><strong>sed -e &#39;s/^/123adana/&#39; wordlist.txt &gt; wordlist-new.txt</strong></p><p></p><p>Next, we upload the new wordlist to the target machine &amp; change its permission to 777 using FTP.</p><p>We will run the <strong>sucrack</strong> tool again using this wordlist.</p><p></p><p><strong>./sucrack -u hakanbey -w 100 wordlist-new.txt</strong></p><p></p><p>We cracked it.</p><p></p><p><img src="images/63-25.png" alt="images/63-25.png" /></p><p></p><p>Next, we switch to hakanbey user for user flag.</p><p></p><p><img src="images/63-26.png" alt="images/63-26.png" /></p><p></p><p></p><p><strong><h3>Privilege Escalation</h3></strong></p><p></p><p>Lets check for files with SUID set.</p><p></p><p><strong>find / -type f -perm -u=s 2&gt; /dev/null</strong></p><p></p><p><img src="images/63-27.png" alt="images/63-27.png" /></p><p></p><p>We find an intresting application with suid bit set. Lets examine it,</p><p></p><p><img src="images/63-28.png" alt="images/63-28.png" /></p><p></p><p>We run the program with ltrace &amp; find the string required to get the hint.</p><p>Lets run the program.</p><p></p><p>We run the one with SUID set &amp; get the hint.</p><p></p><p><img src="images/63-29.png" alt="images/63-29.png" /></p><p></p><p></p><p>The hint is about <strong>hexeditor</strong>. We will get the <strong>root.jpg</strong> &amp; examine with hex editor in our local kali machine.</p><p></p><p><img src="images/63-30.png" alt="images/63-30.png" /></p><p></p><p>we use <strong>xxd</strong> to check the hex contents of the image. We store the hex value the address <strong>00000020</strong> </p><p>The hint in tryhackme platfrom says <strong>From HEX, To Base85</strong></p><p></p><p>Thus, we take the hex in the address to <strong>cyberchef</strong> &amp; encode it to <strong>Base85</strong></p><p></p><p><img src="images/63-31.png" alt="images/63-31.png" /></p><p></p><p>We get the root credentials. Let switch to root user &amp; collect the root flag.</p><p></p><p><img src="images/63-32.png" alt="images/63-32.png" /></p><p></p><p>Thanks !!</p></div>
</body>
</html>
