<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>wonderland</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>wonderland</h1><br/><p><strong><h1>THM Wonderland</h1></strong></p><p></p><p></p><p><strong><h2>Enumeration</h2></strong></p><p></p><p>Rustscan</p><p><img src="images/26-1.png" alt="images/26-1.png" /></p><p></p><p>We get 3 image files in the <strong>http://10.10.237.165/img</strong> directory</p><p>We use <strong>steghide</strong> to analyze the files. Just hit <strong>“Enter”</strong> when asked for paraphrase.</p><p></p><p></p><p><img src="images/26-2.png" alt="images/26-2.png" /></p><p></p><p></p><p></p><p><strong>We use gobuster to find hidden directories.</strong></p><p><img src="images/26-3.png" alt="images/26-3.png" /></p><p></p><p>We found <strong>http://10.10.237.165/r </strong>which tells us tp continue</p><p><img src="images/26-4.png" alt="images/26-4.png" /></p><p></p><p>We do gobuster again with the new found directory.</p><p></p><p><img src="images/26-5.png" alt="images/26-5.png" /></p><p></p><p>Using the above and the hint text found. We confim the endpoint url to be <strong>http://10.10.237.165/r/a/b/b/i/t</strong> </p><p>We find the following.</p><p></p><p><img src="images/26-6.png" alt="images/26-6.png" /></p><p></p><p></p><p>We view its source to find a set of credentials.</p><p><img src="images/26-7.png" alt="images/26-7.png" /></p><p></p><p></p><p><strong>Credentials Found</strong></p><p>Username:	alice</p><p>Password:	HowDothTheLittleCrocodileImproveHisShiningTail</p><p></p><p></p><p><strong><h2>Foothold</h2></strong></p><p></p><p>We ssh to the machine using the above credentials.</p><p></p><p><img src="images/26-8.png" alt="images/26-8.png" /></p><p></p><p></p><p><strong><h2>Privilege Escalation</h2></strong></p><p></p><p></p><p><img src="images/26-9.png" alt="images/26-9.png" /></p><p></p><p>We see we can run the python program as <strong>Rabbit</strong> if we run as user <strong>Rabbit</strong></p><p>Also we notice we can&#39;t edit the <strong>walrus_and_the_carpenter.py </strong>file. </p><p>But we see it imports <strong>random</strong>. </p><p>What we can do is create a local python file named random which will open a <strong>shell</strong> as <strong>Rabbit</strong>.</p><p></p><p>Create a file named <strong>random.py</strong> and enter the following.</p><p></p><p><img src="images/26-10.png" alt="images/26-10.png" /></p><p></p><p>Then we run the python program as rabbit user with sudo as follows</p><p></p><p><img src="images/26-11.png" alt="images/26-11.png" /></p><p></p><p>Inside Rabbit&#39;s home, we find an intresting executible file called <strong>teaParty</strong> with <strong>SUID</strong> set.</p><p></p><p><img src="images/26-12.png" alt="images/26-12.png" /></p><p></p><p>We download the executible using scp. But we don&#39;t know ssh password of <strong>Rabbit</strong>.</p><p>Thus we create a key file in our local machine. Enter a paraphrase to secure it.</p><p></p><p><img src="images/26-13.png" alt="images/26-13.png" /></p><p></p><p><img src="images/26-14.png" alt="images/26-14.png" /></p><p></p><p>Then we copy the public key into authorized keys of user <strong>Rabbit</strong></p><p></p><p><img src="images/26-15.png" alt="images/26-15.png" /></p><p></p><p>Now we can scp without <strong>rabbit&#39;s </strong>password. We need to enter the paraphrase we set before while making the keys.</p><p></p><p><img src="images/26-16.png" alt="images/26-16.png" /></p><p></p><p></p><p>Once we have the executibles ready locally, we can use <strong>strings</strong> or <strong>ghidra</strong> to analyze the files and look for strings.</p><p></p><p><strong>Strings</strong></p><p><img src="images/26-17.png" alt="images/26-17.png" /></p><p></p><p><strong>ghidra</strong></p><p><img src="images/26-18.png" alt="images/26-18.png" /></p><p></p><p>Both cases we see that the <strong>date</strong> program is called without full path.</p><p>Thus we can create a <strong>local</strong> <strong>date executible</strong> that would run a <strong>shell</strong>. We also need to add the <strong>Rabbit&#39;s home</strong> to the <strong>path</strong>.</p><p></p><p><img src="images/26-19.png" alt="images/26-19.png" /></p><p></p><p></p><p></p><p>Then we look for <strong>cap_setuid</strong> files</p><p></p><p><img src="images/26-20.png" alt="images/26-20.png" /></p><p></p><p>We can use this to spawn a <strong>root shell</strong> as seen in <strong>GTFOBins</strong></p><p></p><p><img src="images/26-21.png" alt="images/26-21.png" /></p><p></p><p></p><p>We use the following and pwn the machine.</p><p><strong>/usr/bin/perl -e &#39;use POSIX qw(setuid); POSIX::setuid(0); exec &quot;/bin/bash&quot;;&#39;</strong></p><p></p><p><img src="images/26-22.png" alt="images/26-22.png" /></p><p></p><p></p><p>We get both the flags as shown above.</p><p>Thanks!!</p><p></p></div>
</body>
</html>
