<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>blog</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>blog</h1><br/><p><strong><h1>THM Blog</h1></strong></p><p></p><p></p><p>To Solve this machine we need to add <strong>blog.thm</strong> to our hosts file as mentioned in the room.</p><p></p><p><strong><h3>Nmap Scan</h3></strong></p><p></p><p><img src="images/22-1.png" alt="images/22-1.png" /></p><p></p><p>Ports Open: <strong>22,80,139,445</strong></p><p></p><p><strong><h3>Enumeration</h3></strong></p><p></p><p>The Samba Port items are <strong>rabbit hole</strong> without any important information.</p><p></p><p><strong>Website</strong></p><p>We browsed the website and wappalyzer found <strong>wordpress CMS 5.0</strong> running on the site.</p><p>We also found a login page.</p><p><img src="images/22-2.png" alt="images/22-2.png" /></p><p></p><p>We will use <strong>wpscan</strong> for further emuneration.</p><p></p><p>To enumerate users we use the following</p><p><strong>wpscan --url http://blog.thm/ -e u</strong></p><p></p><p><img src="images/22-3.png" alt="images/22-3.png" /></p><p></p><p>We found 4 possible usernames:</p><p><strong>kwheel</strong></p><p><strong>bjoel</strong></p><p><strong>Karen Wheeler</strong></p><p><strong>Billy Joel</strong></p><p></p><p>We then tried each username one by one on the <strong>wp-login</strong> page with a dummy password.</p><p>(We do this to check the error message of each and find the validity of usernames)</p><p></p><p></p><p>Invalid Users: Error Message - <strong>Invalid username.</strong></p><p><strong>Karen Wheeler</strong></p><p><strong>Billy Joel</strong></p><p></p><p></p><p>Valid Users: Error Message - <strong>The password you entered for the username xxxx is incorrect</strong></p><p><strong>kwheel</strong></p><p><strong>bjoel</strong></p><p></p><p>Now we use each username separately in <strong>wpscan</strong> brute force.</p><p><strong>Note:</strong> We can give a Username file containing both/all usernames. It will take a lot of time.</p><p>The reason we do it separately because one username can be a rabbit hole. (Found out later)</p><p></p><p><strong><h3>Brute Force using wpscan</h3></strong></p><p></p><p><strong>wpscan --url http://blog.thm/ -P /usr/share/wordlists/rockyou.txt -u kwheel --max-threads 50</strong></p><p><strong>wpscan --url http://blog.thm/ -P /usr/share/wordlists/rockyou.txt -u bjoel --max-threads 50</strong></p><p></p><p><strong>Note:</strong> The user bjoel is a rabbit hoie and takes forever to crack. However, we cracked <strong>kwheel&#39;s</strong> password.</p><p></p><p><img src="images/22-4.png" alt="images/22-4.png" /></p><p></p><p>Thus we found the following <strong>wp-login</strong> credentials.</p><p></p><p><strong>Username: kwheel</strong></p><p><strong>Password: cutiepie1</strong></p><p></p><p></p><p><strong><h3>Foothold</h3></strong></p><p></p><p>We search <strong>wordpress 5.0</strong> in metasploit framework and use the following exploit.</p><p><strong>exploit/multi/http/wp_crop_rce</strong></p><p></p><p><img src="images/22-5.png" alt="images/22-5.png" /></p><p></p><p>We set the above options. Following is the snap fo final <strong>show options</strong></p><p></p><p><img src="images/22-6.png" alt="images/22-6.png" /></p><p></p><p>Then we run the exploit and get a user shell.</p><p></p><p><img src="images/22-7.png" alt="images/22-7.png" /></p><p></p><p><strong><h3>Privilege Escalation</h3></strong></p><p></p><p>We look for files with <strong>SUID</strong> set for privilege escalation.</p><p><strong>find / -type f -perm -04000 2&gt;/dev/null</strong></p><p></p><p><img src="images/22-8.png" alt="images/22-8.png" /></p><p></p><p>Intresting File Found</p><p><strong>/usr/sbin/checker</strong></p><p></p><p><img src="images/22-9.png" alt="images/22-9.png" /></p><p></p><p>When we run it, we get message. Not an Admin</p><p></p><p>We download the executible and ananlyze it with <strong>ghidra</strong></p><p>We create a temporary project and open the <strong>checker</strong> executible in <strong>CodeBrowser</strong></p><p></p><p><img src="images/22-10.png" alt="images/22-10.png" /></p><p></p><p>Click on Import File and add the checker executible into the project.</p><p><img src="images/22-11.png" alt="images/22-11.png" /></p><p></p><p></p><p>Click on the <strong>Green Dragon</strong> option to open the <strong>CodeBrowser</strong> and add the <strong>checker</strong> file</p><p></p><p><img src="images/22-12.png" alt="images/22-12.png" /></p><p></p><p>Then we go to the <strong>main function</strong> and analyze it.</p><p></p><p><img src="images/22-13.png" alt="images/22-13.png" /></p><p></p><p>We see the decompiled code in the right side of the browser.</p><p>We observe that the program checks an <strong>environment variable</strong> named: <strong>“admin”</strong></p><p></p><p>if its blank it will return as not an admin</p><p>But if it has any string value it should open a root shell.</p><p></p><p>We try this on the program and get root access.</p><p></p><p><img src="images/22-14.png" alt="images/22-14.png" /></p><p></p><p></p><p>We get the required flags.</p><p></p><p>Thanks !!</p><p></p></div>
</body>
</html>
