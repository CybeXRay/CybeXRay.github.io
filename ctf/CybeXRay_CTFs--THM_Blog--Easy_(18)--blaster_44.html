<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>blaster</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>blaster</h1><br/><p><strong><h1>THM: Blaster</h1></strong></p><p></p><p></p><p><strong><h2>Enumeration</h2></strong></p><p></p><p><strong>Rustscan &amp; Nmap</strong></p><p><img src="images/44-1.png" alt="images/44-1.png" /></p><p></p><p><strong>Open Ports:</strong> 80 (WEB) &amp; 3389 (RDP)</p><p></p><p><strong>Website Enumeration</strong></p><p><img src="images/44-2.png" alt="images/44-2.png" /></p><p></p><p>We find a default IIS Server page.</p><p></p><p><strong>Dirsearch &amp; Gobuster</strong></p><p><img src="images/44-3.png" alt="images/44-3.png" /></p><p></p><p><strong>Web Directory Enumeration</strong></p><p><img src="images/44-4.png" alt="images/44-4.png" /></p><p></p><p>We found a blogging page &amp; also found a wordpress login page.</p><p><img src="images/44-5.png" alt="images/44-5.png" /></p><p></p><p></p><p>We can also use gobuster with <strong>http://10.10.163.147/retro</strong>. But i will continue manually enumerating the website &amp; as expected I found clear text password in the “<strong>Ready Player One</strong>” Blog entry.</p><p></p><p><img src="images/44-6.png" alt="images/44-6.png" /></p><p></p><p><strong>Credentials Found:</strong></p><p>Username	: 	<strong>Wade</strong></p><p>Password		:	<strong>parzival</strong>	 	</p><p></p><p>Lets Login to Wordpress with the credentials.</p><p><img src="images/44-7.png" alt="images/44-7.png" /></p><p></p><p>And as expected we are successful.</p><p></p><p><strong>Note</strong></p><p>There are 2 Foothold Methods. Access to normal user is possible in both the methods. However, Later I found out that Windows Defender is active in the machine thus, I get to system access with Method-2 only</p><p></p><p><strong><h2>Foothold Method-1</h2></strong></p><p></p><p>Go to <strong>Apperance -→ Themes</strong> &amp; select any theme (Preferably Non Active) to make changes.</p><p><img src="images/44-8.png" alt="images/44-8.png" /></p><p></p><p>I choose<strong> Twenty Sixteen</strong>.</p><p>Now lets go to <strong>Apperance --→ Theme Editor</strong> &amp; select the <strong>theme</strong> on the <strong>right</strong> from the <strong>dropdown</strong> and click on “<strong>Select</strong>” button</p><p></p><p><img src="images/44-9.png" alt="images/44-9.png" /></p><p></p><p></p><p>Then from the right side pane of “<strong>Theme Files</strong>”, select any php file (Prefarably <strong>index.php</strong>)</p><p><img src="images/44-10.png" alt="images/44-10.png" /></p><p></p><p>Now, replace the contents on the index.php with the php-reverse-shell for <strong>ALL OS</strong> </p><p>Link: <strong>https://github.com/ivan-sincek/php-reverse-shell/blob/master/src/reverse/php_reverse_shell.php</strong></p><p><strong>Note:</strong> Make the necessary changes in the reverse shell file in the <strong>ip</strong> &amp; <strong>port</strong> field.</p><p></p><p><img src="images/44-11.png" alt="images/44-11.png" /></p><p></p><p>After making the changes, click on update file on the bottom of the page.</p><p></p><p><strong>Triggering the Reverse Shell</strong></p><p>Start a netcat listener in Kali machine on port specified on the reverse shell file.</p><p>Next <strong>Live</strong> <strong>Preview</strong> the <strong>Twenty Sixteen</strong> theme to activate the reverse shell.</p><p></p><p>Go to <strong>Apperance -→ Themes</strong> &amp; click on <strong>Live Preview</strong> of the <strong>Twenty Sixteen</strong> theme (Select the one modified by you)</p><p><img src="images/44-12.png" alt="images/44-12.png" /></p><p></p><p>And back in our Netcat Listner, we got a shell.</p><p><img src="images/44-13.png" alt="images/44-13.png" /></p><p></p><p></p><p><strong><h2>Priviege Escalation</h2></strong></p><p></p><p>I check the user details and its privileges. Luckily, the user has <strong>SeImpersonate / SeAssignPrimaryToken</strong> present for the user.</p><p>This can be used for privilege escalation.</p><p></p><p><img src="images/44-14.png" alt="images/44-14.png" /></p><p></p><p>I decided to use the <strong>PrintSpoofer.exe</strong> exploit for privilege escalation.</p><p><strong>Note:</strong> It will only work if the above privileges are present.</p><p></p><p>Link: <strong>https://github.com/itm4n/PrintSpoofer/releases</strong></p><p></p><p>I will host the <strong>PrintSpoofer.exe</strong> using python web server in my kali machine.</p><p>Keep the PrintSpoofer.exe in a directory and from that directory run.</p><p></p><p><strong>python -m http.server 80</strong></p><p></p><p>In the Windows Terminal, Open <strong>Powershell</strong> as it supports wget for file download. Then go the <strong>C:\Users\Public</strong> directory as it is world writable.</p><p>Then <strong>download</strong> the <strong>Printspoofer.exe</strong> &amp; <strong>run</strong> it.</p><p></p><p>I tried the above and it failed because the “<strong>windows defender” </strong>was blocking the program, We will tackle the situation in an alternate method.</p><p></p><p></p><p><strong><h2>Foothold Method-2</h2></strong></p><p></p><p><strong>Credentials Found:</strong></p><p>Username	: 	<strong>Wade</strong></p><p>Password		:	<strong>parzival</strong>	 	</p><p></p><p>Instead of logging into wordpress, we use the found credentials as a system user using <strong>RDP</strong>.</p><p></p><p><strong>xfreerdp /dynamic-resolution +clipboard /cert:ignore /scale:140 /v:10.10.155.166 /u:wade /p:parzival</strong></p><p></p><p><img src="images/44-15.png" alt="images/44-15.png" /></p><p></p><p>We get the user flag in the Deskop.</p><p></p><p></p><p><strong><h2>Privilege Escalation</h2></strong></p><p></p><p>As Windows Defender is active, normal exploits for this version of Windows like Printpsoofer and JuicyPotato won&#39;t work because it will be flagged as viruses.</p><p></p><p><strong>Machine Specific Method</strong></p><p></p><p>Open the <strong>hhupd</strong> application on Desktop as administrator.</p><p><img src="images/44-16.png" alt="images/44-16.png" /></p><p></p><p>Then Click on “<strong>Show more details</strong>”</p><p><img src="images/44-17.png" alt="images/44-17.png" /></p><p></p><p>Then click on “<strong>Show information about the publisher&#39;s certificate</strong>”</p><p><img src="images/44-18.png" alt="images/44-18.png" /></p><p></p><p>Then click on the <strong>CA</strong> link</p><p><img src="images/44-19.png" alt="images/44-19.png" /></p><p></p><p>This will open an Internet Explorer with Administrative Privileges. Now we can close this page clicking <strong>OK </strong>and then <strong>No</strong> Respectively. On the Desktop we will see the <strong>high priviledged Internet Explorer</strong>.</p><p></p><p><img src="images/44-20.png" alt="images/44-20.png" /></p><p></p><p></p><p>Now, To get system access. We will use the same method from <strong>Insecure GUI Apps </strong>in the guide.</p><p></p><p><strong>CybeXRay Guides → Privilege Escalation → Windows Modular Refreshed → Insecure GUI Apps</strong></p><p></p><p>Open the settings and click on save as</p><p><img src="images/44-21.png" alt="images/44-21.png" /></p><p></p><p>Then a file explorer opens. In the address of it we need to enter:</p><p><strong>file:\\c:\windows\system32\cmd.exe</strong></p><p><img src="images/44-22.png" alt="images/44-22.png" /></p><p></p><p>Then, hit <strong>Enter</strong>. We will get a system privileged cmd.</p><p></p><p><img src="images/44-23.png" alt="images/44-23.png" /></p><p></p><p>Next, go Administrator&#39;s desktop to collect the root flag.</p><p></p><p>Thanks!!</p></div>
</body>
</html>
